# Comparing `tmp/hidiffusion-0.1.1.tar.gz` & `tmp/hidiffusion-0.1.2.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "hidiffusion-0.1.1.tar", last modified: Sat Apr 13 17:14:03 2024, max compression
+gzip compressed data, was "hidiffusion-0.1.2.tar", last modified: Tue Apr 16 06:51:36 2024, max compression
```

## Comparing `hidiffusion-0.1.1.tar` & `hidiffusion-0.1.2.tar`

### file list

```diff
@@ -1,14 +1,14 @@
-drwxrwxr-x   0 zhangshen (10250) zhangshen (10250)        0 2024-04-13 17:14:03.445131 hidiffusion-0.1.1/
--rw-r--r--   0 zhangshen (10250) zhangshen (10250)    11924 2024-04-13 17:14:03.445131 hidiffusion-0.1.1/PKG-INFO
--rw-rw-r--   0 zhangshen (10250) zhangshen (10250)    11631 2024-04-13 17:12:45.000000 hidiffusion-0.1.1/README.md
-drwxrwxr-x   0 zhangshen (10250) zhangshen (10250)        0 2024-04-13 17:14:03.441131 hidiffusion-0.1.1/hidiffusion/
--rw-rw-r--   0 zhangshen (10250) zhangshen (10250)      118 2024-04-13 17:12:45.000000 hidiffusion-0.1.1/hidiffusion/__init__.py
--rw-rw-r--   0 zhangshen (10250) zhangshen (10250)   100861 2024-04-13 17:12:45.000000 hidiffusion-0.1.1/hidiffusion/hidiffusion.py
--rw-rw-r--   0 zhangshen (10250) zhangshen (10250)      872 2024-04-13 17:12:45.000000 hidiffusion-0.1.1/hidiffusion/utils.py
-drwxrwxr-x   0 zhangshen (10250) zhangshen (10250)        0 2024-04-13 17:14:03.441131 hidiffusion-0.1.1/hidiffusion.egg-info/
--rw-r--r--   0 zhangshen (10250) zhangshen (10250)    11924 2024-04-13 17:14:02.000000 hidiffusion-0.1.1/hidiffusion.egg-info/PKG-INFO
--rw-rw-r--   0 zhangshen (10250) zhangshen (10250)      230 2024-04-13 17:14:02.000000 hidiffusion-0.1.1/hidiffusion.egg-info/SOURCES.txt
--rw-rw-r--   0 zhangshen (10250) zhangshen (10250)        1 2024-04-13 17:14:02.000000 hidiffusion-0.1.1/hidiffusion.egg-info/dependency_links.txt
--rw-rw-r--   0 zhangshen (10250) zhangshen (10250)       12 2024-04-13 17:14:02.000000 hidiffusion-0.1.1/hidiffusion.egg-info/top_level.txt
--rw-rw-r--   0 zhangshen (10250) zhangshen (10250)       38 2024-04-13 17:14:03.445131 hidiffusion-0.1.1/setup.cfg
--rw-rw-r--   0 zhangshen (10250) zhangshen (10250)      462 2024-04-13 17:13:41.000000 hidiffusion-0.1.1/setup.py
+drwxr-xr-x   0 zhangshen (10250) zhangshen (10250)        0 2024-04-16 06:51:36.435990 hidiffusion-0.1.2/
+-rw-r--r--   0 zhangshen (10250) zhangshen (10250)    14917 2024-04-16 06:51:36.435990 hidiffusion-0.1.2/PKG-INFO
+-rw-r--r--   0 zhangshen (10250) zhangshen (10250)    14624 2024-04-16 06:49:20.000000 hidiffusion-0.1.2/README.md
+drwxr-xr-x   0 zhangshen (10250) zhangshen (10250)        0 2024-04-16 06:51:36.411989 hidiffusion-0.1.2/hidiffusion/
+-rw-r--r--   0 zhangshen (10250) zhangshen (10250)      118 2024-04-16 06:49:20.000000 hidiffusion-0.1.2/hidiffusion/__init__.py
+-rw-r--r--   0 zhangshen (10250) zhangshen (10250)   103957 2024-04-16 06:49:20.000000 hidiffusion-0.1.2/hidiffusion/hidiffusion.py
+-rw-r--r--   0 zhangshen (10250) zhangshen (10250)      872 2024-04-16 06:49:20.000000 hidiffusion-0.1.2/hidiffusion/utils.py
+drwxr-xr-x   0 zhangshen (10250) zhangshen (10250)        0 2024-04-16 06:51:36.431990 hidiffusion-0.1.2/hidiffusion.egg-info/
+-rw-r--r--   0 zhangshen (10250) zhangshen (10250)    14917 2024-04-16 06:51:35.000000 hidiffusion-0.1.2/hidiffusion.egg-info/PKG-INFO
+-rw-r--r--   0 zhangshen (10250) zhangshen (10250)      230 2024-04-16 06:51:35.000000 hidiffusion-0.1.2/hidiffusion.egg-info/SOURCES.txt
+-rw-r--r--   0 zhangshen (10250) zhangshen (10250)        1 2024-04-16 06:51:35.000000 hidiffusion-0.1.2/hidiffusion.egg-info/dependency_links.txt
+-rw-r--r--   0 zhangshen (10250) zhangshen (10250)       12 2024-04-16 06:51:35.000000 hidiffusion-0.1.2/hidiffusion.egg-info/top_level.txt
+-rw-r--r--   0 zhangshen (10250) zhangshen (10250)       38 2024-04-16 06:51:36.435990 hidiffusion-0.1.2/setup.cfg
+-rw-r--r--   0 zhangshen (10250) zhangshen (10250)      462 2024-04-16 06:50:02.000000 hidiffusion-0.1.2/setup.py
```

### Comparing `hidiffusion-0.1.1/PKG-INFO` & `hidiffusion-0.1.2/README.md`

 * *Files 14% similar despite different names*

```diff
@@ -1,746 +1,914 @@
-00000000: 4d65 7461 6461 7461 2d56 6572 7369 6f6e  Metadata-Version
-00000010: 3a20 322e 310a 4e61 6d65 3a20 6869 6469  : 2.1.Name: hidi
-00000020: 6666 7573 696f 6e0a 5665 7273 696f 6e3a  ffusion.Version:
-00000030: 2030 2e31 2e31 0a53 756d 6d61 7279 3a20   0.1.1.Summary: 
-00000040: 4869 4469 6666 7573 696f 6e3a 2041 2074  HiDiffusion: A t
-00000050: 7261 696e 696e 672d 6672 6565 206d 6574  raining-free met
-00000060: 686f 6420 746f 2069 6e63 7265 6173 6520  hod to increase 
-00000070: 7468 6520 7265 736f 6c75 7469 6f6e 2061  the resolution a
-00000080: 6e64 2073 7065 6564 206f 6620 6469 6666  nd speed of diff
-00000090: 7573 696f 6e20 6d6f 6465 6c73 2e0a 486f  usion models..Ho
-000000a0: 6d65 2d70 6167 653a 200a 4175 7468 6f72  me-page: .Author
-000000b0: 3a20 5368 656e 205a 6861 6e67 2c20 5a68  : Shen Zhang, Zh
-000000c0: 616f 7765 6920 4368 656e 2c20 5a68 656e  aowei Chen, Zhen
-000000d0: 7975 205a 6861 6f2c 2059 7568 616f 2043  yu Zhao, Yuhao C
-000000e0: 6865 6e2c 2059 616f 2054 616e 672c 204a  hen, Yao Tang, J
-000000f0: 6961 6a75 6e20 4c69 616e 670a 4465 7363  iajun Liang.Desc
-00000100: 7269 7074 696f 6e2d 436f 6e74 656e 742d  ription-Content-
-00000110: 5479 7065 3a20 7465 7874 2f6d 6172 6b64  Type: text/markd
-00000120: 6f77 6e0a 0a23 20f0 9f92 a120 4869 4469  own..# .... HiDi
-00000130: 6666 7573 696f 6e0a 0a3e 202a 2a48 6944  ffusion..> **HiD
-00000140: 6966 6675 7369 6f6e 3a20 556e 6c6f 636b  iffusion: Unlock
-00000150: 696e 6720 4869 6768 6572 2d52 6573 6f6c  ing Higher-Resol
-00000160: 7574 696f 6e20 4372 6561 7469 7669 7479  ution Creativity
-00000170: 2061 6e64 2045 6666 6963 6965 6e63 7920   and Efficiency 
-00000180: 696e 2050 7265 7472 6169 6e65 6420 4469  in Pretrained Di
-00000190: 6666 7573 696f 6e20 4d6f 6465 6c73 2a2a  ffusion Models**
-000001a0: 2020 200a 3e20 5368 656e 205a 6861 6e67     .> Shen Zhang
-000001b0: 2c20 5a68 616f 7765 6920 4368 656e 2c20  , Zhaowei Chen, 
-000001c0: 5a68 656e 7975 205a 6861 6f2c 2059 7568  Zhenyu Zhao, Yuh
-000001d0: 616f 2043 6865 6e2c 2059 616f 2054 616e  ao Chen, Yao Tan
-000001e0: 672c 204a 6961 6a75 6e20 4c69 616e 6720  g, Jiajun Liang 
-000001f0: 2020 2020 0a3e 20f0 9fa7 ac5b 5b41 7278      .> ....[[Arx
-00000200: 6976 5d5d 2868 7474 7073 3a2f 2f61 7278  iv]](https://arx
-00000210: 6976 2e6f 7267 2f61 6273 2f32 3331 312e  iv.org/abs/2311.
-00000220: 3137 3532 3829 20f0 9f8e b75b 5b50 726f  17528) ....[[Pro
-00000230: 6a65 6374 2050 6167 655d 5d28 290a 0a0a  ject Page]]()...
-00000240: 3c64 6976 2061 6c69 676e 3d22 6365 6e74  <div align="cent
-00000250: 6572 223e 0a20 203c 696d 6720 7372 633d  er">.  <img src=
-00000260: 2261 7373 6574 732f 696d 6167 655f 6761  "assets/image_ga
-00000270: 6c6c 6572 792e 6a70 6722 2077 6964 7468  llery.jpg" width
-00000280: 3d22 3830 3022 203e 3c2f 696d 673e 0a20  ="800" ></img>. 
-00000290: 203c 6272 3e0a 2020 3c65 6d3e 0a20 2020   <br>.  <em>.   
-000002a0: 2020 2028 5365 6c65 6374 2048 6944 6966     (Select HiDif
-000002b0: 6675 7369 6f6e 2073 616d 706c 6573 2066  fusion samples f
-000002c0: 6f72 2076 6172 696f 7573 2064 6966 6675  or various diffu
-000002d0: 7369 6f6e 206d 6f64 656c 732c 2072 6573  sion models, res
-000002e0: 6f6c 7574 696f 6e73 2c20 616e 6420 6173  olutions, and as
-000002f0: 7065 6374 2072 6174 696f 732e 2920 0a20  pect ratios.) . 
-00000300: 203c 2f65 6d3e 0a3c 2f64 6976 3e0a 3c62   </em>.</div>.<b
-00000310: 723e 0a0a 0a23 20f0 9f91 8920 5768 7920  r>...# .... Why 
-00000320: 4869 4469 6666 7573 696f 6e0a 0a2d 2041  HiDiffusion..- A
-00000330: 2020 2a2a 7472 6169 6e69 6e67 2d66 7265    **training-fre
-00000340: 6520 6d65 7468 6f64 2074 6861 7420 696e  e method that in
-00000350: 6372 6561 7365 7320 7468 6520 7265 736f  creases the reso
-00000360: 6c75 7469 6f6e 2061 6e64 2073 7065 6564  lution and speed
-00000370: 206f 6620 7072 6574 7261 696e 6564 2064   of pretrained d
-00000380: 6966 6675 7369 6f6e 206d 6f64 656c 732e  iffusion models.
-00000390: 2a2a 0a2d 2044 6573 6967 6e65 6420 6173  **.- Designed as
-000003a0: 2061 202a 2a70 6c75 672d 616e 642d 706c   a **plug-and-pl
-000003b0: 6179 2069 6d70 6c65 6d65 6e74 6174 696f  ay implementatio
-000003c0: 6e2a 2a2e 2049 7420 6361 6e20 6265 2069  n**. It can be i
-000003d0: 6e74 6567 7261 7465 6420 696e 746f 2064  ntegrated into d
-000003e0: 6966 6675 7369 6f6e 2070 6970 656c 696e  iffusion pipelin
-000003f0: 6573 2062 7920 2a2a 6f6e 6c79 2061 6464  es by **only add
-00000400: 696e 6720 6120 7369 6e67 6c65 206c 696e  ing a single lin
-00000410: 6520 6f66 2063 6f64 652a 2a21 0a0a 3c64  e of code**!..<d
-00000420: 6976 2061 6c69 676e 3d22 6365 6e74 6572  iv align="center
-00000430: 223e 0a20 203c 696d 6720 7372 633d 2261  ">.  <img src="a
-00000440: 7373 6574 732f 7175 616c 6974 795f 6566  ssets/quality_ef
-00000450: 6669 6369 656e 6379 2e6a 7067 2220 7769  ficiency.jpg" wi
-00000460: 6474 683d 2238 3030 2220 3e3c 2f69 6d67  dth="800" ></img
-00000470: 3e0a 2020 3c62 723e 0a20 203c 656d 3e0a  >.  <br>.  <em>.
-00000480: 2020 2020 2020 2846 6173 7465 722c 2061        (Faster, a
-00000490: 6e64 2062 6574 7465 7220 696d 6167 6520  nd better image 
-000004a0: 6465 7461 696c 732e 2920 0a20 203c 2f65  details.) .  </e
-000004b0: 6d3e 0a3c 2f64 6976 3e0a 3c62 723e 0a0a  m>.</div>.<br>..
-000004c0: 2323 20f0 9f93 a220 5375 7070 6f72 7465  ## .... Supporte
-000004d0: 6420 4d6f 6465 6c73 0a0a 2d20 e29c 8520  d Models..- ... 
-000004e0: 5b53 7461 626c 6520 4469 6666 7573 696f  [Stable Diffusio
-000004f0: 6e20 584c 5d28 6874 7470 733a 2f2f 6875  n XL](https://hu
-00000500: 6767 696e 6766 6163 652e 636f 2f70 6170  ggingface.co/pap
-00000510: 6572 732f 3233 3037 2e30 3139 3532 290a  ers/2307.01952).
-00000520: 2d20 e29c 8520 5b53 7461 626c 6520 4469  - ... [Stable Di
-00000530: 6666 7573 696f 6e20 584c 2054 7572 626f  ffusion XL Turbo
-00000540: 5d28 6874 7470 733a 2f2f 6875 6767 696e  ](https://huggin
-00000550: 6766 6163 652e 636f 2f73 7461 6269 6c69  gface.co/stabili
-00000560: 7479 6169 2f73 6478 6c2d 7475 7262 6f29  tyai/sdxl-turbo)
-00000570: 0a2d 20e2 9c85 205b 5374 6162 6c65 2044  .- ... [Stable D
-00000580: 6966 6675 7369 6f6e 2076 325d 2868 7474  iffusion v2](htt
-00000590: 7073 3a2f 2f68 7567 6769 6e67 6661 6365  ps://huggingface
-000005a0: 2e63 6f2f 7374 6162 696c 6974 7961 692f  .co/stabilityai/
-000005b0: 7374 6162 6c65 2d64 6966 6675 7369 6f6e  stable-diffusion
-000005c0: 2d32 2d31 290a 2d20 e29c 8520 5b53 7461  -2-1).- ... [Sta
-000005d0: 626c 6520 4469 6666 7573 696f 6e20 7631  ble Diffusion v1
-000005e0: 5d28 6874 7470 733a 2f2f 6875 6767 696e  ](https://huggin
-000005f0: 6766 6163 652e 636f 2f72 756e 7761 796d  gface.co/runwaym
-00000600: 6c2f 7374 6162 6c65 2d64 6966 6675 7369  l/stable-diffusi
-00000610: 6f6e 2d76 312d 3529 0a0a 2a2a 4e6f 7465  on-v1-5)..**Note
-00000620: 2a2a 3a20 4869 4469 6666 7573 696f 6e20  **: HiDiffusion 
-00000630: 6361 6e20 616c 736f 2073 7570 706f 7274  can also support
-00000640: 2074 6865 2064 6f77 6d73 7472 6561 6d20   the dowmstream 
-00000650: 6469 6666 7573 696f 6e20 6d6f 6465 6c73  diffusion models
-00000660: 2062 6173 6564 206f 6e20 7468 6573 6520   based on these 
-00000670: 7265 706f 7369 746f 7269 6573 2e0a 0a23  repositories...#
-00000680: 2320 f09f 92a3 2053 7570 706f 7274 6564  # .... Supported
-00000690: 2054 6173 6b73 0a0a 2d20 e29c 8520 5465   Tasks..- ... Te
-000006a0: 7874 2d74 6f2d 696d 6167 650a 2d20 e29c  xt-to-image.- ..
-000006b0: 8520 436f 6e74 726f 6c4e 6574 0a2d 20e2  . ControlNet.- .
-000006c0: 9c85 2049 6e70 6169 6e74 696e 670a 0a0a  .. Inpainting...
-000006d0: 2323 20f0 9f94 8e20 4d61 696e 2072 6571  ## .... Main req
-000006e0: 7569 7265 6d65 6e74 730a 5468 6973 2072  uirements.This r
-000006f0: 6570 6f73 6974 6f72 7920 6973 2074 6573  epository is tes
-00000700: 7465 6420 6f6e 0a2a 2050 7974 686f 6e3d  ted on.* Python=
-00000710: 3d33 2e38 0a2a 2074 6f72 6368 3d3d 312e  =3.8.* torch==1.
-00000720: 3133 2e31 0a2a 2064 6966 6675 7365 7273  13.1.* diffusers
-00000730: 3d3d 302e 3235 2e30 0a2a 2074 7261 6e73  ==0.25.0.* trans
-00000740: 666f 726d 6572 733d 3d34 2e32 372e 340a  formers==4.27.4.
-00000750: 2a20 6163 6365 6c65 7261 7465 3d3d 302e  * accelerate==0.
-00000760: 3138 2e30 0a2a 2078 666f 726d 6572 733d  18.0.* xformers=
-00000770: 3d30 2e30 2e31 3672 6334 3235 0a0a 2323  =0.0.16rc425..##
-00000780: 20f0 9f94 9120 496e 7374 616c 6c20 4869   .... Install Hi
-00000790: 4469 6666 7573 696f 6e0a 4166 7465 7220  Diffusion.After 
-000007a0: 696e 7374 616c 6c69 6e67 2074 6865 2070  installing the p
-000007b0: 6163 6b61 6765 7320 696e 2074 6865 206d  ackages in the m
-000007c0: 6169 6e20 7265 7175 6972 656d 656e 7473  ain requirements
-000007d0: 2c20 696e 7374 616c 6c20 4869 4469 6666  , install HiDiff
-000007e0: 7573 696f 6e3a 0a60 6060 7368 656c 6c0a  usion:.```shell.
-000007f0: 7069 7033 2069 6e73 7461 6c6c 2068 6964  pip3 install hid
-00000800: 6966 6675 7369 6f6e 0a60 6060 0a23 2323  iffusion.```.###
-00000810: 2049 6e73 7461 6c6c 696e 6720 6672 6f6d   Installing from
-00000820: 2073 6f75 7263 650a 416c 7465 726e 6174   source.Alternat
-00000830: 6976 656c 792c 2079 6f75 2063 616e 2069  ively, you can i
-00000840: 6e73 7461 6c6c 2066 726f 6d20 6769 7468  nstall from gith
-00000850: 7562 2073 6f75 7263 652e 2043 6c6f 6e65  ub source. Clone
-00000860: 2074 6865 2072 6570 6f73 6974 6f72 7920   the repository 
-00000870: 616e 6420 696e 7374 616c 6c3a 0a60 6060  and install:.```
-00000880: 6261 7368 0a67 6974 2063 6c6f 6e65 2068  bash.git clone h
-00000890: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-000008a0: 6d2f 5368 656e 5a68 616e 672d 5368 696e  m/ShenZhang-Shin
-000008b0: 2f48 6944 6966 6675 7369 6f6e 2e67 6974  /HiDiffusion.git
-000008c0: 0a63 6420 4869 4469 6666 7573 696f 6e0a  .cd HiDiffusion.
-000008d0: 7079 7468 6f6e 3320 7365 7475 702e 7079  python3 setup.py
-000008e0: 2069 6e73 7461 6c6c 0a60 6060 0a0a 0a23   install.```...#
-000008f0: 2320 f09f 9a80 2055 7361 6765 0a0a 4765  # .... Usage..Ge
-00000900: 6e65 7261 7469 6e67 206f 7574 7075 7473  nerating outputs
-00000910: 2077 6974 6820 4869 4469 6666 7573 696f   with HiDiffusio
-00000920: 6e20 6973 2073 7570 6572 2065 6173 7920  n is super easy 
-00000930: 6261 7365 6420 6f6e 20f0 9fa4 9720 5b64  based on .... [d
-00000940: 6966 6675 7365 7273 5d28 6874 7470 733a  iffusers](https:
-00000950: 2f2f 6769 7468 7562 2e63 6f6d 2f68 7567  //github.com/hug
-00000960: 6769 6e67 6661 6365 2f64 6966 6675 7365  gingface/diffuse
-00000970: 7273 2f74 7265 652f 6d61 696e 292e 0a0a  rs/tree/main)...
-00000980: 2323 2054 6578 742d 746f 2d69 6d61 6765  ## Text-to-image
-00000990: 2067 656e 6572 6174 696f 6e0a 0a23 2323   generation..###
-000009a0: 2053 7461 626c 6520 4469 6666 7573 696f   Stable Diffusio
-000009b0: 6e20 584c 0a0a 6060 6070 7974 686f 6e0a  n XL..```python.
-000009c0: 6672 6f6d 2068 6964 6966 6675 7369 6f6e  from hidiffusion
-000009d0: 2069 6d70 6f72 7420 6170 706c 795f 6869   import apply_hi
-000009e0: 6469 6666 7573 696f 6e2c 2072 656d 6f76  diffusion, remov
-000009f0: 655f 6869 6469 6666 7573 696f 6e0a 6672  e_hidiffusion.fr
-00000a00: 6f6d 2064 6966 6675 7365 7273 2069 6d70  om diffusers imp
-00000a10: 6f72 7420 5374 6162 6c65 4469 6666 7573  ort StableDiffus
-00000a20: 696f 6e58 4c50 6970 656c 696e 652c 2044  ionXLPipeline, D
-00000a30: 4449 4d53 6368 6564 756c 6572 0a69 6d70  DIMScheduler.imp
-00000a40: 6f72 7420 746f 7263 680a 7072 6574 7261  ort torch.pretra
-00000a50: 696e 5f6d 6f64 656c 203d 2022 7374 6162  in_model = "stab
-00000a60: 696c 6974 7961 692f 7374 6162 6c65 2d64  ilityai/stable-d
-00000a70: 6966 6675 7369 6f6e 2d78 6c2d 6261 7365  iffusion-xl-base
-00000a80: 2d31 2e30 220a 7363 6865 6475 6c65 7220  -1.0".scheduler 
-00000a90: 3d20 4444 494d 5363 6865 6475 6c65 722e  = DDIMScheduler.
-00000aa0: 6672 6f6d 5f70 7265 7472 6169 6e65 6428  from_pretrained(
-00000ab0: 7072 6574 7261 696e 5f6d 6f64 656c 2c20  pretrain_model, 
-00000ac0: 7375 6266 6f6c 6465 723d 2273 6368 6564  subfolder="sched
-00000ad0: 756c 6572 2229 0a70 6970 6520 3d20 5374  uler").pipe = St
-00000ae0: 6162 6c65 4469 6666 7573 696f 6e58 4c50  ableDiffusionXLP
-00000af0: 6970 656c 696e 652e 6672 6f6d 5f70 7265  ipeline.from_pre
-00000b00: 7472 6169 6e65 6428 7072 6574 7261 696e  trained(pretrain
-00000b10: 5f6d 6f64 656c 2c20 7363 6865 6475 6c65  _model, schedule
-00000b20: 7220 3d20 7363 6865 6475 6c65 722c 2074  r = scheduler, t
-00000b30: 6f72 6368 5f64 7479 7065 3d74 6f72 6368  orch_dtype=torch
-00000b40: 2e66 6c6f 6174 3136 2c20 7661 7269 616e  .float16, varian
-00000b50: 743d 2266 7031 3622 292e 746f 2822 6375  t="fp16").to("cu
-00000b60: 6461 2229 0a0a 2320 2320 4f70 7469 6f6e  da")..# # Option
-00000b70: 616c 2e20 656e 6162 6c65 5f78 666f 726d  al. enable_xform
-00000b80: 6572 735f 6d65 6d6f 7279 5f65 6666 6963  ers_memory_effic
-00000b90: 6965 6e74 5f61 7474 656e 7469 6f6e 2063  ient_attention c
-00000ba0: 616e 2073 6176 6520 6d65 6d6f 7279 2075  an save memory u
-00000bb0: 7361 6765 2061 6e64 2069 6e63 7265 6173  sage and increas
-00000bc0: 6520 696e 6665 7265 6e63 6520 7370 6565  e inference spee
-00000bd0: 642e 2065 6e61 626c 655f 6d6f 6465 6c5f  d. enable_model_
-00000be0: 6370 755f 6f66 666c 6f61 6420 616e 6420  cpu_offload and 
-00000bf0: 656e 6162 6c65 5f76 6165 5f74 696c 696e  enable_vae_tilin
-00000c00: 6720 6361 6e20 7361 7665 206d 656d 6f72  g can save memor
-00000c10: 7920 7573 6167 652e 0a23 2070 6970 652e  y usage..# pipe.
-00000c20: 656e 6162 6c65 5f78 666f 726d 6572 735f  enable_xformers_
-00000c30: 6d65 6d6f 7279 5f65 6666 6963 6965 6e74  memory_efficient
-00000c40: 5f61 7474 656e 7469 6f6e 2829 0a23 2070  _attention().# p
-00000c50: 6970 652e 656e 6162 6c65 5f6d 6f64 656c  ipe.enable_model
-00000c60: 5f63 7075 5f6f 6666 6c6f 6164 2829 0a23  _cpu_offload().#
-00000c70: 2070 6970 652e 656e 6162 6c65 5f76 6165   pipe.enable_vae
-00000c80: 5f74 696c 696e 6728 290a 0a23 2041 7070  _tiling()..# App
-00000c90: 6c79 2068 6964 6966 6675 7369 6f6e 2077  ly hidiffusion w
-00000ca0: 6974 6820 6120 7369 6e67 6c65 206c 696e  ith a single lin
-00000cb0: 6520 6f66 2063 6f64 652e 0a61 7070 6c79  e of code..apply
-00000cc0: 5f68 6964 6966 6675 7369 6f6e 2870 6970  _hidiffusion(pip
-00000cd0: 6529 0a0a 7072 6f6d 7074 203d 2022 5374  e)..prompt = "St
-00000ce0: 616e 6469 6e67 2074 616c 6c20 616d 6964  anding tall amid
-00000cf0: 7374 2074 6865 2072 7569 6e73 2c20 6120  st the ruins, a 
-00000d00: 7374 6f6e 6520 676f 6c65 6d20 6177 616b  stone golem awak
-00000d10: 656e 732c 2076 696e 6573 2061 6e64 2066  ens, vines and f
-00000d20: 6c6f 7765 7273 2073 7072 6f75 7469 6e67  lowers sprouting
-00000d30: 2066 726f 6d20 7468 6520 6372 6576 6963   from the crevic
-00000d40: 6573 2069 6e20 6974 7320 626f 6479 2e22  es in its body."
-00000d50: 0a6e 6567 6174 6976 655f 7072 6f6d 7074  .negative_prompt
-00000d60: 203d 2022 626c 7572 7279 2c20 7567 6c79   = "blurry, ugly
-00000d70: 2c20 6475 706c 6963 6174 652c 2070 6f6f  , duplicate, poo
-00000d80: 726c 7920 6472 6177 6e20 6661 6365 2c20  rly drawn face, 
-00000d90: 6465 666f 726d 6564 2c20 6d6f 7361 6963  deformed, mosaic
-00000da0: 2c20 6172 7469 6661 6374 732c 2062 6164  , artifacts, bad
-00000db0: 206c 696d 6273 220a 696d 6167 6520 3d20   limbs".image = 
-00000dc0: 7069 7065 2870 726f 6d70 742c 2067 7569  pipe(prompt, gui
-00000dd0: 6461 6e63 655f 7363 616c 653d 372e 352c  dance_scale=7.5,
-00000de0: 2068 6569 6768 743d 3230 3438 2c20 7769   height=2048, wi
-00000df0: 6474 683d 3230 3438 2c20 6574 613d 312e  dth=2048, eta=1.
-00000e00: 302c 206e 6567 6174 6976 655f 7072 6f6d  0, negative_prom
-00000e10: 7074 3d6e 6567 6174 6976 655f 7072 6f6d  pt=negative_prom
-00000e20: 7074 292e 696d 6167 6573 5b30 5d0a 696d  pt).images[0].im
-00000e30: 6167 652e 7361 7665 2866 2267 6f6c 656d  age.save(f"golem
-00000e40: 2e6a 7067 2229 0a60 6060 0a0a 3c64 6574  .jpg").```..<det
-00000e50: 6169 6c73 3e0a 3c73 756d 6d61 7279 3e4f  ails>.<summary>O
-00000e60: 7574 7075 743a 3c2f 7375 6d6d 6172 793e  utput:</summary>
-00000e70: 0a3c 6469 7620 616c 6967 6e3d 2263 656e  .<div align="cen
-00000e80: 7465 7222 3e0a 2020 3c69 6d67 2073 7263  ter">.  <img src
-00000e90: 3d22 6173 7365 7473 2f73 6478 6c2e 6a70  ="assets/sdxl.jp
-00000ea0: 6722 2077 6964 7468 3d22 3830 3022 203e  g" width="800" >
-00000eb0: 3c2f 696d 673e 0a3c 2f64 6976 3e0a 3c2f  </img>.</div>.</
-00000ec0: 6465 7461 696c 733e 0a0a 5365 7420 6865  details>..Set he
-00000ed0: 6967 6874 203d 2034 3039 362c 2077 6964  ight = 4096, wid
-00000ee0: 7468 203d 2034 3039 362c 2061 6e64 2079  th = 4096, and y
-00000ef0: 6f75 2063 616e 2067 6574 206f 7574 7075  ou can get outpu
-00000f00: 7420 7769 7468 2034 3039 3678 3430 3936  t with 4096x4096
-00000f10: 2072 6573 6f6c 7574 696f 6e2e 0a0a 2323   resolution...##
-00000f20: 2320 5374 6162 6c65 2044 6966 6675 7369  # Stable Diffusi
-00000f30: 6f6e 2058 4c20 5475 7262 6f0a 0a60 6060  on XL Turbo..```
-00000f40: 7079 7468 6f6e 0a66 726f 6d20 6869 6469  python.from hidi
-00000f50: 6666 7573 696f 6e20 696d 706f 7274 2061  ffusion import a
-00000f60: 7070 6c79 5f68 6964 6966 6675 7369 6f6e  pply_hidiffusion
-00000f70: 2c20 7265 6d6f 7665 5f68 6964 6966 6675  , remove_hidiffu
-00000f80: 7369 6f6e 0a66 726f 6d20 6469 6666 7573  sion.from diffus
-00000f90: 6572 7320 696d 706f 7274 2041 7574 6f50  ers import AutoP
-00000fa0: 6970 656c 696e 6546 6f72 5465 7874 3249  ipelineForText2I
-00000fb0: 6d61 6765 0a69 6d70 6f72 7420 746f 7263  mage.import torc
-00000fc0: 680a 7072 6574 7261 696e 5f6d 6f64 656c  h.pretrain_model
-00000fd0: 203d 2022 7374 6162 696c 6974 7961 692f   = "stabilityai/
-00000fe0: 7364 786c 2d74 7572 626f 220a 7069 7065  sdxl-turbo".pipe
-00000ff0: 203d 2041 7574 6f50 6970 656c 696e 6546   = AutoPipelineF
-00001000: 6f72 5465 7874 3249 6d61 6765 2e66 726f  orText2Image.fro
-00001010: 6d5f 7072 6574 7261 696e 6564 2870 7265  m_pretrained(pre
-00001020: 7472 6169 6e5f 6d6f 6465 6c2c 2074 6f72  train_model, tor
-00001030: 6368 5f64 7479 7065 3d74 6f72 6368 2e66  ch_dtype=torch.f
-00001040: 6c6f 6174 3136 2c20 7661 7269 616e 743d  loat16, variant=
-00001050: 2266 7031 3622 292e 746f 2827 6375 6461  "fp16").to('cuda
-00001060: 2729 0a0a 2320 2320 4f70 7469 6f6e 616c  ')..# # Optional
-00001070: 2e20 656e 6162 6c65 5f78 666f 726d 6572  . enable_xformer
-00001080: 735f 6d65 6d6f 7279 5f65 6666 6963 6965  s_memory_efficie
-00001090: 6e74 5f61 7474 656e 7469 6f6e 2063 616e  nt_attention can
-000010a0: 2073 6176 6520 6d65 6d6f 7279 2075 7361   save memory usa
-000010b0: 6765 2061 6e64 2069 6e63 7265 6173 6520  ge and increase 
-000010c0: 696e 6665 7265 6e63 6520 7370 6565 642e  inference speed.
-000010d0: 2065 6e61 626c 655f 6d6f 6465 6c5f 6370   enable_model_cp
-000010e0: 755f 6f66 666c 6f61 6420 616e 6420 656e  u_offload and en
-000010f0: 6162 6c65 5f76 6165 5f74 696c 696e 6720  able_vae_tiling 
-00001100: 6361 6e20 7361 7665 206d 656d 6f72 7920  can save memory 
-00001110: 7573 6167 652e 0a23 2070 6970 652e 656e  usage..# pipe.en
-00001120: 6162 6c65 5f78 666f 726d 6572 735f 6d65  able_xformers_me
-00001130: 6d6f 7279 5f65 6666 6963 6965 6e74 5f61  mory_efficient_a
-00001140: 7474 656e 7469 6f6e 2829 0a23 2070 6970  ttention().# pip
-00001150: 652e 656e 6162 6c65 5f6d 6f64 656c 5f63  e.enable_model_c
-00001160: 7075 5f6f 6666 6c6f 6164 2829 0a23 2070  pu_offload().# p
-00001170: 6970 652e 656e 6162 6c65 5f76 6165 5f74  ipe.enable_vae_t
-00001180: 696c 696e 6728 290a 0a23 2041 7070 6c79  iling()..# Apply
-00001190: 2068 6964 6966 6675 7369 6f6e 2077 6974   hidiffusion wit
-000011a0: 6820 6120 7369 6e67 6c65 206c 696e 6520  h a single line 
-000011b0: 6f66 2063 6f64 652e 0a61 7070 6c79 5f68  of code..apply_h
-000011c0: 6964 6966 6675 7369 6f6e 2870 6970 6529  idiffusion(pipe)
-000011d0: 0a0a 7072 6f6d 7074 203d 2022 496e 2074  ..prompt = "In t
-000011e0: 6865 2064 6570 7468 7320 6f66 2061 206d  he depths of a m
-000011f0: 7973 7469 6361 6c20 666f 7265 7374 2c20  ystical forest, 
-00001200: 6120 726f 626f 7469 6320 6f77 6c20 7769  a robotic owl wi
-00001210: 7468 206e 6967 6874 2076 6973 696f 6e20  th night vision 
-00001220: 6c65 6e73 6573 2066 6f72 2065 7965 7320  lenses for eyes 
-00001230: 7761 7463 6865 7320 6f76 6572 2074 6865  watches over the
-00001240: 206e 6f63 7475 726e 616c 2063 7265 6174   nocturnal creat
-00001250: 7572 6573 2e22 0a69 6d61 6765 203d 2070  ures.".image = p
-00001260: 6970 6528 7072 6f6d 7074 2c20 6e75 6d5f  ipe(prompt, num_
-00001270: 696e 6665 7265 6e63 655f 7374 6570 733d  inference_steps=
-00001280: 342c 2068 6569 6768 743d 3130 3234 2c20  4, height=1024, 
-00001290: 7769 6474 683d 3130 3234 2c20 6775 6964  width=1024, guid
-000012a0: 616e 6365 5f73 6361 6c65 3d30 2e30 292e  ance_scale=0.0).
-000012b0: 696d 6167 6573 5b30 5d0a 696d 6167 652e  images[0].image.
-000012c0: 7361 7665 2866 222e 2f6f 776c 2e6a 7067  save(f"./owl.jpg
-000012d0: 2229 0a60 6060 0a0a 3c64 6574 6169 6c73  ").```..<details
-000012e0: 3e0a 3c73 756d 6d61 7279 3e4f 7574 7075  >.<summary>Outpu
-000012f0: 743a 3c2f 7375 6d6d 6172 793e 0a3c 6469  t:</summary>.<di
-00001300: 7620 616c 6967 6e3d 2263 656e 7465 7222  v align="center"
-00001310: 3e0a 2020 3c69 6d67 2073 7263 3d22 6173  >.  <img src="as
-00001320: 7365 7473 2f73 6478 6c5f 7475 7262 6f2e  sets/sdxl_turbo.
-00001330: 6a70 6722 2077 6964 7468 3d22 3830 3022  jpg" width="800"
-00001340: 203e 3c2f 696d 673e 0a3c 2f64 6976 3e0a   ></img>.</div>.
-00001350: 3c2f 6465 7461 696c 733e 0a0a 2323 2320  </details>..### 
-00001360: 5374 6162 6c65 2044 6966 6675 7369 6f6e  Stable Diffusion
-00001370: 2076 322d 310a 0a60 6060 7079 7468 6f6e   v2-1..```python
-00001380: 0a66 726f 6d20 6869 6469 6666 7573 696f  .from hidiffusio
-00001390: 6e20 696d 706f 7274 2061 7070 6c79 5f68  n import apply_h
-000013a0: 6964 6966 6675 7369 6f6e 2c20 7265 6d6f  idiffusion, remo
-000013b0: 7665 5f68 6964 6966 6675 7369 6f6e 0a66  ve_hidiffusion.f
-000013c0: 726f 6d20 6469 6666 7573 6572 7320 696d  rom diffusers im
-000013d0: 706f 7274 2044 6966 6675 7369 6f6e 5069  port DiffusionPi
-000013e0: 7065 6c69 6e65 2c20 4444 494d 5363 6865  peline, DDIMSche
-000013f0: 6475 6c65 720a 696d 706f 7274 2074 6f72  duler.import tor
-00001400: 6368 0a70 7265 7472 6169 6e5f 6d6f 6465  ch.pretrain_mode
-00001410: 6c20 3d20 2273 7461 6269 6c69 7479 6169  l = "stabilityai
-00001420: 2f73 7461 626c 652d 6469 6666 7573 696f  /stable-diffusio
-00001430: 6e2d 322d 312d 6261 7365 220a 7363 6865  n-2-1-base".sche
-00001440: 6475 6c65 7220 3d20 4444 494d 5363 6865  duler = DDIMSche
-00001450: 6475 6c65 722e 6672 6f6d 5f70 7265 7472  duler.from_pretr
-00001460: 6169 6e65 6428 7072 6574 7261 696e 5f6d  ained(pretrain_m
-00001470: 6f64 656c 2c20 7375 6266 6f6c 6465 723d  odel, subfolder=
-00001480: 2273 6368 6564 756c 6572 2229 0a70 6970  "scheduler").pip
-00001490: 6520 3d20 4469 6666 7573 696f 6e50 6970  e = DiffusionPip
-000014a0: 656c 696e 652e 6672 6f6d 5f70 7265 7472  eline.from_pretr
-000014b0: 6169 6e65 6428 7072 6574 7261 696e 5f6d  ained(pretrain_m
-000014c0: 6f64 656c 2c20 7363 6865 6475 6c65 7220  odel, scheduler 
-000014d0: 3d20 7363 6865 6475 6c65 722c 2074 6f72  = scheduler, tor
-000014e0: 6368 5f64 7479 7065 3d74 6f72 6368 2e66  ch_dtype=torch.f
-000014f0: 6c6f 6174 3136 292e 746f 2822 6375 6461  loat16).to("cuda
-00001500: 2229 0a0a 2320 2320 4f70 7469 6f6e 616c  ")..# # Optional
-00001510: 2e20 656e 6162 6c65 5f78 666f 726d 6572  . enable_xformer
-00001520: 735f 6d65 6d6f 7279 5f65 6666 6963 6965  s_memory_efficie
-00001530: 6e74 5f61 7474 656e 7469 6f6e 2063 616e  nt_attention can
-00001540: 2073 6176 6520 6d65 6d6f 7279 2075 7361   save memory usa
-00001550: 6765 2061 6e64 2069 6e63 7265 6173 6520  ge and increase 
-00001560: 696e 6665 7265 6e63 6520 7370 6565 642e  inference speed.
-00001570: 2065 6e61 626c 655f 6d6f 6465 6c5f 6370   enable_model_cp
-00001580: 755f 6f66 666c 6f61 6420 616e 6420 656e  u_offload and en
-00001590: 6162 6c65 5f76 6165 5f74 696c 696e 6720  able_vae_tiling 
-000015a0: 6361 6e20 7361 7665 206d 656d 6f72 7920  can save memory 
-000015b0: 7573 6167 652e 0a23 2070 6970 652e 656e  usage..# pipe.en
-000015c0: 6162 6c65 5f78 666f 726d 6572 735f 6d65  able_xformers_me
-000015d0: 6d6f 7279 5f65 6666 6963 6965 6e74 5f61  mory_efficient_a
-000015e0: 7474 656e 7469 6f6e 2829 0a23 2070 6970  ttention().# pip
-000015f0: 652e 656e 6162 6c65 5f6d 6f64 656c 5f63  e.enable_model_c
-00001600: 7075 5f6f 6666 6c6f 6164 2829 0a23 2070  pu_offload().# p
-00001610: 6970 652e 656e 6162 6c65 5f76 6165 5f74  ipe.enable_vae_t
-00001620: 696c 696e 6728 290a 0a23 2041 7070 6c79  iling()..# Apply
-00001630: 2068 6964 6966 6675 7369 6f6e 2077 6974   hidiffusion wit
-00001640: 6820 6120 7369 6e67 6c65 206c 696e 6520  h a single line 
-00001650: 6f66 2063 6f64 652e 0a61 7070 6c79 5f68  of code..apply_h
-00001660: 6964 6966 6675 7369 6f6e 2870 6970 6529  idiffusion(pipe)
-00001670: 0a0a 7072 6f6d 7074 203d 2022 416e 2061  ..prompt = "An a
-00001680: 646f 7261 626c 6520 6861 7070 7920 6272  dorable happy br
-00001690: 6f77 6e20 626f 7264 6572 2063 6f6c 6c69  own border colli
-000016a0: 6520 7369 7474 696e 6720 6f6e 2061 2062  e sitting on a b
-000016b0: 6564 2c20 6869 6768 2064 6574 6169 6c2e  ed, high detail.
-000016c0: 220a 6e65 6761 7469 7665 5f70 726f 6d70  ".negative_promp
-000016d0: 7420 3d20 2275 676c 792c 2074 696c 696e  t = "ugly, tilin
-000016e0: 672c 206f 7574 206f 6620 6672 616d 652c  g, out of frame,
-000016f0: 2070 6f6f 726c 7920 6472 6177 6e20 6661   poorly drawn fa
-00001700: 6365 2c20 6578 7472 6120 6c69 6d62 732c  ce, extra limbs,
-00001710: 2064 6973 6669 6775 7265 642c 2064 6566   disfigured, def
-00001720: 6f72 6d65 642c 2062 6f64 7920 6f75 7420  ormed, body out 
-00001730: 6f66 2066 7261 6d65 2c20 626c 7572 7279  of frame, blurry
-00001740: 2c20 6261 6420 616e 6174 6f6d 792c 2062  , bad anatomy, b
-00001750: 6c75 7272 6564 2c20 6172 7469 6661 6374  lurred, artifact
-00001760: 732c 2062 6164 2070 726f 706f 7274 696f  s, bad proportio
-00001770: 6e73 2e22 0a69 6d61 6765 203d 2070 6970  ns.".image = pip
-00001780: 6528 7072 6f6d 7074 2c20 6775 6964 616e  e(prompt, guidan
-00001790: 6365 5f73 6361 6c65 3d37 2e35 2c20 6865  ce_scale=7.5, he
-000017a0: 6967 6874 3d31 3032 342c 2077 6964 7468  ight=1024, width
-000017b0: 3d31 3032 342c 2065 7461 3d31 2e30 2c20  =1024, eta=1.0, 
-000017c0: 6e65 6761 7469 7665 5f70 726f 6d70 743d  negative_prompt=
-000017d0: 6e65 6761 7469 7665 5f70 726f 6d70 7429  negative_prompt)
-000017e0: 2e69 6d61 6765 735b 305d 0a69 6d61 6765  .images[0].image
-000017f0: 2e73 6176 6528 6622 636f 6c6c 6965 2e6a  .save(f"collie.j
-00001800: 7067 2229 0a60 6060 0a0a 3c64 6574 6169  pg").```..<detai
-00001810: 6c73 3e0a 3c73 756d 6d61 7279 3e4f 7574  ls>.<summary>Out
-00001820: 7075 743a 3c2f 7375 6d6d 6172 793e 0a3c  put:</summary>.<
-00001830: 6469 7620 616c 6967 6e3d 2263 656e 7465  div align="cente
-00001840: 7222 3e0a 2020 3c69 6d67 2073 7263 3d22  r">.  <img src="
-00001850: 6173 7365 7473 2f73 6432 312e 6a70 6722  assets/sd21.jpg"
-00001860: 2077 6964 7468 3d22 3830 3022 203e 3c2f   width="800" ></
-00001870: 696d 673e 0a3c 2f64 6976 3e0a 3c2f 6465  img>.</div>.</de
-00001880: 7461 696c 733e 0a0a 5365 7420 6865 6967  tails>..Set heig
-00001890: 6874 203d 2032 3034 382c 2077 6964 7468  ht = 2048, width
-000018a0: 203d 2032 3034 382c 2061 6e64 2079 6f75   = 2048, and you
-000018b0: 2063 616e 2067 6574 206f 7574 7075 7420   can get output 
-000018c0: 7769 7468 2032 3034 3878 3230 3438 2072  with 2048x2048 r
-000018d0: 6573 6f6c 7574 696f 6e2e 0a0a 0a0a 2323  esolution.....##
-000018e0: 2320 5374 6162 6c65 2044 6966 6675 7369  # Stable Diffusi
-000018f0: 6f6e 2076 312d 350a 0a60 6060 7079 7468  on v1-5..```pyth
-00001900: 6f6e 0a66 726f 6d20 6869 6469 6666 7573  on.from hidiffus
-00001910: 696f 6e20 696d 706f 7274 2061 7070 6c79  ion import apply
-00001920: 5f68 6964 6966 6675 7369 6f6e 2c20 7265  _hidiffusion, re
-00001930: 6d6f 7665 5f68 6964 6966 6675 7369 6f6e  move_hidiffusion
-00001940: 0a66 726f 6d20 6469 6666 7573 6572 7320  .from diffusers 
-00001950: 696d 706f 7274 2044 6966 6675 7369 6f6e  import Diffusion
-00001960: 5069 7065 6c69 6e65 2c20 4444 494d 5363  Pipeline, DDIMSc
-00001970: 6865 6475 6c65 720a 696d 706f 7274 2074  heduler.import t
-00001980: 6f72 6368 0a70 7265 7472 6169 6e5f 6d6f  orch.pretrain_mo
-00001990: 6465 6c20 3d20 2272 756e 7761 796d 6c2f  del = "runwayml/
-000019a0: 7374 6162 6c65 2d64 6966 6675 7369 6f6e  stable-diffusion
-000019b0: 2d76 312d 3522 0a73 6368 6564 756c 6572  -v1-5".scheduler
-000019c0: 203d 2044 4449 4d53 6368 6564 756c 6572   = DDIMScheduler
-000019d0: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
-000019e0: 2870 7265 7472 6169 6e5f 6d6f 6465 6c2c  (pretrain_model,
-000019f0: 2073 7562 666f 6c64 6572 3d22 7363 6865   subfolder="sche
-00001a00: 6475 6c65 7222 290a 7069 7065 203d 2044  duler").pipe = D
-00001a10: 6966 6675 7369 6f6e 5069 7065 6c69 6e65  iffusionPipeline
-00001a20: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
-00001a30: 2870 7265 7472 6169 6e5f 6d6f 6465 6c2c  (pretrain_model,
-00001a40: 2073 6368 6564 756c 6572 203d 2073 6368   scheduler = sch
-00001a50: 6564 756c 6572 2c20 746f 7263 685f 6474  eduler, torch_dt
-00001a60: 7970 653d 746f 7263 682e 666c 6f61 7431  ype=torch.float1
-00001a70: 3629 2e74 6f28 2263 7564 6122 290a 0a23  6).to("cuda")..#
-00001a80: 2023 204f 7074 696f 6e61 6c2e 2065 6e61   # Optional. ena
-00001a90: 626c 655f 7866 6f72 6d65 7273 5f6d 656d  ble_xformers_mem
-00001aa0: 6f72 795f 6566 6669 6369 656e 745f 6174  ory_efficient_at
-00001ab0: 7465 6e74 696f 6e20 6361 6e20 7361 7665  tention can save
-00001ac0: 206d 656d 6f72 7920 7573 6167 6520 616e   memory usage an
-00001ad0: 6420 696e 6372 6561 7365 2069 6e66 6572  d increase infer
-00001ae0: 656e 6365 2073 7065 6564 2e20 656e 6162  ence speed. enab
-00001af0: 6c65 5f6d 6f64 656c 5f63 7075 5f6f 6666  le_model_cpu_off
-00001b00: 6c6f 6164 2061 6e64 2065 6e61 626c 655f  load and enable_
-00001b10: 7661 655f 7469 6c69 6e67 2063 616e 2073  vae_tiling can s
-00001b20: 6176 6520 6d65 6d6f 7279 2075 7361 6765  ave memory usage
-00001b30: 2e0a 2320 7069 7065 2e65 6e61 626c 655f  ..# pipe.enable_
-00001b40: 7866 6f72 6d65 7273 5f6d 656d 6f72 795f  xformers_memory_
-00001b50: 6566 6669 6369 656e 745f 6174 7465 6e74  efficient_attent
-00001b60: 696f 6e28 290a 2320 7069 7065 2e65 6e61  ion().# pipe.ena
-00001b70: 626c 655f 6d6f 6465 6c5f 6370 755f 6f66  ble_model_cpu_of
-00001b80: 666c 6f61 6428 290a 2320 7069 7065 2e65  fload().# pipe.e
-00001b90: 6e61 626c 655f 7661 655f 7469 6c69 6e67  nable_vae_tiling
-00001ba0: 2829 0a0a 2320 4170 706c 7920 6869 6469  ()..# Apply hidi
-00001bb0: 6666 7573 696f 6e20 7769 7468 2061 2073  ffusion with a s
-00001bc0: 696e 676c 6520 6c69 6e65 206f 6620 636f  ingle line of co
-00001bd0: 6465 2e0a 6170 706c 795f 6869 6469 6666  de..apply_hidiff
-00001be0: 7573 696f 6e28 7069 7065 290a 0a70 726f  usion(pipe)..pro
-00001bf0: 6d70 7420 3d20 2274 6869 636b 2073 7472  mpt = "thick str
-00001c00: 6f6b 6573 2c20 6272 6967 6874 2063 6f6c  okes, bright col
-00001c10: 6f72 732c 2061 6e20 6578 6f74 6963 2066  ors, an exotic f
-00001c20: 6f78 2c20 6375 7465 2c20 6368 6962 6920  ox, cute, chibi 
-00001c30: 6b61 7761 6969 2e20 6465 7461 696c 6564  kawaii. detailed
-00001c40: 2066 7572 2c20 6879 7065 7264 6574 6169   fur, hyperdetai
-00001c50: 6c65 6420 2c20 6269 6720 7265 666c 6563  led , big reflec
-00001c60: 7469 7665 2065 7965 732c 2066 6169 7279  tive eyes, fairy
-00001c70: 7461 6c65 2c20 6172 7473 7461 7469 6f6e  tale, artstation
-00001c80: 2c63 656e 7465 7265 6420 636f 6d70 6f73  ,centered compos
-00001c90: 6974 696f 6e2c 2070 6572 6665 6374 2063  ition, perfect c
-00001ca0: 6f6d 706f 7369 7469 6f6e 2c20 6365 6e74  omposition, cent
-00001cb0: 6572 6564 2c20 7669 6272 616e 7420 636f  ered, vibrant co
-00001cc0: 6c6f 7273 2c20 6d75 7465 6420 636f 6c6f  lors, muted colo
-00001cd0: 7273 2c20 6869 6768 2064 6574 6169 6c65  rs, high detaile
-00001ce0: 642c 2038 6b2e 220a 6e65 6761 7469 7665  d, 8k.".negative
-00001cf0: 5f70 726f 6d70 7420 3d20 2275 676c 792c  _prompt = "ugly,
-00001d00: 2074 696c 696e 672c 2070 6f6f 726c 7920   tiling, poorly 
-00001d10: 6472 6177 6e20 6661 6365 2c20 6f75 7420  drawn face, out 
-00001d20: 6f66 2066 7261 6d65 2c20 6469 7366 6967  of frame, disfig
-00001d30: 7572 6564 2c20 6465 666f 726d 6564 2c20  ured, deformed, 
-00001d40: 626c 7572 7279 2c20 6261 6420 616e 6174  blurry, bad anat
-00001d50: 6f6d 792c 2062 6c75 7272 6564 2e22 0a69  omy, blurred.".i
-00001d60: 6d61 6765 203d 2070 6970 6528 7072 6f6d  mage = pipe(prom
-00001d70: 7074 2c20 6775 6964 616e 6365 5f73 6361  pt, guidance_sca
-00001d80: 6c65 3d37 2e35 2c20 6865 6967 6874 3d31  le=7.5, height=1
-00001d90: 3032 342c 2077 6964 7468 3d31 3032 342c  024, width=1024,
-00001da0: 2065 7461 3d31 2e30 2c20 6e65 6761 7469   eta=1.0, negati
-00001db0: 7665 5f70 726f 6d70 743d 6e65 6761 7469  ve_prompt=negati
-00001dc0: 7665 5f70 726f 6d70 7429 2e69 6d61 6765  ve_prompt).image
-00001dd0: 735b 305d 0a69 6d61 6765 2e73 6176 6528  s[0].image.save(
-00001de0: 6622 666f 782e 6a70 6722 290a 6060 600a  f"fox.jpg").```.
-00001df0: 0a3c 6465 7461 696c 733e 0a3c 7375 6d6d  .<details>.<summ
-00001e00: 6172 793e 4f75 7470 7574 3a3c 2f73 756d  ary>Output:</sum
-00001e10: 6d61 7279 3e0a 3c64 6976 2061 6c69 676e  mary>.<div align
-00001e20: 3d22 6365 6e74 6572 223e 0a20 203c 696d  ="center">.  <im
-00001e30: 6720 7372 633d 2261 7373 6574 732f 7364  g src="assets/sd
-00001e40: 3135 2e6a 7067 2220 7769 6474 683d 2238  15.jpg" width="8
-00001e50: 3030 2220 3e3c 2f69 6d67 3e0a 3c2f 6469  00" ></img>.</di
-00001e60: 763e 0a3c 2f64 6574 6169 6c73 3e0a 0a53  v>.</details>..S
-00001e70: 6574 2068 6569 6768 7420 3d20 3230 3438  et height = 2048
-00001e80: 2c20 7769 6474 6820 3d20 3230 3438 2c20  , width = 2048, 
-00001e90: 616e 6420 796f 7520 6361 6e20 6765 7420  and you can get 
-00001ea0: 6f75 7470 7574 2077 6974 6820 3230 3438  output with 2048
-00001eb0: 7832 3034 3820 7265 736f 6c75 7469 6f6e  x2048 resolution
-00001ec0: 2e0a 0a23 2323 2052 656d 6f76 6520 4869  ...### Remove Hi
-00001ed0: 4469 6666 7573 696f 6e0a 0a49 6620 796f  Diffusion..If yo
-00001ee0: 7520 7761 6e74 2074 6f20 7265 6d6f 7665  u want to remove
-00001ef0: 2048 6944 6969 6666 7573 696f 6e2c 2073   HiDiiffusion, s
-00001f00: 696d 706c 7920 7573 6520 6072 656d 6f76  imply use `remov
-00001f10: 655f 6869 6469 6666 7573 696f 6e28 7069  e_hidiffusion(pi
-00001f20: 7065 2960 2e0a 0a23 2320 436f 6e74 726f  pe)`...## Contro
-00001f30: 6c4e 6574 0a0a 6060 6070 7974 686f 6e0a  lNet..```python.
-00001f40: 6672 6f6d 2064 6966 6675 7365 7273 2069  from diffusers i
-00001f50: 6d70 6f72 7420 5374 6162 6c65 4469 6666  mport StableDiff
-00001f60: 7573 696f 6e58 4c43 6f6e 7472 6f6c 4e65  usionXLControlNe
-00001f70: 7450 6970 656c 696e 652c 2043 6f6e 7472  tPipeline, Contr
-00001f80: 6f6c 4e65 744d 6f64 656c 2c20 4444 494d  olNetModel, DDIM
-00001f90: 5363 6865 6475 6c65 720a 696d 706f 7274  Scheduler.import
-00001fa0: 206e 756d 7079 2061 7320 6e70 0a69 6d70   numpy as np.imp
-00001fb0: 6f72 7420 746f 7263 680a 696d 706f 7274  ort torch.import
-00001fc0: 2063 7632 0a66 726f 6d20 5049 4c20 696d   cv2.from PIL im
-00001fd0: 706f 7274 2049 6d61 6765 0a66 726f 6d20  port Image.from 
-00001fe0: 6869 6469 6666 7573 696f 6e20 696d 706f  hidiffusion impo
-00001ff0: 7274 2061 7070 6c79 5f68 6964 6966 6675  rt apply_hidiffu
-00002000: 7369 6f6e 2c20 7265 6d6f 7665 5f68 6964  sion, remove_hid
-00002010: 6966 6675 7369 6f6e 0a0a 2320 6c6f 6164  iffusion..# load
-00002020: 2059 6f73 6875 615f 4265 6e67 696f 2e6a   Yoshua_Bengio.j
-00002030: 7067 2069 6e20 7468 6520 6173 7365 7473  pg in the assets
-00002040: 2066 696c 652e 0a70 6174 6820 3d20 2759   file..path = 'Y
-00002050: 6f73 6875 615f 4265 6e67 696f 2e6a 7067  oshua_Bengio.jpg
-00002060: 270a 696d 6167 6520 3d20 496d 6167 652e  '.image = Image.
-00002070: 6f70 656e 2870 6174 6829 0a23 2067 6574  open(path).# get
-00002080: 2063 616e 6e79 2069 6d61 6765 0a69 6d61   canny image.ima
-00002090: 6765 203d 206e 702e 6172 7261 7928 696d  ge = np.array(im
-000020a0: 6167 6529 0a69 6d61 6765 203d 2063 7632  age).image = cv2
-000020b0: 2e43 616e 6e79 2869 6d61 6765 2c20 3130  .Canny(image, 10
-000020c0: 302c 2032 3030 290a 696d 6167 6520 3d20  0, 200).image = 
-000020d0: 696d 6167 655b 3a2c 203a 2c20 4e6f 6e65  image[:, :, None
-000020e0: 5d0a 696d 6167 6520 3d20 6e70 2e63 6f6e  ].image = np.con
-000020f0: 6361 7465 6e61 7465 285b 696d 6167 652c  catenate([image,
-00002100: 2069 6d61 6765 2c20 696d 6167 655d 2c20   image, image], 
-00002110: 6178 6973 3d32 290a 6361 6e6e 795f 696d  axis=2).canny_im
-00002120: 6167 6520 3d20 496d 6167 652e 6672 6f6d  age = Image.from
-00002130: 6172 7261 7928 696d 6167 6529 0a0a 2320  array(image)..# 
-00002140: 696e 6974 6961 6c69 7a65 2074 6865 206d  initialize the m
-00002150: 6f64 656c 7320 616e 6420 7069 7065 6c69  odels and pipeli
-00002160: 6e65 0a63 6f6e 7472 6f6c 6e65 745f 636f  ne.controlnet_co
-00002170: 6e64 6974 696f 6e69 6e67 5f73 6361 6c65  nditioning_scale
-00002180: 203d 2030 2e35 2020 2320 7265 636f 6d6d   = 0.5  # recomm
-00002190: 656e 6465 6420 666f 7220 676f 6f64 2067  ended for good g
-000021a0: 656e 6572 616c 697a 6174 696f 6e0a 636f  eneralization.co
-000021b0: 6e74 726f 6c6e 6574 203d 2043 6f6e 7472  ntrolnet = Contr
-000021c0: 6f6c 4e65 744d 6f64 656c 2e66 726f 6d5f  olNetModel.from_
-000021d0: 7072 6574 7261 696e 6564 280a 2020 2020  pretrained(.    
-000021e0: 2264 6966 6675 7365 7273 2f63 6f6e 7472  "diffusers/contr
-000021f0: 6f6c 6e65 742d 6361 6e6e 792d 7364 786c  olnet-canny-sdxl
-00002200: 2d31 2e30 222c 2074 6f72 6368 5f64 7479  -1.0", torch_dty
-00002210: 7065 3d74 6f72 6368 2e66 6c6f 6174 3136  pe=torch.float16
-00002220: 2c20 7661 7269 616e 743d 2266 7031 3622  , variant="fp16"
-00002230: 0a29 0a73 6368 6564 756c 6572 203d 2044  .).scheduler = D
-00002240: 4449 4d53 6368 6564 756c 6572 2e66 726f  DIMScheduler.fro
-00002250: 6d5f 7072 6574 7261 696e 6564 2822 7374  m_pretrained("st
-00002260: 6162 696c 6974 7961 692f 7374 6162 6c65  abilityai/stable
-00002270: 2d64 6966 6675 7369 6f6e 2d78 6c2d 6261  -diffusion-xl-ba
-00002280: 7365 2d31 2e30 222c 2073 7562 666f 6c64  se-1.0", subfold
-00002290: 6572 3d22 7363 6865 6475 6c65 7222 290a  er="scheduler").
-000022a0: 7069 7065 203d 2053 7461 626c 6544 6966  pipe = StableDif
-000022b0: 6675 7369 6f6e 584c 436f 6e74 726f 6c4e  fusionXLControlN
-000022c0: 6574 5069 7065 6c69 6e65 2e66 726f 6d5f  etPipeline.from_
-000022d0: 7072 6574 7261 696e 6564 280a 2020 2020  pretrained(.    
-000022e0: 2273 7461 6269 6c69 7479 6169 2f73 7461  "stabilityai/sta
-000022f0: 626c 652d 6469 6666 7573 696f 6e2d 786c  ble-diffusion-xl
-00002300: 2d62 6173 652d 312e 3022 2c20 636f 6e74  -base-1.0", cont
-00002310: 726f 6c6e 6574 3d63 6f6e 7472 6f6c 6e65  rolnet=controlne
-00002320: 742c 2074 6f72 6368 5f64 7479 7065 3d74  t, torch_dtype=t
-00002330: 6f72 6368 2e66 6c6f 6174 3136 2c0a 2020  orch.float16,.  
-00002340: 2020 7363 6865 6475 6c65 7220 3d20 7363    scheduler = sc
-00002350: 6865 6475 6c65 720a 290a 7069 7065 2e65  heduler.).pipe.e
-00002360: 6e61 626c 655f 6d6f 6465 6c5f 6370 755f  nable_model_cpu_
-00002370: 6f66 666c 6f61 6428 290a 7069 7065 2e65  offload().pipe.e
-00002380: 6e61 626c 655f 7866 6f72 6d65 7273 5f6d  nable_xformers_m
-00002390: 656d 6f72 795f 6566 6669 6369 656e 745f  emory_efficient_
-000023a0: 6174 7465 6e74 696f 6e28 290a 0a70 726f  attention()..pro
-000023b0: 6d70 7420 3d20 2261 207a 6f6d 6269 652c  mpt = "a zombie,
-000023c0: 2068 6967 6820 6661 6365 2064 6574 6169   high face detai
-000023d0: 6c2c 2068 6967 6820 6465 7461 696c 2c20  l, high detail, 
-000023e0: 6d75 7465 6420 636f 6c6f 722c 2038 6b22  muted color, 8k"
-000023f0: 0a6e 6567 6174 6976 655f 7072 6f6d 7074  .negative_prompt
-00002400: 203d 2022 626c 7572 7279 2c20 7567 6c79   = "blurry, ugly
-00002410: 2c20 6475 706c 6963 6174 652c 2070 6f6f  , duplicate, poo
-00002420: 726c 7920 6472 6177 6e2c 2064 6566 6f72  rly drawn, defor
-00002430: 6d65 642c 206d 6f73 6169 632c 2070 6f6f  med, mosaic, poo
-00002440: 726c 7920 6472 6177 6e20 7465 6574 682c  rly drawn teeth,
-00002450: 2064 7570 6c69 6361 7465 6420 7465 6574   duplicated teet
-00002460: 682e 220a 0a23 2041 7070 6c79 2068 6964  h."..# Apply hid
-00002470: 6966 6675 7369 6f6e 2077 6974 6820 6120  iffusion with a 
-00002480: 7369 6e67 6c65 206c 696e 6520 6f66 2063  single line of c
-00002490: 6f64 652e 0a61 7070 6c79 5f68 6964 6966  ode..apply_hidif
-000024a0: 6675 7369 6f6e 2870 6970 6529 0a0a 696d  fusion(pipe)..im
-000024b0: 6167 6520 3d20 7069 7065 280a 2020 2020  age = pipe(.    
-000024c0: 7072 6f6d 7074 2c20 636f 6e74 726f 6c6e  prompt, controln
-000024d0: 6574 5f63 6f6e 6469 7469 6f6e 696e 675f  et_conditioning_
-000024e0: 7363 616c 653d 636f 6e74 726f 6c6e 6574  scale=controlnet
-000024f0: 5f63 6f6e 6469 7469 6f6e 696e 675f 7363  _conditioning_sc
-00002500: 616c 652c 2069 6d61 6765 3d63 616e 6e79  ale, image=canny
-00002510: 5f69 6d61 6765 2c0a 2020 2020 6865 6967  _image,.    heig
-00002520: 6874 3d32 3034 382c 2077 6964 7468 3d32  ht=2048, width=2
-00002530: 3034 382c 2067 7569 6461 6e63 655f 7363  048, guidance_sc
-00002540: 616c 653d 372e 352c 206e 6567 6174 6976  ale=7.5, negativ
-00002550: 655f 7072 6f6d 7074 203d 206e 6567 6174  e_prompt = negat
-00002560: 6976 655f 7072 6f6d 7074 2c20 6574 613d  ive_prompt, eta=
-00002570: 312e 300a 292e 696d 6167 6573 5b30 5d0a  1.0.).images[0].
-00002580: 0a69 6d61 6765 2e73 6176 6528 277a 6f6d  .image.save('zom
-00002590: 6269 652e 6a70 6727 290a 6060 600a 0a3c  bie.jpg').```..<
-000025a0: 6465 7461 696c 733e 0a3c 7375 6d6d 6172  details>.<summar
-000025b0: 793e 4f75 7470 7574 3a3c 2f73 756d 6d61  y>Output:</summa
-000025c0: 7279 3e0a 3c64 6976 2061 6c69 676e 3d22  ry>.<div align="
-000025d0: 6365 6e74 6572 223e 0a20 203c 696d 6720  center">.  <img 
-000025e0: 7372 633d 2261 7373 6574 732f 636f 6e74  src="assets/cont
-000025f0: 726f 6c6e 6574 5f72 6573 756c 742e 6a70  rolnet_result.jp
-00002600: 6722 2077 6964 7468 3d22 3830 3022 203e  g" width="800" >
-00002610: 3c2f 696d 673e 0a3c 2f64 6976 3e0a 3c2f  </img>.</div>.</
-00002620: 6465 7461 696c 733e 0a0a 2323 2049 6e70  details>..## Inp
-00002630: 6169 6e74 696e 670a 0a60 6060 7079 7468  ainting..```pyth
-00002640: 6f6e 0a69 6d70 6f72 7420 746f 7263 680a  on.import torch.
-00002650: 6672 6f6d 2064 6966 6675 7365 7273 2069  from diffusers i
-00002660: 6d70 6f72 7420 4175 746f 5069 7065 6c69  mport AutoPipeli
-00002670: 6e65 466f 7249 6e70 6169 6e74 696e 672c  neForInpainting,
-00002680: 2044 4449 4d53 6368 6564 756c 6572 0a66   DDIMScheduler.f
-00002690: 726f 6d20 6469 6666 7573 6572 732e 7574  rom diffusers.ut
-000026a0: 696c 7320 696d 706f 7274 206c 6f61 645f  ils import load_
-000026b0: 696d 6167 650a 6672 6f6d 2068 6964 6966  image.from hidif
-000026c0: 6675 7369 6f6e 2069 6d70 6f72 7420 6170  fusion import ap
-000026d0: 706c 795f 6869 6469 6666 7573 696f 6e2c  ply_hidiffusion,
-000026e0: 2072 656d 6f76 655f 6869 6469 6666 7573   remove_hidiffus
-000026f0: 696f 6e0a 6672 6f6d 2050 494c 2069 6d70  ion.from PIL imp
-00002700: 6f72 7420 496d 6167 650a 0a73 6368 6564  ort Image..sched
-00002710: 756c 6572 203d 2044 4449 4d53 6368 6564  uler = DDIMSched
-00002720: 756c 6572 2e66 726f 6d5f 7072 6574 7261  uler.from_pretra
-00002730: 696e 6564 2822 7374 6162 696c 6974 7961  ined("stabilitya
-00002740: 692f 7374 6162 6c65 2d64 6966 6675 7369  i/stable-diffusi
-00002750: 6f6e 2d78 6c2d 6261 7365 2d31 2e30 222c  on-xl-base-1.0",
-00002760: 2073 7562 666f 6c64 6572 3d22 7363 6865   subfolder="sche
-00002770: 6475 6c65 7222 290a 7069 7065 6c69 6e65  duler").pipeline
-00002780: 203d 2041 7574 6f50 6970 656c 696e 6546   = AutoPipelineF
-00002790: 6f72 496e 7061 696e 7469 6e67 2e66 726f  orInpainting.fro
-000027a0: 6d5f 7072 6574 7261 696e 6564 280a 2020  m_pretrained(.  
-000027b0: 2020 2264 6966 6675 7365 7273 2f73 7461    "diffusers/sta
-000027c0: 626c 652d 6469 6666 7573 696f 6e2d 786c  ble-diffusion-xl
-000027d0: 2d31 2e30 2d69 6e70 6169 6e74 696e 672d  -1.0-inpainting-
-000027e0: 302e 3122 2c20 746f 7263 685f 6474 7970  0.1", torch_dtyp
-000027f0: 653d 746f 7263 682e 666c 6f61 7431 362c  e=torch.float16,
-00002800: 2076 6172 6961 6e74 3d22 6670 3136 222c   variant="fp16",
-00002810: 200a 2020 2020 7363 6865 6475 6c65 723d   .    scheduler=
-00002820: 7363 6865 6475 6c65 720a 290a 0a23 2041  scheduler.)..# A
-00002830: 7070 6c79 2068 6964 6966 6675 7369 6f6e  pply hidiffusion
-00002840: 2077 6974 6820 6120 7369 6e67 6c65 206c   with a single l
-00002850: 696e 6520 6f66 2063 6f64 652e 0a61 7070  ine of code..app
-00002860: 6c79 5f68 6964 6966 6675 7369 6f6e 2870  ly_hidiffusion(p
-00002870: 6970 656c 696e 6529 0a0a 7069 7065 6c69  ipeline)..pipeli
-00002880: 6e65 2e65 6e61 626c 655f 6d6f 6465 6c5f  ne.enable_model_
-00002890: 6370 755f 6f66 666c 6f61 6428 290a 2320  cpu_offload().# 
-000028a0: 7265 6d6f 7665 2066 6f6c 6c6f 7769 6e67  remove following
-000028b0: 206c 696e 6520 6966 2078 466f 726d 6572   line if xFormer
-000028c0: 7320 6973 206e 6f74 2069 6e73 7461 6c6c  s is not install
-000028d0: 6564 0a70 6970 656c 696e 652e 656e 6162  ed.pipeline.enab
-000028e0: 6c65 5f78 666f 726d 6572 735f 6d65 6d6f  le_xformers_memo
-000028f0: 7279 5f65 6666 6963 6965 6e74 5f61 7474  ry_efficient_att
-00002900: 656e 7469 6f6e 2829 0a0a 2320 6c6f 6164  ention()..# load
-00002910: 2062 6173 6520 616e 6420 6d61 736b 2069   base and mask i
-00002920: 6d61 6765 0a69 6d67 5f75 726c 203d 2022  mage.img_url = "
-00002930: 6874 7470 733a 2f2f 6875 6767 696e 6766  https://huggingf
-00002940: 6163 652e 636f 2f64 6174 6173 6574 732f  ace.co/datasets/
-00002950: 6875 6767 696e 6766 6163 652f 646f 6375  huggingface/docu
-00002960: 6d65 6e74 6174 696f 6e2d 696d 6167 6573  mentation-images
-00002970: 2f72 6573 6f6c 7665 2f6d 6169 6e2f 6469  /resolve/main/di
-00002980: 6666 7573 6572 732f 7364 786c 2d74 6578  ffusers/sdxl-tex
-00002990: 7432 696d 672e 706e 6722 0a69 6e69 745f  t2img.png".init_
-000029a0: 696d 6167 6520 3d20 6c6f 6164 5f69 6d61  image = load_ima
-000029b0: 6765 2869 6d67 5f75 726c 290a 2320 6c6f  ge(img_url).# lo
-000029c0: 6164 206d 6173 6b5f 696d 6167 652e 6a70  ad mask_image.jp
-000029d0: 6720 696e 2074 6865 2061 7373 6574 7320  g in the assets 
-000029e0: 6669 6c65 2e0a 6d61 736b 5f69 6d61 6765  file..mask_image
-000029f0: 203d 2049 6d61 6765 2e6f 7065 6e28 226d   = Image.open("m
-00002a00: 6173 6b5f 696d 6167 652e 706e 6722 290a  ask_image.png").
-00002a10: 0a70 726f 6d70 7420 3d20 2022 4120 7374  .prompt =  "A st
-00002a20: 6561 6d70 756e 6b20 6578 706c 6f72 6572  eampunk explorer
-00002a30: 2069 6e20 6120 6c65 6174 6865 7220 6176   in a leather av
-00002a40: 6961 746f 7220 6361 7020 616e 6420 676f  iator cap and go
-00002a50: 6767 6c65 732c 2077 6974 6820 6120 6272  ggles, with a br
-00002a60: 6173 7320 7465 6c65 7363 6f70 6520 696e  ass telescope in
-00002a70: 2068 616e 642c 2073 7461 6e64 7320 616d   hand, stands am
-00002a80: 6964 7374 2074 6f77 6572 696e 6720 616e  idst towering an
-00002a90: 6369 656e 7420 7472 6565 732c 2074 6865  cient trees, the
-00002aa0: 6972 2072 6f6f 7473 2065 6e74 7769 6e65  ir roots entwine
-00002ab0: 6420 7769 7468 2069 6e74 7269 6361 7465  d with intricate
-00002ac0: 2067 6561 7273 2061 6e64 2070 6970 6573   gears and pipes
-00002ad0: 2e22 0a0a 6e65 6761 7469 7665 5f70 726f  ."..negative_pro
-00002ae0: 6d70 7420 3d20 2262 6c75 7272 792c 2075  mpt = "blurry, u
-00002af0: 676c 792c 2064 7570 6c69 6361 7465 2c20  gly, duplicate, 
-00002b00: 706f 6f72 6c79 2064 7261 776e 2c20 6465  poorly drawn, de
-00002b10: 666f 726d 6564 2c20 6d6f 7361 6963 220a  formed, mosaic".
-00002b20: 696d 6167 6520 3d20 7069 7065 6c69 6e65  image = pipeline
-00002b30: 2870 726f 6d70 743d 7072 6f6d 7074 2c20  (prompt=prompt, 
-00002b40: 696d 6167 653d 696e 6974 5f69 6d61 6765  image=init_image
-00002b50: 2c20 6d61 736b 5f69 6d61 6765 3d6d 6173  , mask_image=mas
-00002b60: 6b5f 696d 6167 652c 2068 6569 6768 743d  k_image, height=
-00002b70: 3230 3438 2c20 7769 6474 683d 3230 3438  2048, width=2048
-00002b80: 2c20 7374 7265 6e67 7468 3d30 2e38 352c  , strength=0.85,
-00002b90: 2067 7569 6461 6e63 655f 7363 616c 653d   guidance_scale=
-00002ba0: 3132 2e35 2c20 6e65 6761 7469 7665 5f70  12.5, negative_p
-00002bb0: 726f 6d70 7420 3d20 6e65 6761 7469 7665  rompt = negative
-00002bc0: 5f70 726f 6d70 742c 2065 7461 3d31 2e30  _prompt, eta=1.0
-00002bd0: 292e 696d 6167 6573 5b30 5d0a 696d 6167  ).images[0].imag
-00002be0: 652e 7361 7665 2827 7374 6561 6d70 756e  e.save('steampun
-00002bf0: 6b5f 6578 706c 6f72 6572 2e6a 7067 2729  k_explorer.jpg')
-00002c00: 0a60 6060 0a0a 3c64 6574 6169 6c73 3e0a  .```..<details>.
-00002c10: 3c73 756d 6d61 7279 3e4f 7574 7075 743a  <summary>Output:
-00002c20: 3c2f 7375 6d6d 6172 793e 0a3c 6469 7620  </summary>.<div 
-00002c30: 616c 6967 6e3d 2263 656e 7465 7222 3e0a  align="center">.
-00002c40: 2020 3c69 6d67 2073 7263 3d22 6173 7365    <img src="asse
-00002c50: 7473 2f69 6e70 6169 6e74 696e 675f 7265  ts/inpainting_re
-00002c60: 7375 6c74 2e6a 7067 2220 7769 6474 683d  sult.jpg" width=
-00002c70: 2238 3030 2220 3e3c 2f69 6d67 3e0a 3c2f  "800" ></img>.</
-00002c80: 6469 763e 0a3c 2f64 6574 6169 6c73 3e0a  div>.</details>.
-00002c90: 0a23 2320 f09f 998f 2041 636b 6e6f 776c  .## .... Acknowl
-00002ca0: 6564 6765 6d65 6e74 730a 0a54 6869 7320  edgements..This 
-00002cb0: 696d 706c 656d 656e 7461 7469 6f6e 2069  implementation i
-00002cc0: 7320 6261 7365 6420 6f6e 205b 746f 6d65  s based on [tome
-00002cd0: 7364 5d28 6874 7470 733a 2f2f 6769 7468  sd](https://gith
-00002ce0: 7562 2e63 6f6d 2f64 626f 6c79 612f 746f  ub.com/dbolya/to
-00002cf0: 6d65 7364 2920 616e 6420 5b64 6966 6675  mesd) and [diffu
-00002d00: 7365 7273 5d28 6874 7470 733a 2f2f 6769  sers](https://gi
-00002d10: 7468 7562 2e63 6f6d 2f68 7567 6769 6e67  thub.com/hugging
-00002d20: 6661 6365 2f64 6966 6675 7365 7273 2f74  face/diffusers/t
-00002d30: 7265 652f 6d61 696e 292e 2054 6861 6e6b  ree/main). Thank
-00002d40: 7321 0a0a 0a0a 2323 20f0 9f8e 9320 4369  s!....## .... Ci
-00002d50: 7461 7469 6f6e 0a0a 6060 600a 4061 7274  tation..```.@art
-00002d60: 6963 6c65 7b7a 6861 6e67 3230 3233 6869  icle{zhang2023hi
-00002d70: 6469 6666 7573 696f 6e2c 0a20 2074 6974  diffusion,.  tit
-00002d80: 6c65 3d7b 4869 4469 6666 7573 696f 6e3a  le={HiDiffusion:
-00002d90: 2055 6e6c 6f63 6b69 6e67 2048 6967 6865   Unlocking Highe
-00002da0: 722d 5265 736f 6c75 7469 6f6e 2043 7265  r-Resolution Cre
-00002db0: 6174 6976 6974 7920 616e 6420 4566 6669  ativity and Effi
-00002dc0: 6369 656e 6379 2069 6e20 5072 6574 7261  ciency in Pretra
-00002dd0: 696e 6564 2044 6966 6675 7369 6f6e 204d  ined Diffusion M
-00002de0: 6f64 656c 737d 2c0a 2020 6175 7468 6f72  odels},.  author
-00002df0: 3d7b 5a68 616e 672c 2053 6865 6e20 616e  ={Zhang, Shen an
-00002e00: 6420 4368 656e 2c20 5a68 616f 7765 6920  d Chen, Zhaowei 
-00002e10: 616e 6420 5a68 616f 2c20 5a68 656e 7975  and Zhao, Zhenyu
-00002e20: 2061 6e64 2043 6865 6e2c 2059 7568 616f   and Chen, Yuhao
-00002e30: 2061 6e64 2054 616e 672c 2059 616f 2061   and Tang, Yao a
-00002e40: 6e64 204c 6961 6e67 2c20 4a69 616a 756e  nd Liang, Jiajun
-00002e50: 7d2c 0a20 206a 6f75 726e 616c 3d7b 6172  },.  journal={ar
-00002e60: 5869 7620 7072 6570 7269 6e74 2061 7258  Xiv preprint arX
-00002e70: 6976 3a32 3331 312e 3137 3532 387d 2c0a  iv:2311.17528},.
-00002e80: 2020 7965 6172 3d7b 3230 3233 7d0a 7d0a    year={2023}.}.
-00002e90: 6060 600a                                ```.
+00000000: 3c21 2d2d 2023 20f0 9f92 a120 4869 4469  <!-- # .... HiDi
+00000010: 6666 7573 696f 6e20 2d2d 3e0a 0a23 2323  ffusion -->..###
+00000020: 203c 6469 7620 616c 6967 6e3d 2263 656e   <div align="cen
+00000030: 7465 7222 3ef0 9f92 a120 4869 4469 6666  ter">.... HiDiff
+00000040: 7573 696f 6e3a 2055 6e6c 6f63 6b69 6e67  usion: Unlocking
+00000050: 2048 6967 6865 722d 5265 736f 6c75 7469   Higher-Resoluti
+00000060: 6f6e 2043 7265 6174 6976 6974 7920 616e  on Creativity an
+00000070: 6420 4566 6669 6369 656e 6379 2069 6e20  d Efficiency in 
+00000080: 5072 6574 7261 696e 6564 2044 6966 6675  Pretrained Diffu
+00000090: 7369 6f6e 204d 6f64 656c 733c 2f64 6976  sion Models</div
+000000a0: 3e20 0a0a 3c64 6976 2061 6c69 676e 3d22  > ..<div align="
+000000b0: 6365 6e74 6572 223e 5368 656e 205a 6861  center">Shen Zha
+000000c0: 6e67 2c20 5a68 616f 7765 6920 4368 656e  ng, Zhaowei Chen
+000000d0: 2c20 5a68 656e 7975 205a 6861 6f2c 2059  , Zhenyu Zhao, Y
+000000e0: 7568 616f 2043 6865 6e2c 2059 616f 2054  uhao Chen, Yao T
+000000f0: 616e 672c 204a 6961 6a75 6e20 4c69 616e  ang, Jiajun Lian
+00000100: 673c 2f64 6976 3e20 0a0a 3c62 723e 0a0a  g</div> ..<br>..
+00000110: 3c64 6976 2061 6c69 676e 3d22 6365 6e74  <div align="cent
+00000120: 6572 223e 0a20 203c 6120 6872 6566 3d22  er">.  <a href="
+00000130: 6874 7470 733a 2f2f 6869 6469 6666 7573  https://hidiffus
+00000140: 696f 6e2e 6769 7468 7562 2e69 6f2f 223e  ion.github.io/">
+00000150: 3c69 6d67 2073 7263 3d22 6874 7470 733a  <img src="https:
+00000160: 2f2f 696d 672e 7368 6965 6c64 732e 696f  //img.shields.io
+00000170: 2f73 7461 7469 632f 7631 3f6c 6162 656c  /static/v1?label
+00000180: 3d50 726f 6a65 6374 2532 3050 6167 6526  =Project%20Page&
+00000190: 6d65 7373 6167 653d 4769 7468 7562 2663  message=Github&c
+000001a0: 6f6c 6f72 3d62 6c75 6526 6c6f 676f 3d67  olor=blue&logo=g
+000001b0: 6974 6875 622d 7061 6765 7322 3e3c 2f61  ithub-pages"></a
+000001c0: 3e20 2665 6e73 703b 0a20 203c 6120 6872  > &ensp;.  <a hr
+000001d0: 6566 3d22 6874 7470 733a 2f2f 6172 7869  ef="https://arxi
+000001e0: 762e 6f72 672f 6162 732f 3233 3131 2e31  v.org/abs/2311.1
+000001f0: 3735 3238 223e 3c69 6d67 2073 7263 3d22  7528"><img src="
+00000200: 6874 7470 733a 2f2f 696d 672e 7368 6965  https://img.shie
+00000210: 6c64 732e 696f 2f73 7461 7469 632f 7631  lds.io/static/v1
+00000220: 3f6c 6162 656c 3d50 6170 6572 266d 6573  ?label=Paper&mes
+00000230: 7361 6765 3d41 7278 6976 3a48 6944 6966  sage=Arxiv:HiDif
+00000240: 6675 7369 6f6e 2663 6f6c 6f72 3d72 6564  fusion&color=red
+00000250: 266c 6f67 6f3d 6172 7869 7622 3e3c 2f61  &logo=arxiv"></a
+00000260: 3e20 2665 6e73 703b 0a20 203c 6120 6872  > &ensp;.  <a hr
+00000270: 6566 3d22 6874 7470 733a 2f2f 636f 6c61  ef="https://cola
+00000280: 622e 7265 7365 6172 6368 2e67 6f6f 676c  b.research.googl
+00000290: 652e 636f 6d2f 6472 6976 652f 3145 6942  e.com/drive/1EiB
+000002a0: 6e39 6c53 6e50 5a54 5534 6369 6b52 5261  n9lSnPZTU4cikRRa
+000002b0: 4242 6578 7334 3239 4d2d 7174 793f 7573  BBexs429M-qty?us
+000002c0: 703d 7368 6172 696e 6722 3e3c 696d 6720  p=sharing"><img 
+000002d0: 7372 633d 2268 7474 7073 3a2f 2f69 6d67  src="https://img
+000002e0: 2e73 6869 656c 6473 2e69 6f2f 7374 6174  .shields.io/stat
+000002f0: 6963 2f76 313f 6c61 6265 6c3d 4465 6d6f  ic/v1?label=Demo
+00000300: 266d 6573 7361 6765 3d43 6f6c 6162 2663  &message=Colab&c
+00000310: 6f6c 6f72 3d70 7572 706c 6526 6c6f 676f  olor=purple&logo
+00000320: 3d67 6f6f 676c 6563 6f6c 6162 223e 3c2f  =googlecolab"></
+00000330: 613e 2026 656e 7370 3b0a 3c2f 6469 763e  a> &ensp;.</div>
+00000340: 0a0a 3c64 6976 2061 6c69 676e 3d22 6365  ..<div align="ce
+00000350: 6e74 6572 223e 0a20 203c 696d 6720 7372  nter">.  <img sr
+00000360: 633d 2261 7373 6574 732f 696d 6167 655f  c="assets/image_
+00000370: 6761 6c6c 6572 792e 6a70 6722 2077 6964  gallery.jpg" wid
+00000380: 7468 3d22 3830 3022 203e 3c2f 696d 673e  th="800" ></img>
+00000390: 0a20 203c 6272 3e0a 2020 3c65 6d3e 0a20  .  <br>.  <em>. 
+000003a0: 2020 2020 2028 5365 6c65 6374 2048 6944       (Select HiD
+000003b0: 6966 6675 7369 6f6e 2073 616d 706c 6573  iffusion samples
+000003c0: 2066 6f72 2076 6172 696f 7573 2064 6966   for various dif
+000003d0: 6675 7369 6f6e 206d 6f64 656c 732c 2072  fusion models, r
+000003e0: 6573 6f6c 7574 696f 6e73 2c20 616e 6420  esolutions, and 
+000003f0: 6173 7065 6374 2072 6174 696f 732e 2920  aspect ratios.) 
+00000400: 0a20 203c 2f65 6d3e 0a3c 2f64 6976 3e0a  .  </em>.</div>.
+00000410: 3c62 723e 0a0a 0a23 20f0 9f91 8920 5768  <br>...# .... Wh
+00000420: 7920 4869 4469 6666 7573 696f 6e0a 0a2d  y HiDiffusion..-
+00000430: 2041 2020 2a2a 7472 6169 6e69 6e67 2d66   A  **training-f
+00000440: 7265 6520 6d65 7468 6f64 2074 6861 7420  ree method that 
+00000450: 696e 6372 6561 7365 7320 7468 6520 7265  increases the re
+00000460: 736f 6c75 7469 6f6e 2061 6e64 2073 7065  solution and spe
+00000470: 6564 206f 6620 7072 6574 7261 696e 6564  ed of pretrained
+00000480: 2064 6966 6675 7369 6f6e 206d 6f64 656c   diffusion model
+00000490: 732e 2a2a 0a2d 2044 6573 6967 6e65 6420  s.**.- Designed 
+000004a0: 6173 2061 202a 2a70 6c75 672d 616e 642d  as a **plug-and-
+000004b0: 706c 6179 2069 6d70 6c65 6d65 6e74 6174  play implementat
+000004c0: 696f 6e2a 2a2e 2049 7420 6361 6e20 6265  ion**. It can be
+000004d0: 2069 6e74 6567 7261 7465 6420 696e 746f   integrated into
+000004e0: 2064 6966 6675 7369 6f6e 2070 6970 656c   diffusion pipel
+000004f0: 696e 6573 2062 7920 2a2a 6f6e 6c79 2061  ines by **only a
+00000500: 6464 696e 6720 6120 7369 6e67 6c65 206c  dding a single l
+00000510: 696e 6520 6f66 2063 6f64 652a 2a21 0a0a  ine of code**!..
+00000520: 3c64 6976 2061 6c69 676e 3d22 6365 6e74  <div align="cent
+00000530: 6572 223e 0a20 203c 696d 6720 7372 633d  er">.  <img src=
+00000540: 2261 7373 6574 732f 7175 616c 6974 795f  "assets/quality_
+00000550: 6566 6669 6369 656e 6379 2e6a 7067 2220  efficiency.jpg" 
+00000560: 7769 6474 683d 2238 3030 2220 3e3c 2f69  width="800" ></i
+00000570: 6d67 3e0a 2020 3c62 723e 0a20 203c 656d  mg>.  <br>.  <em
+00000580: 3e0a 2020 2020 2020 2846 6173 7465 722c  >.      (Faster,
+00000590: 2061 6e64 2062 6574 7465 7220 696d 6167   and better imag
+000005a0: 6520 6465 7461 696c 732e 2920 0a20 203c  e details.) .  <
+000005b0: 2f65 6d3e 0a3c 2f64 6976 3e0a 3c62 723e  /em>.</div>.<br>
+000005c0: 0a0a 2323 20f0 9f93 a220 5375 7070 6f72  ..## .... Suppor
+000005d0: 7465 6420 4d6f 6465 6c73 0a0a 2d20 e29c  ted Models..- ..
+000005e0: 8520 5b53 7461 626c 6520 4469 6666 7573  . [Stable Diffus
+000005f0: 696f 6e20 584c 5d28 6874 7470 733a 2f2f  ion XL](https://
+00000600: 6875 6767 696e 6766 6163 652e 636f 2f70  huggingface.co/p
+00000610: 6170 6572 732f 3233 3037 2e30 3139 3532  apers/2307.01952
+00000620: 290a 2d20 e29c 8520 5b53 7461 626c 6520  ).- ... [Stable 
+00000630: 4469 6666 7573 696f 6e20 584c 2054 7572  Diffusion XL Tur
+00000640: 626f 5d28 6874 7470 733a 2f2f 6875 6767  bo](https://hugg
+00000650: 696e 6766 6163 652e 636f 2f73 7461 6269  ingface.co/stabi
+00000660: 6c69 7479 6169 2f73 6478 6c2d 7475 7262  lityai/sdxl-turb
+00000670: 6f29 0a2d 20e2 9c85 205b 5374 6162 6c65  o).- ... [Stable
+00000680: 2044 6966 6675 7369 6f6e 2076 325d 2868   Diffusion v2](h
+00000690: 7474 7073 3a2f 2f68 7567 6769 6e67 6661  ttps://huggingfa
+000006a0: 6365 2e63 6f2f 7374 6162 696c 6974 7961  ce.co/stabilitya
+000006b0: 692f 7374 6162 6c65 2d64 6966 6675 7369  i/stable-diffusi
+000006c0: 6f6e 2d32 2d31 290a 2d20 e29c 8520 5b53  on-2-1).- ... [S
+000006d0: 7461 626c 6520 4469 6666 7573 696f 6e20  table Diffusion 
+000006e0: 7631 5d28 6874 7470 733a 2f2f 6875 6767  v1](https://hugg
+000006f0: 696e 6766 6163 652e 636f 2f72 756e 7761  ingface.co/runwa
+00000700: 796d 6c2f 7374 6162 6c65 2d64 6966 6675  yml/stable-diffu
+00000710: 7369 6f6e 2d76 312d 3529 0a0a 2a2a 4e6f  sion-v1-5)..**No
+00000720: 7465 2a2a 3a20 4869 4469 6666 7573 696f  te**: HiDiffusio
+00000730: 6e20 616c 736f 2073 7570 706f 7274 7320  n also supports 
+00000740: 7468 6520 646f 776e 7374 7265 616d 2064  the downstream d
+00000750: 6966 6675 7369 6f6e 206d 6f64 656c 7320  iffusion models 
+00000760: 6261 7365 6420 6f6e 2074 6865 7365 2072  based on these r
+00000770: 6570 6f73 6974 6f72 6965 732c 2073 7563  epositories, suc
+00000780: 6820 6173 205b 4768 6962 6c69 2d44 6966  h as [Ghibli-Dif
+00000790: 6675 7369 6f6e 5d28 6874 7470 733a 2f2f  fusion](https://
+000007a0: 6875 6767 696e 6766 6163 652e 636f 2f6e  huggingface.co/n
+000007b0: 6974 726f 736f 636b 652f 4768 6962 6c69  itrosocke/Ghibli
+000007c0: 2d44 6966 6675 7369 6f6e 292c 205b 506c  -Diffusion), [Pl
+000007d0: 6179 6772 6f75 6e64 5d28 6874 7470 733a  ayground](https:
+000007e0: 2f2f 6875 6767 696e 6766 6163 652e 636f  //huggingface.co
+000007f0: 2f70 6c61 7967 726f 756e 6461 692f 706c  /playgroundai/pl
+00000800: 6179 6772 6f75 6e64 2d76 322d 3130 3234  ayground-v2-1024
+00000810: 7078 2d61 6573 7468 6574 6963 292c 2065  px-aesthetic), e
+00000820: 7463 2e0a 0a23 2320 f09f 92a3 2053 7570  tc...## .... Sup
+00000830: 706f 7274 6564 2054 6173 6b73 0a0a 2d20  ported Tasks..- 
+00000840: e29c 8520 5465 7874 2d74 6f2d 696d 6167  ... Text-to-imag
+00000850: 650a 2d20 e29c 8520 436f 6e74 726f 6c4e  e.- ... ControlN
+00000860: 6574 0a2d 20e2 9c85 2049 6e70 6169 6e74  et.- ... Inpaint
+00000870: 696e 670a 0a0a 2323 20f0 9f94 8e20 4d61  ing...## .... Ma
+00000880: 696e 2072 6571 7569 7265 6d65 6e74 730a  in requirements.
+00000890: 5468 6973 2072 6570 6f73 6974 6f72 7920  This repository 
+000008a0: 6973 2074 6573 7465 6420 6f6e 0a2a 2050  is tested on.* P
+000008b0: 7974 686f 6e3d 3d33 2e38 0a2a 2074 6f72  ython==3.8.* tor
+000008c0: 6368 3d3d 312e 3133 2e31 0a2a 2064 6966  ch==1.13.1.* dif
+000008d0: 6675 7365 7273 3d3d 302e 3237 2e30 0a2a  fusers==0.27.0.*
+000008e0: 2074 7261 6e73 666f 726d 6572 733d 3d34   transformers==4
+000008f0: 2e32 372e 340a 2a20 6163 6365 6c65 7261  .27.4.* accelera
+00000900: 7465 3d3d 302e 3138 2e30 0a2a 2078 666f  te==0.18.0.* xfo
+00000910: 726d 6572 733d 3d30 2e30 2e31 3672 6334  rmers==0.0.16rc4
+00000920: 3235 0a0a 2323 20f0 9f94 9120 496e 7374  25..## .... Inst
+00000930: 616c 6c20 4869 4469 6666 7573 696f 6e0a  all HiDiffusion.
+00000940: 4166 7465 7220 696e 7374 616c 6c69 6e67  After installing
+00000950: 2074 6865 2070 6163 6b61 6765 7320 696e   the packages in
+00000960: 2074 6865 206d 6169 6e20 7265 7175 6972   the main requir
+00000970: 656d 656e 7473 2c20 696e 7374 616c 6c20  ements, install 
+00000980: 4869 4469 6666 7573 696f 6e3a 0a60 6060  HiDiffusion:.```
+00000990: 7368 656c 6c0a 7069 7033 2069 6e73 7461  shell.pip3 insta
+000009a0: 6c6c 2068 6964 6966 6675 7369 6f6e 0a60  ll hidiffusion.`
+000009b0: 6060 0a23 2323 2049 6e73 7461 6c6c 696e  ``.### Installin
+000009c0: 6720 6672 6f6d 2073 6f75 7263 650a 416c  g from source.Al
+000009d0: 7465 726e 6174 6976 656c 792c 2079 6f75  ternatively, you
+000009e0: 2063 616e 2069 6e73 7461 6c6c 2066 726f   can install fro
+000009f0: 6d20 6769 7468 7562 2073 6f75 7263 652e  m github source.
+00000a00: 2043 6c6f 6e65 2074 6865 2072 6570 6f73   Clone the repos
+00000a10: 6974 6f72 7920 616e 6420 696e 7374 616c  itory and instal
+00000a20: 6c3a 0a60 6060 6261 7368 0a67 6974 2063  l:.```bash.git c
+00000a30: 6c6f 6e65 2068 7474 7073 3a2f 2f67 6974  lone https://git
+00000a40: 6875 622e 636f 6d2f 5368 656e 5a68 616e  hub.com/ShenZhan
+00000a50: 672d 5368 696e 2f48 6944 6966 6675 7369  g-Shin/HiDiffusi
+00000a60: 6f6e 2e67 6974 0a63 6420 4869 4469 6666  on.git.cd HiDiff
+00000a70: 7573 696f 6e0a 7079 7468 6f6e 3320 7365  usion.python3 se
+00000a80: 7475 702e 7079 2069 6e73 7461 6c6c 0a60  tup.py install.`
+00000a90: 6060 0a0a 0a23 2320 f09f 9a80 2055 7361  ``...## .... Usa
+00000aa0: 6765 0a0a 4765 6e65 7261 7469 6e67 206f  ge..Generating o
+00000ab0: 7574 7075 7473 2077 6974 6820 4869 4469  utputs with HiDi
+00000ac0: 6666 7573 696f 6e20 6973 2073 7570 6572  ffusion is super
+00000ad0: 2065 6173 7920 6261 7365 6420 6f6e 20f0   easy based on .
+00000ae0: 9fa4 9720 5b64 6966 6675 7365 7273 5d28  ... [diffusers](
+00000af0: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
+00000b00: 6f6d 2f68 7567 6769 6e67 6661 6365 2f64  om/huggingface/d
+00000b10: 6966 6675 7365 7273 2f74 7265 652f 6d61  iffusers/tree/ma
+00000b20: 696e 292e 0a0a 2323 2054 6578 742d 746f  in)...## Text-to
+00000b30: 2d69 6d61 6765 2067 656e 6572 6174 696f  -image generatio
+00000b40: 6e0a 0a23 2323 2053 7461 626c 6520 4469  n..### Stable Di
+00000b50: 6666 7573 696f 6e20 584c 0a0a 6060 6070  ffusion XL..```p
+00000b60: 7974 686f 6e0a 6672 6f6d 2068 6964 6966  ython.from hidif
+00000b70: 6675 7369 6f6e 2069 6d70 6f72 7420 6170  fusion import ap
+00000b80: 706c 795f 6869 6469 6666 7573 696f 6e2c  ply_hidiffusion,
+00000b90: 2072 656d 6f76 655f 6869 6469 6666 7573   remove_hidiffus
+00000ba0: 696f 6e0a 6672 6f6d 2064 6966 6675 7365  ion.from diffuse
+00000bb0: 7273 2069 6d70 6f72 7420 5374 6162 6c65  rs import Stable
+00000bc0: 4469 6666 7573 696f 6e58 4c50 6970 656c  DiffusionXLPipel
+00000bd0: 696e 652c 2044 4449 4d53 6368 6564 756c  ine, DDIMSchedul
+00000be0: 6572 0a69 6d70 6f72 7420 746f 7263 680a  er.import torch.
+00000bf0: 7072 6574 7261 696e 5f6d 6f64 656c 203d  pretrain_model =
+00000c00: 2022 7374 6162 696c 6974 7961 692f 7374   "stabilityai/st
+00000c10: 6162 6c65 2d64 6966 6675 7369 6f6e 2d78  able-diffusion-x
+00000c20: 6c2d 6261 7365 2d31 2e30 220a 7363 6865  l-base-1.0".sche
+00000c30: 6475 6c65 7220 3d20 4444 494d 5363 6865  duler = DDIMSche
+00000c40: 6475 6c65 722e 6672 6f6d 5f70 7265 7472  duler.from_pretr
+00000c50: 6169 6e65 6428 7072 6574 7261 696e 5f6d  ained(pretrain_m
+00000c60: 6f64 656c 2c20 7375 6266 6f6c 6465 723d  odel, subfolder=
+00000c70: 2273 6368 6564 756c 6572 2229 0a70 6970  "scheduler").pip
+00000c80: 6520 3d20 5374 6162 6c65 4469 6666 7573  e = StableDiffus
+00000c90: 696f 6e58 4c50 6970 656c 696e 652e 6672  ionXLPipeline.fr
+00000ca0: 6f6d 5f70 7265 7472 6169 6e65 6428 7072  om_pretrained(pr
+00000cb0: 6574 7261 696e 5f6d 6f64 656c 2c20 7363  etrain_model, sc
+00000cc0: 6865 6475 6c65 7220 3d20 7363 6865 6475  heduler = schedu
+00000cd0: 6c65 722c 2074 6f72 6368 5f64 7479 7065  ler, torch_dtype
+00000ce0: 3d74 6f72 6368 2e66 6c6f 6174 3136 2c20  =torch.float16, 
+00000cf0: 7661 7269 616e 743d 2266 7031 3622 292e  variant="fp16").
+00000d00: 746f 2822 6375 6461 2229 0a0a 2320 2320  to("cuda")..# # 
+00000d10: 4f70 7469 6f6e 616c 2e20 656e 6162 6c65  Optional. enable
+00000d20: 5f78 666f 726d 6572 735f 6d65 6d6f 7279  _xformers_memory
+00000d30: 5f65 6666 6963 6965 6e74 5f61 7474 656e  _efficient_atten
+00000d40: 7469 6f6e 2063 616e 2073 6176 6520 6d65  tion can save me
+00000d50: 6d6f 7279 2075 7361 6765 2061 6e64 2069  mory usage and i
+00000d60: 6e63 7265 6173 6520 696e 6665 7265 6e63  ncrease inferenc
+00000d70: 6520 7370 6565 642e 2065 6e61 626c 655f  e speed. enable_
+00000d80: 6d6f 6465 6c5f 6370 755f 6f66 666c 6f61  model_cpu_offloa
+00000d90: 6420 616e 6420 656e 6162 6c65 5f76 6165  d and enable_vae
+00000da0: 5f74 696c 696e 6720 6361 6e20 7361 7665  _tiling can save
+00000db0: 206d 656d 6f72 7920 7573 6167 652e 0a23   memory usage..#
+00000dc0: 2070 6970 652e 656e 6162 6c65 5f78 666f   pipe.enable_xfo
+00000dd0: 726d 6572 735f 6d65 6d6f 7279 5f65 6666  rmers_memory_eff
+00000de0: 6963 6965 6e74 5f61 7474 656e 7469 6f6e  icient_attention
+00000df0: 2829 0a23 2070 6970 652e 656e 6162 6c65  ().# pipe.enable
+00000e00: 5f6d 6f64 656c 5f63 7075 5f6f 6666 6c6f  _model_cpu_offlo
+00000e10: 6164 2829 0a23 2070 6970 652e 656e 6162  ad().# pipe.enab
+00000e20: 6c65 5f76 6165 5f74 696c 696e 6728 290a  le_vae_tiling().
+00000e30: 0a23 2041 7070 6c79 2068 6964 6966 6675  .# Apply hidiffu
+00000e40: 7369 6f6e 2077 6974 6820 6120 7369 6e67  sion with a sing
+00000e50: 6c65 206c 696e 6520 6f66 2063 6f64 652e  le line of code.
+00000e60: 0a61 7070 6c79 5f68 6964 6966 6675 7369  .apply_hidiffusi
+00000e70: 6f6e 2870 6970 6529 0a0a 7072 6f6d 7074  on(pipe)..prompt
+00000e80: 203d 2022 5374 616e 6469 6e67 2074 616c   = "Standing tal
+00000e90: 6c20 616d 6964 7374 2074 6865 2072 7569  l amidst the rui
+00000ea0: 6e73 2c20 6120 7374 6f6e 6520 676f 6c65  ns, a stone gole
+00000eb0: 6d20 6177 616b 656e 732c 2076 696e 6573  m awakens, vines
+00000ec0: 2061 6e64 2066 6c6f 7765 7273 2073 7072   and flowers spr
+00000ed0: 6f75 7469 6e67 2066 726f 6d20 7468 6520  outing from the 
+00000ee0: 6372 6576 6963 6573 2069 6e20 6974 7320  crevices in its 
+00000ef0: 626f 6479 2e22 0a6e 6567 6174 6976 655f  body.".negative_
+00000f00: 7072 6f6d 7074 203d 2022 626c 7572 7279  prompt = "blurry
+00000f10: 2c20 7567 6c79 2c20 6475 706c 6963 6174  , ugly, duplicat
+00000f20: 652c 2070 6f6f 726c 7920 6472 6177 6e20  e, poorly drawn 
+00000f30: 6661 6365 2c20 6465 666f 726d 6564 2c20  face, deformed, 
+00000f40: 6d6f 7361 6963 2c20 6172 7469 6661 6374  mosaic, artifact
+00000f50: 732c 2062 6164 206c 696d 6273 220a 696d  s, bad limbs".im
+00000f60: 6167 6520 3d20 7069 7065 2870 726f 6d70  age = pipe(promp
+00000f70: 742c 2067 7569 6461 6e63 655f 7363 616c  t, guidance_scal
+00000f80: 653d 372e 352c 2068 6569 6768 743d 3230  e=7.5, height=20
+00000f90: 3438 2c20 7769 6474 683d 3230 3438 2c20  48, width=2048, 
+00000fa0: 6574 613d 312e 302c 206e 6567 6174 6976  eta=1.0, negativ
+00000fb0: 655f 7072 6f6d 7074 3d6e 6567 6174 6976  e_prompt=negativ
+00000fc0: 655f 7072 6f6d 7074 292e 696d 6167 6573  e_prompt).images
+00000fd0: 5b30 5d0a 696d 6167 652e 7361 7665 2866  [0].image.save(f
+00000fe0: 2267 6f6c 656d 2e6a 7067 2229 0a60 6060  "golem.jpg").```
+00000ff0: 0a0a 3c64 6574 6169 6c73 3e0a 3c73 756d  ..<details>.<sum
+00001000: 6d61 7279 3e4f 7574 7075 743a 3c2f 7375  mary>Output:</su
+00001010: 6d6d 6172 793e 0a3c 6469 7620 616c 6967  mmary>.<div alig
+00001020: 6e3d 2263 656e 7465 7222 3e0a 2020 3c69  n="center">.  <i
+00001030: 6d67 2073 7263 3d22 6173 7365 7473 2f73  mg src="assets/s
+00001040: 6478 6c2e 6a70 6722 2077 6964 7468 3d22  dxl.jpg" width="
+00001050: 3830 3022 203e 3c2f 696d 673e 0a3c 2f64  800" ></img>.</d
+00001060: 6976 3e0a 3c2f 6465 7461 696c 733e 0a0a  iv>.</details>..
+00001070: 5365 7420 6865 6967 6874 203d 2034 3039  Set height = 409
+00001080: 362c 2077 6964 7468 203d 2034 3039 362c  6, width = 4096,
+00001090: 2061 6e64 2079 6f75 2063 616e 2067 6574   and you can get
+000010a0: 206f 7574 7075 7420 7769 7468 2034 3039   output with 409
+000010b0: 3678 3430 3936 2072 6573 6f6c 7574 696f  6x4096 resolutio
+000010c0: 6e2e 0a0a 2323 2320 5374 6162 6c65 2044  n...### Stable D
+000010d0: 6966 6675 7369 6f6e 2058 4c20 5475 7262  iffusion XL Turb
+000010e0: 6f0a 0a60 6060 7079 7468 6f6e 0a66 726f  o..```python.fro
+000010f0: 6d20 6869 6469 6666 7573 696f 6e20 696d  m hidiffusion im
+00001100: 706f 7274 2061 7070 6c79 5f68 6964 6966  port apply_hidif
+00001110: 6675 7369 6f6e 2c20 7265 6d6f 7665 5f68  fusion, remove_h
+00001120: 6964 6966 6675 7369 6f6e 0a66 726f 6d20  idiffusion.from 
+00001130: 6469 6666 7573 6572 7320 696d 706f 7274  diffusers import
+00001140: 2041 7574 6f50 6970 656c 696e 6546 6f72   AutoPipelineFor
+00001150: 5465 7874 3249 6d61 6765 0a69 6d70 6f72  Text2Image.impor
+00001160: 7420 746f 7263 680a 7072 6574 7261 696e  t torch.pretrain
+00001170: 5f6d 6f64 656c 203d 2022 7374 6162 696c  _model = "stabil
+00001180: 6974 7961 692f 7364 786c 2d74 7572 626f  ityai/sdxl-turbo
+00001190: 220a 7069 7065 203d 2041 7574 6f50 6970  ".pipe = AutoPip
+000011a0: 656c 696e 6546 6f72 5465 7874 3249 6d61  elineForText2Ima
+000011b0: 6765 2e66 726f 6d5f 7072 6574 7261 696e  ge.from_pretrain
+000011c0: 6564 2870 7265 7472 6169 6e5f 6d6f 6465  ed(pretrain_mode
+000011d0: 6c2c 2074 6f72 6368 5f64 7479 7065 3d74  l, torch_dtype=t
+000011e0: 6f72 6368 2e66 6c6f 6174 3136 2c20 7661  orch.float16, va
+000011f0: 7269 616e 743d 2266 7031 3622 292e 746f  riant="fp16").to
+00001200: 2827 6375 6461 2729 0a0a 2320 2320 4f70  ('cuda')..# # Op
+00001210: 7469 6f6e 616c 2e20 656e 6162 6c65 5f78  tional. enable_x
+00001220: 666f 726d 6572 735f 6d65 6d6f 7279 5f65  formers_memory_e
+00001230: 6666 6963 6965 6e74 5f61 7474 656e 7469  fficient_attenti
+00001240: 6f6e 2063 616e 2073 6176 6520 6d65 6d6f  on can save memo
+00001250: 7279 2075 7361 6765 2061 6e64 2069 6e63  ry usage and inc
+00001260: 7265 6173 6520 696e 6665 7265 6e63 6520  rease inference 
+00001270: 7370 6565 642e 2065 6e61 626c 655f 6d6f  speed. enable_mo
+00001280: 6465 6c5f 6370 755f 6f66 666c 6f61 6420  del_cpu_offload 
+00001290: 616e 6420 656e 6162 6c65 5f76 6165 5f74  and enable_vae_t
+000012a0: 696c 696e 6720 6361 6e20 7361 7665 206d  iling can save m
+000012b0: 656d 6f72 7920 7573 6167 652e 0a23 2070  emory usage..# p
+000012c0: 6970 652e 656e 6162 6c65 5f78 666f 726d  ipe.enable_xform
+000012d0: 6572 735f 6d65 6d6f 7279 5f65 6666 6963  ers_memory_effic
+000012e0: 6965 6e74 5f61 7474 656e 7469 6f6e 2829  ient_attention()
+000012f0: 0a23 2070 6970 652e 656e 6162 6c65 5f6d  .# pipe.enable_m
+00001300: 6f64 656c 5f63 7075 5f6f 6666 6c6f 6164  odel_cpu_offload
+00001310: 2829 0a23 2070 6970 652e 656e 6162 6c65  ().# pipe.enable
+00001320: 5f76 6165 5f74 696c 696e 6728 290a 0a23  _vae_tiling()..#
+00001330: 2041 7070 6c79 2068 6964 6966 6675 7369   Apply hidiffusi
+00001340: 6f6e 2077 6974 6820 6120 7369 6e67 6c65  on with a single
+00001350: 206c 696e 6520 6f66 2063 6f64 652e 0a61   line of code..a
+00001360: 7070 6c79 5f68 6964 6966 6675 7369 6f6e  pply_hidiffusion
+00001370: 2870 6970 6529 0a0a 7072 6f6d 7074 203d  (pipe)..prompt =
+00001380: 2022 496e 2074 6865 2064 6570 7468 7320   "In the depths 
+00001390: 6f66 2061 206d 7973 7469 6361 6c20 666f  of a mystical fo
+000013a0: 7265 7374 2c20 6120 726f 626f 7469 6320  rest, a robotic 
+000013b0: 6f77 6c20 7769 7468 206e 6967 6874 2076  owl with night v
+000013c0: 6973 696f 6e20 6c65 6e73 6573 2066 6f72  ision lenses for
+000013d0: 2065 7965 7320 7761 7463 6865 7320 6f76   eyes watches ov
+000013e0: 6572 2074 6865 206e 6f63 7475 726e 616c  er the nocturnal
+000013f0: 2063 7265 6174 7572 6573 2e22 0a69 6d61   creatures.".ima
+00001400: 6765 203d 2070 6970 6528 7072 6f6d 7074  ge = pipe(prompt
+00001410: 2c20 6e75 6d5f 696e 6665 7265 6e63 655f  , num_inference_
+00001420: 7374 6570 733d 342c 2068 6569 6768 743d  steps=4, height=
+00001430: 3130 3234 2c20 7769 6474 683d 3130 3234  1024, width=1024
+00001440: 2c20 6775 6964 616e 6365 5f73 6361 6c65  , guidance_scale
+00001450: 3d30 2e30 292e 696d 6167 6573 5b30 5d0a  =0.0).images[0].
+00001460: 696d 6167 652e 7361 7665 2866 222e 2f6f  image.save(f"./o
+00001470: 776c 2e6a 7067 2229 0a60 6060 0a0a 3c64  wl.jpg").```..<d
+00001480: 6574 6169 6c73 3e0a 3c73 756d 6d61 7279  etails>.<summary
+00001490: 3e4f 7574 7075 743a 3c2f 7375 6d6d 6172  >Output:</summar
+000014a0: 793e 0a3c 6469 7620 616c 6967 6e3d 2263  y>.<div align="c
+000014b0: 656e 7465 7222 3e0a 2020 3c69 6d67 2073  enter">.  <img s
+000014c0: 7263 3d22 6173 7365 7473 2f73 6478 6c5f  rc="assets/sdxl_
+000014d0: 7475 7262 6f2e 6a70 6722 2077 6964 7468  turbo.jpg" width
+000014e0: 3d22 3830 3022 203e 3c2f 696d 673e 0a3c  ="800" ></img>.<
+000014f0: 2f64 6976 3e0a 3c2f 6465 7461 696c 733e  /div>.</details>
+00001500: 0a0a 2323 2320 5374 6162 6c65 2044 6966  ..### Stable Dif
+00001510: 6675 7369 6f6e 2076 322d 310a 0a60 6060  fusion v2-1..```
+00001520: 7079 7468 6f6e 0a66 726f 6d20 6869 6469  python.from hidi
+00001530: 6666 7573 696f 6e20 696d 706f 7274 2061  ffusion import a
+00001540: 7070 6c79 5f68 6964 6966 6675 7369 6f6e  pply_hidiffusion
+00001550: 2c20 7265 6d6f 7665 5f68 6964 6966 6675  , remove_hidiffu
+00001560: 7369 6f6e 0a66 726f 6d20 6469 6666 7573  sion.from diffus
+00001570: 6572 7320 696d 706f 7274 2044 6966 6675  ers import Diffu
+00001580: 7369 6f6e 5069 7065 6c69 6e65 2c20 4444  sionPipeline, DD
+00001590: 494d 5363 6865 6475 6c65 720a 696d 706f  IMScheduler.impo
+000015a0: 7274 2074 6f72 6368 0a70 7265 7472 6169  rt torch.pretrai
+000015b0: 6e5f 6d6f 6465 6c20 3d20 2273 7461 6269  n_model = "stabi
+000015c0: 6c69 7479 6169 2f73 7461 626c 652d 6469  lityai/stable-di
+000015d0: 6666 7573 696f 6e2d 322d 312d 6261 7365  ffusion-2-1-base
+000015e0: 220a 7363 6865 6475 6c65 7220 3d20 4444  ".scheduler = DD
+000015f0: 494d 5363 6865 6475 6c65 722e 6672 6f6d  IMScheduler.from
+00001600: 5f70 7265 7472 6169 6e65 6428 7072 6574  _pretrained(pret
+00001610: 7261 696e 5f6d 6f64 656c 2c20 7375 6266  rain_model, subf
+00001620: 6f6c 6465 723d 2273 6368 6564 756c 6572  older="scheduler
+00001630: 2229 0a70 6970 6520 3d20 4469 6666 7573  ").pipe = Diffus
+00001640: 696f 6e50 6970 656c 696e 652e 6672 6f6d  ionPipeline.from
+00001650: 5f70 7265 7472 6169 6e65 6428 7072 6574  _pretrained(pret
+00001660: 7261 696e 5f6d 6f64 656c 2c20 7363 6865  rain_model, sche
+00001670: 6475 6c65 7220 3d20 7363 6865 6475 6c65  duler = schedule
+00001680: 722c 2074 6f72 6368 5f64 7479 7065 3d74  r, torch_dtype=t
+00001690: 6f72 6368 2e66 6c6f 6174 3136 292e 746f  orch.float16).to
+000016a0: 2822 6375 6461 2229 0a0a 2320 2320 4f70  ("cuda")..# # Op
+000016b0: 7469 6f6e 616c 2e20 656e 6162 6c65 5f78  tional. enable_x
+000016c0: 666f 726d 6572 735f 6d65 6d6f 7279 5f65  formers_memory_e
+000016d0: 6666 6963 6965 6e74 5f61 7474 656e 7469  fficient_attenti
+000016e0: 6f6e 2063 616e 2073 6176 6520 6d65 6d6f  on can save memo
+000016f0: 7279 2075 7361 6765 2061 6e64 2069 6e63  ry usage and inc
+00001700: 7265 6173 6520 696e 6665 7265 6e63 6520  rease inference 
+00001710: 7370 6565 642e 2065 6e61 626c 655f 6d6f  speed. enable_mo
+00001720: 6465 6c5f 6370 755f 6f66 666c 6f61 6420  del_cpu_offload 
+00001730: 616e 6420 656e 6162 6c65 5f76 6165 5f74  and enable_vae_t
+00001740: 696c 696e 6720 6361 6e20 7361 7665 206d  iling can save m
+00001750: 656d 6f72 7920 7573 6167 652e 0a23 2070  emory usage..# p
+00001760: 6970 652e 656e 6162 6c65 5f78 666f 726d  ipe.enable_xform
+00001770: 6572 735f 6d65 6d6f 7279 5f65 6666 6963  ers_memory_effic
+00001780: 6965 6e74 5f61 7474 656e 7469 6f6e 2829  ient_attention()
+00001790: 0a23 2070 6970 652e 656e 6162 6c65 5f6d  .# pipe.enable_m
+000017a0: 6f64 656c 5f63 7075 5f6f 6666 6c6f 6164  odel_cpu_offload
+000017b0: 2829 0a23 2070 6970 652e 656e 6162 6c65  ().# pipe.enable
+000017c0: 5f76 6165 5f74 696c 696e 6728 290a 0a23  _vae_tiling()..#
+000017d0: 2041 7070 6c79 2068 6964 6966 6675 7369   Apply hidiffusi
+000017e0: 6f6e 2077 6974 6820 6120 7369 6e67 6c65  on with a single
+000017f0: 206c 696e 6520 6f66 2063 6f64 652e 0a61   line of code..a
+00001800: 7070 6c79 5f68 6964 6966 6675 7369 6f6e  pply_hidiffusion
+00001810: 2870 6970 6529 0a0a 7072 6f6d 7074 203d  (pipe)..prompt =
+00001820: 2022 416e 2061 646f 7261 626c 6520 6861   "An adorable ha
+00001830: 7070 7920 6272 6f77 6e20 626f 7264 6572  ppy brown border
+00001840: 2063 6f6c 6c69 6520 7369 7474 696e 6720   collie sitting 
+00001850: 6f6e 2061 2062 6564 2c20 6869 6768 2064  on a bed, high d
+00001860: 6574 6169 6c2e 220a 6e65 6761 7469 7665  etail.".negative
+00001870: 5f70 726f 6d70 7420 3d20 2275 676c 792c  _prompt = "ugly,
+00001880: 2074 696c 696e 672c 206f 7574 206f 6620   tiling, out of 
+00001890: 6672 616d 652c 2070 6f6f 726c 7920 6472  frame, poorly dr
+000018a0: 6177 6e20 6661 6365 2c20 6578 7472 6120  awn face, extra 
+000018b0: 6c69 6d62 732c 2064 6973 6669 6775 7265  limbs, disfigure
+000018c0: 642c 2064 6566 6f72 6d65 642c 2062 6f64  d, deformed, bod
+000018d0: 7920 6f75 7420 6f66 2066 7261 6d65 2c20  y out of frame, 
+000018e0: 626c 7572 7279 2c20 6261 6420 616e 6174  blurry, bad anat
+000018f0: 6f6d 792c 2062 6c75 7272 6564 2c20 6172  omy, blurred, ar
+00001900: 7469 6661 6374 732c 2062 6164 2070 726f  tifacts, bad pro
+00001910: 706f 7274 696f 6e73 2e22 0a69 6d61 6765  portions.".image
+00001920: 203d 2070 6970 6528 7072 6f6d 7074 2c20   = pipe(prompt, 
+00001930: 6775 6964 616e 6365 5f73 6361 6c65 3d37  guidance_scale=7
+00001940: 2e35 2c20 6865 6967 6874 3d31 3032 342c  .5, height=1024,
+00001950: 2077 6964 7468 3d31 3032 342c 2065 7461   width=1024, eta
+00001960: 3d31 2e30 2c20 6e65 6761 7469 7665 5f70  =1.0, negative_p
+00001970: 726f 6d70 743d 6e65 6761 7469 7665 5f70  rompt=negative_p
+00001980: 726f 6d70 7429 2e69 6d61 6765 735b 305d  rompt).images[0]
+00001990: 0a69 6d61 6765 2e73 6176 6528 6622 636f  .image.save(f"co
+000019a0: 6c6c 6965 2e6a 7067 2229 0a60 6060 0a0a  llie.jpg").```..
+000019b0: 3c64 6574 6169 6c73 3e0a 3c73 756d 6d61  <details>.<summa
+000019c0: 7279 3e4f 7574 7075 743a 3c2f 7375 6d6d  ry>Output:</summ
+000019d0: 6172 793e 0a3c 6469 7620 616c 6967 6e3d  ary>.<div align=
+000019e0: 2263 656e 7465 7222 3e0a 2020 3c69 6d67  "center">.  <img
+000019f0: 2073 7263 3d22 6173 7365 7473 2f73 6432   src="assets/sd2
+00001a00: 312e 6a70 6722 2077 6964 7468 3d22 3830  1.jpg" width="80
+00001a10: 3022 203e 3c2f 696d 673e 0a3c 2f64 6976  0" ></img>.</div
+00001a20: 3e0a 3c2f 6465 7461 696c 733e 0a0a 5365  >.</details>..Se
+00001a30: 7420 6865 6967 6874 203d 2032 3034 382c  t height = 2048,
+00001a40: 2077 6964 7468 203d 2032 3034 382c 2061   width = 2048, a
+00001a50: 6e64 2079 6f75 2063 616e 2067 6574 206f  nd you can get o
+00001a60: 7574 7075 7420 7769 7468 2032 3034 3878  utput with 2048x
+00001a70: 3230 3438 2072 6573 6f6c 7574 696f 6e2e  2048 resolution.
+00001a80: 0a0a 0a0a 2323 2320 5374 6162 6c65 2044  ....### Stable D
+00001a90: 6966 6675 7369 6f6e 2076 312d 350a 0a60  iffusion v1-5..`
+00001aa0: 6060 7079 7468 6f6e 0a66 726f 6d20 6869  ``python.from hi
+00001ab0: 6469 6666 7573 696f 6e20 696d 706f 7274  diffusion import
+00001ac0: 2061 7070 6c79 5f68 6964 6966 6675 7369   apply_hidiffusi
+00001ad0: 6f6e 2c20 7265 6d6f 7665 5f68 6964 6966  on, remove_hidif
+00001ae0: 6675 7369 6f6e 0a66 726f 6d20 6469 6666  fusion.from diff
+00001af0: 7573 6572 7320 696d 706f 7274 2044 6966  users import Dif
+00001b00: 6675 7369 6f6e 5069 7065 6c69 6e65 2c20  fusionPipeline, 
+00001b10: 4444 494d 5363 6865 6475 6c65 720a 696d  DDIMScheduler.im
+00001b20: 706f 7274 2074 6f72 6368 0a70 7265 7472  port torch.pretr
+00001b30: 6169 6e5f 6d6f 6465 6c20 3d20 2272 756e  ain_model = "run
+00001b40: 7761 796d 6c2f 7374 6162 6c65 2d64 6966  wayml/stable-dif
+00001b50: 6675 7369 6f6e 2d76 312d 3522 0a73 6368  fusion-v1-5".sch
+00001b60: 6564 756c 6572 203d 2044 4449 4d53 6368  eduler = DDIMSch
+00001b70: 6564 756c 6572 2e66 726f 6d5f 7072 6574  eduler.from_pret
+00001b80: 7261 696e 6564 2870 7265 7472 6169 6e5f  rained(pretrain_
+00001b90: 6d6f 6465 6c2c 2073 7562 666f 6c64 6572  model, subfolder
+00001ba0: 3d22 7363 6865 6475 6c65 7222 290a 7069  ="scheduler").pi
+00001bb0: 7065 203d 2044 6966 6675 7369 6f6e 5069  pe = DiffusionPi
+00001bc0: 7065 6c69 6e65 2e66 726f 6d5f 7072 6574  peline.from_pret
+00001bd0: 7261 696e 6564 2870 7265 7472 6169 6e5f  rained(pretrain_
+00001be0: 6d6f 6465 6c2c 2073 6368 6564 756c 6572  model, scheduler
+00001bf0: 203d 2073 6368 6564 756c 6572 2c20 746f   = scheduler, to
+00001c00: 7263 685f 6474 7970 653d 746f 7263 682e  rch_dtype=torch.
+00001c10: 666c 6f61 7431 3629 2e74 6f28 2263 7564  float16).to("cud
+00001c20: 6122 290a 0a23 2023 204f 7074 696f 6e61  a")..# # Optiona
+00001c30: 6c2e 2065 6e61 626c 655f 7866 6f72 6d65  l. enable_xforme
+00001c40: 7273 5f6d 656d 6f72 795f 6566 6669 6369  rs_memory_effici
+00001c50: 656e 745f 6174 7465 6e74 696f 6e20 6361  ent_attention ca
+00001c60: 6e20 7361 7665 206d 656d 6f72 7920 7573  n save memory us
+00001c70: 6167 6520 616e 6420 696e 6372 6561 7365  age and increase
+00001c80: 2069 6e66 6572 656e 6365 2073 7065 6564   inference speed
+00001c90: 2e20 656e 6162 6c65 5f6d 6f64 656c 5f63  . enable_model_c
+00001ca0: 7075 5f6f 6666 6c6f 6164 2061 6e64 2065  pu_offload and e
+00001cb0: 6e61 626c 655f 7661 655f 7469 6c69 6e67  nable_vae_tiling
+00001cc0: 2063 616e 2073 6176 6520 6d65 6d6f 7279   can save memory
+00001cd0: 2075 7361 6765 2e0a 2320 7069 7065 2e65   usage..# pipe.e
+00001ce0: 6e61 626c 655f 7866 6f72 6d65 7273 5f6d  nable_xformers_m
+00001cf0: 656d 6f72 795f 6566 6669 6369 656e 745f  emory_efficient_
+00001d00: 6174 7465 6e74 696f 6e28 290a 2320 7069  attention().# pi
+00001d10: 7065 2e65 6e61 626c 655f 6d6f 6465 6c5f  pe.enable_model_
+00001d20: 6370 755f 6f66 666c 6f61 6428 290a 2320  cpu_offload().# 
+00001d30: 7069 7065 2e65 6e61 626c 655f 7661 655f  pipe.enable_vae_
+00001d40: 7469 6c69 6e67 2829 0a0a 2320 4170 706c  tiling()..# Appl
+00001d50: 7920 6869 6469 6666 7573 696f 6e20 7769  y hidiffusion wi
+00001d60: 7468 2061 2073 696e 676c 6520 6c69 6e65  th a single line
+00001d70: 206f 6620 636f 6465 2e0a 6170 706c 795f   of code..apply_
+00001d80: 6869 6469 6666 7573 696f 6e28 7069 7065  hidiffusion(pipe
+00001d90: 290a 0a70 726f 6d70 7420 3d20 2274 6869  )..prompt = "thi
+00001da0: 636b 2073 7472 6f6b 6573 2c20 6272 6967  ck strokes, brig
+00001db0: 6874 2063 6f6c 6f72 732c 2061 6e20 6578  ht colors, an ex
+00001dc0: 6f74 6963 2066 6f78 2c20 6375 7465 2c20  otic fox, cute, 
+00001dd0: 6368 6962 6920 6b61 7761 6969 2e20 6465  chibi kawaii. de
+00001de0: 7461 696c 6564 2066 7572 2c20 6879 7065  tailed fur, hype
+00001df0: 7264 6574 6169 6c65 6420 2c20 6269 6720  rdetailed , big 
+00001e00: 7265 666c 6563 7469 7665 2065 7965 732c  reflective eyes,
+00001e10: 2066 6169 7279 7461 6c65 2c20 6172 7473   fairytale, arts
+00001e20: 7461 7469 6f6e 2c63 656e 7465 7265 6420  tation,centered 
+00001e30: 636f 6d70 6f73 6974 696f 6e2c 2070 6572  composition, per
+00001e40: 6665 6374 2063 6f6d 706f 7369 7469 6f6e  fect composition
+00001e50: 2c20 6365 6e74 6572 6564 2c20 7669 6272  , centered, vibr
+00001e60: 616e 7420 636f 6c6f 7273 2c20 6d75 7465  ant colors, mute
+00001e70: 6420 636f 6c6f 7273 2c20 6869 6768 2064  d colors, high d
+00001e80: 6574 6169 6c65 642c 2038 6b2e 220a 6e65  etailed, 8k.".ne
+00001e90: 6761 7469 7665 5f70 726f 6d70 7420 3d20  gative_prompt = 
+00001ea0: 2275 676c 792c 2074 696c 696e 672c 2070  "ugly, tiling, p
+00001eb0: 6f6f 726c 7920 6472 6177 6e20 6661 6365  oorly drawn face
+00001ec0: 2c20 6f75 7420 6f66 2066 7261 6d65 2c20  , out of frame, 
+00001ed0: 6469 7366 6967 7572 6564 2c20 6465 666f  disfigured, defo
+00001ee0: 726d 6564 2c20 626c 7572 7279 2c20 6261  rmed, blurry, ba
+00001ef0: 6420 616e 6174 6f6d 792c 2062 6c75 7272  d anatomy, blurr
+00001f00: 6564 2e22 0a69 6d61 6765 203d 2070 6970  ed.".image = pip
+00001f10: 6528 7072 6f6d 7074 2c20 6775 6964 616e  e(prompt, guidan
+00001f20: 6365 5f73 6361 6c65 3d37 2e35 2c20 6865  ce_scale=7.5, he
+00001f30: 6967 6874 3d31 3032 342c 2077 6964 7468  ight=1024, width
+00001f40: 3d31 3032 342c 2065 7461 3d31 2e30 2c20  =1024, eta=1.0, 
+00001f50: 6e65 6761 7469 7665 5f70 726f 6d70 743d  negative_prompt=
+00001f60: 6e65 6761 7469 7665 5f70 726f 6d70 7429  negative_prompt)
+00001f70: 2e69 6d61 6765 735b 305d 0a69 6d61 6765  .images[0].image
+00001f80: 2e73 6176 6528 6622 666f 782e 6a70 6722  .save(f"fox.jpg"
+00001f90: 290a 6060 600a 0a3c 6465 7461 696c 733e  ).```..<details>
+00001fa0: 0a3c 7375 6d6d 6172 793e 4f75 7470 7574  .<summary>Output
+00001fb0: 3a3c 2f73 756d 6d61 7279 3e0a 3c64 6976  :</summary>.<div
+00001fc0: 2061 6c69 676e 3d22 6365 6e74 6572 223e   align="center">
+00001fd0: 0a20 203c 696d 6720 7372 633d 2261 7373  .  <img src="ass
+00001fe0: 6574 732f 7364 3135 2e6a 7067 2220 7769  ets/sd15.jpg" wi
+00001ff0: 6474 683d 2238 3030 2220 3e3c 2f69 6d67  dth="800" ></img
+00002000: 3e0a 3c2f 6469 763e 0a3c 2f64 6574 6169  >.</div>.</detai
+00002010: 6c73 3e0a 0a53 6574 2068 6569 6768 7420  ls>..Set height 
+00002020: 3d20 3230 3438 2c20 7769 6474 6820 3d20  = 2048, width = 
+00002030: 3230 3438 2c20 616e 6420 796f 7520 6361  2048, and you ca
+00002040: 6e20 6765 7420 6f75 7470 7574 2077 6974  n get output wit
+00002050: 6820 3230 3438 7832 3034 3820 7265 736f  h 2048x2048 reso
+00002060: 6c75 7469 6f6e 2e0a 0a23 2323 2052 656d  lution...### Rem
+00002070: 6f76 6520 4869 4469 6666 7573 696f 6e0a  ove HiDiffusion.
+00002080: 0a49 6620 796f 7520 7761 6e74 2074 6f20  .If you want to 
+00002090: 7265 6d6f 7665 2048 6944 6969 6666 7573  remove HiDiiffus
+000020a0: 696f 6e2c 2073 696d 706c 7920 7573 6520  ion, simply use 
+000020b0: 6072 656d 6f76 655f 6869 6469 6666 7573  `remove_hidiffus
+000020c0: 696f 6e28 7069 7065 2960 2e0a 0a23 2320  ion(pipe)`...## 
+000020d0: 436f 6e74 726f 6c4e 6574 0a0a 6060 6070  ControlNet..```p
+000020e0: 7974 686f 6e0a 6672 6f6d 2064 6966 6675  ython.from diffu
+000020f0: 7365 7273 2069 6d70 6f72 7420 5374 6162  sers import Stab
+00002100: 6c65 4469 6666 7573 696f 6e58 4c43 6f6e  leDiffusionXLCon
+00002110: 7472 6f6c 4e65 7450 6970 656c 696e 652c  trolNetPipeline,
+00002120: 2043 6f6e 7472 6f6c 4e65 744d 6f64 656c   ControlNetModel
+00002130: 2c20 4444 494d 5363 6865 6475 6c65 720a  , DDIMScheduler.
+00002140: 696d 706f 7274 206e 756d 7079 2061 7320  import numpy as 
+00002150: 6e70 0a69 6d70 6f72 7420 746f 7263 680a  np.import torch.
+00002160: 696d 706f 7274 2063 7632 0a66 726f 6d20  import cv2.from 
+00002170: 5049 4c20 696d 706f 7274 2049 6d61 6765  PIL import Image
+00002180: 0a66 726f 6d20 6869 6469 6666 7573 696f  .from hidiffusio
+00002190: 6e20 696d 706f 7274 2061 7070 6c79 5f68  n import apply_h
+000021a0: 6964 6966 6675 7369 6f6e 2c20 7265 6d6f  idiffusion, remo
+000021b0: 7665 5f68 6964 6966 6675 7369 6f6e 0a0a  ve_hidiffusion..
+000021c0: 2320 6c6f 6164 2059 6f73 6875 615f 4265  # load Yoshua_Be
+000021d0: 6e67 696f 2e6a 7067 2069 6e20 7468 6520  ngio.jpg in the 
+000021e0: 6173 7365 7473 2066 696c 652e 0a70 6174  assets file..pat
+000021f0: 6820 3d20 2759 6f73 6875 615f 4265 6e67  h = 'Yoshua_Beng
+00002200: 696f 2e6a 7067 270a 696d 6167 6520 3d20  io.jpg'.image = 
+00002210: 496d 6167 652e 6f70 656e 2870 6174 6829  Image.open(path)
+00002220: 0a23 2067 6574 2063 616e 6e79 2069 6d61  .# get canny ima
+00002230: 6765 0a69 6d61 6765 203d 206e 702e 6172  ge.image = np.ar
+00002240: 7261 7928 696d 6167 6529 0a69 6d61 6765  ray(image).image
+00002250: 203d 2063 7632 2e43 616e 6e79 2869 6d61   = cv2.Canny(ima
+00002260: 6765 2c20 3130 302c 2032 3030 290a 696d  ge, 100, 200).im
+00002270: 6167 6520 3d20 696d 6167 655b 3a2c 203a  age = image[:, :
+00002280: 2c20 4e6f 6e65 5d0a 696d 6167 6520 3d20  , None].image = 
+00002290: 6e70 2e63 6f6e 6361 7465 6e61 7465 285b  np.concatenate([
+000022a0: 696d 6167 652c 2069 6d61 6765 2c20 696d  image, image, im
+000022b0: 6167 655d 2c20 6178 6973 3d32 290a 6361  age], axis=2).ca
+000022c0: 6e6e 795f 696d 6167 6520 3d20 496d 6167  nny_image = Imag
+000022d0: 652e 6672 6f6d 6172 7261 7928 696d 6167  e.fromarray(imag
+000022e0: 6529 0a0a 2320 696e 6974 6961 6c69 7a65  e)..# initialize
+000022f0: 2074 6865 206d 6f64 656c 7320 616e 6420   the models and 
+00002300: 7069 7065 6c69 6e65 0a63 6f6e 7472 6f6c  pipeline.control
+00002310: 6e65 745f 636f 6e64 6974 696f 6e69 6e67  net_conditioning
+00002320: 5f73 6361 6c65 203d 2030 2e35 2020 2320  _scale = 0.5  # 
+00002330: 7265 636f 6d6d 656e 6465 6420 666f 7220  recommended for 
+00002340: 676f 6f64 2067 656e 6572 616c 697a 6174  good generalizat
+00002350: 696f 6e0a 636f 6e74 726f 6c6e 6574 203d  ion.controlnet =
+00002360: 2043 6f6e 7472 6f6c 4e65 744d 6f64 656c   ControlNetModel
+00002370: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
+00002380: 280a 2020 2020 2264 6966 6675 7365 7273  (.    "diffusers
+00002390: 2f63 6f6e 7472 6f6c 6e65 742d 6361 6e6e  /controlnet-cann
+000023a0: 792d 7364 786c 2d31 2e30 222c 2074 6f72  y-sdxl-1.0", tor
+000023b0: 6368 5f64 7479 7065 3d74 6f72 6368 2e66  ch_dtype=torch.f
+000023c0: 6c6f 6174 3136 2c20 7661 7269 616e 743d  loat16, variant=
+000023d0: 2266 7031 3622 0a29 0a73 6368 6564 756c  "fp16".).schedul
+000023e0: 6572 203d 2044 4449 4d53 6368 6564 756c  er = DDIMSchedul
+000023f0: 6572 2e66 726f 6d5f 7072 6574 7261 696e  er.from_pretrain
+00002400: 6564 2822 7374 6162 696c 6974 7961 692f  ed("stabilityai/
+00002410: 7374 6162 6c65 2d64 6966 6675 7369 6f6e  stable-diffusion
+00002420: 2d78 6c2d 6261 7365 2d31 2e30 222c 2073  -xl-base-1.0", s
+00002430: 7562 666f 6c64 6572 3d22 7363 6865 6475  ubfolder="schedu
+00002440: 6c65 7222 290a 7069 7065 203d 2053 7461  ler").pipe = Sta
+00002450: 626c 6544 6966 6675 7369 6f6e 584c 436f  bleDiffusionXLCo
+00002460: 6e74 726f 6c4e 6574 5069 7065 6c69 6e65  ntrolNetPipeline
+00002470: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
+00002480: 280a 2020 2020 2273 7461 6269 6c69 7479  (.    "stability
+00002490: 6169 2f73 7461 626c 652d 6469 6666 7573  ai/stable-diffus
+000024a0: 696f 6e2d 786c 2d62 6173 652d 312e 3022  ion-xl-base-1.0"
+000024b0: 2c20 636f 6e74 726f 6c6e 6574 3d63 6f6e  , controlnet=con
+000024c0: 7472 6f6c 6e65 742c 2074 6f72 6368 5f64  trolnet, torch_d
+000024d0: 7479 7065 3d74 6f72 6368 2e66 6c6f 6174  type=torch.float
+000024e0: 3136 2c0a 2020 2020 7363 6865 6475 6c65  16,.    schedule
+000024f0: 7220 3d20 7363 6865 6475 6c65 720a 290a  r = scheduler.).
+00002500: 0a23 2041 7070 6c79 2068 6964 6966 6675  .# Apply hidiffu
+00002510: 7369 6f6e 2077 6974 6820 6120 7369 6e67  sion with a sing
+00002520: 6c65 206c 696e 6520 6f66 2063 6f64 652e  le line of code.
+00002530: 0a61 7070 6c79 5f68 6964 6966 6675 7369  .apply_hidiffusi
+00002540: 6f6e 2870 6970 6529 0a0a 7069 7065 2e65  on(pipe)..pipe.e
+00002550: 6e61 626c 655f 6d6f 6465 6c5f 6370 755f  nable_model_cpu_
+00002560: 6f66 666c 6f61 6428 290a 7069 7065 2e65  offload().pipe.e
+00002570: 6e61 626c 655f 7866 6f72 6d65 7273 5f6d  nable_xformers_m
+00002580: 656d 6f72 795f 6566 6669 6369 656e 745f  emory_efficient_
+00002590: 6174 7465 6e74 696f 6e28 290a 0a70 726f  attention()..pro
+000025a0: 6d70 7420 3d20 2261 207a 6f6d 6269 652c  mpt = "a zombie,
+000025b0: 2068 6967 6820 6661 6365 2064 6574 6169   high face detai
+000025c0: 6c2c 2068 6967 6820 6465 7461 696c 2c20  l, high detail, 
+000025d0: 6d75 7465 6420 636f 6c6f 722c 2038 6b22  muted color, 8k"
+000025e0: 0a6e 6567 6174 6976 655f 7072 6f6d 7074  .negative_prompt
+000025f0: 203d 2022 626c 7572 7279 2c20 7567 6c79   = "blurry, ugly
+00002600: 2c20 6475 706c 6963 6174 652c 2070 6f6f  , duplicate, poo
+00002610: 726c 7920 6472 6177 6e2c 2064 6566 6f72  rly drawn, defor
+00002620: 6d65 642c 206d 6f73 6169 632c 2070 6f6f  med, mosaic, poo
+00002630: 726c 7920 6472 6177 6e20 7465 6574 682c  rly drawn teeth,
+00002640: 2064 7570 6c69 6361 7465 6420 7465 6574   duplicated teet
+00002650: 682e 220a 0a69 6d61 6765 203d 2070 6970  h."..image = pip
+00002660: 6528 0a20 2020 2070 726f 6d70 742c 2063  e(.    prompt, c
+00002670: 6f6e 7472 6f6c 6e65 745f 636f 6e64 6974  ontrolnet_condit
+00002680: 696f 6e69 6e67 5f73 6361 6c65 3d63 6f6e  ioning_scale=con
+00002690: 7472 6f6c 6e65 745f 636f 6e64 6974 696f  trolnet_conditio
+000026a0: 6e69 6e67 5f73 6361 6c65 2c20 696d 6167  ning_scale, imag
+000026b0: 653d 6361 6e6e 795f 696d 6167 652c 0a20  e=canny_image,. 
+000026c0: 2020 2068 6569 6768 743d 3230 3438 2c20     height=2048, 
+000026d0: 7769 6474 683d 3230 3438 2c20 6775 6964  width=2048, guid
+000026e0: 616e 6365 5f73 6361 6c65 3d37 2e35 2c20  ance_scale=7.5, 
+000026f0: 6e65 6761 7469 7665 5f70 726f 6d70 7420  negative_prompt 
+00002700: 3d20 6e65 6761 7469 7665 5f70 726f 6d70  = negative_promp
+00002710: 742c 2065 7461 3d31 2e30 0a29 2e69 6d61  t, eta=1.0.).ima
+00002720: 6765 735b 305d 0a0a 696d 6167 652e 7361  ges[0]..image.sa
+00002730: 7665 2827 7a6f 6d62 6965 2e6a 7067 2729  ve('zombie.jpg')
+00002740: 0a60 6060 0a0a 3c64 6574 6169 6c73 3e0a  .```..<details>.
+00002750: 3c73 756d 6d61 7279 3e4f 7574 7075 743a  <summary>Output:
+00002760: 3c2f 7375 6d6d 6172 793e 0a3c 6469 7620  </summary>.<div 
+00002770: 616c 6967 6e3d 2263 656e 7465 7222 3e0a  align="center">.
+00002780: 2020 3c69 6d67 2073 7263 3d22 6173 7365    <img src="asse
+00002790: 7473 2f63 6f6e 7472 6f6c 6e65 745f 7265  ts/controlnet_re
+000027a0: 7375 6c74 2e6a 7067 2220 7769 6474 683d  sult.jpg" width=
+000027b0: 2238 3030 2220 3e3c 2f69 6d67 3e0a 3c2f  "800" ></img>.</
+000027c0: 6469 763e 0a3c 2f64 6574 6169 6c73 3e0a  div>.</details>.
+000027d0: 0a23 2320 496e 7061 696e 7469 6e67 0a0a  .## Inpainting..
+000027e0: 6060 6070 7974 686f 6e0a 696d 706f 7274  ```python.import
+000027f0: 2074 6f72 6368 0a66 726f 6d20 6469 6666   torch.from diff
+00002800: 7573 6572 7320 696d 706f 7274 2041 7574  users import Aut
+00002810: 6f50 6970 656c 696e 6546 6f72 496e 7061  oPipelineForInpa
+00002820: 696e 7469 6e67 2c20 4444 494d 5363 6865  inting, DDIMSche
+00002830: 6475 6c65 720a 6672 6f6d 2064 6966 6675  duler.from diffu
+00002840: 7365 7273 2e75 7469 6c73 2069 6d70 6f72  sers.utils impor
+00002850: 7420 6c6f 6164 5f69 6d61 6765 0a66 726f  t load_image.fro
+00002860: 6d20 6869 6469 6666 7573 696f 6e20 696d  m hidiffusion im
+00002870: 706f 7274 2061 7070 6c79 5f68 6964 6966  port apply_hidif
+00002880: 6675 7369 6f6e 2c20 7265 6d6f 7665 5f68  fusion, remove_h
+00002890: 6964 6966 6675 7369 6f6e 0a66 726f 6d20  idiffusion.from 
+000028a0: 5049 4c20 696d 706f 7274 2049 6d61 6765  PIL import Image
+000028b0: 0a0a 7363 6865 6475 6c65 7220 3d20 4444  ..scheduler = DD
+000028c0: 494d 5363 6865 6475 6c65 722e 6672 6f6d  IMScheduler.from
+000028d0: 5f70 7265 7472 6169 6e65 6428 2273 7461  _pretrained("sta
+000028e0: 6269 6c69 7479 6169 2f73 7461 626c 652d  bilityai/stable-
+000028f0: 6469 6666 7573 696f 6e2d 786c 2d62 6173  diffusion-xl-bas
+00002900: 652d 312e 3022 2c20 7375 6266 6f6c 6465  e-1.0", subfolde
+00002910: 723d 2273 6368 6564 756c 6572 2229 0a70  r="scheduler").p
+00002920: 6970 656c 696e 6520 3d20 4175 746f 5069  ipeline = AutoPi
+00002930: 7065 6c69 6e65 466f 7249 6e70 6169 6e74  pelineForInpaint
+00002940: 696e 672e 6672 6f6d 5f70 7265 7472 6169  ing.from_pretrai
+00002950: 6e65 6428 0a20 2020 2022 6469 6666 7573  ned(.    "diffus
+00002960: 6572 732f 7374 6162 6c65 2d64 6966 6675  ers/stable-diffu
+00002970: 7369 6f6e 2d78 6c2d 312e 302d 696e 7061  sion-xl-1.0-inpa
+00002980: 696e 7469 6e67 2d30 2e31 222c 2074 6f72  inting-0.1", tor
+00002990: 6368 5f64 7479 7065 3d74 6f72 6368 2e66  ch_dtype=torch.f
+000029a0: 6c6f 6174 3136 2c20 7661 7269 616e 743d  loat16, variant=
+000029b0: 2266 7031 3622 2c20 0a20 2020 2073 6368  "fp16", .    sch
+000029c0: 6564 756c 6572 3d73 6368 6564 756c 6572  eduler=scheduler
+000029d0: 0a29 0a0a 2320 4170 706c 7920 6869 6469  .)..# Apply hidi
+000029e0: 6666 7573 696f 6e20 7769 7468 2061 2073  ffusion with a s
+000029f0: 696e 676c 6520 6c69 6e65 206f 6620 636f  ingle line of co
+00002a00: 6465 2e0a 6170 706c 795f 6869 6469 6666  de..apply_hidiff
+00002a10: 7573 696f 6e28 7069 7065 6c69 6e65 290a  usion(pipeline).
+00002a20: 0a70 6970 656c 696e 652e 656e 6162 6c65  .pipeline.enable
+00002a30: 5f6d 6f64 656c 5f63 7075 5f6f 6666 6c6f  _model_cpu_offlo
+00002a40: 6164 2829 0a23 2072 656d 6f76 6520 666f  ad().# remove fo
+00002a50: 6c6c 6f77 696e 6720 6c69 6e65 2069 6620  llowing line if 
+00002a60: 7846 6f72 6d65 7273 2069 7320 6e6f 7420  xFormers is not 
+00002a70: 696e 7374 616c 6c65 640a 7069 7065 6c69  installed.pipeli
+00002a80: 6e65 2e65 6e61 626c 655f 7866 6f72 6d65  ne.enable_xforme
+00002a90: 7273 5f6d 656d 6f72 795f 6566 6669 6369  rs_memory_effici
+00002aa0: 656e 745f 6174 7465 6e74 696f 6e28 290a  ent_attention().
+00002ab0: 0a23 206c 6f61 6420 6261 7365 2061 6e64  .# load base and
+00002ac0: 206d 6173 6b20 696d 6167 650a 696d 675f   mask image.img_
+00002ad0: 7572 6c20 3d20 2268 7474 7073 3a2f 2f68  url = "https://h
+00002ae0: 7567 6769 6e67 6661 6365 2e63 6f2f 6461  uggingface.co/da
+00002af0: 7461 7365 7473 2f68 7567 6769 6e67 6661  tasets/huggingfa
+00002b00: 6365 2f64 6f63 756d 656e 7461 7469 6f6e  ce/documentation
+00002b10: 2d69 6d61 6765 732f 7265 736f 6c76 652f  -images/resolve/
+00002b20: 6d61 696e 2f64 6966 6675 7365 7273 2f73  main/diffusers/s
+00002b30: 6478 6c2d 7465 7874 3269 6d67 2e70 6e67  dxl-text2img.png
+00002b40: 220a 696e 6974 5f69 6d61 6765 203d 206c  ".init_image = l
+00002b50: 6f61 645f 696d 6167 6528 696d 675f 7572  oad_image(img_ur
+00002b60: 6c29 0a23 206c 6f61 6420 6d61 736b 5f69  l).# load mask_i
+00002b70: 6d61 6765 2e6a 7067 2069 6e20 7468 6520  mage.jpg in the 
+00002b80: 6173 7365 7473 2066 696c 652e 0a6d 6173  assets file..mas
+00002b90: 6b5f 696d 6167 6520 3d20 496d 6167 652e  k_image = Image.
+00002ba0: 6f70 656e 2822 6d61 736b 5f69 6d61 6765  open("mask_image
+00002bb0: 2e70 6e67 2229 0a0a 7072 6f6d 7074 203d  .png")..prompt =
+00002bc0: 2020 2241 2073 7465 616d 7075 6e6b 2065    "A steampunk e
+00002bd0: 7870 6c6f 7265 7220 696e 2061 206c 6561  xplorer in a lea
+00002be0: 7468 6572 2061 7669 6174 6f72 2063 6170  ther aviator cap
+00002bf0: 2061 6e64 2067 6f67 676c 6573 2c20 7769   and goggles, wi
+00002c00: 7468 2061 2062 7261 7373 2074 656c 6573  th a brass teles
+00002c10: 636f 7065 2069 6e20 6861 6e64 2c20 7374  cope in hand, st
+00002c20: 616e 6473 2061 6d69 6473 7420 746f 7765  ands amidst towe
+00002c30: 7269 6e67 2061 6e63 6965 6e74 2074 7265  ring ancient tre
+00002c40: 6573 2c20 7468 6569 7220 726f 6f74 7320  es, their roots 
+00002c50: 656e 7477 696e 6564 2077 6974 6820 696e  entwined with in
+00002c60: 7472 6963 6174 6520 6765 6172 7320 616e  tricate gears an
+00002c70: 6420 7069 7065 732e 220a 0a6e 6567 6174  d pipes."..negat
+00002c80: 6976 655f 7072 6f6d 7074 203d 2022 626c  ive_prompt = "bl
+00002c90: 7572 7279 2c20 7567 6c79 2c20 6475 706c  urry, ugly, dupl
+00002ca0: 6963 6174 652c 2070 6f6f 726c 7920 6472  icate, poorly dr
+00002cb0: 6177 6e2c 2064 6566 6f72 6d65 642c 206d  awn, deformed, m
+00002cc0: 6f73 6169 6322 0a69 6d61 6765 203d 2070  osaic".image = p
+00002cd0: 6970 656c 696e 6528 7072 6f6d 7074 3d70  ipeline(prompt=p
+00002ce0: 726f 6d70 742c 2069 6d61 6765 3d69 6e69  rompt, image=ini
+00002cf0: 745f 696d 6167 652c 206d 6173 6b5f 696d  t_image, mask_im
+00002d00: 6167 653d 6d61 736b 5f69 6d61 6765 2c20  age=mask_image, 
+00002d10: 6865 6967 6874 3d32 3034 382c 2077 6964  height=2048, wid
+00002d20: 7468 3d32 3034 382c 2073 7472 656e 6774  th=2048, strengt
+00002d30: 683d 302e 3835 2c20 6775 6964 616e 6365  h=0.85, guidance
+00002d40: 5f73 6361 6c65 3d31 322e 352c 206e 6567  _scale=12.5, neg
+00002d50: 6174 6976 655f 7072 6f6d 7074 203d 206e  ative_prompt = n
+00002d60: 6567 6174 6976 655f 7072 6f6d 7074 2c20  egative_prompt, 
+00002d70: 6574 613d 312e 3029 2e69 6d61 6765 735b  eta=1.0).images[
+00002d80: 305d 0a69 6d61 6765 2e73 6176 6528 2773  0].image.save('s
+00002d90: 7465 616d 7075 6e6b 5f65 7870 6c6f 7265  teampunk_explore
+00002da0: 722e 6a70 6727 290a 6060 600a 0a3c 6465  r.jpg').```..<de
+00002db0: 7461 696c 733e 0a3c 7375 6d6d 6172 793e  tails>.<summary>
+00002dc0: 4f75 7470 7574 3a3c 2f73 756d 6d61 7279  Output:</summary
+00002dd0: 3e0a 3c64 6976 2061 6c69 676e 3d22 6365  >.<div align="ce
+00002de0: 6e74 6572 223e 0a20 203c 696d 6720 7372  nter">.  <img sr
+00002df0: 633d 2261 7373 6574 732f 696e 7061 696e  c="assets/inpain
+00002e00: 7469 6e67 5f72 6573 756c 742e 6a70 6722  ting_result.jpg"
+00002e10: 2077 6964 7468 3d22 3830 3022 203e 3c2f   width="800" ></
+00002e20: 696d 673e 0a3c 2f64 6976 3e0a 3c2f 6465  img>.</div>.</de
+00002e30: 7461 696c 733e 0a0a 0a23 2320 496e 7465  tails>...## Inte
+00002e40: 6772 6174 696f 6e20 696e 746f 2064 6f77  gration into dow
+00002e50: 6e73 7472 6561 6d20 6d6f 6465 6c73 0a48  nstream models.H
+00002e60: 6944 6966 6675 7369 6f6e 2073 7570 706f  iDiffusion suppo
+00002e70: 7274 7320 6d6f 6465 6c73 2062 6173 6564  rts models based
+00002e80: 206f 6e20 5b73 7570 706f 7274 6564 206d   on [supported m
+00002e90: 6f64 656c 735d 2823 2d73 7570 706f 7274  odels](#-support
+00002ea0: 6564 2d6d 6f64 656c 7329 2c20 7375 6368  ed-models), such
+00002eb0: 2061 7320 5b47 6869 626c 692d 4469 6666   as [Ghibli-Diff
+00002ec0: 7573 696f 6e5d 2868 7474 7073 3a2f 2f68  usion](https://h
+00002ed0: 7567 6769 6e67 6661 6365 2e63 6f2f 6e69  uggingface.co/ni
+00002ee0: 7472 6f73 6f63 6b65 2f47 6869 626c 692d  trosocke/Ghibli-
+00002ef0: 4469 6666 7573 696f 6e29 2c20 5b50 6c61  Diffusion), [Pla
+00002f00: 7967 726f 756e 645d 2868 7474 7073 3a2f  yground](https:/
+00002f10: 2f68 7567 6769 6e67 6661 6365 2e63 6f2f  /huggingface.co/
+00002f20: 706c 6179 6772 6f75 6e64 6169 2f70 6c61  playgroundai/pla
+00002f30: 7967 726f 756e 642d 7632 2d31 3032 3470  yground-v2-1024p
+00002f40: 782d 6165 7374 6865 7469 6329 2c20 6574  x-aesthetic), et
+00002f50: 632e 0a0a 2323 2320 4768 6962 6c69 2d44  c...### Ghibli-D
+00002f60: 6966 6675 7369 6f6e 0a60 6060 7079 7468  iffusion.```pyth
+00002f70: 6f6e 0a66 726f 6d20 6469 6666 7573 6572  on.from diffuser
+00002f80: 7320 696d 706f 7274 2053 7461 626c 6544  s import StableD
+00002f90: 6966 6675 7369 6f6e 5069 7065 6c69 6e65  iffusionPipeline
+00002fa0: 2c20 4444 494d 5363 6865 6475 6c65 720a  , DDIMScheduler.
+00002fb0: 696d 706f 7274 2074 6f72 6368 0a66 726f  import torch.fro
+00002fc0: 6d20 6869 6469 6666 7573 696f 6e20 696d  m hidiffusion im
+00002fd0: 706f 7274 2061 7070 6c79 5f68 6964 6966  port apply_hidif
+00002fe0: 6675 7369 6f6e 2c20 7265 6d6f 7665 5f68  fusion, remove_h
+00002ff0: 6964 6966 6675 7369 6f6e 0a0a 6d6f 6465  idiffusion..mode
+00003000: 6c5f 6964 203d 2022 6e69 7472 6f73 6f63  l_id = "nitrosoc
+00003010: 6b65 2f47 6869 626c 692d 4469 6666 7573  ke/Ghibli-Diffus
+00003020: 696f 6e22 0a73 6368 6564 756c 6572 203d  ion".scheduler =
+00003030: 2044 4449 4d53 6368 6564 756c 6572 2e66   DDIMScheduler.f
+00003040: 726f 6d5f 7072 6574 7261 696e 6564 286d  rom_pretrained(m
+00003050: 6f64 656c 5f69 642c 2073 7562 666f 6c64  odel_id, subfold
+00003060: 6572 3d22 7363 6865 6475 6c65 7222 290a  er="scheduler").
+00003070: 7069 7065 203d 2053 7461 626c 6544 6966  pipe = StableDif
+00003080: 6675 7369 6f6e 5069 7065 6c69 6e65 2e66  fusionPipeline.f
+00003090: 726f 6d5f 7072 6574 7261 696e 6564 286d  rom_pretrained(m
+000030a0: 6f64 656c 5f69 642c 2074 6f72 6368 5f64  odel_id, torch_d
+000030b0: 7479 7065 3d74 6f72 6368 2e66 6c6f 6174  type=torch.float
+000030c0: 3136 290a 7069 7065 203d 2070 6970 652e  16).pipe = pipe.
+000030d0: 746f 2822 6375 6461 2229 0a0a 2320 4170  to("cuda")..# Ap
+000030e0: 706c 7920 6869 6469 6666 7573 696f 6e20  ply hidiffusion 
+000030f0: 7769 7468 2061 2073 696e 676c 6520 6c69  with a single li
+00003100: 6e65 206f 6620 636f 6465 2e0a 6170 706c  ne of code..appl
+00003110: 795f 6869 6469 6666 7573 696f 6e28 7069  y_hidiffusion(pi
+00003120: 7065 290a 0a70 726f 6d70 7420 3d20 2267  pe)..prompt = "g
+00003130: 6869 626c 6920 7374 796c 6520 6d61 6769  hibli style magi
+00003140: 6361 6c20 7072 696e 6365 7373 2077 6974  cal princess wit
+00003150: 6820 676f 6c64 656e 2068 6169 7222 0a6e  h golden hair".n
+00003160: 6567 6174 6976 655f 7072 6f6d 7074 3d22  egative_prompt="
+00003170: 626c 7572 7279 2c20 7567 6c79 2c20 6475  blurry, ugly, du
+00003180: 706c 6963 6174 652c 2070 6f6f 726c 7920  plicate, poorly 
+00003190: 6472 6177 6e20 6661 6365 2c20 6465 666f  drawn face, defo
+000031a0: 726d 6564 2c20 6d6f 7361 6963 2c20 6172  rmed, mosaic, ar
+000031b0: 7469 6661 6374 732c 2062 6164 206c 696d  tifacts, bad lim
+000031c0: 6273 220a 696d 6167 6520 3d20 7069 7065  bs".image = pipe
+000031d0: 2870 726f 6d70 742c 2068 6569 6768 743d  (prompt, height=
+000031e0: 3130 3234 2c20 7769 6474 683d 3130 3234  1024, width=1024
+000031f0: 2c20 6574 613d 312e 302c 206e 6567 6174  , eta=1.0, negat
+00003200: 6976 655f 7072 6f6d 7074 3d6e 6567 6174  ive_prompt=negat
+00003210: 6976 655f 7072 6f6d 7074 292e 696d 6167  ive_prompt).imag
+00003220: 6573 5b30 5d0a 0a69 6d61 6765 2e73 6176  es[0]..image.sav
+00003230: 6528 222e 2f6d 6167 6963 616c 5f70 7269  e("./magical_pri
+00003240: 6e63 6573 732e 6a70 6722 290a 6060 600a  ncess.jpg").```.
+00003250: 3c64 6574 6169 6c73 3e0a 3c73 756d 6d61  <details>.<summa
+00003260: 7279 3e4f 7574 7075 743a 3c2f 7375 6d6d  ry>Output:</summ
+00003270: 6172 793e 0a3c 6469 7620 616c 6967 6e3d  ary>.<div align=
+00003280: 2263 656e 7465 7222 3e0a 2020 3c69 6d67  "center">.  <img
+00003290: 2073 7263 3d22 6173 7365 7473 2f67 6869   src="assets/ghi
+000032a0: 626c 695f 6469 6666 7573 696f 6e2e 6a70  bli_diffusion.jp
+000032b0: 6722 2077 6964 7468 3d22 3830 3022 203e  g" width="800" >
+000032c0: 3c2f 696d 673e 0a3c 2f64 6976 3e0a 3c2f  </img>.</div>.</
+000032d0: 6465 7461 696c 733e 0a0a 2323 2320 506c  details>..### Pl
+000032e0: 6179 6772 6f75 6e64 0a60 6060 7079 7468  ayground.```pyth
+000032f0: 6f6e 0a66 726f 6d20 6469 6666 7573 6572  on.from diffuser
+00003300: 7320 696d 706f 7274 2044 6966 6675 7369  s import Diffusi
+00003310: 6f6e 5069 7065 6c69 6e65 0a69 6d70 6f72  onPipeline.impor
+00003320: 7420 746f 7263 680a 6672 6f6d 2068 6964  t torch.from hid
+00003330: 6966 6675 7369 6f6e 2069 6d70 6f72 7420  iffusion import 
+00003340: 6170 706c 795f 6869 6469 6666 7573 696f  apply_hidiffusio
+00003350: 6e2c 2072 656d 6f76 655f 6869 6469 6666  n, remove_hidiff
+00003360: 7573 696f 6e0a 0a70 6970 6520 3d20 4469  usion..pipe = Di
+00003370: 6666 7573 696f 6e50 6970 656c 696e 652e  ffusionPipeline.
+00003380: 6672 6f6d 5f70 7265 7472 6169 6e65 6428  from_pretrained(
+00003390: 0a20 2020 2022 706c 6179 6772 6f75 6e64  .    "playground
+000033a0: 6169 2f70 6c61 7967 726f 756e 642d 7632  ai/playground-v2
+000033b0: 2d31 3032 3470 782d 6165 7374 6865 7469  -1024px-aestheti
+000033c0: 6322 2c0a 2020 2020 746f 7263 685f 6474  c",.    torch_dt
+000033d0: 7970 653d 746f 7263 682e 666c 6f61 7431  ype=torch.float1
+000033e0: 362c 0a20 2020 2075 7365 5f73 6166 6574  6,.    use_safet
+000033f0: 656e 736f 7273 3d54 7275 652c 0a20 2020  ensors=True,.   
+00003400: 2061 6464 5f77 6174 6572 6d61 726b 6572   add_watermarker
+00003410: 3d46 616c 7365 2c0a 2020 2020 7661 7269  =False,.    vari
+00003420: 616e 743d 2266 7031 3622 0a29 0a70 6970  ant="fp16".).pip
+00003430: 652e 746f 2822 6375 6461 2229 0a70 6970  e.to("cuda").pip
+00003440: 652e 656e 6162 6c65 5f78 666f 726d 6572  e.enable_xformer
+00003450: 735f 6d65 6d6f 7279 5f65 6666 6963 6965  s_memory_efficie
+00003460: 6e74 5f61 7474 656e 7469 6f6e 2829 0a0a  nt_attention()..
+00003470: 2320 4170 706c 7920 6869 6469 6666 7573  # Apply hidiffus
+00003480: 696f 6e20 7769 7468 2061 2073 696e 676c  ion with a singl
+00003490: 6520 6c69 6e65 206f 6620 636f 6465 2e0a  e line of code..
+000034a0: 6170 706c 795f 6869 6469 6666 7573 696f  apply_hidiffusio
+000034b0: 6e28 7069 7065 290a 0a70 726f 6d70 7420  n(pipe)..prompt 
+000034c0: 3d20 2254 6865 206c 6974 746c 6520 6769  = "The little gi
+000034d0: 726c 2072 6964 696e 6720 6120 6269 6b65  rl riding a bike
+000034e0: 2c20 696e 2061 2062 6561 7574 6966 756c  , in a beautiful
+000034f0: 2061 6e69 6d65 2073 6365 6e65 2062 7920   anime scene by 
+00003500: 4861 7961 6f20 4d69 7961 7a61 6b69 3a20  Hayao Miyazaki: 
+00003510: 6120 736e 6f77 7920 546f 6b79 6f20 6369  a snowy Tokyo ci
+00003520: 7479 2077 6974 6820 6d61 7373 6976 6520  ty with massive 
+00003530: 4d69 7961 7a61 6b69 2063 6c6f 7564 7320  Miyazaki clouds 
+00003540: 666c 6f61 7469 6e67 2069 6e20 7468 6520  floating in the 
+00003550: 626c 7565 2073 6b79 2c20 656e 6368 616e  blue sky, enchan
+00003560: 7469 6e67 2073 6e6f 7773 6361 7065 7320  ting snowscapes 
+00003570: 6f66 2074 6865 2063 6974 7920 7769 7468  of the city with
+00003580: 2062 7269 6768 7420 7375 6e6c 6967 6874   bright sunlight
+00003590: 2c20 4d69 7961 7a61 6b69 2773 206c 616e  , Miyazaki's lan
+000035a0: 6473 6361 7065 2069 6d61 6765 7279 2c20  dscape imagery, 
+000035b0: 4a61 7061 6e65 7365 2061 7274 220a 6e65  Japanese art".ne
+000035c0: 6761 7469 7665 5f70 726f 6d70 743d 2262  gative_prompt="b
+000035d0: 6c75 7272 792c 2075 676c 792c 2064 7570  lurry, ugly, dup
+000035e0: 6c69 6361 7465 2c20 706f 6f72 6c79 2064  licate, poorly d
+000035f0: 7261 776e 2c20 6465 666f 726d 6564 2c20  rawn, deformed, 
+00003600: 6d6f 7361 6963 220a 696d 6167 6520 203d  mosaic".image  =
+00003610: 2070 6970 6528 7072 6f6d 7074 3d70 726f   pipe(prompt=pro
+00003620: 6d70 742c 2067 7569 6461 6e63 655f 7363  mpt, guidance_sc
+00003630: 616c 653d 332e 302c 2068 6569 6768 743d  ale=3.0, height=
+00003640: 3230 3438 2c20 7769 6474 683d 3230 3438  2048, width=2048
+00003650: 2c20 6e65 6761 7469 7665 5f70 726f 6d70  , negative_promp
+00003660: 743d 6e65 6761 7469 7665 5f70 726f 6d70  t=negative_promp
+00003670: 7429 2e69 6d61 6765 735b 305d 0a69 6d61  t).images[0].ima
+00003680: 6765 2e73 6176 6528 2767 6972 6c2e 6a70  ge.save('girl.jp
+00003690: 6727 290a 6060 600a 3c64 6574 6169 6c73  g').```.<details
+000036a0: 3e0a 3c73 756d 6d61 7279 3e4f 7574 7075  >.<summary>Outpu
+000036b0: 743a 3c2f 7375 6d6d 6172 793e 0a3c 6469  t:</summary>.<di
+000036c0: 7620 616c 6967 6e3d 2263 656e 7465 7222  v align="center"
+000036d0: 3e0a 2020 3c69 6d67 2073 7263 3d22 6173  >.  <img src="as
+000036e0: 7365 7473 2f70 6c61 7967 726f 756e 645f  sets/playground_
+000036f0: 7265 7375 6c74 2e6a 7067 2220 7769 6474  result.jpg" widt
+00003700: 683d 2238 3030 2220 3e3c 2f69 6d67 3e0a  h="800" ></img>.
+00003710: 3c2f 6469 763e 0a3c 2f64 6574 6169 6c73  </div>.</details
+00003720: 3e0a 0a23 2320 f09f 998f 2041 636b 6e6f  >..## .... Ackno
+00003730: 776c 6564 6765 6d65 6e74 730a 0a54 6869  wledgements..Thi
+00003740: 7320 636f 6465 6261 7365 2069 7320 6261  s codebase is ba
+00003750: 7365 6420 6f6e 205b 746f 6d65 7364 5d28  sed on [tomesd](
+00003760: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
+00003770: 6f6d 2f64 626f 6c79 612f 746f 6d65 7364  om/dbolya/tomesd
+00003780: 2920 616e 6420 5b64 6966 6675 7365 7273  ) and [diffusers
+00003790: 5d28 6874 7470 733a 2f2f 6769 7468 7562  ](https://github
+000037a0: 2e63 6f6d 2f68 7567 6769 6e67 6661 6365  .com/huggingface
+000037b0: 2f64 6966 6675 7365 7273 2f74 7265 652f  /diffusers/tree/
+000037c0: 6d61 696e 292e 2054 6861 6e6b 7321 0a0a  main). Thanks!..
+000037d0: 0a0a 2323 20f0 9f8e 9320 4369 7461 7469  ..## .... Citati
+000037e0: 6f6e 0a0a 6060 600a 4061 7274 6963 6c65  on..```.@article
+000037f0: 7b7a 6861 6e67 3230 3233 6869 6469 6666  {zhang2023hidiff
+00003800: 7573 696f 6e2c 0a20 2074 6974 6c65 3d7b  usion,.  title={
+00003810: 4869 4469 6666 7573 696f 6e3a 2055 6e6c  HiDiffusion: Unl
+00003820: 6f63 6b69 6e67 2048 6967 6865 722d 5265  ocking Higher-Re
+00003830: 736f 6c75 7469 6f6e 2043 7265 6174 6976  solution Creativ
+00003840: 6974 7920 616e 6420 4566 6669 6369 656e  ity and Efficien
+00003850: 6379 2069 6e20 5072 6574 7261 696e 6564  cy in Pretrained
+00003860: 2044 6966 6675 7369 6f6e 204d 6f64 656c   Diffusion Model
+00003870: 737d 2c0a 2020 6175 7468 6f72 3d7b 5a68  s},.  author={Zh
+00003880: 616e 672c 2053 6865 6e20 616e 6420 4368  ang, Shen and Ch
+00003890: 656e 2c20 5a68 616f 7765 6920 616e 6420  en, Zhaowei and 
+000038a0: 5a68 616f 2c20 5a68 656e 7975 2061 6e64  Zhao, Zhenyu and
+000038b0: 2043 6865 6e2c 2059 7568 616f 2061 6e64   Chen, Yuhao and
+000038c0: 2054 616e 672c 2059 616f 2061 6e64 204c   Tang, Yao and L
+000038d0: 6961 6e67 2c20 4a69 616a 756e 7d2c 0a20  iang, Jiajun},. 
+000038e0: 206a 6f75 726e 616c 3d7b 6172 5869 7620   journal={arXiv 
+000038f0: 7072 6570 7269 6e74 2061 7258 6976 3a32  preprint arXiv:2
+00003900: 3331 312e 3137 3532 387d 2c0a 2020 7965  311.17528},.  ye
+00003910: 6172 3d7b 3230 3233 7d0a 7d0a 6060 600a  ar={2023}.}.```.
```

### Comparing `hidiffusion-0.1.1/README.md` & `hidiffusion-0.1.2/PKG-INFO`

 * *Files 18% similar despite different names*

```diff
@@ -1,727 +1,933 @@
-00000000: 2320 f09f 92a1 2048 6944 6966 6675 7369  # .... HiDiffusi
-00000010: 6f6e 0a0a 3e20 2a2a 4869 4469 6666 7573  on..> **HiDiffus
-00000020: 696f 6e3a 2055 6e6c 6f63 6b69 6e67 2048  ion: Unlocking H
-00000030: 6967 6865 722d 5265 736f 6c75 7469 6f6e  igher-Resolution
-00000040: 2043 7265 6174 6976 6974 7920 616e 6420   Creativity and 
-00000050: 4566 6669 6369 656e 6379 2069 6e20 5072  Efficiency in Pr
-00000060: 6574 7261 696e 6564 2044 6966 6675 7369  etrained Diffusi
-00000070: 6f6e 204d 6f64 656c 732a 2a20 2020 0a3e  on Models**   .>
-00000080: 2053 6865 6e20 5a68 616e 672c 205a 6861   Shen Zhang, Zha
-00000090: 6f77 6569 2043 6865 6e2c 205a 6865 6e79  owei Chen, Zheny
-000000a0: 7520 5a68 616f 2c20 5975 6861 6f20 4368  u Zhao, Yuhao Ch
-000000b0: 656e 2c20 5961 6f20 5461 6e67 2c20 4a69  en, Yao Tang, Ji
-000000c0: 616a 756e 204c 6961 6e67 2020 2020 200a  ajun Liang     .
-000000d0: 3e20 f09f a7ac 5b5b 4172 7869 765d 5d28  > ....[[Arxiv]](
-000000e0: 6874 7470 733a 2f2f 6172 7869 762e 6f72  https://arxiv.or
-000000f0: 672f 6162 732f 3233 3131 2e31 3735 3238  g/abs/2311.17528
-00000100: 2920 f09f 8eb7 5b5b 5072 6f6a 6563 7420  ) ....[[Project 
-00000110: 5061 6765 5d5d 2829 0a0a 0a3c 6469 7620  Page]]()...<div 
-00000120: 616c 6967 6e3d 2263 656e 7465 7222 3e0a  align="center">.
-00000130: 2020 3c69 6d67 2073 7263 3d22 6173 7365    <img src="asse
-00000140: 7473 2f69 6d61 6765 5f67 616c 6c65 7279  ts/image_gallery
-00000150: 2e6a 7067 2220 7769 6474 683d 2238 3030  .jpg" width="800
-00000160: 2220 3e3c 2f69 6d67 3e0a 2020 3c62 723e  " ></img>.  <br>
-00000170: 0a20 203c 656d 3e0a 2020 2020 2020 2853  .  <em>.      (S
-00000180: 656c 6563 7420 4869 4469 6666 7573 696f  elect HiDiffusio
-00000190: 6e20 7361 6d70 6c65 7320 666f 7220 7661  n samples for va
-000001a0: 7269 6f75 7320 6469 6666 7573 696f 6e20  rious diffusion 
-000001b0: 6d6f 6465 6c73 2c20 7265 736f 6c75 7469  models, resoluti
-000001c0: 6f6e 732c 2061 6e64 2061 7370 6563 7420  ons, and aspect 
-000001d0: 7261 7469 6f73 2e29 200a 2020 3c2f 656d  ratios.) .  </em
-000001e0: 3e0a 3c2f 6469 763e 0a3c 6272 3e0a 0a0a  >.</div>.<br>...
-000001f0: 2320 f09f 9189 2057 6879 2048 6944 6966  # .... Why HiDif
-00000200: 6675 7369 6f6e 0a0a 2d20 4120 202a 2a74  fusion..- A  **t
-00000210: 7261 696e 696e 672d 6672 6565 206d 6574  raining-free met
-00000220: 686f 6420 7468 6174 2069 6e63 7265 6173  hod that increas
-00000230: 6573 2074 6865 2072 6573 6f6c 7574 696f  es the resolutio
-00000240: 6e20 616e 6420 7370 6565 6420 6f66 2070  n and speed of p
-00000250: 7265 7472 6169 6e65 6420 6469 6666 7573  retrained diffus
-00000260: 696f 6e20 6d6f 6465 6c73 2e2a 2a0a 2d20  ion models.**.- 
-00000270: 4465 7369 676e 6564 2061 7320 6120 2a2a  Designed as a **
-00000280: 706c 7567 2d61 6e64 2d70 6c61 7920 696d  plug-and-play im
-00000290: 706c 656d 656e 7461 7469 6f6e 2a2a 2e20  plementation**. 
-000002a0: 4974 2063 616e 2062 6520 696e 7465 6772  It can be integr
-000002b0: 6174 6564 2069 6e74 6f20 6469 6666 7573  ated into diffus
-000002c0: 696f 6e20 7069 7065 6c69 6e65 7320 6279  ion pipelines by
-000002d0: 202a 2a6f 6e6c 7920 6164 6469 6e67 2061   **only adding a
-000002e0: 2073 696e 676c 6520 6c69 6e65 206f 6620   single line of 
-000002f0: 636f 6465 2a2a 210a 0a3c 6469 7620 616c  code**!..<div al
-00000300: 6967 6e3d 2263 656e 7465 7222 3e0a 2020  ign="center">.  
-00000310: 3c69 6d67 2073 7263 3d22 6173 7365 7473  <img src="assets
-00000320: 2f71 7561 6c69 7479 5f65 6666 6963 6965  /quality_efficie
-00000330: 6e63 792e 6a70 6722 2077 6964 7468 3d22  ncy.jpg" width="
-00000340: 3830 3022 203e 3c2f 696d 673e 0a20 203c  800" ></img>.  <
-00000350: 6272 3e0a 2020 3c65 6d3e 0a20 2020 2020  br>.  <em>.     
-00000360: 2028 4661 7374 6572 2c20 616e 6420 6265   (Faster, and be
-00000370: 7474 6572 2069 6d61 6765 2064 6574 6169  tter image detai
-00000380: 6c73 2e29 200a 2020 3c2f 656d 3e0a 3c2f  ls.) .  </em>.</
-00000390: 6469 763e 0a3c 6272 3e0a 0a23 2320 f09f  div>.<br>..## ..
-000003a0: 93a2 2053 7570 706f 7274 6564 204d 6f64  .. Supported Mod
-000003b0: 656c 730a 0a2d 20e2 9c85 205b 5374 6162  els..- ... [Stab
-000003c0: 6c65 2044 6966 6675 7369 6f6e 2058 4c5d  le Diffusion XL]
-000003d0: 2868 7474 7073 3a2f 2f68 7567 6769 6e67  (https://hugging
-000003e0: 6661 6365 2e63 6f2f 7061 7065 7273 2f32  face.co/papers/2
-000003f0: 3330 372e 3031 3935 3229 0a2d 20e2 9c85  307.01952).- ...
-00000400: 205b 5374 6162 6c65 2044 6966 6675 7369   [Stable Diffusi
-00000410: 6f6e 2058 4c20 5475 7262 6f5d 2868 7474  on XL Turbo](htt
-00000420: 7073 3a2f 2f68 7567 6769 6e67 6661 6365  ps://huggingface
-00000430: 2e63 6f2f 7374 6162 696c 6974 7961 692f  .co/stabilityai/
-00000440: 7364 786c 2d74 7572 626f 290a 2d20 e29c  sdxl-turbo).- ..
-00000450: 8520 5b53 7461 626c 6520 4469 6666 7573  . [Stable Diffus
-00000460: 696f 6e20 7632 5d28 6874 7470 733a 2f2f  ion v2](https://
-00000470: 6875 6767 696e 6766 6163 652e 636f 2f73  huggingface.co/s
-00000480: 7461 6269 6c69 7479 6169 2f73 7461 626c  tabilityai/stabl
-00000490: 652d 6469 6666 7573 696f 6e2d 322d 3129  e-diffusion-2-1)
-000004a0: 0a2d 20e2 9c85 205b 5374 6162 6c65 2044  .- ... [Stable D
-000004b0: 6966 6675 7369 6f6e 2076 315d 2868 7474  iffusion v1](htt
-000004c0: 7073 3a2f 2f68 7567 6769 6e67 6661 6365  ps://huggingface
-000004d0: 2e63 6f2f 7275 6e77 6179 6d6c 2f73 7461  .co/runwayml/sta
-000004e0: 626c 652d 6469 6666 7573 696f 6e2d 7631  ble-diffusion-v1
-000004f0: 2d35 290a 0a2a 2a4e 6f74 652a 2a3a 2048  -5)..**Note**: H
-00000500: 6944 6966 6675 7369 6f6e 2063 616e 2061  iDiffusion can a
-00000510: 6c73 6f20 7375 7070 6f72 7420 7468 6520  lso support the 
-00000520: 646f 776d 7374 7265 616d 2064 6966 6675  dowmstream diffu
-00000530: 7369 6f6e 206d 6f64 656c 7320 6261 7365  sion models base
-00000540: 6420 6f6e 2074 6865 7365 2072 6570 6f73  d on these repos
-00000550: 6974 6f72 6965 732e 0a0a 2323 20f0 9f92  itories...## ...
-00000560: a320 5375 7070 6f72 7465 6420 5461 736b  . Supported Task
-00000570: 730a 0a2d 20e2 9c85 2054 6578 742d 746f  s..- ... Text-to
-00000580: 2d69 6d61 6765 0a2d 20e2 9c85 2043 6f6e  -image.- ... Con
-00000590: 7472 6f6c 4e65 740a 2d20 e29c 8520 496e  trolNet.- ... In
-000005a0: 7061 696e 7469 6e67 0a0a 0a23 2320 f09f  painting...## ..
-000005b0: 948e 204d 6169 6e20 7265 7175 6972 656d  .. Main requirem
-000005c0: 656e 7473 0a54 6869 7320 7265 706f 7369  ents.This reposi
-000005d0: 746f 7279 2069 7320 7465 7374 6564 206f  tory is tested o
-000005e0: 6e0a 2a20 5079 7468 6f6e 3d3d 332e 380a  n.* Python==3.8.
-000005f0: 2a20 746f 7263 683d 3d31 2e31 332e 310a  * torch==1.13.1.
-00000600: 2a20 6469 6666 7573 6572 733d 3d30 2e32  * diffusers==0.2
-00000610: 352e 300a 2a20 7472 616e 7366 6f72 6d65  5.0.* transforme
-00000620: 7273 3d3d 342e 3237 2e34 0a2a 2061 6363  rs==4.27.4.* acc
-00000630: 656c 6572 6174 653d 3d30 2e31 382e 300a  elerate==0.18.0.
-00000640: 2a20 7866 6f72 6d65 7273 3d3d 302e 302e  * xformers==0.0.
-00000650: 3136 7263 3432 350a 0a23 2320 f09f 9491  16rc425..## ....
-00000660: 2049 6e73 7461 6c6c 2048 6944 6966 6675   Install HiDiffu
-00000670: 7369 6f6e 0a41 6674 6572 2069 6e73 7461  sion.After insta
-00000680: 6c6c 696e 6720 7468 6520 7061 636b 6167  lling the packag
-00000690: 6573 2069 6e20 7468 6520 6d61 696e 2072  es in the main r
-000006a0: 6571 7569 7265 6d65 6e74 732c 2069 6e73  equirements, ins
-000006b0: 7461 6c6c 2048 6944 6966 6675 7369 6f6e  tall HiDiffusion
-000006c0: 3a0a 6060 6073 6865 6c6c 0a70 6970 3320  :.```shell.pip3 
-000006d0: 696e 7374 616c 6c20 6869 6469 6666 7573  install hidiffus
-000006e0: 696f 6e0a 6060 600a 2323 2320 496e 7374  ion.```.### Inst
-000006f0: 616c 6c69 6e67 2066 726f 6d20 736f 7572  alling from sour
-00000700: 6365 0a41 6c74 6572 6e61 7469 7665 6c79  ce.Alternatively
-00000710: 2c20 796f 7520 6361 6e20 696e 7374 616c  , you can instal
-00000720: 6c20 6672 6f6d 2067 6974 6875 6220 736f  l from github so
-00000730: 7572 6365 2e20 436c 6f6e 6520 7468 6520  urce. Clone the 
-00000740: 7265 706f 7369 746f 7279 2061 6e64 2069  repository and i
-00000750: 6e73 7461 6c6c 3a0a 6060 6062 6173 680a  nstall:.```bash.
-00000760: 6769 7420 636c 6f6e 6520 6874 7470 733a  git clone https:
-00000770: 2f2f 6769 7468 7562 2e63 6f6d 2f53 6865  //github.com/She
-00000780: 6e5a 6861 6e67 2d53 6869 6e2f 4869 4469  nZhang-Shin/HiDi
-00000790: 6666 7573 696f 6e2e 6769 740a 6364 2048  ffusion.git.cd H
-000007a0: 6944 6966 6675 7369 6f6e 0a70 7974 686f  iDiffusion.pytho
-000007b0: 6e33 2073 6574 7570 2e70 7920 696e 7374  n3 setup.py inst
-000007c0: 616c 6c0a 6060 600a 0a0a 2323 20f0 9f9a  all.```...## ...
-000007d0: 8020 5573 6167 650a 0a47 656e 6572 6174  . Usage..Generat
-000007e0: 696e 6720 6f75 7470 7574 7320 7769 7468  ing outputs with
-000007f0: 2048 6944 6966 6675 7369 6f6e 2069 7320   HiDiffusion is 
-00000800: 7375 7065 7220 6561 7379 2062 6173 6564  super easy based
-00000810: 206f 6e20 f09f a497 205b 6469 6666 7573   on .... [diffus
-00000820: 6572 735d 2868 7474 7073 3a2f 2f67 6974  ers](https://git
-00000830: 6875 622e 636f 6d2f 6875 6767 696e 6766  hub.com/huggingf
-00000840: 6163 652f 6469 6666 7573 6572 732f 7472  ace/diffusers/tr
-00000850: 6565 2f6d 6169 6e29 2e0a 0a23 2320 5465  ee/main)...## Te
-00000860: 7874 2d74 6f2d 696d 6167 6520 6765 6e65  xt-to-image gene
-00000870: 7261 7469 6f6e 0a0a 2323 2320 5374 6162  ration..### Stab
-00000880: 6c65 2044 6966 6675 7369 6f6e 2058 4c0a  le Diffusion XL.
-00000890: 0a60 6060 7079 7468 6f6e 0a66 726f 6d20  .```python.from 
-000008a0: 6869 6469 6666 7573 696f 6e20 696d 706f  hidiffusion impo
-000008b0: 7274 2061 7070 6c79 5f68 6964 6966 6675  rt apply_hidiffu
-000008c0: 7369 6f6e 2c20 7265 6d6f 7665 5f68 6964  sion, remove_hid
-000008d0: 6966 6675 7369 6f6e 0a66 726f 6d20 6469  iffusion.from di
-000008e0: 6666 7573 6572 7320 696d 706f 7274 2053  ffusers import S
-000008f0: 7461 626c 6544 6966 6675 7369 6f6e 584c  tableDiffusionXL
-00000900: 5069 7065 6c69 6e65 2c20 4444 494d 5363  Pipeline, DDIMSc
-00000910: 6865 6475 6c65 720a 696d 706f 7274 2074  heduler.import t
-00000920: 6f72 6368 0a70 7265 7472 6169 6e5f 6d6f  orch.pretrain_mo
-00000930: 6465 6c20 3d20 2273 7461 6269 6c69 7479  del = "stability
-00000940: 6169 2f73 7461 626c 652d 6469 6666 7573  ai/stable-diffus
-00000950: 696f 6e2d 786c 2d62 6173 652d 312e 3022  ion-xl-base-1.0"
-00000960: 0a73 6368 6564 756c 6572 203d 2044 4449  .scheduler = DDI
-00000970: 4d53 6368 6564 756c 6572 2e66 726f 6d5f  MScheduler.from_
-00000980: 7072 6574 7261 696e 6564 2870 7265 7472  pretrained(pretr
-00000990: 6169 6e5f 6d6f 6465 6c2c 2073 7562 666f  ain_model, subfo
-000009a0: 6c64 6572 3d22 7363 6865 6475 6c65 7222  lder="scheduler"
-000009b0: 290a 7069 7065 203d 2053 7461 626c 6544  ).pipe = StableD
-000009c0: 6966 6675 7369 6f6e 584c 5069 7065 6c69  iffusionXLPipeli
-000009d0: 6e65 2e66 726f 6d5f 7072 6574 7261 696e  ne.from_pretrain
-000009e0: 6564 2870 7265 7472 6169 6e5f 6d6f 6465  ed(pretrain_mode
-000009f0: 6c2c 2073 6368 6564 756c 6572 203d 2073  l, scheduler = s
-00000a00: 6368 6564 756c 6572 2c20 746f 7263 685f  cheduler, torch_
-00000a10: 6474 7970 653d 746f 7263 682e 666c 6f61  dtype=torch.floa
-00000a20: 7431 362c 2076 6172 6961 6e74 3d22 6670  t16, variant="fp
-00000a30: 3136 2229 2e74 6f28 2263 7564 6122 290a  16").to("cuda").
-00000a40: 0a23 2023 204f 7074 696f 6e61 6c2e 2065  .# # Optional. e
-00000a50: 6e61 626c 655f 7866 6f72 6d65 7273 5f6d  nable_xformers_m
-00000a60: 656d 6f72 795f 6566 6669 6369 656e 745f  emory_efficient_
-00000a70: 6174 7465 6e74 696f 6e20 6361 6e20 7361  attention can sa
-00000a80: 7665 206d 656d 6f72 7920 7573 6167 6520  ve memory usage 
-00000a90: 616e 6420 696e 6372 6561 7365 2069 6e66  and increase inf
-00000aa0: 6572 656e 6365 2073 7065 6564 2e20 656e  erence speed. en
-00000ab0: 6162 6c65 5f6d 6f64 656c 5f63 7075 5f6f  able_model_cpu_o
-00000ac0: 6666 6c6f 6164 2061 6e64 2065 6e61 626c  ffload and enabl
-00000ad0: 655f 7661 655f 7469 6c69 6e67 2063 616e  e_vae_tiling can
-00000ae0: 2073 6176 6520 6d65 6d6f 7279 2075 7361   save memory usa
-00000af0: 6765 2e0a 2320 7069 7065 2e65 6e61 626c  ge..# pipe.enabl
-00000b00: 655f 7866 6f72 6d65 7273 5f6d 656d 6f72  e_xformers_memor
-00000b10: 795f 6566 6669 6369 656e 745f 6174 7465  y_efficient_atte
-00000b20: 6e74 696f 6e28 290a 2320 7069 7065 2e65  ntion().# pipe.e
-00000b30: 6e61 626c 655f 6d6f 6465 6c5f 6370 755f  nable_model_cpu_
-00000b40: 6f66 666c 6f61 6428 290a 2320 7069 7065  offload().# pipe
-00000b50: 2e65 6e61 626c 655f 7661 655f 7469 6c69  .enable_vae_tili
-00000b60: 6e67 2829 0a0a 2320 4170 706c 7920 6869  ng()..# Apply hi
-00000b70: 6469 6666 7573 696f 6e20 7769 7468 2061  diffusion with a
-00000b80: 2073 696e 676c 6520 6c69 6e65 206f 6620   single line of 
-00000b90: 636f 6465 2e0a 6170 706c 795f 6869 6469  code..apply_hidi
-00000ba0: 6666 7573 696f 6e28 7069 7065 290a 0a70  ffusion(pipe)..p
-00000bb0: 726f 6d70 7420 3d20 2253 7461 6e64 696e  rompt = "Standin
-00000bc0: 6720 7461 6c6c 2061 6d69 6473 7420 7468  g tall amidst th
-00000bd0: 6520 7275 696e 732c 2061 2073 746f 6e65  e ruins, a stone
-00000be0: 2067 6f6c 656d 2061 7761 6b65 6e73 2c20   golem awakens, 
-00000bf0: 7669 6e65 7320 616e 6420 666c 6f77 6572  vines and flower
-00000c00: 7320 7370 726f 7574 696e 6720 6672 6f6d  s sprouting from
-00000c10: 2074 6865 2063 7265 7669 6365 7320 696e   the crevices in
-00000c20: 2069 7473 2062 6f64 792e 220a 6e65 6761   its body.".nega
-00000c30: 7469 7665 5f70 726f 6d70 7420 3d20 2262  tive_prompt = "b
-00000c40: 6c75 7272 792c 2075 676c 792c 2064 7570  lurry, ugly, dup
-00000c50: 6c69 6361 7465 2c20 706f 6f72 6c79 2064  licate, poorly d
-00000c60: 7261 776e 2066 6163 652c 2064 6566 6f72  rawn face, defor
-00000c70: 6d65 642c 206d 6f73 6169 632c 2061 7274  med, mosaic, art
-00000c80: 6966 6163 7473 2c20 6261 6420 6c69 6d62  ifacts, bad limb
-00000c90: 7322 0a69 6d61 6765 203d 2070 6970 6528  s".image = pipe(
-00000ca0: 7072 6f6d 7074 2c20 6775 6964 616e 6365  prompt, guidance
-00000cb0: 5f73 6361 6c65 3d37 2e35 2c20 6865 6967  _scale=7.5, heig
-00000cc0: 6874 3d32 3034 382c 2077 6964 7468 3d32  ht=2048, width=2
-00000cd0: 3034 382c 2065 7461 3d31 2e30 2c20 6e65  048, eta=1.0, ne
-00000ce0: 6761 7469 7665 5f70 726f 6d70 743d 6e65  gative_prompt=ne
-00000cf0: 6761 7469 7665 5f70 726f 6d70 7429 2e69  gative_prompt).i
-00000d00: 6d61 6765 735b 305d 0a69 6d61 6765 2e73  mages[0].image.s
-00000d10: 6176 6528 6622 676f 6c65 6d2e 6a70 6722  ave(f"golem.jpg"
-00000d20: 290a 6060 600a 0a3c 6465 7461 696c 733e  ).```..<details>
-00000d30: 0a3c 7375 6d6d 6172 793e 4f75 7470 7574  .<summary>Output
-00000d40: 3a3c 2f73 756d 6d61 7279 3e0a 3c64 6976  :</summary>.<div
-00000d50: 2061 6c69 676e 3d22 6365 6e74 6572 223e   align="center">
-00000d60: 0a20 203c 696d 6720 7372 633d 2261 7373  .  <img src="ass
-00000d70: 6574 732f 7364 786c 2e6a 7067 2220 7769  ets/sdxl.jpg" wi
-00000d80: 6474 683d 2238 3030 2220 3e3c 2f69 6d67  dth="800" ></img
-00000d90: 3e0a 3c2f 6469 763e 0a3c 2f64 6574 6169  >.</div>.</detai
-00000da0: 6c73 3e0a 0a53 6574 2068 6569 6768 7420  ls>..Set height 
-00000db0: 3d20 3430 3936 2c20 7769 6474 6820 3d20  = 4096, width = 
-00000dc0: 3430 3936 2c20 616e 6420 796f 7520 6361  4096, and you ca
-00000dd0: 6e20 6765 7420 6f75 7470 7574 2077 6974  n get output wit
-00000de0: 6820 3430 3936 7834 3039 3620 7265 736f  h 4096x4096 reso
-00000df0: 6c75 7469 6f6e 2e0a 0a23 2323 2053 7461  lution...### Sta
-00000e00: 626c 6520 4469 6666 7573 696f 6e20 584c  ble Diffusion XL
-00000e10: 2054 7572 626f 0a0a 6060 6070 7974 686f   Turbo..```pytho
-00000e20: 6e0a 6672 6f6d 2068 6964 6966 6675 7369  n.from hidiffusi
-00000e30: 6f6e 2069 6d70 6f72 7420 6170 706c 795f  on import apply_
-00000e40: 6869 6469 6666 7573 696f 6e2c 2072 656d  hidiffusion, rem
-00000e50: 6f76 655f 6869 6469 6666 7573 696f 6e0a  ove_hidiffusion.
-00000e60: 6672 6f6d 2064 6966 6675 7365 7273 2069  from diffusers i
-00000e70: 6d70 6f72 7420 4175 746f 5069 7065 6c69  mport AutoPipeli
-00000e80: 6e65 466f 7254 6578 7432 496d 6167 650a  neForText2Image.
-00000e90: 696d 706f 7274 2074 6f72 6368 0a70 7265  import torch.pre
-00000ea0: 7472 6169 6e5f 6d6f 6465 6c20 3d20 2273  train_model = "s
-00000eb0: 7461 6269 6c69 7479 6169 2f73 6478 6c2d  tabilityai/sdxl-
-00000ec0: 7475 7262 6f22 0a70 6970 6520 3d20 4175  turbo".pipe = Au
-00000ed0: 746f 5069 7065 6c69 6e65 466f 7254 6578  toPipelineForTex
-00000ee0: 7432 496d 6167 652e 6672 6f6d 5f70 7265  t2Image.from_pre
-00000ef0: 7472 6169 6e65 6428 7072 6574 7261 696e  trained(pretrain
-00000f00: 5f6d 6f64 656c 2c20 746f 7263 685f 6474  _model, torch_dt
-00000f10: 7970 653d 746f 7263 682e 666c 6f61 7431  ype=torch.float1
-00000f20: 362c 2076 6172 6961 6e74 3d22 6670 3136  6, variant="fp16
-00000f30: 2229 2e74 6f28 2763 7564 6127 290a 0a23  ").to('cuda')..#
-00000f40: 2023 204f 7074 696f 6e61 6c2e 2065 6e61   # Optional. ena
-00000f50: 626c 655f 7866 6f72 6d65 7273 5f6d 656d  ble_xformers_mem
-00000f60: 6f72 795f 6566 6669 6369 656e 745f 6174  ory_efficient_at
-00000f70: 7465 6e74 696f 6e20 6361 6e20 7361 7665  tention can save
-00000f80: 206d 656d 6f72 7920 7573 6167 6520 616e   memory usage an
-00000f90: 6420 696e 6372 6561 7365 2069 6e66 6572  d increase infer
-00000fa0: 656e 6365 2073 7065 6564 2e20 656e 6162  ence speed. enab
-00000fb0: 6c65 5f6d 6f64 656c 5f63 7075 5f6f 6666  le_model_cpu_off
-00000fc0: 6c6f 6164 2061 6e64 2065 6e61 626c 655f  load and enable_
-00000fd0: 7661 655f 7469 6c69 6e67 2063 616e 2073  vae_tiling can s
-00000fe0: 6176 6520 6d65 6d6f 7279 2075 7361 6765  ave memory usage
-00000ff0: 2e0a 2320 7069 7065 2e65 6e61 626c 655f  ..# pipe.enable_
-00001000: 7866 6f72 6d65 7273 5f6d 656d 6f72 795f  xformers_memory_
-00001010: 6566 6669 6369 656e 745f 6174 7465 6e74  efficient_attent
-00001020: 696f 6e28 290a 2320 7069 7065 2e65 6e61  ion().# pipe.ena
-00001030: 626c 655f 6d6f 6465 6c5f 6370 755f 6f66  ble_model_cpu_of
-00001040: 666c 6f61 6428 290a 2320 7069 7065 2e65  fload().# pipe.e
-00001050: 6e61 626c 655f 7661 655f 7469 6c69 6e67  nable_vae_tiling
-00001060: 2829 0a0a 2320 4170 706c 7920 6869 6469  ()..# Apply hidi
-00001070: 6666 7573 696f 6e20 7769 7468 2061 2073  ffusion with a s
-00001080: 696e 676c 6520 6c69 6e65 206f 6620 636f  ingle line of co
-00001090: 6465 2e0a 6170 706c 795f 6869 6469 6666  de..apply_hidiff
-000010a0: 7573 696f 6e28 7069 7065 290a 0a70 726f  usion(pipe)..pro
-000010b0: 6d70 7420 3d20 2249 6e20 7468 6520 6465  mpt = "In the de
-000010c0: 7074 6873 206f 6620 6120 6d79 7374 6963  pths of a mystic
-000010d0: 616c 2066 6f72 6573 742c 2061 2072 6f62  al forest, a rob
-000010e0: 6f74 6963 206f 776c 2077 6974 6820 6e69  otic owl with ni
-000010f0: 6768 7420 7669 7369 6f6e 206c 656e 7365  ght vision lense
-00001100: 7320 666f 7220 6579 6573 2077 6174 6368  s for eyes watch
-00001110: 6573 206f 7665 7220 7468 6520 6e6f 6374  es over the noct
-00001120: 7572 6e61 6c20 6372 6561 7475 7265 732e  urnal creatures.
-00001130: 220a 696d 6167 6520 3d20 7069 7065 2870  ".image = pipe(p
-00001140: 726f 6d70 742c 206e 756d 5f69 6e66 6572  rompt, num_infer
-00001150: 656e 6365 5f73 7465 7073 3d34 2c20 6865  ence_steps=4, he
-00001160: 6967 6874 3d31 3032 342c 2077 6964 7468  ight=1024, width
-00001170: 3d31 3032 342c 2067 7569 6461 6e63 655f  =1024, guidance_
-00001180: 7363 616c 653d 302e 3029 2e69 6d61 6765  scale=0.0).image
-00001190: 735b 305d 0a69 6d61 6765 2e73 6176 6528  s[0].image.save(
-000011a0: 6622 2e2f 6f77 6c2e 6a70 6722 290a 6060  f"./owl.jpg").``
-000011b0: 600a 0a3c 6465 7461 696c 733e 0a3c 7375  `..<details>.<su
-000011c0: 6d6d 6172 793e 4f75 7470 7574 3a3c 2f73  mmary>Output:</s
-000011d0: 756d 6d61 7279 3e0a 3c64 6976 2061 6c69  ummary>.<div ali
-000011e0: 676e 3d22 6365 6e74 6572 223e 0a20 203c  gn="center">.  <
-000011f0: 696d 6720 7372 633d 2261 7373 6574 732f  img src="assets/
-00001200: 7364 786c 5f74 7572 626f 2e6a 7067 2220  sdxl_turbo.jpg" 
-00001210: 7769 6474 683d 2238 3030 2220 3e3c 2f69  width="800" ></i
-00001220: 6d67 3e0a 3c2f 6469 763e 0a3c 2f64 6574  mg>.</div>.</det
-00001230: 6169 6c73 3e0a 0a23 2323 2053 7461 626c  ails>..### Stabl
-00001240: 6520 4469 6666 7573 696f 6e20 7632 2d31  e Diffusion v2-1
-00001250: 0a0a 6060 6070 7974 686f 6e0a 6672 6f6d  ..```python.from
-00001260: 2068 6964 6966 6675 7369 6f6e 2069 6d70   hidiffusion imp
-00001270: 6f72 7420 6170 706c 795f 6869 6469 6666  ort apply_hidiff
-00001280: 7573 696f 6e2c 2072 656d 6f76 655f 6869  usion, remove_hi
-00001290: 6469 6666 7573 696f 6e0a 6672 6f6d 2064  diffusion.from d
-000012a0: 6966 6675 7365 7273 2069 6d70 6f72 7420  iffusers import 
-000012b0: 4469 6666 7573 696f 6e50 6970 656c 696e  DiffusionPipelin
-000012c0: 652c 2044 4449 4d53 6368 6564 756c 6572  e, DDIMScheduler
-000012d0: 0a69 6d70 6f72 7420 746f 7263 680a 7072  .import torch.pr
-000012e0: 6574 7261 696e 5f6d 6f64 656c 203d 2022  etrain_model = "
-000012f0: 7374 6162 696c 6974 7961 692f 7374 6162  stabilityai/stab
-00001300: 6c65 2d64 6966 6675 7369 6f6e 2d32 2d31  le-diffusion-2-1
-00001310: 2d62 6173 6522 0a73 6368 6564 756c 6572  -base".scheduler
-00001320: 203d 2044 4449 4d53 6368 6564 756c 6572   = DDIMScheduler
-00001330: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
-00001340: 2870 7265 7472 6169 6e5f 6d6f 6465 6c2c  (pretrain_model,
-00001350: 2073 7562 666f 6c64 6572 3d22 7363 6865   subfolder="sche
-00001360: 6475 6c65 7222 290a 7069 7065 203d 2044  duler").pipe = D
-00001370: 6966 6675 7369 6f6e 5069 7065 6c69 6e65  iffusionPipeline
-00001380: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
-00001390: 2870 7265 7472 6169 6e5f 6d6f 6465 6c2c  (pretrain_model,
-000013a0: 2073 6368 6564 756c 6572 203d 2073 6368   scheduler = sch
-000013b0: 6564 756c 6572 2c20 746f 7263 685f 6474  eduler, torch_dt
-000013c0: 7970 653d 746f 7263 682e 666c 6f61 7431  ype=torch.float1
-000013d0: 3629 2e74 6f28 2263 7564 6122 290a 0a23  6).to("cuda")..#
-000013e0: 2023 204f 7074 696f 6e61 6c2e 2065 6e61   # Optional. ena
-000013f0: 626c 655f 7866 6f72 6d65 7273 5f6d 656d  ble_xformers_mem
-00001400: 6f72 795f 6566 6669 6369 656e 745f 6174  ory_efficient_at
-00001410: 7465 6e74 696f 6e20 6361 6e20 7361 7665  tention can save
-00001420: 206d 656d 6f72 7920 7573 6167 6520 616e   memory usage an
-00001430: 6420 696e 6372 6561 7365 2069 6e66 6572  d increase infer
-00001440: 656e 6365 2073 7065 6564 2e20 656e 6162  ence speed. enab
-00001450: 6c65 5f6d 6f64 656c 5f63 7075 5f6f 6666  le_model_cpu_off
-00001460: 6c6f 6164 2061 6e64 2065 6e61 626c 655f  load and enable_
-00001470: 7661 655f 7469 6c69 6e67 2063 616e 2073  vae_tiling can s
-00001480: 6176 6520 6d65 6d6f 7279 2075 7361 6765  ave memory usage
-00001490: 2e0a 2320 7069 7065 2e65 6e61 626c 655f  ..# pipe.enable_
-000014a0: 7866 6f72 6d65 7273 5f6d 656d 6f72 795f  xformers_memory_
-000014b0: 6566 6669 6369 656e 745f 6174 7465 6e74  efficient_attent
-000014c0: 696f 6e28 290a 2320 7069 7065 2e65 6e61  ion().# pipe.ena
-000014d0: 626c 655f 6d6f 6465 6c5f 6370 755f 6f66  ble_model_cpu_of
-000014e0: 666c 6f61 6428 290a 2320 7069 7065 2e65  fload().# pipe.e
-000014f0: 6e61 626c 655f 7661 655f 7469 6c69 6e67  nable_vae_tiling
-00001500: 2829 0a0a 2320 4170 706c 7920 6869 6469  ()..# Apply hidi
-00001510: 6666 7573 696f 6e20 7769 7468 2061 2073  ffusion with a s
-00001520: 696e 676c 6520 6c69 6e65 206f 6620 636f  ingle line of co
-00001530: 6465 2e0a 6170 706c 795f 6869 6469 6666  de..apply_hidiff
-00001540: 7573 696f 6e28 7069 7065 290a 0a70 726f  usion(pipe)..pro
-00001550: 6d70 7420 3d20 2241 6e20 6164 6f72 6162  mpt = "An adorab
-00001560: 6c65 2068 6170 7079 2062 726f 776e 2062  le happy brown b
-00001570: 6f72 6465 7220 636f 6c6c 6965 2073 6974  order collie sit
-00001580: 7469 6e67 206f 6e20 6120 6265 642c 2068  ting on a bed, h
-00001590: 6967 6820 6465 7461 696c 2e22 0a6e 6567  igh detail.".neg
-000015a0: 6174 6976 655f 7072 6f6d 7074 203d 2022  ative_prompt = "
-000015b0: 7567 6c79 2c20 7469 6c69 6e67 2c20 6f75  ugly, tiling, ou
-000015c0: 7420 6f66 2066 7261 6d65 2c20 706f 6f72  t of frame, poor
-000015d0: 6c79 2064 7261 776e 2066 6163 652c 2065  ly drawn face, e
-000015e0: 7874 7261 206c 696d 6273 2c20 6469 7366  xtra limbs, disf
-000015f0: 6967 7572 6564 2c20 6465 666f 726d 6564  igured, deformed
-00001600: 2c20 626f 6479 206f 7574 206f 6620 6672  , body out of fr
-00001610: 616d 652c 2062 6c75 7272 792c 2062 6164  ame, blurry, bad
-00001620: 2061 6e61 746f 6d79 2c20 626c 7572 7265   anatomy, blurre
-00001630: 642c 2061 7274 6966 6163 7473 2c20 6261  d, artifacts, ba
-00001640: 6420 7072 6f70 6f72 7469 6f6e 732e 220a  d proportions.".
-00001650: 696d 6167 6520 3d20 7069 7065 2870 726f  image = pipe(pro
-00001660: 6d70 742c 2067 7569 6461 6e63 655f 7363  mpt, guidance_sc
-00001670: 616c 653d 372e 352c 2068 6569 6768 743d  ale=7.5, height=
-00001680: 3130 3234 2c20 7769 6474 683d 3130 3234  1024, width=1024
-00001690: 2c20 6574 613d 312e 302c 206e 6567 6174  , eta=1.0, negat
-000016a0: 6976 655f 7072 6f6d 7074 3d6e 6567 6174  ive_prompt=negat
-000016b0: 6976 655f 7072 6f6d 7074 292e 696d 6167  ive_prompt).imag
-000016c0: 6573 5b30 5d0a 696d 6167 652e 7361 7665  es[0].image.save
-000016d0: 2866 2263 6f6c 6c69 652e 6a70 6722 290a  (f"collie.jpg").
-000016e0: 6060 600a 0a3c 6465 7461 696c 733e 0a3c  ```..<details>.<
-000016f0: 7375 6d6d 6172 793e 4f75 7470 7574 3a3c  summary>Output:<
-00001700: 2f73 756d 6d61 7279 3e0a 3c64 6976 2061  /summary>.<div a
-00001710: 6c69 676e 3d22 6365 6e74 6572 223e 0a20  lign="center">. 
-00001720: 203c 696d 6720 7372 633d 2261 7373 6574   <img src="asset
-00001730: 732f 7364 3231 2e6a 7067 2220 7769 6474  s/sd21.jpg" widt
-00001740: 683d 2238 3030 2220 3e3c 2f69 6d67 3e0a  h="800" ></img>.
-00001750: 3c2f 6469 763e 0a3c 2f64 6574 6169 6c73  </div>.</details
-00001760: 3e0a 0a53 6574 2068 6569 6768 7420 3d20  >..Set height = 
-00001770: 3230 3438 2c20 7769 6474 6820 3d20 3230  2048, width = 20
-00001780: 3438 2c20 616e 6420 796f 7520 6361 6e20  48, and you can 
-00001790: 6765 7420 6f75 7470 7574 2077 6974 6820  get output with 
-000017a0: 3230 3438 7832 3034 3820 7265 736f 6c75  2048x2048 resolu
-000017b0: 7469 6f6e 2e0a 0a0a 0a23 2323 2053 7461  tion.....### Sta
-000017c0: 626c 6520 4469 6666 7573 696f 6e20 7631  ble Diffusion v1
-000017d0: 2d35 0a0a 6060 6070 7974 686f 6e0a 6672  -5..```python.fr
-000017e0: 6f6d 2068 6964 6966 6675 7369 6f6e 2069  om hidiffusion i
-000017f0: 6d70 6f72 7420 6170 706c 795f 6869 6469  mport apply_hidi
-00001800: 6666 7573 696f 6e2c 2072 656d 6f76 655f  ffusion, remove_
-00001810: 6869 6469 6666 7573 696f 6e0a 6672 6f6d  hidiffusion.from
-00001820: 2064 6966 6675 7365 7273 2069 6d70 6f72   diffusers impor
-00001830: 7420 4469 6666 7573 696f 6e50 6970 656c  t DiffusionPipel
-00001840: 696e 652c 2044 4449 4d53 6368 6564 756c  ine, DDIMSchedul
-00001850: 6572 0a69 6d70 6f72 7420 746f 7263 680a  er.import torch.
-00001860: 7072 6574 7261 696e 5f6d 6f64 656c 203d  pretrain_model =
-00001870: 2022 7275 6e77 6179 6d6c 2f73 7461 626c   "runwayml/stabl
-00001880: 652d 6469 6666 7573 696f 6e2d 7631 2d35  e-diffusion-v1-5
-00001890: 220a 7363 6865 6475 6c65 7220 3d20 4444  ".scheduler = DD
-000018a0: 494d 5363 6865 6475 6c65 722e 6672 6f6d  IMScheduler.from
-000018b0: 5f70 7265 7472 6169 6e65 6428 7072 6574  _pretrained(pret
-000018c0: 7261 696e 5f6d 6f64 656c 2c20 7375 6266  rain_model, subf
-000018d0: 6f6c 6465 723d 2273 6368 6564 756c 6572  older="scheduler
-000018e0: 2229 0a70 6970 6520 3d20 4469 6666 7573  ").pipe = Diffus
-000018f0: 696f 6e50 6970 656c 696e 652e 6672 6f6d  ionPipeline.from
-00001900: 5f70 7265 7472 6169 6e65 6428 7072 6574  _pretrained(pret
-00001910: 7261 696e 5f6d 6f64 656c 2c20 7363 6865  rain_model, sche
-00001920: 6475 6c65 7220 3d20 7363 6865 6475 6c65  duler = schedule
-00001930: 722c 2074 6f72 6368 5f64 7479 7065 3d74  r, torch_dtype=t
-00001940: 6f72 6368 2e66 6c6f 6174 3136 292e 746f  orch.float16).to
-00001950: 2822 6375 6461 2229 0a0a 2320 2320 4f70  ("cuda")..# # Op
-00001960: 7469 6f6e 616c 2e20 656e 6162 6c65 5f78  tional. enable_x
-00001970: 666f 726d 6572 735f 6d65 6d6f 7279 5f65  formers_memory_e
-00001980: 6666 6963 6965 6e74 5f61 7474 656e 7469  fficient_attenti
-00001990: 6f6e 2063 616e 2073 6176 6520 6d65 6d6f  on can save memo
-000019a0: 7279 2075 7361 6765 2061 6e64 2069 6e63  ry usage and inc
-000019b0: 7265 6173 6520 696e 6665 7265 6e63 6520  rease inference 
-000019c0: 7370 6565 642e 2065 6e61 626c 655f 6d6f  speed. enable_mo
-000019d0: 6465 6c5f 6370 755f 6f66 666c 6f61 6420  del_cpu_offload 
-000019e0: 616e 6420 656e 6162 6c65 5f76 6165 5f74  and enable_vae_t
-000019f0: 696c 696e 6720 6361 6e20 7361 7665 206d  iling can save m
-00001a00: 656d 6f72 7920 7573 6167 652e 0a23 2070  emory usage..# p
-00001a10: 6970 652e 656e 6162 6c65 5f78 666f 726d  ipe.enable_xform
-00001a20: 6572 735f 6d65 6d6f 7279 5f65 6666 6963  ers_memory_effic
-00001a30: 6965 6e74 5f61 7474 656e 7469 6f6e 2829  ient_attention()
-00001a40: 0a23 2070 6970 652e 656e 6162 6c65 5f6d  .# pipe.enable_m
-00001a50: 6f64 656c 5f63 7075 5f6f 6666 6c6f 6164  odel_cpu_offload
-00001a60: 2829 0a23 2070 6970 652e 656e 6162 6c65  ().# pipe.enable
-00001a70: 5f76 6165 5f74 696c 696e 6728 290a 0a23  _vae_tiling()..#
-00001a80: 2041 7070 6c79 2068 6964 6966 6675 7369   Apply hidiffusi
-00001a90: 6f6e 2077 6974 6820 6120 7369 6e67 6c65  on with a single
-00001aa0: 206c 696e 6520 6f66 2063 6f64 652e 0a61   line of code..a
-00001ab0: 7070 6c79 5f68 6964 6966 6675 7369 6f6e  pply_hidiffusion
-00001ac0: 2870 6970 6529 0a0a 7072 6f6d 7074 203d  (pipe)..prompt =
-00001ad0: 2022 7468 6963 6b20 7374 726f 6b65 732c   "thick strokes,
-00001ae0: 2062 7269 6768 7420 636f 6c6f 7273 2c20   bright colors, 
-00001af0: 616e 2065 786f 7469 6320 666f 782c 2063  an exotic fox, c
-00001b00: 7574 652c 2063 6869 6269 206b 6177 6169  ute, chibi kawai
-00001b10: 692e 2064 6574 6169 6c65 6420 6675 722c  i. detailed fur,
-00001b20: 2068 7970 6572 6465 7461 696c 6564 202c   hyperdetailed ,
-00001b30: 2062 6967 2072 6566 6c65 6374 6976 6520   big reflective 
-00001b40: 6579 6573 2c20 6661 6972 7974 616c 652c  eyes, fairytale,
-00001b50: 2061 7274 7374 6174 696f 6e2c 6365 6e74   artstation,cent
-00001b60: 6572 6564 2063 6f6d 706f 7369 7469 6f6e  ered composition
-00001b70: 2c20 7065 7266 6563 7420 636f 6d70 6f73  , perfect compos
-00001b80: 6974 696f 6e2c 2063 656e 7465 7265 642c  ition, centered,
-00001b90: 2076 6962 7261 6e74 2063 6f6c 6f72 732c   vibrant colors,
-00001ba0: 206d 7574 6564 2063 6f6c 6f72 732c 2068   muted colors, h
-00001bb0: 6967 6820 6465 7461 696c 6564 2c20 386b  igh detailed, 8k
-00001bc0: 2e22 0a6e 6567 6174 6976 655f 7072 6f6d  .".negative_prom
-00001bd0: 7074 203d 2022 7567 6c79 2c20 7469 6c69  pt = "ugly, tili
-00001be0: 6e67 2c20 706f 6f72 6c79 2064 7261 776e  ng, poorly drawn
-00001bf0: 2066 6163 652c 206f 7574 206f 6620 6672   face, out of fr
-00001c00: 616d 652c 2064 6973 6669 6775 7265 642c  ame, disfigured,
-00001c10: 2064 6566 6f72 6d65 642c 2062 6c75 7272   deformed, blurr
-00001c20: 792c 2062 6164 2061 6e61 746f 6d79 2c20  y, bad anatomy, 
-00001c30: 626c 7572 7265 642e 220a 696d 6167 6520  blurred.".image 
-00001c40: 3d20 7069 7065 2870 726f 6d70 742c 2067  = pipe(prompt, g
-00001c50: 7569 6461 6e63 655f 7363 616c 653d 372e  uidance_scale=7.
-00001c60: 352c 2068 6569 6768 743d 3130 3234 2c20  5, height=1024, 
-00001c70: 7769 6474 683d 3130 3234 2c20 6574 613d  width=1024, eta=
-00001c80: 312e 302c 206e 6567 6174 6976 655f 7072  1.0, negative_pr
-00001c90: 6f6d 7074 3d6e 6567 6174 6976 655f 7072  ompt=negative_pr
-00001ca0: 6f6d 7074 292e 696d 6167 6573 5b30 5d0a  ompt).images[0].
-00001cb0: 696d 6167 652e 7361 7665 2866 2266 6f78  image.save(f"fox
-00001cc0: 2e6a 7067 2229 0a60 6060 0a0a 3c64 6574  .jpg").```..<det
-00001cd0: 6169 6c73 3e0a 3c73 756d 6d61 7279 3e4f  ails>.<summary>O
-00001ce0: 7574 7075 743a 3c2f 7375 6d6d 6172 793e  utput:</summary>
-00001cf0: 0a3c 6469 7620 616c 6967 6e3d 2263 656e  .<div align="cen
-00001d00: 7465 7222 3e0a 2020 3c69 6d67 2073 7263  ter">.  <img src
-00001d10: 3d22 6173 7365 7473 2f73 6431 352e 6a70  ="assets/sd15.jp
-00001d20: 6722 2077 6964 7468 3d22 3830 3022 203e  g" width="800" >
-00001d30: 3c2f 696d 673e 0a3c 2f64 6976 3e0a 3c2f  </img>.</div>.</
-00001d40: 6465 7461 696c 733e 0a0a 5365 7420 6865  details>..Set he
-00001d50: 6967 6874 203d 2032 3034 382c 2077 6964  ight = 2048, wid
-00001d60: 7468 203d 2032 3034 382c 2061 6e64 2079  th = 2048, and y
-00001d70: 6f75 2063 616e 2067 6574 206f 7574 7075  ou can get outpu
-00001d80: 7420 7769 7468 2032 3034 3878 3230 3438  t with 2048x2048
-00001d90: 2072 6573 6f6c 7574 696f 6e2e 0a0a 2323   resolution...##
-00001da0: 2320 5265 6d6f 7665 2048 6944 6966 6675  # Remove HiDiffu
-00001db0: 7369 6f6e 0a0a 4966 2079 6f75 2077 616e  sion..If you wan
-00001dc0: 7420 746f 2072 656d 6f76 6520 4869 4469  t to remove HiDi
-00001dd0: 6966 6675 7369 6f6e 2c20 7369 6d70 6c79  iffusion, simply
-00001de0: 2075 7365 2060 7265 6d6f 7665 5f68 6964   use `remove_hid
-00001df0: 6966 6675 7369 6f6e 2870 6970 6529 602e  iffusion(pipe)`.
-00001e00: 0a0a 2323 2043 6f6e 7472 6f6c 4e65 740a  ..## ControlNet.
-00001e10: 0a60 6060 7079 7468 6f6e 0a66 726f 6d20  .```python.from 
-00001e20: 6469 6666 7573 6572 7320 696d 706f 7274  diffusers import
-00001e30: 2053 7461 626c 6544 6966 6675 7369 6f6e   StableDiffusion
-00001e40: 584c 436f 6e74 726f 6c4e 6574 5069 7065  XLControlNetPipe
-00001e50: 6c69 6e65 2c20 436f 6e74 726f 6c4e 6574  line, ControlNet
-00001e60: 4d6f 6465 6c2c 2044 4449 4d53 6368 6564  Model, DDIMSched
-00001e70: 756c 6572 0a69 6d70 6f72 7420 6e75 6d70  uler.import nump
-00001e80: 7920 6173 206e 700a 696d 706f 7274 2074  y as np.import t
-00001e90: 6f72 6368 0a69 6d70 6f72 7420 6376 320a  orch.import cv2.
-00001ea0: 6672 6f6d 2050 494c 2069 6d70 6f72 7420  from PIL import 
-00001eb0: 496d 6167 650a 6672 6f6d 2068 6964 6966  Image.from hidif
-00001ec0: 6675 7369 6f6e 2069 6d70 6f72 7420 6170  fusion import ap
-00001ed0: 706c 795f 6869 6469 6666 7573 696f 6e2c  ply_hidiffusion,
-00001ee0: 2072 656d 6f76 655f 6869 6469 6666 7573   remove_hidiffus
-00001ef0: 696f 6e0a 0a23 206c 6f61 6420 596f 7368  ion..# load Yosh
-00001f00: 7561 5f42 656e 6769 6f2e 6a70 6720 696e  ua_Bengio.jpg in
-00001f10: 2074 6865 2061 7373 6574 7320 6669 6c65   the assets file
-00001f20: 2e0a 7061 7468 203d 2027 596f 7368 7561  ..path = 'Yoshua
-00001f30: 5f42 656e 6769 6f2e 6a70 6727 0a69 6d61  _Bengio.jpg'.ima
-00001f40: 6765 203d 2049 6d61 6765 2e6f 7065 6e28  ge = Image.open(
-00001f50: 7061 7468 290a 2320 6765 7420 6361 6e6e  path).# get cann
-00001f60: 7920 696d 6167 650a 696d 6167 6520 3d20  y image.image = 
-00001f70: 6e70 2e61 7272 6179 2869 6d61 6765 290a  np.array(image).
-00001f80: 696d 6167 6520 3d20 6376 322e 4361 6e6e  image = cv2.Cann
-00001f90: 7928 696d 6167 652c 2031 3030 2c20 3230  y(image, 100, 20
-00001fa0: 3029 0a69 6d61 6765 203d 2069 6d61 6765  0).image = image
-00001fb0: 5b3a 2c20 3a2c 204e 6f6e 655d 0a69 6d61  [:, :, None].ima
-00001fc0: 6765 203d 206e 702e 636f 6e63 6174 656e  ge = np.concaten
-00001fd0: 6174 6528 5b69 6d61 6765 2c20 696d 6167  ate([image, imag
-00001fe0: 652c 2069 6d61 6765 5d2c 2061 7869 733d  e, image], axis=
-00001ff0: 3229 0a63 616e 6e79 5f69 6d61 6765 203d  2).canny_image =
-00002000: 2049 6d61 6765 2e66 726f 6d61 7272 6179   Image.fromarray
-00002010: 2869 6d61 6765 290a 0a23 2069 6e69 7469  (image)..# initi
-00002020: 616c 697a 6520 7468 6520 6d6f 6465 6c73  alize the models
-00002030: 2061 6e64 2070 6970 656c 696e 650a 636f   and pipeline.co
-00002040: 6e74 726f 6c6e 6574 5f63 6f6e 6469 7469  ntrolnet_conditi
-00002050: 6f6e 696e 675f 7363 616c 6520 3d20 302e  oning_scale = 0.
-00002060: 3520 2023 2072 6563 6f6d 6d65 6e64 6564  5  # recommended
-00002070: 2066 6f72 2067 6f6f 6420 6765 6e65 7261   for good genera
-00002080: 6c69 7a61 7469 6f6e 0a63 6f6e 7472 6f6c  lization.control
-00002090: 6e65 7420 3d20 436f 6e74 726f 6c4e 6574  net = ControlNet
-000020a0: 4d6f 6465 6c2e 6672 6f6d 5f70 7265 7472  Model.from_pretr
-000020b0: 6169 6e65 6428 0a20 2020 2022 6469 6666  ained(.    "diff
-000020c0: 7573 6572 732f 636f 6e74 726f 6c6e 6574  users/controlnet
-000020d0: 2d63 616e 6e79 2d73 6478 6c2d 312e 3022  -canny-sdxl-1.0"
-000020e0: 2c20 746f 7263 685f 6474 7970 653d 746f  , torch_dtype=to
-000020f0: 7263 682e 666c 6f61 7431 362c 2076 6172  rch.float16, var
-00002100: 6961 6e74 3d22 6670 3136 220a 290a 7363  iant="fp16".).sc
-00002110: 6865 6475 6c65 7220 3d20 4444 494d 5363  heduler = DDIMSc
-00002120: 6865 6475 6c65 722e 6672 6f6d 5f70 7265  heduler.from_pre
-00002130: 7472 6169 6e65 6428 2273 7461 6269 6c69  trained("stabili
-00002140: 7479 6169 2f73 7461 626c 652d 6469 6666  tyai/stable-diff
-00002150: 7573 696f 6e2d 786c 2d62 6173 652d 312e  usion-xl-base-1.
-00002160: 3022 2c20 7375 6266 6f6c 6465 723d 2273  0", subfolder="s
-00002170: 6368 6564 756c 6572 2229 0a70 6970 6520  cheduler").pipe 
-00002180: 3d20 5374 6162 6c65 4469 6666 7573 696f  = StableDiffusio
-00002190: 6e58 4c43 6f6e 7472 6f6c 4e65 7450 6970  nXLControlNetPip
-000021a0: 656c 696e 652e 6672 6f6d 5f70 7265 7472  eline.from_pretr
-000021b0: 6169 6e65 6428 0a20 2020 2022 7374 6162  ained(.    "stab
-000021c0: 696c 6974 7961 692f 7374 6162 6c65 2d64  ilityai/stable-d
-000021d0: 6966 6675 7369 6f6e 2d78 6c2d 6261 7365  iffusion-xl-base
-000021e0: 2d31 2e30 222c 2063 6f6e 7472 6f6c 6e65  -1.0", controlne
-000021f0: 743d 636f 6e74 726f 6c6e 6574 2c20 746f  t=controlnet, to
-00002200: 7263 685f 6474 7970 653d 746f 7263 682e  rch_dtype=torch.
-00002210: 666c 6f61 7431 362c 0a20 2020 2073 6368  float16,.    sch
-00002220: 6564 756c 6572 203d 2073 6368 6564 756c  eduler = schedul
-00002230: 6572 0a29 0a70 6970 652e 656e 6162 6c65  er.).pipe.enable
-00002240: 5f6d 6f64 656c 5f63 7075 5f6f 6666 6c6f  _model_cpu_offlo
-00002250: 6164 2829 0a70 6970 652e 656e 6162 6c65  ad().pipe.enable
-00002260: 5f78 666f 726d 6572 735f 6d65 6d6f 7279  _xformers_memory
-00002270: 5f65 6666 6963 6965 6e74 5f61 7474 656e  _efficient_atten
-00002280: 7469 6f6e 2829 0a0a 7072 6f6d 7074 203d  tion()..prompt =
-00002290: 2022 6120 7a6f 6d62 6965 2c20 6869 6768   "a zombie, high
-000022a0: 2066 6163 6520 6465 7461 696c 2c20 6869   face detail, hi
-000022b0: 6768 2064 6574 6169 6c2c 206d 7574 6564  gh detail, muted
-000022c0: 2063 6f6c 6f72 2c20 386b 220a 6e65 6761   color, 8k".nega
-000022d0: 7469 7665 5f70 726f 6d70 7420 3d20 2262  tive_prompt = "b
-000022e0: 6c75 7272 792c 2075 676c 792c 2064 7570  lurry, ugly, dup
-000022f0: 6c69 6361 7465 2c20 706f 6f72 6c79 2064  licate, poorly d
-00002300: 7261 776e 2c20 6465 666f 726d 6564 2c20  rawn, deformed, 
-00002310: 6d6f 7361 6963 2c20 706f 6f72 6c79 2064  mosaic, poorly d
-00002320: 7261 776e 2074 6565 7468 2c20 6475 706c  rawn teeth, dupl
-00002330: 6963 6174 6564 2074 6565 7468 2e22 0a0a  icated teeth."..
-00002340: 2320 4170 706c 7920 6869 6469 6666 7573  # Apply hidiffus
-00002350: 696f 6e20 7769 7468 2061 2073 696e 676c  ion with a singl
-00002360: 6520 6c69 6e65 206f 6620 636f 6465 2e0a  e line of code..
-00002370: 6170 706c 795f 6869 6469 6666 7573 696f  apply_hidiffusio
-00002380: 6e28 7069 7065 290a 0a69 6d61 6765 203d  n(pipe)..image =
-00002390: 2070 6970 6528 0a20 2020 2070 726f 6d70   pipe(.    promp
-000023a0: 742c 2063 6f6e 7472 6f6c 6e65 745f 636f  t, controlnet_co
-000023b0: 6e64 6974 696f 6e69 6e67 5f73 6361 6c65  nditioning_scale
-000023c0: 3d63 6f6e 7472 6f6c 6e65 745f 636f 6e64  =controlnet_cond
-000023d0: 6974 696f 6e69 6e67 5f73 6361 6c65 2c20  itioning_scale, 
-000023e0: 696d 6167 653d 6361 6e6e 795f 696d 6167  image=canny_imag
-000023f0: 652c 0a20 2020 2068 6569 6768 743d 3230  e,.    height=20
-00002400: 3438 2c20 7769 6474 683d 3230 3438 2c20  48, width=2048, 
-00002410: 6775 6964 616e 6365 5f73 6361 6c65 3d37  guidance_scale=7
-00002420: 2e35 2c20 6e65 6761 7469 7665 5f70 726f  .5, negative_pro
-00002430: 6d70 7420 3d20 6e65 6761 7469 7665 5f70  mpt = negative_p
-00002440: 726f 6d70 742c 2065 7461 3d31 2e30 0a29  rompt, eta=1.0.)
-00002450: 2e69 6d61 6765 735b 305d 0a0a 696d 6167  .images[0]..imag
-00002460: 652e 7361 7665 2827 7a6f 6d62 6965 2e6a  e.save('zombie.j
-00002470: 7067 2729 0a60 6060 0a0a 3c64 6574 6169  pg').```..<detai
-00002480: 6c73 3e0a 3c73 756d 6d61 7279 3e4f 7574  ls>.<summary>Out
-00002490: 7075 743a 3c2f 7375 6d6d 6172 793e 0a3c  put:</summary>.<
-000024a0: 6469 7620 616c 6967 6e3d 2263 656e 7465  div align="cente
-000024b0: 7222 3e0a 2020 3c69 6d67 2073 7263 3d22  r">.  <img src="
-000024c0: 6173 7365 7473 2f63 6f6e 7472 6f6c 6e65  assets/controlne
-000024d0: 745f 7265 7375 6c74 2e6a 7067 2220 7769  t_result.jpg" wi
-000024e0: 6474 683d 2238 3030 2220 3e3c 2f69 6d67  dth="800" ></img
-000024f0: 3e0a 3c2f 6469 763e 0a3c 2f64 6574 6169  >.</div>.</detai
-00002500: 6c73 3e0a 0a23 2320 496e 7061 696e 7469  ls>..## Inpainti
-00002510: 6e67 0a0a 6060 6070 7974 686f 6e0a 696d  ng..```python.im
-00002520: 706f 7274 2074 6f72 6368 0a66 726f 6d20  port torch.from 
-00002530: 6469 6666 7573 6572 7320 696d 706f 7274  diffusers import
-00002540: 2041 7574 6f50 6970 656c 696e 6546 6f72   AutoPipelineFor
-00002550: 496e 7061 696e 7469 6e67 2c20 4444 494d  Inpainting, DDIM
-00002560: 5363 6865 6475 6c65 720a 6672 6f6d 2064  Scheduler.from d
-00002570: 6966 6675 7365 7273 2e75 7469 6c73 2069  iffusers.utils i
-00002580: 6d70 6f72 7420 6c6f 6164 5f69 6d61 6765  mport load_image
-00002590: 0a66 726f 6d20 6869 6469 6666 7573 696f  .from hidiffusio
-000025a0: 6e20 696d 706f 7274 2061 7070 6c79 5f68  n import apply_h
-000025b0: 6964 6966 6675 7369 6f6e 2c20 7265 6d6f  idiffusion, remo
-000025c0: 7665 5f68 6964 6966 6675 7369 6f6e 0a66  ve_hidiffusion.f
-000025d0: 726f 6d20 5049 4c20 696d 706f 7274 2049  rom PIL import I
-000025e0: 6d61 6765 0a0a 7363 6865 6475 6c65 7220  mage..scheduler 
-000025f0: 3d20 4444 494d 5363 6865 6475 6c65 722e  = DDIMScheduler.
-00002600: 6672 6f6d 5f70 7265 7472 6169 6e65 6428  from_pretrained(
-00002610: 2273 7461 6269 6c69 7479 6169 2f73 7461  "stabilityai/sta
-00002620: 626c 652d 6469 6666 7573 696f 6e2d 786c  ble-diffusion-xl
-00002630: 2d62 6173 652d 312e 3022 2c20 7375 6266  -base-1.0", subf
-00002640: 6f6c 6465 723d 2273 6368 6564 756c 6572  older="scheduler
-00002650: 2229 0a70 6970 656c 696e 6520 3d20 4175  ").pipeline = Au
-00002660: 746f 5069 7065 6c69 6e65 466f 7249 6e70  toPipelineForInp
-00002670: 6169 6e74 696e 672e 6672 6f6d 5f70 7265  ainting.from_pre
-00002680: 7472 6169 6e65 6428 0a20 2020 2022 6469  trained(.    "di
-00002690: 6666 7573 6572 732f 7374 6162 6c65 2d64  ffusers/stable-d
-000026a0: 6966 6675 7369 6f6e 2d78 6c2d 312e 302d  iffusion-xl-1.0-
-000026b0: 696e 7061 696e 7469 6e67 2d30 2e31 222c  inpainting-0.1",
-000026c0: 2074 6f72 6368 5f64 7479 7065 3d74 6f72   torch_dtype=tor
-000026d0: 6368 2e66 6c6f 6174 3136 2c20 7661 7269  ch.float16, vari
-000026e0: 616e 743d 2266 7031 3622 2c20 0a20 2020  ant="fp16", .   
-000026f0: 2073 6368 6564 756c 6572 3d73 6368 6564   scheduler=sched
-00002700: 756c 6572 0a29 0a0a 2320 4170 706c 7920  uler.)..# Apply 
-00002710: 6869 6469 6666 7573 696f 6e20 7769 7468  hidiffusion with
-00002720: 2061 2073 696e 676c 6520 6c69 6e65 206f   a single line o
-00002730: 6620 636f 6465 2e0a 6170 706c 795f 6869  f code..apply_hi
-00002740: 6469 6666 7573 696f 6e28 7069 7065 6c69  diffusion(pipeli
-00002750: 6e65 290a 0a70 6970 656c 696e 652e 656e  ne)..pipeline.en
-00002760: 6162 6c65 5f6d 6f64 656c 5f63 7075 5f6f  able_model_cpu_o
-00002770: 6666 6c6f 6164 2829 0a23 2072 656d 6f76  ffload().# remov
-00002780: 6520 666f 6c6c 6f77 696e 6720 6c69 6e65  e following line
-00002790: 2069 6620 7846 6f72 6d65 7273 2069 7320   if xFormers is 
-000027a0: 6e6f 7420 696e 7374 616c 6c65 640a 7069  not installed.pi
-000027b0: 7065 6c69 6e65 2e65 6e61 626c 655f 7866  peline.enable_xf
-000027c0: 6f72 6d65 7273 5f6d 656d 6f72 795f 6566  ormers_memory_ef
-000027d0: 6669 6369 656e 745f 6174 7465 6e74 696f  ficient_attentio
-000027e0: 6e28 290a 0a23 206c 6f61 6420 6261 7365  n()..# load base
-000027f0: 2061 6e64 206d 6173 6b20 696d 6167 650a   and mask image.
-00002800: 696d 675f 7572 6c20 3d20 2268 7474 7073  img_url = "https
-00002810: 3a2f 2f68 7567 6769 6e67 6661 6365 2e63  ://huggingface.c
-00002820: 6f2f 6461 7461 7365 7473 2f68 7567 6769  o/datasets/huggi
-00002830: 6e67 6661 6365 2f64 6f63 756d 656e 7461  ngface/documenta
-00002840: 7469 6f6e 2d69 6d61 6765 732f 7265 736f  tion-images/reso
-00002850: 6c76 652f 6d61 696e 2f64 6966 6675 7365  lve/main/diffuse
-00002860: 7273 2f73 6478 6c2d 7465 7874 3269 6d67  rs/sdxl-text2img
-00002870: 2e70 6e67 220a 696e 6974 5f69 6d61 6765  .png".init_image
-00002880: 203d 206c 6f61 645f 696d 6167 6528 696d   = load_image(im
-00002890: 675f 7572 6c29 0a23 206c 6f61 6420 6d61  g_url).# load ma
-000028a0: 736b 5f69 6d61 6765 2e6a 7067 2069 6e20  sk_image.jpg in 
-000028b0: 7468 6520 6173 7365 7473 2066 696c 652e  the assets file.
-000028c0: 0a6d 6173 6b5f 696d 6167 6520 3d20 496d  .mask_image = Im
-000028d0: 6167 652e 6f70 656e 2822 6d61 736b 5f69  age.open("mask_i
-000028e0: 6d61 6765 2e70 6e67 2229 0a0a 7072 6f6d  mage.png")..prom
-000028f0: 7074 203d 2020 2241 2073 7465 616d 7075  pt =  "A steampu
-00002900: 6e6b 2065 7870 6c6f 7265 7220 696e 2061  nk explorer in a
-00002910: 206c 6561 7468 6572 2061 7669 6174 6f72   leather aviator
-00002920: 2063 6170 2061 6e64 2067 6f67 676c 6573   cap and goggles
-00002930: 2c20 7769 7468 2061 2062 7261 7373 2074  , with a brass t
-00002940: 656c 6573 636f 7065 2069 6e20 6861 6e64  elescope in hand
-00002950: 2c20 7374 616e 6473 2061 6d69 6473 7420  , stands amidst 
-00002960: 746f 7765 7269 6e67 2061 6e63 6965 6e74  towering ancient
-00002970: 2074 7265 6573 2c20 7468 6569 7220 726f   trees, their ro
-00002980: 6f74 7320 656e 7477 696e 6564 2077 6974  ots entwined wit
-00002990: 6820 696e 7472 6963 6174 6520 6765 6172  h intricate gear
-000029a0: 7320 616e 6420 7069 7065 732e 220a 0a6e  s and pipes."..n
-000029b0: 6567 6174 6976 655f 7072 6f6d 7074 203d  egative_prompt =
-000029c0: 2022 626c 7572 7279 2c20 7567 6c79 2c20   "blurry, ugly, 
-000029d0: 6475 706c 6963 6174 652c 2070 6f6f 726c  duplicate, poorl
-000029e0: 7920 6472 6177 6e2c 2064 6566 6f72 6d65  y drawn, deforme
-000029f0: 642c 206d 6f73 6169 6322 0a69 6d61 6765  d, mosaic".image
-00002a00: 203d 2070 6970 656c 696e 6528 7072 6f6d   = pipeline(prom
-00002a10: 7074 3d70 726f 6d70 742c 2069 6d61 6765  pt=prompt, image
-00002a20: 3d69 6e69 745f 696d 6167 652c 206d 6173  =init_image, mas
-00002a30: 6b5f 696d 6167 653d 6d61 736b 5f69 6d61  k_image=mask_ima
-00002a40: 6765 2c20 6865 6967 6874 3d32 3034 382c  ge, height=2048,
-00002a50: 2077 6964 7468 3d32 3034 382c 2073 7472   width=2048, str
-00002a60: 656e 6774 683d 302e 3835 2c20 6775 6964  ength=0.85, guid
-00002a70: 616e 6365 5f73 6361 6c65 3d31 322e 352c  ance_scale=12.5,
-00002a80: 206e 6567 6174 6976 655f 7072 6f6d 7074   negative_prompt
-00002a90: 203d 206e 6567 6174 6976 655f 7072 6f6d   = negative_prom
-00002aa0: 7074 2c20 6574 613d 312e 3029 2e69 6d61  pt, eta=1.0).ima
-00002ab0: 6765 735b 305d 0a69 6d61 6765 2e73 6176  ges[0].image.sav
-00002ac0: 6528 2773 7465 616d 7075 6e6b 5f65 7870  e('steampunk_exp
-00002ad0: 6c6f 7265 722e 6a70 6727 290a 6060 600a  lorer.jpg').```.
-00002ae0: 0a3c 6465 7461 696c 733e 0a3c 7375 6d6d  .<details>.<summ
-00002af0: 6172 793e 4f75 7470 7574 3a3c 2f73 756d  ary>Output:</sum
-00002b00: 6d61 7279 3e0a 3c64 6976 2061 6c69 676e  mary>.<div align
-00002b10: 3d22 6365 6e74 6572 223e 0a20 203c 696d  ="center">.  <im
-00002b20: 6720 7372 633d 2261 7373 6574 732f 696e  g src="assets/in
-00002b30: 7061 696e 7469 6e67 5f72 6573 756c 742e  painting_result.
-00002b40: 6a70 6722 2077 6964 7468 3d22 3830 3022  jpg" width="800"
-00002b50: 203e 3c2f 696d 673e 0a3c 2f64 6976 3e0a   ></img>.</div>.
-00002b60: 3c2f 6465 7461 696c 733e 0a0a 2323 20f0  </details>..## .
-00002b70: 9f99 8f20 4163 6b6e 6f77 6c65 6467 656d  ... Acknowledgem
-00002b80: 656e 7473 0a0a 5468 6973 2069 6d70 6c65  ents..This imple
-00002b90: 6d65 6e74 6174 696f 6e20 6973 2062 6173  mentation is bas
-00002ba0: 6564 206f 6e20 5b74 6f6d 6573 645d 2868  ed on [tomesd](h
-00002bb0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-00002bc0: 6d2f 6462 6f6c 7961 2f74 6f6d 6573 6429  m/dbolya/tomesd)
-00002bd0: 2061 6e64 205b 6469 6666 7573 6572 735d   and [diffusers]
-00002be0: 2868 7474 7073 3a2f 2f67 6974 6875 622e  (https://github.
-00002bf0: 636f 6d2f 6875 6767 696e 6766 6163 652f  com/huggingface/
-00002c00: 6469 6666 7573 6572 732f 7472 6565 2f6d  diffusers/tree/m
-00002c10: 6169 6e29 2e20 5468 616e 6b73 210a 0a0a  ain). Thanks!...
-00002c20: 0a23 2320 f09f 8e93 2043 6974 6174 696f  .## .... Citatio
-00002c30: 6e0a 0a60 6060 0a40 6172 7469 636c 657b  n..```.@article{
-00002c40: 7a68 616e 6732 3032 3368 6964 6966 6675  zhang2023hidiffu
-00002c50: 7369 6f6e 2c0a 2020 7469 746c 653d 7b48  sion,.  title={H
-00002c60: 6944 6966 6675 7369 6f6e 3a20 556e 6c6f  iDiffusion: Unlo
-00002c70: 636b 696e 6720 4869 6768 6572 2d52 6573  cking Higher-Res
-00002c80: 6f6c 7574 696f 6e20 4372 6561 7469 7669  olution Creativi
-00002c90: 7479 2061 6e64 2045 6666 6963 6965 6e63  ty and Efficienc
-00002ca0: 7920 696e 2050 7265 7472 6169 6e65 6420  y in Pretrained 
-00002cb0: 4469 6666 7573 696f 6e20 4d6f 6465 6c73  Diffusion Models
-00002cc0: 7d2c 0a20 2061 7574 686f 723d 7b5a 6861  },.  author={Zha
-00002cd0: 6e67 2c20 5368 656e 2061 6e64 2043 6865  ng, Shen and Che
-00002ce0: 6e2c 205a 6861 6f77 6569 2061 6e64 205a  n, Zhaowei and Z
-00002cf0: 6861 6f2c 205a 6865 6e79 7520 616e 6420  hao, Zhenyu and 
-00002d00: 4368 656e 2c20 5975 6861 6f20 616e 6420  Chen, Yuhao and 
-00002d10: 5461 6e67 2c20 5961 6f20 616e 6420 4c69  Tang, Yao and Li
-00002d20: 616e 672c 204a 6961 6a75 6e7d 2c0a 2020  ang, Jiajun},.  
-00002d30: 6a6f 7572 6e61 6c3d 7b61 7258 6976 2070  journal={arXiv p
-00002d40: 7265 7072 696e 7420 6172 5869 763a 3233  reprint arXiv:23
-00002d50: 3131 2e31 3735 3238 7d2c 0a20 2079 6561  11.17528},.  yea
-00002d60: 723d 7b32 3032 337d 0a7d 0a60 6060 0a    r={2023}.}.```.
+00000000: 4d65 7461 6461 7461 2d56 6572 7369 6f6e  Metadata-Version
+00000010: 3a20 322e 310a 4e61 6d65 3a20 6869 6469  : 2.1.Name: hidi
+00000020: 6666 7573 696f 6e0a 5665 7273 696f 6e3a  ffusion.Version:
+00000030: 2030 2e31 2e32 0a53 756d 6d61 7279 3a20   0.1.2.Summary: 
+00000040: 4869 4469 6666 7573 696f 6e3a 2041 2074  HiDiffusion: A t
+00000050: 7261 696e 696e 672d 6672 6565 206d 6574  raining-free met
+00000060: 686f 6420 746f 2069 6e63 7265 6173 6520  hod to increase 
+00000070: 7468 6520 7265 736f 6c75 7469 6f6e 2061  the resolution a
+00000080: 6e64 2073 7065 6564 206f 6620 6469 6666  nd speed of diff
+00000090: 7573 696f 6e20 6d6f 6465 6c73 2e0a 486f  usion models..Ho
+000000a0: 6d65 2d70 6167 653a 200a 4175 7468 6f72  me-page: .Author
+000000b0: 3a20 5368 656e 205a 6861 6e67 2c20 5a68  : Shen Zhang, Zh
+000000c0: 616f 7765 6920 4368 656e 2c20 5a68 656e  aowei Chen, Zhen
+000000d0: 7975 205a 6861 6f2c 2059 7568 616f 2043  yu Zhao, Yuhao C
+000000e0: 6865 6e2c 2059 616f 2054 616e 672c 204a  hen, Yao Tang, J
+000000f0: 6961 6a75 6e20 4c69 616e 670a 4465 7363  iajun Liang.Desc
+00000100: 7269 7074 696f 6e2d 436f 6e74 656e 742d  ription-Content-
+00000110: 5479 7065 3a20 7465 7874 2f6d 6172 6b64  Type: text/markd
+00000120: 6f77 6e0a 0a3c 212d 2d20 2320 f09f 92a1  own..<!-- # ....
+00000130: 2048 6944 6966 6675 7369 6f6e 202d 2d3e   HiDiffusion -->
+00000140: 0a0a 2323 2320 3c64 6976 2061 6c69 676e  ..### <div align
+00000150: 3d22 6365 6e74 6572 223e f09f 92a1 2048  ="center">.... H
+00000160: 6944 6966 6675 7369 6f6e 3a20 556e 6c6f  iDiffusion: Unlo
+00000170: 636b 696e 6720 4869 6768 6572 2d52 6573  cking Higher-Res
+00000180: 6f6c 7574 696f 6e20 4372 6561 7469 7669  olution Creativi
+00000190: 7479 2061 6e64 2045 6666 6963 6965 6e63  ty and Efficienc
+000001a0: 7920 696e 2050 7265 7472 6169 6e65 6420  y in Pretrained 
+000001b0: 4469 6666 7573 696f 6e20 4d6f 6465 6c73  Diffusion Models
+000001c0: 3c2f 6469 763e 200a 0a3c 6469 7620 616c  </div> ..<div al
+000001d0: 6967 6e3d 2263 656e 7465 7222 3e53 6865  ign="center">She
+000001e0: 6e20 5a68 616e 672c 205a 6861 6f77 6569  n Zhang, Zhaowei
+000001f0: 2043 6865 6e2c 205a 6865 6e79 7520 5a68   Chen, Zhenyu Zh
+00000200: 616f 2c20 5975 6861 6f20 4368 656e 2c20  ao, Yuhao Chen, 
+00000210: 5961 6f20 5461 6e67 2c20 4a69 616a 756e  Yao Tang, Jiajun
+00000220: 204c 6961 6e67 3c2f 6469 763e 200a 0a3c   Liang</div> ..<
+00000230: 6272 3e0a 0a3c 6469 7620 616c 6967 6e3d  br>..<div align=
+00000240: 2263 656e 7465 7222 3e0a 2020 3c61 2068  "center">.  <a h
+00000250: 7265 663d 2268 7474 7073 3a2f 2f68 6964  ref="https://hid
+00000260: 6966 6675 7369 6f6e 2e67 6974 6875 622e  iffusion.github.
+00000270: 696f 2f22 3e3c 696d 6720 7372 633d 2268  io/"><img src="h
+00000280: 7474 7073 3a2f 2f69 6d67 2e73 6869 656c  ttps://img.shiel
+00000290: 6473 2e69 6f2f 7374 6174 6963 2f76 313f  ds.io/static/v1?
+000002a0: 6c61 6265 6c3d 5072 6f6a 6563 7425 3230  label=Project%20
+000002b0: 5061 6765 266d 6573 7361 6765 3d47 6974  Page&message=Git
+000002c0: 6875 6226 636f 6c6f 723d 626c 7565 266c  hub&color=blue&l
+000002d0: 6f67 6f3d 6769 7468 7562 2d70 6167 6573  ogo=github-pages
+000002e0: 223e 3c2f 613e 2026 656e 7370 3b0a 2020  "></a> &ensp;.  
+000002f0: 3c61 2068 7265 663d 2268 7474 7073 3a2f  <a href="https:/
+00000300: 2f61 7278 6976 2e6f 7267 2f61 6273 2f32  /arxiv.org/abs/2
+00000310: 3331 312e 3137 3532 3822 3e3c 696d 6720  311.17528"><img 
+00000320: 7372 633d 2268 7474 7073 3a2f 2f69 6d67  src="https://img
+00000330: 2e73 6869 656c 6473 2e69 6f2f 7374 6174  .shields.io/stat
+00000340: 6963 2f76 313f 6c61 6265 6c3d 5061 7065  ic/v1?label=Pape
+00000350: 7226 6d65 7373 6167 653d 4172 7869 763a  r&message=Arxiv:
+00000360: 4869 4469 6666 7573 696f 6e26 636f 6c6f  HiDiffusion&colo
+00000370: 723d 7265 6426 6c6f 676f 3d61 7278 6976  r=red&logo=arxiv
+00000380: 223e 3c2f 613e 2026 656e 7370 3b0a 2020  "></a> &ensp;.  
+00000390: 3c61 2068 7265 663d 2268 7474 7073 3a2f  <a href="https:/
+000003a0: 2f63 6f6c 6162 2e72 6573 6561 7263 682e  /colab.research.
+000003b0: 676f 6f67 6c65 2e63 6f6d 2f64 7269 7665  google.com/drive
+000003c0: 2f31 4569 426e 396c 536e 505a 5455 3463  /1EiBn9lSnPZTU4c
+000003d0: 696b 5252 6142 4265 7873 3432 394d 2d71  ikRRaBBexs429M-q
+000003e0: 7479 3f75 7370 3d73 6861 7269 6e67 223e  ty?usp=sharing">
+000003f0: 3c69 6d67 2073 7263 3d22 6874 7470 733a  <img src="https:
+00000400: 2f2f 696d 672e 7368 6965 6c64 732e 696f  //img.shields.io
+00000410: 2f73 7461 7469 632f 7631 3f6c 6162 656c  /static/v1?label
+00000420: 3d44 656d 6f26 6d65 7373 6167 653d 436f  =Demo&message=Co
+00000430: 6c61 6226 636f 6c6f 723d 7075 7270 6c65  lab&color=purple
+00000440: 266c 6f67 6f3d 676f 6f67 6c65 636f 6c61  &logo=googlecola
+00000450: 6222 3e3c 2f61 3e20 2665 6e73 703b 0a3c  b"></a> &ensp;.<
+00000460: 2f64 6976 3e0a 0a3c 6469 7620 616c 6967  /div>..<div alig
+00000470: 6e3d 2263 656e 7465 7222 3e0a 2020 3c69  n="center">.  <i
+00000480: 6d67 2073 7263 3d22 6173 7365 7473 2f69  mg src="assets/i
+00000490: 6d61 6765 5f67 616c 6c65 7279 2e6a 7067  mage_gallery.jpg
+000004a0: 2220 7769 6474 683d 2238 3030 2220 3e3c  " width="800" ><
+000004b0: 2f69 6d67 3e0a 2020 3c62 723e 0a20 203c  /img>.  <br>.  <
+000004c0: 656d 3e0a 2020 2020 2020 2853 656c 6563  em>.      (Selec
+000004d0: 7420 4869 4469 6666 7573 696f 6e20 7361  t HiDiffusion sa
+000004e0: 6d70 6c65 7320 666f 7220 7661 7269 6f75  mples for variou
+000004f0: 7320 6469 6666 7573 696f 6e20 6d6f 6465  s diffusion mode
+00000500: 6c73 2c20 7265 736f 6c75 7469 6f6e 732c  ls, resolutions,
+00000510: 2061 6e64 2061 7370 6563 7420 7261 7469   and aspect rati
+00000520: 6f73 2e29 200a 2020 3c2f 656d 3e0a 3c2f  os.) .  </em>.</
+00000530: 6469 763e 0a3c 6272 3e0a 0a0a 2320 f09f  div>.<br>...# ..
+00000540: 9189 2057 6879 2048 6944 6966 6675 7369  .. Why HiDiffusi
+00000550: 6f6e 0a0a 2d20 4120 202a 2a74 7261 696e  on..- A  **train
+00000560: 696e 672d 6672 6565 206d 6574 686f 6420  ing-free method 
+00000570: 7468 6174 2069 6e63 7265 6173 6573 2074  that increases t
+00000580: 6865 2072 6573 6f6c 7574 696f 6e20 616e  he resolution an
+00000590: 6420 7370 6565 6420 6f66 2070 7265 7472  d speed of pretr
+000005a0: 6169 6e65 6420 6469 6666 7573 696f 6e20  ained diffusion 
+000005b0: 6d6f 6465 6c73 2e2a 2a0a 2d20 4465 7369  models.**.- Desi
+000005c0: 676e 6564 2061 7320 6120 2a2a 706c 7567  gned as a **plug
+000005d0: 2d61 6e64 2d70 6c61 7920 696d 706c 656d  -and-play implem
+000005e0: 656e 7461 7469 6f6e 2a2a 2e20 4974 2063  entation**. It c
+000005f0: 616e 2062 6520 696e 7465 6772 6174 6564  an be integrated
+00000600: 2069 6e74 6f20 6469 6666 7573 696f 6e20   into diffusion 
+00000610: 7069 7065 6c69 6e65 7320 6279 202a 2a6f  pipelines by **o
+00000620: 6e6c 7920 6164 6469 6e67 2061 2073 696e  nly adding a sin
+00000630: 676c 6520 6c69 6e65 206f 6620 636f 6465  gle line of code
+00000640: 2a2a 210a 0a3c 6469 7620 616c 6967 6e3d  **!..<div align=
+00000650: 2263 656e 7465 7222 3e0a 2020 3c69 6d67  "center">.  <img
+00000660: 2073 7263 3d22 6173 7365 7473 2f71 7561   src="assets/qua
+00000670: 6c69 7479 5f65 6666 6963 6965 6e63 792e  lity_efficiency.
+00000680: 6a70 6722 2077 6964 7468 3d22 3830 3022  jpg" width="800"
+00000690: 203e 3c2f 696d 673e 0a20 203c 6272 3e0a   ></img>.  <br>.
+000006a0: 2020 3c65 6d3e 0a20 2020 2020 2028 4661    <em>.      (Fa
+000006b0: 7374 6572 2c20 616e 6420 6265 7474 6572  ster, and better
+000006c0: 2069 6d61 6765 2064 6574 6169 6c73 2e29   image details.)
+000006d0: 200a 2020 3c2f 656d 3e0a 3c2f 6469 763e   .  </em>.</div>
+000006e0: 0a3c 6272 3e0a 0a23 2320 f09f 93a2 2053  .<br>..## .... S
+000006f0: 7570 706f 7274 6564 204d 6f64 656c 730a  upported Models.
+00000700: 0a2d 20e2 9c85 205b 5374 6162 6c65 2044  .- ... [Stable D
+00000710: 6966 6675 7369 6f6e 2058 4c5d 2868 7474  iffusion XL](htt
+00000720: 7073 3a2f 2f68 7567 6769 6e67 6661 6365  ps://huggingface
+00000730: 2e63 6f2f 7061 7065 7273 2f32 3330 372e  .co/papers/2307.
+00000740: 3031 3935 3229 0a2d 20e2 9c85 205b 5374  01952).- ... [St
+00000750: 6162 6c65 2044 6966 6675 7369 6f6e 2058  able Diffusion X
+00000760: 4c20 5475 7262 6f5d 2868 7474 7073 3a2f  L Turbo](https:/
+00000770: 2f68 7567 6769 6e67 6661 6365 2e63 6f2f  /huggingface.co/
+00000780: 7374 6162 696c 6974 7961 692f 7364 786c  stabilityai/sdxl
+00000790: 2d74 7572 626f 290a 2d20 e29c 8520 5b53  -turbo).- ... [S
+000007a0: 7461 626c 6520 4469 6666 7573 696f 6e20  table Diffusion 
+000007b0: 7632 5d28 6874 7470 733a 2f2f 6875 6767  v2](https://hugg
+000007c0: 696e 6766 6163 652e 636f 2f73 7461 6269  ingface.co/stabi
+000007d0: 6c69 7479 6169 2f73 7461 626c 652d 6469  lityai/stable-di
+000007e0: 6666 7573 696f 6e2d 322d 3129 0a2d 20e2  ffusion-2-1).- .
+000007f0: 9c85 205b 5374 6162 6c65 2044 6966 6675  .. [Stable Diffu
+00000800: 7369 6f6e 2076 315d 2868 7474 7073 3a2f  sion v1](https:/
+00000810: 2f68 7567 6769 6e67 6661 6365 2e63 6f2f  /huggingface.co/
+00000820: 7275 6e77 6179 6d6c 2f73 7461 626c 652d  runwayml/stable-
+00000830: 6469 6666 7573 696f 6e2d 7631 2d35 290a  diffusion-v1-5).
+00000840: 0a2a 2a4e 6f74 652a 2a3a 2048 6944 6966  .**Note**: HiDif
+00000850: 6675 7369 6f6e 2061 6c73 6f20 7375 7070  fusion also supp
+00000860: 6f72 7473 2074 6865 2064 6f77 6e73 7472  orts the downstr
+00000870: 6561 6d20 6469 6666 7573 696f 6e20 6d6f  eam diffusion mo
+00000880: 6465 6c73 2062 6173 6564 206f 6e20 7468  dels based on th
+00000890: 6573 6520 7265 706f 7369 746f 7269 6573  ese repositories
+000008a0: 2c20 7375 6368 2061 7320 5b47 6869 626c  , such as [Ghibl
+000008b0: 692d 4469 6666 7573 696f 6e5d 2868 7474  i-Diffusion](htt
+000008c0: 7073 3a2f 2f68 7567 6769 6e67 6661 6365  ps://huggingface
+000008d0: 2e63 6f2f 6e69 7472 6f73 6f63 6b65 2f47  .co/nitrosocke/G
+000008e0: 6869 626c 692d 4469 6666 7573 696f 6e29  hibli-Diffusion)
+000008f0: 2c20 5b50 6c61 7967 726f 756e 645d 2868  , [Playground](h
+00000900: 7474 7073 3a2f 2f68 7567 6769 6e67 6661  ttps://huggingfa
+00000910: 6365 2e63 6f2f 706c 6179 6772 6f75 6e64  ce.co/playground
+00000920: 6169 2f70 6c61 7967 726f 756e 642d 7632  ai/playground-v2
+00000930: 2d31 3032 3470 782d 6165 7374 6865 7469  -1024px-aestheti
+00000940: 6329 2c20 6574 632e 0a0a 2323 20f0 9f92  c), etc...## ...
+00000950: a320 5375 7070 6f72 7465 6420 5461 736b  . Supported Task
+00000960: 730a 0a2d 20e2 9c85 2054 6578 742d 746f  s..- ... Text-to
+00000970: 2d69 6d61 6765 0a2d 20e2 9c85 2043 6f6e  -image.- ... Con
+00000980: 7472 6f6c 4e65 740a 2d20 e29c 8520 496e  trolNet.- ... In
+00000990: 7061 696e 7469 6e67 0a0a 0a23 2320 f09f  painting...## ..
+000009a0: 948e 204d 6169 6e20 7265 7175 6972 656d  .. Main requirem
+000009b0: 656e 7473 0a54 6869 7320 7265 706f 7369  ents.This reposi
+000009c0: 746f 7279 2069 7320 7465 7374 6564 206f  tory is tested o
+000009d0: 6e0a 2a20 5079 7468 6f6e 3d3d 332e 380a  n.* Python==3.8.
+000009e0: 2a20 746f 7263 683d 3d31 2e31 332e 310a  * torch==1.13.1.
+000009f0: 2a20 6469 6666 7573 6572 733d 3d30 2e32  * diffusers==0.2
+00000a00: 372e 300a 2a20 7472 616e 7366 6f72 6d65  7.0.* transforme
+00000a10: 7273 3d3d 342e 3237 2e34 0a2a 2061 6363  rs==4.27.4.* acc
+00000a20: 656c 6572 6174 653d 3d30 2e31 382e 300a  elerate==0.18.0.
+00000a30: 2a20 7866 6f72 6d65 7273 3d3d 302e 302e  * xformers==0.0.
+00000a40: 3136 7263 3432 350a 0a23 2320 f09f 9491  16rc425..## ....
+00000a50: 2049 6e73 7461 6c6c 2048 6944 6966 6675   Install HiDiffu
+00000a60: 7369 6f6e 0a41 6674 6572 2069 6e73 7461  sion.After insta
+00000a70: 6c6c 696e 6720 7468 6520 7061 636b 6167  lling the packag
+00000a80: 6573 2069 6e20 7468 6520 6d61 696e 2072  es in the main r
+00000a90: 6571 7569 7265 6d65 6e74 732c 2069 6e73  equirements, ins
+00000aa0: 7461 6c6c 2048 6944 6966 6675 7369 6f6e  tall HiDiffusion
+00000ab0: 3a0a 6060 6073 6865 6c6c 0a70 6970 3320  :.```shell.pip3 
+00000ac0: 696e 7374 616c 6c20 6869 6469 6666 7573  install hidiffus
+00000ad0: 696f 6e0a 6060 600a 2323 2320 496e 7374  ion.```.### Inst
+00000ae0: 616c 6c69 6e67 2066 726f 6d20 736f 7572  alling from sour
+00000af0: 6365 0a41 6c74 6572 6e61 7469 7665 6c79  ce.Alternatively
+00000b00: 2c20 796f 7520 6361 6e20 696e 7374 616c  , you can instal
+00000b10: 6c20 6672 6f6d 2067 6974 6875 6220 736f  l from github so
+00000b20: 7572 6365 2e20 436c 6f6e 6520 7468 6520  urce. Clone the 
+00000b30: 7265 706f 7369 746f 7279 2061 6e64 2069  repository and i
+00000b40: 6e73 7461 6c6c 3a0a 6060 6062 6173 680a  nstall:.```bash.
+00000b50: 6769 7420 636c 6f6e 6520 6874 7470 733a  git clone https:
+00000b60: 2f2f 6769 7468 7562 2e63 6f6d 2f53 6865  //github.com/She
+00000b70: 6e5a 6861 6e67 2d53 6869 6e2f 4869 4469  nZhang-Shin/HiDi
+00000b80: 6666 7573 696f 6e2e 6769 740a 6364 2048  ffusion.git.cd H
+00000b90: 6944 6966 6675 7369 6f6e 0a70 7974 686f  iDiffusion.pytho
+00000ba0: 6e33 2073 6574 7570 2e70 7920 696e 7374  n3 setup.py inst
+00000bb0: 616c 6c0a 6060 600a 0a0a 2323 20f0 9f9a  all.```...## ...
+00000bc0: 8020 5573 6167 650a 0a47 656e 6572 6174  . Usage..Generat
+00000bd0: 696e 6720 6f75 7470 7574 7320 7769 7468  ing outputs with
+00000be0: 2048 6944 6966 6675 7369 6f6e 2069 7320   HiDiffusion is 
+00000bf0: 7375 7065 7220 6561 7379 2062 6173 6564  super easy based
+00000c00: 206f 6e20 f09f a497 205b 6469 6666 7573   on .... [diffus
+00000c10: 6572 735d 2868 7474 7073 3a2f 2f67 6974  ers](https://git
+00000c20: 6875 622e 636f 6d2f 6875 6767 696e 6766  hub.com/huggingf
+00000c30: 6163 652f 6469 6666 7573 6572 732f 7472  ace/diffusers/tr
+00000c40: 6565 2f6d 6169 6e29 2e0a 0a23 2320 5465  ee/main)...## Te
+00000c50: 7874 2d74 6f2d 696d 6167 6520 6765 6e65  xt-to-image gene
+00000c60: 7261 7469 6f6e 0a0a 2323 2320 5374 6162  ration..### Stab
+00000c70: 6c65 2044 6966 6675 7369 6f6e 2058 4c0a  le Diffusion XL.
+00000c80: 0a60 6060 7079 7468 6f6e 0a66 726f 6d20  .```python.from 
+00000c90: 6869 6469 6666 7573 696f 6e20 696d 706f  hidiffusion impo
+00000ca0: 7274 2061 7070 6c79 5f68 6964 6966 6675  rt apply_hidiffu
+00000cb0: 7369 6f6e 2c20 7265 6d6f 7665 5f68 6964  sion, remove_hid
+00000cc0: 6966 6675 7369 6f6e 0a66 726f 6d20 6469  iffusion.from di
+00000cd0: 6666 7573 6572 7320 696d 706f 7274 2053  ffusers import S
+00000ce0: 7461 626c 6544 6966 6675 7369 6f6e 584c  tableDiffusionXL
+00000cf0: 5069 7065 6c69 6e65 2c20 4444 494d 5363  Pipeline, DDIMSc
+00000d00: 6865 6475 6c65 720a 696d 706f 7274 2074  heduler.import t
+00000d10: 6f72 6368 0a70 7265 7472 6169 6e5f 6d6f  orch.pretrain_mo
+00000d20: 6465 6c20 3d20 2273 7461 6269 6c69 7479  del = "stability
+00000d30: 6169 2f73 7461 626c 652d 6469 6666 7573  ai/stable-diffus
+00000d40: 696f 6e2d 786c 2d62 6173 652d 312e 3022  ion-xl-base-1.0"
+00000d50: 0a73 6368 6564 756c 6572 203d 2044 4449  .scheduler = DDI
+00000d60: 4d53 6368 6564 756c 6572 2e66 726f 6d5f  MScheduler.from_
+00000d70: 7072 6574 7261 696e 6564 2870 7265 7472  pretrained(pretr
+00000d80: 6169 6e5f 6d6f 6465 6c2c 2073 7562 666f  ain_model, subfo
+00000d90: 6c64 6572 3d22 7363 6865 6475 6c65 7222  lder="scheduler"
+00000da0: 290a 7069 7065 203d 2053 7461 626c 6544  ).pipe = StableD
+00000db0: 6966 6675 7369 6f6e 584c 5069 7065 6c69  iffusionXLPipeli
+00000dc0: 6e65 2e66 726f 6d5f 7072 6574 7261 696e  ne.from_pretrain
+00000dd0: 6564 2870 7265 7472 6169 6e5f 6d6f 6465  ed(pretrain_mode
+00000de0: 6c2c 2073 6368 6564 756c 6572 203d 2073  l, scheduler = s
+00000df0: 6368 6564 756c 6572 2c20 746f 7263 685f  cheduler, torch_
+00000e00: 6474 7970 653d 746f 7263 682e 666c 6f61  dtype=torch.floa
+00000e10: 7431 362c 2076 6172 6961 6e74 3d22 6670  t16, variant="fp
+00000e20: 3136 2229 2e74 6f28 2263 7564 6122 290a  16").to("cuda").
+00000e30: 0a23 2023 204f 7074 696f 6e61 6c2e 2065  .# # Optional. e
+00000e40: 6e61 626c 655f 7866 6f72 6d65 7273 5f6d  nable_xformers_m
+00000e50: 656d 6f72 795f 6566 6669 6369 656e 745f  emory_efficient_
+00000e60: 6174 7465 6e74 696f 6e20 6361 6e20 7361  attention can sa
+00000e70: 7665 206d 656d 6f72 7920 7573 6167 6520  ve memory usage 
+00000e80: 616e 6420 696e 6372 6561 7365 2069 6e66  and increase inf
+00000e90: 6572 656e 6365 2073 7065 6564 2e20 656e  erence speed. en
+00000ea0: 6162 6c65 5f6d 6f64 656c 5f63 7075 5f6f  able_model_cpu_o
+00000eb0: 6666 6c6f 6164 2061 6e64 2065 6e61 626c  ffload and enabl
+00000ec0: 655f 7661 655f 7469 6c69 6e67 2063 616e  e_vae_tiling can
+00000ed0: 2073 6176 6520 6d65 6d6f 7279 2075 7361   save memory usa
+00000ee0: 6765 2e0a 2320 7069 7065 2e65 6e61 626c  ge..# pipe.enabl
+00000ef0: 655f 7866 6f72 6d65 7273 5f6d 656d 6f72  e_xformers_memor
+00000f00: 795f 6566 6669 6369 656e 745f 6174 7465  y_efficient_atte
+00000f10: 6e74 696f 6e28 290a 2320 7069 7065 2e65  ntion().# pipe.e
+00000f20: 6e61 626c 655f 6d6f 6465 6c5f 6370 755f  nable_model_cpu_
+00000f30: 6f66 666c 6f61 6428 290a 2320 7069 7065  offload().# pipe
+00000f40: 2e65 6e61 626c 655f 7661 655f 7469 6c69  .enable_vae_tili
+00000f50: 6e67 2829 0a0a 2320 4170 706c 7920 6869  ng()..# Apply hi
+00000f60: 6469 6666 7573 696f 6e20 7769 7468 2061  diffusion with a
+00000f70: 2073 696e 676c 6520 6c69 6e65 206f 6620   single line of 
+00000f80: 636f 6465 2e0a 6170 706c 795f 6869 6469  code..apply_hidi
+00000f90: 6666 7573 696f 6e28 7069 7065 290a 0a70  ffusion(pipe)..p
+00000fa0: 726f 6d70 7420 3d20 2253 7461 6e64 696e  rompt = "Standin
+00000fb0: 6720 7461 6c6c 2061 6d69 6473 7420 7468  g tall amidst th
+00000fc0: 6520 7275 696e 732c 2061 2073 746f 6e65  e ruins, a stone
+00000fd0: 2067 6f6c 656d 2061 7761 6b65 6e73 2c20   golem awakens, 
+00000fe0: 7669 6e65 7320 616e 6420 666c 6f77 6572  vines and flower
+00000ff0: 7320 7370 726f 7574 696e 6720 6672 6f6d  s sprouting from
+00001000: 2074 6865 2063 7265 7669 6365 7320 696e   the crevices in
+00001010: 2069 7473 2062 6f64 792e 220a 6e65 6761   its body.".nega
+00001020: 7469 7665 5f70 726f 6d70 7420 3d20 2262  tive_prompt = "b
+00001030: 6c75 7272 792c 2075 676c 792c 2064 7570  lurry, ugly, dup
+00001040: 6c69 6361 7465 2c20 706f 6f72 6c79 2064  licate, poorly d
+00001050: 7261 776e 2066 6163 652c 2064 6566 6f72  rawn face, defor
+00001060: 6d65 642c 206d 6f73 6169 632c 2061 7274  med, mosaic, art
+00001070: 6966 6163 7473 2c20 6261 6420 6c69 6d62  ifacts, bad limb
+00001080: 7322 0a69 6d61 6765 203d 2070 6970 6528  s".image = pipe(
+00001090: 7072 6f6d 7074 2c20 6775 6964 616e 6365  prompt, guidance
+000010a0: 5f73 6361 6c65 3d37 2e35 2c20 6865 6967  _scale=7.5, heig
+000010b0: 6874 3d32 3034 382c 2077 6964 7468 3d32  ht=2048, width=2
+000010c0: 3034 382c 2065 7461 3d31 2e30 2c20 6e65  048, eta=1.0, ne
+000010d0: 6761 7469 7665 5f70 726f 6d70 743d 6e65  gative_prompt=ne
+000010e0: 6761 7469 7665 5f70 726f 6d70 7429 2e69  gative_prompt).i
+000010f0: 6d61 6765 735b 305d 0a69 6d61 6765 2e73  mages[0].image.s
+00001100: 6176 6528 6622 676f 6c65 6d2e 6a70 6722  ave(f"golem.jpg"
+00001110: 290a 6060 600a 0a3c 6465 7461 696c 733e  ).```..<details>
+00001120: 0a3c 7375 6d6d 6172 793e 4f75 7470 7574  .<summary>Output
+00001130: 3a3c 2f73 756d 6d61 7279 3e0a 3c64 6976  :</summary>.<div
+00001140: 2061 6c69 676e 3d22 6365 6e74 6572 223e   align="center">
+00001150: 0a20 203c 696d 6720 7372 633d 2261 7373  .  <img src="ass
+00001160: 6574 732f 7364 786c 2e6a 7067 2220 7769  ets/sdxl.jpg" wi
+00001170: 6474 683d 2238 3030 2220 3e3c 2f69 6d67  dth="800" ></img
+00001180: 3e0a 3c2f 6469 763e 0a3c 2f64 6574 6169  >.</div>.</detai
+00001190: 6c73 3e0a 0a53 6574 2068 6569 6768 7420  ls>..Set height 
+000011a0: 3d20 3430 3936 2c20 7769 6474 6820 3d20  = 4096, width = 
+000011b0: 3430 3936 2c20 616e 6420 796f 7520 6361  4096, and you ca
+000011c0: 6e20 6765 7420 6f75 7470 7574 2077 6974  n get output wit
+000011d0: 6820 3430 3936 7834 3039 3620 7265 736f  h 4096x4096 reso
+000011e0: 6c75 7469 6f6e 2e0a 0a23 2323 2053 7461  lution...### Sta
+000011f0: 626c 6520 4469 6666 7573 696f 6e20 584c  ble Diffusion XL
+00001200: 2054 7572 626f 0a0a 6060 6070 7974 686f   Turbo..```pytho
+00001210: 6e0a 6672 6f6d 2068 6964 6966 6675 7369  n.from hidiffusi
+00001220: 6f6e 2069 6d70 6f72 7420 6170 706c 795f  on import apply_
+00001230: 6869 6469 6666 7573 696f 6e2c 2072 656d  hidiffusion, rem
+00001240: 6f76 655f 6869 6469 6666 7573 696f 6e0a  ove_hidiffusion.
+00001250: 6672 6f6d 2064 6966 6675 7365 7273 2069  from diffusers i
+00001260: 6d70 6f72 7420 4175 746f 5069 7065 6c69  mport AutoPipeli
+00001270: 6e65 466f 7254 6578 7432 496d 6167 650a  neForText2Image.
+00001280: 696d 706f 7274 2074 6f72 6368 0a70 7265  import torch.pre
+00001290: 7472 6169 6e5f 6d6f 6465 6c20 3d20 2273  train_model = "s
+000012a0: 7461 6269 6c69 7479 6169 2f73 6478 6c2d  tabilityai/sdxl-
+000012b0: 7475 7262 6f22 0a70 6970 6520 3d20 4175  turbo".pipe = Au
+000012c0: 746f 5069 7065 6c69 6e65 466f 7254 6578  toPipelineForTex
+000012d0: 7432 496d 6167 652e 6672 6f6d 5f70 7265  t2Image.from_pre
+000012e0: 7472 6169 6e65 6428 7072 6574 7261 696e  trained(pretrain
+000012f0: 5f6d 6f64 656c 2c20 746f 7263 685f 6474  _model, torch_dt
+00001300: 7970 653d 746f 7263 682e 666c 6f61 7431  ype=torch.float1
+00001310: 362c 2076 6172 6961 6e74 3d22 6670 3136  6, variant="fp16
+00001320: 2229 2e74 6f28 2763 7564 6127 290a 0a23  ").to('cuda')..#
+00001330: 2023 204f 7074 696f 6e61 6c2e 2065 6e61   # Optional. ena
+00001340: 626c 655f 7866 6f72 6d65 7273 5f6d 656d  ble_xformers_mem
+00001350: 6f72 795f 6566 6669 6369 656e 745f 6174  ory_efficient_at
+00001360: 7465 6e74 696f 6e20 6361 6e20 7361 7665  tention can save
+00001370: 206d 656d 6f72 7920 7573 6167 6520 616e   memory usage an
+00001380: 6420 696e 6372 6561 7365 2069 6e66 6572  d increase infer
+00001390: 656e 6365 2073 7065 6564 2e20 656e 6162  ence speed. enab
+000013a0: 6c65 5f6d 6f64 656c 5f63 7075 5f6f 6666  le_model_cpu_off
+000013b0: 6c6f 6164 2061 6e64 2065 6e61 626c 655f  load and enable_
+000013c0: 7661 655f 7469 6c69 6e67 2063 616e 2073  vae_tiling can s
+000013d0: 6176 6520 6d65 6d6f 7279 2075 7361 6765  ave memory usage
+000013e0: 2e0a 2320 7069 7065 2e65 6e61 626c 655f  ..# pipe.enable_
+000013f0: 7866 6f72 6d65 7273 5f6d 656d 6f72 795f  xformers_memory_
+00001400: 6566 6669 6369 656e 745f 6174 7465 6e74  efficient_attent
+00001410: 696f 6e28 290a 2320 7069 7065 2e65 6e61  ion().# pipe.ena
+00001420: 626c 655f 6d6f 6465 6c5f 6370 755f 6f66  ble_model_cpu_of
+00001430: 666c 6f61 6428 290a 2320 7069 7065 2e65  fload().# pipe.e
+00001440: 6e61 626c 655f 7661 655f 7469 6c69 6e67  nable_vae_tiling
+00001450: 2829 0a0a 2320 4170 706c 7920 6869 6469  ()..# Apply hidi
+00001460: 6666 7573 696f 6e20 7769 7468 2061 2073  ffusion with a s
+00001470: 696e 676c 6520 6c69 6e65 206f 6620 636f  ingle line of co
+00001480: 6465 2e0a 6170 706c 795f 6869 6469 6666  de..apply_hidiff
+00001490: 7573 696f 6e28 7069 7065 290a 0a70 726f  usion(pipe)..pro
+000014a0: 6d70 7420 3d20 2249 6e20 7468 6520 6465  mpt = "In the de
+000014b0: 7074 6873 206f 6620 6120 6d79 7374 6963  pths of a mystic
+000014c0: 616c 2066 6f72 6573 742c 2061 2072 6f62  al forest, a rob
+000014d0: 6f74 6963 206f 776c 2077 6974 6820 6e69  otic owl with ni
+000014e0: 6768 7420 7669 7369 6f6e 206c 656e 7365  ght vision lense
+000014f0: 7320 666f 7220 6579 6573 2077 6174 6368  s for eyes watch
+00001500: 6573 206f 7665 7220 7468 6520 6e6f 6374  es over the noct
+00001510: 7572 6e61 6c20 6372 6561 7475 7265 732e  urnal creatures.
+00001520: 220a 696d 6167 6520 3d20 7069 7065 2870  ".image = pipe(p
+00001530: 726f 6d70 742c 206e 756d 5f69 6e66 6572  rompt, num_infer
+00001540: 656e 6365 5f73 7465 7073 3d34 2c20 6865  ence_steps=4, he
+00001550: 6967 6874 3d31 3032 342c 2077 6964 7468  ight=1024, width
+00001560: 3d31 3032 342c 2067 7569 6461 6e63 655f  =1024, guidance_
+00001570: 7363 616c 653d 302e 3029 2e69 6d61 6765  scale=0.0).image
+00001580: 735b 305d 0a69 6d61 6765 2e73 6176 6528  s[0].image.save(
+00001590: 6622 2e2f 6f77 6c2e 6a70 6722 290a 6060  f"./owl.jpg").``
+000015a0: 600a 0a3c 6465 7461 696c 733e 0a3c 7375  `..<details>.<su
+000015b0: 6d6d 6172 793e 4f75 7470 7574 3a3c 2f73  mmary>Output:</s
+000015c0: 756d 6d61 7279 3e0a 3c64 6976 2061 6c69  ummary>.<div ali
+000015d0: 676e 3d22 6365 6e74 6572 223e 0a20 203c  gn="center">.  <
+000015e0: 696d 6720 7372 633d 2261 7373 6574 732f  img src="assets/
+000015f0: 7364 786c 5f74 7572 626f 2e6a 7067 2220  sdxl_turbo.jpg" 
+00001600: 7769 6474 683d 2238 3030 2220 3e3c 2f69  width="800" ></i
+00001610: 6d67 3e0a 3c2f 6469 763e 0a3c 2f64 6574  mg>.</div>.</det
+00001620: 6169 6c73 3e0a 0a23 2323 2053 7461 626c  ails>..### Stabl
+00001630: 6520 4469 6666 7573 696f 6e20 7632 2d31  e Diffusion v2-1
+00001640: 0a0a 6060 6070 7974 686f 6e0a 6672 6f6d  ..```python.from
+00001650: 2068 6964 6966 6675 7369 6f6e 2069 6d70   hidiffusion imp
+00001660: 6f72 7420 6170 706c 795f 6869 6469 6666  ort apply_hidiff
+00001670: 7573 696f 6e2c 2072 656d 6f76 655f 6869  usion, remove_hi
+00001680: 6469 6666 7573 696f 6e0a 6672 6f6d 2064  diffusion.from d
+00001690: 6966 6675 7365 7273 2069 6d70 6f72 7420  iffusers import 
+000016a0: 4469 6666 7573 696f 6e50 6970 656c 696e  DiffusionPipelin
+000016b0: 652c 2044 4449 4d53 6368 6564 756c 6572  e, DDIMScheduler
+000016c0: 0a69 6d70 6f72 7420 746f 7263 680a 7072  .import torch.pr
+000016d0: 6574 7261 696e 5f6d 6f64 656c 203d 2022  etrain_model = "
+000016e0: 7374 6162 696c 6974 7961 692f 7374 6162  stabilityai/stab
+000016f0: 6c65 2d64 6966 6675 7369 6f6e 2d32 2d31  le-diffusion-2-1
+00001700: 2d62 6173 6522 0a73 6368 6564 756c 6572  -base".scheduler
+00001710: 203d 2044 4449 4d53 6368 6564 756c 6572   = DDIMScheduler
+00001720: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
+00001730: 2870 7265 7472 6169 6e5f 6d6f 6465 6c2c  (pretrain_model,
+00001740: 2073 7562 666f 6c64 6572 3d22 7363 6865   subfolder="sche
+00001750: 6475 6c65 7222 290a 7069 7065 203d 2044  duler").pipe = D
+00001760: 6966 6675 7369 6f6e 5069 7065 6c69 6e65  iffusionPipeline
+00001770: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
+00001780: 2870 7265 7472 6169 6e5f 6d6f 6465 6c2c  (pretrain_model,
+00001790: 2073 6368 6564 756c 6572 203d 2073 6368   scheduler = sch
+000017a0: 6564 756c 6572 2c20 746f 7263 685f 6474  eduler, torch_dt
+000017b0: 7970 653d 746f 7263 682e 666c 6f61 7431  ype=torch.float1
+000017c0: 3629 2e74 6f28 2263 7564 6122 290a 0a23  6).to("cuda")..#
+000017d0: 2023 204f 7074 696f 6e61 6c2e 2065 6e61   # Optional. ena
+000017e0: 626c 655f 7866 6f72 6d65 7273 5f6d 656d  ble_xformers_mem
+000017f0: 6f72 795f 6566 6669 6369 656e 745f 6174  ory_efficient_at
+00001800: 7465 6e74 696f 6e20 6361 6e20 7361 7665  tention can save
+00001810: 206d 656d 6f72 7920 7573 6167 6520 616e   memory usage an
+00001820: 6420 696e 6372 6561 7365 2069 6e66 6572  d increase infer
+00001830: 656e 6365 2073 7065 6564 2e20 656e 6162  ence speed. enab
+00001840: 6c65 5f6d 6f64 656c 5f63 7075 5f6f 6666  le_model_cpu_off
+00001850: 6c6f 6164 2061 6e64 2065 6e61 626c 655f  load and enable_
+00001860: 7661 655f 7469 6c69 6e67 2063 616e 2073  vae_tiling can s
+00001870: 6176 6520 6d65 6d6f 7279 2075 7361 6765  ave memory usage
+00001880: 2e0a 2320 7069 7065 2e65 6e61 626c 655f  ..# pipe.enable_
+00001890: 7866 6f72 6d65 7273 5f6d 656d 6f72 795f  xformers_memory_
+000018a0: 6566 6669 6369 656e 745f 6174 7465 6e74  efficient_attent
+000018b0: 696f 6e28 290a 2320 7069 7065 2e65 6e61  ion().# pipe.ena
+000018c0: 626c 655f 6d6f 6465 6c5f 6370 755f 6f66  ble_model_cpu_of
+000018d0: 666c 6f61 6428 290a 2320 7069 7065 2e65  fload().# pipe.e
+000018e0: 6e61 626c 655f 7661 655f 7469 6c69 6e67  nable_vae_tiling
+000018f0: 2829 0a0a 2320 4170 706c 7920 6869 6469  ()..# Apply hidi
+00001900: 6666 7573 696f 6e20 7769 7468 2061 2073  ffusion with a s
+00001910: 696e 676c 6520 6c69 6e65 206f 6620 636f  ingle line of co
+00001920: 6465 2e0a 6170 706c 795f 6869 6469 6666  de..apply_hidiff
+00001930: 7573 696f 6e28 7069 7065 290a 0a70 726f  usion(pipe)..pro
+00001940: 6d70 7420 3d20 2241 6e20 6164 6f72 6162  mpt = "An adorab
+00001950: 6c65 2068 6170 7079 2062 726f 776e 2062  le happy brown b
+00001960: 6f72 6465 7220 636f 6c6c 6965 2073 6974  order collie sit
+00001970: 7469 6e67 206f 6e20 6120 6265 642c 2068  ting on a bed, h
+00001980: 6967 6820 6465 7461 696c 2e22 0a6e 6567  igh detail.".neg
+00001990: 6174 6976 655f 7072 6f6d 7074 203d 2022  ative_prompt = "
+000019a0: 7567 6c79 2c20 7469 6c69 6e67 2c20 6f75  ugly, tiling, ou
+000019b0: 7420 6f66 2066 7261 6d65 2c20 706f 6f72  t of frame, poor
+000019c0: 6c79 2064 7261 776e 2066 6163 652c 2065  ly drawn face, e
+000019d0: 7874 7261 206c 696d 6273 2c20 6469 7366  xtra limbs, disf
+000019e0: 6967 7572 6564 2c20 6465 666f 726d 6564  igured, deformed
+000019f0: 2c20 626f 6479 206f 7574 206f 6620 6672  , body out of fr
+00001a00: 616d 652c 2062 6c75 7272 792c 2062 6164  ame, blurry, bad
+00001a10: 2061 6e61 746f 6d79 2c20 626c 7572 7265   anatomy, blurre
+00001a20: 642c 2061 7274 6966 6163 7473 2c20 6261  d, artifacts, ba
+00001a30: 6420 7072 6f70 6f72 7469 6f6e 732e 220a  d proportions.".
+00001a40: 696d 6167 6520 3d20 7069 7065 2870 726f  image = pipe(pro
+00001a50: 6d70 742c 2067 7569 6461 6e63 655f 7363  mpt, guidance_sc
+00001a60: 616c 653d 372e 352c 2068 6569 6768 743d  ale=7.5, height=
+00001a70: 3130 3234 2c20 7769 6474 683d 3130 3234  1024, width=1024
+00001a80: 2c20 6574 613d 312e 302c 206e 6567 6174  , eta=1.0, negat
+00001a90: 6976 655f 7072 6f6d 7074 3d6e 6567 6174  ive_prompt=negat
+00001aa0: 6976 655f 7072 6f6d 7074 292e 696d 6167  ive_prompt).imag
+00001ab0: 6573 5b30 5d0a 696d 6167 652e 7361 7665  es[0].image.save
+00001ac0: 2866 2263 6f6c 6c69 652e 6a70 6722 290a  (f"collie.jpg").
+00001ad0: 6060 600a 0a3c 6465 7461 696c 733e 0a3c  ```..<details>.<
+00001ae0: 7375 6d6d 6172 793e 4f75 7470 7574 3a3c  summary>Output:<
+00001af0: 2f73 756d 6d61 7279 3e0a 3c64 6976 2061  /summary>.<div a
+00001b00: 6c69 676e 3d22 6365 6e74 6572 223e 0a20  lign="center">. 
+00001b10: 203c 696d 6720 7372 633d 2261 7373 6574   <img src="asset
+00001b20: 732f 7364 3231 2e6a 7067 2220 7769 6474  s/sd21.jpg" widt
+00001b30: 683d 2238 3030 2220 3e3c 2f69 6d67 3e0a  h="800" ></img>.
+00001b40: 3c2f 6469 763e 0a3c 2f64 6574 6169 6c73  </div>.</details
+00001b50: 3e0a 0a53 6574 2068 6569 6768 7420 3d20  >..Set height = 
+00001b60: 3230 3438 2c20 7769 6474 6820 3d20 3230  2048, width = 20
+00001b70: 3438 2c20 616e 6420 796f 7520 6361 6e20  48, and you can 
+00001b80: 6765 7420 6f75 7470 7574 2077 6974 6820  get output with 
+00001b90: 3230 3438 7832 3034 3820 7265 736f 6c75  2048x2048 resolu
+00001ba0: 7469 6f6e 2e0a 0a0a 0a23 2323 2053 7461  tion.....### Sta
+00001bb0: 626c 6520 4469 6666 7573 696f 6e20 7631  ble Diffusion v1
+00001bc0: 2d35 0a0a 6060 6070 7974 686f 6e0a 6672  -5..```python.fr
+00001bd0: 6f6d 2068 6964 6966 6675 7369 6f6e 2069  om hidiffusion i
+00001be0: 6d70 6f72 7420 6170 706c 795f 6869 6469  mport apply_hidi
+00001bf0: 6666 7573 696f 6e2c 2072 656d 6f76 655f  ffusion, remove_
+00001c00: 6869 6469 6666 7573 696f 6e0a 6672 6f6d  hidiffusion.from
+00001c10: 2064 6966 6675 7365 7273 2069 6d70 6f72   diffusers impor
+00001c20: 7420 4469 6666 7573 696f 6e50 6970 656c  t DiffusionPipel
+00001c30: 696e 652c 2044 4449 4d53 6368 6564 756c  ine, DDIMSchedul
+00001c40: 6572 0a69 6d70 6f72 7420 746f 7263 680a  er.import torch.
+00001c50: 7072 6574 7261 696e 5f6d 6f64 656c 203d  pretrain_model =
+00001c60: 2022 7275 6e77 6179 6d6c 2f73 7461 626c   "runwayml/stabl
+00001c70: 652d 6469 6666 7573 696f 6e2d 7631 2d35  e-diffusion-v1-5
+00001c80: 220a 7363 6865 6475 6c65 7220 3d20 4444  ".scheduler = DD
+00001c90: 494d 5363 6865 6475 6c65 722e 6672 6f6d  IMScheduler.from
+00001ca0: 5f70 7265 7472 6169 6e65 6428 7072 6574  _pretrained(pret
+00001cb0: 7261 696e 5f6d 6f64 656c 2c20 7375 6266  rain_model, subf
+00001cc0: 6f6c 6465 723d 2273 6368 6564 756c 6572  older="scheduler
+00001cd0: 2229 0a70 6970 6520 3d20 4469 6666 7573  ").pipe = Diffus
+00001ce0: 696f 6e50 6970 656c 696e 652e 6672 6f6d  ionPipeline.from
+00001cf0: 5f70 7265 7472 6169 6e65 6428 7072 6574  _pretrained(pret
+00001d00: 7261 696e 5f6d 6f64 656c 2c20 7363 6865  rain_model, sche
+00001d10: 6475 6c65 7220 3d20 7363 6865 6475 6c65  duler = schedule
+00001d20: 722c 2074 6f72 6368 5f64 7479 7065 3d74  r, torch_dtype=t
+00001d30: 6f72 6368 2e66 6c6f 6174 3136 292e 746f  orch.float16).to
+00001d40: 2822 6375 6461 2229 0a0a 2320 2320 4f70  ("cuda")..# # Op
+00001d50: 7469 6f6e 616c 2e20 656e 6162 6c65 5f78  tional. enable_x
+00001d60: 666f 726d 6572 735f 6d65 6d6f 7279 5f65  formers_memory_e
+00001d70: 6666 6963 6965 6e74 5f61 7474 656e 7469  fficient_attenti
+00001d80: 6f6e 2063 616e 2073 6176 6520 6d65 6d6f  on can save memo
+00001d90: 7279 2075 7361 6765 2061 6e64 2069 6e63  ry usage and inc
+00001da0: 7265 6173 6520 696e 6665 7265 6e63 6520  rease inference 
+00001db0: 7370 6565 642e 2065 6e61 626c 655f 6d6f  speed. enable_mo
+00001dc0: 6465 6c5f 6370 755f 6f66 666c 6f61 6420  del_cpu_offload 
+00001dd0: 616e 6420 656e 6162 6c65 5f76 6165 5f74  and enable_vae_t
+00001de0: 696c 696e 6720 6361 6e20 7361 7665 206d  iling can save m
+00001df0: 656d 6f72 7920 7573 6167 652e 0a23 2070  emory usage..# p
+00001e00: 6970 652e 656e 6162 6c65 5f78 666f 726d  ipe.enable_xform
+00001e10: 6572 735f 6d65 6d6f 7279 5f65 6666 6963  ers_memory_effic
+00001e20: 6965 6e74 5f61 7474 656e 7469 6f6e 2829  ient_attention()
+00001e30: 0a23 2070 6970 652e 656e 6162 6c65 5f6d  .# pipe.enable_m
+00001e40: 6f64 656c 5f63 7075 5f6f 6666 6c6f 6164  odel_cpu_offload
+00001e50: 2829 0a23 2070 6970 652e 656e 6162 6c65  ().# pipe.enable
+00001e60: 5f76 6165 5f74 696c 696e 6728 290a 0a23  _vae_tiling()..#
+00001e70: 2041 7070 6c79 2068 6964 6966 6675 7369   Apply hidiffusi
+00001e80: 6f6e 2077 6974 6820 6120 7369 6e67 6c65  on with a single
+00001e90: 206c 696e 6520 6f66 2063 6f64 652e 0a61   line of code..a
+00001ea0: 7070 6c79 5f68 6964 6966 6675 7369 6f6e  pply_hidiffusion
+00001eb0: 2870 6970 6529 0a0a 7072 6f6d 7074 203d  (pipe)..prompt =
+00001ec0: 2022 7468 6963 6b20 7374 726f 6b65 732c   "thick strokes,
+00001ed0: 2062 7269 6768 7420 636f 6c6f 7273 2c20   bright colors, 
+00001ee0: 616e 2065 786f 7469 6320 666f 782c 2063  an exotic fox, c
+00001ef0: 7574 652c 2063 6869 6269 206b 6177 6169  ute, chibi kawai
+00001f00: 692e 2064 6574 6169 6c65 6420 6675 722c  i. detailed fur,
+00001f10: 2068 7970 6572 6465 7461 696c 6564 202c   hyperdetailed ,
+00001f20: 2062 6967 2072 6566 6c65 6374 6976 6520   big reflective 
+00001f30: 6579 6573 2c20 6661 6972 7974 616c 652c  eyes, fairytale,
+00001f40: 2061 7274 7374 6174 696f 6e2c 6365 6e74   artstation,cent
+00001f50: 6572 6564 2063 6f6d 706f 7369 7469 6f6e  ered composition
+00001f60: 2c20 7065 7266 6563 7420 636f 6d70 6f73  , perfect compos
+00001f70: 6974 696f 6e2c 2063 656e 7465 7265 642c  ition, centered,
+00001f80: 2076 6962 7261 6e74 2063 6f6c 6f72 732c   vibrant colors,
+00001f90: 206d 7574 6564 2063 6f6c 6f72 732c 2068   muted colors, h
+00001fa0: 6967 6820 6465 7461 696c 6564 2c20 386b  igh detailed, 8k
+00001fb0: 2e22 0a6e 6567 6174 6976 655f 7072 6f6d  .".negative_prom
+00001fc0: 7074 203d 2022 7567 6c79 2c20 7469 6c69  pt = "ugly, tili
+00001fd0: 6e67 2c20 706f 6f72 6c79 2064 7261 776e  ng, poorly drawn
+00001fe0: 2066 6163 652c 206f 7574 206f 6620 6672   face, out of fr
+00001ff0: 616d 652c 2064 6973 6669 6775 7265 642c  ame, disfigured,
+00002000: 2064 6566 6f72 6d65 642c 2062 6c75 7272   deformed, blurr
+00002010: 792c 2062 6164 2061 6e61 746f 6d79 2c20  y, bad anatomy, 
+00002020: 626c 7572 7265 642e 220a 696d 6167 6520  blurred.".image 
+00002030: 3d20 7069 7065 2870 726f 6d70 742c 2067  = pipe(prompt, g
+00002040: 7569 6461 6e63 655f 7363 616c 653d 372e  uidance_scale=7.
+00002050: 352c 2068 6569 6768 743d 3130 3234 2c20  5, height=1024, 
+00002060: 7769 6474 683d 3130 3234 2c20 6574 613d  width=1024, eta=
+00002070: 312e 302c 206e 6567 6174 6976 655f 7072  1.0, negative_pr
+00002080: 6f6d 7074 3d6e 6567 6174 6976 655f 7072  ompt=negative_pr
+00002090: 6f6d 7074 292e 696d 6167 6573 5b30 5d0a  ompt).images[0].
+000020a0: 696d 6167 652e 7361 7665 2866 2266 6f78  image.save(f"fox
+000020b0: 2e6a 7067 2229 0a60 6060 0a0a 3c64 6574  .jpg").```..<det
+000020c0: 6169 6c73 3e0a 3c73 756d 6d61 7279 3e4f  ails>.<summary>O
+000020d0: 7574 7075 743a 3c2f 7375 6d6d 6172 793e  utput:</summary>
+000020e0: 0a3c 6469 7620 616c 6967 6e3d 2263 656e  .<div align="cen
+000020f0: 7465 7222 3e0a 2020 3c69 6d67 2073 7263  ter">.  <img src
+00002100: 3d22 6173 7365 7473 2f73 6431 352e 6a70  ="assets/sd15.jp
+00002110: 6722 2077 6964 7468 3d22 3830 3022 203e  g" width="800" >
+00002120: 3c2f 696d 673e 0a3c 2f64 6976 3e0a 3c2f  </img>.</div>.</
+00002130: 6465 7461 696c 733e 0a0a 5365 7420 6865  details>..Set he
+00002140: 6967 6874 203d 2032 3034 382c 2077 6964  ight = 2048, wid
+00002150: 7468 203d 2032 3034 382c 2061 6e64 2079  th = 2048, and y
+00002160: 6f75 2063 616e 2067 6574 206f 7574 7075  ou can get outpu
+00002170: 7420 7769 7468 2032 3034 3878 3230 3438  t with 2048x2048
+00002180: 2072 6573 6f6c 7574 696f 6e2e 0a0a 2323   resolution...##
+00002190: 2320 5265 6d6f 7665 2048 6944 6966 6675  # Remove HiDiffu
+000021a0: 7369 6f6e 0a0a 4966 2079 6f75 2077 616e  sion..If you wan
+000021b0: 7420 746f 2072 656d 6f76 6520 4869 4469  t to remove HiDi
+000021c0: 6966 6675 7369 6f6e 2c20 7369 6d70 6c79  iffusion, simply
+000021d0: 2075 7365 2060 7265 6d6f 7665 5f68 6964   use `remove_hid
+000021e0: 6966 6675 7369 6f6e 2870 6970 6529 602e  iffusion(pipe)`.
+000021f0: 0a0a 2323 2043 6f6e 7472 6f6c 4e65 740a  ..## ControlNet.
+00002200: 0a60 6060 7079 7468 6f6e 0a66 726f 6d20  .```python.from 
+00002210: 6469 6666 7573 6572 7320 696d 706f 7274  diffusers import
+00002220: 2053 7461 626c 6544 6966 6675 7369 6f6e   StableDiffusion
+00002230: 584c 436f 6e74 726f 6c4e 6574 5069 7065  XLControlNetPipe
+00002240: 6c69 6e65 2c20 436f 6e74 726f 6c4e 6574  line, ControlNet
+00002250: 4d6f 6465 6c2c 2044 4449 4d53 6368 6564  Model, DDIMSched
+00002260: 756c 6572 0a69 6d70 6f72 7420 6e75 6d70  uler.import nump
+00002270: 7920 6173 206e 700a 696d 706f 7274 2074  y as np.import t
+00002280: 6f72 6368 0a69 6d70 6f72 7420 6376 320a  orch.import cv2.
+00002290: 6672 6f6d 2050 494c 2069 6d70 6f72 7420  from PIL import 
+000022a0: 496d 6167 650a 6672 6f6d 2068 6964 6966  Image.from hidif
+000022b0: 6675 7369 6f6e 2069 6d70 6f72 7420 6170  fusion import ap
+000022c0: 706c 795f 6869 6469 6666 7573 696f 6e2c  ply_hidiffusion,
+000022d0: 2072 656d 6f76 655f 6869 6469 6666 7573   remove_hidiffus
+000022e0: 696f 6e0a 0a23 206c 6f61 6420 596f 7368  ion..# load Yosh
+000022f0: 7561 5f42 656e 6769 6f2e 6a70 6720 696e  ua_Bengio.jpg in
+00002300: 2074 6865 2061 7373 6574 7320 6669 6c65   the assets file
+00002310: 2e0a 7061 7468 203d 2027 596f 7368 7561  ..path = 'Yoshua
+00002320: 5f42 656e 6769 6f2e 6a70 6727 0a69 6d61  _Bengio.jpg'.ima
+00002330: 6765 203d 2049 6d61 6765 2e6f 7065 6e28  ge = Image.open(
+00002340: 7061 7468 290a 2320 6765 7420 6361 6e6e  path).# get cann
+00002350: 7920 696d 6167 650a 696d 6167 6520 3d20  y image.image = 
+00002360: 6e70 2e61 7272 6179 2869 6d61 6765 290a  np.array(image).
+00002370: 696d 6167 6520 3d20 6376 322e 4361 6e6e  image = cv2.Cann
+00002380: 7928 696d 6167 652c 2031 3030 2c20 3230  y(image, 100, 20
+00002390: 3029 0a69 6d61 6765 203d 2069 6d61 6765  0).image = image
+000023a0: 5b3a 2c20 3a2c 204e 6f6e 655d 0a69 6d61  [:, :, None].ima
+000023b0: 6765 203d 206e 702e 636f 6e63 6174 656e  ge = np.concaten
+000023c0: 6174 6528 5b69 6d61 6765 2c20 696d 6167  ate([image, imag
+000023d0: 652c 2069 6d61 6765 5d2c 2061 7869 733d  e, image], axis=
+000023e0: 3229 0a63 616e 6e79 5f69 6d61 6765 203d  2).canny_image =
+000023f0: 2049 6d61 6765 2e66 726f 6d61 7272 6179   Image.fromarray
+00002400: 2869 6d61 6765 290a 0a23 2069 6e69 7469  (image)..# initi
+00002410: 616c 697a 6520 7468 6520 6d6f 6465 6c73  alize the models
+00002420: 2061 6e64 2070 6970 656c 696e 650a 636f   and pipeline.co
+00002430: 6e74 726f 6c6e 6574 5f63 6f6e 6469 7469  ntrolnet_conditi
+00002440: 6f6e 696e 675f 7363 616c 6520 3d20 302e  oning_scale = 0.
+00002450: 3520 2023 2072 6563 6f6d 6d65 6e64 6564  5  # recommended
+00002460: 2066 6f72 2067 6f6f 6420 6765 6e65 7261   for good genera
+00002470: 6c69 7a61 7469 6f6e 0a63 6f6e 7472 6f6c  lization.control
+00002480: 6e65 7420 3d20 436f 6e74 726f 6c4e 6574  net = ControlNet
+00002490: 4d6f 6465 6c2e 6672 6f6d 5f70 7265 7472  Model.from_pretr
+000024a0: 6169 6e65 6428 0a20 2020 2022 6469 6666  ained(.    "diff
+000024b0: 7573 6572 732f 636f 6e74 726f 6c6e 6574  users/controlnet
+000024c0: 2d63 616e 6e79 2d73 6478 6c2d 312e 3022  -canny-sdxl-1.0"
+000024d0: 2c20 746f 7263 685f 6474 7970 653d 746f  , torch_dtype=to
+000024e0: 7263 682e 666c 6f61 7431 362c 2076 6172  rch.float16, var
+000024f0: 6961 6e74 3d22 6670 3136 220a 290a 7363  iant="fp16".).sc
+00002500: 6865 6475 6c65 7220 3d20 4444 494d 5363  heduler = DDIMSc
+00002510: 6865 6475 6c65 722e 6672 6f6d 5f70 7265  heduler.from_pre
+00002520: 7472 6169 6e65 6428 2273 7461 6269 6c69  trained("stabili
+00002530: 7479 6169 2f73 7461 626c 652d 6469 6666  tyai/stable-diff
+00002540: 7573 696f 6e2d 786c 2d62 6173 652d 312e  usion-xl-base-1.
+00002550: 3022 2c20 7375 6266 6f6c 6465 723d 2273  0", subfolder="s
+00002560: 6368 6564 756c 6572 2229 0a70 6970 6520  cheduler").pipe 
+00002570: 3d20 5374 6162 6c65 4469 6666 7573 696f  = StableDiffusio
+00002580: 6e58 4c43 6f6e 7472 6f6c 4e65 7450 6970  nXLControlNetPip
+00002590: 656c 696e 652e 6672 6f6d 5f70 7265 7472  eline.from_pretr
+000025a0: 6169 6e65 6428 0a20 2020 2022 7374 6162  ained(.    "stab
+000025b0: 696c 6974 7961 692f 7374 6162 6c65 2d64  ilityai/stable-d
+000025c0: 6966 6675 7369 6f6e 2d78 6c2d 6261 7365  iffusion-xl-base
+000025d0: 2d31 2e30 222c 2063 6f6e 7472 6f6c 6e65  -1.0", controlne
+000025e0: 743d 636f 6e74 726f 6c6e 6574 2c20 746f  t=controlnet, to
+000025f0: 7263 685f 6474 7970 653d 746f 7263 682e  rch_dtype=torch.
+00002600: 666c 6f61 7431 362c 0a20 2020 2073 6368  float16,.    sch
+00002610: 6564 756c 6572 203d 2073 6368 6564 756c  eduler = schedul
+00002620: 6572 0a29 0a0a 2320 4170 706c 7920 6869  er.)..# Apply hi
+00002630: 6469 6666 7573 696f 6e20 7769 7468 2061  diffusion with a
+00002640: 2073 696e 676c 6520 6c69 6e65 206f 6620   single line of 
+00002650: 636f 6465 2e0a 6170 706c 795f 6869 6469  code..apply_hidi
+00002660: 6666 7573 696f 6e28 7069 7065 290a 0a70  ffusion(pipe)..p
+00002670: 6970 652e 656e 6162 6c65 5f6d 6f64 656c  ipe.enable_model
+00002680: 5f63 7075 5f6f 6666 6c6f 6164 2829 0a70  _cpu_offload().p
+00002690: 6970 652e 656e 6162 6c65 5f78 666f 726d  ipe.enable_xform
+000026a0: 6572 735f 6d65 6d6f 7279 5f65 6666 6963  ers_memory_effic
+000026b0: 6965 6e74 5f61 7474 656e 7469 6f6e 2829  ient_attention()
+000026c0: 0a0a 7072 6f6d 7074 203d 2022 6120 7a6f  ..prompt = "a zo
+000026d0: 6d62 6965 2c20 6869 6768 2066 6163 6520  mbie, high face 
+000026e0: 6465 7461 696c 2c20 6869 6768 2064 6574  detail, high det
+000026f0: 6169 6c2c 206d 7574 6564 2063 6f6c 6f72  ail, muted color
+00002700: 2c20 386b 220a 6e65 6761 7469 7665 5f70  , 8k".negative_p
+00002710: 726f 6d70 7420 3d20 2262 6c75 7272 792c  rompt = "blurry,
+00002720: 2075 676c 792c 2064 7570 6c69 6361 7465   ugly, duplicate
+00002730: 2c20 706f 6f72 6c79 2064 7261 776e 2c20  , poorly drawn, 
+00002740: 6465 666f 726d 6564 2c20 6d6f 7361 6963  deformed, mosaic
+00002750: 2c20 706f 6f72 6c79 2064 7261 776e 2074  , poorly drawn t
+00002760: 6565 7468 2c20 6475 706c 6963 6174 6564  eeth, duplicated
+00002770: 2074 6565 7468 2e22 0a0a 696d 6167 6520   teeth."..image 
+00002780: 3d20 7069 7065 280a 2020 2020 7072 6f6d  = pipe(.    prom
+00002790: 7074 2c20 636f 6e74 726f 6c6e 6574 5f63  pt, controlnet_c
+000027a0: 6f6e 6469 7469 6f6e 696e 675f 7363 616c  onditioning_scal
+000027b0: 653d 636f 6e74 726f 6c6e 6574 5f63 6f6e  e=controlnet_con
+000027c0: 6469 7469 6f6e 696e 675f 7363 616c 652c  ditioning_scale,
+000027d0: 2069 6d61 6765 3d63 616e 6e79 5f69 6d61   image=canny_ima
+000027e0: 6765 2c0a 2020 2020 6865 6967 6874 3d32  ge,.    height=2
+000027f0: 3034 382c 2077 6964 7468 3d32 3034 382c  048, width=2048,
+00002800: 2067 7569 6461 6e63 655f 7363 616c 653d   guidance_scale=
+00002810: 372e 352c 206e 6567 6174 6976 655f 7072  7.5, negative_pr
+00002820: 6f6d 7074 203d 206e 6567 6174 6976 655f  ompt = negative_
+00002830: 7072 6f6d 7074 2c20 6574 613d 312e 300a  prompt, eta=1.0.
+00002840: 292e 696d 6167 6573 5b30 5d0a 0a69 6d61  ).images[0]..ima
+00002850: 6765 2e73 6176 6528 277a 6f6d 6269 652e  ge.save('zombie.
+00002860: 6a70 6727 290a 6060 600a 0a3c 6465 7461  jpg').```..<deta
+00002870: 696c 733e 0a3c 7375 6d6d 6172 793e 4f75  ils>.<summary>Ou
+00002880: 7470 7574 3a3c 2f73 756d 6d61 7279 3e0a  tput:</summary>.
+00002890: 3c64 6976 2061 6c69 676e 3d22 6365 6e74  <div align="cent
+000028a0: 6572 223e 0a20 203c 696d 6720 7372 633d  er">.  <img src=
+000028b0: 2261 7373 6574 732f 636f 6e74 726f 6c6e  "assets/controln
+000028c0: 6574 5f72 6573 756c 742e 6a70 6722 2077  et_result.jpg" w
+000028d0: 6964 7468 3d22 3830 3022 203e 3c2f 696d  idth="800" ></im
+000028e0: 673e 0a3c 2f64 6976 3e0a 3c2f 6465 7461  g>.</div>.</deta
+000028f0: 696c 733e 0a0a 2323 2049 6e70 6169 6e74  ils>..## Inpaint
+00002900: 696e 670a 0a60 6060 7079 7468 6f6e 0a69  ing..```python.i
+00002910: 6d70 6f72 7420 746f 7263 680a 6672 6f6d  mport torch.from
+00002920: 2064 6966 6675 7365 7273 2069 6d70 6f72   diffusers impor
+00002930: 7420 4175 746f 5069 7065 6c69 6e65 466f  t AutoPipelineFo
+00002940: 7249 6e70 6169 6e74 696e 672c 2044 4449  rInpainting, DDI
+00002950: 4d53 6368 6564 756c 6572 0a66 726f 6d20  MScheduler.from 
+00002960: 6469 6666 7573 6572 732e 7574 696c 7320  diffusers.utils 
+00002970: 696d 706f 7274 206c 6f61 645f 696d 6167  import load_imag
+00002980: 650a 6672 6f6d 2068 6964 6966 6675 7369  e.from hidiffusi
+00002990: 6f6e 2069 6d70 6f72 7420 6170 706c 795f  on import apply_
+000029a0: 6869 6469 6666 7573 696f 6e2c 2072 656d  hidiffusion, rem
+000029b0: 6f76 655f 6869 6469 6666 7573 696f 6e0a  ove_hidiffusion.
+000029c0: 6672 6f6d 2050 494c 2069 6d70 6f72 7420  from PIL import 
+000029d0: 496d 6167 650a 0a73 6368 6564 756c 6572  Image..scheduler
+000029e0: 203d 2044 4449 4d53 6368 6564 756c 6572   = DDIMScheduler
+000029f0: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
+00002a00: 2822 7374 6162 696c 6974 7961 692f 7374  ("stabilityai/st
+00002a10: 6162 6c65 2d64 6966 6675 7369 6f6e 2d78  able-diffusion-x
+00002a20: 6c2d 6261 7365 2d31 2e30 222c 2073 7562  l-base-1.0", sub
+00002a30: 666f 6c64 6572 3d22 7363 6865 6475 6c65  folder="schedule
+00002a40: 7222 290a 7069 7065 6c69 6e65 203d 2041  r").pipeline = A
+00002a50: 7574 6f50 6970 656c 696e 6546 6f72 496e  utoPipelineForIn
+00002a60: 7061 696e 7469 6e67 2e66 726f 6d5f 7072  painting.from_pr
+00002a70: 6574 7261 696e 6564 280a 2020 2020 2264  etrained(.    "d
+00002a80: 6966 6675 7365 7273 2f73 7461 626c 652d  iffusers/stable-
+00002a90: 6469 6666 7573 696f 6e2d 786c 2d31 2e30  diffusion-xl-1.0
+00002aa0: 2d69 6e70 6169 6e74 696e 672d 302e 3122  -inpainting-0.1"
+00002ab0: 2c20 746f 7263 685f 6474 7970 653d 746f  , torch_dtype=to
+00002ac0: 7263 682e 666c 6f61 7431 362c 2076 6172  rch.float16, var
+00002ad0: 6961 6e74 3d22 6670 3136 222c 200a 2020  iant="fp16", .  
+00002ae0: 2020 7363 6865 6475 6c65 723d 7363 6865    scheduler=sche
+00002af0: 6475 6c65 720a 290a 0a23 2041 7070 6c79  duler.)..# Apply
+00002b00: 2068 6964 6966 6675 7369 6f6e 2077 6974   hidiffusion wit
+00002b10: 6820 6120 7369 6e67 6c65 206c 696e 6520  h a single line 
+00002b20: 6f66 2063 6f64 652e 0a61 7070 6c79 5f68  of code..apply_h
+00002b30: 6964 6966 6675 7369 6f6e 2870 6970 656c  idiffusion(pipel
+00002b40: 696e 6529 0a0a 7069 7065 6c69 6e65 2e65  ine)..pipeline.e
+00002b50: 6e61 626c 655f 6d6f 6465 6c5f 6370 755f  nable_model_cpu_
+00002b60: 6f66 666c 6f61 6428 290a 2320 7265 6d6f  offload().# remo
+00002b70: 7665 2066 6f6c 6c6f 7769 6e67 206c 696e  ve following lin
+00002b80: 6520 6966 2078 466f 726d 6572 7320 6973  e if xFormers is
+00002b90: 206e 6f74 2069 6e73 7461 6c6c 6564 0a70   not installed.p
+00002ba0: 6970 656c 696e 652e 656e 6162 6c65 5f78  ipeline.enable_x
+00002bb0: 666f 726d 6572 735f 6d65 6d6f 7279 5f65  formers_memory_e
+00002bc0: 6666 6963 6965 6e74 5f61 7474 656e 7469  fficient_attenti
+00002bd0: 6f6e 2829 0a0a 2320 6c6f 6164 2062 6173  on()..# load bas
+00002be0: 6520 616e 6420 6d61 736b 2069 6d61 6765  e and mask image
+00002bf0: 0a69 6d67 5f75 726c 203d 2022 6874 7470  .img_url = "http
+00002c00: 733a 2f2f 6875 6767 696e 6766 6163 652e  s://huggingface.
+00002c10: 636f 2f64 6174 6173 6574 732f 6875 6767  co/datasets/hugg
+00002c20: 696e 6766 6163 652f 646f 6375 6d65 6e74  ingface/document
+00002c30: 6174 696f 6e2d 696d 6167 6573 2f72 6573  ation-images/res
+00002c40: 6f6c 7665 2f6d 6169 6e2f 6469 6666 7573  olve/main/diffus
+00002c50: 6572 732f 7364 786c 2d74 6578 7432 696d  ers/sdxl-text2im
+00002c60: 672e 706e 6722 0a69 6e69 745f 696d 6167  g.png".init_imag
+00002c70: 6520 3d20 6c6f 6164 5f69 6d61 6765 2869  e = load_image(i
+00002c80: 6d67 5f75 726c 290a 2320 6c6f 6164 206d  mg_url).# load m
+00002c90: 6173 6b5f 696d 6167 652e 6a70 6720 696e  ask_image.jpg in
+00002ca0: 2074 6865 2061 7373 6574 7320 6669 6c65   the assets file
+00002cb0: 2e0a 6d61 736b 5f69 6d61 6765 203d 2049  ..mask_image = I
+00002cc0: 6d61 6765 2e6f 7065 6e28 226d 6173 6b5f  mage.open("mask_
+00002cd0: 696d 6167 652e 706e 6722 290a 0a70 726f  image.png")..pro
+00002ce0: 6d70 7420 3d20 2022 4120 7374 6561 6d70  mpt =  "A steamp
+00002cf0: 756e 6b20 6578 706c 6f72 6572 2069 6e20  unk explorer in 
+00002d00: 6120 6c65 6174 6865 7220 6176 6961 746f  a leather aviato
+00002d10: 7220 6361 7020 616e 6420 676f 6767 6c65  r cap and goggle
+00002d20: 732c 2077 6974 6820 6120 6272 6173 7320  s, with a brass 
+00002d30: 7465 6c65 7363 6f70 6520 696e 2068 616e  telescope in han
+00002d40: 642c 2073 7461 6e64 7320 616d 6964 7374  d, stands amidst
+00002d50: 2074 6f77 6572 696e 6720 616e 6369 656e   towering ancien
+00002d60: 7420 7472 6565 732c 2074 6865 6972 2072  t trees, their r
+00002d70: 6f6f 7473 2065 6e74 7769 6e65 6420 7769  oots entwined wi
+00002d80: 7468 2069 6e74 7269 6361 7465 2067 6561  th intricate gea
+00002d90: 7273 2061 6e64 2070 6970 6573 2e22 0a0a  rs and pipes."..
+00002da0: 6e65 6761 7469 7665 5f70 726f 6d70 7420  negative_prompt 
+00002db0: 3d20 2262 6c75 7272 792c 2075 676c 792c  = "blurry, ugly,
+00002dc0: 2064 7570 6c69 6361 7465 2c20 706f 6f72   duplicate, poor
+00002dd0: 6c79 2064 7261 776e 2c20 6465 666f 726d  ly drawn, deform
+00002de0: 6564 2c20 6d6f 7361 6963 220a 696d 6167  ed, mosaic".imag
+00002df0: 6520 3d20 7069 7065 6c69 6e65 2870 726f  e = pipeline(pro
+00002e00: 6d70 743d 7072 6f6d 7074 2c20 696d 6167  mpt=prompt, imag
+00002e10: 653d 696e 6974 5f69 6d61 6765 2c20 6d61  e=init_image, ma
+00002e20: 736b 5f69 6d61 6765 3d6d 6173 6b5f 696d  sk_image=mask_im
+00002e30: 6167 652c 2068 6569 6768 743d 3230 3438  age, height=2048
+00002e40: 2c20 7769 6474 683d 3230 3438 2c20 7374  , width=2048, st
+00002e50: 7265 6e67 7468 3d30 2e38 352c 2067 7569  rength=0.85, gui
+00002e60: 6461 6e63 655f 7363 616c 653d 3132 2e35  dance_scale=12.5
+00002e70: 2c20 6e65 6761 7469 7665 5f70 726f 6d70  , negative_promp
+00002e80: 7420 3d20 6e65 6761 7469 7665 5f70 726f  t = negative_pro
+00002e90: 6d70 742c 2065 7461 3d31 2e30 292e 696d  mpt, eta=1.0).im
+00002ea0: 6167 6573 5b30 5d0a 696d 6167 652e 7361  ages[0].image.sa
+00002eb0: 7665 2827 7374 6561 6d70 756e 6b5f 6578  ve('steampunk_ex
+00002ec0: 706c 6f72 6572 2e6a 7067 2729 0a60 6060  plorer.jpg').```
+00002ed0: 0a0a 3c64 6574 6169 6c73 3e0a 3c73 756d  ..<details>.<sum
+00002ee0: 6d61 7279 3e4f 7574 7075 743a 3c2f 7375  mary>Output:</su
+00002ef0: 6d6d 6172 793e 0a3c 6469 7620 616c 6967  mmary>.<div alig
+00002f00: 6e3d 2263 656e 7465 7222 3e0a 2020 3c69  n="center">.  <i
+00002f10: 6d67 2073 7263 3d22 6173 7365 7473 2f69  mg src="assets/i
+00002f20: 6e70 6169 6e74 696e 675f 7265 7375 6c74  npainting_result
+00002f30: 2e6a 7067 2220 7769 6474 683d 2238 3030  .jpg" width="800
+00002f40: 2220 3e3c 2f69 6d67 3e0a 3c2f 6469 763e  " ></img>.</div>
+00002f50: 0a3c 2f64 6574 6169 6c73 3e0a 0a0a 2323  .</details>...##
+00002f60: 2049 6e74 6567 7261 7469 6f6e 2069 6e74   Integration int
+00002f70: 6f20 646f 776e 7374 7265 616d 206d 6f64  o downstream mod
+00002f80: 656c 730a 4869 4469 6666 7573 696f 6e20  els.HiDiffusion 
+00002f90: 7375 7070 6f72 7473 206d 6f64 656c 7320  supports models 
+00002fa0: 6261 7365 6420 6f6e 205b 7375 7070 6f72  based on [suppor
+00002fb0: 7465 6420 6d6f 6465 6c73 5d28 232d 7375  ted models](#-su
+00002fc0: 7070 6f72 7465 642d 6d6f 6465 6c73 292c  pported-models),
+00002fd0: 2073 7563 6820 6173 205b 4768 6962 6c69   such as [Ghibli
+00002fe0: 2d44 6966 6675 7369 6f6e 5d28 6874 7470  -Diffusion](http
+00002ff0: 733a 2f2f 6875 6767 696e 6766 6163 652e  s://huggingface.
+00003000: 636f 2f6e 6974 726f 736f 636b 652f 4768  co/nitrosocke/Gh
+00003010: 6962 6c69 2d44 6966 6675 7369 6f6e 292c  ibli-Diffusion),
+00003020: 205b 506c 6179 6772 6f75 6e64 5d28 6874   [Playground](ht
+00003030: 7470 733a 2f2f 6875 6767 696e 6766 6163  tps://huggingfac
+00003040: 652e 636f 2f70 6c61 7967 726f 756e 6461  e.co/playgrounda
+00003050: 692f 706c 6179 6772 6f75 6e64 2d76 322d  i/playground-v2-
+00003060: 3130 3234 7078 2d61 6573 7468 6574 6963  1024px-aesthetic
+00003070: 292c 2065 7463 2e0a 0a23 2323 2047 6869  ), etc...### Ghi
+00003080: 626c 692d 4469 6666 7573 696f 6e0a 6060  bli-Diffusion.``
+00003090: 6070 7974 686f 6e0a 6672 6f6d 2064 6966  `python.from dif
+000030a0: 6675 7365 7273 2069 6d70 6f72 7420 5374  fusers import St
+000030b0: 6162 6c65 4469 6666 7573 696f 6e50 6970  ableDiffusionPip
+000030c0: 656c 696e 652c 2044 4449 4d53 6368 6564  eline, DDIMSched
+000030d0: 756c 6572 0a69 6d70 6f72 7420 746f 7263  uler.import torc
+000030e0: 680a 6672 6f6d 2068 6964 6966 6675 7369  h.from hidiffusi
+000030f0: 6f6e 2069 6d70 6f72 7420 6170 706c 795f  on import apply_
+00003100: 6869 6469 6666 7573 696f 6e2c 2072 656d  hidiffusion, rem
+00003110: 6f76 655f 6869 6469 6666 7573 696f 6e0a  ove_hidiffusion.
+00003120: 0a6d 6f64 656c 5f69 6420 3d20 226e 6974  .model_id = "nit
+00003130: 726f 736f 636b 652f 4768 6962 6c69 2d44  rosocke/Ghibli-D
+00003140: 6966 6675 7369 6f6e 220a 7363 6865 6475  iffusion".schedu
+00003150: 6c65 7220 3d20 4444 494d 5363 6865 6475  ler = DDIMSchedu
+00003160: 6c65 722e 6672 6f6d 5f70 7265 7472 6169  ler.from_pretrai
+00003170: 6e65 6428 6d6f 6465 6c5f 6964 2c20 7375  ned(model_id, su
+00003180: 6266 6f6c 6465 723d 2273 6368 6564 756c  bfolder="schedul
+00003190: 6572 2229 0a70 6970 6520 3d20 5374 6162  er").pipe = Stab
+000031a0: 6c65 4469 6666 7573 696f 6e50 6970 656c  leDiffusionPipel
+000031b0: 696e 652e 6672 6f6d 5f70 7265 7472 6169  ine.from_pretrai
+000031c0: 6e65 6428 6d6f 6465 6c5f 6964 2c20 746f  ned(model_id, to
+000031d0: 7263 685f 6474 7970 653d 746f 7263 682e  rch_dtype=torch.
+000031e0: 666c 6f61 7431 3629 0a70 6970 6520 3d20  float16).pipe = 
+000031f0: 7069 7065 2e74 6f28 2263 7564 6122 290a  pipe.to("cuda").
+00003200: 0a23 2041 7070 6c79 2068 6964 6966 6675  .# Apply hidiffu
+00003210: 7369 6f6e 2077 6974 6820 6120 7369 6e67  sion with a sing
+00003220: 6c65 206c 696e 6520 6f66 2063 6f64 652e  le line of code.
+00003230: 0a61 7070 6c79 5f68 6964 6966 6675 7369  .apply_hidiffusi
+00003240: 6f6e 2870 6970 6529 0a0a 7072 6f6d 7074  on(pipe)..prompt
+00003250: 203d 2022 6768 6962 6c69 2073 7479 6c65   = "ghibli style
+00003260: 206d 6167 6963 616c 2070 7269 6e63 6573   magical princes
+00003270: 7320 7769 7468 2067 6f6c 6465 6e20 6861  s with golden ha
+00003280: 6972 220a 6e65 6761 7469 7665 5f70 726f  ir".negative_pro
+00003290: 6d70 743d 2262 6c75 7272 792c 2075 676c  mpt="blurry, ugl
+000032a0: 792c 2064 7570 6c69 6361 7465 2c20 706f  y, duplicate, po
+000032b0: 6f72 6c79 2064 7261 776e 2066 6163 652c  orly drawn face,
+000032c0: 2064 6566 6f72 6d65 642c 206d 6f73 6169   deformed, mosai
+000032d0: 632c 2061 7274 6966 6163 7473 2c20 6261  c, artifacts, ba
+000032e0: 6420 6c69 6d62 7322 0a69 6d61 6765 203d  d limbs".image =
+000032f0: 2070 6970 6528 7072 6f6d 7074 2c20 6865   pipe(prompt, he
+00003300: 6967 6874 3d31 3032 342c 2077 6964 7468  ight=1024, width
+00003310: 3d31 3032 342c 2065 7461 3d31 2e30 2c20  =1024, eta=1.0, 
+00003320: 6e65 6761 7469 7665 5f70 726f 6d70 743d  negative_prompt=
+00003330: 6e65 6761 7469 7665 5f70 726f 6d70 7429  negative_prompt)
+00003340: 2e69 6d61 6765 735b 305d 0a0a 696d 6167  .images[0]..imag
+00003350: 652e 7361 7665 2822 2e2f 6d61 6769 6361  e.save("./magica
+00003360: 6c5f 7072 696e 6365 7373 2e6a 7067 2229  l_princess.jpg")
+00003370: 0a60 6060 0a3c 6465 7461 696c 733e 0a3c  .```.<details>.<
+00003380: 7375 6d6d 6172 793e 4f75 7470 7574 3a3c  summary>Output:<
+00003390: 2f73 756d 6d61 7279 3e0a 3c64 6976 2061  /summary>.<div a
+000033a0: 6c69 676e 3d22 6365 6e74 6572 223e 0a20  lign="center">. 
+000033b0: 203c 696d 6720 7372 633d 2261 7373 6574   <img src="asset
+000033c0: 732f 6768 6962 6c69 5f64 6966 6675 7369  s/ghibli_diffusi
+000033d0: 6f6e 2e6a 7067 2220 7769 6474 683d 2238  on.jpg" width="8
+000033e0: 3030 2220 3e3c 2f69 6d67 3e0a 3c2f 6469  00" ></img>.</di
+000033f0: 763e 0a3c 2f64 6574 6169 6c73 3e0a 0a23  v>.</details>..#
+00003400: 2323 2050 6c61 7967 726f 756e 640a 6060  ## Playground.``
+00003410: 6070 7974 686f 6e0a 6672 6f6d 2064 6966  `python.from dif
+00003420: 6675 7365 7273 2069 6d70 6f72 7420 4469  fusers import Di
+00003430: 6666 7573 696f 6e50 6970 656c 696e 650a  ffusionPipeline.
+00003440: 696d 706f 7274 2074 6f72 6368 0a66 726f  import torch.fro
+00003450: 6d20 6869 6469 6666 7573 696f 6e20 696d  m hidiffusion im
+00003460: 706f 7274 2061 7070 6c79 5f68 6964 6966  port apply_hidif
+00003470: 6675 7369 6f6e 2c20 7265 6d6f 7665 5f68  fusion, remove_h
+00003480: 6964 6966 6675 7369 6f6e 0a0a 7069 7065  idiffusion..pipe
+00003490: 203d 2044 6966 6675 7369 6f6e 5069 7065   = DiffusionPipe
+000034a0: 6c69 6e65 2e66 726f 6d5f 7072 6574 7261  line.from_pretra
+000034b0: 696e 6564 280a 2020 2020 2270 6c61 7967  ined(.    "playg
+000034c0: 726f 756e 6461 692f 706c 6179 6772 6f75  roundai/playgrou
+000034d0: 6e64 2d76 322d 3130 3234 7078 2d61 6573  nd-v2-1024px-aes
+000034e0: 7468 6574 6963 222c 0a20 2020 2074 6f72  thetic",.    tor
+000034f0: 6368 5f64 7479 7065 3d74 6f72 6368 2e66  ch_dtype=torch.f
+00003500: 6c6f 6174 3136 2c0a 2020 2020 7573 655f  loat16,.    use_
+00003510: 7361 6665 7465 6e73 6f72 733d 5472 7565  safetensors=True
+00003520: 2c0a 2020 2020 6164 645f 7761 7465 726d  ,.    add_waterm
+00003530: 6172 6b65 723d 4661 6c73 652c 0a20 2020  arker=False,.   
+00003540: 2076 6172 6961 6e74 3d22 6670 3136 220a   variant="fp16".
+00003550: 290a 7069 7065 2e74 6f28 2263 7564 6122  ).pipe.to("cuda"
+00003560: 290a 7069 7065 2e65 6e61 626c 655f 7866  ).pipe.enable_xf
+00003570: 6f72 6d65 7273 5f6d 656d 6f72 795f 6566  ormers_memory_ef
+00003580: 6669 6369 656e 745f 6174 7465 6e74 696f  ficient_attentio
+00003590: 6e28 290a 0a23 2041 7070 6c79 2068 6964  n()..# Apply hid
+000035a0: 6966 6675 7369 6f6e 2077 6974 6820 6120  iffusion with a 
+000035b0: 7369 6e67 6c65 206c 696e 6520 6f66 2063  single line of c
+000035c0: 6f64 652e 0a61 7070 6c79 5f68 6964 6966  ode..apply_hidif
+000035d0: 6675 7369 6f6e 2870 6970 6529 0a0a 7072  fusion(pipe)..pr
+000035e0: 6f6d 7074 203d 2022 5468 6520 6c69 7474  ompt = "The litt
+000035f0: 6c65 2067 6972 6c20 7269 6469 6e67 2061  le girl riding a
+00003600: 2062 696b 652c 2069 6e20 6120 6265 6175   bike, in a beau
+00003610: 7469 6675 6c20 616e 696d 6520 7363 656e  tiful anime scen
+00003620: 6520 6279 2048 6179 616f 204d 6979 617a  e by Hayao Miyaz
+00003630: 616b 693a 2061 2073 6e6f 7779 2054 6f6b  aki: a snowy Tok
+00003640: 796f 2063 6974 7920 7769 7468 206d 6173  yo city with mas
+00003650: 7369 7665 204d 6979 617a 616b 6920 636c  sive Miyazaki cl
+00003660: 6f75 6473 2066 6c6f 6174 696e 6720 696e  ouds floating in
+00003670: 2074 6865 2062 6c75 6520 736b 792c 2065   the blue sky, e
+00003680: 6e63 6861 6e74 696e 6720 736e 6f77 7363  nchanting snowsc
+00003690: 6170 6573 206f 6620 7468 6520 6369 7479  apes of the city
+000036a0: 2077 6974 6820 6272 6967 6874 2073 756e   with bright sun
+000036b0: 6c69 6768 742c 204d 6979 617a 616b 6927  light, Miyazaki'
+000036c0: 7320 6c61 6e64 7363 6170 6520 696d 6167  s landscape imag
+000036d0: 6572 792c 204a 6170 616e 6573 6520 6172  ery, Japanese ar
+000036e0: 7422 0a6e 6567 6174 6976 655f 7072 6f6d  t".negative_prom
+000036f0: 7074 3d22 626c 7572 7279 2c20 7567 6c79  pt="blurry, ugly
+00003700: 2c20 6475 706c 6963 6174 652c 2070 6f6f  , duplicate, poo
+00003710: 726c 7920 6472 6177 6e2c 2064 6566 6f72  rly drawn, defor
+00003720: 6d65 642c 206d 6f73 6169 6322 0a69 6d61  med, mosaic".ima
+00003730: 6765 2020 3d20 7069 7065 2870 726f 6d70  ge  = pipe(promp
+00003740: 743d 7072 6f6d 7074 2c20 6775 6964 616e  t=prompt, guidan
+00003750: 6365 5f73 6361 6c65 3d33 2e30 2c20 6865  ce_scale=3.0, he
+00003760: 6967 6874 3d32 3034 382c 2077 6964 7468  ight=2048, width
+00003770: 3d32 3034 382c 206e 6567 6174 6976 655f  =2048, negative_
+00003780: 7072 6f6d 7074 3d6e 6567 6174 6976 655f  prompt=negative_
+00003790: 7072 6f6d 7074 292e 696d 6167 6573 5b30  prompt).images[0
+000037a0: 5d0a 696d 6167 652e 7361 7665 2827 6769  ].image.save('gi
+000037b0: 726c 2e6a 7067 2729 0a60 6060 0a3c 6465  rl.jpg').```.<de
+000037c0: 7461 696c 733e 0a3c 7375 6d6d 6172 793e  tails>.<summary>
+000037d0: 4f75 7470 7574 3a3c 2f73 756d 6d61 7279  Output:</summary
+000037e0: 3e0a 3c64 6976 2061 6c69 676e 3d22 6365  >.<div align="ce
+000037f0: 6e74 6572 223e 0a20 203c 696d 6720 7372  nter">.  <img sr
+00003800: 633d 2261 7373 6574 732f 706c 6179 6772  c="assets/playgr
+00003810: 6f75 6e64 5f72 6573 756c 742e 6a70 6722  ound_result.jpg"
+00003820: 2077 6964 7468 3d22 3830 3022 203e 3c2f   width="800" ></
+00003830: 696d 673e 0a3c 2f64 6976 3e0a 3c2f 6465  img>.</div>.</de
+00003840: 7461 696c 733e 0a0a 2323 20f0 9f99 8f20  tails>..## .... 
+00003850: 4163 6b6e 6f77 6c65 6467 656d 656e 7473  Acknowledgements
+00003860: 0a0a 5468 6973 2063 6f64 6562 6173 6520  ..This codebase 
+00003870: 6973 2062 6173 6564 206f 6e20 5b74 6f6d  is based on [tom
+00003880: 6573 645d 2868 7474 7073 3a2f 2f67 6974  esd](https://git
+00003890: 6875 622e 636f 6d2f 6462 6f6c 7961 2f74  hub.com/dbolya/t
+000038a0: 6f6d 6573 6429 2061 6e64 205b 6469 6666  omesd) and [diff
+000038b0: 7573 6572 735d 2868 7474 7073 3a2f 2f67  users](https://g
+000038c0: 6974 6875 622e 636f 6d2f 6875 6767 696e  ithub.com/huggin
+000038d0: 6766 6163 652f 6469 6666 7573 6572 732f  gface/diffusers/
+000038e0: 7472 6565 2f6d 6169 6e29 2e20 5468 616e  tree/main). Than
+000038f0: 6b73 210a 0a0a 0a23 2320 f09f 8e93 2043  ks!....## .... C
+00003900: 6974 6174 696f 6e0a 0a60 6060 0a40 6172  itation..```.@ar
+00003910: 7469 636c 657b 7a68 616e 6732 3032 3368  ticle{zhang2023h
+00003920: 6964 6966 6675 7369 6f6e 2c0a 2020 7469  idiffusion,.  ti
+00003930: 746c 653d 7b48 6944 6966 6675 7369 6f6e  tle={HiDiffusion
+00003940: 3a20 556e 6c6f 636b 696e 6720 4869 6768  : Unlocking High
+00003950: 6572 2d52 6573 6f6c 7574 696f 6e20 4372  er-Resolution Cr
+00003960: 6561 7469 7669 7479 2061 6e64 2045 6666  eativity and Eff
+00003970: 6963 6965 6e63 7920 696e 2050 7265 7472  iciency in Pretr
+00003980: 6169 6e65 6420 4469 6666 7573 696f 6e20  ained Diffusion 
+00003990: 4d6f 6465 6c73 7d2c 0a20 2061 7574 686f  Models},.  autho
+000039a0: 723d 7b5a 6861 6e67 2c20 5368 656e 2061  r={Zhang, Shen a
+000039b0: 6e64 2043 6865 6e2c 205a 6861 6f77 6569  nd Chen, Zhaowei
+000039c0: 2061 6e64 205a 6861 6f2c 205a 6865 6e79   and Zhao, Zheny
+000039d0: 7520 616e 6420 4368 656e 2c20 5975 6861  u and Chen, Yuha
+000039e0: 6f20 616e 6420 5461 6e67 2c20 5961 6f20  o and Tang, Yao 
+000039f0: 616e 6420 4c69 616e 672c 204a 6961 6a75  and Liang, Jiaju
+00003a00: 6e7d 2c0a 2020 6a6f 7572 6e61 6c3d 7b61  n},.  journal={a
+00003a10: 7258 6976 2070 7265 7072 696e 7420 6172  rXiv preprint ar
+00003a20: 5869 763a 3233 3131 2e31 3735 3238 7d2c  Xiv:2311.17528},
+00003a30: 0a20 2079 6561 723d 7b32 3032 337d 0a7d  .  year={2023}.}
+00003a40: 0a60 6060 0a                             .```.
```

### Comparing `hidiffusion-0.1.1/hidiffusion/hidiffusion.py` & `hidiffusion-0.1.2/hidiffusion/hidiffusion.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,21 +1,30 @@
 import torch
 import math
+import os
 from typing import Type, Dict, Any, Tuple, Callable, Optional, Union, List
 import torch.nn.functional as F
 from .utils import isinstance_str
 from dataclasses import dataclass
-from diffusers.models.unet_2d_condition import UNet2DConditionOutput
+import diffusers
 from diffusers.utils import USE_PEFT_BACKEND, replace_example_docstring
 from diffusers.pipelines.stable_diffusion_xl.pipeline_output import StableDiffusionXLPipelineOutput
 from diffusers.image_processor import PipelineImageInput, VaeImageProcessor
 from diffusers.utils.torch_utils import is_compiled_module, is_torch_version, randn_tensor
 from diffusers.pipelines.controlnet.multicontrolnet import MultiControlNetModel
 from diffusers.models import ControlNetModel
 
+diffusers_version = diffusers.__version__
+if diffusers_version < "0.27.0":
+    from diffusers.models.unet_2d_condition import UNet2DConditionOutput
+    old_diffusers = True 
+else:
+    from diffusers.models.unets.unet_2d_condition import UNet2DConditionOutput
+    old_diffusers = False
+
 def sd15_hidiffusion_key():
     modified_key = dict()
     modified_key['down_module_key'] = ['down_blocks.0.downsamplers.0.conv']
     modified_key['down_module_key_extra'] = ['down_blocks.1']
     modified_key['up_module_key'] = ['up_blocks.2.upsamplers.0.conv']
     modified_key['up_module_key_extra'] = ['up_blocks.2']
     modified_key['windown_attn_module_key'] = ['down_blocks.0.attentions.0.transformer_blocks.0', 
@@ -58,14 +67,22 @@
                                'up_blocks.1.attentions.1.transformer_blocks.0', 
                                'up_blocks.1.attentions.1.transformer_blocks.1', 
                                'up_blocks.1.attentions.2.transformer_blocks.0', 
                                'up_blocks.1.attentions.2.transformer_blocks.1']
     
     return modified_key
 
+# supported official model. If you use non-official model based on the following models/pipelines, hidiffusion will automatically select the best strategy to fit it. 
+surppoted_official_model = [
+    'runwayml/stable-diffusion-v1-5', 'stabilityai/stable-diffusion-2-1-base',
+    'stabilityai/stable-diffusion-xl-base-1.0', 'diffusers/stable-diffusion-xl-1.0-inpainting-0.1',
+    'stabilityai/sdxl-turbo'
+]
+
+
 # T1_ratio: see T1 introduced in the main paper. T1 = number_inference_step * T1_ratio. A higher T1_ratio can better mitigate object duplication. We set T1_ratio=0.4 by default. You'd better adjust it to fit your prompt. Only active when apply_raunet=True.
 # T2_ratio: see T2 introduced in the appendix, used in extreme resolution image generation. T2 = number_inference_step * T2_ratio. A higher T2_ratio can better mitigate object duplication. Only active when apply_raunet=True
 switching_threshold_ratio_dict = {
     'sd15_1024': {'T1_ratio': 0.4, 'T2_ratio': 0.0},
     'sd15_2048': {'T1_ratio': 0.7, 'T2_ratio': 0.3},
     'sdxl_2048': {'T1_ratio': 0.4, 'T2_ratio': 0.0},
     'sdxl_4096': {'T1_ratio': 0.7, 'T2_ratio': 0.3},
@@ -78,15 +95,21 @@
 controlnet_apply_steps_rate = 0.6
 
 is_aggressive_raunet = True
 aggressive_step = 8
 
 inpainting_is_aggressive_raunet = False
 
-
+current_path = os.path.dirname(__file__)
+module_key_path = os.path.join(current_path, "sd_module_key")
+with open(os.path.join(module_key_path, 'sd15_module_key.txt'), 'r') as f:
+    sd15_module_key = f.read().splitlines()
+    
+with open(os.path.join(module_key_path, 'sdxl_module_key.txt'), 'r') as f:
+    sdxl_module_key = f.read().splitlines()
 
 def make_diffusers_sdxl_contrtolnet_ppl(block_class):
 
     EXAMPLE_DOC_STRING = """
         Examples:
             ```py
             >>> # !pip install opencv-python transformers accelerate
@@ -981,15 +1004,16 @@
                         encoder_hidden_states=encoder_hidden_states,
                         attention_mask=attention_mask,
                         cross_attention_kwargs=cross_attention_kwargs,
                         encoder_attention_mask=encoder_attention_mask,
                         **additional_residuals,
                     )
                 else:
-                    sample, res_samples = downsample_block(hidden_states=sample, temb=emb, scale=lora_scale)
+                    # sample, res_samples = downsample_block(hidden_states=sample, temb=emb, scale=lora_scale)
+                    sample, res_samples = downsample_block(hidden_states=sample, temb=emb)
                     if is_adapter and len(down_intrablock_additional_residuals) > 0:
                         sample += down_intrablock_additional_residuals.pop(0)
 
                 down_block_res_samples += res_samples
 
             if is_controlnet:
                 new_down_block_res_samples = ()
@@ -1056,16 +1080,23 @@
                     )
                 else:
                     sample = upsample_block(
                         hidden_states=sample,
                         temb=emb,
                         res_hidden_states_tuple=res_samples,
                         upsample_size=upsample_size,
-                        scale=lora_scale,
+                        # scale=lora_scale,
                     )
+                    # sample = upsample_block(
+                    #     hidden_states=sample,
+                    #     temb=emb,
+                    #     res_hidden_states_tuple=res_samples,
+                    #     upsample_size=upsample_size,
+                    #     scale=lora_scale,
+                    # )
 
             # 6. post-process
             if self.conv_norm_out:
                 sample = self.conv_norm_out(sample)
                 sample = self.conv_act(sample)
             sample = self.conv_out(sample)
 
@@ -1257,18 +1288,22 @@
             if self.use_ada_layer_norm_single:
                 norm_hidden_states = self.norm2(hidden_states)
                 norm_hidden_states = norm_hidden_states * (1 + scale_mlp) + shift_mlp
 
             if self._chunk_size is not None:
                 # "feed_forward_chunk_size" can be used to save memory
                 ff_output = _chunked_feed_forward(
-                    self.ff, norm_hidden_states, self._chunk_dim, self._chunk_size, lora_scale=lora_scale
+                    self.ff, norm_hidden_states, self._chunk_dim, self._chunk_size
                 )
+                # ff_output = _chunked_feed_forward(
+                #     self.ff, norm_hidden_states, self._chunk_dim, self._chunk_size, lora_scale=lora_scale
+                # )
             else:
-                ff_output = self.ff(norm_hidden_states, scale=lora_scale)
+                ff_output = self.ff(norm_hidden_states)
+                # ff_output = self.ff(norm_hidden_states, scale=lora_scale)
 
             if self.use_ada_layer_norm_zero:
                 ff_output = gate_mlp.unsqueeze(1) * ff_output
             elif self.use_ada_layer_norm_single:
                 ff_output = gate_mlp * ff_output
 
             hidden_states = ff_output + hidden_states
@@ -1368,15 +1403,16 @@
                         encoder_hidden_states=encoder_hidden_states,
                         cross_attention_kwargs=cross_attention_kwargs,
                         attention_mask=attention_mask,
                         encoder_attention_mask=encoder_attention_mask,
                         return_dict=False,
                     )[0]
                 else:
-                    hidden_states = resnet(hidden_states, temb, scale=lora_scale)
+                    # hidden_states = resnet(hidden_states, temb, scale=lora_scale)
+                    hidden_states = resnet(hidden_states, temb)
                     hidden_states = attn(
                         hidden_states,
                         encoder_hidden_states=encoder_hidden_states,
                         cross_attention_kwargs=cross_attention_kwargs,
                         attention_mask=attention_mask,
                         encoder_attention_mask=encoder_attention_mask,
                         return_dict=False,
@@ -1391,15 +1427,16 @@
                         hidden_states = F.avg_pool2d(hidden_states, kernel_size=(2,2))
                     elif self.timestep < self.T1:
                         hidden_states = F.avg_pool2d(hidden_states, kernel_size=(2,2))
                 output_states = output_states + (hidden_states,)
 
             if self.downsamplers is not None:
                 for downsampler in self.downsamplers:
-                    hidden_states = downsampler(hidden_states, scale=lora_scale)
+                    hidden_states = downsampler(hidden_states)
+                    # hidden_states = downsampler(hidden_states, scale=lora_scale)
 
                 output_states = output_states + (hidden_states,)
                 
             self.timestep += 1
             if self.timestep == self.max_timestep:
                 self.timestep = 0
                 
@@ -1427,15 +1464,14 @@
             temb: Optional[torch.FloatTensor] = None,
             encoder_hidden_states: Optional[torch.FloatTensor] = None,
             cross_attention_kwargs: Optional[Dict[str, Any]] = None,
             upsample_size: Optional[int] = None,
             attention_mask: Optional[torch.FloatTensor] = None,
             encoder_attention_mask: Optional[torch.FloatTensor] = None,
         ) -> torch.FloatTensor:
-        
             self.max_timestep = len(self.info['scheduler'].timesteps)
             
             ori_H, ori_W = self.info['size']
             if self.model == 'sd15':
                 if ori_H < 256 or ori_W < 256:
                     self.T1_ratio = switching_threshold_ratio_dict['sd15_1024'][self.switching_threshold_ratio]
                 else:
@@ -1515,15 +1551,16 @@
                         encoder_hidden_states=encoder_hidden_states,
                         cross_attention_kwargs=cross_attention_kwargs,
                         attention_mask=attention_mask,
                         encoder_attention_mask=encoder_attention_mask,
                         return_dict=False,
                     )[0]
                 else:
-                    hidden_states = resnet(hidden_states, temb, scale=lora_scale)
+                    hidden_states = resnet(hidden_states, temb)
+                    # hidden_states = resnet(hidden_states, temb, scale=lora_scale)
                     hidden_states = attn(
                         hidden_states,
                         encoder_hidden_states=encoder_hidden_states,
                         cross_attention_kwargs=cross_attention_kwargs,
                         attention_mask=attention_mask,
                         encoder_attention_mask=encoder_attention_mask,
                         return_dict=False,
@@ -1535,15 +1572,16 @@
                             hidden_states = F.interpolate(hidden_states, size=re_size, mode='bicubic')
                         elif self.timestep < self.T1:
                             re_size = (int(hidden_states.shape[-2] * 2), int(hidden_states.shape[-1] * 2))
                             hidden_states = F.interpolate(hidden_states, size=re_size, mode='bicubic')
                     
             if self.upsamplers is not None:
                 for upsampler in self.upsamplers:
-                    hidden_states = upsampler(hidden_states, upsample_size, scale=lora_scale)
+                    hidden_states = upsampler(hidden_states, upsample_size)
+                    # hidden_states = upsampler(hidden_states, upsample_size, scale=lora_scale)
 
             self.timestep += 1
             if self.timestep == self.max_timestep:
                 self.timestep = 0
 
             return hidden_states
     return cross_attn_up_block
@@ -1557,15 +1595,15 @@
         _parent = block_class
         T1_ratio = 0
         T1 = 0
         timestep = 0
         aggressive_raunet = False
         max_timestep = 50
         
-        def forward(self, hidden_states: torch.Tensor, scale: float = 1.0) -> torch.Tensor:
+        def forward(self, hidden_states: torch.Tensor, scale = 1.0) -> torch.Tensor:
             self.max_timestep = len(self.info['scheduler'].timesteps)
             ori_H, ori_W = self.info['size']
             if self.model == 'sd15':
                 if ori_H < 256 or ori_W < 256:
                     self.T1_ratio = switching_threshold_ratio_dict['sd15_1024'][self.switching_threshold_ratio]
                 else:
                     self.T1_ratio = switching_threshold_ratio_dict['sd15_2048'][self.switching_threshold_ratio]
@@ -1595,49 +1633,62 @@
                 self.ori_stride = self.stride
                 self.ori_padding = self.padding
                 self.ori_dilation = self.dilation
                 
                 self.stride = (4,4)
                 self.padding = (2,2)
                 self.dilation = (2,2)
-                
-            if self.lora_layer is None:
-                # make sure to the functional Conv2D function as otherwise torch.compile's graph will break
-                # see: https://github.com/huggingface/diffusers/pull/4315
+            
+            if old_diffusers:
+                if self.lora_layer is None:
+                    # make sure to the functional Conv2D function as otherwise torch.compile's graph will break
+                    # see: https://github.com/huggingface/diffusers/pull/4315
+                    hidden_states = F.conv2d(
+                        hidden_states, self.weight, self.bias, self.stride, self.padding, self.dilation, self.groups
+                    )
+                    if self.timestep < self.T1:
+                        self.stride = self.ori_stride
+                        self.padding = self.ori_padding
+                        self.dilation = self.ori_dilation
+                    self.timestep += 1
+                    if self.timestep == self.max_timestep:
+                        self.timestep = 0
+                    return hidden_states
+                else:
+                    original_outputs = F.conv2d(
+                        hidden_states, self.weight, self.bias, self.stride, self.padding, self.dilation, self.groups
+                    )
+                    return original_outputs + (scale * self.lora_layer(hidden_states))
+            else:
                 hidden_states = F.conv2d(
                     hidden_states, self.weight, self.bias, self.stride, self.padding, self.dilation, self.groups
                 )
                 if self.timestep < self.T1:
                     self.stride = self.ori_stride
                     self.padding = self.ori_padding
                     self.dilation = self.ori_dilation
                 self.timestep += 1
                 if self.timestep == self.max_timestep:
                     self.timestep = 0
                 return hidden_states
-            else:
-                original_outputs = F.conv2d(
-                    hidden_states, self.weight, self.bias, self.stride, self.padding, self.dilation, self.groups
-                )
-                return original_outputs + (scale * self.lora_layer(hidden_states))
     return downsampler_block
 
 
 def make_diffusers_upsampler_block(block_class: Type[torch.nn.Module]) -> Type[torch.nn.Module]:
     # replace conventional upsampler with resolution-aware downsampler
     class upsampler_block(block_class):
         # Save for unpatching later
         _parent = block_class
         T1_ratio = 0
         T1 = 0
         timestep = 0
         aggressive_raunet = False
         max_timestep = 50
         
-        def forward(self, hidden_states: torch.Tensor, scale: float = 1.0) -> torch.Tensor:
+        def forward(self, hidden_states: torch.Tensor, scale = 1.0) -> torch.Tensor:
             self.max_timestep = len(self.info['scheduler'].timesteps)
 
             ori_H, ori_W = self.info['size']
             if self.model == 'sd15':
                 if ori_H < 256 or ori_W < 256:
                     self.T1_ratio = switching_threshold_ratio_dict['sd15_1024'][self.switching_threshold_ratio]
                 else:
@@ -1666,26 +1717,31 @@
             else:            
                 self.T1 = int(self.max_timestep * self.T1_ratio)
             if self.timestep < self.T1:
                 hidden_states = F.interpolate(hidden_states, scale_factor=2.0, mode='bicubic')
             self.timestep += 1
             if self.timestep == self.max_timestep:
                 self.timestep = 0
-                
-            if self.lora_layer is None:
-                # make sure to the functional Conv2D function as otherwise torch.compile's graph will break
-                # see: https://github.com/huggingface/diffusers/pull/4315
-                return F.conv2d(
-                    hidden_states, self.weight, self.bias, self.stride, self.padding, self.dilation, self.groups
-                )
+            
+            if old_diffusers:
+                if self.lora_layer is None:
+                    # make sure to the functional Conv2D function as otherwise torch.compile's graph will break
+                    # see: https://github.com/huggingface/diffusers/pull/4315
+                    return F.conv2d(
+                        hidden_states, self.weight, self.bias, self.stride, self.padding, self.dilation, self.groups
+                    )
+                else:
+                    original_outputs = F.conv2d(
+                        hidden_states, self.weight, self.bias, self.stride, self.padding, self.dilation, self.groups
+                    )
+                    return original_outputs + (scale * self.lora_layer(hidden_states))
             else:
-                original_outputs = F.conv2d(
+                return F.conv2d(
                     hidden_states, self.weight, self.bias, self.stride, self.padding, self.dilation, self.groups
                 )
-                return original_outputs + (scale * self.lora_layer(hidden_states))
     return upsampler_block
 
 
 
 def hook_diffusion_model(model: torch.nn.Module):
     """ Adds a forward pre hook to get the image size. This hook can be removed with remove_hidiffusion. """
     def hook(module, args):
@@ -1710,42 +1766,45 @@
 
     # Make sure the module is not currently patched
     remove_hidiffusion(model)
 
     is_diffusers = isinstance_str(model, "DiffusionPipeline") or isinstance_str(model, "ModelMixin")
 
     if not is_diffusers:
-        if not hasattr(model, "model") or not hasattr(model.model, "diffusion_model"):
-            # Provided model not supported
-            raise RuntimeError("Provided model was not a Stable Diffusion / Latent Diffusion model, as expected.")
-        diffusion_model = model.model.diffusion_model
+        # if not hasattr(model, "model") or not hasattr(model.model, "diffusion_model"):
+        #     # Provided model not supported
+        #     raise RuntimeError("Provided model was not a Stable Diffusion / Latent Diffusion model, as expected.")
+        # diffusion_model = model.model.diffusion_model
+        raise RuntimeError("Provided model was not a diffusers model/pipeline, as expected.")
     else:
         if hasattr(model, 'controlnet'):
             make_ppl_fn = make_diffusers_sdxl_contrtolnet_ppl
             model.__class__ = make_ppl_fn(model.__class__)
             
             make_block_fn = make_diffusers_unet_2d_condition
             model.unet.__class__ = make_block_fn(model.unet.__class__)
         diffusion_model = model.unet if hasattr(model, "unet") else model
 
-
-    # if hasattr(model, 'controlnet'):
-    #     make_block_fn = make_diffusers_sdxl_contrtolnet
-    #     model.__class__ = make_block_fn(model.__class__)
-
-    # if hasattr(model, 'controlnet'):
-    # make_block_fn = make_diffusers_unet_2d_condition
-    # diffusion_model.__class__ = make_block_fn(diffusion_model.__class__)
     
+    name_or_path = model.name_or_path
+    diffusion_model_module_key = []
+    if name_or_path not in surppoted_official_model:
+        for key, module in diffusion_model.named_modules():
+            diffusion_model_module_key.append(key)
+        if set(sd15_module_key) < set(diffusion_model_module_key):
+            name_or_path = 'runwayml/stable-diffusion-v1-5'
+        elif set(sdxl_module_key) < set(diffusion_model_module_key):
+            name_or_path = 'stabilityai/stable-diffusion-xl-base-1.0'
 
+        
     diffusion_model.info = {'size': None, 'hooks': [], 'scheduler': model.scheduler, 'use_controlnet': hasattr(model, 'controlnet'),
                             'is_inpainting_task': 'inpainting' in model.name_or_path}
     hook_diffusion_model(diffusion_model)
     
-    if model.name_or_path in ['runwayml/stable-diffusion-v1-5', 'stabilityai/stable-diffusion-2-1-base']:
+    if name_or_path in ['runwayml/stable-diffusion-v1-5', 'stabilityai/stable-diffusion-2-1-base']:
         modified_key = sd15_hidiffusion_key()
         for key, module in diffusion_model.named_modules():
             if apply_raunet and key in modified_key['down_module_key']:
                 make_block_fn = make_diffusers_downsampler_block
                 module.__class__ = make_block_fn(module.__class__)
                 module.switching_threshold_ratio = 'T1_ratio'
             if apply_raunet and key in modified_key['down_module_key_extra']:
@@ -1762,15 +1821,15 @@
                 module.switching_threshold_ratio = 'T2_ratio'
             if apply_window_attn and key in modified_key['windown_attn_module_key']:
                 make_block_fn = make_diffusers_transformer_block
                 module.__class__ = make_block_fn(module.__class__)
             module.model = 'sd15'
             module.info = diffusion_model.info
             
-    elif model.name_or_path in ['stabilityai/stable-diffusion-xl-base-1.0', 'diffusers/stable-diffusion-xl-1.0-inpainting-0.1']: 
+    elif name_or_path in ['stabilityai/stable-diffusion-xl-base-1.0', 'diffusers/stable-diffusion-xl-1.0-inpainting-0.1']: 
         modified_key = sdxl_hidiffusion_key()
         for key, module in diffusion_model.named_modules():
             if apply_raunet and key in modified_key['down_module_key']:
                 make_block_fn = make_diffusers_cross_attn_down_block
                 module.__class__ = make_block_fn(module.__class__)
                 module.switching_threshold_ratio = 'T1_ratio'
                 
@@ -1791,15 +1850,15 @@
             
             if apply_window_attn and key in modified_key['windown_attn_module_key']:
                 make_block_fn = make_diffusers_transformer_block
                 module.__class__ = make_block_fn(module.__class__)
             module.model = 'sdxl'
             module.info = diffusion_model.info
                 
-    elif model.name_or_path == 'stabilityai/sdxl-turbo': 
+    elif name_or_path == 'stabilityai/sdxl-turbo': 
         modified_key = sdxl_turbo_hidiffusion_key()
         for key, module in diffusion_model.named_modules():
             if apply_raunet and key in modified_key['down_module_key']:
                 make_block_fn = make_diffusers_cross_attn_down_block
                 module.__class__ = make_block_fn(module.__class__)
                 module.switching_threshold_ratio = 'T1_ratio'
 
@@ -1811,15 +1870,15 @@
             if apply_window_attn and key in modified_key['windown_attn_module_key']:
                 make_block_fn = make_diffusers_transformer_block
                 module.__class__ = make_block_fn(module.__class__)
                 
             module.model = 'sdxl_turbo'
             module.info = diffusion_model.info
     else:
-        raise Exception(f'{model.name_or_path} is not a supported model. HiDiffusion now only supports runwayml/stable-diffusion-v1-5, stabilityai/stable-diffusion-2-1-base, stabilityai/stable-diffusion-xl-base-1.0, stabilityai/sdxl-turbo, diffusers/stable-diffusion-xl-1.0-inpainting-0.1')
+        raise Exception(f'{model.name_or_path} is not a supported model. HiDiffusion now only supports runwayml/stable-diffusion-v1-5, stabilityai/stable-diffusion-2-1-base, stabilityai/stable-diffusion-xl-base-1.0, stabilityai/sdxl-turbo, diffusers/stable-diffusion-xl-1.0-inpainting-0.1 and their derivative models/pipelines.')
     return model
 
 
 
 
 
 def remove_hidiffusion(model: torch.nn.Module):
```

### Comparing `hidiffusion-0.1.1/hidiffusion/utils.py` & `hidiffusion-0.1.2/hidiffusion/utils.py`

 * *Files identical despite different names*

### Comparing `hidiffusion-0.1.1/hidiffusion.egg-info/PKG-INFO` & `hidiffusion-0.1.2/hidiffusion.egg-info/PKG-INFO`

 * *Files 17% similar despite different names*

```diff
@@ -1,746 +1,933 @@
 00000000: 4d65 7461 6461 7461 2d56 6572 7369 6f6e  Metadata-Version
 00000010: 3a20 322e 310a 4e61 6d65 3a20 6869 6469  : 2.1.Name: hidi
 00000020: 6666 7573 696f 6e0a 5665 7273 696f 6e3a  ffusion.Version:
-00000030: 2030 2e31 2e31 0a53 756d 6d61 7279 3a20   0.1.1.Summary: 
+00000030: 2030 2e31 2e32 0a53 756d 6d61 7279 3a20   0.1.2.Summary: 
 00000040: 4869 4469 6666 7573 696f 6e3a 2041 2074  HiDiffusion: A t
 00000050: 7261 696e 696e 672d 6672 6565 206d 6574  raining-free met
 00000060: 686f 6420 746f 2069 6e63 7265 6173 6520  hod to increase 
 00000070: 7468 6520 7265 736f 6c75 7469 6f6e 2061  the resolution a
 00000080: 6e64 2073 7065 6564 206f 6620 6469 6666  nd speed of diff
 00000090: 7573 696f 6e20 6d6f 6465 6c73 2e0a 486f  usion models..Ho
 000000a0: 6d65 2d70 6167 653a 200a 4175 7468 6f72  me-page: .Author
 000000b0: 3a20 5368 656e 205a 6861 6e67 2c20 5a68  : Shen Zhang, Zh
 000000c0: 616f 7765 6920 4368 656e 2c20 5a68 656e  aowei Chen, Zhen
 000000d0: 7975 205a 6861 6f2c 2059 7568 616f 2043  yu Zhao, Yuhao C
 000000e0: 6865 6e2c 2059 616f 2054 616e 672c 204a  hen, Yao Tang, J
 000000f0: 6961 6a75 6e20 4c69 616e 670a 4465 7363  iajun Liang.Desc
 00000100: 7269 7074 696f 6e2d 436f 6e74 656e 742d  ription-Content-
 00000110: 5479 7065 3a20 7465 7874 2f6d 6172 6b64  Type: text/markd
-00000120: 6f77 6e0a 0a23 20f0 9f92 a120 4869 4469  own..# .... HiDi
-00000130: 6666 7573 696f 6e0a 0a3e 202a 2a48 6944  ffusion..> **HiD
-00000140: 6966 6675 7369 6f6e 3a20 556e 6c6f 636b  iffusion: Unlock
-00000150: 696e 6720 4869 6768 6572 2d52 6573 6f6c  ing Higher-Resol
-00000160: 7574 696f 6e20 4372 6561 7469 7669 7479  ution Creativity
-00000170: 2061 6e64 2045 6666 6963 6965 6e63 7920   and Efficiency 
-00000180: 696e 2050 7265 7472 6169 6e65 6420 4469  in Pretrained Di
-00000190: 6666 7573 696f 6e20 4d6f 6465 6c73 2a2a  ffusion Models**
-000001a0: 2020 200a 3e20 5368 656e 205a 6861 6e67     .> Shen Zhang
-000001b0: 2c20 5a68 616f 7765 6920 4368 656e 2c20  , Zhaowei Chen, 
-000001c0: 5a68 656e 7975 205a 6861 6f2c 2059 7568  Zhenyu Zhao, Yuh
-000001d0: 616f 2043 6865 6e2c 2059 616f 2054 616e  ao Chen, Yao Tan
-000001e0: 672c 204a 6961 6a75 6e20 4c69 616e 6720  g, Jiajun Liang 
-000001f0: 2020 2020 0a3e 20f0 9fa7 ac5b 5b41 7278      .> ....[[Arx
-00000200: 6976 5d5d 2868 7474 7073 3a2f 2f61 7278  iv]](https://arx
-00000210: 6976 2e6f 7267 2f61 6273 2f32 3331 312e  iv.org/abs/2311.
-00000220: 3137 3532 3829 20f0 9f8e b75b 5b50 726f  17528) ....[[Pro
-00000230: 6a65 6374 2050 6167 655d 5d28 290a 0a0a  ject Page]]()...
-00000240: 3c64 6976 2061 6c69 676e 3d22 6365 6e74  <div align="cent
-00000250: 6572 223e 0a20 203c 696d 6720 7372 633d  er">.  <img src=
-00000260: 2261 7373 6574 732f 696d 6167 655f 6761  "assets/image_ga
-00000270: 6c6c 6572 792e 6a70 6722 2077 6964 7468  llery.jpg" width
-00000280: 3d22 3830 3022 203e 3c2f 696d 673e 0a20  ="800" ></img>. 
-00000290: 203c 6272 3e0a 2020 3c65 6d3e 0a20 2020   <br>.  <em>.   
-000002a0: 2020 2028 5365 6c65 6374 2048 6944 6966     (Select HiDif
-000002b0: 6675 7369 6f6e 2073 616d 706c 6573 2066  fusion samples f
-000002c0: 6f72 2076 6172 696f 7573 2064 6966 6675  or various diffu
-000002d0: 7369 6f6e 206d 6f64 656c 732c 2072 6573  sion models, res
-000002e0: 6f6c 7574 696f 6e73 2c20 616e 6420 6173  olutions, and as
-000002f0: 7065 6374 2072 6174 696f 732e 2920 0a20  pect ratios.) . 
-00000300: 203c 2f65 6d3e 0a3c 2f64 6976 3e0a 3c62   </em>.</div>.<b
-00000310: 723e 0a0a 0a23 20f0 9f91 8920 5768 7920  r>...# .... Why 
-00000320: 4869 4469 6666 7573 696f 6e0a 0a2d 2041  HiDiffusion..- A
-00000330: 2020 2a2a 7472 6169 6e69 6e67 2d66 7265    **training-fre
-00000340: 6520 6d65 7468 6f64 2074 6861 7420 696e  e method that in
-00000350: 6372 6561 7365 7320 7468 6520 7265 736f  creases the reso
-00000360: 6c75 7469 6f6e 2061 6e64 2073 7065 6564  lution and speed
-00000370: 206f 6620 7072 6574 7261 696e 6564 2064   of pretrained d
-00000380: 6966 6675 7369 6f6e 206d 6f64 656c 732e  iffusion models.
-00000390: 2a2a 0a2d 2044 6573 6967 6e65 6420 6173  **.- Designed as
-000003a0: 2061 202a 2a70 6c75 672d 616e 642d 706c   a **plug-and-pl
-000003b0: 6179 2069 6d70 6c65 6d65 6e74 6174 696f  ay implementatio
-000003c0: 6e2a 2a2e 2049 7420 6361 6e20 6265 2069  n**. It can be i
-000003d0: 6e74 6567 7261 7465 6420 696e 746f 2064  ntegrated into d
-000003e0: 6966 6675 7369 6f6e 2070 6970 656c 696e  iffusion pipelin
-000003f0: 6573 2062 7920 2a2a 6f6e 6c79 2061 6464  es by **only add
-00000400: 696e 6720 6120 7369 6e67 6c65 206c 696e  ing a single lin
-00000410: 6520 6f66 2063 6f64 652a 2a21 0a0a 3c64  e of code**!..<d
-00000420: 6976 2061 6c69 676e 3d22 6365 6e74 6572  iv align="center
-00000430: 223e 0a20 203c 696d 6720 7372 633d 2261  ">.  <img src="a
-00000440: 7373 6574 732f 7175 616c 6974 795f 6566  ssets/quality_ef
-00000450: 6669 6369 656e 6379 2e6a 7067 2220 7769  ficiency.jpg" wi
-00000460: 6474 683d 2238 3030 2220 3e3c 2f69 6d67  dth="800" ></img
-00000470: 3e0a 2020 3c62 723e 0a20 203c 656d 3e0a  >.  <br>.  <em>.
-00000480: 2020 2020 2020 2846 6173 7465 722c 2061        (Faster, a
-00000490: 6e64 2062 6574 7465 7220 696d 6167 6520  nd better image 
-000004a0: 6465 7461 696c 732e 2920 0a20 203c 2f65  details.) .  </e
-000004b0: 6d3e 0a3c 2f64 6976 3e0a 3c62 723e 0a0a  m>.</div>.<br>..
-000004c0: 2323 20f0 9f93 a220 5375 7070 6f72 7465  ## .... Supporte
-000004d0: 6420 4d6f 6465 6c73 0a0a 2d20 e29c 8520  d Models..- ... 
-000004e0: 5b53 7461 626c 6520 4469 6666 7573 696f  [Stable Diffusio
-000004f0: 6e20 584c 5d28 6874 7470 733a 2f2f 6875  n XL](https://hu
-00000500: 6767 696e 6766 6163 652e 636f 2f70 6170  ggingface.co/pap
-00000510: 6572 732f 3233 3037 2e30 3139 3532 290a  ers/2307.01952).
-00000520: 2d20 e29c 8520 5b53 7461 626c 6520 4469  - ... [Stable Di
-00000530: 6666 7573 696f 6e20 584c 2054 7572 626f  ffusion XL Turbo
-00000540: 5d28 6874 7470 733a 2f2f 6875 6767 696e  ](https://huggin
-00000550: 6766 6163 652e 636f 2f73 7461 6269 6c69  gface.co/stabili
-00000560: 7479 6169 2f73 6478 6c2d 7475 7262 6f29  tyai/sdxl-turbo)
-00000570: 0a2d 20e2 9c85 205b 5374 6162 6c65 2044  .- ... [Stable D
-00000580: 6966 6675 7369 6f6e 2076 325d 2868 7474  iffusion v2](htt
-00000590: 7073 3a2f 2f68 7567 6769 6e67 6661 6365  ps://huggingface
-000005a0: 2e63 6f2f 7374 6162 696c 6974 7961 692f  .co/stabilityai/
-000005b0: 7374 6162 6c65 2d64 6966 6675 7369 6f6e  stable-diffusion
-000005c0: 2d32 2d31 290a 2d20 e29c 8520 5b53 7461  -2-1).- ... [Sta
-000005d0: 626c 6520 4469 6666 7573 696f 6e20 7631  ble Diffusion v1
-000005e0: 5d28 6874 7470 733a 2f2f 6875 6767 696e  ](https://huggin
-000005f0: 6766 6163 652e 636f 2f72 756e 7761 796d  gface.co/runwaym
-00000600: 6c2f 7374 6162 6c65 2d64 6966 6675 7369  l/stable-diffusi
-00000610: 6f6e 2d76 312d 3529 0a0a 2a2a 4e6f 7465  on-v1-5)..**Note
-00000620: 2a2a 3a20 4869 4469 6666 7573 696f 6e20  **: HiDiffusion 
-00000630: 6361 6e20 616c 736f 2073 7570 706f 7274  can also support
-00000640: 2074 6865 2064 6f77 6d73 7472 6561 6d20   the dowmstream 
-00000650: 6469 6666 7573 696f 6e20 6d6f 6465 6c73  diffusion models
-00000660: 2062 6173 6564 206f 6e20 7468 6573 6520   based on these 
-00000670: 7265 706f 7369 746f 7269 6573 2e0a 0a23  repositories...#
-00000680: 2320 f09f 92a3 2053 7570 706f 7274 6564  # .... Supported
-00000690: 2054 6173 6b73 0a0a 2d20 e29c 8520 5465   Tasks..- ... Te
-000006a0: 7874 2d74 6f2d 696d 6167 650a 2d20 e29c  xt-to-image.- ..
-000006b0: 8520 436f 6e74 726f 6c4e 6574 0a2d 20e2  . ControlNet.- .
-000006c0: 9c85 2049 6e70 6169 6e74 696e 670a 0a0a  .. Inpainting...
-000006d0: 2323 20f0 9f94 8e20 4d61 696e 2072 6571  ## .... Main req
-000006e0: 7569 7265 6d65 6e74 730a 5468 6973 2072  uirements.This r
-000006f0: 6570 6f73 6974 6f72 7920 6973 2074 6573  epository is tes
-00000700: 7465 6420 6f6e 0a2a 2050 7974 686f 6e3d  ted on.* Python=
-00000710: 3d33 2e38 0a2a 2074 6f72 6368 3d3d 312e  =3.8.* torch==1.
-00000720: 3133 2e31 0a2a 2064 6966 6675 7365 7273  13.1.* diffusers
-00000730: 3d3d 302e 3235 2e30 0a2a 2074 7261 6e73  ==0.25.0.* trans
-00000740: 666f 726d 6572 733d 3d34 2e32 372e 340a  formers==4.27.4.
-00000750: 2a20 6163 6365 6c65 7261 7465 3d3d 302e  * accelerate==0.
-00000760: 3138 2e30 0a2a 2078 666f 726d 6572 733d  18.0.* xformers=
-00000770: 3d30 2e30 2e31 3672 6334 3235 0a0a 2323  =0.0.16rc425..##
-00000780: 20f0 9f94 9120 496e 7374 616c 6c20 4869   .... Install Hi
-00000790: 4469 6666 7573 696f 6e0a 4166 7465 7220  Diffusion.After 
-000007a0: 696e 7374 616c 6c69 6e67 2074 6865 2070  installing the p
-000007b0: 6163 6b61 6765 7320 696e 2074 6865 206d  ackages in the m
-000007c0: 6169 6e20 7265 7175 6972 656d 656e 7473  ain requirements
-000007d0: 2c20 696e 7374 616c 6c20 4869 4469 6666  , install HiDiff
-000007e0: 7573 696f 6e3a 0a60 6060 7368 656c 6c0a  usion:.```shell.
-000007f0: 7069 7033 2069 6e73 7461 6c6c 2068 6964  pip3 install hid
-00000800: 6966 6675 7369 6f6e 0a60 6060 0a23 2323  iffusion.```.###
-00000810: 2049 6e73 7461 6c6c 696e 6720 6672 6f6d   Installing from
-00000820: 2073 6f75 7263 650a 416c 7465 726e 6174   source.Alternat
-00000830: 6976 656c 792c 2079 6f75 2063 616e 2069  ively, you can i
-00000840: 6e73 7461 6c6c 2066 726f 6d20 6769 7468  nstall from gith
-00000850: 7562 2073 6f75 7263 652e 2043 6c6f 6e65  ub source. Clone
-00000860: 2074 6865 2072 6570 6f73 6974 6f72 7920   the repository 
-00000870: 616e 6420 696e 7374 616c 6c3a 0a60 6060  and install:.```
-00000880: 6261 7368 0a67 6974 2063 6c6f 6e65 2068  bash.git clone h
-00000890: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-000008a0: 6d2f 5368 656e 5a68 616e 672d 5368 696e  m/ShenZhang-Shin
-000008b0: 2f48 6944 6966 6675 7369 6f6e 2e67 6974  /HiDiffusion.git
-000008c0: 0a63 6420 4869 4469 6666 7573 696f 6e0a  .cd HiDiffusion.
-000008d0: 7079 7468 6f6e 3320 7365 7475 702e 7079  python3 setup.py
-000008e0: 2069 6e73 7461 6c6c 0a60 6060 0a0a 0a23   install.```...#
-000008f0: 2320 f09f 9a80 2055 7361 6765 0a0a 4765  # .... Usage..Ge
-00000900: 6e65 7261 7469 6e67 206f 7574 7075 7473  nerating outputs
-00000910: 2077 6974 6820 4869 4469 6666 7573 696f   with HiDiffusio
-00000920: 6e20 6973 2073 7570 6572 2065 6173 7920  n is super easy 
-00000930: 6261 7365 6420 6f6e 20f0 9fa4 9720 5b64  based on .... [d
-00000940: 6966 6675 7365 7273 5d28 6874 7470 733a  iffusers](https:
-00000950: 2f2f 6769 7468 7562 2e63 6f6d 2f68 7567  //github.com/hug
-00000960: 6769 6e67 6661 6365 2f64 6966 6675 7365  gingface/diffuse
-00000970: 7273 2f74 7265 652f 6d61 696e 292e 0a0a  rs/tree/main)...
-00000980: 2323 2054 6578 742d 746f 2d69 6d61 6765  ## Text-to-image
-00000990: 2067 656e 6572 6174 696f 6e0a 0a23 2323   generation..###
-000009a0: 2053 7461 626c 6520 4469 6666 7573 696f   Stable Diffusio
-000009b0: 6e20 584c 0a0a 6060 6070 7974 686f 6e0a  n XL..```python.
-000009c0: 6672 6f6d 2068 6964 6966 6675 7369 6f6e  from hidiffusion
-000009d0: 2069 6d70 6f72 7420 6170 706c 795f 6869   import apply_hi
-000009e0: 6469 6666 7573 696f 6e2c 2072 656d 6f76  diffusion, remov
-000009f0: 655f 6869 6469 6666 7573 696f 6e0a 6672  e_hidiffusion.fr
-00000a00: 6f6d 2064 6966 6675 7365 7273 2069 6d70  om diffusers imp
-00000a10: 6f72 7420 5374 6162 6c65 4469 6666 7573  ort StableDiffus
-00000a20: 696f 6e58 4c50 6970 656c 696e 652c 2044  ionXLPipeline, D
-00000a30: 4449 4d53 6368 6564 756c 6572 0a69 6d70  DIMScheduler.imp
-00000a40: 6f72 7420 746f 7263 680a 7072 6574 7261  ort torch.pretra
-00000a50: 696e 5f6d 6f64 656c 203d 2022 7374 6162  in_model = "stab
-00000a60: 696c 6974 7961 692f 7374 6162 6c65 2d64  ilityai/stable-d
-00000a70: 6966 6675 7369 6f6e 2d78 6c2d 6261 7365  iffusion-xl-base
-00000a80: 2d31 2e30 220a 7363 6865 6475 6c65 7220  -1.0".scheduler 
-00000a90: 3d20 4444 494d 5363 6865 6475 6c65 722e  = DDIMScheduler.
-00000aa0: 6672 6f6d 5f70 7265 7472 6169 6e65 6428  from_pretrained(
-00000ab0: 7072 6574 7261 696e 5f6d 6f64 656c 2c20  pretrain_model, 
-00000ac0: 7375 6266 6f6c 6465 723d 2273 6368 6564  subfolder="sched
-00000ad0: 756c 6572 2229 0a70 6970 6520 3d20 5374  uler").pipe = St
-00000ae0: 6162 6c65 4469 6666 7573 696f 6e58 4c50  ableDiffusionXLP
-00000af0: 6970 656c 696e 652e 6672 6f6d 5f70 7265  ipeline.from_pre
-00000b00: 7472 6169 6e65 6428 7072 6574 7261 696e  trained(pretrain
-00000b10: 5f6d 6f64 656c 2c20 7363 6865 6475 6c65  _model, schedule
-00000b20: 7220 3d20 7363 6865 6475 6c65 722c 2074  r = scheduler, t
-00000b30: 6f72 6368 5f64 7479 7065 3d74 6f72 6368  orch_dtype=torch
-00000b40: 2e66 6c6f 6174 3136 2c20 7661 7269 616e  .float16, varian
-00000b50: 743d 2266 7031 3622 292e 746f 2822 6375  t="fp16").to("cu
-00000b60: 6461 2229 0a0a 2320 2320 4f70 7469 6f6e  da")..# # Option
-00000b70: 616c 2e20 656e 6162 6c65 5f78 666f 726d  al. enable_xform
-00000b80: 6572 735f 6d65 6d6f 7279 5f65 6666 6963  ers_memory_effic
-00000b90: 6965 6e74 5f61 7474 656e 7469 6f6e 2063  ient_attention c
-00000ba0: 616e 2073 6176 6520 6d65 6d6f 7279 2075  an save memory u
-00000bb0: 7361 6765 2061 6e64 2069 6e63 7265 6173  sage and increas
-00000bc0: 6520 696e 6665 7265 6e63 6520 7370 6565  e inference spee
-00000bd0: 642e 2065 6e61 626c 655f 6d6f 6465 6c5f  d. enable_model_
-00000be0: 6370 755f 6f66 666c 6f61 6420 616e 6420  cpu_offload and 
-00000bf0: 656e 6162 6c65 5f76 6165 5f74 696c 696e  enable_vae_tilin
-00000c00: 6720 6361 6e20 7361 7665 206d 656d 6f72  g can save memor
-00000c10: 7920 7573 6167 652e 0a23 2070 6970 652e  y usage..# pipe.
-00000c20: 656e 6162 6c65 5f78 666f 726d 6572 735f  enable_xformers_
-00000c30: 6d65 6d6f 7279 5f65 6666 6963 6965 6e74  memory_efficient
-00000c40: 5f61 7474 656e 7469 6f6e 2829 0a23 2070  _attention().# p
-00000c50: 6970 652e 656e 6162 6c65 5f6d 6f64 656c  ipe.enable_model
-00000c60: 5f63 7075 5f6f 6666 6c6f 6164 2829 0a23  _cpu_offload().#
-00000c70: 2070 6970 652e 656e 6162 6c65 5f76 6165   pipe.enable_vae
-00000c80: 5f74 696c 696e 6728 290a 0a23 2041 7070  _tiling()..# App
-00000c90: 6c79 2068 6964 6966 6675 7369 6f6e 2077  ly hidiffusion w
-00000ca0: 6974 6820 6120 7369 6e67 6c65 206c 696e  ith a single lin
-00000cb0: 6520 6f66 2063 6f64 652e 0a61 7070 6c79  e of code..apply
-00000cc0: 5f68 6964 6966 6675 7369 6f6e 2870 6970  _hidiffusion(pip
-00000cd0: 6529 0a0a 7072 6f6d 7074 203d 2022 5374  e)..prompt = "St
-00000ce0: 616e 6469 6e67 2074 616c 6c20 616d 6964  anding tall amid
-00000cf0: 7374 2074 6865 2072 7569 6e73 2c20 6120  st the ruins, a 
-00000d00: 7374 6f6e 6520 676f 6c65 6d20 6177 616b  stone golem awak
-00000d10: 656e 732c 2076 696e 6573 2061 6e64 2066  ens, vines and f
-00000d20: 6c6f 7765 7273 2073 7072 6f75 7469 6e67  lowers sprouting
-00000d30: 2066 726f 6d20 7468 6520 6372 6576 6963   from the crevic
-00000d40: 6573 2069 6e20 6974 7320 626f 6479 2e22  es in its body."
-00000d50: 0a6e 6567 6174 6976 655f 7072 6f6d 7074  .negative_prompt
-00000d60: 203d 2022 626c 7572 7279 2c20 7567 6c79   = "blurry, ugly
-00000d70: 2c20 6475 706c 6963 6174 652c 2070 6f6f  , duplicate, poo
-00000d80: 726c 7920 6472 6177 6e20 6661 6365 2c20  rly drawn face, 
-00000d90: 6465 666f 726d 6564 2c20 6d6f 7361 6963  deformed, mosaic
-00000da0: 2c20 6172 7469 6661 6374 732c 2062 6164  , artifacts, bad
-00000db0: 206c 696d 6273 220a 696d 6167 6520 3d20   limbs".image = 
-00000dc0: 7069 7065 2870 726f 6d70 742c 2067 7569  pipe(prompt, gui
-00000dd0: 6461 6e63 655f 7363 616c 653d 372e 352c  dance_scale=7.5,
-00000de0: 2068 6569 6768 743d 3230 3438 2c20 7769   height=2048, wi
-00000df0: 6474 683d 3230 3438 2c20 6574 613d 312e  dth=2048, eta=1.
-00000e00: 302c 206e 6567 6174 6976 655f 7072 6f6d  0, negative_prom
-00000e10: 7074 3d6e 6567 6174 6976 655f 7072 6f6d  pt=negative_prom
-00000e20: 7074 292e 696d 6167 6573 5b30 5d0a 696d  pt).images[0].im
-00000e30: 6167 652e 7361 7665 2866 2267 6f6c 656d  age.save(f"golem
-00000e40: 2e6a 7067 2229 0a60 6060 0a0a 3c64 6574  .jpg").```..<det
-00000e50: 6169 6c73 3e0a 3c73 756d 6d61 7279 3e4f  ails>.<summary>O
-00000e60: 7574 7075 743a 3c2f 7375 6d6d 6172 793e  utput:</summary>
-00000e70: 0a3c 6469 7620 616c 6967 6e3d 2263 656e  .<div align="cen
-00000e80: 7465 7222 3e0a 2020 3c69 6d67 2073 7263  ter">.  <img src
-00000e90: 3d22 6173 7365 7473 2f73 6478 6c2e 6a70  ="assets/sdxl.jp
-00000ea0: 6722 2077 6964 7468 3d22 3830 3022 203e  g" width="800" >
-00000eb0: 3c2f 696d 673e 0a3c 2f64 6976 3e0a 3c2f  </img>.</div>.</
-00000ec0: 6465 7461 696c 733e 0a0a 5365 7420 6865  details>..Set he
-00000ed0: 6967 6874 203d 2034 3039 362c 2077 6964  ight = 4096, wid
-00000ee0: 7468 203d 2034 3039 362c 2061 6e64 2079  th = 4096, and y
-00000ef0: 6f75 2063 616e 2067 6574 206f 7574 7075  ou can get outpu
-00000f00: 7420 7769 7468 2034 3039 3678 3430 3936  t with 4096x4096
-00000f10: 2072 6573 6f6c 7574 696f 6e2e 0a0a 2323   resolution...##
-00000f20: 2320 5374 6162 6c65 2044 6966 6675 7369  # Stable Diffusi
-00000f30: 6f6e 2058 4c20 5475 7262 6f0a 0a60 6060  on XL Turbo..```
-00000f40: 7079 7468 6f6e 0a66 726f 6d20 6869 6469  python.from hidi
-00000f50: 6666 7573 696f 6e20 696d 706f 7274 2061  ffusion import a
-00000f60: 7070 6c79 5f68 6964 6966 6675 7369 6f6e  pply_hidiffusion
-00000f70: 2c20 7265 6d6f 7665 5f68 6964 6966 6675  , remove_hidiffu
-00000f80: 7369 6f6e 0a66 726f 6d20 6469 6666 7573  sion.from diffus
-00000f90: 6572 7320 696d 706f 7274 2041 7574 6f50  ers import AutoP
-00000fa0: 6970 656c 696e 6546 6f72 5465 7874 3249  ipelineForText2I
-00000fb0: 6d61 6765 0a69 6d70 6f72 7420 746f 7263  mage.import torc
-00000fc0: 680a 7072 6574 7261 696e 5f6d 6f64 656c  h.pretrain_model
-00000fd0: 203d 2022 7374 6162 696c 6974 7961 692f   = "stabilityai/
-00000fe0: 7364 786c 2d74 7572 626f 220a 7069 7065  sdxl-turbo".pipe
-00000ff0: 203d 2041 7574 6f50 6970 656c 696e 6546   = AutoPipelineF
-00001000: 6f72 5465 7874 3249 6d61 6765 2e66 726f  orText2Image.fro
-00001010: 6d5f 7072 6574 7261 696e 6564 2870 7265  m_pretrained(pre
-00001020: 7472 6169 6e5f 6d6f 6465 6c2c 2074 6f72  train_model, tor
-00001030: 6368 5f64 7479 7065 3d74 6f72 6368 2e66  ch_dtype=torch.f
-00001040: 6c6f 6174 3136 2c20 7661 7269 616e 743d  loat16, variant=
-00001050: 2266 7031 3622 292e 746f 2827 6375 6461  "fp16").to('cuda
-00001060: 2729 0a0a 2320 2320 4f70 7469 6f6e 616c  ')..# # Optional
-00001070: 2e20 656e 6162 6c65 5f78 666f 726d 6572  . enable_xformer
-00001080: 735f 6d65 6d6f 7279 5f65 6666 6963 6965  s_memory_efficie
-00001090: 6e74 5f61 7474 656e 7469 6f6e 2063 616e  nt_attention can
-000010a0: 2073 6176 6520 6d65 6d6f 7279 2075 7361   save memory usa
-000010b0: 6765 2061 6e64 2069 6e63 7265 6173 6520  ge and increase 
-000010c0: 696e 6665 7265 6e63 6520 7370 6565 642e  inference speed.
-000010d0: 2065 6e61 626c 655f 6d6f 6465 6c5f 6370   enable_model_cp
-000010e0: 755f 6f66 666c 6f61 6420 616e 6420 656e  u_offload and en
-000010f0: 6162 6c65 5f76 6165 5f74 696c 696e 6720  able_vae_tiling 
-00001100: 6361 6e20 7361 7665 206d 656d 6f72 7920  can save memory 
-00001110: 7573 6167 652e 0a23 2070 6970 652e 656e  usage..# pipe.en
-00001120: 6162 6c65 5f78 666f 726d 6572 735f 6d65  able_xformers_me
-00001130: 6d6f 7279 5f65 6666 6963 6965 6e74 5f61  mory_efficient_a
-00001140: 7474 656e 7469 6f6e 2829 0a23 2070 6970  ttention().# pip
-00001150: 652e 656e 6162 6c65 5f6d 6f64 656c 5f63  e.enable_model_c
-00001160: 7075 5f6f 6666 6c6f 6164 2829 0a23 2070  pu_offload().# p
-00001170: 6970 652e 656e 6162 6c65 5f76 6165 5f74  ipe.enable_vae_t
-00001180: 696c 696e 6728 290a 0a23 2041 7070 6c79  iling()..# Apply
-00001190: 2068 6964 6966 6675 7369 6f6e 2077 6974   hidiffusion wit
-000011a0: 6820 6120 7369 6e67 6c65 206c 696e 6520  h a single line 
-000011b0: 6f66 2063 6f64 652e 0a61 7070 6c79 5f68  of code..apply_h
-000011c0: 6964 6966 6675 7369 6f6e 2870 6970 6529  idiffusion(pipe)
-000011d0: 0a0a 7072 6f6d 7074 203d 2022 496e 2074  ..prompt = "In t
-000011e0: 6865 2064 6570 7468 7320 6f66 2061 206d  he depths of a m
-000011f0: 7973 7469 6361 6c20 666f 7265 7374 2c20  ystical forest, 
-00001200: 6120 726f 626f 7469 6320 6f77 6c20 7769  a robotic owl wi
-00001210: 7468 206e 6967 6874 2076 6973 696f 6e20  th night vision 
-00001220: 6c65 6e73 6573 2066 6f72 2065 7965 7320  lenses for eyes 
-00001230: 7761 7463 6865 7320 6f76 6572 2074 6865  watches over the
-00001240: 206e 6f63 7475 726e 616c 2063 7265 6174   nocturnal creat
-00001250: 7572 6573 2e22 0a69 6d61 6765 203d 2070  ures.".image = p
-00001260: 6970 6528 7072 6f6d 7074 2c20 6e75 6d5f  ipe(prompt, num_
-00001270: 696e 6665 7265 6e63 655f 7374 6570 733d  inference_steps=
-00001280: 342c 2068 6569 6768 743d 3130 3234 2c20  4, height=1024, 
-00001290: 7769 6474 683d 3130 3234 2c20 6775 6964  width=1024, guid
-000012a0: 616e 6365 5f73 6361 6c65 3d30 2e30 292e  ance_scale=0.0).
-000012b0: 696d 6167 6573 5b30 5d0a 696d 6167 652e  images[0].image.
-000012c0: 7361 7665 2866 222e 2f6f 776c 2e6a 7067  save(f"./owl.jpg
-000012d0: 2229 0a60 6060 0a0a 3c64 6574 6169 6c73  ").```..<details
-000012e0: 3e0a 3c73 756d 6d61 7279 3e4f 7574 7075  >.<summary>Outpu
-000012f0: 743a 3c2f 7375 6d6d 6172 793e 0a3c 6469  t:</summary>.<di
-00001300: 7620 616c 6967 6e3d 2263 656e 7465 7222  v align="center"
-00001310: 3e0a 2020 3c69 6d67 2073 7263 3d22 6173  >.  <img src="as
-00001320: 7365 7473 2f73 6478 6c5f 7475 7262 6f2e  sets/sdxl_turbo.
-00001330: 6a70 6722 2077 6964 7468 3d22 3830 3022  jpg" width="800"
-00001340: 203e 3c2f 696d 673e 0a3c 2f64 6976 3e0a   ></img>.</div>.
-00001350: 3c2f 6465 7461 696c 733e 0a0a 2323 2320  </details>..### 
-00001360: 5374 6162 6c65 2044 6966 6675 7369 6f6e  Stable Diffusion
-00001370: 2076 322d 310a 0a60 6060 7079 7468 6f6e   v2-1..```python
-00001380: 0a66 726f 6d20 6869 6469 6666 7573 696f  .from hidiffusio
-00001390: 6e20 696d 706f 7274 2061 7070 6c79 5f68  n import apply_h
-000013a0: 6964 6966 6675 7369 6f6e 2c20 7265 6d6f  idiffusion, remo
-000013b0: 7665 5f68 6964 6966 6675 7369 6f6e 0a66  ve_hidiffusion.f
-000013c0: 726f 6d20 6469 6666 7573 6572 7320 696d  rom diffusers im
-000013d0: 706f 7274 2044 6966 6675 7369 6f6e 5069  port DiffusionPi
-000013e0: 7065 6c69 6e65 2c20 4444 494d 5363 6865  peline, DDIMSche
-000013f0: 6475 6c65 720a 696d 706f 7274 2074 6f72  duler.import tor
-00001400: 6368 0a70 7265 7472 6169 6e5f 6d6f 6465  ch.pretrain_mode
-00001410: 6c20 3d20 2273 7461 6269 6c69 7479 6169  l = "stabilityai
-00001420: 2f73 7461 626c 652d 6469 6666 7573 696f  /stable-diffusio
-00001430: 6e2d 322d 312d 6261 7365 220a 7363 6865  n-2-1-base".sche
-00001440: 6475 6c65 7220 3d20 4444 494d 5363 6865  duler = DDIMSche
-00001450: 6475 6c65 722e 6672 6f6d 5f70 7265 7472  duler.from_pretr
-00001460: 6169 6e65 6428 7072 6574 7261 696e 5f6d  ained(pretrain_m
-00001470: 6f64 656c 2c20 7375 6266 6f6c 6465 723d  odel, subfolder=
-00001480: 2273 6368 6564 756c 6572 2229 0a70 6970  "scheduler").pip
-00001490: 6520 3d20 4469 6666 7573 696f 6e50 6970  e = DiffusionPip
-000014a0: 656c 696e 652e 6672 6f6d 5f70 7265 7472  eline.from_pretr
-000014b0: 6169 6e65 6428 7072 6574 7261 696e 5f6d  ained(pretrain_m
-000014c0: 6f64 656c 2c20 7363 6865 6475 6c65 7220  odel, scheduler 
-000014d0: 3d20 7363 6865 6475 6c65 722c 2074 6f72  = scheduler, tor
-000014e0: 6368 5f64 7479 7065 3d74 6f72 6368 2e66  ch_dtype=torch.f
-000014f0: 6c6f 6174 3136 292e 746f 2822 6375 6461  loat16).to("cuda
-00001500: 2229 0a0a 2320 2320 4f70 7469 6f6e 616c  ")..# # Optional
-00001510: 2e20 656e 6162 6c65 5f78 666f 726d 6572  . enable_xformer
-00001520: 735f 6d65 6d6f 7279 5f65 6666 6963 6965  s_memory_efficie
-00001530: 6e74 5f61 7474 656e 7469 6f6e 2063 616e  nt_attention can
-00001540: 2073 6176 6520 6d65 6d6f 7279 2075 7361   save memory usa
-00001550: 6765 2061 6e64 2069 6e63 7265 6173 6520  ge and increase 
-00001560: 696e 6665 7265 6e63 6520 7370 6565 642e  inference speed.
-00001570: 2065 6e61 626c 655f 6d6f 6465 6c5f 6370   enable_model_cp
-00001580: 755f 6f66 666c 6f61 6420 616e 6420 656e  u_offload and en
-00001590: 6162 6c65 5f76 6165 5f74 696c 696e 6720  able_vae_tiling 
-000015a0: 6361 6e20 7361 7665 206d 656d 6f72 7920  can save memory 
-000015b0: 7573 6167 652e 0a23 2070 6970 652e 656e  usage..# pipe.en
-000015c0: 6162 6c65 5f78 666f 726d 6572 735f 6d65  able_xformers_me
-000015d0: 6d6f 7279 5f65 6666 6963 6965 6e74 5f61  mory_efficient_a
-000015e0: 7474 656e 7469 6f6e 2829 0a23 2070 6970  ttention().# pip
-000015f0: 652e 656e 6162 6c65 5f6d 6f64 656c 5f63  e.enable_model_c
-00001600: 7075 5f6f 6666 6c6f 6164 2829 0a23 2070  pu_offload().# p
-00001610: 6970 652e 656e 6162 6c65 5f76 6165 5f74  ipe.enable_vae_t
-00001620: 696c 696e 6728 290a 0a23 2041 7070 6c79  iling()..# Apply
-00001630: 2068 6964 6966 6675 7369 6f6e 2077 6974   hidiffusion wit
-00001640: 6820 6120 7369 6e67 6c65 206c 696e 6520  h a single line 
-00001650: 6f66 2063 6f64 652e 0a61 7070 6c79 5f68  of code..apply_h
-00001660: 6964 6966 6675 7369 6f6e 2870 6970 6529  idiffusion(pipe)
-00001670: 0a0a 7072 6f6d 7074 203d 2022 416e 2061  ..prompt = "An a
-00001680: 646f 7261 626c 6520 6861 7070 7920 6272  dorable happy br
-00001690: 6f77 6e20 626f 7264 6572 2063 6f6c 6c69  own border colli
-000016a0: 6520 7369 7474 696e 6720 6f6e 2061 2062  e sitting on a b
-000016b0: 6564 2c20 6869 6768 2064 6574 6169 6c2e  ed, high detail.
-000016c0: 220a 6e65 6761 7469 7665 5f70 726f 6d70  ".negative_promp
-000016d0: 7420 3d20 2275 676c 792c 2074 696c 696e  t = "ugly, tilin
-000016e0: 672c 206f 7574 206f 6620 6672 616d 652c  g, out of frame,
-000016f0: 2070 6f6f 726c 7920 6472 6177 6e20 6661   poorly drawn fa
-00001700: 6365 2c20 6578 7472 6120 6c69 6d62 732c  ce, extra limbs,
-00001710: 2064 6973 6669 6775 7265 642c 2064 6566   disfigured, def
-00001720: 6f72 6d65 642c 2062 6f64 7920 6f75 7420  ormed, body out 
-00001730: 6f66 2066 7261 6d65 2c20 626c 7572 7279  of frame, blurry
-00001740: 2c20 6261 6420 616e 6174 6f6d 792c 2062  , bad anatomy, b
-00001750: 6c75 7272 6564 2c20 6172 7469 6661 6374  lurred, artifact
-00001760: 732c 2062 6164 2070 726f 706f 7274 696f  s, bad proportio
-00001770: 6e73 2e22 0a69 6d61 6765 203d 2070 6970  ns.".image = pip
-00001780: 6528 7072 6f6d 7074 2c20 6775 6964 616e  e(prompt, guidan
-00001790: 6365 5f73 6361 6c65 3d37 2e35 2c20 6865  ce_scale=7.5, he
-000017a0: 6967 6874 3d31 3032 342c 2077 6964 7468  ight=1024, width
-000017b0: 3d31 3032 342c 2065 7461 3d31 2e30 2c20  =1024, eta=1.0, 
-000017c0: 6e65 6761 7469 7665 5f70 726f 6d70 743d  negative_prompt=
-000017d0: 6e65 6761 7469 7665 5f70 726f 6d70 7429  negative_prompt)
-000017e0: 2e69 6d61 6765 735b 305d 0a69 6d61 6765  .images[0].image
-000017f0: 2e73 6176 6528 6622 636f 6c6c 6965 2e6a  .save(f"collie.j
-00001800: 7067 2229 0a60 6060 0a0a 3c64 6574 6169  pg").```..<detai
-00001810: 6c73 3e0a 3c73 756d 6d61 7279 3e4f 7574  ls>.<summary>Out
-00001820: 7075 743a 3c2f 7375 6d6d 6172 793e 0a3c  put:</summary>.<
-00001830: 6469 7620 616c 6967 6e3d 2263 656e 7465  div align="cente
-00001840: 7222 3e0a 2020 3c69 6d67 2073 7263 3d22  r">.  <img src="
-00001850: 6173 7365 7473 2f73 6432 312e 6a70 6722  assets/sd21.jpg"
-00001860: 2077 6964 7468 3d22 3830 3022 203e 3c2f   width="800" ></
-00001870: 696d 673e 0a3c 2f64 6976 3e0a 3c2f 6465  img>.</div>.</de
-00001880: 7461 696c 733e 0a0a 5365 7420 6865 6967  tails>..Set heig
-00001890: 6874 203d 2032 3034 382c 2077 6964 7468  ht = 2048, width
-000018a0: 203d 2032 3034 382c 2061 6e64 2079 6f75   = 2048, and you
-000018b0: 2063 616e 2067 6574 206f 7574 7075 7420   can get output 
-000018c0: 7769 7468 2032 3034 3878 3230 3438 2072  with 2048x2048 r
-000018d0: 6573 6f6c 7574 696f 6e2e 0a0a 0a0a 2323  esolution.....##
-000018e0: 2320 5374 6162 6c65 2044 6966 6675 7369  # Stable Diffusi
-000018f0: 6f6e 2076 312d 350a 0a60 6060 7079 7468  on v1-5..```pyth
-00001900: 6f6e 0a66 726f 6d20 6869 6469 6666 7573  on.from hidiffus
-00001910: 696f 6e20 696d 706f 7274 2061 7070 6c79  ion import apply
-00001920: 5f68 6964 6966 6675 7369 6f6e 2c20 7265  _hidiffusion, re
-00001930: 6d6f 7665 5f68 6964 6966 6675 7369 6f6e  move_hidiffusion
-00001940: 0a66 726f 6d20 6469 6666 7573 6572 7320  .from diffusers 
-00001950: 696d 706f 7274 2044 6966 6675 7369 6f6e  import Diffusion
-00001960: 5069 7065 6c69 6e65 2c20 4444 494d 5363  Pipeline, DDIMSc
-00001970: 6865 6475 6c65 720a 696d 706f 7274 2074  heduler.import t
-00001980: 6f72 6368 0a70 7265 7472 6169 6e5f 6d6f  orch.pretrain_mo
-00001990: 6465 6c20 3d20 2272 756e 7761 796d 6c2f  del = "runwayml/
-000019a0: 7374 6162 6c65 2d64 6966 6675 7369 6f6e  stable-diffusion
-000019b0: 2d76 312d 3522 0a73 6368 6564 756c 6572  -v1-5".scheduler
-000019c0: 203d 2044 4449 4d53 6368 6564 756c 6572   = DDIMScheduler
-000019d0: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
-000019e0: 2870 7265 7472 6169 6e5f 6d6f 6465 6c2c  (pretrain_model,
-000019f0: 2073 7562 666f 6c64 6572 3d22 7363 6865   subfolder="sche
-00001a00: 6475 6c65 7222 290a 7069 7065 203d 2044  duler").pipe = D
-00001a10: 6966 6675 7369 6f6e 5069 7065 6c69 6e65  iffusionPipeline
-00001a20: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
-00001a30: 2870 7265 7472 6169 6e5f 6d6f 6465 6c2c  (pretrain_model,
-00001a40: 2073 6368 6564 756c 6572 203d 2073 6368   scheduler = sch
-00001a50: 6564 756c 6572 2c20 746f 7263 685f 6474  eduler, torch_dt
-00001a60: 7970 653d 746f 7263 682e 666c 6f61 7431  ype=torch.float1
-00001a70: 3629 2e74 6f28 2263 7564 6122 290a 0a23  6).to("cuda")..#
-00001a80: 2023 204f 7074 696f 6e61 6c2e 2065 6e61   # Optional. ena
-00001a90: 626c 655f 7866 6f72 6d65 7273 5f6d 656d  ble_xformers_mem
-00001aa0: 6f72 795f 6566 6669 6369 656e 745f 6174  ory_efficient_at
-00001ab0: 7465 6e74 696f 6e20 6361 6e20 7361 7665  tention can save
-00001ac0: 206d 656d 6f72 7920 7573 6167 6520 616e   memory usage an
-00001ad0: 6420 696e 6372 6561 7365 2069 6e66 6572  d increase infer
-00001ae0: 656e 6365 2073 7065 6564 2e20 656e 6162  ence speed. enab
-00001af0: 6c65 5f6d 6f64 656c 5f63 7075 5f6f 6666  le_model_cpu_off
-00001b00: 6c6f 6164 2061 6e64 2065 6e61 626c 655f  load and enable_
-00001b10: 7661 655f 7469 6c69 6e67 2063 616e 2073  vae_tiling can s
-00001b20: 6176 6520 6d65 6d6f 7279 2075 7361 6765  ave memory usage
-00001b30: 2e0a 2320 7069 7065 2e65 6e61 626c 655f  ..# pipe.enable_
-00001b40: 7866 6f72 6d65 7273 5f6d 656d 6f72 795f  xformers_memory_
-00001b50: 6566 6669 6369 656e 745f 6174 7465 6e74  efficient_attent
-00001b60: 696f 6e28 290a 2320 7069 7065 2e65 6e61  ion().# pipe.ena
-00001b70: 626c 655f 6d6f 6465 6c5f 6370 755f 6f66  ble_model_cpu_of
-00001b80: 666c 6f61 6428 290a 2320 7069 7065 2e65  fload().# pipe.e
-00001b90: 6e61 626c 655f 7661 655f 7469 6c69 6e67  nable_vae_tiling
-00001ba0: 2829 0a0a 2320 4170 706c 7920 6869 6469  ()..# Apply hidi
-00001bb0: 6666 7573 696f 6e20 7769 7468 2061 2073  ffusion with a s
-00001bc0: 696e 676c 6520 6c69 6e65 206f 6620 636f  ingle line of co
-00001bd0: 6465 2e0a 6170 706c 795f 6869 6469 6666  de..apply_hidiff
-00001be0: 7573 696f 6e28 7069 7065 290a 0a70 726f  usion(pipe)..pro
-00001bf0: 6d70 7420 3d20 2274 6869 636b 2073 7472  mpt = "thick str
-00001c00: 6f6b 6573 2c20 6272 6967 6874 2063 6f6c  okes, bright col
-00001c10: 6f72 732c 2061 6e20 6578 6f74 6963 2066  ors, an exotic f
-00001c20: 6f78 2c20 6375 7465 2c20 6368 6962 6920  ox, cute, chibi 
-00001c30: 6b61 7761 6969 2e20 6465 7461 696c 6564  kawaii. detailed
-00001c40: 2066 7572 2c20 6879 7065 7264 6574 6169   fur, hyperdetai
-00001c50: 6c65 6420 2c20 6269 6720 7265 666c 6563  led , big reflec
-00001c60: 7469 7665 2065 7965 732c 2066 6169 7279  tive eyes, fairy
-00001c70: 7461 6c65 2c20 6172 7473 7461 7469 6f6e  tale, artstation
-00001c80: 2c63 656e 7465 7265 6420 636f 6d70 6f73  ,centered compos
-00001c90: 6974 696f 6e2c 2070 6572 6665 6374 2063  ition, perfect c
-00001ca0: 6f6d 706f 7369 7469 6f6e 2c20 6365 6e74  omposition, cent
-00001cb0: 6572 6564 2c20 7669 6272 616e 7420 636f  ered, vibrant co
-00001cc0: 6c6f 7273 2c20 6d75 7465 6420 636f 6c6f  lors, muted colo
-00001cd0: 7273 2c20 6869 6768 2064 6574 6169 6c65  rs, high detaile
-00001ce0: 642c 2038 6b2e 220a 6e65 6761 7469 7665  d, 8k.".negative
-00001cf0: 5f70 726f 6d70 7420 3d20 2275 676c 792c  _prompt = "ugly,
-00001d00: 2074 696c 696e 672c 2070 6f6f 726c 7920   tiling, poorly 
-00001d10: 6472 6177 6e20 6661 6365 2c20 6f75 7420  drawn face, out 
-00001d20: 6f66 2066 7261 6d65 2c20 6469 7366 6967  of frame, disfig
-00001d30: 7572 6564 2c20 6465 666f 726d 6564 2c20  ured, deformed, 
-00001d40: 626c 7572 7279 2c20 6261 6420 616e 6174  blurry, bad anat
-00001d50: 6f6d 792c 2062 6c75 7272 6564 2e22 0a69  omy, blurred.".i
-00001d60: 6d61 6765 203d 2070 6970 6528 7072 6f6d  mage = pipe(prom
-00001d70: 7074 2c20 6775 6964 616e 6365 5f73 6361  pt, guidance_sca
-00001d80: 6c65 3d37 2e35 2c20 6865 6967 6874 3d31  le=7.5, height=1
-00001d90: 3032 342c 2077 6964 7468 3d31 3032 342c  024, width=1024,
-00001da0: 2065 7461 3d31 2e30 2c20 6e65 6761 7469   eta=1.0, negati
-00001db0: 7665 5f70 726f 6d70 743d 6e65 6761 7469  ve_prompt=negati
-00001dc0: 7665 5f70 726f 6d70 7429 2e69 6d61 6765  ve_prompt).image
-00001dd0: 735b 305d 0a69 6d61 6765 2e73 6176 6528  s[0].image.save(
-00001de0: 6622 666f 782e 6a70 6722 290a 6060 600a  f"fox.jpg").```.
-00001df0: 0a3c 6465 7461 696c 733e 0a3c 7375 6d6d  .<details>.<summ
-00001e00: 6172 793e 4f75 7470 7574 3a3c 2f73 756d  ary>Output:</sum
-00001e10: 6d61 7279 3e0a 3c64 6976 2061 6c69 676e  mary>.<div align
-00001e20: 3d22 6365 6e74 6572 223e 0a20 203c 696d  ="center">.  <im
-00001e30: 6720 7372 633d 2261 7373 6574 732f 7364  g src="assets/sd
-00001e40: 3135 2e6a 7067 2220 7769 6474 683d 2238  15.jpg" width="8
-00001e50: 3030 2220 3e3c 2f69 6d67 3e0a 3c2f 6469  00" ></img>.</di
-00001e60: 763e 0a3c 2f64 6574 6169 6c73 3e0a 0a53  v>.</details>..S
-00001e70: 6574 2068 6569 6768 7420 3d20 3230 3438  et height = 2048
-00001e80: 2c20 7769 6474 6820 3d20 3230 3438 2c20  , width = 2048, 
-00001e90: 616e 6420 796f 7520 6361 6e20 6765 7420  and you can get 
-00001ea0: 6f75 7470 7574 2077 6974 6820 3230 3438  output with 2048
-00001eb0: 7832 3034 3820 7265 736f 6c75 7469 6f6e  x2048 resolution
-00001ec0: 2e0a 0a23 2323 2052 656d 6f76 6520 4869  ...### Remove Hi
-00001ed0: 4469 6666 7573 696f 6e0a 0a49 6620 796f  Diffusion..If yo
-00001ee0: 7520 7761 6e74 2074 6f20 7265 6d6f 7665  u want to remove
-00001ef0: 2048 6944 6969 6666 7573 696f 6e2c 2073   HiDiiffusion, s
-00001f00: 696d 706c 7920 7573 6520 6072 656d 6f76  imply use `remov
-00001f10: 655f 6869 6469 6666 7573 696f 6e28 7069  e_hidiffusion(pi
-00001f20: 7065 2960 2e0a 0a23 2320 436f 6e74 726f  pe)`...## Contro
-00001f30: 6c4e 6574 0a0a 6060 6070 7974 686f 6e0a  lNet..```python.
-00001f40: 6672 6f6d 2064 6966 6675 7365 7273 2069  from diffusers i
-00001f50: 6d70 6f72 7420 5374 6162 6c65 4469 6666  mport StableDiff
-00001f60: 7573 696f 6e58 4c43 6f6e 7472 6f6c 4e65  usionXLControlNe
-00001f70: 7450 6970 656c 696e 652c 2043 6f6e 7472  tPipeline, Contr
-00001f80: 6f6c 4e65 744d 6f64 656c 2c20 4444 494d  olNetModel, DDIM
-00001f90: 5363 6865 6475 6c65 720a 696d 706f 7274  Scheduler.import
-00001fa0: 206e 756d 7079 2061 7320 6e70 0a69 6d70   numpy as np.imp
-00001fb0: 6f72 7420 746f 7263 680a 696d 706f 7274  ort torch.import
-00001fc0: 2063 7632 0a66 726f 6d20 5049 4c20 696d   cv2.from PIL im
-00001fd0: 706f 7274 2049 6d61 6765 0a66 726f 6d20  port Image.from 
-00001fe0: 6869 6469 6666 7573 696f 6e20 696d 706f  hidiffusion impo
-00001ff0: 7274 2061 7070 6c79 5f68 6964 6966 6675  rt apply_hidiffu
-00002000: 7369 6f6e 2c20 7265 6d6f 7665 5f68 6964  sion, remove_hid
-00002010: 6966 6675 7369 6f6e 0a0a 2320 6c6f 6164  iffusion..# load
-00002020: 2059 6f73 6875 615f 4265 6e67 696f 2e6a   Yoshua_Bengio.j
-00002030: 7067 2069 6e20 7468 6520 6173 7365 7473  pg in the assets
-00002040: 2066 696c 652e 0a70 6174 6820 3d20 2759   file..path = 'Y
-00002050: 6f73 6875 615f 4265 6e67 696f 2e6a 7067  oshua_Bengio.jpg
-00002060: 270a 696d 6167 6520 3d20 496d 6167 652e  '.image = Image.
-00002070: 6f70 656e 2870 6174 6829 0a23 2067 6574  open(path).# get
-00002080: 2063 616e 6e79 2069 6d61 6765 0a69 6d61   canny image.ima
-00002090: 6765 203d 206e 702e 6172 7261 7928 696d  ge = np.array(im
-000020a0: 6167 6529 0a69 6d61 6765 203d 2063 7632  age).image = cv2
-000020b0: 2e43 616e 6e79 2869 6d61 6765 2c20 3130  .Canny(image, 10
-000020c0: 302c 2032 3030 290a 696d 6167 6520 3d20  0, 200).image = 
-000020d0: 696d 6167 655b 3a2c 203a 2c20 4e6f 6e65  image[:, :, None
-000020e0: 5d0a 696d 6167 6520 3d20 6e70 2e63 6f6e  ].image = np.con
-000020f0: 6361 7465 6e61 7465 285b 696d 6167 652c  catenate([image,
-00002100: 2069 6d61 6765 2c20 696d 6167 655d 2c20   image, image], 
-00002110: 6178 6973 3d32 290a 6361 6e6e 795f 696d  axis=2).canny_im
-00002120: 6167 6520 3d20 496d 6167 652e 6672 6f6d  age = Image.from
-00002130: 6172 7261 7928 696d 6167 6529 0a0a 2320  array(image)..# 
-00002140: 696e 6974 6961 6c69 7a65 2074 6865 206d  initialize the m
-00002150: 6f64 656c 7320 616e 6420 7069 7065 6c69  odels and pipeli
-00002160: 6e65 0a63 6f6e 7472 6f6c 6e65 745f 636f  ne.controlnet_co
-00002170: 6e64 6974 696f 6e69 6e67 5f73 6361 6c65  nditioning_scale
-00002180: 203d 2030 2e35 2020 2320 7265 636f 6d6d   = 0.5  # recomm
-00002190: 656e 6465 6420 666f 7220 676f 6f64 2067  ended for good g
-000021a0: 656e 6572 616c 697a 6174 696f 6e0a 636f  eneralization.co
-000021b0: 6e74 726f 6c6e 6574 203d 2043 6f6e 7472  ntrolnet = Contr
-000021c0: 6f6c 4e65 744d 6f64 656c 2e66 726f 6d5f  olNetModel.from_
-000021d0: 7072 6574 7261 696e 6564 280a 2020 2020  pretrained(.    
-000021e0: 2264 6966 6675 7365 7273 2f63 6f6e 7472  "diffusers/contr
-000021f0: 6f6c 6e65 742d 6361 6e6e 792d 7364 786c  olnet-canny-sdxl
-00002200: 2d31 2e30 222c 2074 6f72 6368 5f64 7479  -1.0", torch_dty
-00002210: 7065 3d74 6f72 6368 2e66 6c6f 6174 3136  pe=torch.float16
-00002220: 2c20 7661 7269 616e 743d 2266 7031 3622  , variant="fp16"
-00002230: 0a29 0a73 6368 6564 756c 6572 203d 2044  .).scheduler = D
-00002240: 4449 4d53 6368 6564 756c 6572 2e66 726f  DIMScheduler.fro
-00002250: 6d5f 7072 6574 7261 696e 6564 2822 7374  m_pretrained("st
-00002260: 6162 696c 6974 7961 692f 7374 6162 6c65  abilityai/stable
-00002270: 2d64 6966 6675 7369 6f6e 2d78 6c2d 6261  -diffusion-xl-ba
-00002280: 7365 2d31 2e30 222c 2073 7562 666f 6c64  se-1.0", subfold
-00002290: 6572 3d22 7363 6865 6475 6c65 7222 290a  er="scheduler").
-000022a0: 7069 7065 203d 2053 7461 626c 6544 6966  pipe = StableDif
-000022b0: 6675 7369 6f6e 584c 436f 6e74 726f 6c4e  fusionXLControlN
-000022c0: 6574 5069 7065 6c69 6e65 2e66 726f 6d5f  etPipeline.from_
-000022d0: 7072 6574 7261 696e 6564 280a 2020 2020  pretrained(.    
-000022e0: 2273 7461 6269 6c69 7479 6169 2f73 7461  "stabilityai/sta
-000022f0: 626c 652d 6469 6666 7573 696f 6e2d 786c  ble-diffusion-xl
-00002300: 2d62 6173 652d 312e 3022 2c20 636f 6e74  -base-1.0", cont
-00002310: 726f 6c6e 6574 3d63 6f6e 7472 6f6c 6e65  rolnet=controlne
-00002320: 742c 2074 6f72 6368 5f64 7479 7065 3d74  t, torch_dtype=t
-00002330: 6f72 6368 2e66 6c6f 6174 3136 2c0a 2020  orch.float16,.  
-00002340: 2020 7363 6865 6475 6c65 7220 3d20 7363    scheduler = sc
-00002350: 6865 6475 6c65 720a 290a 7069 7065 2e65  heduler.).pipe.e
-00002360: 6e61 626c 655f 6d6f 6465 6c5f 6370 755f  nable_model_cpu_
-00002370: 6f66 666c 6f61 6428 290a 7069 7065 2e65  offload().pipe.e
-00002380: 6e61 626c 655f 7866 6f72 6d65 7273 5f6d  nable_xformers_m
-00002390: 656d 6f72 795f 6566 6669 6369 656e 745f  emory_efficient_
-000023a0: 6174 7465 6e74 696f 6e28 290a 0a70 726f  attention()..pro
-000023b0: 6d70 7420 3d20 2261 207a 6f6d 6269 652c  mpt = "a zombie,
-000023c0: 2068 6967 6820 6661 6365 2064 6574 6169   high face detai
-000023d0: 6c2c 2068 6967 6820 6465 7461 696c 2c20  l, high detail, 
-000023e0: 6d75 7465 6420 636f 6c6f 722c 2038 6b22  muted color, 8k"
-000023f0: 0a6e 6567 6174 6976 655f 7072 6f6d 7074  .negative_prompt
-00002400: 203d 2022 626c 7572 7279 2c20 7567 6c79   = "blurry, ugly
-00002410: 2c20 6475 706c 6963 6174 652c 2070 6f6f  , duplicate, poo
-00002420: 726c 7920 6472 6177 6e2c 2064 6566 6f72  rly drawn, defor
-00002430: 6d65 642c 206d 6f73 6169 632c 2070 6f6f  med, mosaic, poo
-00002440: 726c 7920 6472 6177 6e20 7465 6574 682c  rly drawn teeth,
-00002450: 2064 7570 6c69 6361 7465 6420 7465 6574   duplicated teet
-00002460: 682e 220a 0a23 2041 7070 6c79 2068 6964  h."..# Apply hid
-00002470: 6966 6675 7369 6f6e 2077 6974 6820 6120  iffusion with a 
-00002480: 7369 6e67 6c65 206c 696e 6520 6f66 2063  single line of c
-00002490: 6f64 652e 0a61 7070 6c79 5f68 6964 6966  ode..apply_hidif
-000024a0: 6675 7369 6f6e 2870 6970 6529 0a0a 696d  fusion(pipe)..im
-000024b0: 6167 6520 3d20 7069 7065 280a 2020 2020  age = pipe(.    
-000024c0: 7072 6f6d 7074 2c20 636f 6e74 726f 6c6e  prompt, controln
-000024d0: 6574 5f63 6f6e 6469 7469 6f6e 696e 675f  et_conditioning_
-000024e0: 7363 616c 653d 636f 6e74 726f 6c6e 6574  scale=controlnet
-000024f0: 5f63 6f6e 6469 7469 6f6e 696e 675f 7363  _conditioning_sc
-00002500: 616c 652c 2069 6d61 6765 3d63 616e 6e79  ale, image=canny
-00002510: 5f69 6d61 6765 2c0a 2020 2020 6865 6967  _image,.    heig
-00002520: 6874 3d32 3034 382c 2077 6964 7468 3d32  ht=2048, width=2
-00002530: 3034 382c 2067 7569 6461 6e63 655f 7363  048, guidance_sc
-00002540: 616c 653d 372e 352c 206e 6567 6174 6976  ale=7.5, negativ
-00002550: 655f 7072 6f6d 7074 203d 206e 6567 6174  e_prompt = negat
-00002560: 6976 655f 7072 6f6d 7074 2c20 6574 613d  ive_prompt, eta=
-00002570: 312e 300a 292e 696d 6167 6573 5b30 5d0a  1.0.).images[0].
-00002580: 0a69 6d61 6765 2e73 6176 6528 277a 6f6d  .image.save('zom
-00002590: 6269 652e 6a70 6727 290a 6060 600a 0a3c  bie.jpg').```..<
-000025a0: 6465 7461 696c 733e 0a3c 7375 6d6d 6172  details>.<summar
-000025b0: 793e 4f75 7470 7574 3a3c 2f73 756d 6d61  y>Output:</summa
-000025c0: 7279 3e0a 3c64 6976 2061 6c69 676e 3d22  ry>.<div align="
-000025d0: 6365 6e74 6572 223e 0a20 203c 696d 6720  center">.  <img 
-000025e0: 7372 633d 2261 7373 6574 732f 636f 6e74  src="assets/cont
-000025f0: 726f 6c6e 6574 5f72 6573 756c 742e 6a70  rolnet_result.jp
-00002600: 6722 2077 6964 7468 3d22 3830 3022 203e  g" width="800" >
-00002610: 3c2f 696d 673e 0a3c 2f64 6976 3e0a 3c2f  </img>.</div>.</
-00002620: 6465 7461 696c 733e 0a0a 2323 2049 6e70  details>..## Inp
-00002630: 6169 6e74 696e 670a 0a60 6060 7079 7468  ainting..```pyth
-00002640: 6f6e 0a69 6d70 6f72 7420 746f 7263 680a  on.import torch.
-00002650: 6672 6f6d 2064 6966 6675 7365 7273 2069  from diffusers i
-00002660: 6d70 6f72 7420 4175 746f 5069 7065 6c69  mport AutoPipeli
-00002670: 6e65 466f 7249 6e70 6169 6e74 696e 672c  neForInpainting,
-00002680: 2044 4449 4d53 6368 6564 756c 6572 0a66   DDIMScheduler.f
-00002690: 726f 6d20 6469 6666 7573 6572 732e 7574  rom diffusers.ut
-000026a0: 696c 7320 696d 706f 7274 206c 6f61 645f  ils import load_
-000026b0: 696d 6167 650a 6672 6f6d 2068 6964 6966  image.from hidif
-000026c0: 6675 7369 6f6e 2069 6d70 6f72 7420 6170  fusion import ap
-000026d0: 706c 795f 6869 6469 6666 7573 696f 6e2c  ply_hidiffusion,
-000026e0: 2072 656d 6f76 655f 6869 6469 6666 7573   remove_hidiffus
-000026f0: 696f 6e0a 6672 6f6d 2050 494c 2069 6d70  ion.from PIL imp
-00002700: 6f72 7420 496d 6167 650a 0a73 6368 6564  ort Image..sched
-00002710: 756c 6572 203d 2044 4449 4d53 6368 6564  uler = DDIMSched
-00002720: 756c 6572 2e66 726f 6d5f 7072 6574 7261  uler.from_pretra
-00002730: 696e 6564 2822 7374 6162 696c 6974 7961  ined("stabilitya
-00002740: 692f 7374 6162 6c65 2d64 6966 6675 7369  i/stable-diffusi
-00002750: 6f6e 2d78 6c2d 6261 7365 2d31 2e30 222c  on-xl-base-1.0",
-00002760: 2073 7562 666f 6c64 6572 3d22 7363 6865   subfolder="sche
-00002770: 6475 6c65 7222 290a 7069 7065 6c69 6e65  duler").pipeline
-00002780: 203d 2041 7574 6f50 6970 656c 696e 6546   = AutoPipelineF
-00002790: 6f72 496e 7061 696e 7469 6e67 2e66 726f  orInpainting.fro
-000027a0: 6d5f 7072 6574 7261 696e 6564 280a 2020  m_pretrained(.  
-000027b0: 2020 2264 6966 6675 7365 7273 2f73 7461    "diffusers/sta
-000027c0: 626c 652d 6469 6666 7573 696f 6e2d 786c  ble-diffusion-xl
-000027d0: 2d31 2e30 2d69 6e70 6169 6e74 696e 672d  -1.0-inpainting-
-000027e0: 302e 3122 2c20 746f 7263 685f 6474 7970  0.1", torch_dtyp
-000027f0: 653d 746f 7263 682e 666c 6f61 7431 362c  e=torch.float16,
-00002800: 2076 6172 6961 6e74 3d22 6670 3136 222c   variant="fp16",
-00002810: 200a 2020 2020 7363 6865 6475 6c65 723d   .    scheduler=
-00002820: 7363 6865 6475 6c65 720a 290a 0a23 2041  scheduler.)..# A
-00002830: 7070 6c79 2068 6964 6966 6675 7369 6f6e  pply hidiffusion
-00002840: 2077 6974 6820 6120 7369 6e67 6c65 206c   with a single l
-00002850: 696e 6520 6f66 2063 6f64 652e 0a61 7070  ine of code..app
-00002860: 6c79 5f68 6964 6966 6675 7369 6f6e 2870  ly_hidiffusion(p
-00002870: 6970 656c 696e 6529 0a0a 7069 7065 6c69  ipeline)..pipeli
-00002880: 6e65 2e65 6e61 626c 655f 6d6f 6465 6c5f  ne.enable_model_
-00002890: 6370 755f 6f66 666c 6f61 6428 290a 2320  cpu_offload().# 
-000028a0: 7265 6d6f 7665 2066 6f6c 6c6f 7769 6e67  remove following
-000028b0: 206c 696e 6520 6966 2078 466f 726d 6572   line if xFormer
-000028c0: 7320 6973 206e 6f74 2069 6e73 7461 6c6c  s is not install
-000028d0: 6564 0a70 6970 656c 696e 652e 656e 6162  ed.pipeline.enab
-000028e0: 6c65 5f78 666f 726d 6572 735f 6d65 6d6f  le_xformers_memo
-000028f0: 7279 5f65 6666 6963 6965 6e74 5f61 7474  ry_efficient_att
-00002900: 656e 7469 6f6e 2829 0a0a 2320 6c6f 6164  ention()..# load
-00002910: 2062 6173 6520 616e 6420 6d61 736b 2069   base and mask i
-00002920: 6d61 6765 0a69 6d67 5f75 726c 203d 2022  mage.img_url = "
-00002930: 6874 7470 733a 2f2f 6875 6767 696e 6766  https://huggingf
-00002940: 6163 652e 636f 2f64 6174 6173 6574 732f  ace.co/datasets/
-00002950: 6875 6767 696e 6766 6163 652f 646f 6375  huggingface/docu
-00002960: 6d65 6e74 6174 696f 6e2d 696d 6167 6573  mentation-images
-00002970: 2f72 6573 6f6c 7665 2f6d 6169 6e2f 6469  /resolve/main/di
-00002980: 6666 7573 6572 732f 7364 786c 2d74 6578  ffusers/sdxl-tex
-00002990: 7432 696d 672e 706e 6722 0a69 6e69 745f  t2img.png".init_
-000029a0: 696d 6167 6520 3d20 6c6f 6164 5f69 6d61  image = load_ima
-000029b0: 6765 2869 6d67 5f75 726c 290a 2320 6c6f  ge(img_url).# lo
-000029c0: 6164 206d 6173 6b5f 696d 6167 652e 6a70  ad mask_image.jp
-000029d0: 6720 696e 2074 6865 2061 7373 6574 7320  g in the assets 
-000029e0: 6669 6c65 2e0a 6d61 736b 5f69 6d61 6765  file..mask_image
-000029f0: 203d 2049 6d61 6765 2e6f 7065 6e28 226d   = Image.open("m
-00002a00: 6173 6b5f 696d 6167 652e 706e 6722 290a  ask_image.png").
-00002a10: 0a70 726f 6d70 7420 3d20 2022 4120 7374  .prompt =  "A st
-00002a20: 6561 6d70 756e 6b20 6578 706c 6f72 6572  eampunk explorer
-00002a30: 2069 6e20 6120 6c65 6174 6865 7220 6176   in a leather av
-00002a40: 6961 746f 7220 6361 7020 616e 6420 676f  iator cap and go
-00002a50: 6767 6c65 732c 2077 6974 6820 6120 6272  ggles, with a br
-00002a60: 6173 7320 7465 6c65 7363 6f70 6520 696e  ass telescope in
-00002a70: 2068 616e 642c 2073 7461 6e64 7320 616d   hand, stands am
-00002a80: 6964 7374 2074 6f77 6572 696e 6720 616e  idst towering an
-00002a90: 6369 656e 7420 7472 6565 732c 2074 6865  cient trees, the
-00002aa0: 6972 2072 6f6f 7473 2065 6e74 7769 6e65  ir roots entwine
-00002ab0: 6420 7769 7468 2069 6e74 7269 6361 7465  d with intricate
-00002ac0: 2067 6561 7273 2061 6e64 2070 6970 6573   gears and pipes
-00002ad0: 2e22 0a0a 6e65 6761 7469 7665 5f70 726f  ."..negative_pro
-00002ae0: 6d70 7420 3d20 2262 6c75 7272 792c 2075  mpt = "blurry, u
-00002af0: 676c 792c 2064 7570 6c69 6361 7465 2c20  gly, duplicate, 
-00002b00: 706f 6f72 6c79 2064 7261 776e 2c20 6465  poorly drawn, de
-00002b10: 666f 726d 6564 2c20 6d6f 7361 6963 220a  formed, mosaic".
-00002b20: 696d 6167 6520 3d20 7069 7065 6c69 6e65  image = pipeline
-00002b30: 2870 726f 6d70 743d 7072 6f6d 7074 2c20  (prompt=prompt, 
-00002b40: 696d 6167 653d 696e 6974 5f69 6d61 6765  image=init_image
-00002b50: 2c20 6d61 736b 5f69 6d61 6765 3d6d 6173  , mask_image=mas
-00002b60: 6b5f 696d 6167 652c 2068 6569 6768 743d  k_image, height=
-00002b70: 3230 3438 2c20 7769 6474 683d 3230 3438  2048, width=2048
-00002b80: 2c20 7374 7265 6e67 7468 3d30 2e38 352c  , strength=0.85,
-00002b90: 2067 7569 6461 6e63 655f 7363 616c 653d   guidance_scale=
-00002ba0: 3132 2e35 2c20 6e65 6761 7469 7665 5f70  12.5, negative_p
-00002bb0: 726f 6d70 7420 3d20 6e65 6761 7469 7665  rompt = negative
-00002bc0: 5f70 726f 6d70 742c 2065 7461 3d31 2e30  _prompt, eta=1.0
-00002bd0: 292e 696d 6167 6573 5b30 5d0a 696d 6167  ).images[0].imag
-00002be0: 652e 7361 7665 2827 7374 6561 6d70 756e  e.save('steampun
-00002bf0: 6b5f 6578 706c 6f72 6572 2e6a 7067 2729  k_explorer.jpg')
-00002c00: 0a60 6060 0a0a 3c64 6574 6169 6c73 3e0a  .```..<details>.
-00002c10: 3c73 756d 6d61 7279 3e4f 7574 7075 743a  <summary>Output:
-00002c20: 3c2f 7375 6d6d 6172 793e 0a3c 6469 7620  </summary>.<div 
-00002c30: 616c 6967 6e3d 2263 656e 7465 7222 3e0a  align="center">.
-00002c40: 2020 3c69 6d67 2073 7263 3d22 6173 7365    <img src="asse
-00002c50: 7473 2f69 6e70 6169 6e74 696e 675f 7265  ts/inpainting_re
-00002c60: 7375 6c74 2e6a 7067 2220 7769 6474 683d  sult.jpg" width=
-00002c70: 2238 3030 2220 3e3c 2f69 6d67 3e0a 3c2f  "800" ></img>.</
-00002c80: 6469 763e 0a3c 2f64 6574 6169 6c73 3e0a  div>.</details>.
-00002c90: 0a23 2320 f09f 998f 2041 636b 6e6f 776c  .## .... Acknowl
-00002ca0: 6564 6765 6d65 6e74 730a 0a54 6869 7320  edgements..This 
-00002cb0: 696d 706c 656d 656e 7461 7469 6f6e 2069  implementation i
-00002cc0: 7320 6261 7365 6420 6f6e 205b 746f 6d65  s based on [tome
-00002cd0: 7364 5d28 6874 7470 733a 2f2f 6769 7468  sd](https://gith
-00002ce0: 7562 2e63 6f6d 2f64 626f 6c79 612f 746f  ub.com/dbolya/to
-00002cf0: 6d65 7364 2920 616e 6420 5b64 6966 6675  mesd) and [diffu
-00002d00: 7365 7273 5d28 6874 7470 733a 2f2f 6769  sers](https://gi
-00002d10: 7468 7562 2e63 6f6d 2f68 7567 6769 6e67  thub.com/hugging
-00002d20: 6661 6365 2f64 6966 6675 7365 7273 2f74  face/diffusers/t
-00002d30: 7265 652f 6d61 696e 292e 2054 6861 6e6b  ree/main). Thank
-00002d40: 7321 0a0a 0a0a 2323 20f0 9f8e 9320 4369  s!....## .... Ci
-00002d50: 7461 7469 6f6e 0a0a 6060 600a 4061 7274  tation..```.@art
-00002d60: 6963 6c65 7b7a 6861 6e67 3230 3233 6869  icle{zhang2023hi
-00002d70: 6469 6666 7573 696f 6e2c 0a20 2074 6974  diffusion,.  tit
-00002d80: 6c65 3d7b 4869 4469 6666 7573 696f 6e3a  le={HiDiffusion:
-00002d90: 2055 6e6c 6f63 6b69 6e67 2048 6967 6865   Unlocking Highe
-00002da0: 722d 5265 736f 6c75 7469 6f6e 2043 7265  r-Resolution Cre
-00002db0: 6174 6976 6974 7920 616e 6420 4566 6669  ativity and Effi
-00002dc0: 6369 656e 6379 2069 6e20 5072 6574 7261  ciency in Pretra
-00002dd0: 696e 6564 2044 6966 6675 7369 6f6e 204d  ined Diffusion M
-00002de0: 6f64 656c 737d 2c0a 2020 6175 7468 6f72  odels},.  author
-00002df0: 3d7b 5a68 616e 672c 2053 6865 6e20 616e  ={Zhang, Shen an
-00002e00: 6420 4368 656e 2c20 5a68 616f 7765 6920  d Chen, Zhaowei 
-00002e10: 616e 6420 5a68 616f 2c20 5a68 656e 7975  and Zhao, Zhenyu
-00002e20: 2061 6e64 2043 6865 6e2c 2059 7568 616f   and Chen, Yuhao
-00002e30: 2061 6e64 2054 616e 672c 2059 616f 2061   and Tang, Yao a
-00002e40: 6e64 204c 6961 6e67 2c20 4a69 616a 756e  nd Liang, Jiajun
-00002e50: 7d2c 0a20 206a 6f75 726e 616c 3d7b 6172  },.  journal={ar
-00002e60: 5869 7620 7072 6570 7269 6e74 2061 7258  Xiv preprint arX
-00002e70: 6976 3a32 3331 312e 3137 3532 387d 2c0a  iv:2311.17528},.
-00002e80: 2020 7965 6172 3d7b 3230 3233 7d0a 7d0a    year={2023}.}.
-00002e90: 6060 600a                                ```.
+00000120: 6f77 6e0a 0a3c 212d 2d20 2320 f09f 92a1  own..<!-- # ....
+00000130: 2048 6944 6966 6675 7369 6f6e 202d 2d3e   HiDiffusion -->
+00000140: 0a0a 2323 2320 3c64 6976 2061 6c69 676e  ..### <div align
+00000150: 3d22 6365 6e74 6572 223e f09f 92a1 2048  ="center">.... H
+00000160: 6944 6966 6675 7369 6f6e 3a20 556e 6c6f  iDiffusion: Unlo
+00000170: 636b 696e 6720 4869 6768 6572 2d52 6573  cking Higher-Res
+00000180: 6f6c 7574 696f 6e20 4372 6561 7469 7669  olution Creativi
+00000190: 7479 2061 6e64 2045 6666 6963 6965 6e63  ty and Efficienc
+000001a0: 7920 696e 2050 7265 7472 6169 6e65 6420  y in Pretrained 
+000001b0: 4469 6666 7573 696f 6e20 4d6f 6465 6c73  Diffusion Models
+000001c0: 3c2f 6469 763e 200a 0a3c 6469 7620 616c  </div> ..<div al
+000001d0: 6967 6e3d 2263 656e 7465 7222 3e53 6865  ign="center">She
+000001e0: 6e20 5a68 616e 672c 205a 6861 6f77 6569  n Zhang, Zhaowei
+000001f0: 2043 6865 6e2c 205a 6865 6e79 7520 5a68   Chen, Zhenyu Zh
+00000200: 616f 2c20 5975 6861 6f20 4368 656e 2c20  ao, Yuhao Chen, 
+00000210: 5961 6f20 5461 6e67 2c20 4a69 616a 756e  Yao Tang, Jiajun
+00000220: 204c 6961 6e67 3c2f 6469 763e 200a 0a3c   Liang</div> ..<
+00000230: 6272 3e0a 0a3c 6469 7620 616c 6967 6e3d  br>..<div align=
+00000240: 2263 656e 7465 7222 3e0a 2020 3c61 2068  "center">.  <a h
+00000250: 7265 663d 2268 7474 7073 3a2f 2f68 6964  ref="https://hid
+00000260: 6966 6675 7369 6f6e 2e67 6974 6875 622e  iffusion.github.
+00000270: 696f 2f22 3e3c 696d 6720 7372 633d 2268  io/"><img src="h
+00000280: 7474 7073 3a2f 2f69 6d67 2e73 6869 656c  ttps://img.shiel
+00000290: 6473 2e69 6f2f 7374 6174 6963 2f76 313f  ds.io/static/v1?
+000002a0: 6c61 6265 6c3d 5072 6f6a 6563 7425 3230  label=Project%20
+000002b0: 5061 6765 266d 6573 7361 6765 3d47 6974  Page&message=Git
+000002c0: 6875 6226 636f 6c6f 723d 626c 7565 266c  hub&color=blue&l
+000002d0: 6f67 6f3d 6769 7468 7562 2d70 6167 6573  ogo=github-pages
+000002e0: 223e 3c2f 613e 2026 656e 7370 3b0a 2020  "></a> &ensp;.  
+000002f0: 3c61 2068 7265 663d 2268 7474 7073 3a2f  <a href="https:/
+00000300: 2f61 7278 6976 2e6f 7267 2f61 6273 2f32  /arxiv.org/abs/2
+00000310: 3331 312e 3137 3532 3822 3e3c 696d 6720  311.17528"><img 
+00000320: 7372 633d 2268 7474 7073 3a2f 2f69 6d67  src="https://img
+00000330: 2e73 6869 656c 6473 2e69 6f2f 7374 6174  .shields.io/stat
+00000340: 6963 2f76 313f 6c61 6265 6c3d 5061 7065  ic/v1?label=Pape
+00000350: 7226 6d65 7373 6167 653d 4172 7869 763a  r&message=Arxiv:
+00000360: 4869 4469 6666 7573 696f 6e26 636f 6c6f  HiDiffusion&colo
+00000370: 723d 7265 6426 6c6f 676f 3d61 7278 6976  r=red&logo=arxiv
+00000380: 223e 3c2f 613e 2026 656e 7370 3b0a 2020  "></a> &ensp;.  
+00000390: 3c61 2068 7265 663d 2268 7474 7073 3a2f  <a href="https:/
+000003a0: 2f63 6f6c 6162 2e72 6573 6561 7263 682e  /colab.research.
+000003b0: 676f 6f67 6c65 2e63 6f6d 2f64 7269 7665  google.com/drive
+000003c0: 2f31 4569 426e 396c 536e 505a 5455 3463  /1EiBn9lSnPZTU4c
+000003d0: 696b 5252 6142 4265 7873 3432 394d 2d71  ikRRaBBexs429M-q
+000003e0: 7479 3f75 7370 3d73 6861 7269 6e67 223e  ty?usp=sharing">
+000003f0: 3c69 6d67 2073 7263 3d22 6874 7470 733a  <img src="https:
+00000400: 2f2f 696d 672e 7368 6965 6c64 732e 696f  //img.shields.io
+00000410: 2f73 7461 7469 632f 7631 3f6c 6162 656c  /static/v1?label
+00000420: 3d44 656d 6f26 6d65 7373 6167 653d 436f  =Demo&message=Co
+00000430: 6c61 6226 636f 6c6f 723d 7075 7270 6c65  lab&color=purple
+00000440: 266c 6f67 6f3d 676f 6f67 6c65 636f 6c61  &logo=googlecola
+00000450: 6222 3e3c 2f61 3e20 2665 6e73 703b 0a3c  b"></a> &ensp;.<
+00000460: 2f64 6976 3e0a 0a3c 6469 7620 616c 6967  /div>..<div alig
+00000470: 6e3d 2263 656e 7465 7222 3e0a 2020 3c69  n="center">.  <i
+00000480: 6d67 2073 7263 3d22 6173 7365 7473 2f69  mg src="assets/i
+00000490: 6d61 6765 5f67 616c 6c65 7279 2e6a 7067  mage_gallery.jpg
+000004a0: 2220 7769 6474 683d 2238 3030 2220 3e3c  " width="800" ><
+000004b0: 2f69 6d67 3e0a 2020 3c62 723e 0a20 203c  /img>.  <br>.  <
+000004c0: 656d 3e0a 2020 2020 2020 2853 656c 6563  em>.      (Selec
+000004d0: 7420 4869 4469 6666 7573 696f 6e20 7361  t HiDiffusion sa
+000004e0: 6d70 6c65 7320 666f 7220 7661 7269 6f75  mples for variou
+000004f0: 7320 6469 6666 7573 696f 6e20 6d6f 6465  s diffusion mode
+00000500: 6c73 2c20 7265 736f 6c75 7469 6f6e 732c  ls, resolutions,
+00000510: 2061 6e64 2061 7370 6563 7420 7261 7469   and aspect rati
+00000520: 6f73 2e29 200a 2020 3c2f 656d 3e0a 3c2f  os.) .  </em>.</
+00000530: 6469 763e 0a3c 6272 3e0a 0a0a 2320 f09f  div>.<br>...# ..
+00000540: 9189 2057 6879 2048 6944 6966 6675 7369  .. Why HiDiffusi
+00000550: 6f6e 0a0a 2d20 4120 202a 2a74 7261 696e  on..- A  **train
+00000560: 696e 672d 6672 6565 206d 6574 686f 6420  ing-free method 
+00000570: 7468 6174 2069 6e63 7265 6173 6573 2074  that increases t
+00000580: 6865 2072 6573 6f6c 7574 696f 6e20 616e  he resolution an
+00000590: 6420 7370 6565 6420 6f66 2070 7265 7472  d speed of pretr
+000005a0: 6169 6e65 6420 6469 6666 7573 696f 6e20  ained diffusion 
+000005b0: 6d6f 6465 6c73 2e2a 2a0a 2d20 4465 7369  models.**.- Desi
+000005c0: 676e 6564 2061 7320 6120 2a2a 706c 7567  gned as a **plug
+000005d0: 2d61 6e64 2d70 6c61 7920 696d 706c 656d  -and-play implem
+000005e0: 656e 7461 7469 6f6e 2a2a 2e20 4974 2063  entation**. It c
+000005f0: 616e 2062 6520 696e 7465 6772 6174 6564  an be integrated
+00000600: 2069 6e74 6f20 6469 6666 7573 696f 6e20   into diffusion 
+00000610: 7069 7065 6c69 6e65 7320 6279 202a 2a6f  pipelines by **o
+00000620: 6e6c 7920 6164 6469 6e67 2061 2073 696e  nly adding a sin
+00000630: 676c 6520 6c69 6e65 206f 6620 636f 6465  gle line of code
+00000640: 2a2a 210a 0a3c 6469 7620 616c 6967 6e3d  **!..<div align=
+00000650: 2263 656e 7465 7222 3e0a 2020 3c69 6d67  "center">.  <img
+00000660: 2073 7263 3d22 6173 7365 7473 2f71 7561   src="assets/qua
+00000670: 6c69 7479 5f65 6666 6963 6965 6e63 792e  lity_efficiency.
+00000680: 6a70 6722 2077 6964 7468 3d22 3830 3022  jpg" width="800"
+00000690: 203e 3c2f 696d 673e 0a20 203c 6272 3e0a   ></img>.  <br>.
+000006a0: 2020 3c65 6d3e 0a20 2020 2020 2028 4661    <em>.      (Fa
+000006b0: 7374 6572 2c20 616e 6420 6265 7474 6572  ster, and better
+000006c0: 2069 6d61 6765 2064 6574 6169 6c73 2e29   image details.)
+000006d0: 200a 2020 3c2f 656d 3e0a 3c2f 6469 763e   .  </em>.</div>
+000006e0: 0a3c 6272 3e0a 0a23 2320 f09f 93a2 2053  .<br>..## .... S
+000006f0: 7570 706f 7274 6564 204d 6f64 656c 730a  upported Models.
+00000700: 0a2d 20e2 9c85 205b 5374 6162 6c65 2044  .- ... [Stable D
+00000710: 6966 6675 7369 6f6e 2058 4c5d 2868 7474  iffusion XL](htt
+00000720: 7073 3a2f 2f68 7567 6769 6e67 6661 6365  ps://huggingface
+00000730: 2e63 6f2f 7061 7065 7273 2f32 3330 372e  .co/papers/2307.
+00000740: 3031 3935 3229 0a2d 20e2 9c85 205b 5374  01952).- ... [St
+00000750: 6162 6c65 2044 6966 6675 7369 6f6e 2058  able Diffusion X
+00000760: 4c20 5475 7262 6f5d 2868 7474 7073 3a2f  L Turbo](https:/
+00000770: 2f68 7567 6769 6e67 6661 6365 2e63 6f2f  /huggingface.co/
+00000780: 7374 6162 696c 6974 7961 692f 7364 786c  stabilityai/sdxl
+00000790: 2d74 7572 626f 290a 2d20 e29c 8520 5b53  -turbo).- ... [S
+000007a0: 7461 626c 6520 4469 6666 7573 696f 6e20  table Diffusion 
+000007b0: 7632 5d28 6874 7470 733a 2f2f 6875 6767  v2](https://hugg
+000007c0: 696e 6766 6163 652e 636f 2f73 7461 6269  ingface.co/stabi
+000007d0: 6c69 7479 6169 2f73 7461 626c 652d 6469  lityai/stable-di
+000007e0: 6666 7573 696f 6e2d 322d 3129 0a2d 20e2  ffusion-2-1).- .
+000007f0: 9c85 205b 5374 6162 6c65 2044 6966 6675  .. [Stable Diffu
+00000800: 7369 6f6e 2076 315d 2868 7474 7073 3a2f  sion v1](https:/
+00000810: 2f68 7567 6769 6e67 6661 6365 2e63 6f2f  /huggingface.co/
+00000820: 7275 6e77 6179 6d6c 2f73 7461 626c 652d  runwayml/stable-
+00000830: 6469 6666 7573 696f 6e2d 7631 2d35 290a  diffusion-v1-5).
+00000840: 0a2a 2a4e 6f74 652a 2a3a 2048 6944 6966  .**Note**: HiDif
+00000850: 6675 7369 6f6e 2061 6c73 6f20 7375 7070  fusion also supp
+00000860: 6f72 7473 2074 6865 2064 6f77 6e73 7472  orts the downstr
+00000870: 6561 6d20 6469 6666 7573 696f 6e20 6d6f  eam diffusion mo
+00000880: 6465 6c73 2062 6173 6564 206f 6e20 7468  dels based on th
+00000890: 6573 6520 7265 706f 7369 746f 7269 6573  ese repositories
+000008a0: 2c20 7375 6368 2061 7320 5b47 6869 626c  , such as [Ghibl
+000008b0: 692d 4469 6666 7573 696f 6e5d 2868 7474  i-Diffusion](htt
+000008c0: 7073 3a2f 2f68 7567 6769 6e67 6661 6365  ps://huggingface
+000008d0: 2e63 6f2f 6e69 7472 6f73 6f63 6b65 2f47  .co/nitrosocke/G
+000008e0: 6869 626c 692d 4469 6666 7573 696f 6e29  hibli-Diffusion)
+000008f0: 2c20 5b50 6c61 7967 726f 756e 645d 2868  , [Playground](h
+00000900: 7474 7073 3a2f 2f68 7567 6769 6e67 6661  ttps://huggingfa
+00000910: 6365 2e63 6f2f 706c 6179 6772 6f75 6e64  ce.co/playground
+00000920: 6169 2f70 6c61 7967 726f 756e 642d 7632  ai/playground-v2
+00000930: 2d31 3032 3470 782d 6165 7374 6865 7469  -1024px-aestheti
+00000940: 6329 2c20 6574 632e 0a0a 2323 20f0 9f92  c), etc...## ...
+00000950: a320 5375 7070 6f72 7465 6420 5461 736b  . Supported Task
+00000960: 730a 0a2d 20e2 9c85 2054 6578 742d 746f  s..- ... Text-to
+00000970: 2d69 6d61 6765 0a2d 20e2 9c85 2043 6f6e  -image.- ... Con
+00000980: 7472 6f6c 4e65 740a 2d20 e29c 8520 496e  trolNet.- ... In
+00000990: 7061 696e 7469 6e67 0a0a 0a23 2320 f09f  painting...## ..
+000009a0: 948e 204d 6169 6e20 7265 7175 6972 656d  .. Main requirem
+000009b0: 656e 7473 0a54 6869 7320 7265 706f 7369  ents.This reposi
+000009c0: 746f 7279 2069 7320 7465 7374 6564 206f  tory is tested o
+000009d0: 6e0a 2a20 5079 7468 6f6e 3d3d 332e 380a  n.* Python==3.8.
+000009e0: 2a20 746f 7263 683d 3d31 2e31 332e 310a  * torch==1.13.1.
+000009f0: 2a20 6469 6666 7573 6572 733d 3d30 2e32  * diffusers==0.2
+00000a00: 372e 300a 2a20 7472 616e 7366 6f72 6d65  7.0.* transforme
+00000a10: 7273 3d3d 342e 3237 2e34 0a2a 2061 6363  rs==4.27.4.* acc
+00000a20: 656c 6572 6174 653d 3d30 2e31 382e 300a  elerate==0.18.0.
+00000a30: 2a20 7866 6f72 6d65 7273 3d3d 302e 302e  * xformers==0.0.
+00000a40: 3136 7263 3432 350a 0a23 2320 f09f 9491  16rc425..## ....
+00000a50: 2049 6e73 7461 6c6c 2048 6944 6966 6675   Install HiDiffu
+00000a60: 7369 6f6e 0a41 6674 6572 2069 6e73 7461  sion.After insta
+00000a70: 6c6c 696e 6720 7468 6520 7061 636b 6167  lling the packag
+00000a80: 6573 2069 6e20 7468 6520 6d61 696e 2072  es in the main r
+00000a90: 6571 7569 7265 6d65 6e74 732c 2069 6e73  equirements, ins
+00000aa0: 7461 6c6c 2048 6944 6966 6675 7369 6f6e  tall HiDiffusion
+00000ab0: 3a0a 6060 6073 6865 6c6c 0a70 6970 3320  :.```shell.pip3 
+00000ac0: 696e 7374 616c 6c20 6869 6469 6666 7573  install hidiffus
+00000ad0: 696f 6e0a 6060 600a 2323 2320 496e 7374  ion.```.### Inst
+00000ae0: 616c 6c69 6e67 2066 726f 6d20 736f 7572  alling from sour
+00000af0: 6365 0a41 6c74 6572 6e61 7469 7665 6c79  ce.Alternatively
+00000b00: 2c20 796f 7520 6361 6e20 696e 7374 616c  , you can instal
+00000b10: 6c20 6672 6f6d 2067 6974 6875 6220 736f  l from github so
+00000b20: 7572 6365 2e20 436c 6f6e 6520 7468 6520  urce. Clone the 
+00000b30: 7265 706f 7369 746f 7279 2061 6e64 2069  repository and i
+00000b40: 6e73 7461 6c6c 3a0a 6060 6062 6173 680a  nstall:.```bash.
+00000b50: 6769 7420 636c 6f6e 6520 6874 7470 733a  git clone https:
+00000b60: 2f2f 6769 7468 7562 2e63 6f6d 2f53 6865  //github.com/She
+00000b70: 6e5a 6861 6e67 2d53 6869 6e2f 4869 4469  nZhang-Shin/HiDi
+00000b80: 6666 7573 696f 6e2e 6769 740a 6364 2048  ffusion.git.cd H
+00000b90: 6944 6966 6675 7369 6f6e 0a70 7974 686f  iDiffusion.pytho
+00000ba0: 6e33 2073 6574 7570 2e70 7920 696e 7374  n3 setup.py inst
+00000bb0: 616c 6c0a 6060 600a 0a0a 2323 20f0 9f9a  all.```...## ...
+00000bc0: 8020 5573 6167 650a 0a47 656e 6572 6174  . Usage..Generat
+00000bd0: 696e 6720 6f75 7470 7574 7320 7769 7468  ing outputs with
+00000be0: 2048 6944 6966 6675 7369 6f6e 2069 7320   HiDiffusion is 
+00000bf0: 7375 7065 7220 6561 7379 2062 6173 6564  super easy based
+00000c00: 206f 6e20 f09f a497 205b 6469 6666 7573   on .... [diffus
+00000c10: 6572 735d 2868 7474 7073 3a2f 2f67 6974  ers](https://git
+00000c20: 6875 622e 636f 6d2f 6875 6767 696e 6766  hub.com/huggingf
+00000c30: 6163 652f 6469 6666 7573 6572 732f 7472  ace/diffusers/tr
+00000c40: 6565 2f6d 6169 6e29 2e0a 0a23 2320 5465  ee/main)...## Te
+00000c50: 7874 2d74 6f2d 696d 6167 6520 6765 6e65  xt-to-image gene
+00000c60: 7261 7469 6f6e 0a0a 2323 2320 5374 6162  ration..### Stab
+00000c70: 6c65 2044 6966 6675 7369 6f6e 2058 4c0a  le Diffusion XL.
+00000c80: 0a60 6060 7079 7468 6f6e 0a66 726f 6d20  .```python.from 
+00000c90: 6869 6469 6666 7573 696f 6e20 696d 706f  hidiffusion impo
+00000ca0: 7274 2061 7070 6c79 5f68 6964 6966 6675  rt apply_hidiffu
+00000cb0: 7369 6f6e 2c20 7265 6d6f 7665 5f68 6964  sion, remove_hid
+00000cc0: 6966 6675 7369 6f6e 0a66 726f 6d20 6469  iffusion.from di
+00000cd0: 6666 7573 6572 7320 696d 706f 7274 2053  ffusers import S
+00000ce0: 7461 626c 6544 6966 6675 7369 6f6e 584c  tableDiffusionXL
+00000cf0: 5069 7065 6c69 6e65 2c20 4444 494d 5363  Pipeline, DDIMSc
+00000d00: 6865 6475 6c65 720a 696d 706f 7274 2074  heduler.import t
+00000d10: 6f72 6368 0a70 7265 7472 6169 6e5f 6d6f  orch.pretrain_mo
+00000d20: 6465 6c20 3d20 2273 7461 6269 6c69 7479  del = "stability
+00000d30: 6169 2f73 7461 626c 652d 6469 6666 7573  ai/stable-diffus
+00000d40: 696f 6e2d 786c 2d62 6173 652d 312e 3022  ion-xl-base-1.0"
+00000d50: 0a73 6368 6564 756c 6572 203d 2044 4449  .scheduler = DDI
+00000d60: 4d53 6368 6564 756c 6572 2e66 726f 6d5f  MScheduler.from_
+00000d70: 7072 6574 7261 696e 6564 2870 7265 7472  pretrained(pretr
+00000d80: 6169 6e5f 6d6f 6465 6c2c 2073 7562 666f  ain_model, subfo
+00000d90: 6c64 6572 3d22 7363 6865 6475 6c65 7222  lder="scheduler"
+00000da0: 290a 7069 7065 203d 2053 7461 626c 6544  ).pipe = StableD
+00000db0: 6966 6675 7369 6f6e 584c 5069 7065 6c69  iffusionXLPipeli
+00000dc0: 6e65 2e66 726f 6d5f 7072 6574 7261 696e  ne.from_pretrain
+00000dd0: 6564 2870 7265 7472 6169 6e5f 6d6f 6465  ed(pretrain_mode
+00000de0: 6c2c 2073 6368 6564 756c 6572 203d 2073  l, scheduler = s
+00000df0: 6368 6564 756c 6572 2c20 746f 7263 685f  cheduler, torch_
+00000e00: 6474 7970 653d 746f 7263 682e 666c 6f61  dtype=torch.floa
+00000e10: 7431 362c 2076 6172 6961 6e74 3d22 6670  t16, variant="fp
+00000e20: 3136 2229 2e74 6f28 2263 7564 6122 290a  16").to("cuda").
+00000e30: 0a23 2023 204f 7074 696f 6e61 6c2e 2065  .# # Optional. e
+00000e40: 6e61 626c 655f 7866 6f72 6d65 7273 5f6d  nable_xformers_m
+00000e50: 656d 6f72 795f 6566 6669 6369 656e 745f  emory_efficient_
+00000e60: 6174 7465 6e74 696f 6e20 6361 6e20 7361  attention can sa
+00000e70: 7665 206d 656d 6f72 7920 7573 6167 6520  ve memory usage 
+00000e80: 616e 6420 696e 6372 6561 7365 2069 6e66  and increase inf
+00000e90: 6572 656e 6365 2073 7065 6564 2e20 656e  erence speed. en
+00000ea0: 6162 6c65 5f6d 6f64 656c 5f63 7075 5f6f  able_model_cpu_o
+00000eb0: 6666 6c6f 6164 2061 6e64 2065 6e61 626c  ffload and enabl
+00000ec0: 655f 7661 655f 7469 6c69 6e67 2063 616e  e_vae_tiling can
+00000ed0: 2073 6176 6520 6d65 6d6f 7279 2075 7361   save memory usa
+00000ee0: 6765 2e0a 2320 7069 7065 2e65 6e61 626c  ge..# pipe.enabl
+00000ef0: 655f 7866 6f72 6d65 7273 5f6d 656d 6f72  e_xformers_memor
+00000f00: 795f 6566 6669 6369 656e 745f 6174 7465  y_efficient_atte
+00000f10: 6e74 696f 6e28 290a 2320 7069 7065 2e65  ntion().# pipe.e
+00000f20: 6e61 626c 655f 6d6f 6465 6c5f 6370 755f  nable_model_cpu_
+00000f30: 6f66 666c 6f61 6428 290a 2320 7069 7065  offload().# pipe
+00000f40: 2e65 6e61 626c 655f 7661 655f 7469 6c69  .enable_vae_tili
+00000f50: 6e67 2829 0a0a 2320 4170 706c 7920 6869  ng()..# Apply hi
+00000f60: 6469 6666 7573 696f 6e20 7769 7468 2061  diffusion with a
+00000f70: 2073 696e 676c 6520 6c69 6e65 206f 6620   single line of 
+00000f80: 636f 6465 2e0a 6170 706c 795f 6869 6469  code..apply_hidi
+00000f90: 6666 7573 696f 6e28 7069 7065 290a 0a70  ffusion(pipe)..p
+00000fa0: 726f 6d70 7420 3d20 2253 7461 6e64 696e  rompt = "Standin
+00000fb0: 6720 7461 6c6c 2061 6d69 6473 7420 7468  g tall amidst th
+00000fc0: 6520 7275 696e 732c 2061 2073 746f 6e65  e ruins, a stone
+00000fd0: 2067 6f6c 656d 2061 7761 6b65 6e73 2c20   golem awakens, 
+00000fe0: 7669 6e65 7320 616e 6420 666c 6f77 6572  vines and flower
+00000ff0: 7320 7370 726f 7574 696e 6720 6672 6f6d  s sprouting from
+00001000: 2074 6865 2063 7265 7669 6365 7320 696e   the crevices in
+00001010: 2069 7473 2062 6f64 792e 220a 6e65 6761   its body.".nega
+00001020: 7469 7665 5f70 726f 6d70 7420 3d20 2262  tive_prompt = "b
+00001030: 6c75 7272 792c 2075 676c 792c 2064 7570  lurry, ugly, dup
+00001040: 6c69 6361 7465 2c20 706f 6f72 6c79 2064  licate, poorly d
+00001050: 7261 776e 2066 6163 652c 2064 6566 6f72  rawn face, defor
+00001060: 6d65 642c 206d 6f73 6169 632c 2061 7274  med, mosaic, art
+00001070: 6966 6163 7473 2c20 6261 6420 6c69 6d62  ifacts, bad limb
+00001080: 7322 0a69 6d61 6765 203d 2070 6970 6528  s".image = pipe(
+00001090: 7072 6f6d 7074 2c20 6775 6964 616e 6365  prompt, guidance
+000010a0: 5f73 6361 6c65 3d37 2e35 2c20 6865 6967  _scale=7.5, heig
+000010b0: 6874 3d32 3034 382c 2077 6964 7468 3d32  ht=2048, width=2
+000010c0: 3034 382c 2065 7461 3d31 2e30 2c20 6e65  048, eta=1.0, ne
+000010d0: 6761 7469 7665 5f70 726f 6d70 743d 6e65  gative_prompt=ne
+000010e0: 6761 7469 7665 5f70 726f 6d70 7429 2e69  gative_prompt).i
+000010f0: 6d61 6765 735b 305d 0a69 6d61 6765 2e73  mages[0].image.s
+00001100: 6176 6528 6622 676f 6c65 6d2e 6a70 6722  ave(f"golem.jpg"
+00001110: 290a 6060 600a 0a3c 6465 7461 696c 733e  ).```..<details>
+00001120: 0a3c 7375 6d6d 6172 793e 4f75 7470 7574  .<summary>Output
+00001130: 3a3c 2f73 756d 6d61 7279 3e0a 3c64 6976  :</summary>.<div
+00001140: 2061 6c69 676e 3d22 6365 6e74 6572 223e   align="center">
+00001150: 0a20 203c 696d 6720 7372 633d 2261 7373  .  <img src="ass
+00001160: 6574 732f 7364 786c 2e6a 7067 2220 7769  ets/sdxl.jpg" wi
+00001170: 6474 683d 2238 3030 2220 3e3c 2f69 6d67  dth="800" ></img
+00001180: 3e0a 3c2f 6469 763e 0a3c 2f64 6574 6169  >.</div>.</detai
+00001190: 6c73 3e0a 0a53 6574 2068 6569 6768 7420  ls>..Set height 
+000011a0: 3d20 3430 3936 2c20 7769 6474 6820 3d20  = 4096, width = 
+000011b0: 3430 3936 2c20 616e 6420 796f 7520 6361  4096, and you ca
+000011c0: 6e20 6765 7420 6f75 7470 7574 2077 6974  n get output wit
+000011d0: 6820 3430 3936 7834 3039 3620 7265 736f  h 4096x4096 reso
+000011e0: 6c75 7469 6f6e 2e0a 0a23 2323 2053 7461  lution...### Sta
+000011f0: 626c 6520 4469 6666 7573 696f 6e20 584c  ble Diffusion XL
+00001200: 2054 7572 626f 0a0a 6060 6070 7974 686f   Turbo..```pytho
+00001210: 6e0a 6672 6f6d 2068 6964 6966 6675 7369  n.from hidiffusi
+00001220: 6f6e 2069 6d70 6f72 7420 6170 706c 795f  on import apply_
+00001230: 6869 6469 6666 7573 696f 6e2c 2072 656d  hidiffusion, rem
+00001240: 6f76 655f 6869 6469 6666 7573 696f 6e0a  ove_hidiffusion.
+00001250: 6672 6f6d 2064 6966 6675 7365 7273 2069  from diffusers i
+00001260: 6d70 6f72 7420 4175 746f 5069 7065 6c69  mport AutoPipeli
+00001270: 6e65 466f 7254 6578 7432 496d 6167 650a  neForText2Image.
+00001280: 696d 706f 7274 2074 6f72 6368 0a70 7265  import torch.pre
+00001290: 7472 6169 6e5f 6d6f 6465 6c20 3d20 2273  train_model = "s
+000012a0: 7461 6269 6c69 7479 6169 2f73 6478 6c2d  tabilityai/sdxl-
+000012b0: 7475 7262 6f22 0a70 6970 6520 3d20 4175  turbo".pipe = Au
+000012c0: 746f 5069 7065 6c69 6e65 466f 7254 6578  toPipelineForTex
+000012d0: 7432 496d 6167 652e 6672 6f6d 5f70 7265  t2Image.from_pre
+000012e0: 7472 6169 6e65 6428 7072 6574 7261 696e  trained(pretrain
+000012f0: 5f6d 6f64 656c 2c20 746f 7263 685f 6474  _model, torch_dt
+00001300: 7970 653d 746f 7263 682e 666c 6f61 7431  ype=torch.float1
+00001310: 362c 2076 6172 6961 6e74 3d22 6670 3136  6, variant="fp16
+00001320: 2229 2e74 6f28 2763 7564 6127 290a 0a23  ").to('cuda')..#
+00001330: 2023 204f 7074 696f 6e61 6c2e 2065 6e61   # Optional. ena
+00001340: 626c 655f 7866 6f72 6d65 7273 5f6d 656d  ble_xformers_mem
+00001350: 6f72 795f 6566 6669 6369 656e 745f 6174  ory_efficient_at
+00001360: 7465 6e74 696f 6e20 6361 6e20 7361 7665  tention can save
+00001370: 206d 656d 6f72 7920 7573 6167 6520 616e   memory usage an
+00001380: 6420 696e 6372 6561 7365 2069 6e66 6572  d increase infer
+00001390: 656e 6365 2073 7065 6564 2e20 656e 6162  ence speed. enab
+000013a0: 6c65 5f6d 6f64 656c 5f63 7075 5f6f 6666  le_model_cpu_off
+000013b0: 6c6f 6164 2061 6e64 2065 6e61 626c 655f  load and enable_
+000013c0: 7661 655f 7469 6c69 6e67 2063 616e 2073  vae_tiling can s
+000013d0: 6176 6520 6d65 6d6f 7279 2075 7361 6765  ave memory usage
+000013e0: 2e0a 2320 7069 7065 2e65 6e61 626c 655f  ..# pipe.enable_
+000013f0: 7866 6f72 6d65 7273 5f6d 656d 6f72 795f  xformers_memory_
+00001400: 6566 6669 6369 656e 745f 6174 7465 6e74  efficient_attent
+00001410: 696f 6e28 290a 2320 7069 7065 2e65 6e61  ion().# pipe.ena
+00001420: 626c 655f 6d6f 6465 6c5f 6370 755f 6f66  ble_model_cpu_of
+00001430: 666c 6f61 6428 290a 2320 7069 7065 2e65  fload().# pipe.e
+00001440: 6e61 626c 655f 7661 655f 7469 6c69 6e67  nable_vae_tiling
+00001450: 2829 0a0a 2320 4170 706c 7920 6869 6469  ()..# Apply hidi
+00001460: 6666 7573 696f 6e20 7769 7468 2061 2073  ffusion with a s
+00001470: 696e 676c 6520 6c69 6e65 206f 6620 636f  ingle line of co
+00001480: 6465 2e0a 6170 706c 795f 6869 6469 6666  de..apply_hidiff
+00001490: 7573 696f 6e28 7069 7065 290a 0a70 726f  usion(pipe)..pro
+000014a0: 6d70 7420 3d20 2249 6e20 7468 6520 6465  mpt = "In the de
+000014b0: 7074 6873 206f 6620 6120 6d79 7374 6963  pths of a mystic
+000014c0: 616c 2066 6f72 6573 742c 2061 2072 6f62  al forest, a rob
+000014d0: 6f74 6963 206f 776c 2077 6974 6820 6e69  otic owl with ni
+000014e0: 6768 7420 7669 7369 6f6e 206c 656e 7365  ght vision lense
+000014f0: 7320 666f 7220 6579 6573 2077 6174 6368  s for eyes watch
+00001500: 6573 206f 7665 7220 7468 6520 6e6f 6374  es over the noct
+00001510: 7572 6e61 6c20 6372 6561 7475 7265 732e  urnal creatures.
+00001520: 220a 696d 6167 6520 3d20 7069 7065 2870  ".image = pipe(p
+00001530: 726f 6d70 742c 206e 756d 5f69 6e66 6572  rompt, num_infer
+00001540: 656e 6365 5f73 7465 7073 3d34 2c20 6865  ence_steps=4, he
+00001550: 6967 6874 3d31 3032 342c 2077 6964 7468  ight=1024, width
+00001560: 3d31 3032 342c 2067 7569 6461 6e63 655f  =1024, guidance_
+00001570: 7363 616c 653d 302e 3029 2e69 6d61 6765  scale=0.0).image
+00001580: 735b 305d 0a69 6d61 6765 2e73 6176 6528  s[0].image.save(
+00001590: 6622 2e2f 6f77 6c2e 6a70 6722 290a 6060  f"./owl.jpg").``
+000015a0: 600a 0a3c 6465 7461 696c 733e 0a3c 7375  `..<details>.<su
+000015b0: 6d6d 6172 793e 4f75 7470 7574 3a3c 2f73  mmary>Output:</s
+000015c0: 756d 6d61 7279 3e0a 3c64 6976 2061 6c69  ummary>.<div ali
+000015d0: 676e 3d22 6365 6e74 6572 223e 0a20 203c  gn="center">.  <
+000015e0: 696d 6720 7372 633d 2261 7373 6574 732f  img src="assets/
+000015f0: 7364 786c 5f74 7572 626f 2e6a 7067 2220  sdxl_turbo.jpg" 
+00001600: 7769 6474 683d 2238 3030 2220 3e3c 2f69  width="800" ></i
+00001610: 6d67 3e0a 3c2f 6469 763e 0a3c 2f64 6574  mg>.</div>.</det
+00001620: 6169 6c73 3e0a 0a23 2323 2053 7461 626c  ails>..### Stabl
+00001630: 6520 4469 6666 7573 696f 6e20 7632 2d31  e Diffusion v2-1
+00001640: 0a0a 6060 6070 7974 686f 6e0a 6672 6f6d  ..```python.from
+00001650: 2068 6964 6966 6675 7369 6f6e 2069 6d70   hidiffusion imp
+00001660: 6f72 7420 6170 706c 795f 6869 6469 6666  ort apply_hidiff
+00001670: 7573 696f 6e2c 2072 656d 6f76 655f 6869  usion, remove_hi
+00001680: 6469 6666 7573 696f 6e0a 6672 6f6d 2064  diffusion.from d
+00001690: 6966 6675 7365 7273 2069 6d70 6f72 7420  iffusers import 
+000016a0: 4469 6666 7573 696f 6e50 6970 656c 696e  DiffusionPipelin
+000016b0: 652c 2044 4449 4d53 6368 6564 756c 6572  e, DDIMScheduler
+000016c0: 0a69 6d70 6f72 7420 746f 7263 680a 7072  .import torch.pr
+000016d0: 6574 7261 696e 5f6d 6f64 656c 203d 2022  etrain_model = "
+000016e0: 7374 6162 696c 6974 7961 692f 7374 6162  stabilityai/stab
+000016f0: 6c65 2d64 6966 6675 7369 6f6e 2d32 2d31  le-diffusion-2-1
+00001700: 2d62 6173 6522 0a73 6368 6564 756c 6572  -base".scheduler
+00001710: 203d 2044 4449 4d53 6368 6564 756c 6572   = DDIMScheduler
+00001720: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
+00001730: 2870 7265 7472 6169 6e5f 6d6f 6465 6c2c  (pretrain_model,
+00001740: 2073 7562 666f 6c64 6572 3d22 7363 6865   subfolder="sche
+00001750: 6475 6c65 7222 290a 7069 7065 203d 2044  duler").pipe = D
+00001760: 6966 6675 7369 6f6e 5069 7065 6c69 6e65  iffusionPipeline
+00001770: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
+00001780: 2870 7265 7472 6169 6e5f 6d6f 6465 6c2c  (pretrain_model,
+00001790: 2073 6368 6564 756c 6572 203d 2073 6368   scheduler = sch
+000017a0: 6564 756c 6572 2c20 746f 7263 685f 6474  eduler, torch_dt
+000017b0: 7970 653d 746f 7263 682e 666c 6f61 7431  ype=torch.float1
+000017c0: 3629 2e74 6f28 2263 7564 6122 290a 0a23  6).to("cuda")..#
+000017d0: 2023 204f 7074 696f 6e61 6c2e 2065 6e61   # Optional. ena
+000017e0: 626c 655f 7866 6f72 6d65 7273 5f6d 656d  ble_xformers_mem
+000017f0: 6f72 795f 6566 6669 6369 656e 745f 6174  ory_efficient_at
+00001800: 7465 6e74 696f 6e20 6361 6e20 7361 7665  tention can save
+00001810: 206d 656d 6f72 7920 7573 6167 6520 616e   memory usage an
+00001820: 6420 696e 6372 6561 7365 2069 6e66 6572  d increase infer
+00001830: 656e 6365 2073 7065 6564 2e20 656e 6162  ence speed. enab
+00001840: 6c65 5f6d 6f64 656c 5f63 7075 5f6f 6666  le_model_cpu_off
+00001850: 6c6f 6164 2061 6e64 2065 6e61 626c 655f  load and enable_
+00001860: 7661 655f 7469 6c69 6e67 2063 616e 2073  vae_tiling can s
+00001870: 6176 6520 6d65 6d6f 7279 2075 7361 6765  ave memory usage
+00001880: 2e0a 2320 7069 7065 2e65 6e61 626c 655f  ..# pipe.enable_
+00001890: 7866 6f72 6d65 7273 5f6d 656d 6f72 795f  xformers_memory_
+000018a0: 6566 6669 6369 656e 745f 6174 7465 6e74  efficient_attent
+000018b0: 696f 6e28 290a 2320 7069 7065 2e65 6e61  ion().# pipe.ena
+000018c0: 626c 655f 6d6f 6465 6c5f 6370 755f 6f66  ble_model_cpu_of
+000018d0: 666c 6f61 6428 290a 2320 7069 7065 2e65  fload().# pipe.e
+000018e0: 6e61 626c 655f 7661 655f 7469 6c69 6e67  nable_vae_tiling
+000018f0: 2829 0a0a 2320 4170 706c 7920 6869 6469  ()..# Apply hidi
+00001900: 6666 7573 696f 6e20 7769 7468 2061 2073  ffusion with a s
+00001910: 696e 676c 6520 6c69 6e65 206f 6620 636f  ingle line of co
+00001920: 6465 2e0a 6170 706c 795f 6869 6469 6666  de..apply_hidiff
+00001930: 7573 696f 6e28 7069 7065 290a 0a70 726f  usion(pipe)..pro
+00001940: 6d70 7420 3d20 2241 6e20 6164 6f72 6162  mpt = "An adorab
+00001950: 6c65 2068 6170 7079 2062 726f 776e 2062  le happy brown b
+00001960: 6f72 6465 7220 636f 6c6c 6965 2073 6974  order collie sit
+00001970: 7469 6e67 206f 6e20 6120 6265 642c 2068  ting on a bed, h
+00001980: 6967 6820 6465 7461 696c 2e22 0a6e 6567  igh detail.".neg
+00001990: 6174 6976 655f 7072 6f6d 7074 203d 2022  ative_prompt = "
+000019a0: 7567 6c79 2c20 7469 6c69 6e67 2c20 6f75  ugly, tiling, ou
+000019b0: 7420 6f66 2066 7261 6d65 2c20 706f 6f72  t of frame, poor
+000019c0: 6c79 2064 7261 776e 2066 6163 652c 2065  ly drawn face, e
+000019d0: 7874 7261 206c 696d 6273 2c20 6469 7366  xtra limbs, disf
+000019e0: 6967 7572 6564 2c20 6465 666f 726d 6564  igured, deformed
+000019f0: 2c20 626f 6479 206f 7574 206f 6620 6672  , body out of fr
+00001a00: 616d 652c 2062 6c75 7272 792c 2062 6164  ame, blurry, bad
+00001a10: 2061 6e61 746f 6d79 2c20 626c 7572 7265   anatomy, blurre
+00001a20: 642c 2061 7274 6966 6163 7473 2c20 6261  d, artifacts, ba
+00001a30: 6420 7072 6f70 6f72 7469 6f6e 732e 220a  d proportions.".
+00001a40: 696d 6167 6520 3d20 7069 7065 2870 726f  image = pipe(pro
+00001a50: 6d70 742c 2067 7569 6461 6e63 655f 7363  mpt, guidance_sc
+00001a60: 616c 653d 372e 352c 2068 6569 6768 743d  ale=7.5, height=
+00001a70: 3130 3234 2c20 7769 6474 683d 3130 3234  1024, width=1024
+00001a80: 2c20 6574 613d 312e 302c 206e 6567 6174  , eta=1.0, negat
+00001a90: 6976 655f 7072 6f6d 7074 3d6e 6567 6174  ive_prompt=negat
+00001aa0: 6976 655f 7072 6f6d 7074 292e 696d 6167  ive_prompt).imag
+00001ab0: 6573 5b30 5d0a 696d 6167 652e 7361 7665  es[0].image.save
+00001ac0: 2866 2263 6f6c 6c69 652e 6a70 6722 290a  (f"collie.jpg").
+00001ad0: 6060 600a 0a3c 6465 7461 696c 733e 0a3c  ```..<details>.<
+00001ae0: 7375 6d6d 6172 793e 4f75 7470 7574 3a3c  summary>Output:<
+00001af0: 2f73 756d 6d61 7279 3e0a 3c64 6976 2061  /summary>.<div a
+00001b00: 6c69 676e 3d22 6365 6e74 6572 223e 0a20  lign="center">. 
+00001b10: 203c 696d 6720 7372 633d 2261 7373 6574   <img src="asset
+00001b20: 732f 7364 3231 2e6a 7067 2220 7769 6474  s/sd21.jpg" widt
+00001b30: 683d 2238 3030 2220 3e3c 2f69 6d67 3e0a  h="800" ></img>.
+00001b40: 3c2f 6469 763e 0a3c 2f64 6574 6169 6c73  </div>.</details
+00001b50: 3e0a 0a53 6574 2068 6569 6768 7420 3d20  >..Set height = 
+00001b60: 3230 3438 2c20 7769 6474 6820 3d20 3230  2048, width = 20
+00001b70: 3438 2c20 616e 6420 796f 7520 6361 6e20  48, and you can 
+00001b80: 6765 7420 6f75 7470 7574 2077 6974 6820  get output with 
+00001b90: 3230 3438 7832 3034 3820 7265 736f 6c75  2048x2048 resolu
+00001ba0: 7469 6f6e 2e0a 0a0a 0a23 2323 2053 7461  tion.....### Sta
+00001bb0: 626c 6520 4469 6666 7573 696f 6e20 7631  ble Diffusion v1
+00001bc0: 2d35 0a0a 6060 6070 7974 686f 6e0a 6672  -5..```python.fr
+00001bd0: 6f6d 2068 6964 6966 6675 7369 6f6e 2069  om hidiffusion i
+00001be0: 6d70 6f72 7420 6170 706c 795f 6869 6469  mport apply_hidi
+00001bf0: 6666 7573 696f 6e2c 2072 656d 6f76 655f  ffusion, remove_
+00001c00: 6869 6469 6666 7573 696f 6e0a 6672 6f6d  hidiffusion.from
+00001c10: 2064 6966 6675 7365 7273 2069 6d70 6f72   diffusers impor
+00001c20: 7420 4469 6666 7573 696f 6e50 6970 656c  t DiffusionPipel
+00001c30: 696e 652c 2044 4449 4d53 6368 6564 756c  ine, DDIMSchedul
+00001c40: 6572 0a69 6d70 6f72 7420 746f 7263 680a  er.import torch.
+00001c50: 7072 6574 7261 696e 5f6d 6f64 656c 203d  pretrain_model =
+00001c60: 2022 7275 6e77 6179 6d6c 2f73 7461 626c   "runwayml/stabl
+00001c70: 652d 6469 6666 7573 696f 6e2d 7631 2d35  e-diffusion-v1-5
+00001c80: 220a 7363 6865 6475 6c65 7220 3d20 4444  ".scheduler = DD
+00001c90: 494d 5363 6865 6475 6c65 722e 6672 6f6d  IMScheduler.from
+00001ca0: 5f70 7265 7472 6169 6e65 6428 7072 6574  _pretrained(pret
+00001cb0: 7261 696e 5f6d 6f64 656c 2c20 7375 6266  rain_model, subf
+00001cc0: 6f6c 6465 723d 2273 6368 6564 756c 6572  older="scheduler
+00001cd0: 2229 0a70 6970 6520 3d20 4469 6666 7573  ").pipe = Diffus
+00001ce0: 696f 6e50 6970 656c 696e 652e 6672 6f6d  ionPipeline.from
+00001cf0: 5f70 7265 7472 6169 6e65 6428 7072 6574  _pretrained(pret
+00001d00: 7261 696e 5f6d 6f64 656c 2c20 7363 6865  rain_model, sche
+00001d10: 6475 6c65 7220 3d20 7363 6865 6475 6c65  duler = schedule
+00001d20: 722c 2074 6f72 6368 5f64 7479 7065 3d74  r, torch_dtype=t
+00001d30: 6f72 6368 2e66 6c6f 6174 3136 292e 746f  orch.float16).to
+00001d40: 2822 6375 6461 2229 0a0a 2320 2320 4f70  ("cuda")..# # Op
+00001d50: 7469 6f6e 616c 2e20 656e 6162 6c65 5f78  tional. enable_x
+00001d60: 666f 726d 6572 735f 6d65 6d6f 7279 5f65  formers_memory_e
+00001d70: 6666 6963 6965 6e74 5f61 7474 656e 7469  fficient_attenti
+00001d80: 6f6e 2063 616e 2073 6176 6520 6d65 6d6f  on can save memo
+00001d90: 7279 2075 7361 6765 2061 6e64 2069 6e63  ry usage and inc
+00001da0: 7265 6173 6520 696e 6665 7265 6e63 6520  rease inference 
+00001db0: 7370 6565 642e 2065 6e61 626c 655f 6d6f  speed. enable_mo
+00001dc0: 6465 6c5f 6370 755f 6f66 666c 6f61 6420  del_cpu_offload 
+00001dd0: 616e 6420 656e 6162 6c65 5f76 6165 5f74  and enable_vae_t
+00001de0: 696c 696e 6720 6361 6e20 7361 7665 206d  iling can save m
+00001df0: 656d 6f72 7920 7573 6167 652e 0a23 2070  emory usage..# p
+00001e00: 6970 652e 656e 6162 6c65 5f78 666f 726d  ipe.enable_xform
+00001e10: 6572 735f 6d65 6d6f 7279 5f65 6666 6963  ers_memory_effic
+00001e20: 6965 6e74 5f61 7474 656e 7469 6f6e 2829  ient_attention()
+00001e30: 0a23 2070 6970 652e 656e 6162 6c65 5f6d  .# pipe.enable_m
+00001e40: 6f64 656c 5f63 7075 5f6f 6666 6c6f 6164  odel_cpu_offload
+00001e50: 2829 0a23 2070 6970 652e 656e 6162 6c65  ().# pipe.enable
+00001e60: 5f76 6165 5f74 696c 696e 6728 290a 0a23  _vae_tiling()..#
+00001e70: 2041 7070 6c79 2068 6964 6966 6675 7369   Apply hidiffusi
+00001e80: 6f6e 2077 6974 6820 6120 7369 6e67 6c65  on with a single
+00001e90: 206c 696e 6520 6f66 2063 6f64 652e 0a61   line of code..a
+00001ea0: 7070 6c79 5f68 6964 6966 6675 7369 6f6e  pply_hidiffusion
+00001eb0: 2870 6970 6529 0a0a 7072 6f6d 7074 203d  (pipe)..prompt =
+00001ec0: 2022 7468 6963 6b20 7374 726f 6b65 732c   "thick strokes,
+00001ed0: 2062 7269 6768 7420 636f 6c6f 7273 2c20   bright colors, 
+00001ee0: 616e 2065 786f 7469 6320 666f 782c 2063  an exotic fox, c
+00001ef0: 7574 652c 2063 6869 6269 206b 6177 6169  ute, chibi kawai
+00001f00: 692e 2064 6574 6169 6c65 6420 6675 722c  i. detailed fur,
+00001f10: 2068 7970 6572 6465 7461 696c 6564 202c   hyperdetailed ,
+00001f20: 2062 6967 2072 6566 6c65 6374 6976 6520   big reflective 
+00001f30: 6579 6573 2c20 6661 6972 7974 616c 652c  eyes, fairytale,
+00001f40: 2061 7274 7374 6174 696f 6e2c 6365 6e74   artstation,cent
+00001f50: 6572 6564 2063 6f6d 706f 7369 7469 6f6e  ered composition
+00001f60: 2c20 7065 7266 6563 7420 636f 6d70 6f73  , perfect compos
+00001f70: 6974 696f 6e2c 2063 656e 7465 7265 642c  ition, centered,
+00001f80: 2076 6962 7261 6e74 2063 6f6c 6f72 732c   vibrant colors,
+00001f90: 206d 7574 6564 2063 6f6c 6f72 732c 2068   muted colors, h
+00001fa0: 6967 6820 6465 7461 696c 6564 2c20 386b  igh detailed, 8k
+00001fb0: 2e22 0a6e 6567 6174 6976 655f 7072 6f6d  .".negative_prom
+00001fc0: 7074 203d 2022 7567 6c79 2c20 7469 6c69  pt = "ugly, tili
+00001fd0: 6e67 2c20 706f 6f72 6c79 2064 7261 776e  ng, poorly drawn
+00001fe0: 2066 6163 652c 206f 7574 206f 6620 6672   face, out of fr
+00001ff0: 616d 652c 2064 6973 6669 6775 7265 642c  ame, disfigured,
+00002000: 2064 6566 6f72 6d65 642c 2062 6c75 7272   deformed, blurr
+00002010: 792c 2062 6164 2061 6e61 746f 6d79 2c20  y, bad anatomy, 
+00002020: 626c 7572 7265 642e 220a 696d 6167 6520  blurred.".image 
+00002030: 3d20 7069 7065 2870 726f 6d70 742c 2067  = pipe(prompt, g
+00002040: 7569 6461 6e63 655f 7363 616c 653d 372e  uidance_scale=7.
+00002050: 352c 2068 6569 6768 743d 3130 3234 2c20  5, height=1024, 
+00002060: 7769 6474 683d 3130 3234 2c20 6574 613d  width=1024, eta=
+00002070: 312e 302c 206e 6567 6174 6976 655f 7072  1.0, negative_pr
+00002080: 6f6d 7074 3d6e 6567 6174 6976 655f 7072  ompt=negative_pr
+00002090: 6f6d 7074 292e 696d 6167 6573 5b30 5d0a  ompt).images[0].
+000020a0: 696d 6167 652e 7361 7665 2866 2266 6f78  image.save(f"fox
+000020b0: 2e6a 7067 2229 0a60 6060 0a0a 3c64 6574  .jpg").```..<det
+000020c0: 6169 6c73 3e0a 3c73 756d 6d61 7279 3e4f  ails>.<summary>O
+000020d0: 7574 7075 743a 3c2f 7375 6d6d 6172 793e  utput:</summary>
+000020e0: 0a3c 6469 7620 616c 6967 6e3d 2263 656e  .<div align="cen
+000020f0: 7465 7222 3e0a 2020 3c69 6d67 2073 7263  ter">.  <img src
+00002100: 3d22 6173 7365 7473 2f73 6431 352e 6a70  ="assets/sd15.jp
+00002110: 6722 2077 6964 7468 3d22 3830 3022 203e  g" width="800" >
+00002120: 3c2f 696d 673e 0a3c 2f64 6976 3e0a 3c2f  </img>.</div>.</
+00002130: 6465 7461 696c 733e 0a0a 5365 7420 6865  details>..Set he
+00002140: 6967 6874 203d 2032 3034 382c 2077 6964  ight = 2048, wid
+00002150: 7468 203d 2032 3034 382c 2061 6e64 2079  th = 2048, and y
+00002160: 6f75 2063 616e 2067 6574 206f 7574 7075  ou can get outpu
+00002170: 7420 7769 7468 2032 3034 3878 3230 3438  t with 2048x2048
+00002180: 2072 6573 6f6c 7574 696f 6e2e 0a0a 2323   resolution...##
+00002190: 2320 5265 6d6f 7665 2048 6944 6966 6675  # Remove HiDiffu
+000021a0: 7369 6f6e 0a0a 4966 2079 6f75 2077 616e  sion..If you wan
+000021b0: 7420 746f 2072 656d 6f76 6520 4869 4469  t to remove HiDi
+000021c0: 6966 6675 7369 6f6e 2c20 7369 6d70 6c79  iffusion, simply
+000021d0: 2075 7365 2060 7265 6d6f 7665 5f68 6964   use `remove_hid
+000021e0: 6966 6675 7369 6f6e 2870 6970 6529 602e  iffusion(pipe)`.
+000021f0: 0a0a 2323 2043 6f6e 7472 6f6c 4e65 740a  ..## ControlNet.
+00002200: 0a60 6060 7079 7468 6f6e 0a66 726f 6d20  .```python.from 
+00002210: 6469 6666 7573 6572 7320 696d 706f 7274  diffusers import
+00002220: 2053 7461 626c 6544 6966 6675 7369 6f6e   StableDiffusion
+00002230: 584c 436f 6e74 726f 6c4e 6574 5069 7065  XLControlNetPipe
+00002240: 6c69 6e65 2c20 436f 6e74 726f 6c4e 6574  line, ControlNet
+00002250: 4d6f 6465 6c2c 2044 4449 4d53 6368 6564  Model, DDIMSched
+00002260: 756c 6572 0a69 6d70 6f72 7420 6e75 6d70  uler.import nump
+00002270: 7920 6173 206e 700a 696d 706f 7274 2074  y as np.import t
+00002280: 6f72 6368 0a69 6d70 6f72 7420 6376 320a  orch.import cv2.
+00002290: 6672 6f6d 2050 494c 2069 6d70 6f72 7420  from PIL import 
+000022a0: 496d 6167 650a 6672 6f6d 2068 6964 6966  Image.from hidif
+000022b0: 6675 7369 6f6e 2069 6d70 6f72 7420 6170  fusion import ap
+000022c0: 706c 795f 6869 6469 6666 7573 696f 6e2c  ply_hidiffusion,
+000022d0: 2072 656d 6f76 655f 6869 6469 6666 7573   remove_hidiffus
+000022e0: 696f 6e0a 0a23 206c 6f61 6420 596f 7368  ion..# load Yosh
+000022f0: 7561 5f42 656e 6769 6f2e 6a70 6720 696e  ua_Bengio.jpg in
+00002300: 2074 6865 2061 7373 6574 7320 6669 6c65   the assets file
+00002310: 2e0a 7061 7468 203d 2027 596f 7368 7561  ..path = 'Yoshua
+00002320: 5f42 656e 6769 6f2e 6a70 6727 0a69 6d61  _Bengio.jpg'.ima
+00002330: 6765 203d 2049 6d61 6765 2e6f 7065 6e28  ge = Image.open(
+00002340: 7061 7468 290a 2320 6765 7420 6361 6e6e  path).# get cann
+00002350: 7920 696d 6167 650a 696d 6167 6520 3d20  y image.image = 
+00002360: 6e70 2e61 7272 6179 2869 6d61 6765 290a  np.array(image).
+00002370: 696d 6167 6520 3d20 6376 322e 4361 6e6e  image = cv2.Cann
+00002380: 7928 696d 6167 652c 2031 3030 2c20 3230  y(image, 100, 20
+00002390: 3029 0a69 6d61 6765 203d 2069 6d61 6765  0).image = image
+000023a0: 5b3a 2c20 3a2c 204e 6f6e 655d 0a69 6d61  [:, :, None].ima
+000023b0: 6765 203d 206e 702e 636f 6e63 6174 656e  ge = np.concaten
+000023c0: 6174 6528 5b69 6d61 6765 2c20 696d 6167  ate([image, imag
+000023d0: 652c 2069 6d61 6765 5d2c 2061 7869 733d  e, image], axis=
+000023e0: 3229 0a63 616e 6e79 5f69 6d61 6765 203d  2).canny_image =
+000023f0: 2049 6d61 6765 2e66 726f 6d61 7272 6179   Image.fromarray
+00002400: 2869 6d61 6765 290a 0a23 2069 6e69 7469  (image)..# initi
+00002410: 616c 697a 6520 7468 6520 6d6f 6465 6c73  alize the models
+00002420: 2061 6e64 2070 6970 656c 696e 650a 636f   and pipeline.co
+00002430: 6e74 726f 6c6e 6574 5f63 6f6e 6469 7469  ntrolnet_conditi
+00002440: 6f6e 696e 675f 7363 616c 6520 3d20 302e  oning_scale = 0.
+00002450: 3520 2023 2072 6563 6f6d 6d65 6e64 6564  5  # recommended
+00002460: 2066 6f72 2067 6f6f 6420 6765 6e65 7261   for good genera
+00002470: 6c69 7a61 7469 6f6e 0a63 6f6e 7472 6f6c  lization.control
+00002480: 6e65 7420 3d20 436f 6e74 726f 6c4e 6574  net = ControlNet
+00002490: 4d6f 6465 6c2e 6672 6f6d 5f70 7265 7472  Model.from_pretr
+000024a0: 6169 6e65 6428 0a20 2020 2022 6469 6666  ained(.    "diff
+000024b0: 7573 6572 732f 636f 6e74 726f 6c6e 6574  users/controlnet
+000024c0: 2d63 616e 6e79 2d73 6478 6c2d 312e 3022  -canny-sdxl-1.0"
+000024d0: 2c20 746f 7263 685f 6474 7970 653d 746f  , torch_dtype=to
+000024e0: 7263 682e 666c 6f61 7431 362c 2076 6172  rch.float16, var
+000024f0: 6961 6e74 3d22 6670 3136 220a 290a 7363  iant="fp16".).sc
+00002500: 6865 6475 6c65 7220 3d20 4444 494d 5363  heduler = DDIMSc
+00002510: 6865 6475 6c65 722e 6672 6f6d 5f70 7265  heduler.from_pre
+00002520: 7472 6169 6e65 6428 2273 7461 6269 6c69  trained("stabili
+00002530: 7479 6169 2f73 7461 626c 652d 6469 6666  tyai/stable-diff
+00002540: 7573 696f 6e2d 786c 2d62 6173 652d 312e  usion-xl-base-1.
+00002550: 3022 2c20 7375 6266 6f6c 6465 723d 2273  0", subfolder="s
+00002560: 6368 6564 756c 6572 2229 0a70 6970 6520  cheduler").pipe 
+00002570: 3d20 5374 6162 6c65 4469 6666 7573 696f  = StableDiffusio
+00002580: 6e58 4c43 6f6e 7472 6f6c 4e65 7450 6970  nXLControlNetPip
+00002590: 656c 696e 652e 6672 6f6d 5f70 7265 7472  eline.from_pretr
+000025a0: 6169 6e65 6428 0a20 2020 2022 7374 6162  ained(.    "stab
+000025b0: 696c 6974 7961 692f 7374 6162 6c65 2d64  ilityai/stable-d
+000025c0: 6966 6675 7369 6f6e 2d78 6c2d 6261 7365  iffusion-xl-base
+000025d0: 2d31 2e30 222c 2063 6f6e 7472 6f6c 6e65  -1.0", controlne
+000025e0: 743d 636f 6e74 726f 6c6e 6574 2c20 746f  t=controlnet, to
+000025f0: 7263 685f 6474 7970 653d 746f 7263 682e  rch_dtype=torch.
+00002600: 666c 6f61 7431 362c 0a20 2020 2073 6368  float16,.    sch
+00002610: 6564 756c 6572 203d 2073 6368 6564 756c  eduler = schedul
+00002620: 6572 0a29 0a0a 2320 4170 706c 7920 6869  er.)..# Apply hi
+00002630: 6469 6666 7573 696f 6e20 7769 7468 2061  diffusion with a
+00002640: 2073 696e 676c 6520 6c69 6e65 206f 6620   single line of 
+00002650: 636f 6465 2e0a 6170 706c 795f 6869 6469  code..apply_hidi
+00002660: 6666 7573 696f 6e28 7069 7065 290a 0a70  ffusion(pipe)..p
+00002670: 6970 652e 656e 6162 6c65 5f6d 6f64 656c  ipe.enable_model
+00002680: 5f63 7075 5f6f 6666 6c6f 6164 2829 0a70  _cpu_offload().p
+00002690: 6970 652e 656e 6162 6c65 5f78 666f 726d  ipe.enable_xform
+000026a0: 6572 735f 6d65 6d6f 7279 5f65 6666 6963  ers_memory_effic
+000026b0: 6965 6e74 5f61 7474 656e 7469 6f6e 2829  ient_attention()
+000026c0: 0a0a 7072 6f6d 7074 203d 2022 6120 7a6f  ..prompt = "a zo
+000026d0: 6d62 6965 2c20 6869 6768 2066 6163 6520  mbie, high face 
+000026e0: 6465 7461 696c 2c20 6869 6768 2064 6574  detail, high det
+000026f0: 6169 6c2c 206d 7574 6564 2063 6f6c 6f72  ail, muted color
+00002700: 2c20 386b 220a 6e65 6761 7469 7665 5f70  , 8k".negative_p
+00002710: 726f 6d70 7420 3d20 2262 6c75 7272 792c  rompt = "blurry,
+00002720: 2075 676c 792c 2064 7570 6c69 6361 7465   ugly, duplicate
+00002730: 2c20 706f 6f72 6c79 2064 7261 776e 2c20  , poorly drawn, 
+00002740: 6465 666f 726d 6564 2c20 6d6f 7361 6963  deformed, mosaic
+00002750: 2c20 706f 6f72 6c79 2064 7261 776e 2074  , poorly drawn t
+00002760: 6565 7468 2c20 6475 706c 6963 6174 6564  eeth, duplicated
+00002770: 2074 6565 7468 2e22 0a0a 696d 6167 6520   teeth."..image 
+00002780: 3d20 7069 7065 280a 2020 2020 7072 6f6d  = pipe(.    prom
+00002790: 7074 2c20 636f 6e74 726f 6c6e 6574 5f63  pt, controlnet_c
+000027a0: 6f6e 6469 7469 6f6e 696e 675f 7363 616c  onditioning_scal
+000027b0: 653d 636f 6e74 726f 6c6e 6574 5f63 6f6e  e=controlnet_con
+000027c0: 6469 7469 6f6e 696e 675f 7363 616c 652c  ditioning_scale,
+000027d0: 2069 6d61 6765 3d63 616e 6e79 5f69 6d61   image=canny_ima
+000027e0: 6765 2c0a 2020 2020 6865 6967 6874 3d32  ge,.    height=2
+000027f0: 3034 382c 2077 6964 7468 3d32 3034 382c  048, width=2048,
+00002800: 2067 7569 6461 6e63 655f 7363 616c 653d   guidance_scale=
+00002810: 372e 352c 206e 6567 6174 6976 655f 7072  7.5, negative_pr
+00002820: 6f6d 7074 203d 206e 6567 6174 6976 655f  ompt = negative_
+00002830: 7072 6f6d 7074 2c20 6574 613d 312e 300a  prompt, eta=1.0.
+00002840: 292e 696d 6167 6573 5b30 5d0a 0a69 6d61  ).images[0]..ima
+00002850: 6765 2e73 6176 6528 277a 6f6d 6269 652e  ge.save('zombie.
+00002860: 6a70 6727 290a 6060 600a 0a3c 6465 7461  jpg').```..<deta
+00002870: 696c 733e 0a3c 7375 6d6d 6172 793e 4f75  ils>.<summary>Ou
+00002880: 7470 7574 3a3c 2f73 756d 6d61 7279 3e0a  tput:</summary>.
+00002890: 3c64 6976 2061 6c69 676e 3d22 6365 6e74  <div align="cent
+000028a0: 6572 223e 0a20 203c 696d 6720 7372 633d  er">.  <img src=
+000028b0: 2261 7373 6574 732f 636f 6e74 726f 6c6e  "assets/controln
+000028c0: 6574 5f72 6573 756c 742e 6a70 6722 2077  et_result.jpg" w
+000028d0: 6964 7468 3d22 3830 3022 203e 3c2f 696d  idth="800" ></im
+000028e0: 673e 0a3c 2f64 6976 3e0a 3c2f 6465 7461  g>.</div>.</deta
+000028f0: 696c 733e 0a0a 2323 2049 6e70 6169 6e74  ils>..## Inpaint
+00002900: 696e 670a 0a60 6060 7079 7468 6f6e 0a69  ing..```python.i
+00002910: 6d70 6f72 7420 746f 7263 680a 6672 6f6d  mport torch.from
+00002920: 2064 6966 6675 7365 7273 2069 6d70 6f72   diffusers impor
+00002930: 7420 4175 746f 5069 7065 6c69 6e65 466f  t AutoPipelineFo
+00002940: 7249 6e70 6169 6e74 696e 672c 2044 4449  rInpainting, DDI
+00002950: 4d53 6368 6564 756c 6572 0a66 726f 6d20  MScheduler.from 
+00002960: 6469 6666 7573 6572 732e 7574 696c 7320  diffusers.utils 
+00002970: 696d 706f 7274 206c 6f61 645f 696d 6167  import load_imag
+00002980: 650a 6672 6f6d 2068 6964 6966 6675 7369  e.from hidiffusi
+00002990: 6f6e 2069 6d70 6f72 7420 6170 706c 795f  on import apply_
+000029a0: 6869 6469 6666 7573 696f 6e2c 2072 656d  hidiffusion, rem
+000029b0: 6f76 655f 6869 6469 6666 7573 696f 6e0a  ove_hidiffusion.
+000029c0: 6672 6f6d 2050 494c 2069 6d70 6f72 7420  from PIL import 
+000029d0: 496d 6167 650a 0a73 6368 6564 756c 6572  Image..scheduler
+000029e0: 203d 2044 4449 4d53 6368 6564 756c 6572   = DDIMScheduler
+000029f0: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
+00002a00: 2822 7374 6162 696c 6974 7961 692f 7374  ("stabilityai/st
+00002a10: 6162 6c65 2d64 6966 6675 7369 6f6e 2d78  able-diffusion-x
+00002a20: 6c2d 6261 7365 2d31 2e30 222c 2073 7562  l-base-1.0", sub
+00002a30: 666f 6c64 6572 3d22 7363 6865 6475 6c65  folder="schedule
+00002a40: 7222 290a 7069 7065 6c69 6e65 203d 2041  r").pipeline = A
+00002a50: 7574 6f50 6970 656c 696e 6546 6f72 496e  utoPipelineForIn
+00002a60: 7061 696e 7469 6e67 2e66 726f 6d5f 7072  painting.from_pr
+00002a70: 6574 7261 696e 6564 280a 2020 2020 2264  etrained(.    "d
+00002a80: 6966 6675 7365 7273 2f73 7461 626c 652d  iffusers/stable-
+00002a90: 6469 6666 7573 696f 6e2d 786c 2d31 2e30  diffusion-xl-1.0
+00002aa0: 2d69 6e70 6169 6e74 696e 672d 302e 3122  -inpainting-0.1"
+00002ab0: 2c20 746f 7263 685f 6474 7970 653d 746f  , torch_dtype=to
+00002ac0: 7263 682e 666c 6f61 7431 362c 2076 6172  rch.float16, var
+00002ad0: 6961 6e74 3d22 6670 3136 222c 200a 2020  iant="fp16", .  
+00002ae0: 2020 7363 6865 6475 6c65 723d 7363 6865    scheduler=sche
+00002af0: 6475 6c65 720a 290a 0a23 2041 7070 6c79  duler.)..# Apply
+00002b00: 2068 6964 6966 6675 7369 6f6e 2077 6974   hidiffusion wit
+00002b10: 6820 6120 7369 6e67 6c65 206c 696e 6520  h a single line 
+00002b20: 6f66 2063 6f64 652e 0a61 7070 6c79 5f68  of code..apply_h
+00002b30: 6964 6966 6675 7369 6f6e 2870 6970 656c  idiffusion(pipel
+00002b40: 696e 6529 0a0a 7069 7065 6c69 6e65 2e65  ine)..pipeline.e
+00002b50: 6e61 626c 655f 6d6f 6465 6c5f 6370 755f  nable_model_cpu_
+00002b60: 6f66 666c 6f61 6428 290a 2320 7265 6d6f  offload().# remo
+00002b70: 7665 2066 6f6c 6c6f 7769 6e67 206c 696e  ve following lin
+00002b80: 6520 6966 2078 466f 726d 6572 7320 6973  e if xFormers is
+00002b90: 206e 6f74 2069 6e73 7461 6c6c 6564 0a70   not installed.p
+00002ba0: 6970 656c 696e 652e 656e 6162 6c65 5f78  ipeline.enable_x
+00002bb0: 666f 726d 6572 735f 6d65 6d6f 7279 5f65  formers_memory_e
+00002bc0: 6666 6963 6965 6e74 5f61 7474 656e 7469  fficient_attenti
+00002bd0: 6f6e 2829 0a0a 2320 6c6f 6164 2062 6173  on()..# load bas
+00002be0: 6520 616e 6420 6d61 736b 2069 6d61 6765  e and mask image
+00002bf0: 0a69 6d67 5f75 726c 203d 2022 6874 7470  .img_url = "http
+00002c00: 733a 2f2f 6875 6767 696e 6766 6163 652e  s://huggingface.
+00002c10: 636f 2f64 6174 6173 6574 732f 6875 6767  co/datasets/hugg
+00002c20: 696e 6766 6163 652f 646f 6375 6d65 6e74  ingface/document
+00002c30: 6174 696f 6e2d 696d 6167 6573 2f72 6573  ation-images/res
+00002c40: 6f6c 7665 2f6d 6169 6e2f 6469 6666 7573  olve/main/diffus
+00002c50: 6572 732f 7364 786c 2d74 6578 7432 696d  ers/sdxl-text2im
+00002c60: 672e 706e 6722 0a69 6e69 745f 696d 6167  g.png".init_imag
+00002c70: 6520 3d20 6c6f 6164 5f69 6d61 6765 2869  e = load_image(i
+00002c80: 6d67 5f75 726c 290a 2320 6c6f 6164 206d  mg_url).# load m
+00002c90: 6173 6b5f 696d 6167 652e 6a70 6720 696e  ask_image.jpg in
+00002ca0: 2074 6865 2061 7373 6574 7320 6669 6c65   the assets file
+00002cb0: 2e0a 6d61 736b 5f69 6d61 6765 203d 2049  ..mask_image = I
+00002cc0: 6d61 6765 2e6f 7065 6e28 226d 6173 6b5f  mage.open("mask_
+00002cd0: 696d 6167 652e 706e 6722 290a 0a70 726f  image.png")..pro
+00002ce0: 6d70 7420 3d20 2022 4120 7374 6561 6d70  mpt =  "A steamp
+00002cf0: 756e 6b20 6578 706c 6f72 6572 2069 6e20  unk explorer in 
+00002d00: 6120 6c65 6174 6865 7220 6176 6961 746f  a leather aviato
+00002d10: 7220 6361 7020 616e 6420 676f 6767 6c65  r cap and goggle
+00002d20: 732c 2077 6974 6820 6120 6272 6173 7320  s, with a brass 
+00002d30: 7465 6c65 7363 6f70 6520 696e 2068 616e  telescope in han
+00002d40: 642c 2073 7461 6e64 7320 616d 6964 7374  d, stands amidst
+00002d50: 2074 6f77 6572 696e 6720 616e 6369 656e   towering ancien
+00002d60: 7420 7472 6565 732c 2074 6865 6972 2072  t trees, their r
+00002d70: 6f6f 7473 2065 6e74 7769 6e65 6420 7769  oots entwined wi
+00002d80: 7468 2069 6e74 7269 6361 7465 2067 6561  th intricate gea
+00002d90: 7273 2061 6e64 2070 6970 6573 2e22 0a0a  rs and pipes."..
+00002da0: 6e65 6761 7469 7665 5f70 726f 6d70 7420  negative_prompt 
+00002db0: 3d20 2262 6c75 7272 792c 2075 676c 792c  = "blurry, ugly,
+00002dc0: 2064 7570 6c69 6361 7465 2c20 706f 6f72   duplicate, poor
+00002dd0: 6c79 2064 7261 776e 2c20 6465 666f 726d  ly drawn, deform
+00002de0: 6564 2c20 6d6f 7361 6963 220a 696d 6167  ed, mosaic".imag
+00002df0: 6520 3d20 7069 7065 6c69 6e65 2870 726f  e = pipeline(pro
+00002e00: 6d70 743d 7072 6f6d 7074 2c20 696d 6167  mpt=prompt, imag
+00002e10: 653d 696e 6974 5f69 6d61 6765 2c20 6d61  e=init_image, ma
+00002e20: 736b 5f69 6d61 6765 3d6d 6173 6b5f 696d  sk_image=mask_im
+00002e30: 6167 652c 2068 6569 6768 743d 3230 3438  age, height=2048
+00002e40: 2c20 7769 6474 683d 3230 3438 2c20 7374  , width=2048, st
+00002e50: 7265 6e67 7468 3d30 2e38 352c 2067 7569  rength=0.85, gui
+00002e60: 6461 6e63 655f 7363 616c 653d 3132 2e35  dance_scale=12.5
+00002e70: 2c20 6e65 6761 7469 7665 5f70 726f 6d70  , negative_promp
+00002e80: 7420 3d20 6e65 6761 7469 7665 5f70 726f  t = negative_pro
+00002e90: 6d70 742c 2065 7461 3d31 2e30 292e 696d  mpt, eta=1.0).im
+00002ea0: 6167 6573 5b30 5d0a 696d 6167 652e 7361  ages[0].image.sa
+00002eb0: 7665 2827 7374 6561 6d70 756e 6b5f 6578  ve('steampunk_ex
+00002ec0: 706c 6f72 6572 2e6a 7067 2729 0a60 6060  plorer.jpg').```
+00002ed0: 0a0a 3c64 6574 6169 6c73 3e0a 3c73 756d  ..<details>.<sum
+00002ee0: 6d61 7279 3e4f 7574 7075 743a 3c2f 7375  mary>Output:</su
+00002ef0: 6d6d 6172 793e 0a3c 6469 7620 616c 6967  mmary>.<div alig
+00002f00: 6e3d 2263 656e 7465 7222 3e0a 2020 3c69  n="center">.  <i
+00002f10: 6d67 2073 7263 3d22 6173 7365 7473 2f69  mg src="assets/i
+00002f20: 6e70 6169 6e74 696e 675f 7265 7375 6c74  npainting_result
+00002f30: 2e6a 7067 2220 7769 6474 683d 2238 3030  .jpg" width="800
+00002f40: 2220 3e3c 2f69 6d67 3e0a 3c2f 6469 763e  " ></img>.</div>
+00002f50: 0a3c 2f64 6574 6169 6c73 3e0a 0a0a 2323  .</details>...##
+00002f60: 2049 6e74 6567 7261 7469 6f6e 2069 6e74   Integration int
+00002f70: 6f20 646f 776e 7374 7265 616d 206d 6f64  o downstream mod
+00002f80: 656c 730a 4869 4469 6666 7573 696f 6e20  els.HiDiffusion 
+00002f90: 7375 7070 6f72 7473 206d 6f64 656c 7320  supports models 
+00002fa0: 6261 7365 6420 6f6e 205b 7375 7070 6f72  based on [suppor
+00002fb0: 7465 6420 6d6f 6465 6c73 5d28 232d 7375  ted models](#-su
+00002fc0: 7070 6f72 7465 642d 6d6f 6465 6c73 292c  pported-models),
+00002fd0: 2073 7563 6820 6173 205b 4768 6962 6c69   such as [Ghibli
+00002fe0: 2d44 6966 6675 7369 6f6e 5d28 6874 7470  -Diffusion](http
+00002ff0: 733a 2f2f 6875 6767 696e 6766 6163 652e  s://huggingface.
+00003000: 636f 2f6e 6974 726f 736f 636b 652f 4768  co/nitrosocke/Gh
+00003010: 6962 6c69 2d44 6966 6675 7369 6f6e 292c  ibli-Diffusion),
+00003020: 205b 506c 6179 6772 6f75 6e64 5d28 6874   [Playground](ht
+00003030: 7470 733a 2f2f 6875 6767 696e 6766 6163  tps://huggingfac
+00003040: 652e 636f 2f70 6c61 7967 726f 756e 6461  e.co/playgrounda
+00003050: 692f 706c 6179 6772 6f75 6e64 2d76 322d  i/playground-v2-
+00003060: 3130 3234 7078 2d61 6573 7468 6574 6963  1024px-aesthetic
+00003070: 292c 2065 7463 2e0a 0a23 2323 2047 6869  ), etc...### Ghi
+00003080: 626c 692d 4469 6666 7573 696f 6e0a 6060  bli-Diffusion.``
+00003090: 6070 7974 686f 6e0a 6672 6f6d 2064 6966  `python.from dif
+000030a0: 6675 7365 7273 2069 6d70 6f72 7420 5374  fusers import St
+000030b0: 6162 6c65 4469 6666 7573 696f 6e50 6970  ableDiffusionPip
+000030c0: 656c 696e 652c 2044 4449 4d53 6368 6564  eline, DDIMSched
+000030d0: 756c 6572 0a69 6d70 6f72 7420 746f 7263  uler.import torc
+000030e0: 680a 6672 6f6d 2068 6964 6966 6675 7369  h.from hidiffusi
+000030f0: 6f6e 2069 6d70 6f72 7420 6170 706c 795f  on import apply_
+00003100: 6869 6469 6666 7573 696f 6e2c 2072 656d  hidiffusion, rem
+00003110: 6f76 655f 6869 6469 6666 7573 696f 6e0a  ove_hidiffusion.
+00003120: 0a6d 6f64 656c 5f69 6420 3d20 226e 6974  .model_id = "nit
+00003130: 726f 736f 636b 652f 4768 6962 6c69 2d44  rosocke/Ghibli-D
+00003140: 6966 6675 7369 6f6e 220a 7363 6865 6475  iffusion".schedu
+00003150: 6c65 7220 3d20 4444 494d 5363 6865 6475  ler = DDIMSchedu
+00003160: 6c65 722e 6672 6f6d 5f70 7265 7472 6169  ler.from_pretrai
+00003170: 6e65 6428 6d6f 6465 6c5f 6964 2c20 7375  ned(model_id, su
+00003180: 6266 6f6c 6465 723d 2273 6368 6564 756c  bfolder="schedul
+00003190: 6572 2229 0a70 6970 6520 3d20 5374 6162  er").pipe = Stab
+000031a0: 6c65 4469 6666 7573 696f 6e50 6970 656c  leDiffusionPipel
+000031b0: 696e 652e 6672 6f6d 5f70 7265 7472 6169  ine.from_pretrai
+000031c0: 6e65 6428 6d6f 6465 6c5f 6964 2c20 746f  ned(model_id, to
+000031d0: 7263 685f 6474 7970 653d 746f 7263 682e  rch_dtype=torch.
+000031e0: 666c 6f61 7431 3629 0a70 6970 6520 3d20  float16).pipe = 
+000031f0: 7069 7065 2e74 6f28 2263 7564 6122 290a  pipe.to("cuda").
+00003200: 0a23 2041 7070 6c79 2068 6964 6966 6675  .# Apply hidiffu
+00003210: 7369 6f6e 2077 6974 6820 6120 7369 6e67  sion with a sing
+00003220: 6c65 206c 696e 6520 6f66 2063 6f64 652e  le line of code.
+00003230: 0a61 7070 6c79 5f68 6964 6966 6675 7369  .apply_hidiffusi
+00003240: 6f6e 2870 6970 6529 0a0a 7072 6f6d 7074  on(pipe)..prompt
+00003250: 203d 2022 6768 6962 6c69 2073 7479 6c65   = "ghibli style
+00003260: 206d 6167 6963 616c 2070 7269 6e63 6573   magical princes
+00003270: 7320 7769 7468 2067 6f6c 6465 6e20 6861  s with golden ha
+00003280: 6972 220a 6e65 6761 7469 7665 5f70 726f  ir".negative_pro
+00003290: 6d70 743d 2262 6c75 7272 792c 2075 676c  mpt="blurry, ugl
+000032a0: 792c 2064 7570 6c69 6361 7465 2c20 706f  y, duplicate, po
+000032b0: 6f72 6c79 2064 7261 776e 2066 6163 652c  orly drawn face,
+000032c0: 2064 6566 6f72 6d65 642c 206d 6f73 6169   deformed, mosai
+000032d0: 632c 2061 7274 6966 6163 7473 2c20 6261  c, artifacts, ba
+000032e0: 6420 6c69 6d62 7322 0a69 6d61 6765 203d  d limbs".image =
+000032f0: 2070 6970 6528 7072 6f6d 7074 2c20 6865   pipe(prompt, he
+00003300: 6967 6874 3d31 3032 342c 2077 6964 7468  ight=1024, width
+00003310: 3d31 3032 342c 2065 7461 3d31 2e30 2c20  =1024, eta=1.0, 
+00003320: 6e65 6761 7469 7665 5f70 726f 6d70 743d  negative_prompt=
+00003330: 6e65 6761 7469 7665 5f70 726f 6d70 7429  negative_prompt)
+00003340: 2e69 6d61 6765 735b 305d 0a0a 696d 6167  .images[0]..imag
+00003350: 652e 7361 7665 2822 2e2f 6d61 6769 6361  e.save("./magica
+00003360: 6c5f 7072 696e 6365 7373 2e6a 7067 2229  l_princess.jpg")
+00003370: 0a60 6060 0a3c 6465 7461 696c 733e 0a3c  .```.<details>.<
+00003380: 7375 6d6d 6172 793e 4f75 7470 7574 3a3c  summary>Output:<
+00003390: 2f73 756d 6d61 7279 3e0a 3c64 6976 2061  /summary>.<div a
+000033a0: 6c69 676e 3d22 6365 6e74 6572 223e 0a20  lign="center">. 
+000033b0: 203c 696d 6720 7372 633d 2261 7373 6574   <img src="asset
+000033c0: 732f 6768 6962 6c69 5f64 6966 6675 7369  s/ghibli_diffusi
+000033d0: 6f6e 2e6a 7067 2220 7769 6474 683d 2238  on.jpg" width="8
+000033e0: 3030 2220 3e3c 2f69 6d67 3e0a 3c2f 6469  00" ></img>.</di
+000033f0: 763e 0a3c 2f64 6574 6169 6c73 3e0a 0a23  v>.</details>..#
+00003400: 2323 2050 6c61 7967 726f 756e 640a 6060  ## Playground.``
+00003410: 6070 7974 686f 6e0a 6672 6f6d 2064 6966  `python.from dif
+00003420: 6675 7365 7273 2069 6d70 6f72 7420 4469  fusers import Di
+00003430: 6666 7573 696f 6e50 6970 656c 696e 650a  ffusionPipeline.
+00003440: 696d 706f 7274 2074 6f72 6368 0a66 726f  import torch.fro
+00003450: 6d20 6869 6469 6666 7573 696f 6e20 696d  m hidiffusion im
+00003460: 706f 7274 2061 7070 6c79 5f68 6964 6966  port apply_hidif
+00003470: 6675 7369 6f6e 2c20 7265 6d6f 7665 5f68  fusion, remove_h
+00003480: 6964 6966 6675 7369 6f6e 0a0a 7069 7065  idiffusion..pipe
+00003490: 203d 2044 6966 6675 7369 6f6e 5069 7065   = DiffusionPipe
+000034a0: 6c69 6e65 2e66 726f 6d5f 7072 6574 7261  line.from_pretra
+000034b0: 696e 6564 280a 2020 2020 2270 6c61 7967  ined(.    "playg
+000034c0: 726f 756e 6461 692f 706c 6179 6772 6f75  roundai/playgrou
+000034d0: 6e64 2d76 322d 3130 3234 7078 2d61 6573  nd-v2-1024px-aes
+000034e0: 7468 6574 6963 222c 0a20 2020 2074 6f72  thetic",.    tor
+000034f0: 6368 5f64 7479 7065 3d74 6f72 6368 2e66  ch_dtype=torch.f
+00003500: 6c6f 6174 3136 2c0a 2020 2020 7573 655f  loat16,.    use_
+00003510: 7361 6665 7465 6e73 6f72 733d 5472 7565  safetensors=True
+00003520: 2c0a 2020 2020 6164 645f 7761 7465 726d  ,.    add_waterm
+00003530: 6172 6b65 723d 4661 6c73 652c 0a20 2020  arker=False,.   
+00003540: 2076 6172 6961 6e74 3d22 6670 3136 220a   variant="fp16".
+00003550: 290a 7069 7065 2e74 6f28 2263 7564 6122  ).pipe.to("cuda"
+00003560: 290a 7069 7065 2e65 6e61 626c 655f 7866  ).pipe.enable_xf
+00003570: 6f72 6d65 7273 5f6d 656d 6f72 795f 6566  ormers_memory_ef
+00003580: 6669 6369 656e 745f 6174 7465 6e74 696f  ficient_attentio
+00003590: 6e28 290a 0a23 2041 7070 6c79 2068 6964  n()..# Apply hid
+000035a0: 6966 6675 7369 6f6e 2077 6974 6820 6120  iffusion with a 
+000035b0: 7369 6e67 6c65 206c 696e 6520 6f66 2063  single line of c
+000035c0: 6f64 652e 0a61 7070 6c79 5f68 6964 6966  ode..apply_hidif
+000035d0: 6675 7369 6f6e 2870 6970 6529 0a0a 7072  fusion(pipe)..pr
+000035e0: 6f6d 7074 203d 2022 5468 6520 6c69 7474  ompt = "The litt
+000035f0: 6c65 2067 6972 6c20 7269 6469 6e67 2061  le girl riding a
+00003600: 2062 696b 652c 2069 6e20 6120 6265 6175   bike, in a beau
+00003610: 7469 6675 6c20 616e 696d 6520 7363 656e  tiful anime scen
+00003620: 6520 6279 2048 6179 616f 204d 6979 617a  e by Hayao Miyaz
+00003630: 616b 693a 2061 2073 6e6f 7779 2054 6f6b  aki: a snowy Tok
+00003640: 796f 2063 6974 7920 7769 7468 206d 6173  yo city with mas
+00003650: 7369 7665 204d 6979 617a 616b 6920 636c  sive Miyazaki cl
+00003660: 6f75 6473 2066 6c6f 6174 696e 6720 696e  ouds floating in
+00003670: 2074 6865 2062 6c75 6520 736b 792c 2065   the blue sky, e
+00003680: 6e63 6861 6e74 696e 6720 736e 6f77 7363  nchanting snowsc
+00003690: 6170 6573 206f 6620 7468 6520 6369 7479  apes of the city
+000036a0: 2077 6974 6820 6272 6967 6874 2073 756e   with bright sun
+000036b0: 6c69 6768 742c 204d 6979 617a 616b 6927  light, Miyazaki'
+000036c0: 7320 6c61 6e64 7363 6170 6520 696d 6167  s landscape imag
+000036d0: 6572 792c 204a 6170 616e 6573 6520 6172  ery, Japanese ar
+000036e0: 7422 0a6e 6567 6174 6976 655f 7072 6f6d  t".negative_prom
+000036f0: 7074 3d22 626c 7572 7279 2c20 7567 6c79  pt="blurry, ugly
+00003700: 2c20 6475 706c 6963 6174 652c 2070 6f6f  , duplicate, poo
+00003710: 726c 7920 6472 6177 6e2c 2064 6566 6f72  rly drawn, defor
+00003720: 6d65 642c 206d 6f73 6169 6322 0a69 6d61  med, mosaic".ima
+00003730: 6765 2020 3d20 7069 7065 2870 726f 6d70  ge  = pipe(promp
+00003740: 743d 7072 6f6d 7074 2c20 6775 6964 616e  t=prompt, guidan
+00003750: 6365 5f73 6361 6c65 3d33 2e30 2c20 6865  ce_scale=3.0, he
+00003760: 6967 6874 3d32 3034 382c 2077 6964 7468  ight=2048, width
+00003770: 3d32 3034 382c 206e 6567 6174 6976 655f  =2048, negative_
+00003780: 7072 6f6d 7074 3d6e 6567 6174 6976 655f  prompt=negative_
+00003790: 7072 6f6d 7074 292e 696d 6167 6573 5b30  prompt).images[0
+000037a0: 5d0a 696d 6167 652e 7361 7665 2827 6769  ].image.save('gi
+000037b0: 726c 2e6a 7067 2729 0a60 6060 0a3c 6465  rl.jpg').```.<de
+000037c0: 7461 696c 733e 0a3c 7375 6d6d 6172 793e  tails>.<summary>
+000037d0: 4f75 7470 7574 3a3c 2f73 756d 6d61 7279  Output:</summary
+000037e0: 3e0a 3c64 6976 2061 6c69 676e 3d22 6365  >.<div align="ce
+000037f0: 6e74 6572 223e 0a20 203c 696d 6720 7372  nter">.  <img sr
+00003800: 633d 2261 7373 6574 732f 706c 6179 6772  c="assets/playgr
+00003810: 6f75 6e64 5f72 6573 756c 742e 6a70 6722  ound_result.jpg"
+00003820: 2077 6964 7468 3d22 3830 3022 203e 3c2f   width="800" ></
+00003830: 696d 673e 0a3c 2f64 6976 3e0a 3c2f 6465  img>.</div>.</de
+00003840: 7461 696c 733e 0a0a 2323 20f0 9f99 8f20  tails>..## .... 
+00003850: 4163 6b6e 6f77 6c65 6467 656d 656e 7473  Acknowledgements
+00003860: 0a0a 5468 6973 2063 6f64 6562 6173 6520  ..This codebase 
+00003870: 6973 2062 6173 6564 206f 6e20 5b74 6f6d  is based on [tom
+00003880: 6573 645d 2868 7474 7073 3a2f 2f67 6974  esd](https://git
+00003890: 6875 622e 636f 6d2f 6462 6f6c 7961 2f74  hub.com/dbolya/t
+000038a0: 6f6d 6573 6429 2061 6e64 205b 6469 6666  omesd) and [diff
+000038b0: 7573 6572 735d 2868 7474 7073 3a2f 2f67  users](https://g
+000038c0: 6974 6875 622e 636f 6d2f 6875 6767 696e  ithub.com/huggin
+000038d0: 6766 6163 652f 6469 6666 7573 6572 732f  gface/diffusers/
+000038e0: 7472 6565 2f6d 6169 6e29 2e20 5468 616e  tree/main). Than
+000038f0: 6b73 210a 0a0a 0a23 2320 f09f 8e93 2043  ks!....## .... C
+00003900: 6974 6174 696f 6e0a 0a60 6060 0a40 6172  itation..```.@ar
+00003910: 7469 636c 657b 7a68 616e 6732 3032 3368  ticle{zhang2023h
+00003920: 6964 6966 6675 7369 6f6e 2c0a 2020 7469  idiffusion,.  ti
+00003930: 746c 653d 7b48 6944 6966 6675 7369 6f6e  tle={HiDiffusion
+00003940: 3a20 556e 6c6f 636b 696e 6720 4869 6768  : Unlocking High
+00003950: 6572 2d52 6573 6f6c 7574 696f 6e20 4372  er-Resolution Cr
+00003960: 6561 7469 7669 7479 2061 6e64 2045 6666  eativity and Eff
+00003970: 6963 6965 6e63 7920 696e 2050 7265 7472  iciency in Pretr
+00003980: 6169 6e65 6420 4469 6666 7573 696f 6e20  ained Diffusion 
+00003990: 4d6f 6465 6c73 7d2c 0a20 2061 7574 686f  Models},.  autho
+000039a0: 723d 7b5a 6861 6e67 2c20 5368 656e 2061  r={Zhang, Shen a
+000039b0: 6e64 2043 6865 6e2c 205a 6861 6f77 6569  nd Chen, Zhaowei
+000039c0: 2061 6e64 205a 6861 6f2c 205a 6865 6e79   and Zhao, Zheny
+000039d0: 7520 616e 6420 4368 656e 2c20 5975 6861  u and Chen, Yuha
+000039e0: 6f20 616e 6420 5461 6e67 2c20 5961 6f20  o and Tang, Yao 
+000039f0: 616e 6420 4c69 616e 672c 204a 6961 6a75  and Liang, Jiaju
+00003a00: 6e7d 2c0a 2020 6a6f 7572 6e61 6c3d 7b61  n},.  journal={a
+00003a10: 7258 6976 2070 7265 7072 696e 7420 6172  rXiv preprint ar
+00003a20: 5869 763a 3233 3131 2e31 3735 3238 7d2c  Xiv:2311.17528},
+00003a30: 0a20 2079 6561 723d 7b32 3032 337d 0a7d  .  year={2023}.}
+00003a40: 0a60 6060 0a                             .```.
```

