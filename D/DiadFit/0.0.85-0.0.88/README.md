# Comparing `tmp/DiadFit-0.0.85.tar.gz` & `tmp/DiadFit-0.0.88.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "DiadFit-0.0.85.tar", last modified: Thu Mar 21 04:10:11 2024, max compression
+gzip compressed data, was "DiadFit-0.0.88.tar", last modified: Mon Apr 15 22:28:27 2024, max compression
```

## Comparing `DiadFit-0.0.85.tar` & `DiadFit-0.0.88.tar`

### file list

```diff
@@ -1,51 +1,59 @@
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-21 04:10:11.673197 DiadFit-0.0.85/
--rw-r--r--   0 runner    (1001) docker     (127)     1040 2024-03-21 04:10:11.673197 DiadFit-0.0.85/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (127)      600 2024-03-21 04:09:58.000000 DiadFit-0.0.85/README.md
--rw-r--r--   0 runner    (1001) docker     (127)       38 2024-03-21 04:10:11.673197 DiadFit-0.0.85/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (127)     1227 2024-03-21 04:10:02.000000 DiadFit-0.0.85/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-21 04:10:11.657197 DiadFit-0.0.85/src/
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-21 04:10:11.669197 DiadFit-0.0.85/src/DiadFit/
--rw-r--r--   0 runner    (1001) docker     (127)    28050 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/CO2_EOS.py
--rw-r--r--   0 runner    (1001) docker     (127)    44011 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/CO2_H2O_EOS.py
--rw-r--r--   0 runner    (1001) docker     (127)    15135 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/CO2_in_bubble_error.py
--rw-r--r--   0 runner    (1001) docker     (127)    43888 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/H2O_fitting.py
--rw-r--r--   0 runner    (1001) docker     (127)     1213 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Highrho_polyfit_data.pkl
--rw-r--r--   0 runner    (1001) docker     (127)     1213 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Highrho_polyfit_dataUCB_1117_1400.pkl
--rw-r--r--   0 runner    (1001) docker     (127)     1213 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Highrho_polyfit_dataUCB_1220_1400.pkl
--rw-r--r--   0 runner    (1001) docker     (127)     1213 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Highrho_polyfit_dataUCB_1220_1447.pkl
--rw-r--r--   0 runner    (1001) docker     (127)      909 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Highrho_polyfit_data_CCMR.pkl
--rw-r--r--   0 runner    (1001) docker     (127)      829 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Highrho_polyfit_data_CMASS.pkl
--rw-r--r--   0 runner    (1001) docker     (127)      751 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Lowrho_polyfit_data.pkl
--rw-r--r--   0 runner    (1001) docker     (127)      751 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Lowrho_polyfit_dataUCB_1117_1400.pkl
--rw-r--r--   0 runner    (1001) docker     (127)      751 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Lowrho_polyfit_dataUCB_1220_1400.pkl
--rw-r--r--   0 runner    (1001) docker     (127)      751 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Lowrho_polyfit_dataUCB_1220_1447.pkl
--rw-r--r--   0 runner    (1001) docker     (127)     1141 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Lowrho_polyfit_data_CCMR.pkl
--rw-r--r--   0 runner    (1001) docker     (127)      997 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Lowrho_polyfit_data_CMASS.pkl
--rw-r--r--   0 runner    (1001) docker     (127)     1301 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Mediumrho_polyfit_data.pkl
--rw-r--r--   0 runner    (1001) docker     (127)     1301 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Mediumrho_polyfit_dataUCB_1117_1400.pkl
--rw-r--r--   0 runner    (1001) docker     (127)     1301 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Mediumrho_polyfit_dataUCB_1220_1400.pkl
--rw-r--r--   0 runner    (1001) docker     (127)     1301 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Mediumrho_polyfit_dataUCB_1220_1447.pkl
--rw-r--r--   0 runner    (1001) docker     (127)     1221 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Mediumrho_polyfit_data_CCMR.pkl
--rw-r--r--   0 runner    (1001) docker     (127)     1557 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Mediumrho_polyfit_data_CMASS.pkl
--rw-r--r--   0 runner    (1001) docker     (127)    10435 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/Psensor.py
--rw-r--r--   0 runner    (1001) docker     (127)     1181 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)      296 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/_version.py
--rw-r--r--   0 runner    (1001) docker     (127)     7675 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/argon_lines.py
--rw-r--r--   0 runner    (1001) docker     (127)    23634 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/cosmicray_filter.py
--rw-r--r--   0 runner    (1001) docker     (127)     8086 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/densimeter_fitting.py
--rw-r--r--   0 runner    (1001) docker     (127)    49419 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/densimeters.py
--rw-r--r--   0 runner    (1001) docker     (127)    16983 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/density_depth_crustal_profiles.py
--rw-r--r--   0 runner    (1001) docker     (127)   176163 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/diads.py
--rw-r--r--   0 runner    (1001) docker     (127)    41533 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/error_propagation.py
--rw-r--r--   0 runner    (1001) docker     (127)    39312 2024-03-21 04:10:02.000000 DiadFit-0.0.85/src/DiadFit/importing_data_files.py
--rw-r--r--   0 runner    (1001) docker     (127)  2946857 2024-03-21 04:10:03.000000 DiadFit-0.0.85/src/DiadFit/lookup_table.csv
--rw-r--r--   0 runner    (1001) docker     (127)  3330249 2024-03-21 04:10:03.000000 DiadFit-0.0.85/src/DiadFit/lookup_table_noneg.csv
--rw-r--r--   0 runner    (1001) docker     (127)     3389 2024-03-21 04:10:03.000000 DiadFit-0.0.85/src/DiadFit/molar_gas_proportions.py
--rw-r--r--   0 runner    (1001) docker     (127)    62563 2024-03-21 04:10:03.000000 DiadFit-0.0.85/src/DiadFit/ne_lines.py
--rw-r--r--   0 runner    (1001) docker     (127)    31549 2024-03-21 04:10:03.000000 DiadFit-0.0.85/src/DiadFit/relaxifi.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-21 04:10:11.673197 DiadFit-0.0.85/src/DiadFit.egg-info/
--rw-r--r--   0 runner    (1001) docker     (127)     1040 2024-03-21 04:10:11.000000 DiadFit-0.0.85/src/DiadFit.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (127)     1602 2024-03-21 04:10:11.000000 DiadFit-0.0.85/src/DiadFit.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (127)        1 2024-03-21 04:10:11.000000 DiadFit-0.0.85/src/DiadFit.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (127)       75 2024-03-21 04:10:11.000000 DiadFit-0.0.85/src/DiadFit.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (127)        8 2024-03-21 04:10:11.000000 DiadFit-0.0.85/src/DiadFit.egg-info/top_level.txt
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-15 22:28:27.810338 DiadFit-0.0.88/
+-rw-r--r--   0 runner    (1001) docker     (127)     1040 2024-04-15 22:28:27.810338 DiadFit-0.0.88/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (127)      600 2024-04-15 22:28:10.000000 DiadFit-0.0.88/README.md
+-rw-r--r--   0 runner    (1001) docker     (127)       38 2024-04-15 22:28:27.810338 DiadFit-0.0.88/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (127)     1227 2024-04-15 22:28:14.000000 DiadFit-0.0.88/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-15 22:28:27.794338 DiadFit-0.0.88/src/
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-15 22:28:27.810338 DiadFit-0.0.88/src/DiadFit/
+-rw-r--r--   0 runner    (1001) docker     (127)    28050 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/CO2_EOS.py
+-rw-r--r--   0 runner    (1001) docker     (127)    44011 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/CO2_H2O_EOS.py
+-rw-r--r--   0 runner    (1001) docker     (127)    19769 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/CO2_in_bubble_error.py
+-rw-r--r--   0 runner    (1001) docker     (127)    43888 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/H2O_fitting.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1213 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Highrho_polyfit_data.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1213 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Highrho_polyfit_dataUCB_1117_1400.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1213 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Highrho_polyfit_dataUCB_1117_1447.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1213 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Highrho_polyfit_dataUCB_1220_1400.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1213 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Highrho_polyfit_dataUCB_1220_1447.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1213 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Highrho_polyfit_dataUCB_1220_1567.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)      909 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Highrho_polyfit_data_CCMR.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)      829 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Highrho_polyfit_data_CMASS.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1757 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Highrho_polyfit_data_CMASS_24C.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)      751 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Lowrho_polyfit_data.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)      751 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Lowrho_polyfit_dataUCB_1117_1400.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)      751 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Lowrho_polyfit_dataUCB_1117_1447.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)      751 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Lowrho_polyfit_dataUCB_1220_1400.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)      751 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Lowrho_polyfit_dataUCB_1220_1447.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)      751 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Lowrho_polyfit_dataUCB_1220_1567.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1141 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Lowrho_polyfit_data_CCMR.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)      997 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Lowrho_polyfit_data_CMASS.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1045 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Lowrho_polyfit_data_CMASS_24C.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1301 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Mediumrho_polyfit_data.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1301 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Mediumrho_polyfit_dataUCB_1117_1400.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1301 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Mediumrho_polyfit_dataUCB_1117_1447.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1301 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Mediumrho_polyfit_dataUCB_1220_1400.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1301 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Mediumrho_polyfit_dataUCB_1220_1447.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1301 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Mediumrho_polyfit_dataUCB_1220_1567.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1221 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Mediumrho_polyfit_data_CCMR.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)     1557 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Mediumrho_polyfit_data_CMASS.pkl
+-rw-r--r--   0 runner    (1001) docker     (127)    10435 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/Psensor.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1181 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)      296 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/_version.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7675 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/argon_lines.py
+-rw-r--r--   0 runner    (1001) docker     (127)    23634 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/cosmicray_filter.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8247 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/densimeter_fitting.py
+-rw-r--r--   0 runner    (1001) docker     (127)    54757 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/densimeters.py
+-rw-r--r--   0 runner    (1001) docker     (127)    17761 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/density_depth_crustal_profiles.py
+-rw-r--r--   0 runner    (1001) docker     (127)   176620 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/diads.py
+-rw-r--r--   0 runner    (1001) docker     (127)    39129 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/error_propagation.py
+-rw-r--r--   0 runner    (1001) docker     (127)    41961 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/importing_data_files.py
+-rw-r--r--   0 runner    (1001) docker     (127)  2946857 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/lookup_table.csv
+-rw-r--r--   0 runner    (1001) docker     (127)  3330249 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/lookup_table_noneg.csv
+-rw-r--r--   0 runner    (1001) docker     (127)     3389 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/molar_gas_proportions.py
+-rw-r--r--   0 runner    (1001) docker     (127)    63811 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/ne_lines.py
+-rw-r--r--   0 runner    (1001) docker     (127)    31549 2024-04-15 22:28:14.000000 DiadFit-0.0.88/src/DiadFit/relaxifi.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-15 22:28:27.810338 DiadFit-0.0.88/src/DiadFit.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (127)     1040 2024-04-15 22:28:27.000000 DiadFit-0.0.88/src/DiadFit.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (127)     1997 2024-04-15 22:28:27.000000 DiadFit-0.0.88/src/DiadFit.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (127)        1 2024-04-15 22:28:27.000000 DiadFit-0.0.88/src/DiadFit.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (127)       75 2024-04-15 22:28:27.000000 DiadFit-0.0.88/src/DiadFit.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (127)        8 2024-04-15 22:28:27.000000 DiadFit-0.0.88/src/DiadFit.egg-info/top_level.txt
```

### Comparing `DiadFit-0.0.85/PKG-INFO` & `DiadFit-0.0.88/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: DiadFit
-Version: 0.0.85
+Version: 0.0.88
 Summary: DiadFit
 Home-page: https://github.com/PennyWieser/DiadFit
 Author: Penny Wieser
 Author-email: penny.wieser@gmail.com
 License: UNKNOWN
 Description: [![PyPI](https://badgen.net/pypi/v/DiadFit)](https://pypi.org/project/DiadFit/)
         [![Build Status](https://github.com/PennyWieser/DiadFit/actions/workflows/main.yml/badge.svg?branch=main)](https://github.com/PennyWieser/DiadFit/actions/workflows/main.yml)
```

### Comparing `DiadFit-0.0.85/README.md` & `DiadFit-0.0.88/README.md`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/setup.py` & `DiadFit-0.0.88/setup.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/CO2_EOS.py` & `DiadFit-0.0.88/src/DiadFit/CO2_EOS.py`

 * *Files 0% similar despite different names*

```diff
@@ -825,15 +825,15 @@
 def calculate_SP19942(T_K, target_pressure_MPa):
     """ This function Solves for CO2 density for a given temp and pressure using the objective and minimise functions above.
     """
     if isinstance(target_pressure_MPa, float) or isinstance(target_pressure_MPa, int):
         target_p=np.array(target_pressure_MPa)
         Density=calculate_Density_Sterner_Pitzer_1994(T_K=T_K, target_pressure_MPa=target_p)
     else:
-        Density=np.empty(len(target_pressure_MPa))
+        Density=np.zeros(len(target_pressure_MPa))
         for i in range(0, len(target_pressure_MPa)):
             Density[i]=calculate_Density_Sterner_Pitzer_1994(T_K=T_K, target_pressure_MPa=target_pressure_MPa[i])
     return Density
 
 # Lets do the same to solve for tempreature here
 
 
@@ -856,15 +856,15 @@
 def calculate_SP1994_Temp(CO2_dens_gcm3, target_pressure_MPa):
     """ This function Solves for Temp for a given CO2 density and pressure using the objective and minimise functions above.
     """
     if isinstance(target_pressure_MPa, float) or isinstance(target_pressure_MPa, int):
         target_p=np.array(target_pressure_MPa)
         Density=calculate_Temp_Sterner_Pitzer_1994(CO2_dens_gcm3=CO2_dens_gcm3, target_pressure_MPa=target_p)
     else:
-        Density=np.empty(len(target_pressure_MPa))
+        Density=np.zeros(len(target_pressure_MPa))
         for i in range(0, len(target_pressure_MPa)):
             Density[i]=calculate_Temp_Sterner_Pitzer_1994(CO2_dens_gcm3=CO2_dens_gcm3, target_pressure_MPa=target_pressure_MPa[i])
     return Density
```

### Comparing `DiadFit-0.0.85/src/DiadFit/CO2_H2O_EOS.py` & `DiadFit-0.0.88/src/DiadFit/CO2_H2O_EOS.py`

 * *Files 1% similar despite different names*

```diff
@@ -921,15 +921,15 @@
 
     # Check all the same length
     lengths = [len(P_kbar), len(T_K), len(XH2O)]
     if len(set(lengths)) != 1:
         raise ValueError("All input Pandas Series must have the same length.")
 
     # Set up loop
-    mol_vol=np.empty(len(P_kbar), float)
+    mol_vol=np.zeros(len(P_kbar), float)
 
     for i in range(0, len(P_kbar)):
         mol_vol[i]=calculate_molar_volume_ind_DZ2006(P_kbar=P_kbar.iloc[i].astype(float), T_K=T_K.iloc[i].astype(float), XH2O=XH2O.iloc[i].astype(float))
 
 
 
 
@@ -995,15 +995,15 @@
 
     # Check all the same length
     lengths = [len(mol_vol), len(T_K), len(XH2O)]
     if len(set(lengths)) != 1:
         raise ValueError("All input Pandas Series must have the same length.")
 
     # Set up loop
-    P=np.empty(len(mol_vol), float)
+    P=np.zeros(len(mol_vol), float)
 
     for i in range(0, len(mol_vol)):
         P[i]=calculate_Pressure_ind_DZ2006(mol_vol=mol_vol.iloc[i].astype(float), T_K=T_K.iloc[i].astype(float), XH2O=XH2O.iloc[i].astype(float))
 
 
 
     return P
@@ -1021,20 +1021,20 @@
 
 
     #Check all the same length
     lengths = [len(P_kbar), len(T_K), len(XH2O), len(Vmix)]
     if len(set(lengths)) != 1:
         raise ValueError("All input Pandas Series must have the same length.")
 
-    f=np.empty(len(P_kbar), float)
-    a_CO2=np.empty(len(P_kbar), float)
-    a_H2O=np.empty(len(P_kbar), float)
-    f_CO2=np.empty(len(P_kbar), float)
-    f_H2O=np.empty(len(P_kbar), float)
-    Zmix=np.empty(len(P_kbar), float)
+    f=np.zeros(len(P_kbar), float)
+    a_CO2=np.zeros(len(P_kbar), float)
+    a_H2O=np.zeros(len(P_kbar), float)
+    f_CO2=np.zeros(len(P_kbar), float)
+    f_H2O=np.zeros(len(P_kbar), float)
+    Zmix=np.zeros(len(P_kbar), float)
     for i in range(0, len(P_kbar)):
 
         f_H2O[i], f_CO2[i], a_H2O[i], a_CO2[i], Zmix[i]=mix_fugacity_ind(P_kbar=P_kbar.iloc[i].astype(float), T_K=T_K.iloc[i].astype(float), XH2O=XH2O.iloc[i].astype(float), Vmix=Vmix.iloc[i].astype(float))
 
     return f_H2O, f_CO2, a_H2O,a_CO2,  Zmix
```

### Comparing `DiadFit-0.0.85/src/DiadFit/CO2_in_bubble_error.py` & `DiadFit-0.0.88/src/DiadFit/CO2_in_bubble_error.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,15 +1,27 @@
 import numpy as np
 import pandas as pd
 import matplotlib.pyplot as plt
 
+# Lets use a generic function for getting a panda series value or not.
+
+def get_value(variable, i):
+    """ This function returns the value if its not a series, otherwise returns the right row in the series
+    """
+    if isinstance(variable, pd.Series):
+        return variable.iloc[i]
+    else:
+        return variable
+
+const=(4/3)*np.pi
 
 def propagate_CO2_in_bubble(*, N_dup=1000, sample_ID, vol_perc_bub=None, error_vol_perc_bub=None, error_type_vol_perc_bub='Abs',
 MI_x=None, MI_y=None,MI_z=None,VB_x=None, VB_y=None,VB_z=None,
-
+error_MI_x=None, error_MI_y=None,error_MI_z=None,error_VB_x=None, error_VB_y=None, error_VB_z=None,
+error_type_dimension='Abs', error_dist_dimension='normal',
 melt_dens_kgm3, CO2_bub_dens_gcm3,
  error_dist_vol_perc_bub='normal',
 error_CO2_bub_dens_gcm3=0, error_type_CO2_bub_dens_gcm3='Abs', error_dist_CO2_bub_dens_gcm3='normal',
 error_melt_dens_kgm3=0, error_type_melt_dens_kgm3='Abs', error_dist_melt_dens_kgm3='normal',
 plot_figure=True, fig_i=0, neg_values=True):
 
 
@@ -41,15 +53,19 @@
 
     MI_x, MI_y, MI_Z, VB_x, VB_y, VB_Z: int, float, pd.Series
         x, y, z dimensions of vapour bubble and melt inclusion
 
     error_MI_x, error_MI_y, error_MI_Z, error_VB_x, error_VB_y, error_VB_Z: int, float, pd.Series
         Error on x, y, z dimension meausurement
 
+    error_type_dimension: 'Abs' or 'Perc'
+        Whether errors on all x-y-z are perc or abs
 
+    error_dist_dimension: 'normal' or 'uniform'
+        Whether errors on all x-y-z are normally or uniformly distributed.
 
 
     melt_dens_kgm3:int, float, pd.series
         Density of the silicate melt in kg/m3, e.g. from DensityX
 
     CO2_bub_dens_gcm3: int, float, pd.Series
         Density of the vapour bubble in g/cm3
@@ -69,115 +85,132 @@
     ------------------
     pd.DataFrame: df_step, All_outputs
         All outputs has calculations for every simulaiton
         df_step has average and standard deviation for each sample
 
     """
     # Constant for sphere calcs
-    const=(4/3)*np.pi
-     # Lets check what they entered for volume
+
+     # Lets check what they entered for volume - if they didnt enter a volume % Bubble, lets calculate it
     if vol_perc_bub is None:
         Vol_VB_sphere=const*VB_x*VB_y*VB_z
         Vol_MI_sphere=const*MI_x*MI_y*MI_z
-        # Assume its an octahedral
-        vol_MI_oct=(MI_x*MI_y_MI_z)/6
-        print('still in progress, ask Penny if you need this')
+        vol_perc_bub=100* Vol_VB_sphere/Vol_MI_sphere
+
+    # Now lets check how they entered error in volume
+    if not ((error_vol_perc_bub is not None and all(v is None for v in [error_MI_x, error_MI_y, error_MI_z, error_VB_x, error_VB_y, error_VB_z])) or (error_vol_perc_bub is None and all(v is not None for v in [error_MI_x, error_MI_y, error_MI_z, error_VB_x, error_VB_y, error_VB_z]))):
+            raise ValueError('Specify either error_vol_perc_bub or non-None values for all of error_MI_x, error_MI_y, error_MI_z, error_VB_x, error_VB_y, and error_VB_z.')
+
 
-    # Set up empty things to fill up.
 
+
+    # Set up empty things to fill up.
     if type(vol_perc_bub) is pd.Series:
         len_loop=len(vol_perc_bub)
 
     else:
         len_loop=1
 
 
 
-    mean_CO2_eq_melt = np.empty(len_loop, dtype=float)
-    mean_CO2_eq_melt_ind = np.empty(len_loop, dtype=float)
-    med_CO2_eq_melt  = np.empty(len_loop, dtype=float)
-    std_CO2_eq_melt  = np.empty(len_loop, dtype=float)
-    preferred_val_CO2_melt= np.empty(len_loop, dtype=float)
-    std_IQR_CO2_eq_melt= np.empty(len_loop, dtype=float)
-    Sample=np.empty(len_loop,  dtype=np.dtype('U100') )
+    mean_CO2_eq_melt = np.zeros(len_loop, dtype=float)
+    mean_CO2_eq_melt_ind = np.zeros(len_loop, dtype=float)
+    med_CO2_eq_melt  = np.zeros(len_loop, dtype=float)
+    std_CO2_eq_melt  = np.zeros(len_loop, dtype=float)
+    preferred_val_CO2_melt= np.zeros(len_loop, dtype=float)
+    std_IQR_CO2_eq_melt= np.zeros(len_loop, dtype=float)
+    Q84= np.zeros(len_loop, dtype=float)
+    Q16= np.zeros(len_loop, dtype=float)
+    Sample=np.zeros(len_loop,  dtype=np.dtype('U100') )
 
 
     All_outputs=pd.DataFrame([])
 
 
+
+
     #This loops through each sample
     for i in range(0, len_loop):
         if i % 20 == 0:
             print('working on sample number '+str(i))
 
 
         # If user has entered a pandas series for error, takes right one for each loop
         # vol_perc_bub % and error
 
-        # Checking volume right format
-        if type(vol_perc_bub) is pd.Series:
-            vol_perc_bub_i=vol_perc_bub.iloc[i]
-        else:
-            vol_perc_bub_i=vol_perc_bub
+        # Checking volume right format, if panda series or integer
+        vol_perc_bub_i=get_value(vol_perc_bub, i)
+        error_vol_perc_bub_i=get_value(error_vol_perc_bub, i)
 
+        CO2_bub_dens_gcm3_i=get_value(CO2_bub_dens_gcm3, i)
+        error_CO2_bub_dens_gcm3_i=get_value(error_CO2_bub_dens_gcm3, i)
 
-        if type(error_vol_perc_bub) is pd.Series:
-            error_vol_perc_bub_i=error_vol_perc_bub.iloc[i]
-        else:
-            error_vol_perc_bub_i=error_vol_perc_bub
+        melt_dens_kgm3_i=get_value(melt_dens_kgm3, i)
+        error_melt_dens_kgm3_i=get_value(error_melt_dens_kgm3, i)
 
-        # Checking bubble dens right form
 
-        if type(CO2_bub_dens_gcm3) is pd.Series:
-            CO2_bub_dens_gcm3_i=CO2_bub_dens_gcm3.iloc[i]
-        else:
-            CO2_bub_dens_gcm3_i=CO2_bub_dens_gcm3
 
-        # Checking melt density
 
-        if type(error_CO2_bub_dens_gcm3) is pd.Series:
-            error_CO2_bub_dens_gcm3_i=error_CO2_bub_dens_gcm3.iloc[i]
-        else:
-            error_CO2_bub_dens_gcm3_i=error_CO2_bub_dens_gcm3
-
-        # Checking melt density
-
-
-        if type(melt_dens_kgm3) is pd.Series:
-            melt_dens_kgm3_i=melt_dens_kgm3.iloc[i]
-        else:
-            melt_dens_kgm3_i=melt_dens_kgm3
+        # This is the function doing the work to actually make the simulations for each variable.
+        if error_vol_perc_bub is not None:
 
+            df_synthetic=propagate_CO2_in_bubble_ind(
+    N_dup=N_dup,
+    vol_perc_bub=vol_perc_bub_i,
+    melt_dens_kgm3=melt_dens_kgm3_i,
+    CO2_bub_dens_gcm3=CO2_bub_dens_gcm3_i,
+    error_CO2_bub_dens_gcm3=error_CO2_bub_dens_gcm3_i,
+    error_type_CO2_bub_dens_gcm3=error_type_CO2_bub_dens_gcm3,
+    error_dist_CO2_bub_dens_gcm3=error_dist_CO2_bub_dens_gcm3,
+    error_vol_perc_bub=error_vol_perc_bub_i,
+    error_type_vol_perc_bub=error_type_vol_perc_bub,
+    error_dist_vol_perc_bub=error_dist_vol_perc_bub,
+    error_melt_dens_kgm3=error_melt_dens_kgm3_i,
+    error_type_melt_dens_kgm3=error_type_melt_dens_kgm3,
+    error_dist_melt_dens_kgm3=error_dist_melt_dens_kgm3,
+    len_loop=1, neg_values=neg_values)
 
-        if type(error_melt_dens_kgm3) is pd.Series:
-            error_melt_dens_kgm3_i=error_melt_dens_kgm3.iloc[i]
         else:
-            error_melt_dens_kgm3_i=error_melt_dens_kgm3
 
+            # This is the more complex one where we have to account for x-y-z errors on all of them.
+            MI_x_i = get_value(MI_x, i)
+            MI_y_i = get_value(MI_y, i)
+            MI_z_i = get_value(MI_z, i)
+            VB_x_i = get_value(VB_x, i)
+            VB_y_i = get_value(VB_y, i)
+            VB_z_i = get_value(VB_z, i)
+
+            error_MI_x_i = get_value(error_MI_x, i)
+            error_MI_y_i = get_value(error_MI_y, i)
+            error_MI_z_i = get_value(error_MI_z, i)
+            error_VB_x_i = get_value(error_VB_x, i)
+            error_VB_y_i = get_value(error_VB_y, i)
+            error_VB_z_i = get_value(error_VB_z, i)
 
 
 
+            df_synthetic=propagate_CO2_in_bubble_ind(
+    N_dup=N_dup,
+    vol_perc_bub=vol_perc_bub_i,
+    melt_dens_kgm3=melt_dens_kgm3_i,
+    CO2_bub_dens_gcm3=CO2_bub_dens_gcm3_i,
+    error_CO2_bub_dens_gcm3=error_CO2_bub_dens_gcm3_i,
+    error_type_CO2_bub_dens_gcm3=error_type_CO2_bub_dens_gcm3,
+    error_dist_CO2_bub_dens_gcm3=error_dist_CO2_bub_dens_gcm3,
+    error_vol_perc_bub=None,
+MI_x=MI_x_i, MI_y=MI_y_i,MI_z=MI_z_i,VB_x=VB_x_i, VB_y=VB_y_i,VB_z=VB_z_i,
+error_MI_x=error_MI_x_i, error_MI_y=error_MI_y_i,error_MI_z=error_MI_z_i,
+error_VB_x=error_VB_x_i, error_VB_y=error_VB_y_i, error_VB_z=error_VB_z_i,
+error_type_dimension=error_type_dimension, error_dist_dimension=error_dist_dimension,
+    error_melt_dens_kgm3=error_melt_dens_kgm3_i,
+    error_type_melt_dens_kgm3=error_type_melt_dens_kgm3,
+    error_dist_melt_dens_kgm3=error_dist_melt_dens_kgm3,
+    len_loop=1, neg_values=neg_values)
 
 
-        # This is the function doing the work to actually make the simulations for each variable.
-        df_synthetic=propagate_CO2_in_bubble_ind(
-N_dup=N_dup,
-vol_perc_bub=vol_perc_bub_i,
-melt_dens_kgm3=melt_dens_kgm3_i,
-CO2_bub_dens_gcm3=CO2_bub_dens_gcm3_i,
-error_CO2_bub_dens_gcm3=error_CO2_bub_dens_gcm3_i,
-error_type_CO2_bub_dens_gcm3=error_type_CO2_bub_dens_gcm3,
- error_dist_CO2_bub_dens_gcm3=error_dist_CO2_bub_dens_gcm3,
-error_vol_perc_bub=error_vol_perc_bub_i,
-error_type_vol_perc_bub=error_type_vol_perc_bub,
-error_dist_vol_perc_bub=error_dist_vol_perc_bub,
-error_melt_dens_kgm3=error_melt_dens_kgm3_i,
-error_type_melt_dens_kgm3=error_type_melt_dens_kgm3,
-error_dist_melt_dens_kgm3=error_dist_melt_dens_kgm3,
- len_loop=1, neg_values=neg_values)
 
 
         # Convert to densities for MC
 
 
 
         df=df_synthetic
@@ -206,31 +239,37 @@
 
         All_outputs=pd.concat([All_outputs, df], axis=0)
 
         mean_CO2_eq_melt[i]=np.nanmean(df['CO2_eq_melt_ppm_MC'])
         med_CO2_eq_melt[i]=np.nanmedian(df['CO2_eq_melt_ppm_MC'])
         std_CO2_eq_melt[i]=np.nanstd(df['CO2_eq_melt_ppm_MC'])
         var=df['CO2_eq_melt_ppm_MC']
+        Q16[i]=np.percentile(var, 16)
+        Q84[i]=np.percentile(var, 84)
         std_IQR_CO2_eq_melt[i]=0.5*np.abs((np.percentile(var, 84) -np.percentile(var, 16)))
 
-        preferred_val_CO2_melt[i]=np.nanmean(df['CO2_eq_melt_ppm_noMC'])
 
 
-        mean_CO2_eq_melt_ind[i]=df['CO2_eq_melt_ppm_noMC'].iloc[0]
+        # Values all the same, so can just take the 1st.
+        preferred_val_CO2_melt[i]=df['CO2_eq_melt_ppm_noMC'].iloc[0]
+
+
 
 
 
 
 
     df_step=pd.DataFrame(data={'Filename': Sample,
 
                         'CO2_eq_in_melt_noMC': preferred_val_CO2_melt,
                         'mean_MC_CO2_equiv_melt_ppm': mean_CO2_eq_melt,
                         'med_MC_CO2_equiv_melt_ppm': med_CO2_eq_melt,
-                        'std_MC_CO2_equiv_melt_ppm': std_IQR_CO2_eq_melt,
+                        'std_MC_IQR_CO2_equiv_melt_ppm': std_IQR_CO2_eq_melt,
+                        '16th_quantile_melt_ppm': Q16,
+                        '84th_quantile_melt_ppm': Q84,
 
 
 
                          })
 
 
 
@@ -258,20 +297,51 @@
         ax4.plot([all_sims['CO2_eq_melt_ppm_noMC'].iloc[0]-np.std(all_sims['CO2_eq_melt_ppm_MC']), 	all_sims['CO2_eq_melt_ppm_noMC'].iloc[0]-np.std(all_sims['CO2_eq_melt_ppm_MC'])], [0, N_dup/20], ':k', label='Preferred-value+1s MC');
         ax4.legend()
 
     return df_step, All_outputs, fig if 'fig' in locals() else None
 
 
 
+def add_noise_to_variable(original_value, error, error_type, error_dist, N_dup, neg_values, neg_threshold):
+        """ This function adds noise to each variable for the monte-carloing
+
+        """
+
+        #  Depending on the error type, allocates an error
+        if error_type == 'Abs':
+            calculated_error = error
+        elif error_type == 'Perc':
+            calculated_error = original_value * error / 100
+
+        # Generates noise following a distribution
+        if error_dist == 'normal':
+            noise_to_add = np.random.normal(0, calculated_error, N_dup)
+        elif error_dist == 'uniform':
+            noise_to_add = np.random.uniform(-calculated_error, calculated_error, N_dup)
+
+        # adds this noise to original value
+        value_with_noise = noise_to_add + original_value
+
+        if not neg_values:
+            value_with_noise[value_with_noise < neg_threshold] = neg_threshold
+
+        return value_with_noise
+
+
+
+
 
 
 
 def propagate_CO2_in_bubble_ind(sample_i=0,  N_dup=1000, vol_perc_bub=None,
 CO2_bub_dens_gcm3=None, melt_dens_kgm3=None,
-error_vol_perc_bub=0, error_type_vol_perc_bub='Abs', error_dist_vol_perc_bub='normal',
+MI_x=None, MI_y=None,MI_z=None,VB_x=None, VB_y=None,VB_z=None,
+error_MI_x=None, error_MI_y=None,error_MI_z=None,error_VB_x=None, error_VB_y=None, error_VB_z=None,
+error_type_dimension='Abs', error_dist_dimension='normal',
+error_vol_perc_bub=None, error_type_vol_perc_bub='Abs', error_dist_vol_perc_bub='normal',
 error_CO2_bub_dens_gcm3=0, error_type_CO2_bub_dens_gcm3='Abs', error_dist_CO2_bub_dens_gcm3='normal',
 error_melt_dens_kgm3=0, error_type_melt_dens_kgm3='Abs', error_dist_melt_dens_kgm3='normal', len_loop=1, neg_values=True):
 
     """ This function propagates uncertainty in reconstruction of melt inclusion bubble equivalent CO2 contents.
     and returns a dataframe. it does one sample at a time.
 
     Parameters
@@ -320,15 +390,15 @@
         Input variable duplicated N_dup times with noise added.
 
 
 
 
     """
 
-
+    # If only a single sample, set up an output dataframe with an index.
     if len_loop==1:
         df_c=pd.DataFrame(data={
                             'vol_perc_bub': vol_perc_bub,
                             'CO2_bub_dens_gcm3': CO2_bub_dens_gcm3,
                             'melt_dens_kgm3': melt_dens_kgm3 }, index=[0])
     else:
         df_c=pd.DataFrame(data={
@@ -336,86 +406,94 @@
                             'CO2_bub_dens_gcm3': CO2_bub_dens_gcm3,
                             'melt_dens_kgm3': melt_dens_kgm3})
 
 
 
 
 
-    # Volume error distribution
+    # Volume error distribution - if they give a volume percentage rather than dimensions
+    if error_vol_perc_bub is not None:
+        # Easy peasy
+        Vol_with_noise=add_noise_to_variable(vol_perc_bub, error_vol_perc_bub,
+        error_type_vol_perc_bub, error_dist_vol_perc_bub,  N_dup, neg_values, neg_threshold=0.0000000001)
+
+    else:
+        x_MI_with_noise=add_noise_to_variable(MI_x, error_MI_x,
+        error_type_dimension, error_dist_dimension, N_dup, neg_values, neg_threshold=0.0000000001)
+
+        y_MI_with_noise=add_noise_to_variable(MI_y, error_MI_y,
+        error_type_dimension, error_dist_dimension, N_dup, neg_values, neg_threshold=0.0000000001)
+
+        z_MI_with_noise=add_noise_to_variable(MI_z, error_MI_z,
+        error_type_dimension, error_dist_dimension, N_dup, neg_values, neg_threshold=0.0000000001)
+
+        x_VB_with_noise=add_noise_to_variable(VB_x, error_VB_x,
+        error_type_dimension, error_dist_dimension,  N_dup, neg_values, neg_threshold=0.0000000001)
+
+        y_VB_with_noise=add_noise_to_variable(VB_y, error_VB_y,
+        error_type_dimension, error_dist_dimension, N_dup, neg_values, neg_threshold=0.0000000001)
 
-    if error_type_vol_perc_bub=='Abs':
-        error_Vol=error_vol_perc_bub
-    if error_type_vol_perc_bub =='Perc':
-        error_Vol=df_c['vol_perc_bub'].iloc[sample_i]*error_vol_perc_bub/100
-    if error_dist_vol_perc_bub=='normal':
-        Noise_to_add_Vol = np.random.normal(0, error_Vol, N_dup)
-    if error_dist_vol_perc_bub=='uniform':
-        Noise_to_add_Vol = np.random.uniform(- error_Vol, +
-                                                      error_Vol, N_dup)
-
-    Vol_with_noise=Noise_to_add_Vol+df_c['vol_perc_bub'].iloc[sample_i]
-    if neg_values is False:
-        Vol_with_noise[Vol_with_noise < 0.000000000000001] = 0.000000000000001
-
-    #
-
-    # Volume error distribution
-
-    if error_type_CO2_bub_dens_gcm3=='Abs':
-        error_CO2_bub_dens_gcm3=error_CO2_bub_dens_gcm3
-    if error_type_CO2_bub_dens_gcm3 =='Perc':
-        error_CO2_bub_dens_gcm3=df_c['vol_perc_bub'].iloc[sample_i]*error_CO2_bub_dens_gcm3/100
-    if error_dist_CO2_bub_dens_gcm3=='normal':
-        Noise_to_add_CO2_bub_dens_gcm3 = np.random.normal(0, error_CO2_bub_dens_gcm3, N_dup)
-    if error_dist_CO2_bub_dens_gcm3=='uniform':
-        Noise_to_add_CO2_bub_dens_gcm3 = np.random.uniform(- error_CO2_bub_dens_gcm3, +
-                                                      error_CO2_bub_dens_gcm3, N_dup)
-
-    CO2_bub_dens_gcm3_with_noise=Noise_to_add_CO2_bub_dens_gcm3+df_c['CO2_bub_dens_gcm3'].iloc[sample_i]
-    if neg_values is False:
-        CO2_bub_dens_gcm3_with_noise[CO2_bub_dens_gcm3_with_noise < 0.000000000000001] = 0.000000000000001
-
-    # Volume error distribution
-
-    if error_type_melt_dens_kgm3=='Abs':
-        error_melt_dens_kgm3=error_melt_dens_kgm3
-    if error_type_melt_dens_kgm3 =='Perc':
-        error_melt_dens_kgm3=df_c['vol_perc_bub'].iloc[sample_i]*error_melt_dens_kgm3/100
-    if error_dist_melt_dens_kgm3=='normal':
-        Noise_to_add_melt_dens_kgm3 = np.random.normal(0, error_melt_dens_kgm3, N_dup)
-    if error_dist_melt_dens_kgm3=='uniform':
-        Noise_to_add_melt_dens_kgm3 = np.random.uniform(- error_melt_dens_kgm3, +
-                                                      error_melt_dens_kgm3, N_dup)
-
-    melt_dens_kgm3_with_noise=Noise_to_add_melt_dens_kgm3+df_c['melt_dens_kgm3'].iloc[sample_i]
-    if neg_values is False:
-        melt_dens_kgm3_with_noise[melt_dens_kgm3_with_noise < 0.000000000000001] = 0.000000000000001
+        z_VB_with_noise=add_noise_to_variable(VB_z, error_VB_z,
+        error_type_dimension, error_dist_dimension, N_dup, neg_values, neg_threshold=0.0000000001)
+
+
+        Vol_VB_sphere_with_noise=const*x_VB_with_noise*y_VB_with_noise*z_VB_with_noise
+        Vol_MI_sphere_with_noise=const*x_MI_with_noise*y_MI_with_noise*z_MI_with_noise
+        Vol_with_noise=100* Vol_VB_sphere_with_noise/Vol_MI_sphere_with_noise
+
+
+    # Bubble density
+    CO2_bub_dens_gcm3_with_noise=add_noise_to_variable(CO2_bub_dens_gcm3, error_CO2_bub_dens_gcm3,
+        error_type_CO2_bub_dens_gcm3, error_dist_CO2_bub_dens_gcm3, N_dup, neg_values, neg_threshold=0.0000000001)
+
+    # Melt density
+    melt_dens_kgm3_with_noise=add_noise_to_variable(melt_dens_kgm3, error_melt_dens_kgm3,
+        error_type_melt_dens_kgm3, error_dist_melt_dens_kgm3,  N_dup, neg_values, neg_threshold=0.0000000001)
+
+    # Now lets calculate the equilibrium CO2 content of the melt
     CO2_eq_melt_ind=10**4 * (df_c['vol_perc_bub']*df_c['CO2_bub_dens_gcm3'])/(df_c['melt_dens_kgm3']/1000)
-    df_out=pd.DataFrame(data={
+
+    if error_vol_perc_bub is not None:
+        df_out=pd.DataFrame(data={
 
                                 'vol_perc_bub_with_noise': Vol_with_noise,
                                 'CO2_bub_dens_gcm3_with_noise': CO2_bub_dens_gcm3_with_noise,
                                 'melt_dens_kgm3_with_noise': melt_dens_kgm3_with_noise,
                                 'vol_perc_bub': df_c['vol_perc_bub'].iloc[sample_i],
                                 'CO2_bub_dens_gcm3': CO2_bub_dens_gcm3,
-                                'Absolute_error_Vol': error_Vol,
                                 'error_type_vol_perc_bub': error_type_vol_perc_bub,
                                 'error_dist_Vol': error_dist_vol_perc_bub,
                                 'error_CO2_bub_dens_gcm3': error_CO2_bub_dens_gcm3,
                                 'error_type_CO2_bub_dens_gcm3': error_type_CO2_bub_dens_gcm3,
                                 'error_dist_CO2_bub_dens_gcm3': error_dist_CO2_bub_dens_gcm3,
                                 })
 
+    else:
+        df_out=pd.DataFrame(data={
+
+                                'vol_perc_bub_with_noise': Vol_with_noise,
+                                'CO2_bub_dens_gcm3_with_noise': CO2_bub_dens_gcm3_with_noise,
+                                'melt_dens_kgm3_with_noise': melt_dens_kgm3_with_noise,
+                                'vol_perc_bub': df_c['vol_perc_bub'].iloc[sample_i],
+                                'CO2_bub_dens_gcm3': CO2_bub_dens_gcm3,
+                                'error_CO2_bub_dens_gcm3': error_CO2_bub_dens_gcm3,
+                                'error_type_CO2_bub_dens_gcm3': error_type_CO2_bub_dens_gcm3,
+                                'error_dist_CO2_bub_dens_gcm3': error_dist_CO2_bub_dens_gcm3,
+                                'Vol_VB_with_noise': Vol_VB_sphere_with_noise,
+                                'Vol_MI_with_noise': Vol_MI_sphere_with_noise,
+                                'VB_x_with_noise': x_VB_with_noise,
+                                'VB_y_with_noise':y_VB_with_noise,
+                                'VB_z_with_noise': z_VB_with_noise,
+                                'MI_x_with_noise': x_MI_with_noise,
+                                'MI_y_with_noise': y_MI_with_noise,
+                                'MI_z_with_noise': z_MI_with_noise,
+                                })
+
     CO2_eq_melt=10**4*((df_out['vol_perc_bub_with_noise']*df_out['CO2_bub_dens_gcm3_with_noise']))/(df_out['melt_dens_kgm3_with_noise']/1000)
 
     df_out.insert(0, 'CO2_eq_melt_ppm_MC',CO2_eq_melt)
 
     df_out.insert(1, 'CO2_eq_melt_ppm_noMC',float(CO2_eq_melt_ind.values))
 
 
-
-
-
-
-
     return df_out
```

### Comparing `DiadFit-0.0.85/src/DiadFit/H2O_fitting.py` & `DiadFit-0.0.88/src/DiadFit/H2O_fitting.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/Highrho_polyfit_data.pkl` & `DiadFit-0.0.88/src/DiadFit/Highrho_polyfit_data.pkl`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/Highrho_polyfit_dataUCB_1220_1400.pkl` & `DiadFit-0.0.88/src/DiadFit/Highrho_polyfit_dataUCB_1220_1567.pkl`

 * *Files 26% similar despite different names*

```diff
@@ -5,48 +5,48 @@
 00000040: 636f 7265 2e6d 756c 7469 6172 7261 7994  core.multiarray.
 00000050: 8c0c 5f72 6563 6f6e 7374 7275 6374 9493  .._reconstruct..
 00000060: 9468 028c 076e 6461 7272 6179 9493 944b  .h...ndarray...K
 00000070: 0085 9443 0162 9487 9452 9428 4b01 4b03  ...C.b...R.(K.K.
 00000080: 8594 6802 8c05 6474 7970 6594 9394 8c02  ..h...dtype.....
 00000090: 6638 9489 8887 9452 9428 4b03 8c01 3c94  f8.....R.(K...<.
 000000a0: 4e4e 4e4a ffff ffff 4aff ffff ff4b 0074  NNNJ....J....K.t
-000000b0: 9462 8943 1833 61d9 7a79 d5ba bf21 31b6  .b.C.3a.zy...!1.
-000000c0: 84da 6e36 407b 8dd0 454a bc92 c094 7494  ..n6@{..EJ....t.
+000000b0: 9462 8943 18a5 2f2d ea8b 81bb bf20 2866  .b.C../-..... (f
+000000c0: 82ca e436 40c8 139e 6b55 0993 c094 7494  ...6@...kU....t.
 000000d0: 628c 095f 7661 7269 6162 6c65 948c 0178  b.._variable...x
 000000e0: 9475 6268 1c68 0a68 0c4b 0085 9468 0e87  .ubh.h.h.K...h..
 000000f0: 9452 9428 4b01 4b39 8594 6816 8942 c801  .R.(K.K9..h..B..
-00000100: 0000 bd83 a9f9 6e31 5a40 e215 5c35 6d32  ......n1Z@..\5m2
-00000110: 5a40 442c f3ea 8132 5a40 5457 a3e4 8034  Z@D,...2Z@TW...4
-00000120: 5a40 51ff 14f3 4b34 5a40 9e72 9040 cd34  Z@Q...K4Z@.r.@.4
-00000130: 5a40 592a a08b 8335 5a40 e875 1cc8 a236  Z@Y*...5Z@.u...6
-00000140: 5a40 bca1 0b3c 8838 5a40 deeb caf4 063a  Z@...<.8Z@.....:
-00000150: 5a40 079c 2aa6 5c3c 5a40 b05b 9928 7e3c  Z@..*.\<Z@.[.(~<
-00000160: 5a40 36ea 08d8 883c 5a40 548c c8a2 463e  Z@6....<Z@T...F>
-00000170: 5a40 2a6d a16b 6940 5a40 220f 9935 a642  Z@*m.ki@Z@"..5.B
-00000180: 5a40 725e b055 8744 5a40 c92d b35c b544  Z@r^.U.DZ@.-.\.D
-00000190: 5a40 43ee 3a0b 5d44 5a40 8751 098a b546  Z@C.:.]DZ@.Q...F
-000001a0: 5a40 f275 0acf b748 5a40 8371 b0db 9e4b  Z@.u...HZ@.q...K
-000001b0: 5a40 01ba 3079 314e 5a40 0540 99c5 5350  Z@..0y1NZ@.@..SP
-000001c0: 5a40 b799 f1c9 9c50 5a40 4e54 d366 ae50  Z@.....PZ@NT.f.P
-000001d0: 5a40 fbce 2a34 a152 5a40 6ea9 3682 4d55  Z@..*4.RZ@n.6.MU
-000001e0: 5a40 95ff 39f9 0658 5a40 754b 1bc7 5d5a  Z@..9..XZ@uK..]Z
-000001f0: 5a40 e204 fa9a 245d 5a40 e968 b44a 2b5d  Z@....$]Z@.h.J+]
-00000200: 5a40 101d 3685 1b5d 5a40 09ef a6b8 7660  Z@..6..]Z@....v`
-00000210: 5a40 7328 3250 4360 5a40 3fe7 365c 7860  Z@s(2PC`Z@?.6\x`
-00000220: 5a40 968c 43b0 6f63 5a40 edc8 a0fd 6063  Z@..C.ocZ@....`c
-00000230: 5a40 772f 7035 5e63 5a40 7c15 3289 e465  Z@w/p5^cZ@|.2..e
-00000240: 5a40 2311 b609 f865 5a40 6ff8 fef0 2266  Z@#....eZ@o..."f
-00000250: 5a40 31fa d504 2169 5a40 0424 b1dc 9469  Z@1...!iZ@.$...i
-00000260: 5a40 79d2 4e9e 6469 5a40 25ad bc1d 696c  Z@y.N.diZ@%...il
-00000270: 5a40 f694 e096 5a6c 5a40 2b1f b2ef 166c  Z@....ZlZ@+....l
-00000280: 5a40 921e 552b b56f 5a40 8dea 859f f26f  Z@..U+.oZ@.....o
-00000290: 5a40 c45e b7fb 7b6f 5a40 71d8 7300 0c74  Z@.^..{oZ@q.s..t
-000002a0: 5a40 2134 2408 b973 5a40 103d db3b d673  Z@!4$..sZ@.=.;.s
-000002b0: 5a40 ab5b a59b c977 5a40 3a0e af16 da77  Z@.[...wZ@:....w
-000002c0: 5a40 f7e0 41c5 8e77 5a40 9474 9462 8c01  Z@..A..wZ@.t.b..
+00000100: 0000 8891 373e f315 5a40 989d dd12 8916  ....7>..Z@......
+00000110: 5a40 9d25 f4ce a816 5a40 3d5a c04f 9718  Z@.%....Z@=Z.O..
+00000120: 5a40 c835 d308 6318 5a40 ffee f294 e318  Z@.5..c.Z@......
+00000130: 5a40 be9e 696d 081a 5a40 16eb 29e7 b41a  Z@..im..Z@..)...
+00000140: 5a40 556e 78cd 971c 5a40 e371 897f 141e  Z@Unx...Z@.q....
+00000150: 5a40 d6ad 5e62 6720 5a40 23f9 b496 8820  Z@..^bg Z@#.... 
+00000160: 5a40 cfdf 1f51 9320 5a40 c0f3 8bf7 4e22  Z@...Q. Z@....N"
+00000170: 5a40 4bd8 583e 6f24 5a40 d6af 6a99 a926  Z@K.X>o$Z@..j..&
+00000180: 5a40 44e4 ecbe 8828 5a40 e476 8599 b628  Z@D....(Z@.v...(
+00000190: 5a40 e193 7cac 5e28 5a40 aad3 0aca b42a  Z@..|.^(Z@.....*
+000001a0: 5a40 2b4d cf10 b52c 5a40 861b 7e9b 992f  Z@+M...,Z@..~../
+000001b0: 5a40 3e52 2057 2a32 5a40 45c3 4dfa 4a34  Z@>R W*2Z@E.M.J4
+000001c0: 5a40 5122 5261 9434 5a40 4f39 2862 a634  Z@Q"Ra.4Z@O9(b.4
+000001d0: 5a40 c7f3 19d2 9736 5a40 8af6 1ae6 4139  Z@.....6Z@....A9
+000001e0: 5a40 e88e 681a f93b 5a40 b0c6 d4fe 4d3e  Z@..h..;Z@....M>
+000001f0: 5a40 3408 4882 1341 5a40 6f25 ed13 1a41  Z@4.H..AZ@o%...A
+00000200: 5a40 54ad 3349 0a41 5a40 ce5e eb4d 6244  Z@T.3I.AZ@.^.MbD
+00000210: 5a40 31d4 5631 2f44 5a40 ffc5 d516 6444  Z@1.V1/DZ@....dD
+00000220: 5a40 3510 6e9d 5847 5a40 b9e2 2010 4a47  Z@5.n.XGZ@.. .JG
+00000230: 5a40 36a6 6b59 4747 5a40 5c51 6a39 cb49  Z@6.kYGGZ@\Qj9.I
+00000240: 5a40 6498 e4ae de49 5a40 7a77 7e75 094a  Z@d....IZ@zw~u.J
+00000250: 5a40 4752 336f 044d 5a40 e10f 00cf 774d  Z@GR3o.MZ@....wM
+00000260: 5a40 a2a9 1ec6 474d 5a40 b1c7 930e 4950  Z@....GMZ@....IP
+00000270: 5a40 b923 db90 3a50 5a40 67a5 2b35 f74f  Z@.#..:PZ@g.+5.O
+00000280: 5a40 c816 7c75 9153 5a40 322b 189f ce53  Z@..|u.SZ@2+...S
+00000290: 5a40 60b4 3e6d 5853 5a40 1e3b 135a e357  Z@`.>mXSZ@.;.Z.W
+000002a0: 5a40 958d 79a4 9057 5a40 9d29 e9a3 ad57  Z@..y..WZ@.)...W
+000002b0: 5a40 b91e ff1b 9b5b 5a40 9ae1 365d ab5b  Z@.....[Z@..6].[
+000002c0: 5a40 f575 7e31 605b 5a40 9474 9462 8c01  Z@.u~1`[Z@.t.b..
 000002d0: 7994 680a 680c 4b00 8594 680e 8794 5294  y.h.h.K...h...R.
 000002e0: 284b 014b 3985 9468 1689 42c8 0100 0004  (K.K9..h..B.....
 000002f0: 8d2c 5979 dde4 3fbf 609d 3d4b ffe4 3f65  .,Yy..?.`.=K..?e
 00000300: 0559 847d 53e5 3ff0 2c4a 3525 a5e5 3fab  .Y.}S.?.,J5%..?.
 00000310: 270c 805a a5e5 3f9a 14aa 07ef a5e5 3fef  '..Z..?.......?.
 00000320: f4cb 7ef3 02e6 3f63 0ce2 bbd6 15e6 3f2d  ..~...?c......?-
 00000330: c300 aafb 82e6 3f84 2a3d 4c8d ede6 3f97  ......?.*=L...?.
```

### Comparing `DiadFit-0.0.85/src/DiadFit/Highrho_polyfit_dataUCB_1220_1447.pkl` & `DiadFit-0.0.88/src/DiadFit/Highrho_polyfit_dataUCB_1117_1447.pkl`

 * *Files 23% similar despite different names*

```diff
@@ -5,48 +5,48 @@
 00000040: 636f 7265 2e6d 756c 7469 6172 7261 7994  core.multiarray.
 00000050: 8c0c 5f72 6563 6f6e 7374 7275 6374 9493  .._reconstruct..
 00000060: 9468 028c 076e 6461 7272 6179 9493 944b  .h...ndarray...K
 00000070: 0085 9443 0162 9487 9452 9428 4b01 4b03  ...C.b...R.(K.K.
 00000080: 8594 6802 8c05 6474 7970 6594 9394 8c02  ..h...dtype.....
 00000090: 6638 9489 8887 9452 9428 4b03 8c01 3c94  f8.....R.(K...<.
 000000a0: 4e4e 4e4a ffff ffff 4aff ffff ff4b 0074  NNNJ....J....K.t
-000000b0: 9462 8943 1859 415e 21f1 17bb bfe4 0f95  .b.C.YA^!.......
-000000c0: 3fca 8736 40e9 5723 63a9 b792 c094 7494  ?..6@.W#c.....t.
+000000b0: 9462 8943 1844 0aa3 ace1 59bb bf2c 6c81  .b.C.D....Y..,l.
+000000c0: 26aa bf36 4056 3c42 8000 e792 c094 7494  &..6@V<B......t.
 000000d0: 628c 095f 7661 7269 6162 6c65 948c 0178  b.._variable...x
 000000e0: 9475 6268 1c68 0a68 0c4b 0085 9468 0e87  .ubh.h.h.K...h..
 000000f0: 9452 9428 4b01 4b39 8594 6816 8942 c801  .R.(K.K9..h..B..
-00000100: 0000 3120 9df7 e60d 5a40 b45e a6a6 c80e  ..1 ....Z@.^....
-00000110: 5a40 312b 45a3 c30e 5a40 fb39 f649 da10  Z@1+E...Z@.9.I..
-00000120: 5a40 2ec3 e384 a510 5a40 e277 e12f 2611  Z@......Z@.w./&.
-00000130: 5a40 7649 13e1 f411 5a40 c123 9cc1 f912  Z@vI....Z@.#....
-00000140: 5a40 d1ba 90bf dc14 5a40 dbb3 ae86 5916  Z@......Z@....Y.
-00000150: 5a40 8176 f119 ac18 5a40 5949 4b75 cd18  Z@.v....Z@YIKu..
-00000160: 5a40 1257 e912 d818 5a40 afc7 0d88 931a  Z@.W....Z@......
-00000170: 5a40 01d0 ad65 b31c 5a40 f81e bc18 ed1e  Z@...e..Z@......
-00000180: 5a40 1592 b895 cb20 5a40 6b92 7a57 f920  Z@..... Z@k.zW. 
-00000190: 5a40 8982 6976 a120 5a40 2446 d3a5 f622  Z@..iv. Z@$F..."
-000001a0: 5a40 bda2 1c0f f624 5a40 b237 5eb6 d827  Z@.....$Z@.7^..'
-000001b0: 5a40 3c9f 652f 672a 5a40 f8da f01a 862c  Z@<.e/g*Z@.....,
-000001c0: 5a40 8aa5 092c ce2c 5a40 2064 e04a df2c  Z@...,.,Z@ d.J.,
-000001d0: 5a40 13c0 fbca ce2e 5a40 9d2e 65d8 7631  Z@......Z@..e.v1
-000001e0: 5a40 acde b8e8 2b34 5a40 5896 c2d6 7e36  Z@....+4Z@X...~6
-000001f0: 5a40 740c c25b 3f39 5a40 77a0 b22e 4639  Z@t..[?9Z@w...F9
-00000200: 5a40 647f bfa7 3639 5a40 bf7f ad82 8c3c  Z@d...69Z@.....<
-00000210: 5a40 9433 7b31 593c 5a40 a93e f8cb 8d3c  Z@.3{1Y<Z@.>...<
-00000220: 5a40 dbe1 e025 803f 5a40 cc2f 0743 713f  Z@...%.?Z@./.Cq?
-00000230: 5a40 a71b 734d 6e3f 5a40 36ca 1a34 f041  Z@..sMn?Z@6..4.A
-00000240: 5a40 beaf 6964 0342 5a40 91b5 29be 2d42  Z@..id.BZ@..).-B
-00000250: 5a40 f296 5ef3 2645 5a40 f704 7df6 9945  Z@..^.&EZ@..}..E
-00000260: 5a40 5c42 39c4 6945 5a40 dabb fb5e 6948  Z@\B9.iEZ@...^iH
-00000270: 5a40 65ff 337c 5a48 5a40 fa6c 8a65 1748  Z@e.3|ZHZ@.l.e.H
-00000280: 5a40 5701 0080 af4b 5a40 8327 e869 ec4b  Z@W....KZ@.'.i.K
-00000290: 5a40 27bb 0226 764b 5a40 78c4 caf4 fe4f  Z@'..&vKZ@x....O
-000002a0: 5a40 6b07 0723 ac4f 5a40 7d1e 03eb c84f  Z@k..#.OZ@}....O
-000002b0: 5a40 6583 053c b353 5a40 4dc2 625e c353  Z@e..<.SZ@M.b^.S
-000002c0: 5a40 18a7 e52f 7853 5a40 9474 9462 8c01  Z@.../xSZ@.t.b..
+00000100: 0000 c999 8ee2 3f10 5a40 b79c 73fa fe10  ......?.Z@..s...
+00000110: 5a40 28ee bad5 1511 5a40 4044 fab5 0f13  Z@(.....Z@@D....
+00000120: 5a40 ad02 2716 db12 5a40 ea7b eab7 5b13  Z@..'...Z@.{..[.
+00000130: 5a40 fa3d 9bb9 5014 5a40 c8be 5484 2e15  Z@.=..P.Z@..T...
+00000140: 5a40 b7b4 8766 1117 5a40 0fee 9d0e 8e18  Z@...f..Z@......
+00000150: 5a40 ccb1 5c9e e01a 5a40 274b 87dc 011b  Z@..\...Z@'K....
+00000160: 5a40 d832 648c 0c1b 5a40 1cec 8be8 c71c  Z@.2d...Z@......
+00000170: 5a40 3659 49a5 e71e 5a40 9369 c75c 2121  Z@6YI...Z@.i.\!!
+00000180: 5a40 43dd b2d8 ff22 5a40 1b76 8494 2d23  Z@C...."Z@.v..-#
+00000190: 5a40 110a e6a1 d522 5a40 9ccd a2e4 2a25  Z@....."Z@....*%
+000001a0: 5a40 eb06 bd61 2a27 5a40 1289 6a18 0d2a  Z@...a*'Z@..j..*
+000001b0: 5a40 6834 9bb1 9b2c 5a40 b46b 50ca ba2e  Z@h4...,Z@.kP...
+000001c0: 5a40 775e 9deb 022f 5a40 c39f 3918 142f  Z@w^.../Z@..9../
+000001d0: 5a40 4f65 09dd 0331 5a40 b594 5043 ac33  Z@Oe...1Z@..PC.3
+000001e0: 5a40 ba75 23b7 6136 5a40 9ff4 eb04 b538  Z@.u#.a6Z@.....8
+000001f0: 5a40 fcf7 7b88 763b 5a40 f28c 854d 7d3b  Z@..{.v;Z@...M};
+00000200: 5a40 15a6 f7b7 6d3b 5a40 2f50 6e1c c43e  Z@....m;Z@/Pn..>
+00000210: 5a40 5fe0 a9d6 903e 5a40 4776 a483 c53e  Z@_....>Z@Gv...>
+00000220: 5a40 c4bc f470 b841 5a40 aea4 2ca5 a941  Z@...p.AZ@..,..A
+00000230: 5a40 1168 06c1 a641 5a40 7d8c b03a 2944  Z@.h...AZ@}..:)D
+00000240: 5a40 8035 a680 3c44 5a40 d4a3 3dfd 6644  Z@.5..<DZ@..=.fD
+00000250: 5a40 e847 74c0 6047 5a40 efe1 8be2 d347  Z@.Gt.`GZ@.....G
+00000260: 5a40 4c33 03c1 a347 5a40 951e 78eb a34a  Z@L3...GZ@..x..J
+00000270: 5a40 6905 d633 954a 5a40 415f a002 524a  Z@i..3.JZ@A_..RJ
+00000280: 5a40 4639 afe6 ea4d 5a40 123c f9eb 274e  Z@F9...MZ@.<..'N
+00000290: 5a40 0b8d eab8 b14d 5a40 3aa0 4253 3b52  Z@.....MZ@:.BS;R
+000002a0: 5a40 b82f 8599 e851 5a40 9c33 6080 0552  Z@./...QZ@.3`..R
+000002b0: 5a40 eecf c6b9 f155 5a40 9418 83fa 0156  Z@.....UZ@.....V
+000002c0: 5a40 fd68 5de3 b655 5a40 9474 9462 8c01  Z@.h]..UZ@.t.b..
 000002d0: 7994 680a 680c 4b00 8594 680e 8794 5294  y.h.h.K...h...R.
 000002e0: 284b 014b 3985 9468 1689 42c8 0100 0004  (K.K9..h..B.....
 000002f0: 8d2c 5979 dde4 3fbf 609d 3d4b ffe4 3f65  .,Yy..?.`.=K..?e
 00000300: 0559 847d 53e5 3ff0 2c4a 3525 a5e5 3fab  .Y.}S.?.,J5%..?.
 00000310: 270c 805a a5e5 3f9a 14aa 07ef a5e5 3fef  '..Z..?.......?.
 00000320: f4cb 7ef3 02e6 3f63 0ce2 bbd6 15e6 3f2d  ..~...?c......?-
 00000330: c300 aafb 82e6 3f84 2a3d 4c8d ede6 3f97  ......?.*=L...?.
```

### Comparing `DiadFit-0.0.85/src/DiadFit/Highrho_polyfit_data_CCMR.pkl` & `DiadFit-0.0.88/src/DiadFit/Highrho_polyfit_data_CCMR.pkl`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/Highrho_polyfit_data_CMASS.pkl` & `DiadFit-0.0.88/src/DiadFit/Highrho_polyfit_data_CMASS.pkl`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/Lowrho_polyfit_data.pkl` & `DiadFit-0.0.88/src/DiadFit/Lowrho_polyfit_data.pkl`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/Lowrho_polyfit_dataUCB_1220_1400.pkl` & `DiadFit-0.0.88/src/DiadFit/Lowrho_polyfit_dataUCB_1117_1447.pkl`

 * *Files 18% similar despite different names*

```diff
@@ -5,33 +5,33 @@
 00000040: 636f 7265 2e6d 756c 7469 6172 7261 7994  core.multiarray.
 00000050: 8c0c 5f72 6563 6f6e 7374 7275 6374 9493  .._reconstruct..
 00000060: 9468 028c 076e 6461 7272 6179 9493 944b  .h...ndarray...K
 00000070: 0085 9443 0162 9487 9452 9428 4b01 4b02  ...C.b...R.(K.K.
 00000080: 8594 6802 8c05 6474 7970 6594 9394 8c02  ..h...dtype.....
 00000090: 6638 9489 8887 9452 9428 4b03 8c01 3c94  f8.....R.(K...<.
 000000a0: 4e4e 4e4a ffff ffff 4aff ffff ff4b 0074  NNNJ....J....K.t
-000000b0: 9462 8943 1051 b6e8 7e08 24d9 3f44 82ef  .b.C.Q..~.$.?D..
-000000c0: b843 4844 c094 7494 628c 095f 7661 7269  .CHD..t.b.._vari
+000000b0: 9462 8943 1018 2fec 9dff 5bd9 3fec c176  .b.C../...[.?..v
+000000c0: 025d 5b44 c094 7494 628c 095f 7661 7269  .][D..t.b.._vari
 000000d0: 6162 6c65 948c 0178 9475 6268 1c68 0a68  able...x.ubh.h.h
 000000e0: 0c4b 0085 9468 0e87 9452 9428 4b01 4b1d  .K...h...R.(K.K.
-000000f0: 8594 6816 8943 e82b 5534 2c60 d259 40d7  ..h..C.+U4,`.Y@.
-00000100: 024b c7c1 d159 4009 baa2 e655 d459 4097  .K...Y@....U.Y@.
-00000110: deca cb0b d459 4084 3f99 9c92 d559 4084  .....Y@.?....Y@.
-00000120: c561 5931 d759 40cc 8498 e15e d659 40b4  .aY1.Y@....^.Y@.
-00000130: f69c 9d16 d759 4007 a751 9ba5 d859 4058  .....Y@..Q...Y@X
-00000140: f447 5ddf da59 4087 cd4d 2e2c db59 40c9  .G]..Y@..M.,.Y@.
-00000150: c2ce f64b dc59 40de 042b 46b6 dd59 409a  ...K.Y@..+F..Y@.
-00000160: 7063 ebee de59 40c9 b914 43dd df59 403b  pc...Y@...C..Y@;
-00000170: 8127 07de e059 40a4 0fe4 1581 e259 40e2  .'...Y@......Y@.
-00000180: c3a4 1156 e259 4020 8d3c 6055 e359 40b4  ...V.Y@ .<`U.Y@.
-00000190: 79e9 e37f e359 40be cbf6 c53f e459 40ca  y....Y@....?.Y@.
-000001a0: 40ce 57ef e459 40b2 f6d8 8a49 e659 400f  @.W..Y@....I.Y@.
-000001b0: 0772 0df2 e759 405c 79fc 7242 e959 400c  .r...Y@\y.rB.Y@.
-000001c0: 3c0c e8d5 e959 40af 28fc 4a81 ea59 40ad  <....Y@.(.J..Y@.
-000001d0: ff83 ed27 ec59 4012 3ba5 bcf5 eb59 4094  ...'.Y@.;....Y@.
+000000f0: 8594 6816 8943 e863 c07f b47e b159 406f  ..h..C.c...~.Y@o
+00000100: 0d13 81ca b059 4049 444d 7373 b359 4008  .....Y@IDMss.Y@.
+00000110: 85cb d014 b359 405e f474 8eaf b459 401d  .....Y@^.t...Y@.
+00000120: 5808 d44c b659 4061 95e0 bd7b b559 4084  X..L.Y@a...{.Y@.
+00000130: f05f cb1e b659 40d3 e8be 7fbf b759 409e  ._...Y@......Y@.
+00000140: 5a8e 49e5 b959 402b 6a05 b63f ba59 4008  Z.I..Y@+j..?.Y@.
+00000150: b0f8 e85b bb59 4032 ed40 00bb bc59 4089  ...[.Y@2.@...Y@.
+00000160: 07fb 96f9 bd59 400b 2cf0 81e1 be59 4009  .....Y@.,....Y@.
+00000170: 7355 fce3 bf59 4054 fb29 6782 c159 40da  sU...Y@T.)g..Y@.
+00000180: 7c5f 4f46 c159 402e 8b6d 7553 c259 406a  |_OF.Y@..muS.Y@j
+00000190: 951b a668 c259 40e5 6d3d 633a c359 4052  ...h.Y@.m=c:.Y@R
+000001a0: 32aa f9e4 c359 4004 0fe1 653a c559 409c  2....Y@...e:.Y@.
+000001b0: e77c 32dd c659 4014 85dc 6028 c859 4022  .|2..Y@...`(.Y@"
+000001c0: ea31 a4d5 c859 4023 c8e1 3f4b c959 4049  .1...Y@#..?K.Y@I
+000001d0: e7d5 8224 cb59 40f8 fa6d b7b9 ca59 4094  ...$.Y@..m...Y@.
 000001e0: 7494 628c 0179 9468 0a68 0c4b 0085 9468  t.b..y.h.h.K...h
 000001f0: 0e87 9452 9428 4b01 4b1d 8594 6816 8943  ...R.(K.K...h..C
 00000200: e8c1 dd9c 3099 a883 3f9e ee3f 3ac1 1d84  ....0...?..?:...
 00000210: 3fee 22f7 46ec 1395 3fa5 9dfe 0a2f f297  ?.".F...?..../..
 00000220: 3fab 1fc4 5ae2 429d 3f26 5d64 1523 a8a1  ?...Z.B.?&]d.#..
 00000230: 3f19 3ae1 0603 a2a4 3f52 aa55 eda4 81a6  ?.:.....?R.U....
 00000240: 3f12 dfe2 8ebd 63a8 3fc4 bddc 620b e8ad  ?.....c.?...b...
```

### Comparing `DiadFit-0.0.85/src/DiadFit/Lowrho_polyfit_data_CCMR.pkl` & `DiadFit-0.0.88/src/DiadFit/Lowrho_polyfit_data_CCMR.pkl`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/Lowrho_polyfit_data_CMASS.pkl` & `DiadFit-0.0.88/src/DiadFit/Lowrho_polyfit_data_CMASS.pkl`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/Mediumrho_polyfit_data.pkl` & `DiadFit-0.0.88/src/DiadFit/Mediumrho_polyfit_data.pkl`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/Mediumrho_polyfit_dataUCB_1220_1400.pkl` & `DiadFit-0.0.88/src/DiadFit/Mediumrho_polyfit_dataUCB_1220_1567.pkl`

 * *Files 22% similar despite different names*

```diff
@@ -5,51 +5,51 @@
 00000040: 636f 7265 2e6d 756c 7469 6172 7261 7994  core.multiarray.
 00000050: 8c0c 5f72 6563 6f6e 7374 7275 6374 9493  .._reconstruct..
 00000060: 9468 028c 076e 6461 7272 6179 9493 944b  .h...ndarray...K
 00000070: 0085 9443 0162 9487 9452 9428 4b01 4b04  ...C.b...R.(K.K.
 00000080: 8594 6802 8c05 6474 7970 6594 9394 8c02  ..h...dtype.....
 00000090: 6638 9489 8887 9452 9428 4b03 8c01 3c94  f8.....R.(K...<.
 000000a0: 4e4e 4e4a ffff ffff 4aff ffff ff4b 0074  NNNJ....J....K.t
-000000b0: 9462 8943 20a4 23e1 bfb4 f06b 3f3d 366d  .b.C .#....k?=6m
-000000c0: 20ed 4ff0 bf57 b45f a6f2 7359 4075 c0b9   .O..W._..sY@u..
-000000d0: ef37 8baa c094 7494 628c 095f 7661 7269  .7....t.b.._vari
+000000b0: 9462 8943 205c c718 0751 6191 3f7a 5ff7  .b.C \...Qa.?z_.
+000000c0: 154d f614 c079 9e07 990f de80 402d e4dc  .M...y......@-..
+000000d0: 6435 1cd2 c094 7494 628c 095f 7661 7269  d5....t.b.._vari
 000000e0: 6162 6c65 948c 0178 9475 6268 1c68 0a68  able...x.ubh.h.h
 000000f0: 0c4b 0085 9468 0e87 9452 9428 4b01 4b3e  .K...h...R.(K.K>
-00000100: 8594 6816 8942 f001 0000 ca40 ce57 efe4  ..h..B.....@.W..
-00000110: 5940 b2f6 d88a 49e6 5940 0f07 720d f2e7  Y@....I.Y@..r...
-00000120: 5940 5c79 fc72 42e9 5940 0c3c 0ce8 d5e9  Y@\y.rB.Y@.<....
-00000130: 5940 af28 fc4a 81ea 5940 adff 83ed 27ec  Y@.(.J..Y@....'.
-00000140: 5940 123b a5bc f5eb 5940 0fee 6d9a 99ed  Y@.;....Y@..m...
-00000150: 5940 0781 d692 f9ee 5940 abb4 2263 c7ee  Y@......Y@.."c..
-00000160: 5940 a8bb 5062 bdf0 5940 8a23 f676 9df1  Y@..Pb..Y@.#.v..
-00000170: 5940 1822 1c0d 54f4 5940 1a31 b011 8df4  Y@."..T.Y@.1....
-00000180: 5940 9fba 5216 9df4 5940 1447 956e acf4  Y@..R...Y@.G.n..
-00000190: 5940 05df 4a8a d9f4 5940 a33f 9b4d a7f5  Y@..J...Y@.?.M..
-000001a0: 5940 629c 47ef 4cf8 5940 fce5 f4d2 37f9  Y@b.G.L.Y@....7.
-000001b0: 5940 c7d4 4073 86f9 5940 bcb9 3e22 c7fb  Y@..@s..Y@..>"..
-000001c0: 5940 46da d777 2bfb 5940 bd88 7888 befd  Y@F..w+.Y@..x...
-000001d0: 5940 a32b 2c72 5ffd 5940 4614 0797 80fd  Y@.+,r_.Y@F.....
-000001e0: 5940 64d0 4a33 5ffe 5940 741c 853a d1fe  Y@d.J3_.Y@t..:..
-000001f0: 5940 c2ed 9b9f e100 5a40 b582 e75c c600  Y@......Z@...\..
-00000200: 5a40 a99f 3cfe 8202 5a40 3639 2db1 2b06  Z@..<...Z@69-.+.
-00000210: 5a40 f67b 4364 d908 5a40 9a47 2726 c60b  Z@.{Cd..Z@.G'&..
-00000220: 5a40 d36d 2a6a 010e 5a40 f485 64a7 1811  Z@.m*j..Z@..d...
-00000230: 5a40 a6d9 0ce0 5112 5a40 2e50 926f fb15  Z@....Q.Z@.P.o..
-00000240: 5a40 d7a9 2fee 741b 5a40 6c27 59c5 f31d  Z@../.t.Z@l'Y...
-00000250: 5a40 9367 15c7 3321 5a40 e36c 28f6 ae23  Z@.g..3!Z@.l(..#
-00000260: 5a40 6027 7303 fa23 5a40 d71c 6e41 e825  Z@`'s..#Z@..nA.%
-00000270: 5a40 0d30 36a5 8a28 5a40 dc2f d3c1 ea2a  Z@.06..(Z@./...*
-00000280: 5a40 f031 8be5 e02c 5a40 0bc5 bdb8 6e2d  Z@.1...,Z@....n-
-00000290: 5a40 afbd 23bc 362d 5a40 605f d812 f52e  Z@..#.6-Z@`_....
-000002a0: 5a40 94f5 955f 092f 5a40 bd83 a9f9 6e31  Z@..._./Z@....n1
-000002b0: 5a40 e215 5c35 6d32 5a40 442c f3ea 8132  Z@..\5m2Z@D,...2
-000002c0: 5a40 5457 a3e4 8034 5a40 51ff 14f3 4b34  Z@TW...4Z@Q...K4
-000002d0: 5a40 9e72 9040 cd34 5a40 592a a08b 8335  Z@.r.@.4Z@Y*...5
-000002e0: 5a40 e875 1cc8 a236 5a40 bca1 0b3c 8838  Z@.u...6Z@...<.8
-000002f0: 5a40 deeb caf4 063a 5a40 9474 9462 8c01  Z@.....:Z@.t.b..
+00000100: 8594 6816 8942 f001 0000 3741 49c0 78c9  ..h..B....7AI.x.
+00000110: 5940 6989 b37a d0ca 5940 28fa cd0f 76cc  Y@i..z..Y@(...v.
+00000120: 5940 ad89 e4f6 c3cd 5940 43ba 737c 70ce  Y@......Y@C.s|p.
+00000130: 5940 7dbd d78a face 5940 1c41 7879 bfd0  Y@}.....Y@.Axy..
+00000140: 5940 a9c9 a086 6cd0 5940 9838 7771 0dd2  Y@....l.Y@.8wq..
+00000150: 5940 4a7e d9dd cfd2 5940 ce13 f809 39d3  Y@J~....Y@....9.
+00000160: 5940 5175 002e 2cd5 5940 2ebd 1b79 30d6  Y@Qu..,.Y@...y0.
+00000170: 5940 4fba 6d73 9fd8 5940 e839 dd67 d8d8  Y@O.ms..Y@.9.g..
+00000180: 5940 bada 0580 e8d8 5940 72e4 a680 77d8  Y@......Y@r...w.
+00000190: 5940 9e87 0428 41d9 5940 78b0 1b91 38da  Y@...(A.Y@x...8.
+000001a0: 5940 b3f4 41b0 96dc 5940 0c9c 6db4 eddc  Y@..A...Y@..m...
+000001b0: 5940 6541 0e00 d0dd 5940 9517 d4f5 6adf  Y@eA....Y@....j.
+000001c0: 5940 45b7 a614 74df 5940 0142 f3b1 6ae1  Y@E...t.Y@.B..j.
+000001d0: 5940 6421 472b f2e1 5940 c844 d58a cbe1  Y@d!G+..Y@.D....
+000001e0: 5940 1201 8887 fde1 5940 49ee 77db 1fe3  Y@......Y@I.w...
+000001f0: 5940 6774 b8e9 57e4 5940 7fbc 673d 16e5  Y@gt..W.Y@..g=..
+00000200: 5940 5ff1 0ffa dde6 5940 c3db ff83 85ea  Y@_.....Y@......
+00000210: 5940 82de ad1c 33ed 5940 a6e3 84f5 1ef0  Y@....3.Y@......
+00000220: 5940 4e4c 82bf 59f2 5940 5930 a637 a6f5  Y@NL..Y.Y@Y0.7..
+00000230: 5940 376b 3597 a7f6 5940 0fb3 0083 4efa  Y@7k5...Y@....N.
+00000240: 5940 0564 2362 c4ff 5940 b022 b650 4102  Y@.d#b..Y@.".PA.
+00000250: 5a40 1639 082f 8904 5a40 4566 ff6d 3308  Z@.9./..Z@Ef.m3.
+00000260: 5a40 116b 6ebf 4308 5a40 f6e4 b8d3 310a  Z@.kn.C.Z@....1.
+00000270: 5a40 c577 15ee d70c 5a40 0241 c4f1 350f  Z@.w....Z@.A..5.
+00000280: 5a40 ecfb 463e 2b11 5a40 22ea 9747 ed11  Z@..F>+.Z@"..G..
+00000290: 5a40 558e dd8f b411 5a40 fb0d 3aaf 2213  Z@U.....Z@..:.".
+000002a0: 5a40 cd8d cd18 3713 5a40 8891 373e f315  Z@....7.Z@..7>..
+000002b0: 5a40 989d dd12 8916 5a40 9d25 f4ce a816  Z@......Z@.%....
+000002c0: 5a40 3d5a c04f 9718 5a40 c835 d308 6318  Z@=Z.O..Z@.5..c.
+000002d0: 5a40 ffee f294 e318 5a40 be9e 696d 081a  Z@......Z@..im..
+000002e0: 5a40 16eb 29e7 b41a 5a40 556e 78cd 971c  Z@..)...Z@Unx...
+000002f0: 5a40 e371 897f 141e 5a40 9474 9462 8c01  Z@.q....Z@.t.b..
 00000300: 7994 680a 680c 4b00 8594 680e 8794 5294  y.h.h.K...h...R.
 00000310: 284b 014b 3e85 9468 1689 42f0 0100 008f  (K.K>..h..B.....
 00000320: 7283 9794 41c0 3f19 41a1 7dae 24c1 3f20  r...A.?.A.}.$.? 
 00000330: 126b 6c63 36c2 3f6e b9f7 f9cb 3bc3 3f0b  .klc6.?n....;.?.
 00000340: 70d8 f822 f6c3 3f79 aace 978e 7fc4 3fda  p.."..?y......?.
 00000350: 2013 192d b3c5 3ff3 e488 bc07 b5c5 3fd0   ..-..?.......?.
 00000360: 5aab 1fff ecc6 3fbf 64ad db89 9bc7 3fe1  Z.....?.d.....?.
```

### Comparing `DiadFit-0.0.85/src/DiadFit/Mediumrho_polyfit_dataUCB_1220_1447.pkl` & `DiadFit-0.0.88/src/DiadFit/Mediumrho_polyfit_dataUCB_1220_1400.pkl`

 * *Files 26% similar despite different names*

```diff
@@ -5,51 +5,51 @@
 00000040: 636f 7265 2e6d 756c 7469 6172 7261 7994  core.multiarray.
 00000050: 8c0c 5f72 6563 6f6e 7374 7275 6374 9493  .._reconstruct..
 00000060: 9468 028c 076e 6461 7272 6179 9493 944b  .h...ndarray...K
 00000070: 0085 9443 0162 9487 9452 9428 4b01 4b04  ...C.b...R.(K.K.
 00000080: 8594 6802 8c05 6474 7970 6594 9394 8c02  ..h...dtype.....
 00000090: 6638 9489 8887 9452 9428 4b03 8c01 3c94  f8.....R.(K...<.
 000000a0: 4e4e 4e4a ffff ffff 4aff ffff ff4b 0074  NNNJ....J....K.t
-000000b0: 9462 8943 201e 002d 6e2c 4581 3f92 1449  .b.C ..-n,E.?..I
-000000c0: 52ab a204 c01d d73d d7ea 7570 40bb 2620  R......=..up@.& 
-000000d0: 8d3d 88c1 c094 7494 628c 095f 7661 7269  .=....t.b.._vari
+000000b0: 9462 8943 202d aa7e edea 318c 3f54 e02f  .b.C -.~..1.?T./
+000000c0: fea5 f010 c059 6323 9567 2a7b 40c3 c332  .....Yc#.g*{@..2
+000000d0: 19a7 11cd c094 7494 628c 095f 7661 7269  ......t.b.._vari
 000000e0: 6162 6c65 948c 0178 9475 6268 1c68 0a68  able...x.ubh.h.h
 000000f0: 0c4b 0085 9468 0e87 9452 9428 4b01 4b3e  .K...h...R.(K.K>
-00000100: 8594 6816 8942 f001 0000 8852 5037 85c1  ..h..B.....RP7..
-00000110: 5940 75fe 45be d9c2 5940 e817 0187 7bc4  Y@u.E...Y@....{.
-00000120: 5940 d649 36c7 c5c5 5940 2a2e 34ff 91c6  Y@.I6...Y@*.4...
-00000130: 5940 41bc 2c47 e3c6 5940 b702 7699 e0c8  Y@A.,G..Y@..v...
-00000140: 5940 775e 9ddf 50c8 5940 bb98 4dc6 ebc9  Y@w^..P.Y@..M...
-00000150: 5940 63b5 650f c9ca 5940 4017 c074 12cb  Y@c.e...Y@@..t..
-00000160: 5940 af8a 6406 01cd 5940 d48c 5340 50ce  Y@..d...Y@..S@P.
-00000170: 5940 f43e 1715 d1d0 5940 99f4 1f77 0ad1  Y@.>....Y@...w..
-00000180: 5940 e994 50f0 1ad1 5940 7b09 71da 6fd0  Y@..P...Y@{.q.o.
-00000190: 5940 bbc3 575f 04d1 5940 5b4b 3848 57d2  Y@..W_..Y@[K8HW.
-000001a0: 5940 debd 568f cdd4 5940 cf4f 0ce7 e5d4  Y@..V...Y@.O....
-000001b0: 5940 7683 0abf 08d6 5940 95e7 9b9d 63d7  Y@v.....Y@....c.
-000001c0: 5940 074b afd7 add7 5940 d9c3 4cbc 84d9  Y@.K....Y@..L...
-000001d0: 5940 7a2e e14d 0cda 5940 bb4c 756f 0bda  Y@z..M..Y@.Luo..
-000001e0: 5940 290e eebc f6d9 5940 bef0 8aa7 63db  Y@).....Y@....c.
-000001f0: 5940 6b11 535f 52dc 5940 64ef d603 5bdd  Y@k.S_R.Y@d...[.
-00000200: 5940 3274 1c62 d9de 5940 baf9 670f 81e2  Y@2t.b..Y@..g...
-00000210: 5940 40a0 9ee9 2ee5 5940 1789 886b 1be8  Y@@.....Y@...k..
-00000220: 5940 2276 59ea 56ea 5940 1278 8e56 b6ed  Y@"vY.V.Y@.x.V..
-00000230: 5940 18d7 57b4 a4ee 5940 920f 54b7 4bf2  Y@..W...Y@..T.K.
-00000240: 5940 251b 1b5c c4f7 5940 8151 0af7 41fa  Y@%..\..Y@.Q..A.
-00000250: 5940 b546 cadd 8bfc 5940 ce03 8caa 3900  Y@.F....Y@....9.
-00000260: 5a40 ee3b 4102 4700 5a40 6977 ec0f 3702  Z@.;A.G.Z@iw..7.
-00000270: 5a40 c09f 60a0 e104 5a40 8183 c1ca 3f07  Z@..`...Z@....?.
-00000280: 5a40 8ad9 88aa 3509 5a40 321b 170e e809  Z@....5.Z@2.....
-00000290: 5a40 0e5f 431a b109 5a40 442e 85ff 430b  Z@._C...Z@D...C.
-000002a0: 5a40 c4df 6ce3 580b 5a40 3120 9df7 e60d  Z@..l.X.Z@1 ....
-000002b0: 5a40 b45e a6a6 c80e 5a40 312b 45a3 c30e  Z@.^....Z@1+E...
-000002c0: 5a40 fb39 f649 da10 5a40 2ec3 e384 a510  Z@.9.I..Z@......
-000002d0: 5a40 e277 e12f 2611 5a40 7649 13e1 f411  Z@.w./&.Z@vI....
-000002e0: 5a40 c123 9cc1 f912 5a40 d1ba 90bf dc14  Z@.#....Z@......
-000002f0: 5a40 dbb3 ae86 5916 5a40 9474 9462 8c01  Z@....Y.Z@.t.b..
+00000100: 8594 6816 8942 f001 0000 5199 f8d3 f5bd  ..h..B....Q.....
+00000110: 5940 499a 378e 4fbf 5940 623f 3276 f7c0  Y@I.7.O.Y@b?2v..
+00000120: 5940 e178 25c9 47c2 5940 ae2a fdd9 f1c2  Y@.x%.G.Y@.*....
+00000130: 5940 d4db 16cd 93c3 5940 fe07 435c 41c5  Y@......Y@..C\A.
+00000140: 5940 caad a97e 08c5 5940 7936 f84e adc6  Y@...~..Y@y6.N..
+00000150: 5940 e4c4 4675 71c7 5940 6b17 d623 dcc7  Y@..Fuq.Y@k..#..
+00000160: 5940 e4ea 25a5 d1c9 5940 7caf 582e b2ca  Y@..%...Y@|.X...
+00000170: 5940 cc6d cdbe 2ccd 5940 f05e 5cb9 65cd  Y@.m..,.Y@.^\.e.
+00000180: 5940 956c 16e3 75cd 5940 e5be d07a 10cd  Y@.l..u.Y@...z..
+00000190: 5940 5d04 5ebb f1cd 5940 f9b9 da99 bcce  Y@].^...Y@......
+000001a0: 5940 a648 1295 23d1 5940 a06c 3b3b 7ed1  Y@.H..#.Y@.l;;~.
+000001b0: 5940 5d44 86ad 5cd2 5940 42a6 e32d f5d3  Y@]D..\.Y@B..-..
+000001c0: 5940 2453 dd31 00d4 5940 a19a 7bb4 f8d5  Y@$S.1..Y@..{...
+000001d0: 5940 cae5 1332 7fd6 5940 0b27 0d7e 56d6  Y@...2..Y@.'.~V.
+000001e0: 5940 0896 7bdd 81d6 5940 7d3a e683 a8d7  Y@..{...Y@}:....
+000001f0: 5940 f360 e48b d5d8 5940 0c61 f52d 9cd9  Y@.`....Y@.a.-..
+00000200: 5940 3146 c678 56db 5940 2e48 b7dc f9de  Y@1F.xV.Y@.H....
+00000210: 5940 c945 6b5a a4e1 5940 6e89 cc7b 8ce4  Y@.EkZ..Y@n..{..
+00000220: 5940 1fc0 246d c4e6 5940 8d01 028d 33ea  Y@..$m..Y@....3.
+00000230: 5940 3f52 f0e0 0eeb 5940 c1b9 faf2 b2ee  Y@?R....Y@......
+00000240: 5940 0799 4345 23f4 5940 aaad 6780 9ef6  Y@..CE#.Y@..g...
+00000250: 5940 0c67 3fc3 e4f8 5940 a49d 6522 bffc  Y@.g?...Y@..e"..
+00000260: 5940 fbbf 7aa5 9dfc 5940 e01e 3f62 8bfe  Y@..z...Y@..?b..
+00000270: 5940 c414 29db 3301 5a40 9450 46da 9103  Y@..).3.Z@.PF...
+00000280: 5a40 9d3c 56fd 8705 5a40 f61b 3560 7e06  Z@.<V...Z@..5`~.
+00000290: 5a40 30c3 7710 4406 5a40 e450 31d6 7307  Z@0.w.D.Z@.P1.s.
+000002a0: 5a40 036d e795 8807 5a40 8c2e 4ebc 870a  Z@.m....Z@..N...
+000002b0: 5a40 d064 35df dd0a 5a40 2be9 96bc f40a  Z@.d5...Z@+.....
+000002c0: 5a40 fac1 8f0e f00c 5a40 b55c b92d bb0c  Z@......Z@.\.-..
+000002d0: 5a40 cbd7 7ad6 3b0d 5a40 4688 c7ae 9f0e  Z@..z.;.Z@F.....
+000002e0: 5a40 3b5f 9f00 100f 5a40 27b4 0900 f310  Z@;_....Z@'.....
+000002f0: 5a40 0939 4ed7 6f12 5a40 9474 9462 8c01  Z@.9N.o.Z@.t.b..
 00000300: 7994 680a 680c 4b00 8594 680e 8794 5294  y.h.h.K...h...R.
 00000310: 284b 014b 3e85 9468 1689 42f0 0100 008f  (K.K>..h..B.....
 00000320: 7283 9794 41c0 3f19 41a1 7dae 24c1 3f20  r...A.?.A.}.$.? 
 00000330: 126b 6c63 36c2 3f6e b9f7 f9cb 3bc3 3f0b  .klc6.?n....;.?.
 00000340: 70d8 f822 f6c3 3f79 aace 978e 7fc4 3fda  p.."..?y......?.
 00000350: 2013 192d b3c5 3ff3 e488 bc07 b5c5 3fd0   ..-..?.......?.
 00000360: 5aab 1fff ecc6 3fbf 64ad db89 9bc7 3fe1  Z.....?.d.....?.
```

### Comparing `DiadFit-0.0.85/src/DiadFit/Mediumrho_polyfit_data_CCMR.pkl` & `DiadFit-0.0.88/src/DiadFit/Mediumrho_polyfit_data_CCMR.pkl`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/Mediumrho_polyfit_data_CMASS.pkl` & `DiadFit-0.0.88/src/DiadFit/Mediumrho_polyfit_data_CMASS.pkl`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/Psensor.py` & `DiadFit-0.0.88/src/DiadFit/Psensor.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/__init__.py` & `DiadFit-0.0.88/src/DiadFit/__init__.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/argon_lines.py` & `DiadFit-0.0.88/src/DiadFit/argon_lines.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/cosmicray_filter.py` & `DiadFit-0.0.88/src/DiadFit/cosmicray_filter.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/densimeter_fitting.py` & `DiadFit-0.0.88/src/DiadFit/densimeter_fitting.py`

 * *Files 2% similar despite different names*

```diff
@@ -109,15 +109,15 @@
     std_error (bool, optional):
         Whether to calculate and plot standard error (default: True).
 
     save_fig (bool, optional):
         Whether to save the plot as an image (default: False).
 
     eq_division (str, optional):
-        Method for dividing the data based on density ('ccmr' or 'cmass', default: 'ccmr'). CCMR corresponds to the limits for each section as shown in DeVitre et al., 2021 (Chem. Geo), cmass is for those in DeVitre et al., 2023 (J. Volcanica)
+        Method for dividing the data based on density ('ccmr', 'cmass', or 'cmass_24C', default: 'ccmr'). CCMR corresponds to the limits for each section as shown in DeVitre et al., 2021 (Chem. Geo), cmass is for those in DeVitre et al., 2023 (J. Volcanica).
 
     save_suffix (str, optional):
         Suffix to be added to the saved file names (default: '').
 
     Returns:
         Saves a .pkl file, doesnt return anything.
 
@@ -130,14 +130,20 @@
             midcut_high=0.72
             highcut=0.65
         elif eq_division=='cmass':
             lowcut=0.20
             midcut_low=0.13
             midcut_high=0.70
             highcut=0.65
+
+        elif eq_division=='cmass_24C':
+            lowcut=0.24
+            midcut_low=0.24
+            midcut_high=0.65
+            highcut=0.65
         if density_range == 'Low':
             cali_data = cali_data[cali_data[CO2_dens_col] < lowcut]
 
             prefix='Lowrho_'
         elif density_range == 'Medium':
             cali_data = cali_data[cali_data[CO2_dens_col].between(midcut_low, midcut_high)]
```

### Comparing `DiadFit-0.0.85/src/DiadFit/densimeters.py` & `DiadFit-0.0.88/src/DiadFit/densimeters.py`

 * *Files 4% similar despite different names*

```diff
@@ -494,39 +494,60 @@
 
         Split=df_combo_c['Splitting']*pref_Ne
 
     else:
        Split_err=(split_err*Split).astype(float)
 
 
-    if temp=='RoomT':
-        raise TypeError('Sorry, this function doesnt yet support the calibration at 24C, please enter temp=SupCrit')
+        
+        
+        
+   
     if isinstance(Split, float) or isinstance(Split, int):
         Split=pd.Series(Split)
     # #if temp is "RoomT":
     DiadFit_dir=Path(__file__).parent
 
     LowD_RT=-38.34631 + 0.3732578*Split
     HighD_RT=-41.64784 + 0.4058777*Split- 0.1460339*(Split-104.653)**2
 
     # IF temp is 37
-    if lab=='CMASS':
+    if lab=='CMASS' and temp=='SupCrit':
         # This gets the densimeter at low density
         pickle_str_lowr='Lowrho_polyfit_data_CMASS.pkl'
         with open(DiadFit_dir/pickle_str_lowr, 'rb') as f:
             lowrho_pickle_data = pickle.load(f)
     
         # This gets the densimeter at medium density
         pickle_str_medr='Mediumrho_polyfit_data_CMASS.pkl'
         with open(DiadFit_dir/pickle_str_medr, 'rb') as f:
             medrho_pickle_data = pickle.load(f)
         # This gets the densimeter at high density.
         pickle_str_highr='Highrho_polyfit_data_CMASS.pkl'
         with open(DiadFit_dir/pickle_str_highr, 'rb') as f:
             highrho_pickle_data = pickle.load(f)
+            
+            
+    
+            
+    if lab=='CMASS' and temp=='RoomT':
+        # This gets the densimeter at low density
+        pickle_str_lowr='Lowrho_polyfit_data_CMASS_24C.pkl'
+        with open(DiadFit_dir/pickle_str_lowr, 'rb') as f:
+            lowrho_pickle_data = pickle.load(f)
+    
+
+        # This gets the densimeter at high density.
+        pickle_str_highr='Highrho_polyfit_data_CMASS_24C.pkl'
+        with open(DiadFit_dir/pickle_str_highr, 'rb') as f:
+            highrho_pickle_data = pickle.load(f)
+                      
+            
+            
+            
     elif lab=='CCMR':
         pickle_str_lowr='Lowrho_polyfit_data_CCMR.pkl'
         with open(DiadFit_dir/pickle_str_lowr, 'rb') as f:
             lowrho_pickle_data = pickle.load(f)
     
         # This gets the densimeter at medium density
         pickle_str_medr='Mediumrho_polyfit_data_CCMR.pkl'
@@ -539,50 +560,61 @@
         
     
     else:
         raise TypeError('Lab name not recognised. enter CCMR or CMASS')
 
     # this allocates the model
     lowrho_model = lowrho_pickle_data['model']
-    medrho_model = medrho_pickle_data['model']
+    
+    if temp=='SupCrit':
+        medrho_model = medrho_pickle_data['model']
+        MedD_SC = pd.Series(medrho_model(Split), index=Split.index)
+        medD_error=calculate_Densimeter_std_err_values(corrected_split=Split, corrected_split_err=Split_err,
+        pickle_str=pickle_str_medr,  CI_dens=CI_neon, CI_split=CI_split, str_d='MedD')
+        
     highrho_model = highrho_pickle_data['model']
 
     # Each of these lines get the density, and then the error on that density.
 
     LowD_SC = pd.Series(lowrho_model(Split), index=Split.index)
     lowD_error=calculate_Densimeter_std_err_values(corrected_split=Split, corrected_split_err=Split_err,
     pickle_str=pickle_str_lowr,  CI_dens=CI_neon, CI_split=CI_split, str_d='LowD')
+ 
 
-    MedD_SC = pd.Series(medrho_model(Split), index=Split.index)
-    medD_error=calculate_Densimeter_std_err_values(corrected_split=Split, corrected_split_err=Split_err,
-    pickle_str=pickle_str_medr,  CI_dens=CI_neon, CI_split=CI_split, str_d='MedD')
 
     HighD_SC = pd.Series(highrho_model(Split), index=Split.index)
     highD_error=calculate_Densimeter_std_err_values(corrected_split=Split, corrected_split_err=Split_err,
     pickle_str=pickle_str_highr,   CI_dens=CI_neon, CI_split=CI_split,  str_d='HighD')
 
 
 
 
-
+    if temp=='RoomT':
+        MedD_SC=np.nan
+        MedD_err=np.nan
+        
+    else:
+        MedD_err=medD_error['MedD_Density_']
+        
+        
     df=pd.DataFrame(data={'Preferred D': 0,
     'Corrected_Splitting': Split,
     'Preferred D_': 0,
     'Preferred D__split': 0,
     'Preferred D__Ne': 0,
     'Preferred D__pkfit': 0,
      'Preferred D__dens': 0,
         'in range': 'Y',
                                 'Notes': 'not in range',
                                 'LowD_RT':np.nan,
                                 'HighD_RT': np.nan,
                                 'LowD_SC': LowD_SC,
                                 'LowD_SC_': lowD_error['LowD_Density_'],
                                 'MedD_SC': MedD_SC,
-                                'MedD_SC_': medD_error['MedD_Density_'],
+                                'MedD_SC_': MedD_err,
                                 'HighD_SC': HighD_SC,
                                 'HighD_SC_': highD_error['HighD_Density_'],
                                 'Temperature': temp,
 
 
                                 })
 
@@ -590,14 +622,15 @@
 
 
     roomT=df['Temperature']=="RoomT"
     SupCrit=df['Temperature']=="SupCrit"
     # If splitting is 0
     zero=df['Corrected_Splitting']==0
 
+
     # Range for SC low density
     min_lowD_SC_Split=df['Corrected_Splitting']>=102.7623598753032
     max_lowD_SC_Split=df['Corrected_Splitting']<=103.1741034592534
     # Range for SC med density
     min_MD_SC_Split=df['Corrected_Splitting']>103.0608505403591
     max_MD_SC_Split=df['Corrected_Splitting']<=104.3836704771313
     # Range for SC high density
@@ -630,32 +663,53 @@
 
     # If SupCrit, high density
     df.loc[ SupCrit&(min_HD_SC_Split&max_HD_SC_Split), 'Preferred D'] = HighD_SC
     df.loc[ SupCrit&(min_HD_SC_Split&max_HD_SC_Split), 'Preferred D_'] = highD_error['HighD_Density_']
     df.loc[ SupCrit&(min_HD_SC_Split&max_HD_SC_Split), 'Preferred D__split'] = highD_error['HighD_Density__split']
     df.loc[ SupCrit&(min_HD_SC_Split&max_HD_SC_Split), 'Preferred D__dens'] = highD_error['HighD_Density__dens']
     df.loc[ SupCrit&(min_HD_SC_Split&max_HD_SC_Split), 'Notes']='SupCrit, high density'
-    # If SupCrit, Med density
-    df.loc[SupCrit&(min_MD_SC_Split&max_MD_SC_Split), 'Preferred D'] = MedD_SC
-    df.loc[SupCrit&(min_MD_SC_Split&max_MD_SC_Split), 'Preferred D_'] = medD_error['MedD_Density_']
-    df.loc[SupCrit&(min_MD_SC_Split&max_MD_SC_Split), 'Preferred D__split'] = medD_error['MedD_Density__split']
-    df.loc[SupCrit&(min_MD_SC_Split&max_MD_SC_Split), 'Preferred D__dens'] = medD_error['MedD_Density__dens']
-    df.loc[SupCrit&(min_MD_SC_Split&max_MD_SC_Split), 'Notes']='SupCrit, Med density'
+    
+    if temp!='RoomT':
+        df.loc[SupCrit&(min_MD_SC_Split&max_MD_SC_Split), 'Preferred D'] = MedD_SC
+        df.loc[SupCrit&(min_MD_SC_Split&max_MD_SC_Split), 'Preferred D_'] = medD_error['MedD_Density_']
+        df.loc[SupCrit&(min_MD_SC_Split&max_MD_SC_Split), 'Preferred D__split'] = medD_error['MedD_Density__split']
+        df.loc[SupCrit&(min_MD_SC_Split&max_MD_SC_Split), 'Preferred D__dens'] = medD_error['MedD_Density__dens']
+        df.loc[SupCrit&(min_MD_SC_Split&max_MD_SC_Split), 'Notes']='SupCrit, Med density'
 
     # If SupCrit, low density
     df.loc[ SupCrit&(min_lowD_SC_Split&max_lowD_SC_Split), 'Preferred D'] = LowD_SC
     df.loc[ SupCrit&(min_lowD_SC_Split&max_lowD_SC_Split), 'Preferred D_'] = lowD_error['LowD_Density_']
     df.loc[ SupCrit&(min_lowD_SC_Split&max_lowD_SC_Split), 'Preferred D__split'] = lowD_error['LowD_Density__split']
     df.loc[ SupCrit&(min_lowD_SC_Split&max_lowD_SC_Split), 'Preferred D__dens'] = lowD_error['LowD_Density__dens']
     df.loc[SupCrit&(min_lowD_SC_Split&max_lowD_SC_Split), 'Notes']='SupCrit, low density'
 
     # If Supcritical, and too low
     df.loc[SupCrit&(Too_Low_SC), 'Preferred D']=LowD_SC
     df.loc[SupCrit&(Too_Low_SC), 'Notes']='Below lower calibration limit'
     df.loc[SupCrit&(Too_Low_SC), 'in range']='N'
+    
+    
+    
+    # now lets do Room T ---------------------------------
+    df.loc[ roomT&(min_HD_SC_Split&max_HD_SC_Split), 'Preferred D'] = HighD_SC
+    df.loc[ roomT&(min_HD_SC_Split&max_HD_SC_Split), 'Preferred D_'] = highD_error['HighD_Density_']
+    df.loc[ roomT&(min_HD_SC_Split&max_HD_SC_Split), 'Preferred D__split'] = highD_error['HighD_Density__split']
+    df.loc[ roomT&(min_HD_SC_Split&max_HD_SC_Split), 'Preferred D__dens'] = highD_error['HighD_Density__dens']
+    df.loc[ roomT&(min_HD_SC_Split&max_HD_SC_Split), 'Notes']='roomT, high density'
+    
+    # If roomT, low density
+    df.loc[ roomT&(min_lowD_SC_Split&max_lowD_SC_Split), 'Preferred D'] = LowD_SC
+    df.loc[ roomT&(min_lowD_SC_Split&max_lowD_SC_Split), 'Preferred D_'] = lowD_error['LowD_Density_']
+    df.loc[ roomT&(min_lowD_SC_Split&max_lowD_SC_Split), 'Preferred D__split'] = lowD_error['LowD_Density__split']
+    df.loc[ roomT&(min_lowD_SC_Split&max_lowD_SC_Split), 'Preferred D__dens'] = lowD_error['LowD_Density__dens']
+    df.loc[roomT&(min_lowD_SC_Split&max_lowD_SC_Split), 'Notes']='roomT, low density'    
+    
+    
+    
+    
 
 
     # If RoomT, and too low
     df.loc[roomT&(Too_Low_RT), 'Preferred D']=LowD_RT
     df.loc[roomT&(Too_Low_RT), 'Notes']='Below lower calibration limit'
     df.loc[roomT&(Too_Low_RT), 'in range']='N'
 
@@ -727,29 +781,38 @@
     df_merge = df_merge.rename(columns={'Preferred D_': ' Density g/cm3'})
     df_merge = df_merge.rename(columns={'Preferred D__split': ' Density g/cm3 (from Ne+peakfit)'})
     df_merge = df_merge.rename(columns={'Preferred D__dens': ' Density g/cm3 (from densimeter)'})
     df_merge = df_merge.rename(columns={'filename_x': 'filename'})
     
 
 
-    #
-    #
 
-    if Ne_pickle_str is not None:
+    
+    
+    if Ne_pickle_str is not None: # If its not none, have all the columns for Ne
         cols_to_move = ['filename', 'Density g/cm3', ' Density g/cm3',' Density g/cm3 (from Ne+peakfit)', ' Density g/cm3 (from densimeter)',
         'Corrected_Splitting', 'Corrected_Splitting_',
         'Corrected_Splitting__Ne', 'Corrected_Splitting__peak_fit', 'power (mW)', 'Spectral Center']
         df_merge = df_merge[cols_to_move + [
             col for col in df_merge.columns if col not in cols_to_move]]
-    elif pref_Ne is not None:
+            
+    # If pref Ne is not none and you dont have a dataframe 
+    elif pref_Ne is not None and df_combo is not None: #If Pref Ne, 
         cols_to_move = ['filename', 'Density g/cm3', ' Density g/cm3',' Density g/cm3 (from Ne+peakfit)', ' Density g/cm3 (from densimeter)',
         'Corrected_Splitting', 'Corrected_Splitting_',
         'Corrected_Splitting__Ne', 'Corrected_Splitting__peak_fit']
         df_merge = df_merge[cols_to_move + [
             col for col in df_merge.columns if col not in cols_to_move]]
+            
+    elif df_combo is None:
+        
+        cols_to_move = ['Density g/cm3', ' Density g/cm3',' Density g/cm3 (from Ne+peakfit)', ' Density g/cm3 (from densimeter)',
+        'Corrected_Splitting']
+        df_merge = df_merge[cols_to_move + [
+            col for col in df_merge.columns if col not in cols_to_move]]
 
     
 
     return df_merge
 
 
 ## functions to neatly merge secondary phases in
@@ -902,15 +965,15 @@
 def calculate_density_ucb(*, Ne_line_combo='1117_1447', df_combo=None, temp='SupCrit', 
 CI_split=0.67, CI_neon=0.67,  Ne_pickle_str=None, pref_Ne=None, Ne_err=None, corrected_split=None, split_err=None):
     """ This function converts Diad Splitting into CO$_2$ density using the UC Berkeley calibration line
     developed by DeVitre and Wieser in 2023. 
 
     Parameters
     -------------
-    Ne_line_combo: str, '1117_1447', '1220_1447', '1220_1400'
+    Ne_line_combo: str, '1117_1447', '1117_1400', '1220_1447', '1220_1400', '1220_1567'
         Combination of Ne lines used for drift correction
         
     Either:
 
     df_combo: pandas DataFrame
         data frame of peak fitting information
         
@@ -1038,14 +1101,30 @@
         with open(DiadFit_dir/pickle_str_medr, 'rb') as f:
             medrho_pickle_data = pickle.load(f)
         # This gets the densimeter at high density.
         pickle_str_highr='Highrho_polyfit_dataUCB_1220_1400.pkl'
         with open(DiadFit_dir/pickle_str_highr, 'rb') as f:
             highrho_pickle_data = pickle.load(f)
             
+            
+    if Ne_line_combo=='1220_1567':
+       
+        pickle_str_lowr='Lowrho_polyfit_dataUCB_1220_1567.pkl'
+        with open(DiadFit_dir/pickle_str_lowr, 'rb') as f:
+            lowrho_pickle_data = pickle.load(f)
+
+        # This gets the densimeter at medium density
+        pickle_str_medr='Mediumrho_polyfit_dataUCB_1220_1567.pkl'
+        with open(DiadFit_dir/pickle_str_medr, 'rb') as f:
+            medrho_pickle_data = pickle.load(f)
+        # This gets the densimeter at high density.
+        pickle_str_highr='Highrho_polyfit_dataUCB_1220_1567.pkl'
+        with open(DiadFit_dir/pickle_str_highr, 'rb') as f:
+            highrho_pickle_data = pickle.load(f)
+            
     if Ne_line_combo=='1117_1400':
         pickle_str_lowr='Lowrho_polyfit_dataUCB_1117_1400.pkl'
         with open(DiadFit_dir/pickle_str_lowr, 'rb') as f:
             lowrho_pickle_data = pickle.load(f)
 
         # This gets the densimeter at medium density
         pickle_str_medr='Mediumrho_polyfit_dataUCB_1117_1400.pkl'
@@ -1121,37 +1200,38 @@
 
 
     roomT=df['Temperature']=="RoomT"
     SupCrit=df['Temperature']=="SupCrit"
     # If splitting is 0
     zero=df['Corrected_Splitting']==0
 
-    # Range for SC low density
-    min_lowD_SC_Split=df['Corrected_Splitting']>=102.7623598753032
-    max_lowD_SC_Split=df['Corrected_Splitting']<=103.1741034592534
+    
+    offset=0
+    if Ne_line_combo=='1220_1400':
+        offset=105.257-105.3438707618937
+
+    
+        
+    
+        
+        
+    min_lowD_SC_Split=df['Corrected_Splitting']>=102.7623598753032+offset
+    max_lowD_SC_Split=df['Corrected_Splitting']<=103.1741034592534+offset
     # Range for SC med density
-    min_MD_SC_Split=df['Corrected_Splitting']>103.0608505403591
-    max_MD_SC_Split=df['Corrected_Splitting']<=104.3836704771313
+    min_MD_SC_Split=df['Corrected_Splitting']>103.0608505403591+offset
+    max_MD_SC_Split=df['Corrected_Splitting']<=104.3836704771313+offset
     # Range for SC high density
-    min_HD_SC_Split=df['Corrected_Splitting']>=104.2538992302499
-    max_HD_SC_Split=df['Corrected_Splitting']<=105.3438707618937
-    # Range for Room T low density
-    min_lowD_RoomT_Split=df['Corrected_Splitting']>=102.734115670188
-    max_lowD_RoomT_Split=df['Corrected_Splitting']<=103.350311768435
-    # Range for Room T high density
-    min_HD_RoomT_Split=df['Corrected_Splitting']>=104.407308904012
-    max_HD_RoomT_Split=df['Corrected_Splitting']<=105.1
-    # Impossible densities, room T
-    Imposs_lower_end=(df['Corrected_Splitting']>103.350311768435) & (df['Corrected_Splitting']<103.88)
+    min_HD_SC_Split=df['Corrected_Splitting']>=104.2538992302499+offset
+    max_HD_SC_Split=df['Corrected_Splitting']<=105.3438707618937+offset
+    Too_Low_SC=df['Corrected_Splitting']<102.72+offset
+    Too_Low_RT=df['Corrected_Splitting']<102.734115670188+offset
+    
+    Imposs_lower_end=(df['Corrected_Splitting']>103.350311768435+offset) # & (df['Splitting']<103.88+offset)
     # Impossible densities, room T
-    Imposs_upper_end=(df['Corrected_Splitting']<104.407308904012) & (df['Corrected_Splitting']>103.88)
-    # Too low density
-    Too_Low_SC=df['Corrected_Splitting']<102.7623598753032
-    Too_Low_RT=df['Corrected_Splitting']<102.734115670188
-
+    Imposs_upper_end=(df['Corrected_Splitting']<105.3438707618937+offset)# & (df['Splitting']>103.88+offset)  
     df.loc[zero, 'Preferred D']=0
     df.loc[zero, 'Notes']=0
     
     # Assign to the right type to avoid annoying pandas 2 warning
     # Ensure the columns are of type float64
     df['Preferred D'] = df['Preferred D'].astype('float64', errors='ignore')
     df['Preferred D_'] = df['Preferred D_'].astype('float64', errors='ignore')
@@ -1272,9 +1352,71 @@
 
 
 
 
 
 
     return df_merge
+    
+    ## Method from FLuids laboratory from FRANCIS Program
+    
+
+
+def Francis_pureCO2(FDS, FDS_std, uncer_FDS, uncer_FDS_std=0):
+    """ Returns density using a densimeter made from a single CO2 standard
+    """
+    offset= 0.035089020233933815 # Calculated FDS at 0.01 g/cm3
+    FDS_normalized_1=(FDS - FDS_std) + (uncer_FDS**2 + uncer_FDS_std**2)**0.5 + offset
+    FDS_normalized=(FDS - FDS_std)  + offset
+    FDS_normalized_2=(FDS - FDS_std) - (uncer_FDS**2 + uncer_FDS_std**2)**0.5 + offset
+
+    p0= 0
+    p1= 148.73
+    p2= 20.946
+    p3= -180.85
+    p4= 96.503
+    p5= -9.8157
+
+    d0= 0
+    d1= +0.31273
+    d2= +0.11155
+    d3= -0.01843
+    d4= -0.0044
+    d5= 0
+
+
+    pressure1 = p5*FDS_normalized_1**5 + p4*FDS_normalized_1**4 + p3*FDS_normalized_1**3 + p2*FDS_normalized_1**2 +p1*FDS_normalized_1**1 + p0
+    pressure2 = p5*FDS_normalized_2**5 + p4*FDS_normalized_2**4 + p3*FDS_normalized_2**3 + p2*FDS_normalized_2**2 +p1*FDS_normalized_2**1 + p0
+    pressure_final = (pressure1 + pressure2)/2
+    uncer_pressure_final = 8.7 + (np.maximum(pressure1, pressure2) - np.minimum(pressure1, pressure2))/(2*np.sqrt(3))  #uncertainty=8
+
+
+    density1 = d5*FDS_normalized_1**5 + d4*FDS_normalized_1**4 + d3*FDS_normalized_1**3 + d2*FDS_normalized_1**2 + d1*FDS_normalized_1**1 + d0
+    density2 = d5*FDS_normalized_2**5 + d4*FDS_normalized_2**4 + d3*FDS_normalized_2**3 + d2*FDS_normalized_2**2 + d1*FDS_normalized_2**1 + d0
+    
+    densityPW = d5*FDS_normalized**5 + d4*FDS_normalized**4 + d3*FDS_normalized**3 + d2*FDS_normalized**2 + d1*FDS_normalized**1 + d0
+        
+    density_final = (density1 + density2)/2
+    uncer_density_final = 0.006 + (np.maximum(density1,density2)-np.minimum(density1,density2))/(2*np.sqrt(3)) #uncertainty = 0.003
+    
+
+    if len(FDS)==1:
+        df=pd.DataFrame(data={'Density': density_final,
+                                'Density_PW': densityPW,
+                           'Density_err': uncer_density_final,
+                           'Input_Split':FDS,
+                           'Split_err':uncer_FDS,
+                           'Split_Std':FDS_std,
+                           }, index=[0])
+    else:
+        df=pd.DataFrame(data={'Density': density_final,
+         'Density_PW': densityPW,
+                           'Density_err': uncer_density_final,
+                           'Input_Split':FDS,
+                           'Split_err':uncer_FDS,
+                           'Split_Std':FDS_std,
+
+                           })
+        
+    return df
```

### Comparing `DiadFit-0.0.85/src/DiadFit/density_depth_crustal_profiles.py` & `DiadFit-0.0.88/src/DiadFit/density_depth_crustal_profiles.py`

 * *Files 2% similar despite different names*

```diff
@@ -72,14 +72,41 @@
     if P<455.09090909:
         D=(4.578*10**(-8) *P**3) - (4.151*10**(-5) *P**2) + (4.652*10**(-2) *P)
     else:
         D=np.nan
 
     return D
 
+
+def denlinger_lerner(P_kbar):
+    """ Calculates depth for a given pressure using the Parameterization of Denlinger and Flinders (2022) with the addition of 200 kg/m3 at shallow depths, from Lerner et al. (2024).
+    After 15 km returns NaN following Lerner
+
+    Parameters
+    -------------
+    P_kbar: int, float, pd.series
+        Pressure in kbar
+
+    Returns
+    -------------
+    Depth in km (same datatype as input)
+
+
+    """
+
+    D=0.0684*P_kbar**3 - 0.5008*P_kbar**2 + 4.47*P_kbar
+    if D>15:
+        D=np.nan
+
+    return D
+
+
+
+
+
 def mavko_debari(P_kbar):
     """ Calculates depth for a given pressure using the parameterization of Mavko and Thompson (1983) and DeBari and Greene (2011)
     as given in Putirka (2017) Down the Crater Elements supplement, used for Cascades
 
     Parameters
     -------------
     P_kbar: int, float, pd.series
@@ -139,15 +166,15 @@
     """
     P=P_kbar
     D=4.88 + 3.30*P - 0.0137*(P - 18.01)**2
 
     return D
 
 
-Profile_funcs={ryan_lerner, mavko_debari, hill_zucca, prezzi, rasmussen}
+Profile_funcs={ryan_lerner, denlinger_lerner, mavko_debari, hill_zucca, prezzi, rasmussen}
 Profile_funcs_by_name= {p.__name__: p for p in Profile_funcs}
 
 
 ## Two and three step profiles
 def convert_pressure_depth_2step(P_kbar=None, d1=None, rho1=None, rho2=None, g=9.81):
     """ Converts Pressure to depth using a 2 step profile for int or float
 
@@ -219,15 +246,15 @@
         Depth in km
 
     """
     if type(P_kbar) is int or type(P_kbar) is float:
         depth_km_loop=convert_pressure_depth_2step(P_kbar,
             d1=d1, rho1=rho1, rho2=rho2, g=g)
     else:
-        depth_km_loop=np.empty(len(P_kbar))
+        depth_km_loop=np.zeros(len(P_kbar))
         for i in range(0, len(P_kbar)):
             depth_km_loop[i]=convert_pressure_depth_2step(P_kbar[i],
             d1=d1, rho1=rho1, rho2=rho2, g=g)
     return depth_km_loop
 
 
 def convert_pressure_depth_3step(P_kbar=None, d1=5, d2=14, g=9.81,
@@ -324,15 +351,15 @@
 
     """
     if type(P_kbar) is int or type(P_kbar) is float:
         depth_km_loop=convert_pressure_depth_3step(P_kbar,
             d1=d1, rho1=rho1, rho2=rho2, g=g)
     else:
 
-        depth_km_loop=np.empty(len(P_kbar))
+        depth_km_loop=np.zeros(len(P_kbar))
         for i in range(0, len(P_kbar)):
             depth_km_loop[i]=convert_pressure_depth_3step(P_kbar[i],
             d1=d1, d2=d2,rho1=rho1, rho2=rho2, rho3=rho3, g=g)
     return depth_km_loop
 
 
 
@@ -360,14 +387,19 @@
 
     model, choose from:
 
         ryan_lerner:
             Parameterization of Ryan 1987, actual equation from Lerner et al. 2021
             After 16.88 km (455 MPa), assume density is 2.746, as density turns around again. This profile is tweaked for Hawaii
 
+        denlinger_lerner:
+            Parameterization of Denlinger and Flinders (2022) with the addition of 200 kg/m3 at shallow depths, from Lerner et al. (2024).
+            After 15 km returns NaN following Lerner
+
+
         mavko_debari:
             Parameterization of Mavko and Thompson (1983) and DeBari and Greene (2011)
             as given in Putirka (2017) Down the Crater Elements supplement.
 
 
         hill_zucca:
             Parameterization of Hill and Zucca (1987),
@@ -459,20 +491,20 @@
 
             sig=inspect.signature(func)
 
             if isinstance(P_kbar, float) or isinstance(P_kbar, int):
                 D=func(P_kbar)
 
             if isinstance(P_kbar, pd.Series):
-                D=np.empty(len(P_kbar), float)
+                D=np.zeros(len(P_kbar), float)
                 for i in range(0, len(P_kbar)):
                     D[i]=func(P_kbar.iloc[i])
 
             if isinstance(P_kbar, np.ndarray):
-                D=np.empty(len(P_kbar), float)
+                D=np.zeros(len(P_kbar), float)
                 for i in range(0, len(P_kbar)):
                     D[i]=func(P_kbar[i])
 
     else:
         raise TypeError('You need to either enter a model, or a value for crust_dens_kgm3' )
```

### Comparing `DiadFit-0.0.85/src/DiadFit/diads.py` & `DiadFit-0.0.88/src/DiadFit/diads.py`

 * *Files 0% similar despite different names*

```diff
@@ -10,11002 +10,11030 @@
 00000090: 7369 616e 4d6f 6465 6c2c 2056 6f69 6774  sianModel, Voigt
 000000a0: 4d6f 6465 6c2c 204c 696e 6561 724d 6f64  Model, LinearMod
 000000b0: 656c 2c20 436f 6e73 7461 6e74 4d6f 6465  el, ConstantMode
 000000c0: 6c2c 2050 7365 7564 6f56 6f69 6774 4d6f  l, PseudoVoigtMo
 000000d0: 6465 6c2c 2050 6561 7273 6f6e 344d 6f64  del, Pearson4Mod
 000000e0: 656c 0a66 726f 6d20 7363 6970 792e 7369  el.from scipy.si
 000000f0: 676e 616c 2069 6d70 6f72 7420 6669 6e64  gnal import find
-00000100: 5f70 6561 6b73 2c20 6761 7573 7369 616e  _peaks, gaussian
-00000110: 0a69 6d70 6f72 7420 6f73 0a69 6d70 6f72  .import os.impor
-00000120: 7420 7265 0a66 726f 6d20 6f73 2069 6d70  t re.from os imp
-00000130: 6f72 7420 6c69 7374 6469 720a 6672 6f6d  ort listdir.from
-00000140: 206f 732e 7061 7468 2069 6d70 6f72 7420   os.path import 
-00000150: 6973 6669 6c65 2c20 6a6f 696e 0a66 726f  isfile, join.fro
-00000160: 6d20 4469 6164 4669 742e 696d 706f 7274  m DiadFit.import
-00000170: 696e 675f 6461 7461 5f66 696c 6573 2069  ing_data_files i
-00000180: 6d70 6f72 7420 2a0a 6672 6f6d 2074 7970  mport *.from typ
-00000190: 696e 6720 696d 706f 7274 2054 7570 6c65  ing import Tuple
-000001a0: 2c20 4f70 7469 6f6e 616c 0a66 726f 6d20  , Optional.from 
-000001b0: 6461 7461 636c 6173 7365 7320 696d 706f  dataclasses impo
-000001c0: 7274 2064 6174 6163 6c61 7373 0a69 6d70  rt dataclass.imp
-000001d0: 6f72 7420 6d61 7470 6c6f 746c 6962 2e70  ort matplotlib.p
-000001e0: 6174 6368 6573 2061 7320 7061 7463 6865  atches as patche
-000001f0: 730a 696d 706f 7274 2077 6172 6e69 6e67  s.import warning
-00000200: 7320 6173 2077 0a66 726f 6d20 7471 646d  s as w.from tqdm
-00000210: 2069 6d70 6f72 7420 7471 646d 0a66 726f   import tqdm.fro
-00000220: 6d20 6e75 6d70 7920 696d 706f 7274 2074  m numpy import t
-00000230: 7261 707a 0a66 726f 6d20 7363 6970 792e  rapz.from scipy.
-00000240: 696e 7465 6772 6174 6520 696d 706f 7274  integrate import
-00000250: 2073 696d 7073 0a66 726f 6d20 7363 6970   simps.from scip
-00000260: 792e 696e 7465 7270 6f6c 6174 6520 696d  y.interpolate im
-00000270: 706f 7274 2069 6e74 6572 7031 640a 0a23  port interp1d..#
-00000280: 2041 6c6c 6f77 6564 206d 6f64 656c 730a   Allowed models.
-00000290: 0a61 6c6c 6f77 6564 5f6d 6f64 656c 7320  .allowed_models 
-000002a0: 3d20 5b22 566f 6967 744d 6f64 656c 222c  = ["VoigtModel",
-000002b0: 2022 5073 6575 646f 566f 6967 744d 6f64   "PseudoVoigtMod
-000002c0: 656c 222c 2022 5065 6172 736f 6e34 4d6f  el", "Pearson4Mo
-000002d0: 6465 6c22 2c20 2253 6b65 7765 6456 6f69  del", "SkewedVoi
-000002e0: 6774 4d6f 6465 6c22 5d0a 0a23 2046 6f72  gtModel"]..# For
-000002f0: 2064 6562 7567 6769 6e0a 0a23 696d 706f   debuggin..#impo
-00000300: 7274 2077 6172 6e69 6e67 730a 2377 6172  rt warnings.#war
-00000310: 6e69 6e67 732e 7369 6d70 6c65 6669 6c74  nings.simplefilt
-00000320: 6572 2827 6572 726f 7227 290a 0a65 6e63  er('error')..enc
-00000330: 6f64 653d 2249 534f 2d38 3835 392d 3122  ode="ISO-8859-1"
-00000340: 0a23 2320 5261 7469 6f20 6f66 2064 6966  .## Ratio of dif
-00000350: 6665 7265 6e74 2070 6561 6b73 0a0a 6465  ferent peaks..de
-00000360: 6620 6361 6c63 756c 6174 655f 6d6f 6c65  f calculate_mole
-00000370: 5f66 7261 6374 696f 6e5f 3263 6f6d 7028  _fraction_2comp(
-00000380: 7065 616b 5f61 7265 615f 612c 2070 6561  peak_area_a, pea
-00000390: 6b5f 6172 6561 5f62 2c20 6372 6f73 735f  k_area_b, cross_
-000003a0: 7365 6374 696f 6e5f 612c 2063 726f 7373  section_a, cross
-000003b0: 5f73 6563 7469 6f6e 5f62 2c20 696e 7374  _section_b, inst
-000003c0: 7275 6d65 6e74 5f65 6666 5f61 2c20 696e  rument_eff_a, in
-000003d0: 7374 7275 6d65 6e74 5f65 6666 5f62 293a  strument_eff_b):
-000003e0: 0a20 2020 2022 2222 2054 6869 7320 6675  .    """ This fu
-000003f0: 6e63 7469 6f6e 2063 616c 6375 6c61 7465  nction calculate
-00000400: 7320 7468 6520 6d6f 6c61 7220 7261 7469  s the molar rati
-00000410: 6f6e 206f 6620 3220 636f 6d70 6f6e 656e  on of 2 componen
-00000420: 7473 2061 2061 6e64 2062 2062 6173 6564  ts a and b based
-00000430: 206f 6e20 7065 616b 2061 7265 6173 2c0a   on peak areas,.
-00000440: 2020 2020 6372 6f73 7320 7365 6374 696f      cross sectio
-00000450: 6e20 616e 6420 696e 7374 7275 6d65 6e74  n and instrument
-00000460: 2065 6666 6963 6965 6e63 790a 0a20 2020   efficiency..   
-00000470: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00000480: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a0a 2020  ------------..  
-00000490: 2020 7065 616b 5f61 7265 615f 613a 2069    peak_area_a: i
-000004a0: 6e74 2c20 666c 6f61 742c 2070 642e 5365  nt, float, pd.Se
-000004b0: 7269 6573 2c20 6e70 2e61 7272 6179 0a20  ries, np.array. 
-000004c0: 2020 2020 2020 2050 6561 6b20 6172 6561         Peak area
-000004d0: 206f 6620 636f 6d70 6f6e 656e 7420 610a   of component a.
-000004e0: 0a20 2020 2070 6561 6b5f 6172 6561 5f62  .    peak_area_b
-000004f0: 3a20 696e 742c 2066 6c6f 6174 2c20 7064  : int, float, pd
-00000500: 2e53 6572 6965 732c 206e 702e 6172 7261  .Series, np.arra
-00000510: 790a 2020 2020 2020 2020 5065 616b 2061  y.        Peak a
-00000520: 7265 6120 6f66 2063 6f6d 706f 6e65 6e74  rea of component
-00000530: 2062 0a0a 2020 2020 6372 6f73 735f 7365   b..    cross_se
-00000540: 6374 696f 6e5f 612c 2063 726f 7373 5f73  ction_a, cross_s
-00000550: 6563 7469 6f6e 5f61 3a20 696e 742c 2066  ection_a: int, f
-00000560: 6c6f 6174 0a20 2020 2020 2020 2052 616d  loat.        Ram
-00000570: 616e 2063 726f 7373 2073 6563 7469 6f6e  an cross section
-00000580: 2066 6f72 2063 6f6d 706f 6e65 6e74 2061   for component a
-00000590: 2061 6e64 2062 0a0a 2020 2020 696e 7374   and b..    inst
-000005a0: 7275 6d65 6e74 5f65 6666 5f61 2c20 696e  rument_eff_a, in
-000005b0: 7374 7275 6d65 6e74 5f65 6666 5f62 3a20  strument_eff_b: 
-000005c0: 696e 742c 2066 6c6f 6174 0a20 2020 2020  int, float.     
-000005d0: 2020 2049 6e73 7472 756d 656e 7420 6566     Instrument ef
-000005e0: 6665 6369 656e 6379 206f 6620 6120 616e  feciency of a an
-000005f0: 6420 622e 0a0a 2020 2020 5265 7475 726e  d b...    Return
-00000600: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-00000610: 2d2d 0a20 2020 2070 642e 4461 7461 4672  --.    pd.DataFr
-00000620: 616d 650a 2020 2020 2020 2020 4d6f 6c61  ame.        Mola
-00000630: 7220 7261 7469 6f20 6f66 2061 2f62 0a0a  r ratio of a/b..
-00000640: 0a20 2020 2022 2222 0a0a 2020 2020 5375  .    """..    Su
-00000650: 6d5f 7068 6173 655f 613d 7065 616b 5f61  m_phase_a=peak_a
-00000660: 7265 615f 612f 2863 726f 7373 5f73 6563  rea_a/(cross_sec
-00000670: 7469 6f6e 5f61 2a69 6e73 7472 756d 656e  tion_a*instrumen
-00000680: 745f 6566 665f 6129 0a20 2020 2053 756d  t_eff_a).    Sum
-00000690: 5f70 6861 7365 5f62 3d70 6561 6b5f 6172  _phase_b=peak_ar
-000006a0: 6561 5f62 2f28 6372 6f73 735f 7365 6374  ea_b/(cross_sect
-000006b0: 696f 6e5f 622a 696e 7374 7275 6d65 6e74  ion_b*instrument
-000006c0: 5f65 6666 5f62 290a 0a20 2020 2064 663d  _eff_b)..    df=
-000006d0: 7064 2e44 6174 6146 7261 6d65 2864 6174  pd.DataFrame(dat
-000006e0: 613d 7b27 413a 4220 6d6f 6c61 7220 7261  a={'A:B molar ra
-000006f0: 7469 6f27 3a20 5375 6d5f 7068 6173 655f  tio': Sum_phase_
-00000700: 612f 5375 6d5f 7068 6173 655f 627d 290a  a/Sum_phase_b}).
-00000710: 0a20 2020 2072 6574 7572 6e20 6466 0a64  .    return df.d
-00000720: 6566 2070 6c6f 745f 6469 6164 282a 2c70  ef plot_diad(*,p
-00000730: 6174 683d 4e6f 6e65 2c20 6669 6c65 6e61  ath=None, filena
-00000740: 6d65 3d4e 6f6e 652c 2066 696c 6574 7970  me=None, filetyp
-00000750: 653d 2757 6974 6563 5f41 5343 4949 272c  e='Witec_ASCII',
-00000760: 2053 7065 6374 7261 5f78 3d4e 6f6e 652c   Spectra_x=None,
-00000770: 2053 7065 6374 7261 5f79 3d4e 6f6e 6529   Spectra_y=None)
-00000780: 3a0a 2020 2020 2222 2254 6869 7320 6675  :.    """This fu
-00000790: 6e63 7469 6f6e 206d 616b 6573 2061 2070  nction makes a p
-000007a0: 6c6f 7420 6f66 2074 6865 2073 7065 6374  lot of the spect
-000007b0: 7261 2066 6f72 2061 2073 7065 6369 6669  ra for a specifi
-000007c0: 6320 6669 6c65 2074 6f20 616c 6c6f 7720  c file to allow 
-000007d0: 7669 7375 616c 2069 6e73 7065 6374 6f69  visual inspectoi
-000007e0: 6e0a 0a20 2020 2050 6172 616d 6574 6572  n..    Parameter
-000007f0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-00000800: 2d2d 2d2d 2d2d 0a20 2020 2045 6974 6865  ------.    Eithe
-00000810: 720a 0a20 2020 2070 6174 683a 2073 7472  r..    path: str
-00000820: 0a20 2020 2020 2020 2046 6f6c 6465 7220  .        Folder 
-00000830: 7768 6572 6520 7370 6563 7472 6120 6973  where spectra is
-00000840: 2073 746f 7265 640a 2020 2020 6669 6c65   stored.    file
-00000850: 6e61 6d65 3a20 7374 720a 2020 2020 2020  name: str.      
-00000860: 2020 4669 6c65 6e61 6d65 206f 6620 7370    Filename of sp
-00000870: 6563 6966 6963 2073 7065 6374 7261 2066  ecific spectra f
-00000880: 696c 6520 6f66 2069 6e74 6572 6573 740a  ile of interest.
-00000890: 2020 2020 6669 6c65 7479 7065 3a20 7374      filetype: st
-000008a0: 720a 2020 2020 2020 2020 6368 6f6f 7365  r.        choose
-000008b0: 2066 726f 6d20 2757 6974 6563 5f41 5343   from 'Witec_ASC
-000008c0: 4949 272c 2027 6865 6164 6c65 7373 5f74  II', 'headless_t
-000008d0: 7874 272c 2027 6865 6164 6c65 7373 5f63  xt', 'headless_c
-000008e0: 7376 272c 2027 6865 6164 5f63 7376 272c  sv', 'head_csv',
-000008f0: 2027 5769 7465 635f 4153 4349 4927 2c0a   'Witec_ASCII',.
-00000900: 2020 2020 2020 2020 2748 4f52 4942 415f          'HORIBA_
-00000910: 7478 7427 2c20 2752 656e 6973 6861 775f  txt', 'Renishaw_
-00000920: 7478 7427 0a20 2020 204f 720a 2020 2020  txt'.    Or.    
-00000930: 2020 2020 5370 6563 7472 615f 783a 206e      Spectra_x: n
-00000940: 702e 6172 7261 7920 6f66 2078 2063 6f6f  p.array of x coo
-00000950: 7264 696e 6174 6573 0a20 2020 2020 2020  rdinates.       
-00000960: 2053 7065 6374 7261 5f79 3a20 6e70 2e61   Spectra_y: np.a
-00000970: 7272 6179 206f 6620 7920 636f 6f72 6469  rray of y coordi
-00000980: 6e61 7465 730a 0a20 2020 2052 6574 7572  nates..    Retur
-00000990: 6e73 0a20 2020 2020 2020 2070 6c6f 7473  ns.        plots
-000009a0: 2066 6967 7572 6520 7769 7468 2063 6f6d   figure with com
-000009b0: 6d6f 6e20 7065 616b 7320 6f76 6572 6c61  mon peaks overla
-000009c0: 696e 0a0a 0a20 2020 2022 2222 0a20 2020  in...    """.   
-000009d0: 2069 6620 2743 5252 2720 696e 2066 696c   if 'CRR' in fil
-000009e0: 656e 616d 653a 0a20 2020 2020 2020 2066  ename:.        f
-000009f0: 696c 6574 7970 653d 2768 6561 646c 6573  iletype='headles
-00000a00: 735f 7478 7427 0a0a 2020 2020 6966 2053  s_txt'..    if S
-00000a10: 7065 6374 7261 5f78 2069 7320 4e6f 6e65  pectra_x is None
-00000a20: 3a0a 2020 2020 2020 2020 5370 6563 7472  :.        Spectr
-00000a30: 615f 6466 3d67 6574 5f64 6174 6128 7061  a_df=get_data(pa
-00000a40: 7468 3d70 6174 682c 2066 696c 656e 616d  th=path, filenam
-00000a50: 653d 6669 6c65 6e61 6d65 2c20 6669 6c65  e=filename, file
-00000a60: 7479 7065 3d66 696c 6574 7970 6529 0a0a  type=filetype)..
-00000a70: 2020 2020 2020 2020 5370 6563 7472 613d          Spectra=
-00000a80: 6e70 2e61 7272 6179 2853 7065 6374 7261  np.array(Spectra
-00000a90: 5f64 6629 0a0a 2020 2020 2020 2020 5370  _df)..        Sp
-00000aa0: 6563 7472 615f 783d 5370 6563 7472 615b  ectra_x=Spectra[
-00000ab0: 3a2c 2030 5d0a 2020 2020 2020 2020 5370  :, 0].        Sp
-00000ac0: 6563 7472 615f 793d 5370 6563 7472 615b  ectra_y=Spectra[
-00000ad0: 3a2c 2031 5d0a 0a0a 0a0a 2020 2020 6669  :, 1].....    fi
-00000ae0: 672c 2028 6178 3129 203d 2070 6c74 2e73  g, (ax1) = plt.s
-00000af0: 7562 706c 6f74 7328 312c 2031 2c20 6669  ubplots(1, 1, fi
-00000b00: 6773 697a 653d 2834 2c33 2929 0a0a 2020  gsize=(4,3))..  
-00000b10: 2020 6d69 6e79 3d6e 702e 6d69 6e28 5370    miny=np.min(Sp
-00000b20: 6563 7472 615f 7929 0a20 2020 206d 6178  ectra_y).    max
-00000b30: 793d 6e70 2e6d 6178 2853 7065 6374 7261  y=np.max(Spectra
-00000b40: 5f79 290a 2020 2020 6178 312e 706c 6f74  _y).    ax1.plot
-00000b50: 285b 3130 3930 2c20 3130 3930 5d2c 205b  ([1090, 1090], [
-00000b60: 6d69 6e79 2c20 6d61 7879 5d2c 2027 3a6b  miny, maxy], ':k
-00000b70: 272c 206c 6162 656c 3d27 4d61 676e 6573  ', label='Magnes
-00000b80: 6974 6527 290a 2020 2020 6178 312e 706c  ite').    ax1.pl
-00000b90: 6f74 285b 3131 3331 2c20 3131 3331 5d2c  ot([1131, 1131],
-00000ba0: 205b 6d69 6e79 2c20 6d61 7879 5d2c 2027   [miny, maxy], '
-00000bb0: 2d27 2c20 2061 6c70 6861 3d30 2e35 2c63  -',  alpha=0.5,c
-00000bc0: 6f6c 6f72 3d27 6772 6579 272c 206c 6162  olor='grey', lab
-00000bd0: 656c 3d27 416e 6879 6472 6974 652f 4d67  el='Anhydrite/Mg
-00000be0: 2d53 756c 6661 7465 2729 0a20 2020 2023  -Sulfate').    #
-00000bf0: 6178 312e 706c 6f74 285b 3131 3336 2c20  ax1.plot([1136, 
-00000c00: 3131 3336 5d2c 205b 6d69 6e79 2c20 6d61  1136], [miny, ma
-00000c10: 7879 5d2c 2027 2d27 2c20 636f 6c6f 723d  xy], '-', color=
-00000c20: 2767 7265 7927 2c20 6c61 6265 6c3d 274d  'grey', label='M
-00000c30: 672d 5375 6c66 6174 6527 290a 2020 2020  g-Sulfate').    
-00000c40: 6178 312e 706c 6f74 285b 3131 3531 2c20  ax1.plot([1151, 
-00000c50: 3131 3531 5d2c 205b 6d69 6e79 2c20 6d61  1151], [miny, ma
-00000c60: 7879 5d2c 2027 3a63 272c 206c 6162 656c  xy], ':c', label
-00000c70: 3d27 534f 3227 290a 2020 2020 6178 312e  ='SO2').    ax1.
-00000c80: 706c 6f74 285b 3132 3836 2c20 3132 3836  plot([1286, 1286
-00000c90: 5d2c 205b 6d69 6e79 2c20 6d61 7879 5d2c  ], [miny, maxy],
-00000ca0: 2027 2d67 272c 2020 616c 7068 613d 302e   '-g',  alpha=0.
-00000cb0: 352c 6c61 6265 6c3d 2744 6961 6431 2729  5,label='Diad1')
-00000cc0: 0a20 2020 2061 7831 2e70 6c6f 7428 5b31  .    ax1.plot([1
-00000cd0: 3338 392c 2031 3338 395d 2c20 5b6d 696e  389, 1389], [min
-00000ce0: 792c 206d 6178 795d 2c20 272d 6d27 2c20  y, maxy], '-m', 
-00000cf0: 616c 7068 613d 302e 352c 206c 6162 656c  alpha=0.5, label
-00000d00: 3d27 4469 6164 3227 290a 2020 2020 6178  ='Diad2').    ax
-00000d10: 312e 6c65 6765 6e64 2829 0a20 2020 2061  1.legend().    a
-00000d20: 7831 2e70 6c6f 7428 5370 6563 7472 615f  x1.plot(Spectra_
-00000d30: 782c 2053 7065 6374 7261 5f79 2c20 272d  x, Spectra_y, '-
-00000d40: 7227 290a 2020 2020 6178 312e 7365 745f  r').    ax1.set_
-00000d50: 786c 6162 656c 2827 5761 7665 6e75 6d62  xlabel('Wavenumb
-00000d60: 6572 2028 636d 2d31 2927 290a 2020 2020  er (cm-1)').    
-00000d70: 6178 312e 7365 745f 796c 6162 656c 2827  ax1.set_ylabel('
-00000d80: 496e 7465 6e73 6974 7927 290a 0a0a 0a0a  Intensity').....
-00000d90: 0a40 6461 7461 636c 6173 730a 636c 6173  .@dataclass.clas
-00000da0: 7320 6469 6164 5f69 645f 636f 6e66 6967  s diad_id_config
-00000db0: 3a0a 0a20 2020 2023 2054 6872 6573 686f  :..    # Thresho
-00000dc0: 6c64 7320 666f 7220 5363 6970 7920 6669  lds for Scipy fi
-00000dd0: 6e64 2070 6561 6b73 0a20 2020 2068 6569  nd peaks.    hei
-00000de0: 6768 743a 2066 6c6f 6174 203d 2031 0a20  ght: float = 1. 
-00000df0: 2020 2077 6964 7468 3a20 666c 6f61 743d     width: float=
-00000e00: 302e 350a 2020 2020 7072 6f6d 696e 656e  0.5.    prominen
-00000e10: 6365 3a20 666c 6f61 743d 3530 0a0a 2020  ce: float=50..  
-00000e20: 2020 2320 746f 2070 6c6f 7420 6f72 206e    # to plot or n
-00000e30: 6f74 2074 6f20 706c 6f74 0a20 2020 2070  ot to plot.    p
-00000e40: 6c6f 745f 6669 6775 7265 3a20 626f 6f6c  lot_figure: bool
-00000e50: 203d 2054 7275 650a 0a0a 2020 2020 2320   = True...    # 
-00000e60: 4578 636c 7564 6520 6120 7261 6e67 652c  Exclude a range,
-00000e70: 2065 2e67 2e20 636f 736d 6963 2072 6179   e.g. cosmic ray
-00000e80: 730a 2020 2020 6578 636c 7564 655f 7261  s.    exclude_ra
-00000e90: 6e67 6531 3a20 4f70 7469 6f6e 616c 205b  nge1: Optional [
-00000ea0: 5475 706c 655b 666c 6f61 742c 2066 6c6f  Tuple[float, flo
-00000eb0: 6174 5d5d 203d 204e 6f6e 650a 2020 2020  at]] = None.    
-00000ec0: 6578 636c 7564 655f 7261 6e67 6532 3a20  exclude_range2: 
-00000ed0: 4f70 7469 6f6e 616c 205b 5475 706c 655b  Optional [Tuple[
-00000ee0: 666c 6f61 742c 2066 6c6f 6174 5d5d 203d  float, float]] =
-00000ef0: 204e 6f6e 650a 2020 2020 2320 4170 7072   None.    # Appr
-00000f00: 6f78 696d 6174 6520 6469 6164 2070 6f73  oximate diad pos
-00000f10: 6974 696f 6e0a 2020 2020 6170 7072 6f78  ition.    approx
-00000f20: 5f64 6961 6432 5f70 6f73 3a20 5475 706c  _diad2_pos: Tupl
-00000f30: 655b 666c 6f61 742c 2066 6c6f 6174 5d3d  e[float, float]=
-00000f40: 2831 3337 392c 2031 3339 3529 0a20 2020  (1379, 1395).   
-00000f50: 2061 7070 726f 785f 6469 6164 315f 706f   approx_diad1_po
-00000f60: 733a 2054 7570 6c65 5b66 6c6f 6174 2c20  s: Tuple[float, 
-00000f70: 666c 6f61 745d 3d28 3132 3735 2c20 3132  float]=(1275, 12
-00000f80: 3930 290a 0a0a 2020 2020 2320 4261 636b  90)...    # Back
-00000f90: 6772 6f75 6e64 2070 6f73 6974 696f 6e73  ground positions
-00000fa0: 2066 6f72 2070 726f 6d69 6e65 6e63 650a   for prominence.
-00000fb0: 2020 2020 4c48 5f62 636b 5f64 6961 6431      LH_bck_diad1
-00000fc0: 3d5b 3131 3830 2c20 3132 3230 5d0a 2020  =[1180, 1220].  
-00000fd0: 2020 4c48 5f62 636b 5f64 6961 6432 3d5b    LH_bck_diad2=[
-00000fe0: 3133 3330 2c20 3133 3530 5d0a 2020 2020  1330, 1350].    
-00000ff0: 5248 5f62 636b 5f64 6961 6431 3d5b 3133  RH_bck_diad1=[13
-00001000: 3330 2c20 3133 3530 5d0a 2020 2020 5248  30, 1350].    RH
-00001010: 5f62 636b 5f64 6961 6432 3d5b 3134 3530  _bck_diad2=[1450
-00001020: 2c20 3134 3730 5d0a 0a20 2020 2044 6961  , 1470]..    Dia
-00001030: 645f 7769 6e64 6f77 5f77 6964 7468 3d33  d_window_width=3
-00001040: 300a 0a20 2020 2044 6961 6432 5f77 696e  0..    Diad2_win
-00001050: 646f 773a 2054 7570 6c65 5b66 6c6f 6174  dow: Tuple[float
-00001060: 2c20 666c 6f61 745d 3d28 6170 7072 6f78  , float]=(approx
-00001070: 5f64 6961 6432 5f70 6f73 5b30 5d2d 4469  _diad2_pos[0]-Di
-00001080: 6164 5f77 696e 646f 775f 7769 6474 682c  ad_window_width,
-00001090: 2061 7070 726f 785f 6469 6164 325f 706f   approx_diad2_po
-000010a0: 735b 315d 2b44 6961 645f 7769 6e64 6f77  s[1]+Diad_window
-000010b0: 5f77 6964 7468 290a 2020 2020 4469 6164  _width).    Diad
-000010c0: 315f 7769 6e64 6f77 3a20 5475 706c 655b  1_window: Tuple[
-000010d0: 666c 6f61 742c 2066 6c6f 6174 5d3d 2861  float, float]=(a
-000010e0: 7070 726f 785f 6469 6164 315f 706f 735b  pprox_diad1_pos[
-000010f0: 305d 2d44 6961 645f 7769 6e64 6f77 5f77  0]-Diad_window_w
-00001100: 6964 7468 2c20 6170 7072 6f78 5f64 6961  idth, approx_dia
-00001110: 6431 5f70 6f73 5b31 5d29 0a0a 2020 2020  d1_pos[1])..    
-00001120: 6170 7072 6f78 5f64 6961 6432 5f70 6f73  approx_diad2_pos
-00001130: 5f33 7065 616b 733a 2054 7570 6c65 5b66  _3peaks: Tuple[f
-00001140: 6c6f 6174 2c20 666c 6f61 745d 3d28 3133  loat, float]=(13
-00001150: 3739 2c20 3133 3935 2c20 3133 3739 2d31  79, 1395, 1379-1
-00001160: 3729 0a0a 0a0a 0a0a 0a64 6566 2069 6465  7).......def ide
-00001170: 6e74 6966 795f 6469 6164 5f70 6561 6b73  ntify_diad_peaks
-00001180: 282a 2c20 636f 6e66 6967 3a20 6469 6164  (*, config: diad
-00001190: 5f69 645f 636f 6e66 6967 3d64 6961 645f  _id_config=diad_
-000011a0: 6964 5f63 6f6e 6669 6728 292c 2070 6174  id_config(), pat
-000011b0: 683d 4e6f 6e65 2c20 6669 6c65 6e61 6d65  h=None, filename
-000011c0: 3d4e 6f6e 652c 2064 6961 645f 6172 7261  =None, diad_arra
-000011d0: 793d 4e6f 6e65 2c0a 2066 696c 6574 7970  y=None,. filetyp
-000011e0: 653d 2757 6974 6563 5f41 5343 4949 272c  e='Witec_ASCII',
-000011f0: 2020 706c 6f74 5f66 6967 7572 653d 5472    plot_figure=Tr
-00001200: 7565 293a 0a0a 2020 2020 2222 2220 5468  ue):..    """ Th
-00001210: 6973 2066 756e 6374 696f 6e20 6669 7473  is function fits
-00001220: 2061 2073 706c 696e 6520 746f 2074 6865   a spline to the
-00001230: 2073 7065 6374 7261 6c20 6461 7461 2e20   spectral data. 
-00001240: 4974 2074 6865 6e20 7573 6573 2053 6369  It then uses Sci
-00001250: 7079 2066 696e 6420 7065 616b 7320 746f  py find peaks to
-00001260: 2069 6465 6e74 6966 7920 7468 6520 6469   identify the di
-00001270: 6164 2c0a 2020 2020 4842 2061 6e64 2043  ad,.    HB and C
-00001280: 3133 2070 6561 6b73 2e20 4974 206f 7574  13 peaks. It out
-00001290: 7075 7473 2070 6172 616d 6574 6572 7320  puts parameters 
-000012a0: 7375 6368 2061 7320 7065 616b 2070 6f73  such as peak pos
-000012b0: 6974 696f 6e73 2c20 7065 616b 2070 726f  itions, peak pro
-000012c0: 6d69 6e65 6e63 6573 2c0a 2020 2020 616e  minences,.    an
-000012d0: 6420 7065 616b 2068 6569 6768 7420 7261  d peak height ra
-000012e0: 7469 6f73 2074 6861 7420 6361 6e20 6265  tios that can be
-000012f0: 2076 6572 7920 7573 6566 756c 2077 6865   very useful whe
-00001300: 6e20 7370 6c69 7474 696e 6720 6461 7461  n splitting data
-00001310: 2069 6e74 6f20 6772 6f75 7073 2e0a 2020   into groups..  
-00001320: 2020 4974 2075 7365 7320 696e 666f 726d    It uses inform
-00001330: 6174 696f 6e20 7374 6f72 6564 2069 6e20  ation stored in 
-00001340: 6469 6164 5f69 645f 636f 6e66 6967 2066  diad_id_config f
-00001350: 6f72 206d 6f73 7420 7061 7261 6d65 7465  or most paramete
-00001360: 7273 0a0a 2020 2020 5061 7261 6d65 7465  rs..    Paramete
-00001370: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00001380: 2d2d 2d2d 0a20 2020 2063 6f6e 6669 673a  ----.    config:
-00001390: 2064 6174 6163 6c61 7373 0a20 2020 2020   dataclass.     
-000013a0: 2020 2054 6869 7320 6973 2064 6961 645f     This is diad_
-000013b0: 6964 5f63 6f6e 6669 672c 2077 6869 6368  id_config, which
-000013c0: 2079 6f75 2073 686f 756c 6420 6564 6974   you should edit
-000013d0: 2062 6566 6f72 6520 796f 7520 6665 6564   before you feed
-000013e0: 2069 6e74 6f20 7468 6520 6675 6e63 7469   into the functi
-000013f0: 6f6e 2074 6f20 6164 6a75 7374 2070 6561  on to adjust pea
-00001400: 6b20 6669 6e64 696e 670a 2020 2020 2020  k finding.      
-00001410: 2020 7061 7261 6d65 7465 7273 2e20 452e    parameters. E.
-00001420: 672e 2074 6f20 6368 616e 6765 2070 726f  g. to change pro
-00001430: 6d69 6e65 6e63 6520 6f66 2070 6561 6b73  minence of peaks
-00001440: 2066 6f75 6e64 2062 7920 7363 6970 792c   found by scipy,
-00001450: 2064 6f20 636f 6e66 6967 3d70 662e 6469   do config=pf.di
-00001460: 6164 5f69 645f 636f 6e66 6967 2870 726f  ad_id_config(pro
-00001470: 6d69 6e65 6e63 653d 3132 292c 0a20 2020  minence=12),.   
-00001480: 2020 2020 2074 6865 6e20 696e 7075 7420       then input 
-00001490: 696e 746f 2074 6869 7320 6675 6e63 7469  into this functi
-000014a0: 6f6e 0a0a 2020 2020 2020 2020 5468 696e  on..        Thin
-000014b0: 6773 2074 6861 7420 6361 6e20 6265 2061  gs that can be a
-000014c0: 646a 7573 7465 6420 696e 2074 6869 7320  djusted in this 
-000014d0: 636f 6e66 6967 2066 696c 650a 2020 2020  config file.    
-000014e0: 2020 2020 2020 2020 6865 6967 6874 3a20          height: 
-000014f0: 3120 2874 6872 6573 686f 6c64 2068 6569  1 (threshold hei
-00001500: 6768 7420 666f 7220 5363 6970 7920 6669  ght for Scipy fi
-00001510: 6e64 2070 6561 6b73 290a 2020 2020 2020  nd peaks).      
-00001520: 2020 2020 2020 7769 6474 683a 2030 2e35        width: 0.5
-00001530: 2028 7468 7265 7368 6f6c 6420 7769 6474   (threshold widt
-00001540: 6820 666f 7220 5363 6970 7920 6669 6e64  h for Scipy find
-00001550: 2070 6561 6b73 290a 2020 2020 2020 2020   peaks).        
-00001560: 2020 2020 7072 6f6d 696e 656e 6365 3a20      prominence: 
-00001570: 3530 2028 7468 7265 7368 6f6c 6420 7072  50 (threshold pr
-00001580: 6f6d 696e 656e 6365 2066 6f72 2073 6369  ominence for sci
-00001590: 7079 2066 696e 6420 7065 616b 7329 0a20  py find peaks). 
-000015a0: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
-000015b0: 6465 5f72 616e 6765 313a 204e 6f6e 6520  de_range1: None 
-000015c0: 2864 6566 6175 6c74 2029 206f 7220 6c69  (default ) or li
-000015d0: 7374 202d 2065 7863 6c75 6465 7320 6120  st - excludes a 
-000015e0: 6365 7274 6169 6e20 7265 6769 6f6e 206f  certain region o
-000015f0: 6620 7468 6520 7370 6563 7472 6120 2865  f the spectra (e
-00001600: 2e67 2c20 5b31 3230 302c 2031 3235 305d  .g, [1200, 1250]
-00001610: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-00001620: 636c 7564 655f 7261 6e67 6532 3a20 4e6f  clude_range2: No
-00001630: 6e65 2028 6465 6661 756c 7420 2920 6f72  ne (default ) or
-00001640: 206c 6973 7420 2d20 6578 636c 7564 6573   list - excludes
-00001650: 2061 2063 6572 7461 696e 2072 6567 696f   a certain regio
-00001660: 6e20 6f66 2074 6865 2073 7065 6374 7261  n of the spectra
-00001670: 2028 652e 672c 205b 3133 3030 2c20 3133   (e.g, [1300, 13
-00001680: 3130 5d29 0a20 2020 2020 2020 2020 2020  10]).           
-00001690: 2044 6961 645f 7769 6e64 6f77 5f77 6964   Diad_window_wid
-000016a0: 7468 3a20 3330 202d 2057 696e 646f 7720  th: 30 - Window 
-000016b0: 746f 2074 6865 206c 6566 7420 6f66 2044  to the left of D
-000016c0: 6961 6431 2061 6e64 2074 6f20 7468 6520  iad1 and to the 
-000016d0: 7269 6768 7420 6f66 2044 6961 6432 2074  right of Diad2 t
-000016e0: 6f20 6c6f 6f6b 2066 6f20 7264 6961 6420  o look fo rdiad 
-000016f0: 2b20 686f 7462 616e 6473 2e0a 2020 2020  + hotbands..    
-00001700: 2020 2020 2020 2020 6170 7072 6f78 5f64          approx_d
-00001710: 6961 6432 5f70 6f73 3a20 2831 3337 392c  iad2_pos: (1379,
-00001720: 2031 3339 3529 202d 2052 6567 696f 6e20   1395) - Region 
-00001730: 666f 7220 636f 6465 2074 6f20 6c6f 6f6b  for code to look
-00001740: 2066 6f72 2064 6961 6432 2028 2b2d 4469   for diad2 (+-Di
-00001750: 6164 5f77 696e 646f 775f 7769 6474 6829  ad_window_width)
-00001760: 2e0a 2020 2020 2020 2020 2020 2020 6170  ..            ap
-00001770: 7072 6f78 5f64 6961 6431 5f70 6f73 3a20  prox_diad1_pos: 
-00001780: 2831 3237 352c 2031 3239 3029 202d 2052  (1275, 1290) - R
-00001790: 6567 696f 6e20 666f 7220 636f 6465 2074  egion for code t
-000017a0: 6f20 6c6f 6f6b 2066 6f72 2064 6961 6431  o look for diad1
-000017b0: 2028 2b2d 4469 6164 5f77 696e 646f 775f   (+-Diad_window_
-000017c0: 7769 6474 6829 2e0a 2020 2020 2020 2020  width)..        
-000017d0: 2020 2020 4c48 5f62 636b 5f64 6961 6431      LH_bck_diad1
-000017e0: 2c20 4c48 5f62 636b 5f64 6961 6432 2c20  , LH_bck_diad2, 
-000017f0: 5248 5f62 636b 5f64 6961 6431 2c20 5248  RH_bck_diad1, RH
-00001800: 5f62 636b 5f64 6961 6432 3a20 506f 7369  _bck_diad2: Posi
-00001810: 7469 6f6e 7320 6569 7468 6572 2073 6964  tions either sid
-00001820: 6520 6f66 2070 6561 6b73 2074 6f20 6361  e of peaks to ca
-00001830: 6c63 756c 6174 6520 7072 6f6d 696e 656e  lculate prominen
-00001840: 6365 7320 2865 2e67 2e20 4c48 5f62 636b  ces (e.g. LH_bck
-00001850: 5f64 6961 6431 3d5b 3131 3830 2c20 3132  _diad1=[1180, 12
-00001860: 3230 5d29 0a0a 0a20 2020 2070 6174 683a  20])...    path:
-00001870: 2073 7472 0a20 2020 2020 2020 2050 6174   str.        Pat
-00001880: 6820 7768 6572 6520 7370 6563 7472 6120  h where spectra 
-00001890: 6973 2073 746f 7265 640a 0a20 2020 2066  is stored..    f
-000018a0: 696c 656e 616d 653a 2073 7472 0a20 2020  ilename: str.   
-000018b0: 2020 2020 2053 7065 6369 6669 6320 6e61       Specific na
-000018c0: 6d65 206f 6620 6669 6c65 2062 6569 6e67  me of file being
-000018d0: 2070 6c6f 7474 6564 0a0a 2020 2020 6669   plotted..    fi
-000018e0: 6c65 7479 7065 3a20 7374 720a 2020 2020  letype: str.    
-000018f0: 2020 2020 6368 6f6f 7365 2066 726f 6d20      choose from 
-00001900: 2757 6974 6563 5f41 5343 4949 272c 2027  'Witec_ASCII', '
-00001910: 6865 6164 6c65 7373 5f74 7874 272c 2027  headless_txt', '
-00001920: 6865 6164 6c65 7373 5f63 7376 272c 2027  headless_csv', '
-00001930: 6865 6164 5f63 7376 272c 2027 5769 7465  head_csv', 'Wite
-00001940: 635f 4153 4349 4927 2c0a 2020 2020 2020  c_ASCII',.      
-00001950: 2020 2748 4f52 4942 415f 7478 7427 2c20    'HORIBA_txt', 
-00001960: 2752 656e 6973 6861 775f 7478 7427 0a0a  'Renishaw_txt'..
-00001970: 2020 2020 706c 6f74 5f66 6967 7572 653a      plot_figure:
-00001980: 2062 6f6f 6c0a 2020 2020 2020 2020 6966   bool.        if
-00001990: 2054 7275 652c 2070 6c6f 7473 2061 2066   True, plots a f
-000019a0: 6967 7572 6520 6f66 2070 6561 6b73 2c20  igure of peaks, 
-000019b0: 616e 6420 7468 6520 6964 656e 7469 6669  and the identifi
-000019c0: 6564 2070 6561 6b73 2074 6861 7420 5363  ed peaks that Sc
-000019d0: 6970 7920 666f 756e 640a 0a20 2020 2052  ipy found..    R
-000019e0: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
-000019f0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2070 642e  --------.    pd.
-00001a00: 4461 7461 4672 616d 650a 2020 2020 2020  DataFrame.      
-00001a10: 2020 4461 7461 6672 616d 6520 6f66 2061    Dataframe of a
-00001a20: 7070 726f 7869 6d61 7465 2070 6561 6b20  pproximate peak 
-00001a30: 706f 7369 7469 6f6e 732c 2070 726f 6d69  positions, promi
-00001a40: 6e65 6e63 6573 2c20 6574 632e 0a0a 2020  nences, etc...  
-00001a50: 2020 6e70 2e61 7272 6179 206f 6620 7820    np.array of x 
-00001a60: 616e 6420 7920 636f 6f72 6469 6e61 7465  and y coordinate
-00001a70: 7320 6f66 2073 7065 6374 7261 0a0a 2020  s of spectra..  
-00001a80: 2020 6669 6775 7265 2069 6620 706c 6f74    figure if plot
-00001a90: 5f66 6967 7572 6520 6973 2054 7275 650a  _figure is True.
-00001aa0: 0a0a 2020 2020 2222 220a 2020 2020 6966  ..    """.    if
-00001ab0: 2064 6961 645f 6172 7261 7920 6973 204e   diad_array is N
-00001ac0: 6f6e 653a 0a20 2020 2020 2020 2044 6961  one:.        Dia
-00001ad0: 645f 6466 3d67 6574 5f64 6174 6128 7061  d_df=get_data(pa
-00001ae0: 7468 3d70 6174 682c 2066 696c 656e 616d  th=path, filenam
-00001af0: 653d 6669 6c65 6e61 6d65 2c20 6669 6c65  e=filename, file
-00001b00: 7479 7065 3d66 696c 6574 7970 6529 0a20  type=filetype). 
-00001b10: 2020 2020 2020 2044 6961 643d 6e70 2e61         Diad=np.a
-00001b20: 7272 6179 2844 6961 645f 6466 290a 2020  rray(Diad_df).  
-00001b30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00001b40: 4469 6164 3d64 6961 645f 6172 7261 790a  Diad=diad_array.
-00001b50: 0a0a 0a20 2020 2023 2046 6972 7374 206c  ...    # First l
-00001b60: 6574 7320 7573 6520 6669 6e64 2070 6561  ets use find pea
-00001b70: 6b73 0a20 2020 2079 5f69 6e3d 4469 6164  ks.    y_in=Diad
-00001b80: 5b3a 2c20 315d 0a20 2020 2078 5f69 6e3d  [:, 1].    x_in=
-00001b90: 4469 6164 5b3a 2c20 305d 0a20 2020 2073  Diad[:, 0].    s
-00001ba0: 7065 635f 7265 733d 6e70 2e61 6273 2878  pec_res=np.abs(x
-00001bb0: 5f69 6e5b 315d 2d78 5f69 6e5b 305d 290a  _in[1]-x_in[0]).
-00001bc0: 0a20 2020 2023 204e 6f77 206c 6574 7320  .    # Now lets 
-00001bd0: 6669 7420 6120 6375 6269 6320 7370 6c69  fit a cubic spli
-00001be0: 6e65 2074 6f20 736d 6f6f 6f74 6820 6974  ne to smoooth it
-00001bf0: 2061 6c6c 206f 7574 2061 2062 6974 0a20   all out a bit. 
-00001c00: 2020 2023 2047 6574 2078 2061 6e64 2079     # Get x and y
-00001c10: 2072 6561 6479 2074 6f20 6d61 6b65 2061   ready to make a
-00001c20: 2063 7562 6963 2073 706c 696e 6520 7468   cubic spline th
-00001c30: 726f 7567 6820 6461 7461 0a20 2020 2023  rough data.    #
-00001c40: 2046 6974 2061 2020 6375 6269 6320 7370   Fit a  cubic sp
-00001c50: 6c69 6e65 0a20 2020 2066 3220 3d20 696e  line.    f2 = in
-00001c60: 7465 7270 3164 2878 5f69 6e2c 2079 5f69  terp1d(x_in, y_i
-00001c70: 6e2c 206b 696e 643d 2763 7562 6963 2729  n, kind='cubic')
-00001c80: 0a20 2020 2078 5f6e 6577 3d6e 702e 6c69  .    x_new=np.li
-00001c90: 6e73 7061 6365 286e 702e 6d69 6e28 785f  nspace(np.min(x_
-00001ca0: 696e 292c 206e 702e 6d61 7828 785f 696e  in), np.max(x_in
-00001cb0: 292c 2031 3030 3030 3029 0a0a 2020 2020  ), 100000)..    
-00001cc0: 795f 6375 623d 6632 2878 5f6e 6577 290a  y_cub=f2(x_new).
-00001cd0: 0a20 2020 2079 3d79 5f63 7562 0a20 2020  .    y=y_cub.   
-00001ce0: 2078 3d78 5f6e 6577 0a0a 0a0a 2020 2020   x=x_new....    
-00001cf0: 2320 5370 6163 696e 6720 6f66 2068 6f74  # Spacing of hot
-00001d00: 6261 6e64 2066 726f 6d20 6d61 696e 2070  band from main p
-00001d10: 6561 6b0a 2020 2020 6469 6164 325f 4842  eak.    diad2_HB
-00001d20: 325f 6d69 6e5f 6f66 6673 6574 3d31 392d  2_min_offset=19-
-00001d30: 7370 6563 5f72 6573 0a20 2020 2064 6961  spec_res.    dia
-00001d40: 6432 5f48 4232 5f6d 6178 5f6f 6666 7365  d2_HB2_max_offse
-00001d50: 743d 3233 2b73 7065 635f 7265 730a 0a20  t=23+spec_res.. 
-00001d60: 2020 2023 2053 7061 6369 6e67 206f 6620     # Spacing of 
-00001d70: 4842 2066 726f 6d20 6d61 696e 2070 6561  HB from main pea
-00001d80: 6b2e 0a20 2020 2064 6961 6431 5f48 4231  k..    diad1_HB1
-00001d90: 5f6d 696e 5f6f 6666 7365 743d 3139 2d73  _min_offset=19-s
-00001da0: 7065 635f 7265 730a 2020 2020 6469 6164  pec_res.    diad
-00001db0: 315f 4842 315f 6d61 785f 6f66 6673 6574  1_HB1_max_offset
-00001dc0: 3d32 332b 7370 6563 5f72 6573 0a0a 2020  =23+spec_res..  
-00001dd0: 2020 2320 5370 6163 696e 6720 6f66 2063    # Spacing of c
-00001de0: 3133 2066 726f 6d20 6d61 696e 2070 6561  13 from main pea
-00001df0: 6b0a 2020 2020 6469 6164 325f 4331 335f  k.    diad2_C13_
-00001e00: 6d69 6e5f 6f66 6673 6574 3d31 362e 352d  min_offset=16.5-
-00001e10: 7370 6563 5f72 6573 0a20 2020 2064 6961  spec_res.    dia
-00001e20: 6432 5f43 3133 5f6d 6178 5f6f 6666 7365  d2_C13_max_offse
-00001e30: 743d 3230 2b73 7065 635f 7265 730a 0a20  t=20+spec_res.. 
-00001e40: 2020 2070 6561 6b73 203d 2066 696e 645f     peaks = find_
-00001e50: 7065 616b 7328 792c 2068 6569 6768 7420  peaks(y, height 
-00001e60: 3d20 636f 6e66 6967 2e68 6569 6768 742c  = config.height,
-00001e70: 2070 726f 6d69 6e65 6e63 653d 636f 6e66   prominence=conf
-00001e80: 6967 2e70 726f 6d69 6e65 6e63 652c 2077  ig.prominence, w
-00001e90: 6964 7468 3d63 6f6e 6669 672e 7769 6474  idth=config.widt
-00001ea0: 6829 0a0a 0a20 2020 2023 2054 6869 7320  h)...    # This 
-00001eb0: 6765 7473 2074 6865 206c 6973 7420 6f66  gets the list of
-00001ec0: 2070 6561 6b20 706f 7369 7469 6f6e 732e   peak positions.
-00001ed0: 0a20 2020 2070 6561 6b5f 706f 7320 3d20  .    peak_pos = 
-00001ee0: 785b 7065 616b 735b 305d 5d0a 2020 2020  x[peaks[0]].    
-00001ef0: 6865 6967 6874 203d 2070 6561 6b73 5b31  height = peaks[1
-00001f00: 5d5b 2770 6561 6b5f 6865 6967 6874 7327  ]['peak_heights'
-00001f10: 5d0a 2020 2020 6466 3d70 642e 4461 7461  ].    df=pd.Data
-00001f20: 4672 616d 6528 6461 7461 3d7b 2770 6f73  Frame(data={'pos
-00001f30: 273a 2070 6561 6b5f 706f 732c 0a20 2020  ': peak_pos,.   
-00001f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001f50: 2020 2020 2027 6865 6967 6874 273a 2068       'height': h
-00001f60: 6569 6768 747d 290a 0a20 2020 2023 2048  eight})..    # H
-00001f70: 6572 652c 2077 6520 6172 6520 6c6f 6f6b  ere, we are look
-00001f80: 696e 6720 666f 7220 7065 616b 7320 696e  ing for peaks in
-00001f90: 2074 6865 2064 6961 6420 7769 6e64 6f77   the diad window
-00001fa0: 2e0a 0a20 2020 2064 665f 706b 735f 6469  ...    df_pks_di
-00001fb0: 6164 313d 6466 5b28 6466 5b27 706f 7327  ad1=df[(df['pos'
-00001fc0: 5d3e 636f 6e66 6967 2e44 6961 6431 5f77  ]>config.Diad1_w
-00001fd0: 696e 646f 775b 305d 2920 2620 2864 665b  indow[0]) & (df[
-00001fe0: 2770 6f73 275d 3c63 6f6e 6669 672e 4469  'pos']<config.Di
-00001ff0: 6164 315f 7769 6e64 6f77 5b31 5d29 205d  ad1_window[1]) ]
-00002000: 0a0a 2020 2020 2320 4669 6e64 2070 6561  ..    # Find pea
-00002010: 6b73 2077 6974 6869 6e20 7468 6520 326e  ks within the 2n
-00002020: 6420 6469 6164 2077 696e 646f 770a 2020  d diad window.  
-00002030: 2020 6466 5f70 6b73 5f64 6961 6432 3d64    df_pks_diad2=d
-00002040: 665b 2864 665b 2770 6f73 275d 3e63 6f6e  f[(df['pos']>con
-00002050: 6669 672e 4469 6164 325f 7769 6e64 6f77  fig.Diad2_window
-00002060: 5b30 5d29 2026 2028 6466 5b27 706f 7327  [0]) & (df['pos'
-00002070: 5d3c 636f 6e66 6967 2e44 6961 6432 5f77  ]<config.Diad2_w
-00002080: 696e 646f 775b 315d 2920 5d0a 0a0a 2020  indow[1]) ]...  
-00002090: 2020 2320 4669 6e64 204e 2068 6967 6865    # Find N highe
-000020a0: 7374 2070 6561 6b73 2077 6974 6869 6e20  st peaks within 
-000020b0: 7261 6e67 6520 796f 7520 6861 7665 2073  range you have s
-000020c0: 656c 6563 7465 642e 0a20 2020 2064 665f  elected..    df_
-000020d0: 736f 7274 5f64 6961 6431 3d64 665f 706b  sort_diad1=df_pk
-000020e0: 735f 6469 6164 312e 736f 7274 5f76 616c  s_diad1.sort_val
-000020f0: 7565 7328 2768 6569 6768 7427 2c20 6178  ues('height', ax
-00002100: 6973 3d30 2c20 6173 6365 6e64 696e 673d  is=0, ascending=
-00002110: 4661 6c73 6529 0a20 2020 2069 6620 6c65  False).    if le
-00002120: 6e28 6466 5f73 6f72 745f 6469 6164 3129  n(df_sort_diad1)
-00002130: 3e32 3a0a 2020 2020 2020 2020 6466 5f73  >2:.        df_s
-00002140: 6f72 745f 6469 6164 315f 7472 696d 3d64  ort_diad1_trim=d
-00002150: 665f 736f 7274 5f64 6961 6431 2023 5b30  f_sort_diad1 #[0
-00002160: 3a32 5d0a 2020 2020 656c 7365 3a0a 2020  :2].    else:.  
-00002170: 2020 2020 2020 6466 5f73 6f72 745f 6469        df_sort_di
-00002180: 6164 315f 7472 696d 3d64 665f 736f 7274  ad1_trim=df_sort
-00002190: 5f64 6961 6431 0a0a 2020 2020 6466 5f73  _diad1..    df_s
-000021a0: 6f72 745f 6469 6164 323d 6466 5f70 6b73  ort_diad2=df_pks
-000021b0: 5f64 6961 6432 2e73 6f72 745f 7661 6c75  _diad2.sort_valu
-000021c0: 6573 2827 6865 6967 6874 272c 2061 7869  es('height', axi
-000021d0: 733d 302c 2061 7363 656e 6469 6e67 3d46  s=0, ascending=F
-000021e0: 616c 7365 290a 2020 2020 6966 206c 656e  alse).    if len
-000021f0: 2864 665f 736f 7274 5f64 6961 6432 293e  (df_sort_diad2)>
-00002200: 333a 0a20 2020 2020 2020 2064 665f 736f  3:.        df_so
-00002210: 7274 5f64 6961 6432 5f74 7269 6d3d 6466  rt_diad2_trim=df
-00002220: 5f73 6f72 745f 6469 6164 3220 2023 5b30  _sort_diad2  #[0
-00002230: 3a33 5d0a 0a20 2020 2065 6c73 653a 0a20  :3]..    else:. 
-00002240: 2020 2020 2020 2064 665f 736f 7274 5f64         df_sort_d
-00002250: 6961 6432 5f74 7269 6d3d 6466 5f73 6f72  iad2_trim=df_sor
-00002260: 745f 6469 6164 320a 0a20 2020 2023 2043  t_diad2..    # C
-00002270: 6865 636b 2069 6620 616e 7920 7065 616b  heck if any peak
-00002280: 7320 6c69 6520 7768 6572 6520 7765 2065  s lie where we e
-00002290: 7870 6563 7420 7468 6520 7365 636f 6e64  xpect the second
-000022a0: 2064 6961 640a 2020 2020 7269 6768 745f   diad.    right_
-000022b0: 706f 735f 6469 6164 323d 6466 5f73 6f72  pos_diad2=df_sor
-000022c0: 745f 6469 6164 325f 7472 696d 5b27 706f  t_diad2_trim['po
-000022d0: 7327 5d2e 6265 7477 6565 6e28 636f 6e66  s'].between(conf
-000022e0: 6967 2e61 7070 726f 785f 6469 6164 325f  ig.approx_diad2_
-000022f0: 706f 735b 305d 2c20 636f 6e66 6967 2e61  pos[0], config.a
-00002300: 7070 726f 785f 6469 6164 325f 706f 735b  pprox_diad2_pos[
-00002310: 315d 290a 2020 2020 6966 2061 6e79 2872  1]).    if any(r
-00002320: 6967 6874 5f70 6f73 5f64 6961 6432 293a  ight_pos_diad2):
-00002330: 0a0a 2020 2020 2020 2020 6d61 6e75 616c  ..        manual
-00002340: 5f64 6961 6432 3d46 616c 7365 0a20 2020  _diad2=False.   
-00002350: 2020 2020 2064 665f 736f 7274 5f64 6961       df_sort_dia
-00002360: 6432 5f72 6967 6874 706f 733d 6466 5f73  d2_rightpos=df_s
-00002370: 6f72 745f 6469 6164 325f 7472 696d 2e6c  ort_diad2_trim.l
-00002380: 6f63 5b72 6967 6874 5f70 6f73 5f64 6961  oc[right_pos_dia
-00002390: 6432 5d0a 2020 2020 2020 2020 6469 6164  d2].        diad
-000023a0: 5f32 5f64 6961 643d 6466 5f73 6f72 745f  _2_diad=df_sort_
-000023b0: 6469 6164 325f 7269 6768 7470 6f73 2e6c  diad2_rightpos.l
-000023c0: 6f63 5b64 665f 736f 7274 5f64 6961 6432  oc[df_sort_diad2
-000023d0: 5f72 6967 6874 706f 735b 2768 6569 6768  _rightpos['heigh
-000023e0: 7427 5d3d 3d6e 702e 6d61 7828 6466 5f73  t']==np.max(df_s
-000023f0: 6f72 745f 6469 6164 325f 7269 6768 7470  ort_diad2_rightp
-00002400: 6f73 5b27 6865 6967 6874 275d 295d 0a20  os['height'])]. 
-00002410: 2020 2020 2020 2064 665f 6f75 743d 7064         df_out=pd
-00002420: 2e44 6174 6146 7261 6d65 2864 6174 613d  .DataFrame(data=
-00002430: 7b27 6669 6c65 6e61 6d65 273a 2066 696c  {'filename': fil
-00002440: 656e 616d 652c 0a20 2020 2020 2020 2020  ename,.         
-00002450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002460: 2020 2020 2020 2027 4469 6164 325f 706f         'Diad2_po
-00002470: 7327 3a20 6469 6164 5f32 5f64 6961 645b  s': diad_2_diad[
-00002480: 2770 6f73 275d 2c0a 2020 2020 2020 2020  'pos'],.        
-00002490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024a0: 2020 2020 2020 2020 2744 6961 6432 5f68          'Diad2_h
-000024b0: 6569 6768 7427 3a20 6469 6164 5f32 5f64  eight': diad_2_d
-000024c0: 6961 645b 2768 6569 6768 7427 5d7d 290a  iad['height']}).
-000024d0: 0a0a 0a0a 2020 2020 2020 2020 2320 416c  ....        # Al
-000024e0: 6c6f 6361 7465 2068 6f74 2062 616e 6420  locate hot band 
-000024f0: 3220 706f 7369 7469 6f6e 0a0a 2020 2020  2 position..    
-00002500: 2020 2020 6966 2061 6e79 2864 665f 736f      if any(df_so
-00002510: 7274 5f64 6961 6432 5f74 7269 6d5b 2770  rt_diad2_trim['p
-00002520: 6f73 275d 2e62 6574 7765 656e 2864 6961  os'].between(dia
-00002530: 645f 325f 6469 6164 5b27 706f 7327 5d2e  d_2_diad['pos'].
-00002540: 696c 6f63 5b30 5d2b 6469 6164 325f 4842  iloc[0]+diad2_HB
-00002550: 325f 6d69 6e5f 6f66 6673 6574 2c20 6469  2_min_offset, di
-00002560: 6164 5f32 5f64 6961 645b 2770 6f73 275d  ad_2_diad['pos']
-00002570: 2e69 6c6f 635b 305d 2b64 6961 6432 5f48  .iloc[0]+diad2_H
-00002580: 4232 5f6d 6178 5f6f 6666 7365 7429 293a  B2_max_offset)):
-00002590: 0a0a 2020 2020 2020 2020 2020 2020 6469  ..            di
-000025a0: 6164 5f32 5f48 423d 6466 5f73 6f72 745f  ad_2_HB=df_sort_
-000025b0: 6469 6164 325f 7472 696d 2e6c 6f63 5b64  diad2_trim.loc[d
-000025c0: 665f 736f 7274 5f64 6961 6432 5f74 7269  f_sort_diad2_tri
-000025d0: 6d5b 2770 6f73 275d 2e62 6574 7765 656e  m['pos'].between
-000025e0: 2864 6961 645f 325f 6469 6164 5b27 706f  (diad_2_diad['po
-000025f0: 7327 5d2e 696c 6f63 5b30 5d2b 6469 6164  s'].iloc[0]+diad
-00002600: 325f 4842 325f 6d69 6e5f 6f66 6673 6574  2_HB2_min_offset
-00002610: 2c20 6469 6164 5f32 5f64 6961 645b 2770  , diad_2_diad['p
-00002620: 6f73 275d 2e69 6c6f 635b 305d 2b64 6961  os'].iloc[0]+dia
-00002630: 6432 5f48 4232 5f6d 6178 5f6f 6666 7365  d2_HB2_max_offse
-00002640: 7429 5d0a 0a20 2020 2020 2020 2020 2020  t)]..           
-00002650: 2064 665f 6f75 745b 2748 4232 5f70 6f73   df_out['HB2_pos
-00002660: 275d 3d64 6961 645f 325f 4842 5b27 706f  ']=diad_2_HB['po
-00002670: 7327 5d2e 696c 6f63 5b30 5d0a 2020 2020  s'].iloc[0].    
-00002680: 2020 2020 2020 2020 6466 5f6f 7574 5b27          df_out['
-00002690: 4842 325f 6865 6967 6874 275d 3d64 6961  HB2_height']=dia
-000026a0: 645f 325f 4842 5b27 6865 6967 6874 275d  d_2_HB['height']
-000026b0: 2e69 6c6f 635b 305d 0a0a 0a20 2020 2020  .iloc[0]...     
-000026c0: 2020 2065 6c73 653a 0a0a 2020 2020 2020     else:..      
-000026d0: 2020 2020 2020 6466 5f6f 7574 5b27 4842        df_out['HB
-000026e0: 325f 706f 7327 5d3d 6e70 2e6e 616e 0a20  2_pos']=np.nan. 
-000026f0: 2020 2020 2020 2020 2020 2064 665f 6f75             df_ou
-00002700: 745b 2748 4232 5f68 6569 6768 7427 5d3d  t['HB2_height']=
-00002710: 6e70 2e6e 616e 0a0a 0a20 2020 2020 2020  np.nan...       
-00002720: 2023 204c 6f6f 6b20 666f 7220 4331 3320   # Look for C13 
-00002730: 706f 7369 7469 6f6e 0a20 2020 2020 2020  position.       
-00002740: 2069 6620 616e 7928 6466 5f73 6f72 745f   if any(df_sort_
-00002750: 6469 6164 325f 7472 696d 5b27 706f 7327  diad2_trim['pos'
-00002760: 5d2e 6265 7477 6565 6e28 6469 6164 5f32  ].between(diad_2
-00002770: 5f64 6961 645b 2770 6f73 275d 2e69 6c6f  _diad['pos'].ilo
-00002780: 635b 305d 2d64 6961 6432 5f43 3133 5f6d  c[0]-diad2_C13_m
-00002790: 6178 5f6f 6666 7365 742c 2064 6961 645f  ax_offset, diad_
-000027a0: 325f 6469 6164 5b27 706f 7327 5d2e 696c  2_diad['pos'].il
-000027b0: 6f63 5b30 5d2d 6469 6164 325f 4331 335f  oc[0]-diad2_C13_
-000027c0: 6d69 6e5f 6f66 6673 6574 2929 3a0a 2020  min_offset)):.  
-000027d0: 2020 2020 2020 2020 2020 6469 6164 5f32            diad_2
-000027e0: 5f43 3133 3d64 665f 736f 7274 5f64 6961  _C13=df_sort_dia
-000027f0: 6432 5f74 7269 6d2e 6c6f 635b 6466 5f73  d2_trim.loc[df_s
-00002800: 6f72 745f 6469 6164 325f 7472 696d 5b27  ort_diad2_trim['
-00002810: 706f 7327 5d2e 6265 7477 6565 6e28 6469  pos'].between(di
-00002820: 6164 5f32 5f64 6961 645b 2770 6f73 275d  ad_2_diad['pos']
-00002830: 2e69 6c6f 635b 305d 2d64 6961 6432 5f43  .iloc[0]-diad2_C
-00002840: 3133 5f6d 6178 5f6f 6666 7365 742c 2064  13_max_offset, d
-00002850: 6961 645f 325f 6469 6164 5b27 706f 7327  iad_2_diad['pos'
-00002860: 5d2e 696c 6f63 5b30 5d2d 6469 6164 325f  ].iloc[0]-diad2_
-00002870: 4331 335f 6d69 6e5f 6f66 6673 6574 295d  C13_min_offset)]
-00002880: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
-00002890: 6f75 745b 2743 3133 5f70 6f73 275d 3d64  out['C13_pos']=d
-000028a0: 6961 645f 325f 4331 335b 2770 6f73 275d  iad_2_C13['pos']
-000028b0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
-000028c0: 2020 2020 2064 665f 6f75 745b 2743 3133       df_out['C13
-000028d0: 5f68 6569 6768 7427 5d3d 6469 6164 5f32  _height']=diad_2
-000028e0: 5f43 3133 5b27 6865 6967 6874 275d 2e69  _C13['height'].i
-000028f0: 6c6f 635b 305d 0a20 2020 2020 2020 2065  loc[0].        e
-00002900: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00002910: 2064 665f 6f75 745b 2743 3133 5f70 6f73   df_out['C13_pos
-00002920: 275d 3d6e 702e 6e61 6e0a 2020 2020 2020  ']=np.nan.      
-00002930: 2020 2020 2020 6466 5f6f 7574 5b27 4331        df_out['C1
-00002940: 335f 6865 6967 6874 275d 3d6e 702e 6e61  3_height']=np.na
-00002950: 6e0a 2020 2020 2320 4966 2069 7420 6469  n.    # If it di
-00002960: 646e 7420 6669 6e64 2061 6e79 7468 696e  dnt find anythin
-00002970: 6720 7768 6572 6520 7765 2065 7870 6563  g where we expec
-00002980: 7420 4469 6164 3220 746f 2062 652c 2066  t Diad2 to be, f
-00002990: 696e 6420 6d61 7820 706f 7369 7469 6f6e  ind max position
-000029a0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-000029b0: 2020 206d 616e 7561 6c5f 6469 6164 323d     manual_diad2=
-000029c0: 5472 7565 0a20 2020 2020 2020 2023 204c  True.        # L
-000029d0: 6574 7320 6669 6e64 2074 6865 2068 6967  ets find the hig
-000029e0: 6865 7374 2062 6974 2077 6974 6869 6e20  hest bit within 
-000029f0: 7468 6973 2072 616e 6765 0a20 2020 2020  this range.     
-00002a00: 2020 2064 6961 6432 5f72 616e 6765 3d28     diad2_range=(
-00002a10: 4469 6164 5b3a 2c20 305d 3e63 6f6e 6669  Diad[:, 0]>confi
-00002a20: 672e 6170 7072 6f78 5f64 6961 6432 5f70  g.approx_diad2_p
-00002a30: 6f73 5b30 5d29 2026 2028 4469 6164 5b3a  os[0]) & (Diad[:
-00002a40: 2c20 305d 3c63 6f6e 6669 672e 6170 7072  , 0]<config.appr
-00002a50: 6f78 5f64 6961 6432 5f70 6f73 5b31 5d29  ox_diad2_pos[1])
-00002a60: 0a20 2020 2020 2020 2064 6961 6432 5f68  .        diad2_h
-00002a70: 6569 6768 743d 6e70 2e6d 6178 2844 6961  eight=np.max(Dia
-00002a80: 645b 3a2c 2031 5d5b 6469 6164 325f 7261  d[:, 1][diad2_ra
-00002a90: 6e67 655d 290a 2020 2020 2020 2020 6469  nge]).        di
-00002aa0: 6164 325f 706f 733d 4469 6164 5b3a 2c20  ad2_pos=Diad[:, 
-00002ab0: 305d 5b28 4469 6164 5b3a 2c20 315d 3d3d  0][(Diad[:, 1]==
-00002ac0: 6469 6164 325f 6865 6967 6874 2926 6469  diad2_height)&di
-00002ad0: 6164 325f 7261 6e67 655d 0a0a 2020 2020  ad2_range]..    
-00002ae0: 2020 2020 6466 5f6f 7574 3d70 642e 4461      df_out=pd.Da
-00002af0: 7461 4672 616d 6528 6461 7461 3d7b 2766  taFrame(data={'f
-00002b00: 696c 656e 616d 6527 3a20 6669 6c65 6e61  ilename': filena
-00002b10: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-00002b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002b30: 2020 2020 2020 2020 2744 6961 6432 5f70          'Diad2_p
-00002b40: 6f73 273a 2064 6961 6432 5f70 6f73 5b30  os': diad2_pos[0
-00002b50: 5d20 2c0a 2020 2020 2020 2020 2020 2020  ] ,.            
-00002b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002b70: 2020 2020 2744 6961 6432 5f68 6569 6768      'Diad2_heigh
-00002b80: 7427 3a64 6961 6432 5f68 6569 6768 747d  t':diad2_height}
-00002b90: 2c20 696e 6465 783d 5b30 5d29 0a0a 2020  , index=[0])..  
-00002ba0: 2020 2020 2020 2320 4c65 7473 2074 7279        # Lets try
-00002bb0: 2074 6f20 6669 6e64 2074 6865 2068 6f74   to find the hot
-00002bc0: 6261 6e64 2061 6e64 2068 6f70 6520 6974  band and hope it
-00002bd0: 7320 6865 7265 210a 2020 2020 2020 2020  s here!.        
-00002be0: 6966 2061 6e79 2864 665f 736f 7274 5f64  if any(df_sort_d
-00002bf0: 6961 6432 5f74 7269 6d5b 2770 6f73 275d  iad2_trim['pos']
-00002c00: 2e62 6574 7765 656e 2864 665f 6f75 745b  .between(df_out[
-00002c10: 2744 6961 6432 5f70 6f73 275d 2e69 6c6f  'Diad2_pos'].ilo
-00002c20: 635b 305d 2b64 6961 6432 5f48 4232 5f6d  c[0]+diad2_HB2_m
-00002c30: 696e 5f6f 6666 7365 742c 2064 665f 6f75  in_offset, df_ou
-00002c40: 745b 2744 6961 6432 5f70 6f73 275d 2e69  t['Diad2_pos'].i
-00002c50: 6c6f 635b 305d 2b64 6961 6432 5f48 4232  loc[0]+diad2_HB2
-00002c60: 5f6d 6178 5f6f 6666 7365 7429 293a 0a0a  _max_offset)):..
-00002c70: 2020 2020 2020 2020 2020 2020 6469 6164              diad
-00002c80: 5f32 5f48 423d 6466 5f73 6f72 745f 6469  _2_HB=df_sort_di
-00002c90: 6164 325f 7472 696d 2e6c 6f63 5b64 665f  ad2_trim.loc[df_
-00002ca0: 736f 7274 5f64 6961 6432 5f74 7269 6d5b  sort_diad2_trim[
-00002cb0: 2770 6f73 275d 2e62 6574 7765 656e 2864  'pos'].between(d
-00002cc0: 665f 6f75 745b 2744 6961 6432 5f70 6f73  f_out['Diad2_pos
-00002cd0: 275d 2e69 6c6f 635b 305d 2b64 6961 6432  '].iloc[0]+diad2
-00002ce0: 5f48 4232 5f6d 696e 5f6f 6666 7365 742c  _HB2_min_offset,
-00002cf0: 2064 665f 6f75 745b 2744 6961 6432 5f70   df_out['Diad2_p
-00002d00: 6f73 275d 2e69 6c6f 635b 305d 2b64 6961  os'].iloc[0]+dia
-00002d10: 6432 5f48 4232 5f6d 6178 5f6f 6666 7365  d2_HB2_max_offse
-00002d20: 7429 5d0a 0a20 2020 2020 2020 2020 2020  t)]..           
-00002d30: 2064 665f 6f75 745b 2748 4232 5f70 6f73   df_out['HB2_pos
-00002d40: 275d 3d64 6961 645f 325f 4842 5b27 706f  ']=diad_2_HB['po
-00002d50: 7327 5d2e 696c 6f63 5b30 5d0a 2020 2020  s'].iloc[0].    
-00002d60: 2020 2020 2020 2020 6466 5f6f 7574 5b27          df_out['
-00002d70: 4842 325f 6865 6967 6874 275d 3d64 6961  HB2_height']=dia
-00002d80: 645f 325f 4842 5b27 6865 6967 6874 275d  d_2_HB['height']
-00002d90: 2e69 6c6f 635b 305d 0a0a 2020 2020 2020  .iloc[0]..      
-00002da0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00002db0: 2020 2020 6466 5f6f 7574 5b27 4842 325f      df_out['HB2_
-00002dc0: 706f 7327 5d3d 6e70 2e6e 616e 0a20 2020  pos']=np.nan.   
-00002dd0: 2020 2020 2020 2020 2064 665f 6f75 745b           df_out[
-00002de0: 2748 4232 5f68 6569 6768 7427 5d3d 6e70  'HB2_height']=np
-00002df0: 2e6e 616e 0a0a 2020 2020 2020 2020 2320  .nan..        # 
-00002e00: 4c65 7473 2074 7279 2061 6e64 2066 696e  Lets try and fin
-00002e10: 6420 7468 6520 4331 3320 7065 616b 0a0a  d the C13 peak..
-00002e20: 2020 2020 2020 2020 6966 2061 6e79 2864          if any(d
-00002e30: 665f 736f 7274 5f64 6961 6432 5f74 7269  f_sort_diad2_tri
-00002e40: 6d5b 2770 6f73 275d 2e62 6574 7765 656e  m['pos'].between
-00002e50: 2864 665f 6f75 745b 2744 6961 6432 5f70  (df_out['Diad2_p
-00002e60: 6f73 275d 2e69 6c6f 635b 305d 2d64 6961  os'].iloc[0]-dia
-00002e70: 6432 5f43 3133 5f6d 6178 5f6f 6666 7365  d2_C13_max_offse
-00002e80: 742c 2064 665f 6f75 745b 2744 6961 6432  t, df_out['Diad2
-00002e90: 5f70 6f73 275d 2e69 6c6f 635b 305d 2d64  _pos'].iloc[0]-d
-00002ea0: 6961 6432 5f43 3133 5f6d 696e 5f6f 6666  iad2_C13_min_off
-00002eb0: 7365 7429 293a 0a20 2020 2020 2020 2020  set)):.         
-00002ec0: 2020 2064 6961 645f 325f 4331 333d 6466     diad_2_C13=df
-00002ed0: 5f73 6f72 745f 6469 6164 325f 7472 696d  _sort_diad2_trim
-00002ee0: 2e6c 6f63 5b64 665f 736f 7274 5f64 6961  .loc[df_sort_dia
-00002ef0: 6432 5f74 7269 6d5b 2770 6f73 275d 2e62  d2_trim['pos'].b
-00002f00: 6574 7765 656e 2864 665f 6f75 745b 2744  etween(df_out['D
-00002f10: 6961 6432 5f70 6f73 275d 2e69 6c6f 635b  iad2_pos'].iloc[
-00002f20: 305d 2d64 6961 6432 5f43 3133 5f6d 6178  0]-diad2_C13_max
-00002f30: 5f6f 6666 7365 742c 2064 665f 6f75 745b  _offset, df_out[
-00002f40: 2744 6961 6432 5f70 6f73 275d 2e69 6c6f  'Diad2_pos'].ilo
-00002f50: 635b 305d 2d64 6961 6432 5f43 3133 5f6d  c[0]-diad2_C13_m
-00002f60: 696e 5f6f 6666 7365 7429 5d0a 0a20 2020  in_offset)]..   
-00002f70: 2020 2020 2020 2020 2064 665f 6f75 745b           df_out[
-00002f80: 2743 3133 5f70 6f73 275d 3d64 6961 645f  'C13_pos']=diad_
-00002f90: 325f 4331 335b 2770 6f73 275d 2e69 6c6f  2_C13['pos'].ilo
-00002fa0: 635b 305d 0a20 2020 2020 2020 2020 2020  c[0].           
-00002fb0: 2064 665f 6f75 745b 2743 3133 5f68 6569   df_out['C13_hei
-00002fc0: 6768 7427 5d3d 6469 6164 5f32 5f43 3133  ght']=diad_2_C13
-00002fd0: 5b27 6865 6967 6874 275d 2e69 6c6f 635b  ['height'].iloc[
-00002fe0: 305d 0a20 2020 2020 2020 2065 6c73 653a  0].        else:
-00002ff0: 0a0a 2020 2020 2020 2020 2020 2020 6466  ..            df
-00003000: 5f6f 7574 5b27 4331 335f 706f 7327 5d3d  _out['C13_pos']=
-00003010: 6e70 2e6e 616e 0a20 2020 2020 2020 2020  np.nan.         
-00003020: 2020 2064 665f 6f75 745b 2743 3133 5f68     df_out['C13_h
-00003030: 6569 6768 7427 5d3d 6e70 2e6e 616e 0a0a  eight']=np.nan..
-00003040: 0a0a 2020 2020 2320 446f 2074 6865 2073  ..    # Do the s
-00003050: 616d 6520 666f 7220 6469 6164 2031 0a0a  ame for diad 1..
-00003060: 2020 2020 7269 6768 745f 706f 735f 6469      right_pos_di
-00003070: 6164 313d 6466 5f73 6f72 745f 6469 6164  ad1=df_sort_diad
-00003080: 315f 7472 696d 5b27 706f 7327 5d2e 6265  1_trim['pos'].be
-00003090: 7477 6565 6e28 636f 6e66 6967 2e61 7070  tween(config.app
-000030a0: 726f 785f 6469 6164 315f 706f 735b 305d  rox_diad1_pos[0]
-000030b0: 2c20 636f 6e66 6967 2e61 7070 726f 785f  , config.approx_
-000030c0: 6469 6164 315f 706f 735b 315d 290a 2020  diad1_pos[1]).  
-000030d0: 2020 6966 2061 6e79 2872 6967 6874 5f70    if any(right_p
-000030e0: 6f73 5f64 6961 6431 293a 0a20 2020 2020  os_diad1):.     
-000030f0: 2020 206d 616e 7561 6c5f 6469 6164 313d     manual_diad1=
-00003100: 4661 6c73 650a 2020 2020 2020 2020 6466  False.        df
-00003110: 5f73 6f72 745f 6469 6164 315f 7269 6768  _sort_diad1_righ
-00003120: 7470 6f73 3d64 665f 736f 7274 5f64 6961  tpos=df_sort_dia
-00003130: 6431 5f74 7269 6d2e 6c6f 635b 7269 6768  d1_trim.loc[righ
-00003140: 745f 706f 735f 6469 6164 315d 0a20 2020  t_pos_diad1].   
-00003150: 2020 2020 2064 6961 645f 315f 6469 6164       diad_1_diad
-00003160: 3d64 665f 736f 7274 5f64 6961 6431 5f72  =df_sort_diad1_r
-00003170: 6967 6874 706f 732e 6c6f 635b 6466 5f73  ightpos.loc[df_s
-00003180: 6f72 745f 6469 6164 315f 7269 6768 7470  ort_diad1_rightp
-00003190: 6f73 5b27 6865 6967 6874 275d 3d3d 6e70  os['height']==np
-000031a0: 2e6d 6178 2864 665f 736f 7274 5f64 6961  .max(df_sort_dia
-000031b0: 6431 5f72 6967 6874 706f 735b 2768 6569  d1_rightpos['hei
-000031c0: 6768 7427 5d29 5d0a 0a20 2020 2020 2020  ght'])]..       
-000031d0: 2064 665f 6f75 745b 2744 6961 6431 5f70   df_out['Diad1_p
-000031e0: 6f73 275d 3d64 6961 645f 315f 6469 6164  os']=diad_1_diad
-000031f0: 5b27 706f 7327 5d2e 696c 6f63 5b30 5d0a  ['pos'].iloc[0].
-00003200: 2020 2020 2020 2020 6466 5f6f 7574 5b27          df_out['
-00003210: 4469 6164 315f 6865 6967 6874 275d 3d64  Diad1_height']=d
-00003220: 6961 645f 315f 6469 6164 5b27 6865 6967  iad_1_diad['heig
-00003230: 6874 275d 2e69 6c6f 635b 305d 0a0a 2020  ht'].iloc[0]..  
-00003240: 2020 2020 2020 6966 2061 6e79 2864 665f        if any(df_
-00003250: 736f 7274 5f64 6961 6431 5f74 7269 6d5b  sort_diad1_trim[
-00003260: 2770 6f73 275d 2e62 6574 7765 656e 2864  'pos'].between(d
-00003270: 6961 645f 315f 6469 6164 5b27 706f 7327  iad_1_diad['pos'
-00003280: 5d2e 696c 6f63 5b30 5d2d 6469 6164 315f  ].iloc[0]-diad1_
-00003290: 4842 315f 6d61 785f 6f66 6673 6574 2c20  HB1_max_offset, 
-000032a0: 6469 6164 5f31 5f64 6961 645b 2770 6f73  diad_1_diad['pos
-000032b0: 275d 2e69 6c6f 635b 305d 2d64 6961 6431  '].iloc[0]-diad1
-000032c0: 5f48 4231 5f6d 696e 5f6f 6666 7365 7429  _HB1_min_offset)
-000032d0: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
-000032e0: 6961 645f 315f 4842 3d64 665f 736f 7274  iad_1_HB=df_sort
-000032f0: 5f64 6961 6431 5f74 7269 6d2e 6c6f 635b  _diad1_trim.loc[
-00003300: 6466 5f73 6f72 745f 6469 6164 315f 7472  df_sort_diad1_tr
-00003310: 696d 5b27 706f 7327 5d2e 6265 7477 6565  im['pos'].betwee
-00003320: 6e28 6469 6164 5f31 5f64 6961 645b 2770  n(diad_1_diad['p
-00003330: 6f73 275d 2e69 6c6f 635b 305d 2d64 6961  os'].iloc[0]-dia
-00003340: 6431 5f48 4231 5f6d 6178 5f6f 6666 7365  d1_HB1_max_offse
-00003350: 742c 2064 6961 645f 315f 6469 6164 5b27  t, diad_1_diad['
-00003360: 706f 7327 5d2e 696c 6f63 5b30 5d2d 6469  pos'].iloc[0]-di
-00003370: 6164 315f 4842 315f 6d69 6e5f 6f66 6673  ad1_HB1_min_offs
-00003380: 6574 295d 0a20 2020 2020 2020 2020 2020  et)].           
-00003390: 2064 665f 6f75 745b 2748 4231 5f70 6f73   df_out['HB1_pos
-000033a0: 275d 3d64 6961 645f 315f 4842 5b27 706f  ']=diad_1_HB['po
-000033b0: 7327 5d2e 696c 6f63 5b30 5d0a 2020 2020  s'].iloc[0].    
-000033c0: 2020 2020 2020 2020 6466 5f6f 7574 5b27          df_out['
-000033d0: 4842 315f 6865 6967 6874 275d 3d64 6961  HB1_height']=dia
-000033e0: 645f 315f 4842 5b27 6865 6967 6874 275d  d_1_HB['height']
-000033f0: 2e69 6c6f 635b 305d 0a0a 2020 2020 2020  .iloc[0]..      
-00003400: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00003410: 2020 2020 6466 5f6f 7574 5b27 4842 315f      df_out['HB1_
-00003420: 706f 7327 5d3d 6e70 2e6e 616e 0a20 2020  pos']=np.nan.   
-00003430: 2020 2020 2020 2020 2064 665f 6f75 745b           df_out[
-00003440: 2748 4231 5f68 6569 6768 7427 5d3d 6e70  'HB1_height']=np
-00003450: 2e6e 616e 0a0a 0a20 2020 2065 6c73 653a  .nan...    else:
-00003460: 0a20 2020 2020 2020 206d 616e 7561 6c5f  .        manual_
-00003470: 6469 6164 313d 5472 7565 0a20 2020 2020  diad1=True.     
-00003480: 2020 2064 6961 6431 5f72 616e 6765 3d28     diad1_range=(
-00003490: 4469 6164 5b3a 2c20 305d 3e63 6f6e 6669  Diad[:, 0]>confi
-000034a0: 672e 6170 7072 6f78 5f64 6961 6431 5f70  g.approx_diad1_p
-000034b0: 6f73 5b30 5d29 2026 2028 4469 6164 5b3a  os[0]) & (Diad[:
-000034c0: 2c20 305d 3c63 6f6e 6669 672e 6170 7072  , 0]<config.appr
-000034d0: 6f78 5f64 6961 6431 5f70 6f73 5b31 5d29  ox_diad1_pos[1])
-000034e0: 0a20 2020 2020 2020 2064 6961 6431 5f68  .        diad1_h
-000034f0: 6569 6768 743d 6e70 2e6d 6178 2844 6961  eight=np.max(Dia
-00003500: 645b 3a2c 2031 5d5b 6469 6164 315f 7261  d[:, 1][diad1_ra
-00003510: 6e67 655d 290a 2020 2020 2020 2020 6469  nge]).        di
-00003520: 6164 315f 706f 733d 4469 6164 5b3a 2c20  ad1_pos=Diad[:, 
-00003530: 305d 5b28 4469 6164 5b3a 2c20 315d 3d3d  0][(Diad[:, 1]==
-00003540: 6469 6164 315f 6865 6967 6874 2926 6469  diad1_height)&di
-00003550: 6164 315f 7261 6e67 655d 0a0a 0a20 2020  ad1_range]...   
-00003560: 2020 2020 2064 665f 6f75 745b 2744 6961       df_out['Dia
-00003570: 6431 5f70 6f73 275d 3d20 6469 6164 315f  d1_pos']= diad1_
-00003580: 706f 735b 305d 0a20 2020 2020 2020 2064  pos[0].        d
-00003590: 665f 6f75 745b 2744 6961 6431 5f68 6569  f_out['Diad1_hei
-000035a0: 6768 7427 5d3d 6469 6164 315f 6865 6967  ght']=diad1_heig
-000035b0: 6874 0a0a 2020 2020 2020 2020 2320 4c65  ht..        # Le
-000035c0: 7473 2073 6565 2069 6620 7765 2063 616e  ts see if we can
-000035d0: 2066 696e 6420 6120 686f 7462 616e 6420   find a hotband 
-000035e0: 696e 2068 6572 6520 6e6f 770a 2020 2020  in here now.    
-000035f0: 2020 2020 6966 2061 6e79 2864 665f 736f      if any(df_so
-00003600: 7274 5f64 6961 6431 5f74 7269 6d5b 2770  rt_diad1_trim['p
-00003610: 6f73 275d 2e62 6574 7765 656e 2864 665f  os'].between(df_
-00003620: 6f75 745b 2744 6961 6431 5f70 6f73 275d  out['Diad1_pos']
-00003630: 2e69 6c6f 635b 305d 2d64 6961 6431 5f48  .iloc[0]-diad1_H
-00003640: 4231 5f6d 6178 5f6f 6666 7365 742c 2064  B1_max_offset, d
-00003650: 665f 6f75 745b 2744 6961 6431 5f70 6f73  f_out['Diad1_pos
-00003660: 275d 2e69 6c6f 635b 305d 2d64 6961 6431  '].iloc[0]-diad1
-00003670: 5f48 4231 5f6d 696e 5f6f 6666 7365 7429  _HB1_min_offset)
-00003680: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
-00003690: 6961 645f 315f 4842 3d64 665f 736f 7274  iad_1_HB=df_sort
-000036a0: 5f64 6961 6431 5f74 7269 6d2e 6c6f 635b  _diad1_trim.loc[
-000036b0: 6466 5f73 6f72 745f 6469 6164 315f 7472  df_sort_diad1_tr
-000036c0: 696d 5b27 706f 7327 5d2e 6265 7477 6565  im['pos'].betwee
-000036d0: 6e28 6466 5f6f 7574 5b27 4469 6164 315f  n(df_out['Diad1_
-000036e0: 706f 7327 5d2e 696c 6f63 5b30 5d2d 6469  pos'].iloc[0]-di
-000036f0: 6164 315f 4842 315f 6d61 785f 6f66 6673  ad1_HB1_max_offs
-00003700: 6574 2c20 6466 5f6f 7574 5b27 4469 6164  et, df_out['Diad
-00003710: 315f 706f 7327 5d2e 696c 6f63 5b30 5d2d  1_pos'].iloc[0]-
-00003720: 6469 6164 315f 4842 315f 6d69 6e5f 6f66  diad1_HB1_min_of
-00003730: 6673 6574 295d 0a20 2020 2020 2020 2020  fset)].         
-00003740: 2020 2064 665f 6f75 745b 2748 4231 5f70     df_out['HB1_p
-00003750: 6f73 275d 3d64 6961 645f 315f 4842 5b27  os']=diad_1_HB['
-00003760: 706f 7327 5d2e 696c 6f63 5b30 5d0a 2020  pos'].iloc[0].  
-00003770: 2020 2020 2020 2020 2020 6466 5f6f 7574            df_out
-00003780: 5b27 4842 315f 6865 6967 6874 275d 3d64  ['HB1_height']=d
-00003790: 6961 645f 315f 4842 5b27 6865 6967 6874  iad_1_HB['height
-000037a0: 275d 2e69 6c6f 635b 305d 0a0a 2020 2020  '].iloc[0]..    
-000037b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000037c0: 2020 2020 2020 6466 5f6f 7574 5b27 4842        df_out['HB
-000037d0: 315f 706f 7327 5d3d 6e70 2e6e 616e 0a20  1_pos']=np.nan. 
-000037e0: 2020 2020 2020 2020 2020 2064 665f 6f75             df_ou
-000037f0: 745b 2748 4231 5f68 6569 6768 7427 5d3d  t['HB1_height']=
-00003800: 6e70 2e6e 616e 0a0a 2020 2020 2320 4c65  np.nan..    # Le
-00003810: 7473 2067 6574 2074 6865 2070 726f 6d69  ts get the promi
-00003820: 6e65 6e63 6520 6f66 2074 6865 206d 6169  nence of the mai
-00003830: 6e20 7065 616b 7320 616e 6420 686f 7462  n peaks and hotb
-00003840: 616e 6473 206e 6f77 2077 6520 6861 7665  ands now we have
-00003850: 2066 6f75 6e64 2074 6865 6d0a 2020 2020   found them.    
-00003860: 4469 6164 5f78 3d44 6961 645b 3a2c 2030  Diad_x=Diad[:, 0
-00003870: 5d0a 2020 2020 4469 6164 5f79 3d44 6961  ].    Diad_y=Dia
-00003880: 645b 3a2c 2031 5d0a 2020 2020 4d65 645f  d[:, 1].    Med_
-00003890: 4c48 535f 6469 6164 313d 6e70 2e6e 616e  LHS_diad1=np.nan
-000038a0: 6d65 6469 616e 2844 6961 645f 795b 2844  median(Diad_y[(D
-000038b0: 6961 645b 3a2c 2030 5d3e 636f 6e66 6967  iad[:, 0]>config
-000038c0: 2e4c 485f 6263 6b5f 6469 6164 315b 305d  .LH_bck_diad1[0]
-000038d0: 2926 2028 4469 6164 5b3a 2c20 305d 3c63  )& (Diad[:, 0]<c
-000038e0: 6f6e 6669 672e 4c48 5f62 636b 5f64 6961  onfig.LH_bck_dia
-000038f0: 6431 5b31 5d29 5d29 0a20 2020 204d 6564  d1[1])]).    Med
-00003900: 5f52 4853 5f64 6961 6431 3d6e 702e 6e61  _RHS_diad1=np.na
-00003910: 6e6d 6564 6961 6e28 4469 6164 5f79 5b28  nmedian(Diad_y[(
-00003920: 4469 6164 5b3a 2c20 305d 3e63 6f6e 6669  Diad[:, 0]>confi
-00003930: 672e 5248 5f62 636b 5f64 6961 6431 5b30  g.RH_bck_diad1[0
-00003940: 5d29 2620 2844 6961 645b 3a2c 2030 5d3c  ])& (Diad[:, 0]<
-00003950: 636f 6e66 6967 2e52 485f 6263 6b5f 6469  config.RH_bck_di
-00003960: 6164 315b 315d 295d 290a 2020 2020 4d65  ad1[1])]).    Me
-00003970: 645f 4c48 535f 6469 6164 323d 6e70 2e6e  d_LHS_diad2=np.n
-00003980: 616e 6d65 6469 616e 2844 6961 645f 795b  anmedian(Diad_y[
-00003990: 2844 6961 645b 3a2c 2030 5d3e 636f 6e66  (Diad[:, 0]>conf
-000039a0: 6967 2e4c 485f 6263 6b5f 6469 6164 325b  ig.LH_bck_diad2[
-000039b0: 305d 2926 2028 4469 6164 5b3a 2c20 305d  0])& (Diad[:, 0]
-000039c0: 3c63 6f6e 6669 672e 4c48 5f62 636b 5f64  <config.LH_bck_d
-000039d0: 6961 6432 5b31 5d29 5d29 0a20 2020 204d  iad2[1])]).    M
-000039e0: 6564 5f52 4853 5f64 6961 6432 3d6e 702e  ed_RHS_diad2=np.
-000039f0: 6e61 6e6d 6564 6961 6e28 4469 6164 5f79  nanmedian(Diad_y
-00003a00: 5b28 4469 6164 5b3a 2c20 305d 3e63 6f6e  [(Diad[:, 0]>con
-00003a10: 6669 672e 5248 5f62 636b 5f64 6961 6432  fig.RH_bck_diad2
-00003a20: 5b30 5d29 2620 2844 6961 645b 3a2c 2030  [0])& (Diad[:, 0
-00003a30: 5d3c 636f 6e66 6967 2e52 485f 6263 6b5f  ]<config.RH_bck_
-00003a40: 6469 6164 325b 315d 295d 290a 2020 2020  diad2[1])]).    
-00003a50: 234d 6564 5f63 656e 7472 616c 5f62 6163  #Med_central_bac
-00003a60: 6b5f 6469 6164 323d 6e70 2e6e 616e 6d65  k_diad2=np.nanme
-00003a70: 6469 616e 2844 6961 645b 2844 6961 645b  dian(Diad[(Diad[
-00003a80: 3a2c 2030 5d3e 3133 3030 2926 2028 4469  :, 0]>1300)& (Di
-00003a90: 6164 5b3a 2c20 305d 3c31 3335 3029 5d0a  ad[:, 0]<1350)].
-00003aa0: 0a20 2020 2044 6961 645f 6469 6164 313d  .    Diad_diad1=
-00003ab0: 4469 6164 5f79 5b28 4469 6164 5b3a 2c20  Diad_y[(Diad[:, 
-00003ac0: 305d 3e31 3236 3029 2620 2844 6961 645b  0]>1260)& (Diad[
-00003ad0: 3a2c 2030 5d3c 3133 3030 295d 0a20 2020  :, 0]<1300)].   
-00003ae0: 2044 6961 645f 6469 6164 323d 4469 6164   Diad_diad2=Diad
-00003af0: 5f79 5b28 4469 6164 5b3a 2c20 305d 3e31  _y[(Diad[:, 0]>1
-00003b00: 3338 3029 2620 2844 6961 645b 3a2c 2030  380)& (Diad[:, 0
-00003b10: 5d3c 3134 3030 295d 0a20 2020 204d 6564  ]<1400)].    Med
-00003b20: 5f62 636b 5f64 6961 6431 3d28 4d65 645f  _bck_diad1=(Med_
-00003b30: 4c48 535f 6469 6164 312b 4d65 645f 5248  LHS_diad1+Med_RH
-00003b40: 535f 6469 6164 3129 2f32 0a20 2020 204d  S_diad1)/2.    M
-00003b50: 6564 5f62 636b 5f64 6961 6432 3d28 4d65  ed_bck_diad2=(Me
-00003b60: 645f 5248 535f 6469 6164 322b 4d65 645f  d_RHS_diad2+Med_
-00003b70: 4c48 535f 6469 6164 3229 2f32 0a0a 2020  LHS_diad2)/2..  
-00003b80: 2020 6466 5f6f 7574 5b27 4469 6164 315f    df_out['Diad1_
-00003b90: 4d65 6469 616e 5f42 636b 275d 3d4d 6564  Median_Bck']=Med
-00003ba0: 5f62 636b 5f64 6961 6431 0a20 2020 2064  _bck_diad1.    d
-00003bb0: 665f 6f75 745b 2744 6961 6432 5f4d 6564  f_out['Diad2_Med
-00003bc0: 6961 6e5f 4263 6b27 5d3d 4d65 645f 6263  ian_Bck']=Med_bc
-00003bd0: 6b5f 6469 6164 320a 0a20 2020 2064 665f  k_diad2..    df_
-00003be0: 6f75 745b 2744 6961 6431 5f61 6273 5f70  out['Diad1_abs_p
-00003bf0: 726f 6d27 5d3d 6466 5f6f 7574 5b27 4469  rom']=df_out['Di
-00003c00: 6164 315f 6865 6967 6874 275d 2d4d 6564  ad1_height']-Med
-00003c10: 5f62 636b 5f64 6961 6431 0a20 2020 2064  _bck_diad1.    d
-00003c20: 665f 6f75 745b 2744 6961 6432 5f61 6273  f_out['Diad2_abs
-00003c30: 5f70 726f 6d27 5d3d 6466 5f6f 7574 5b27  _prom']=df_out['
-00003c40: 4469 6164 325f 6865 6967 6874 275d 2d4d  Diad2_height']-M
-00003c50: 6564 5f62 636b 5f64 6961 6432 0a20 2020  ed_bck_diad2.   
-00003c60: 2064 665f 6f75 745b 2744 6961 6431 5f72   df_out['Diad1_r
-00003c70: 656c 5f70 726f 6d27 5d3d 6466 5f6f 7574  el_prom']=df_out
-00003c80: 5b27 4469 6164 315f 6865 6967 6874 275d  ['Diad1_height']
-00003c90: 2f4d 6564 5f62 636b 5f64 6961 6431 0a20  /Med_bck_diad1. 
-00003ca0: 2020 2064 665f 6f75 745b 2744 6961 6432     df_out['Diad2
-00003cb0: 5f72 656c 5f70 726f 6d27 5d3d 6466 5f6f  _rel_prom']=df_o
-00003cc0: 7574 5b27 4469 6164 325f 6865 6967 6874  ut['Diad2_height
-00003cd0: 275d 2f4d 6564 5f62 636b 5f64 6961 6432  ']/Med_bck_diad2
-00003ce0: 0a20 2020 2064 665f 6f75 745b 2748 4231  .    df_out['HB1
-00003cf0: 5f61 6273 5f70 726f 6d27 5d3d 6466 5f6f  _abs_prom']=df_o
-00003d00: 7574 5b27 4842 315f 6865 6967 6874 275d  ut['HB1_height']
-00003d10: 2d4d 6564 5f4c 4853 5f64 6961 6431 0a20  -Med_LHS_diad1. 
-00003d20: 2020 2064 665f 6f75 745b 2748 4232 5f61     df_out['HB2_a
-00003d30: 6273 5f70 726f 6d27 5d3d 6466 5f6f 7574  bs_prom']=df_out
-00003d40: 5b27 4842 325f 6865 6967 6874 275d 2d4d  ['HB2_height']-M
-00003d50: 6564 5f52 4853 5f64 6961 6432 0a20 2020  ed_RHS_diad2.   
-00003d60: 2064 665f 6f75 745b 2748 4231 5f72 656c   df_out['HB1_rel
-00003d70: 5f70 726f 6d27 5d3d 6466 5f6f 7574 5b27  _prom']=df_out['
-00003d80: 4842 315f 6865 6967 6874 275d 2f4d 6564  HB1_height']/Med
-00003d90: 5f4c 4853 5f64 6961 6431 0a20 2020 2064  _LHS_diad1.    d
-00003da0: 665f 6f75 745b 2748 4232 5f72 656c 5f70  f_out['HB2_rel_p
-00003db0: 726f 6d27 5d3d 6466 5f6f 7574 5b27 4842  rom']=df_out['HB
-00003dc0: 325f 6865 6967 6874 275d 2f4d 6564 5f52  2_height']/Med_R
-00003dd0: 4853 5f64 6961 6432 0a0a 2020 2020 6466  HS_diad2..    df
-00003de0: 5f6f 7574 5b27 6170 7072 6f78 5f73 706c  _out['approx_spl
-00003df0: 6974 275d 3d64 665f 6f75 745b 2744 6961  it']=df_out['Dia
-00003e00: 6432 5f70 6f73 275d 2d64 665f 6f75 745b  d2_pos']-df_out[
-00003e10: 2744 6961 6431 5f70 6f73 275d 0a0a 0a20  'Diad1_pos']... 
-00003e20: 2020 2023 204c 6574 7320 6765 7420 7468     # Lets get th
-00003e30: 6520 4331 3320 7072 6f6d 696e 656e 6365  e C13 prominence
-00003e40: 0a20 2020 2069 6620 616e 7928 6466 5f6f  .    if any(df_o
-00003e50: 7574 5b27 4331 335f 706f 7327 5d3e 2d35  ut['C13_pos']>-5
-00003e60: 3030 293a 0a20 2020 2020 2020 2043 3133  00):.        C13
-00003e70: 5f62 6163 6b3d 6e70 2e71 7561 6e74 696c  _back=np.quantil
-00003e80: 6528 4469 6164 5f79 5b0a 2020 2020 2020  e(Diad_y[.      
-00003e90: 2020 2828 4469 6164 5f78 3e28 6466 5f6f    ((Diad_x>(df_o
-00003ea0: 7574 5b27 4331 335f 706f 7327 5d2e 696c  ut['C13_pos'].il
-00003eb0: 6f63 5b30 5d2d 3329 2926 2844 6961 645f  oc[0]-3))&(Diad_
-00003ec0: 783c 2864 665f 6f75 745b 2743 3133 5f70  x<(df_out['C13_p
-00003ed0: 6f73 275d 2e69 6c6f 635b 305d 2b33 2929  os'].iloc[0]+3))
-00003ee0: 290a 2020 2020 2020 2020 5d2c 2030 2e32  ).        ], 0.2
-00003ef0: 3529 0a0a 2020 2020 2020 2020 6466 5f6f  5)..        df_o
-00003f00: 7574 5b27 4331 335f 6162 735f 7072 6f6d  ut['C13_abs_prom
-00003f10: 275d 3d64 665f 6f75 745b 2743 3133 5f68  ']=df_out['C13_h
-00003f20: 6569 6768 7427 5d2d 4331 335f 6261 636b  eight']-C13_back
-00003f30: 0a20 2020 2020 2020 2064 665f 6f75 745b  .        df_out[
-00003f40: 2743 3133 5f72 656c 5f70 726f 6d27 5d3d  'C13_rel_prom']=
-00003f50: 6466 5f6f 7574 5b27 4331 335f 6865 6967  df_out['C13_heig
-00003f60: 6874 275d 2f43 3133 5f62 6163 6b0a 2020  ht']/C13_back.  
-00003f70: 2020 2020 2020 6466 5f6f 7574 5b27 4331        df_out['C1
-00003f80: 335f 4842 325f 6162 735f 7072 6f6d 5f72  3_HB2_abs_prom_r
-00003f90: 6174 696f 275d 3d64 665f 6f75 745b 2748  atio']=df_out['H
-00003fa0: 4232 5f61 6273 5f70 726f 6d27 5d2f 6466  B2_abs_prom']/df
-00003fb0: 5f6f 7574 5b27 4331 335f 6162 735f 7072  _out['C13_abs_pr
-00003fc0: 6f6d 275d 0a20 2020 2065 6c73 653a 0a20  om'].    else:. 
-00003fd0: 2020 2020 2020 2064 665f 6f75 745b 2743         df_out['C
-00003fe0: 3133 5f61 6273 5f70 726f 6d27 5d3d 6e70  13_abs_prom']=np
-00003ff0: 2e6e 616e 0a20 2020 2020 2020 2064 665f  .nan.        df_
-00004000: 6f75 745b 2743 3133 5f72 656c 5f70 726f  out['C13_rel_pro
-00004010: 6d27 5d3d 6e70 2e6e 616e 0a20 2020 2020  m']=np.nan.     
-00004020: 2020 2064 665f 6f75 745b 2743 3133 5f48     df_out['C13_H
-00004030: 4232 5f61 6273 5f70 726f 6d5f 7261 7469  B2_abs_prom_rati
-00004040: 6f27 5d3d 6e70 2e6e 616e 0a0a 2020 2020  o']=np.nan..    
-00004050: 2320 4c65 7473 2067 6574 2074 6865 2070  # Lets get the p
-00004060: 726f 6d69 6e65 6e63 6520 6f66 2074 6865  rominence of the
-00004070: 2076 616c 6c65 7920 6265 7477 6565 6e20   valley between 
-00004080: 686f 7462 616e 6473 2061 6e64 2074 6865  hotbands and the
-00004090: 2064 6961 640a 0a20 2020 2023 2046 696e   diad..    # Fin
-000040a0: 6420 7468 6520 6d69 6e69 6d75 6d20 696e  d the minimum in
-000040b0: 7465 6e73 6974 7920 6265 7477 6565 6e20  tensity between 
-000040c0: 7468 6520 6469 6164 2061 6e64 2048 420a  the diad and HB.
-000040d0: 0a20 2020 2069 6620 6e6f 7420 6e70 2e69  .    if not np.i
-000040e0: 736e 616e 2864 665f 6f75 745b 2748 4232  snan(df_out['HB2
-000040f0: 5f70 6f73 275d 2e69 6c6f 635b 305d 293a  _pos'].iloc[0]):
-00004100: 0a0a 0a20 2020 2020 2020 2044 6961 6432  ...        Diad2
-00004110: 5f62 6574 7765 656e 3d44 6961 645b 2844  _between=Diad[(D
-00004120: 6961 645b 3a2c 2030 5d3c 6466 5f6f 7574  iad[:, 0]<df_out
-00004130: 5b27 4842 325f 706f 7327 5d2e 696c 6f63  ['HB2_pos'].iloc
-00004140: 5b30 5d29 2620 2844 6961 645b 3a2c 2030  [0])& (Diad[:, 0
-00004150: 5d3e 6466 5f6f 7574 5b27 4469 6164 325f  ]>df_out['Diad2_
-00004160: 706f 7327 5d2e 696c 6f63 5b30 5d29 5d0a  pos'].iloc[0])].
-00004170: 2020 2020 2020 2020 4d69 6e5f 795f 6d69          Min_y_mi
-00004180: 6470 6f69 6e74 323d 6e70 2e6d 696e 2844  dpoint2=np.min(D
-00004190: 6961 6432 5f62 6574 7765 656e 5b3a 2c20  iad2_between[:, 
-000041a0: 315d 290a 0a20 2020 2020 2020 2023 204f  1])..        # O
-000041b0: 7074 696f 6e20 6865 7265 0a20 2020 2020  ption here.     
-000041c0: 2020 2052 4853 5f78 5f44 6961 6432 3d28     RHS_x_Diad2=(
-000041d0: 6466 5f6f 7574 5b27 4842 325f 706f 7327  df_out['HB2_pos'
-000041e0: 5d2e 696c 6f63 5b30 5d29 2b32 300a 2020  ].iloc[0])+20.  
-000041f0: 2020 2020 2020 5248 535f 795f 4469 6164        RHS_y_Diad
-00004200: 323d 6e70 2e6d 6564 6961 6e28 4469 6164  2=np.median(Diad
-00004210: 5b3a 2c20 315d 5b0a 2020 2020 2020 2020  [:, 1][.        
-00004220: 2020 2020 2844 6961 645b 3a2c 2030 5d3c      (Diad[:, 0]<
-00004230: 5248 535f 785f 4469 6164 322b 322a 7370  RHS_x_Diad2+2*sp
-00004240: 6563 5f72 6573 290a 2020 2020 2020 2020  ec_res).        
-00004250: 2020 2020 2628 4469 6164 5b3a 2c20 305d      &(Diad[:, 0]
-00004260: 3e52 4853 5f78 5f44 6961 6432 2d32 2a73  >RHS_x_Diad2-2*s
-00004270: 7065 635f 7265 7329 5d29 0a0a 2020 2020  pec_res)])..    
-00004280: 2020 2020 6466 5f6f 7574 5b27 4469 6164      df_out['Diad
-00004290: 325f 4842 325f 5661 6c6c 6579 5f70 726f  2_HB2_Valley_pro
-000042a0: 6d27 5d3d 4d69 6e5f 795f 6d69 6470 6f69  m']=Min_y_midpoi
-000042b0: 6e74 322f 5248 535f 795f 4469 6164 320a  nt2/RHS_y_Diad2.
-000042c0: 2020 2020 656c 7365 3a0a 0a20 2020 2020      else:..     
-000042d0: 2020 2064 665f 6f75 745b 2744 6961 6432     df_out['Diad2
-000042e0: 5f48 4232 5f56 616c 6c65 795f 7072 6f6d  _HB2_Valley_prom
-000042f0: 275d 3d6e 702e 6e61 6e0a 0a20 2020 2069  ']=np.nan..    i
-00004300: 6620 6e6f 7420 6e70 2e69 736e 616e 2864  f not np.isnan(d
-00004310: 665f 6f75 745b 2748 4231 5f70 6f73 275d  f_out['HB1_pos']
-00004320: 2e69 6c6f 635b 305d 293a 0a20 2020 2020  .iloc[0]):.     
-00004330: 2020 2044 6961 6431 5f62 6574 7765 656e     Diad1_between
-00004340: 3d44 6961 645b 2844 6961 645b 3a2c 2030  =Diad[(Diad[:, 0
-00004350: 5d3e 6466 5f6f 7574 5b27 4842 315f 706f  ]>df_out['HB1_po
-00004360: 7327 5d2e 696c 6f63 5b30 5d29 2620 2844  s'].iloc[0])& (D
-00004370: 6961 645b 3a2c 2030 5d3c 6466 5f6f 7574  iad[:, 0]<df_out
-00004380: 5b27 4469 6164 315f 706f 7327 5d2e 696c  ['Diad1_pos'].il
-00004390: 6f63 5b30 5d29 5d0a 2020 2020 2020 2020  oc[0])].        
-000043a0: 4d69 6e5f 795f 6d69 6470 6f69 6e74 313d  Min_y_midpoint1=
-000043b0: 6e70 2e6d 696e 2844 6961 6431 5f62 6574  np.min(Diad1_bet
-000043c0: 7765 656e 5b3a 2c20 315d 290a 0a20 2020  ween[:, 1])..   
-000043d0: 2020 2020 2023 206f 7074 696f 6e20 6865       # option he
-000043e0: 7265 2073 6565 6d73 2074 6f20 776f 726b  re seems to work
-000043f0: 2062 6574 7465 720a 2020 2020 2020 2020   better.        
-00004400: 4c48 535f 785f 4469 6164 313d 2864 665f  LHS_x_Diad1=(df_
-00004410: 6f75 745b 2748 4231 5f70 6f73 275d 2e69  out['HB1_pos'].i
-00004420: 6c6f 635b 305d 292d 3230 0a20 2020 2020  loc[0])-20.     
-00004430: 2020 204c 4853 5f79 5f44 6961 6431 3d6e     LHS_y_Diad1=n
-00004440: 702e 6d65 6469 616e 2844 6961 645b 3a2c  p.median(Diad[:,
-00004450: 2031 5d5b 0a20 2020 2020 2020 2020 2020   1][.           
-00004460: 2028 4469 6164 5b3a 2c20 305d 3c4c 4853   (Diad[:, 0]<LHS
-00004470: 5f78 5f44 6961 6431 2b32 2e31 2a73 7065  _x_Diad1+2.1*spe
-00004480: 635f 7265 7329 0a20 2020 2020 2020 2020  c_res).         
-00004490: 2020 2026 2844 6961 645b 3a2c 2030 5d3e     &(Diad[:, 0]>
-000044a0: 4c48 535f 785f 4469 6164 312d 322e 312a  LHS_x_Diad1-2.1*
-000044b0: 7370 6563 5f72 6573 295d 290a 0a0a 2020  spec_res)])...  
-000044c0: 2020 2020 2020 6466 5f6f 7574 5b27 4469        df_out['Di
-000044d0: 6164 315f 4842 315f 5661 6c6c 6579 5f70  ad1_HB1_Valley_p
-000044e0: 726f 6d27 5d3d 4d69 6e5f 795f 6d69 6470  rom']=Min_y_midp
-000044f0: 6f69 6e74 312f 4c48 535f 795f 4469 6164  oint1/LHS_y_Diad
-00004500: 310a 2020 2020 656c 7365 3a0a 2020 2020  1.    else:.    
-00004510: 2020 2020 6466 5f6f 7574 5b27 4469 6164      df_out['Diad
-00004520: 315f 4842 315f 5661 6c6c 6579 5f70 726f  1_HB1_Valley_pro
-00004530: 6d27 5d3d 6e70 2e6e 616e 0a20 2020 2023  m']=np.nan.    #
-00004540: 2044 6976 6964 6520 6279 2074 6865 206d   Divide by the m
-00004550: 6564 6961 6e20 6261 636b 6772 6f75 6e64  edian background
-00004560: 2070 6f73 6974 696f 6e20 666f 756e 6420   position found 
-00004570: 6162 6f76 650a 0a0a 0a0a 0a0a 2020 2020  above.......    
-00004580: 2320 4f74 6865 7220 7573 6566 756c 2070  # Other useful p
-00004590: 6172 616d 730a 0a20 2020 2023 204d 6561  arams..    # Mea
-000045a0: 6e20 6f66 2048 4220 656c 6576 6174 696f  n of HB elevatio
-000045b0: 6e2e 0a20 2020 2064 665f 6f75 745b 274d  n..    df_out['M
-000045c0: 6561 6e5f 4469 6164 5f48 425f 5661 6c6c  ean_Diad_HB_Vall
-000045d0: 6579 5f70 726f 6d27 5d3d 2864 665f 6f75  ey_prom']=(df_ou
-000045e0: 745b 2744 6961 6432 5f48 4232 5f56 616c  t['Diad2_HB2_Val
-000045f0: 6c65 795f 7072 6f6d 275d 2b64 665f 6f75  ley_prom']+df_ou
-00004600: 745b 2744 6961 6431 5f48 4231 5f56 616c  t['Diad1_HB1_Val
-00004610: 6c65 795f 7072 6f6d 275d 292f 320a 0a20  ley_prom'])/2.. 
-00004620: 2020 2023 204d 6561 6e20 4842 2070 726f     # Mean HB pro
-00004630: 6d69 6e65 6e63 650a 2020 2020 6466 5f6f  minence.    df_o
-00004640: 7574 5b27 4d65 616e 5f61 6273 5f48 425f  ut['Mean_abs_HB_
-00004650: 7072 6f6d 275d 3d28 6466 5f6f 7574 5b27  prom']=(df_out['
-00004660: 4842 315f 6162 735f 7072 6f6d 275d 2b64  HB1_abs_prom']+d
-00004670: 665f 6f75 745b 2748 4232 5f61 6273 5f70  f_out['HB2_abs_p
-00004680: 726f 6d27 5d29 0a0a 2020 2020 6466 5f6f  rom'])..    df_o
-00004690: 7574 5b27 4469 6164 325f 4842 325f 6162  ut['Diad2_HB2_ab
-000046a0: 735f 7072 6f6d 5f72 6174 696f 275d 3d64  s_prom_ratio']=d
-000046b0: 665f 6f75 745b 2744 6961 6432 5f61 6273  f_out['Diad2_abs
-000046c0: 5f70 726f 6d27 5d2f 6466 5f6f 7574 5b27  _prom']/df_out['
-000046d0: 4842 325f 6162 735f 7072 6f6d 275d 0a20  HB2_abs_prom']. 
-000046e0: 2020 2064 665f 6f75 745b 2744 6961 6431     df_out['Diad1
-000046f0: 5f48 4231 5f61 6273 5f70 726f 6d5f 7261  _HB1_abs_prom_ra
-00004700: 7469 6f27 5d3d 6466 5f6f 7574 5b27 4469  tio']=df_out['Di
-00004710: 6164 315f 6162 735f 7072 6f6d 275d 2f64  ad1_abs_prom']/d
-00004720: 665f 6f75 745b 2748 4231 5f61 6273 5f70  f_out['HB1_abs_p
-00004730: 726f 6d27 5d0a 2020 2020 2320 4176 6572  rom'].    # Aver
-00004740: 6167 6520 7468 6573 650a 2020 2020 6466  age these.    df
-00004750: 5f6f 7574 5b27 4176 5f44 6961 645f 4842  _out['Av_Diad_HB
-00004760: 5f70 726f 6d5f 7261 7469 6f27 5d3d 2864  _prom_ratio']=(d
-00004770: 665f 6f75 745b 2744 6961 6432 5f48 4232  f_out['Diad2_HB2
-00004780: 5f61 6273 5f70 726f 6d5f 7261 7469 6f27  _abs_prom_ratio'
-00004790: 5d2b 6466 5f6f 7574 5b27 4469 6164 315f  ]+df_out['Diad1_
-000047a0: 4842 315f 6162 735f 7072 6f6d 5f72 6174  HB1_abs_prom_rat
-000047b0: 696f 275d 292f 320a 2020 2020 2320 5061  io'])/2.    # Pa
-000047c0: 7261 6d65 7465 7220 666f 7220 616d 6f75  rameter for amou
-000047d0: 6e74 206f 6620 6e6f 6973 6520 6265 7477  nt of noise betw
-000047e0: 6565 6e20 6469 6164 7320 7673 2e20 6865  een diads vs. he
-000047f0: 6967 6874 206f 6620 7065 616b 730a 0a20  ight of peaks.. 
-00004800: 2020 2062 6574 7765 656e 5f64 6961 6473     between_diads
-00004810: 5f78 3d28 783e 6469 6164 5f69 645f 636f  _x=(x>diad_id_co
-00004820: 6e66 6967 2e52 485f 6263 6b5f 6469 6164  nfig.RH_bck_diad
-00004830: 315b 305d 2926 2878 3c64 6961 645f 6964  1[0])&(x<diad_id
-00004840: 5f63 6f6e 6669 672e 4c48 5f62 636b 5f64  _config.LH_bck_d
-00004850: 6961 6432 5b31 5d29 0a20 2020 2073 7464  iad2[1]).    std
-00004860: 5f62 6574 5f64 6961 643d 6e70 2e73 7464  _bet_diad=np.std
-00004870: 2879 5b62 6574 7765 656e 5f64 6961 6473  (y[between_diads
-00004880: 5f78 5d29 0a0a 2020 2020 6466 5f6f 7574  _x])..    df_out
-00004890: 5b27 4469 6164 315f 7072 6f6d 2f73 7464  ['Diad1_prom/std
-000048a0: 5f62 6574 7765 656e 6469 6164 7327 5d3d  _betweendiads']=
-000048b0: 6466 5f6f 7574 5b27 4469 6164 315f 6162  df_out['Diad1_ab
-000048c0: 735f 7072 6f6d 275d 2f73 7464 5f62 6574  s_prom']/std_bet
-000048d0: 5f64 6961 640a 2020 2020 6466 5f6f 7574  _diad.    df_out
-000048e0: 5b27 4469 6164 325f 7072 6f6d 2f73 7464  ['Diad2_prom/std
-000048f0: 5f62 6574 7765 656e 6469 6164 7327 5d3d  _betweendiads']=
-00004900: 6466 5f6f 7574 5b27 4469 6164 325f 6162  df_out['Diad2_ab
-00004910: 735f 7072 6f6d 275d 2f73 7464 5f62 6574  s_prom']/std_bet
-00004920: 5f64 6961 640a 2020 2020 6466 5f6f 7574  _diad.    df_out
-00004930: 5b27 4842 315f 7072 6f6d 2f73 7464 5f62  ['HB1_prom/std_b
-00004940: 6574 7765 656e 6469 6164 7327 5d3d 6466  etweendiads']=df
-00004950: 5f6f 7574 5b27 4842 315f 6162 735f 7072  _out['HB1_abs_pr
-00004960: 6f6d 275d 2f73 7464 5f62 6574 5f64 6961  om']/std_bet_dia
-00004970: 640a 2020 2020 6466 5f6f 7574 5b27 4842  d.    df_out['HB
-00004980: 325f 7072 6f6d 2f73 7464 5f62 6574 7765  2_prom/std_betwe
-00004990: 656e 6469 6164 7327 5d3d 6466 5f6f 7574  endiads']=df_out
-000049a0: 5b27 4842 325f 6162 735f 7072 6f6d 275d  ['HB2_abs_prom']
-000049b0: 2f73 7464 5f62 6574 5f64 6961 640a 0a20  /std_bet_diad.. 
-000049c0: 2020 2023 204e 6577 206f 6e65 730a 2020     # New ones.  
-000049d0: 2020 6466 5f6f 7574 5b27 4176 5f44 6961    df_out['Av_Dia
-000049e0: 645f 7072 6f6d 2f73 7464 5f62 6574 7765  d_prom/std_betwe
-000049f0: 656e 6469 6164 7327 5d3d 2864 665f 6f75  endiads']=(df_ou
-00004a00: 745b 2744 6961 6431 5f70 726f 6d2f 7374  t['Diad1_prom/st
-00004a10: 645f 6265 7477 6565 6e64 6961 6473 275d  d_betweendiads']
-00004a20: 2b64 665f 6f75 745b 2744 6961 6432 5f70  +df_out['Diad2_p
-00004a30: 726f 6d2f 7374 645f 6265 7477 6565 6e64  rom/std_betweend
-00004a40: 6961 6473 275d 292f 320a 2020 2020 6466  iads'])/2.    df
-00004a50: 5f6f 7574 5b27 4331 335f 7072 6f6d 2f48  _out['C13_prom/H
-00004a60: 4232 5f70 726f 6d27 5d3d 6466 5f6f 7574  B2_prom']=df_out
-00004a70: 5b27 4331 335f 6162 735f 7072 6f6d 275d  ['C13_abs_prom']
-00004a80: 2f64 665f 6f75 745b 2748 4232 5f61 6273  /df_out['HB2_abs
-00004a90: 5f70 726f 6d27 5d0a 0a20 2020 2064 665f  _prom']..    df_
-00004aa0: 6f75 745b 274c 6566 745f 7673 5f52 6967  out['Left_vs_Rig
-00004ab0: 6874 275d 3d4d 6564 5f4c 4853 5f64 6961  ht']=Med_LHS_dia
-00004ac0: 6431 2f4d 6564 5f52 4853 5f64 6961 6432  d1/Med_RHS_diad2
-00004ad0: 0a0a 0a0a 2020 2020 2320 4c65 7473 2073  ....    # Lets s
-00004ae0: 6f72 7420 6261 7365 6420 6f6e 2063 6f6c  ort based on col
-00004af0: 756d 6e73 2077 6520 7761 6e74 206e 6561  umns we want nea
-00004b00: 7220 6561 6368 206f 7468 6572 0a20 2020  r each other.   
-00004b10: 2063 6f6c 735f 746f 5f6d 6f76 6520 3d20   cols_to_move = 
-00004b20: 5b27 6669 6c65 6e61 6d65 272c 2027 6170  ['filename', 'ap
-00004b30: 7072 6f78 5f73 706c 6974 272c 0a20 2020  prox_split',.   
-00004b40: 2027 4469 6164 315f 706f 7327 2c20 2744   'Diad1_pos', 'D
-00004b50: 6961 6432 5f70 6f73 272c 2748 4231 5f70  iad2_pos','HB1_p
-00004b60: 6f73 272c 2027 4842 325f 706f 7327 2c20  os', 'HB2_pos', 
-00004b70: 2743 3133 5f70 6f73 272c 0a20 2020 2027  'C13_pos',.    '
-00004b80: 4469 6164 315f 6162 735f 7072 6f6d 272c  Diad1_abs_prom',
-00004b90: 2027 4469 6164 325f 6162 735f 7072 6f6d   'Diad2_abs_prom
-00004ba0: 272c 2027 4842 315f 6162 735f 7072 6f6d  ', 'HB1_abs_prom
-00004bb0: 272c 2027 4842 325f 6162 735f 7072 6f6d  ', 'HB2_abs_prom
-00004bc0: 272c 2027 4331 335f 6162 735f 7072 6f6d  ', 'C13_abs_prom
-00004bd0: 272c 0a20 2020 2027 4d65 616e 5f61 6273  ',.    'Mean_abs
-00004be0: 5f48 425f 7072 6f6d 272c 2027 4469 6164  _HB_prom', 'Diad
-00004bf0: 325f 4842 325f 6162 735f 7072 6f6d 5f72  2_HB2_abs_prom_r
-00004c00: 6174 696f 272c 2027 4469 6164 315f 4842  atio', 'Diad1_HB
-00004c10: 315f 6162 735f 7072 6f6d 5f72 6174 696f  1_abs_prom_ratio
-00004c20: 272c 0a20 2020 2027 4469 6164 315f 7265  ',.    'Diad1_re
-00004c30: 6c5f 7072 6f6d 272c 2027 4469 6164 325f  l_prom', 'Diad2_
-00004c40: 7265 6c5f 7072 6f6d 272c 2027 4842 315f  rel_prom', 'HB1_
-00004c50: 7265 6c5f 7072 6f6d 272c 2027 4842 325f  rel_prom', 'HB2_
-00004c60: 7265 6c5f 7072 6f6d 272c 2027 4331 335f  rel_prom', 'C13_
-00004c70: 7265 6c5f 7072 6f6d 272c 0a20 2020 2027  rel_prom',.    '
-00004c80: 4469 6164 315f 4842 315f 5661 6c6c 6579  Diad1_HB1_Valley
-00004c90: 5f70 726f 6d27 2c0a 2020 2020 274d 6561  _prom',.    'Mea
-00004ca0: 6e5f 4469 6164 5f48 425f 5661 6c6c 6579  n_Diad_HB_Valley
-00004cb0: 5f70 726f 6d27 2c0a 2020 2020 2744 6961  _prom',.    'Dia
-00004cc0: 6431 5f70 726f 6d2f 7374 645f 6265 7477  d1_prom/std_betw
-00004cd0: 6565 6e64 6961 6473 272c 2027 4469 6164  eendiads', 'Diad
-00004ce0: 325f 7072 6f6d 2f73 7464 5f62 6574 7765  2_prom/std_betwe
-00004cf0: 656e 6469 6164 7327 2c0a 2020 2020 2741  endiads',.    'A
-00004d00: 765f 4469 6164 5f70 726f 6d2f 7374 645f  v_Diad_prom/std_
-00004d10: 6265 7477 6565 6e64 6961 6473 272c 2027  betweendiads', '
-00004d20: 4331 335f 7072 6f6d 2f48 4232 5f70 726f  C13_prom/HB2_pro
-00004d30: 6d27 2c20 2741 765f 4469 6164 5f48 425f  m', 'Av_Diad_HB_
-00004d40: 7072 6f6d 5f72 6174 696f 272c 2027 4c65  prom_ratio', 'Le
-00004d50: 6674 5f76 735f 5269 6768 7427 5d0a 0a20  ft_vs_Right'].. 
-00004d60: 2020 2064 665f 6f75 7420 3d20 6466 5f6f     df_out = df_o
-00004d70: 7574 5b63 6f6c 735f 746f 5f6d 6f76 6520  ut[cols_to_move 
-00004d80: 2b20 5b0a 2020 2020 2020 2020 636f 6c20  + [.        col 
-00004d90: 666f 7220 636f 6c20 696e 2064 665f 6f75  for col in df_ou
-00004da0: 742e 636f 6c75 6d6e 7320 6966 2063 6f6c  t.columns if col
-00004db0: 206e 6f74 2069 6e20 636f 6c73 5f74 6f5f   not in cols_to_
-00004dc0: 6d6f 7665 5d5d 0a20 2020 2023 204e 6f77  move]].    # Now
-00004dd0: 206c 6574 7320 6765 7420 6170 7072 6f78   lets get approx
-00004de0: 696d 6174 6520 7374 7265 6e67 7468 2073  imate strength s
-00004df0: 7562 7472 6163 7469 6e67 2074 6865 2062  ubtracting the b
-00004e00: 6163 6b67 7272 6f75 6e64 0a0a 2020 2020  ackgrround..    
-00004e10: 2320 4e6f 7720 6c65 7473 206d 616b 6520  # Now lets make 
-00004e20: 6120 706c 6f74 0a20 2020 2069 6620 706c  a plot.    if pl
-00004e30: 6f74 5f66 6967 7572 6520 6973 2054 7275  ot_figure is Tru
-00004e40: 653a 0a20 2020 2020 2020 2066 6967 2c20  e:.        fig, 
-00004e50: 2861 7830 2c20 6178 312c 2061 7832 2920  (ax0, ax1, ax2) 
-00004e60: 3d20 706c 742e 7375 6270 6c6f 7473 2831  = plt.subplots(1
-00004e70: 2c20 332c 2066 6967 7369 7a65 3d28 3132  , 3, figsize=(12
-00004e80: 2c34 2929 0a0a 2020 2020 2020 2020 6178  ,4))..        ax
-00004e90: 302e 706c 6f74 2844 6961 645b 3a2c 2030  0.plot(Diad[:, 0
-00004ea0: 5d2c 2044 6961 645b 3a2c 2031 5d2c 2027  ], Diad[:, 1], '
-00004eb0: 2d72 2729 0a20 2020 2020 2020 2061 7830  -r').        ax0
-00004ec0: 2e70 6c6f 7428 6466 5b27 706f 7327 5d2c  .plot(df['pos'],
-00004ed0: 2064 665b 2768 6569 6768 7427 5d2c 2027   df['height'], '
-00004ee0: 2a6b 2729 0a20 2020 2020 2020 2061 7831  *k').        ax1
-00004ef0: 2e70 6c6f 7428 6466 5b27 706f 7327 5d2c  .plot(df['pos'],
-00004f00: 2064 665b 2768 6569 6768 7427 5d2c 2027   df['height'], '
-00004f10: 2a6b 272c 206c 6162 656c 3d27 416c 6c20  *k', label='All 
-00004f20: 5363 6970 7920 5065 616b 7327 290a 2020  Scipy Peaks').  
-00004f30: 2020 2020 2020 6178 322e 706c 6f74 2864        ax2.plot(d
-00004f40: 665b 2770 6f73 275d 2c20 6466 5b27 6865  f['pos'], df['he
-00004f50: 6967 6874 275d 2c20 272a 6b27 290a 2020  ight'], '*k').  
-00004f60: 2020 2020 2020 6966 206d 616e 7561 6c5f        if manual_
-00004f70: 6469 6164 3120 6973 2054 7275 653a 0a20  diad1 is True:. 
-00004f80: 2020 2020 2020 2020 2020 2061 7831 2e70             ax1.p
-00004f90: 6c6f 7428 6469 6164 315f 706f 735b 305d  lot(diad1_pos[0]
-00004fa0: 2c20 6469 6164 315f 6865 6967 6874 2c20  , diad1_height, 
-00004fb0: 2764 6b27 2c20 6d66 633d 2779 656c 6c6f  'dk', mfc='yello
-00004fc0: 7727 2c20 6d73 3d37 2c20 6c61 6265 6c3d  w', ms=7, label=
-00004fd0: 2753 6369 5079 4d69 7373 6564 2729 0a0a  'SciPyMissed')..
-00004fe0: 2020 2020 2020 2020 6966 206d 616e 7561          if manua
-00004ff0: 6c5f 6469 6164 3220 6973 2054 7275 653a  l_diad2 is True:
-00005000: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
-00005010: 2e70 6c6f 7428 6469 6164 325f 706f 735b  .plot(diad2_pos[
-00005020: 305d 2c20 6469 6164 325f 6865 6967 6874  0], diad2_height
-00005030: 2c20 2764 6b27 2c20 6d66 633d 2779 656c  , 'dk', mfc='yel
-00005040: 6c6f 7727 2c20 6d73 3d37 290a 2020 2020  low', ms=7).    
-00005050: 2020 2020 2361 7830 2e6c 6567 656e 6428      #ax0.legend(
-00005060: 290a 2020 2020 2020 2020 6178 312e 7365  ).        ax1.se
-00005070: 745f 7469 746c 6528 2744 6961 6431 2729  t_title('Diad1')
-00005080: 0a20 2020 2020 2020 2061 7831 2e70 6c6f  .        ax1.plo
-00005090: 7428 4469 6164 5b3a 2c20 305d 2c44 6961  t(Diad[:, 0],Dia
-000050a0: 645b 3a2c 2031 5d2c 2027 2d72 2729 0a20  d[:, 1], '-r'). 
-000050b0: 2020 2020 2020 2061 7831 2e73 6574 5f78         ax1.set_x
-000050c0: 6c69 6d28 5b63 6f6e 6669 672e 4469 6164  lim([config.Diad
-000050d0: 315f 7769 6e64 6f77 5b30 5d2c 2063 6f6e  1_window[0], con
-000050e0: 6669 672e 4469 6164 315f 7769 6e64 6f77  fig.Diad1_window
-000050f0: 5b31 5d5d 290a 2020 2020 2020 2020 6178  [1]]).        ax
-00005100: 322e 7365 745f 7469 746c 6528 2744 6961  2.set_title('Dia
-00005110: 6432 2729 0a20 2020 2020 2020 2061 7832  d2').        ax2
-00005120: 2e70 6c6f 7428 4469 6164 5b3a 2c20 305d  .plot(Diad[:, 0]
-00005130: 2c44 6961 645b 3a2c 2031 5d2c 2027 2d72  ,Diad[:, 1], '-r
-00005140: 2729 0a20 2020 2020 2020 2061 7832 2e73  ').        ax2.s
-00005150: 6574 5f78 6c69 6d28 5b63 6f6e 6669 672e  et_xlim([config.
-00005160: 4469 6164 325f 7769 6e64 6f77 5b30 5d2c  Diad2_window[0],
-00005170: 2063 6f6e 6669 672e 4469 6164 325f 7769   config.Diad2_wi
-00005180: 6e64 6f77 5b31 5d5d 290a 2020 2020 2020  ndow[1]]).      
-00005190: 2020 2361 7830 2e73 6574 5f79 6c69 6d5b    #ax0.set_ylim[
-000051a0: 6e70 2e6e 616e 6d69 6e28 4469 6164 5b3a  np.nanmin(Diad[:
-000051b0: 2c20 315d 292c 206e 702e 6e61 6e6d 6178  , 1]), np.nanmax
-000051c0: 2844 6961 645b 3a2c 2031 5d29 205d 290a  (Diad[:, 1]) ]).
-000051d0: 2020 2020 2020 2020 6669 672e 7469 6768          fig.tigh
-000051e0: 745f 6c61 796f 7574 2829 0a20 2020 2020  t_layout().     
-000051f0: 2020 2061 7832 2e70 6c6f 7428 6466 5f73     ax2.plot(df_s
-00005200: 6f72 745f 6469 6164 325f 7472 696d 5b27  ort_diad2_trim['
-00005210: 706f 7327 5d2c 2064 665f 736f 7274 5f64  pos'], df_sort_d
-00005220: 6961 6432 5f74 7269 6d5b 2768 6569 6768  iad2_trim['heigh
-00005230: 7427 5d2c 2027 2a6b 272c 206d 6663 3d27  t'], '*k', mfc='
-00005240: 7965 6c6c 6f77 272c 206d 733d 3130 290a  yellow', ms=10).
-00005250: 2020 2020 2020 2020 6178 312e 706c 6f74          ax1.plot
-00005260: 2864 665f 736f 7274 5f64 6961 6431 5f74  (df_sort_diad1_t
-00005270: 7269 6d5b 2770 6f73 275d 2c20 6466 5f73  rim['pos'], df_s
-00005280: 6f72 745f 6469 6164 315f 7472 696d 5b27  ort_diad1_trim['
-00005290: 6865 6967 6874 275d 2c20 272a 6b27 2c20  height'], '*k', 
-000052a0: 206d 6663 3d27 7965 6c6c 6f77 272c 206d   mfc='yellow', m
-000052b0: 733d 3130 2c20 6c61 6265 6c3d 2753 656c  s=10, label='Sel
-000052c0: 6563 7465 6420 506b 7327 290a 2020 2020  ected Pks').    
-000052d0: 2020 2020 6178 312e 6c65 6765 6e64 2829      ax1.legend()
-000052e0: 0a20 2020 2020 2020 2061 7830 2e73 6574  .        ax0.set
-000052f0: 5f78 6c61 6265 6c28 2757 6176 656e 756d  _xlabel('Wavenum
-00005300: 6265 7227 290a 2020 2020 2020 2020 6178  ber').        ax
-00005310: 302e 7365 745f 796c 6162 656c 2827 496e  0.set_ylabel('In
-00005320: 7465 6e73 6974 7927 290a 2020 2020 2020  tensity').      
-00005330: 2020 6178 312e 7365 745f 786c 6162 656c    ax1.set_xlabel
-00005340: 2827 5761 7665 6e75 6d62 6572 2729 0a20  ('Wavenumber'). 
-00005350: 2020 2020 2020 2061 7831 2e73 6574 5f79         ax1.set_y
-00005360: 6c61 6265 6c28 2749 6e74 656e 7369 7479  label('Intensity
-00005370: 2729 0a20 2020 2020 2020 2061 7832 2e73  ').        ax2.s
-00005380: 6574 5f78 6c61 6265 6c28 2757 6176 656e  et_xlabel('Waven
-00005390: 756d 6265 7227 290a 2020 2020 2020 2020  umber').        
-000053a0: 6178 322e 7365 745f 796c 6162 656c 2827  ax2.set_ylabel('
-000053b0: 496e 7465 6e73 6974 7927 290a 0a20 2020  Intensity')..   
-000053c0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-000053d0: 6e67 6528 302c 206c 656e 2864 665f 736f  nge(0, len(df_so
-000053e0: 7274 5f64 6961 6431 5f74 7269 6d29 293a  rt_diad1_trim)):
-000053f0: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
-00005400: 2e61 6e6e 6f74 6174 6528 7374 7228 6e70  .annotate(str(np
-00005410: 2e72 6f75 6e64 2864 665f 736f 7274 5f64  .round(df_sort_d
-00005420: 6961 6431 5f74 7269 6d5b 2770 6f73 275d  iad1_trim['pos']
-00005430: 2e69 6c6f 635b 695d 2c20 3129 292c 2078  .iloc[i], 1)), x
-00005440: 793d 2864 665f 736f 7274 5f64 6961 6431  y=(df_sort_diad1
-00005450: 5f74 7269 6d5b 2770 6f73 275d 2e69 6c6f  _trim['pos'].ilo
-00005460: 635b 695d 2d31 302c 0a20 2020 2020 2020  c[i]-10,.       
-00005470: 2020 2020 2064 665f 736f 7274 5f64 6961       df_sort_dia
-00005480: 6431 5f74 7269 6d5b 2768 6569 6768 7427  d1_trim['height'
-00005490: 5d2e 696c 6f63 5b69 5d2d 312f 372a 2864  ].iloc[i]-1/7*(d
-000054a0: 665f 736f 7274 5f64 6961 6431 5f74 7269  f_sort_diad1_tri
-000054b0: 6d5b 2768 6569 6768 7427 5d2e 696c 6f63  m['height'].iloc
-000054c0: 5b69 5d2d 3730 3029 292c 2078 7963 6f6f  [i]-700)), xycoo
-000054d0: 7264 733d 2264 6174 6122 2c20 666f 6e74  rds="data", font
-000054e0: 7369 7a65 3d31 302c 2072 6f74 6174 696f  size=10, rotatio
-000054f0: 6e3d 3930 290a 0a20 2020 2020 2020 2066  n=90)..        f
-00005500: 6f72 2069 2069 6e20 7261 6e67 6528 302c  or i in range(0,
-00005510: 206c 656e 2864 665f 736f 7274 5f64 6961   len(df_sort_dia
-00005520: 6432 5f74 7269 6d29 293a 0a20 2020 2020  d2_trim)):.     
-00005530: 2020 2020 2020 2061 7832 2e61 6e6e 6f74         ax2.annot
-00005540: 6174 6528 7374 7228 6e70 2e72 6f75 6e64  ate(str(np.round
-00005550: 2864 665f 736f 7274 5f64 6961 6432 5f74  (df_sort_diad2_t
-00005560: 7269 6d5b 2770 6f73 275d 2e69 6c6f 635b  rim['pos'].iloc[
-00005570: 695d 2c20 3129 292c 2078 793d 2864 665f  i], 1)), xy=(df_
-00005580: 736f 7274 5f64 6961 6432 5f74 7269 6d5b  sort_diad2_trim[
-00005590: 2770 6f73 275d 2e69 6c6f 635b 695d 2d31  'pos'].iloc[i]-1
-000055a0: 302c 0a20 2020 2020 2020 2020 2020 2064  0,.            d
-000055b0: 665f 736f 7274 5f64 6961 6432 5f74 7269  f_sort_diad2_tri
-000055c0: 6d5b 2768 6569 6768 7427 5d2e 696c 6f63  m['height'].iloc
-000055d0: 5b69 5d2d 312f 372a 2864 665f 736f 7274  [i]-1/7*(df_sort
-000055e0: 5f64 6961 6432 5f74 7269 6d5b 2768 6569  _diad2_trim['hei
-000055f0: 6768 7427 5d2e 696c 6f63 5b69 5d2d 3730  ght'].iloc[i]-70
-00005600: 3029 292c 2078 7963 6f6f 7264 733d 2264  0)), xycoords="d
-00005610: 6174 6122 2c20 666f 6e74 7369 7a65 3d31  ata", fontsize=1
-00005620: 302c 2072 6f74 6174 696f 6e3d 3930 290a  0, rotation=90).
-00005630: 0a0a 2020 2020 7265 7475 726e 2064 665f  ..    return df_
-00005640: 6f75 742c 2044 6961 642c 2066 6967 2069  out, Diad, fig i
-00005650: 6620 2766 6967 2720 696e 206c 6f63 616c  f 'fig' in local
-00005660: 7328 2920 656c 7365 204e 6f6e 650a 0a0a  s() else None...
-00005670: 0a0a 0a0a 0a0a 0a64 6566 206c 6f6f 705f  .......def loop_
-00005680: 6170 7072 6f78 5f64 6961 645f 6669 7473  approx_diad_fits
-00005690: 282a 2c20 7370 6563 7472 615f 7061 7468  (*, spectra_path
-000056a0: 2c20 636f 6e66 6967 2c20 4469 6164 5f46  , config, Diad_F
-000056b0: 696c 6573 2c20 6669 6c65 7479 7065 2c20  iles, filetype, 
-000056c0: 706c 6f74 5f66 6967 7572 6529 3a0a 2020  plot_figure):.  
-000056d0: 2020 2222 2220 5573 6573 2074 6865 2069    """ Uses the i
-000056e0: 6465 6e74 6966 795f 6469 6164 5f70 6561  dentify_diad_pea
-000056f0: 6b73 2066 756e 6374 696f 6e20 746f 206c  ks function to l
-00005700: 6f6f 7020 6f76 6572 2061 6c6c 2066 696c  oop over all fil
-00005710: 6573 2e0a 2020 2020 5061 7261 6d65 7465  es..    Paramete
-00005720: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00005730: 2d2d 2d2d 2d2d 2d0a 2020 2020 636f 6e66  -------.    conf
-00005740: 6967 3a20 6461 7461 636c 6173 730a 2020  ig: dataclass.  
-00005750: 2020 2020 2020 5365 6520 646f 6375 6d65        See docume
-00005760: 6e74 6174 696f 6e20 666f 7220 6964 656e  ntation for iden
-00005770: 7469 6679 5f64 6961 645f 7065 616b 730a  tify_diad_peaks.
-00005780: 0a20 2020 2073 7065 6374 7261 5f70 6174  .    spectra_pat
-00005790: 683a 2073 7472 0a20 2020 2020 2020 2050  h: str.        P
-000057a0: 6174 6820 7768 6572 6520 7370 6563 7472  ath where spectr
-000057b0: 6120 6973 2073 746f 7265 640a 0a20 2020  a is stored..   
-000057c0: 2044 6961 645f 4669 6c65 733a 206c 6973   Diad_Files: lis
-000057d0: 740a 2020 2020 2020 2020 4c69 7374 206f  t.        List o
-000057e0: 6620 6669 6c65 206e 616d 6573 2074 6f20  f file names to 
-000057f0: 6c6f 6f70 206f 7665 720a 0a20 2020 2066  loop over..    f
-00005800: 696c 6574 7970 653a 2073 7472 0a20 2020  iletype: str.   
-00005810: 2020 2020 2063 686f 6f73 6520 6672 6f6d       choose from
-00005820: 2027 5769 7465 635f 4153 4349 4927 2c20   'Witec_ASCII', 
-00005830: 2768 6561 646c 6573 735f 7478 7427 2c20  'headless_txt', 
-00005840: 2768 6561 646c 6573 735f 6373 7627 2c20  'headless_csv', 
-00005850: 2768 6561 645f 6373 7627 2c20 2757 6974  'head_csv', 'Wit
-00005860: 6563 5f41 5343 4949 272c 0a20 2020 2020  ec_ASCII',.     
-00005870: 2020 2027 484f 5249 4241 5f74 7874 272c     'HORIBA_txt',
-00005880: 2027 5265 6e69 7368 6177 5f74 7874 270a   'Renishaw_txt'.
-00005890: 0a20 2020 2070 6c6f 745f 6669 6775 7265  .    plot_figure
-000058a0: 3a20 626f 6f6c 0a20 2020 2020 2020 2069  : bool.        i
-000058b0: 6620 5472 7565 2c20 706c 6f74 7320 6120  f True, plots a 
-000058c0: 6669 6775 7265 206f 6620 7065 616b 732c  figure of peaks,
-000058d0: 2061 6e64 2074 6865 2069 6465 6e74 6966   and the identif
-000058e0: 6965 6420 7065 616b 7320 7468 6174 2053  ied peaks that S
-000058f0: 6369 7079 2066 6f75 6e64 0a0a 2020 2020  cipy found..    
-00005900: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-00005910: 2d2d 2d2d 2d2d 2d0a 2020 2020 7064 2e44  -------.    pd.D
-00005920: 6174 6146 7261 6d65 206f 6620 7468 6520  ataFrame of the 
-00005930: 6170 7072 6f78 696d 6174 6520 7065 616b  approximate peak
-00005940: 2070 6172 616d 6574 6572 7320 666f 7220   parameters for 
-00005950: 6561 6368 2066 696c 652e 0a0a 2020 2020  each file...    
-00005960: 6e70 2e61 7272 6179 206f 6620 7920 636f  np.array of y co
-00005970: 6f72 6469 6e61 7465 7320 6f66 2065 7665  ordinates of eve
-00005980: 7279 2073 7065 6374 7261 2e0a 0a0a 2020  ry spectra....  
-00005990: 2020 2222 220a 0a20 2020 2023 2044 6f20    """..    # Do 
-000059a0: 6669 7420 666f 7220 6669 7273 7420 6669  fit for first fi
-000059b0: 6c65 2074 6f20 6765 7420 6c65 6e67 7468  le to get length
-000059c0: 0a20 2020 2064 665f 7065 616b 732c 2044  .    df_peaks, D
-000059d0: 6961 642c 2066 6967 3d69 6465 6e74 6966  iad, fig=identif
-000059e0: 795f 6469 6164 5f70 6561 6b73 280a 2020  y_diad_peaks(.  
-000059f0: 2020 636f 6e66 6967 3d63 6f6e 6669 672c    config=config,
-00005a00: 2070 6174 683d 7370 6563 7472 615f 7061   path=spectra_pa
-00005a10: 7468 2c20 6669 6c65 6e61 6d65 3d44 6961  th, filename=Dia
-00005a20: 645f 4669 6c65 735b 305d 2c0a 2020 2020  d_Files[0],.    
-00005a30: 6669 6c65 7479 7065 3d66 696c 6574 7970  filetype=filetyp
-00005a40: 652c 2070 6c6f 745f 6669 6775 7265 3d70  e, plot_figure=p
-00005a50: 6c6f 745f 6669 6775 7265 290a 0a20 2020  lot_figure)..   
-00005a60: 2023 204e 6f77 2064 6f20 666f 7220 616c   # Now do for al
-00005a70: 6c20 6669 6c65 730a 2020 2020 6669 745f  l files.    fit_
-00005a80: 7061 7261 6d73 203d 2070 642e 4461 7461  params = pd.Data
-00005a90: 4672 616d 6528 5b5d 290a 2020 2020 785f  Frame([]).    x_
-00005aa0: 636f 7264 3d44 6961 645b 3a2c 2030 5d0a  cord=Diad[:, 0].
-00005ab0: 2020 2020 6461 7461 5f79 5f61 6c6c 3d6e      data_y_all=n
-00005ac0: 702e 656d 7074 7928 5b20 206c 656e 2878  p.empty([  len(x
-00005ad0: 5f63 6f72 6429 2c20 6c65 6e28 4469 6164  _cord), len(Diad
-00005ae0: 5f46 696c 6573 295d 2c20 666c 6f61 7429  _Files)], float)
-00005af0: 0a20 2020 2064 6174 615f 785f 616c 6c3d  .    data_x_all=
-00005b00: 6e70 2e65 6d70 7479 285b 2020 6c65 6e28  np.empty([  len(
-00005b10: 785f 636f 7264 292c 206c 656e 2844 6961  x_cord), len(Dia
-00005b20: 645f 4669 6c65 7329 5d2c 2066 6c6f 6174  d_Files)], float
-00005b30: 290a 2020 2020 693d 300a 2020 2020 666f  ).    i=0.    fo
-00005b40: 7220 6669 6c65 2069 6e20 7471 646d 2844  r file in tqdm(D
-00005b50: 6961 645f 4669 6c65 7329 3a0a 0a0a 2020  iad_Files):...  
-00005b60: 2020 2020 2020 6466 5f70 6561 6b73 2c20        df_peaks, 
-00005b70: 4469 6164 2c20 6669 673d 6964 656e 7469  Diad, fig=identi
-00005b80: 6679 5f64 6961 645f 7065 616b 7328 0a20  fy_diad_peaks(. 
-00005b90: 2020 2020 2020 2063 6f6e 6669 673d 636f         config=co
-00005ba0: 6e66 6967 2c20 7061 7468 3d73 7065 6374  nfig, path=spect
-00005bb0: 7261 5f70 6174 682c 2066 696c 656e 616d  ra_path, filenam
-00005bc0: 653d 6669 6c65 2c0a 2020 2020 6669 6c65  e=file,.    file
-00005bd0: 7479 7065 3d66 696c 6574 7970 652c 2070  type=filetype, p
-00005be0: 6c6f 745f 6669 6775 7265 3d70 6c6f 745f  lot_figure=plot_
-00005bf0: 6669 6775 7265 290a 0a20 2020 2020 2020  figure)..       
-00005c00: 2064 6174 615f 795f 616c 6c5b 3a2c 2069   data_y_all[:, i
-00005c10: 5d3d 4469 6164 5b3a 2c20 315d 0a20 2020  ]=Diad[:, 1].   
-00005c20: 2020 2020 2064 6174 615f 785f 616c 6c5b       data_x_all[
-00005c30: 3a2c 2069 5d3d 4469 6164 5b3a 2c20 305d  :, i]=Diad[:, 0]
-00005c40: 0a20 2020 2020 2020 2023 6461 7461 203d  .        #data =
-00005c50: 2070 642e 636f 6e63 6174 285b 4469 6164   pd.concat([Diad
-00005c60: 2c20 6461 7461 5d2c 2061 7869 733d 3029  , data], axis=0)
-00005c70: 0a20 2020 2020 2020 2066 6974 5f70 6172  .        fit_par
-00005c80: 616d 7320 3d20 7064 2e63 6f6e 6361 7428  ams = pd.concat(
-00005c90: 5b66 6974 5f70 6172 616d 732c 2064 665f  [fit_params, df_
-00005ca0: 7065 616b 735d 2c20 6178 6973 3d30 290a  peaks], axis=0).
-00005cb0: 2020 2020 2020 2020 693d 692b 310a 0a20          i=i+1.. 
-00005cc0: 2020 2066 6974 5f70 6172 616d 733d 6669     fit_params=fi
-00005cd0: 745f 7061 7261 6d73 2e72 6573 6574 5f69  t_params.reset_i
-00005ce0: 6e64 6578 2864 726f 703d 5472 7565 290a  ndex(drop=True).
-00005cf0: 2020 2020 2320 4c65 7473 2063 6865 636b      # Lets check
-00005d00: 2061 6c6c 2064 6174 6120 7820 6172 6520   all data x are 
-00005d10: 7468 6520 7361 6d65 2e0a 2020 2020 613d  the same..    a=
-00005d20: 6461 7461 5f78 5f61 6c6c 0a20 2020 2073  data_x_all.    s
-00005d30: 616d 6520 3d20 6e70 2e61 6c6c 2861 5b30  ame = np.all(a[0
-00005d40: 2c20 3a5d 203d 3d20 615b 302c 2030 5d29  , :] == a[0, 0])
-00005d50: 0a0a 2020 2020 6966 2073 616d 653d 3d54  ..    if same==T
-00005d60: 7275 653a 0a0a 2020 2020 2020 2020 7265  rue:..        re
-00005d70: 7475 726e 2066 6974 5f70 6172 616d 732c  turn fit_params,
-00005d80: 2064 6174 615f 795f 616c 6c0a 2020 2020   data_y_all.    
-00005d90: 6966 2073 616d 653d 3d46 616c 7365 3a0a  if same==False:.
-00005da0: 2020 2020 2020 2020 7072 696e 7428 2759          print('Y
-00005db0: 6f75 2064 6f20 6e6f 7420 6861 7665 2074  ou do not have t
-00005dc0: 6865 2073 616d 6520 7820 6178 6973 2066  he same x axis f
-00005dd0: 6f72 2061 6c6c 2073 7065 6374 7261 2e20  or all spectra. 
-00005de0: 2729 0a20 2020 2020 2020 2064 6966 665f  ').        diff_
-00005df0: 7661 6c5f 726f 7720 3d20 6e70 2e77 6865  val_row = np.whe
-00005e00: 7265 286e 702e 616e 7928 6120 213d 2061  re(np.any(a != a
-00005e10: 5b30 5d2c 2061 7869 733d 3129 295b 305d  [0], axis=1))[0]
-00005e20: 0a20 2020 2020 2020 2070 7269 6e74 2864  .        print(d
-00005e30: 6966 665f 7661 6c5f 726f 7729 0a0a 0a20  iff_val_row)... 
-00005e40: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
-00005e50: 745f 7061 7261 6d73 2c20 6461 7461 5f79  t_params, data_y
-00005e60: 5f61 6c6c 0a0a 0a0a 6465 6620 706c 6f74  _all....def plot
-00005e70: 5f70 6561 6b5f 7061 7261 6d73 2866 6974  _peak_params(fit
-00005e80: 5f70 6172 616d 732c 0a20 2020 2020 2020  _params,.       
-00005e90: 2020 2020 2020 2020 2020 2020 2020 785f                x_
-00005ea0: 7061 7261 6d3d 2744 6961 6431 5f70 6f73  param='Diad1_pos
-00005eb0: 272c 2020 7931 5f70 6172 616d 3d27 6170  ',  y1_param='ap
-00005ec0: 7072 6f78 5f73 706c 6974 272c 0a20 2020  prox_split',.   
-00005ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ee0: 2079 325f 7061 7261 6d3d 274d 6561 6e5f   y2_param='Mean_
-00005ef0: 5661 6c6c 6579 5f70 726f 6d27 2c20 7933  Valley_prom', y3
-00005f00: 5f70 6172 616d 3d27 4331 335f 6162 735f  _param='C13_abs_
-00005f10: 7072 6f6d 272c 0a20 2020 2020 2020 2020  prom',.         
-00005f20: 2020 2020 2020 2020 2020 2079 345f 7061             y4_pa
-00005f30: 7261 6d3d 2748 4232 5f61 6273 5f70 726f  ram='HB2_abs_pro
-00005f40: 6d27 2c20 6669 6c6c 5f6e 613d 3029 3a0a  m', fill_na=0):.
-00005f50: 0a20 2020 2022 2222 204d 616b 6573 2061  .    """ Makes a
-00005f60: 2032 5832 2066 6967 7572 6520 6f66 2066   2X2 figure of f
-00005f70: 6974 2070 6172 616d 6574 6572 732c 2077  it parameters, w
-00005f80: 6974 6820 7468 6520 7361 6d65 2078 2061  ith the same x a
-00005f90: 7869 732c 2061 6e64 2034 2064 6966 6665  xis, and 4 diffe
-00005fa0: 7265 6e74 2079 2061 7869 730a 0a20 2020  rent y axis..   
-00005fb0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00005fc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 0a20 2020  -----------..   
-00005fd0: 2066 6974 5f70 6172 616d 733a 2050 616e   fit_params: Pan
-00005fe0: 6461 7320 4461 7461 4672 616d 650a 2020  das DataFrame.  
-00005ff0: 2020 2020 2020 6461 7461 6672 616d 6520        dataframe 
-00006000: 6f66 2061 7070 726f 7869 6d61 7465 2066  of approximate f
-00006010: 6974 2070 6172 616d 7320 6672 6f6d 2066  it params from f
-00006020: 756e 6374 696f 6e20 6c6f 6f70 5f61 7070  unction loop_app
-00006030: 726f 785f 6469 6164 5f66 6974 730a 2020  rox_diad_fits.  
-00006040: 2020 785f 7061 7261 6d3a 2073 7472 0a20    x_param: str. 
-00006050: 2020 2020 2020 2070 6172 616d 6574 6572         parameter
-00006060: 2079 6f75 2077 616e 7420 6f6e 2074 6865   you want on the
-00006070: 2078 2061 7869 7320 6f66 2061 6c6c 2070   x axis of all p
-00006080: 6c6f 7473 0a20 2020 2079 315f 7061 7261  lots.    y1_para
-00006090: 6d3a 2073 7472 0a20 2020 2020 2020 2070  m: str.        p
-000060a0: 6172 616d 6574 6572 206f 6e20 7920 6178  arameter on y ax
-000060b0: 6973 206f 6620 3173 7420 7375 6270 6c6f  is of 1st subplo
-000060c0: 7420 2874 6f70 206c 6566 7429 0a20 2020  t (top left).   
-000060d0: 2079 325f 7061 7261 6d3a 2073 7472 0a20   y2_param: str. 
-000060e0: 2020 2020 2020 2070 6172 616d 6574 6572         parameter
-000060f0: 206f 6e20 7920 6178 6973 206f 6620 326e   on y axis of 2n
-00006100: 6420 7375 6270 6c6f 7420 2874 6f70 2072  d subplot (top r
-00006110: 6967 6874 290a 2020 2020 7933 5f70 6172  ight).    y3_par
-00006120: 616d 3a20 7374 720a 2020 2020 2020 2020  am: str.        
-00006130: 7061 7261 6d65 7465 7220 6f6e 2079 2061  parameter on y a
-00006140: 7869 7320 6f66 2033 7264 2073 7562 706c  xis of 3rd subpl
-00006150: 6f74 2028 626f 7474 6f6d 206c 6566 7429  ot (bottom left)
-00006160: 0a20 2020 2079 345f 7061 7261 6d3a 2073  .    y4_param: s
-00006170: 7472 0a20 2020 2020 2020 2070 6172 616d  tr.        param
-00006180: 6574 6572 206f 6e20 7920 6178 6973 206f  eter on y axis o
-00006190: 6620 3474 6820 7375 6270 6c6f 7420 2862  f 4th subplot (b
-000061a0: 6f74 746f 6d20 7269 6768 7429 0a20 2020  ottom right).   
-000061b0: 2066 696c 6c5f 6e61 3a20 696e 740a 2020   fill_na: int.  
-000061c0: 2020 2020 2020 5468 6520 696e 7465 6765        The intege
-000061d0: 7220 7661 6c75 6520 746f 2066 696c 6c20  r value to fill 
-000061e0: 4e61 6e73 2077 6974 6820 746f 2073 686f  Nans with to sho
-000061f0: 7720 7570 206f 6e20 706c 6f74 732e 0a0a  w up on plots...
-00006200: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-00006210: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2034  ----------.    4
-00006220: 2070 6172 7420 6669 6775 7265 0a0a 2020   part figure..  
-00006230: 2020 2222 220a 2020 2020 6669 745f 7061    """.    fit_pa
-00006240: 7261 6d73 5f6e 6f6e 613d 6669 745f 7061  rams_nona=fit_pa
-00006250: 7261 6d73 2e66 696c 6c6e 6128 6669 6c6c  rams.fillna(fill
-00006260: 5f6e 6129 0a0a 2020 2020 6669 672c 2028  _na)..    fig, (
-00006270: 2861 7831 2c20 6178 3229 2c20 2861 7833  (ax1, ax2), (ax3
-00006280: 2c20 6178 3429 2920 3d20 706c 742e 7375  , ax4)) = plt.su
-00006290: 6270 6c6f 7473 2832 2c20 322c 2066 6967  bplots(2, 2, fig
-000062a0: 7369 7a65 3d28 3130 2a30 2e38 2c38 2a30  size=(10*0.8,8*0
-000062b0: 2e38 2929 0a0a 0a20 2020 2061 7831 2e70  .8))...    ax1.p
-000062c0: 6c6f 7428 6669 745f 7061 7261 6d73 5f6e  lot(fit_params_n
-000062d0: 6f6e 615b 785f 7061 7261 6d5d 2c20 6669  ona[x_param], fi
-000062e0: 745f 7061 7261 6d73 5f6e 6f6e 615b 7931  t_params_nona[y1
-000062f0: 5f70 6172 616d 5d2c 0a20 2020 2020 2020  _param],.       
-00006300: 2027 7872 2729 0a20 2020 2061 7831 2e73   'xr').    ax1.s
-00006310: 6574 5f78 6c61 6265 6c28 785f 7061 7261  et_xlabel(x_para
-00006320: 6d29 0a20 2020 2061 7831 2e73 6574 5f79  m).    ax1.set_y
-00006330: 6c61 6265 6c28 7931 5f70 6172 616d 290a  label(y1_param).
-00006340: 0a20 2020 2061 7832 2e70 6c6f 7428 6669  .    ax2.plot(fi
-00006350: 745f 7061 7261 6d73 5f6e 6f6e 615b 785f  t_params_nona[x_
-00006360: 7061 7261 6d5d 2c20 6669 745f 7061 7261  param], fit_para
-00006370: 6d73 5f6e 6f6e 615b 7932 5f70 6172 616d  ms_nona[y2_param
-00006380: 5d2c 0a20 2020 2020 2020 2027 7872 2729  ],.        'xr')
-00006390: 0a20 2020 2061 7832 2e73 6574 5f78 6c61  .    ax2.set_xla
-000063a0: 6265 6c28 785f 7061 7261 6d29 0a20 2020  bel(x_param).   
-000063b0: 2061 7832 2e73 6574 5f79 6c61 6265 6c28   ax2.set_ylabel(
-000063c0: 7932 5f70 6172 616d 290a 2020 2020 6669  y2_param).    fi
-000063d0: 672e 7469 6768 745f 6c61 796f 7574 2829  g.tight_layout()
-000063e0: 0a0a 2020 2020 6178 332e 706c 6f74 2866  ..    ax3.plot(f
-000063f0: 6974 5f70 6172 616d 735f 6e6f 6e61 5b78  it_params_nona[x
-00006400: 5f70 6172 616d 5d2c 2066 6974 5f70 6172  _param], fit_par
-00006410: 616d 735f 6e6f 6e61 5b79 335f 7061 7261  ams_nona[y3_para
-00006420: 6d5d 2c0a 2020 2020 2020 2020 2778 7227  m],.        'xr'
-00006430: 290a 2020 2020 6178 332e 7365 745f 786c  ).    ax3.set_xl
-00006440: 6162 656c 2878 5f70 6172 616d 290a 2020  abel(x_param).  
-00006450: 2020 6178 332e 7365 745f 796c 6162 656c    ax3.set_ylabel
-00006460: 2879 335f 7061 7261 6d29 0a0a 2020 2020  (y3_param)..    
-00006470: 6178 342e 706c 6f74 2866 6974 5f70 6172  ax4.plot(fit_par
-00006480: 616d 735f 6e6f 6e61 5b78 5f70 6172 616d  ams_nona[x_param
-00006490: 5d2c 2066 6974 5f70 6172 616d 735f 6e6f  ], fit_params_no
-000064a0: 6e61 5b79 345f 7061 7261 6d5d 2c0a 2020  na[y4_param],.  
-000064b0: 2020 2020 2020 2778 7227 290a 2020 2020        'xr').    
-000064c0: 6178 342e 7365 745f 786c 6162 656c 2878  ax4.set_xlabel(x
-000064d0: 5f70 6172 616d 290a 2020 2020 6178 342e  _param).    ax4.
-000064e0: 7365 745f 796c 6162 656c 2879 345f 7061  set_ylabel(y4_pa
-000064f0: 7261 6d29 0a20 2020 2066 6967 2e74 6967  ram).    fig.tig
-00006500: 6874 5f6c 6179 6f75 7428 290a 0a20 2020  ht_layout()..   
-00006510: 2072 6574 7572 6e20 6669 670a 0a0a 6465   return fig...de
-00006520: 6620 6669 6c74 6572 5f73 706c 6974 7469  f filter_splitti
-00006530: 6e67 5f70 726f 6d69 6e65 6e63 6528 2a2c  ng_prominence(*,
-00006540: 2066 6974 5f70 6172 616d 732c 2064 6174   fit_params, dat
-00006550: 615f 795f 616c 6c2c 0a20 2020 2020 2020  a_y_all,.       
-00006560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006570: 2020 2020 2020 2020 2078 5f63 6f72 642c           x_cord,
-00006580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000065a0: 2073 706c 6974 7469 6e67 5f6c 696d 6974   splitting_limit
-000065b0: 733d 5b31 3030 2c20 3130 375d 2c0a 2020  s=[100, 107],.  
-000065c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000065d0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-000065e0: 7765 725f 6469 6164 315f 7072 6f6d 3d31  wer_diad1_prom=1
-000065f0: 302c 2065 7863 6c75 6465 5f73 7472 293a  0, exclude_str):
-00006600: 0a20 2020 2022 2222 2046 696c 7465 7273  .    """ Filters
-00006610: 2053 7065 6374 7261 2062 6173 6564 206f   Spectra based o
-00006620: 6e20 6170 7072 6f78 696d 6174 6520 7370  n approximate sp
-00006630: 6c69 7474 696e 672c 2064 7261 7773 2061  litting, draws a
-00006640: 2070 6c6f 7420 7368 6f77 696e 6720 7370   plot showing sp
-00006650: 6563 7472 6120 746f 2064 6973 6361 7264  ectra to discard
-00006660: 2061 6e64 2074 686f 7365 2074 6f20 6b65   and those to ke
-00006670: 6570 0a0a 2020 2020 5061 7261 6d65 7465  ep..    Paramete
-00006680: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00006690: 2d2d 2d2d 2d0a 2020 2020 6669 745f 7061  -----.    fit_pa
-000066a0: 7261 6d73 3a20 7064 2e64 6174 6166 7261  rams: pd.datafra
-000066b0: 6d65 0a20 2020 2020 2020 2064 6174 6166  me.        dataf
-000066c0: 7261 6d65 206f 6620 6669 7420 7061 7261  rame of fit para
-000066d0: 6d65 7465 7273 2066 726f 6d20 6c6f 6f70  meters from loop
-000066e0: 5f61 7070 726f 785f 6469 6164 5f66 6974  _approx_diad_fit
-000066f0: 730a 0a20 2020 2064 6174 615f 795f 616c  s..    data_y_al
-00006700: 6c3a 206e 702e 6172 7261 790a 2020 2020  l: np.array.    
-00006710: 2020 2020 7920 636f 6f72 6469 6e61 7465      y coordinate
-00006720: 7320 6f66 2065 6163 6820 7370 6563 7472  s of each spectr
-00006730: 6120 6672 6f6d 206c 6f6f 705f 6170 7072  a from loop_appr
-00006740: 6f78 5f64 6961 645f 6669 7473 2c20 7573  ox_diad_fits, us
-00006750: 6564 2066 6f72 2070 6c6f 7474 696e 6720  ed for plotting 
-00006760: 7669 7375 616c 697a 6174 6f69 6e73 0a0a  visualizatoins..
-00006770: 2020 2020 785f 636f 7264 3a20 6e70 2e61      x_cord: np.a
-00006780: 7272 6179 0a20 2020 2020 2020 2078 2063  rray.        x c
-00006790: 6f6f 7264 696e 6174 6573 206f 6620 3120  oordinates of 1 
-000067a0: 7370 6563 7472 612e 2041 7373 756d 6573  spectra. Assumes
-000067b0: 2061 6c6c 2078 2063 6f6f 7264 696e 6174   all x coordinat
-000067c0: 6573 2074 6865 2073 616d 6520 6c65 6e67  es the same leng
-000067d0: 7468 0a0a 2020 2020 7370 6c69 7474 696e  th..    splittin
-000067e0: 675f 6c69 6d69 7473 3a20 6c69 7374 2028  g_limits: list (
-000067f0: 652e 672e 205b 3130 302c 2031 3037 5d29  e.g. [100, 107])
-00006800: 0a20 2020 2020 2020 206f 6e6c 7920 6b65  .        only ke
-00006810: 6570 7320 7370 6563 7472 6120 7769 7468  eps spectra with
-00006820: 2073 706c 6974 7469 6e67 2069 6e20 7468   splitting in th
-00006830: 6973 2072 616e 6765 0a0a 2020 2020 6c6f  is range..    lo
-00006840: 7765 725f 6469 6164 315f 7072 6f6d 3a20  wer_diad1_prom: 
-00006850: 696e 742c 2066 6c6f 6174 0a20 2020 2020  int, float.     
-00006860: 2020 204f 6e6c 7920 6b65 6570 7320 7370     Only keeps sp
-00006870: 6563 7472 6120 7468 6174 206d 6565 7420  ectra that meet 
-00006880: 7468 6520 7370 6c69 7474 696e 6720 7061  the splitting pa
-00006890: 7261 6d65 7465 722c 2061 6e64 2068 6176  rameter, and hav
-000068a0: 6520 616e 2061 6273 6f6c 7574 650a 2020  e an absolute.  
-000068b0: 2020 2020 2020 6469 6164 3120 7072 6f6d        diad1 prom
-000068c0: 696e 656e 6365 2067 7265 6174 6572 2074  inence greater t
-000068d0: 6861 6e20 7468 6973 2076 616c 7565 2028  han this value (
-000068e0: 6865 6c70 7320 6669 6c74 6572 206f 7574  helps filter out
-000068f0: 206f 7468 6572 2077 6569 7264 2073 7065   other weird spe
-00006900: 6374 7261 290a 0a20 2020 2052 6574 7572  ctra)..    Retur
-00006910: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  ns.    ---------
-00006920: 2d2d 2d2d 2d0a 2020 2020 6669 745f 7061  -----.    fit_pa
-00006930: 7261 6d73 5f66 696c 743a 2070 642e 4461  rams_filt: pd.Da
-00006940: 7461 4672 616d 650a 2020 2020 2020 2020  taFrame.        
-00006950: 6461 7461 6672 616d 6520 6f66 2066 6974  dataframe of fit
-00006960: 2070 6172 616d 6574 6572 7320 666f 7220   parameters for 
-00006970: 7370 6563 7472 6120 746f 206b 6565 700a  spectra to keep.
-00006980: 2020 2020 6461 7461 5f79 5f66 696c 743a      data_y_filt:
-00006990: 206e 702e 6172 7261 790a 2020 2020 2020   np.array.      
-000069a0: 2020 7920 636f 6f72 6469 6e61 7465 7320    y coordinates 
-000069b0: 6f66 2073 7065 6374 7261 2074 6f20 6b65  of spectra to ke
-000069c0: 6570 0a20 2020 2066 6974 5f70 6172 616d  ep.    fit_param
-000069d0: 735f 6469 7363 3a20 7064 2e44 6174 6146  s_disc: pd.DataF
-000069e0: 7261 6d65 0a20 2020 2020 2020 2064 6174  rame.        dat
-000069f0: 6166 7261 6d65 206f 6620 6669 7420 7061  aframe of fit pa
-00006a00: 7261 6d65 7465 7273 2066 6f72 2073 7065  rameters for spe
-00006a10: 6374 7261 2074 6f20 6469 7363 6172 640a  ctra to discard.
-00006a20: 2020 2020 6461 7461 5f79 5f64 6973 633a      data_y_disc:
-00006a30: 206e 702e 6172 7261 790a 2020 2020 2020   np.array.      
-00006a40: 2020 7920 636f 6f72 6469 6e61 7465 7320    y coordinates 
-00006a50: 6f66 2073 7065 6374 7261 2074 6f20 6469  of spectra to di
-00006a60: 7363 6172 640a 0a0a 2020 2020 2222 220a  scard...    """.
-00006a70: 0a20 2020 2072 6561 735f 7370 6c69 743d  .    reas_split=
-00006a80: 2866 6974 5f70 6172 616d 735b 2761 7070  (fit_params['app
-00006a90: 726f 785f 7370 6c69 7427 5d2e 6265 7477  rox_split'].betw
-00006aa0: 6565 6e28 7370 6c69 7474 696e 675f 6c69  een(splitting_li
-00006ab0: 6d69 7473 5b30 5d2c 2073 706c 6974 7469  mits[0], splitti
-00006ac0: 6e67 5f6c 696d 6974 735b 315d 2929 0a20  ng_limits[1])). 
-00006ad0: 2020 2072 6561 735f 6865 6967 683d 6669     reas_heigh=fi
-00006ae0: 745f 7061 7261 6d73 5b27 4469 6164 315f  t_params['Diad1_
-00006af0: 6162 735f 7072 6f6d 275d 3e6c 6f77 6572  abs_prom']>lower
-00006b00: 5f64 6961 6431 5f70 726f 6d0a 2020 2020  _diad1_prom.    
-00006b10: 6966 2065 7863 6c75 6465 5f73 7472 2069  if exclude_str i
-00006b20: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00006b30: 2020 2020 6e61 6d65 5f69 6e5f 6669 6c65      name_in_file
-00006b40: 3d7e 6669 745f 7061 7261 6d73 5b27 6669  =~fit_params['fi
-00006b50: 6c65 6e61 6d65 275d 2e73 7472 2e63 6f6e  lename'].str.con
-00006b60: 7461 696e 7328 6578 636c 7564 655f 7374  tains(exclude_st
-00006b70: 7229 0a20 2020 2065 6c73 653a 0a20 2020  r).    else:.   
-00006b80: 2020 2020 206e 616d 655f 696e 5f66 696c       name_in_fil
-00006b90: 653d 7265 6173 5f68 6569 6768 0a0a 2020  e=reas_heigh..  
-00006ba0: 2020 6669 745f 7061 7261 6d73 5f66 696c    fit_params_fil
-00006bb0: 743d 6669 745f 7061 7261 6d73 2e6c 6f63  t=fit_params.loc
-00006bc0: 5b28 7265 6173 5f73 706c 6974 2672 6561  [(reas_split&rea
-00006bd0: 735f 6865 6967 6826 6e61 6d65 5f69 6e5f  s_heigh&name_in_
-00006be0: 6669 6c65 295d 2e72 6573 6574 5f69 6e64  file)].reset_ind
-00006bf0: 6578 2864 726f 703d 5472 7565 290a 2020  ex(drop=True).  
-00006c00: 2020 6669 745f 7061 7261 6d73 5f64 6973    fit_params_dis
-00006c10: 633d 6669 745f 7061 7261 6d73 2e6c 6f63  c=fit_params.loc
-00006c20: 5b7e 2872 6561 735f 7370 6c69 7426 7265  [~(reas_split&re
-00006c30: 6173 5f68 6569 6768 266e 616d 655f 696e  as_heigh&name_in
-00006c40: 5f66 696c 6529 5d2e 7265 7365 745f 696e  _file)].reset_in
-00006c50: 6465 7828 6472 6f70 3d54 7275 6529 0a0a  dex(drop=True)..
-00006c60: 2020 2020 7072 696e 7428 274b 6565 7069      print('Keepi
-00006c70: 6e67 204e 3d27 2b73 7472 286c 656e 2866  ng N='+str(len(f
-00006c80: 6974 5f70 6172 616d 735f 6669 6c74 2929  it_params_filt))
-00006c90: 290a 2020 2020 7072 696e 7428 2744 6973  ).    print('Dis
-00006ca0: 6361 7264 696e 6720 4e3d 272b 7374 7228  carding N='+str(
-00006cb0: 6c65 6e28 6669 745f 7061 7261 6d73 5f64  len(fit_params_d
-00006cc0: 6973 6329 2929 0a0a 2020 2020 6669 6c74  isc)))..    filt
-00006cd0: 3d72 6561 735f 7370 6c69 7426 7265 6173  =reas_split&reas
-00006ce0: 5f68 6569 6768 266e 616d 655f 696e 5f66  _heigh&name_in_f
-00006cf0: 696c 650a 2020 2020 6461 7461 5f79 5f66  ile.    data_y_f
-00006d00: 696c 743d 6461 7461 5f79 5f61 6c6c 5b3a  ilt=data_y_all[:
-00006d10: 2c20 2866 696c 7429 5d0a 2020 2020 6461  , (filt)].    da
-00006d20: 7461 5f79 5f64 6973 633d 6461 7461 5f79  ta_y_disc=data_y
-00006d30: 5f61 6c6c 5b3a 2c20 7e28 6669 6c74 295d  _all[:, ~(filt)]
-00006d40: 0a0a 2020 2020 696e 7463 3d38 3030 0a20  ..    intc=800. 
-00006d50: 2020 2070 726f 6d5f 6669 6c74 3d30 0a20     prom_filt=0. 
-00006d60: 2020 2070 726f 6d5f 6469 7363 3d30 0a20     prom_disc=0. 
-00006d70: 2020 2066 6967 2c20 2861 7831 2c20 6178     fig, (ax1, ax
-00006d80: 3229 203d 2070 6c74 2e73 7562 706c 6f74  2) = plt.subplot
-00006d90: 7328 312c 2032 2c20 6669 6773 697a 653d  s(1, 2, figsize=
-00006da0: 2831 322c 3529 290a 2020 2020 6178 312e  (12,5)).    ax1.
-00006db0: 7365 745f 7469 746c 6528 2753 7065 6374  set_title('Spect
-00006dc0: 7261 2074 6f20 4469 7363 6172 6427 290a  ra to Discard').
-00006dd0: 2020 2020 6178 322e 7365 745f 7469 746c      ax2.set_titl
-00006de0: 6528 2753 7065 6374 7261 2074 6f20 4b65  e('Spectra to Ke
-00006df0: 6570 2729 0a20 2020 2069 6620 7375 6d28  ep').    if sum(
-00006e00: 7e66 696c 7429 3e30 3a0a 2020 2020 2020  ~filt)>0:.      
-00006e10: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-00006e20: 2830 2c20 6e70 2e73 6861 7065 2864 6174  (0, np.shape(dat
-00006e30: 615f 795f 6469 7363 295b 315d 293a 0a20  a_y_disc)[1]):. 
-00006e40: 2020 2020 2020 2020 2020 2061 765f 7072             av_pr
-00006e50: 6f6d 5f64 6973 633d 6e70 2e61 6273 286e  om_disc=np.abs(n
-00006e60: 702e 6e61 6e6d 6564 6961 6e28 6669 745f  p.nanmedian(fit_
-00006e70: 7061 7261 6d73 5f64 6973 635b 2744 6961  params_disc['Dia
-00006e80: 6431 5f61 6273 5f70 726f 6d27 5d29 2f69  d1_abs_prom'])/i
-00006e90: 6e74 6329 0a20 2020 2020 2020 2020 2020  ntc).           
-00006ea0: 2044 6966 663d 6e70 2e6e 616e 6d61 7828   Diff=np.nanmax(
-00006eb0: 6461 7461 5f79 5f64 6973 635b 3a2c 2069  data_y_disc[:, i
-00006ec0: 5d29 2d6e 702e 6e61 6e6d 696e 2864 6174  ])-np.nanmin(dat
-00006ed0: 615f 795f 6469 7363 5b3a 2c20 695d 290a  a_y_disc[:, i]).
-00006ee0: 2020 2020 2020 2020 2020 2020 6176 5f70              av_p
-00006ef0: 726f 6d5f 4b65 6570 3d66 6974 5f70 6172  rom_Keep=fit_par
-00006f00: 616d 735f 6469 7363 5b27 4469 6164 315f  ams_disc['Diad1_
-00006f10: 6162 735f 7072 6f6d 275d 2e69 6c6f 635b  abs_prom'].iloc[
-00006f20: 695d 0a20 2020 2020 2020 2020 2020 2070  i].            p
-00006f30: 726f 6d5f 6469 7363 3d70 726f 6d5f 6469  rom_disc=prom_di
-00006f40: 7363 2b61 765f 7072 6f6d 5f64 6973 630a  sc+av_prom_disc.
-00006f50: 2020 2020 2020 2020 2020 2020 6178 312e              ax1.
-00006f60: 706c 6f74 2878 5f63 6f72 642b 692a 352c  plot(x_cord+i*5,
-00006f70: 2028 6461 7461 5f79 5f64 6973 635b 3a2c   (data_y_disc[:,
-00006f80: 2069 5d2d 6e70 2e6e 616e 6d69 6e28 6461   i]-np.nanmin(da
-00006f90: 7461 5f79 5f64 6973 635b 3a2c 2069 5d29  ta_y_disc[:, i])
-00006fa0: 292f 4469 6666 2b69 2f33 2c20 272d 7227  )/Diff+i/3, '-r'
-00006fb0: 2c20 6c77 3d30 2e35 290a 2020 2020 2020  , lw=0.5).      
-00006fc0: 2020 2020 2020 7970 6c6f 743d 6e70 2e71        yplot=np.q
-00006fd0: 7561 6e74 696c 6528 2864 6174 615f 795f  uantile((data_y_
-00006fe0: 6469 7363 5b3a 2c20 695d 2d6e 702e 6e61  disc[:, i]-np.na
-00006ff0: 6e6d 696e 2864 6174 615f 795f 6469 7363  nmin(data_y_disc
-00007000: 5b3a 2c20 695d 2929 2f44 6966 662b 692f  [:, i]))/Diff+i/
-00007010: 332c 2030 2e36 3529 0a20 2020 2020 2020  3, 0.65).       
-00007020: 2020 2020 2066 696c 653d 6669 745f 7061       file=fit_pa
-00007030: 7261 6d73 5f64 6973 635b 2766 696c 656e  rams_disc['filen
-00007040: 616d 6527 5d2e 696c 6f63 5b69 5d0a 2020  ame'].iloc[i].  
-00007050: 2020 2020 2020 2020 2020 6669 6c65 203d            file =
-00007060: 2066 696c 652e 7265 706c 6163 6528 225f   file.replace("_
-00007070: 4352 525f 4469 6164 4669 7422 2c20 2222  CRR_DiadFit", ""
-00007080: 290a 2020 2020 2020 2020 2020 2020 6178  ).            ax
-00007090: 312e 616e 6e6f 7461 7465 2873 7472 2866  1.annotate(str(f
-000070a0: 696c 6529 2c20 7879 3d28 3134 3530 2b69  ile), xy=(1450+i
-000070b0: 2a35 2c20 7970 6c6f 7429 2c0a 2020 2020  *5, yplot),.    
-000070c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000070d0: 7879 636f 6f72 6473 3d22 6461 7461 222c  xycoords="data",
-000070e0: 2066 6f6e 7473 697a 653d 382c 2062 626f   fontsize=8, bbo
-000070f0: 783d 6469 6374 2866 6163 6563 6f6c 6f72  x=dict(facecolor
-00007100: 3d27 7768 6974 6527 2c20 6564 6765 636f  ='white', edgeco
-00007110: 6c6f 723d 276e 6f6e 6527 2c20 7061 643d  lor='none', pad=
-00007120: 3229 290a 0a20 2020 2020 2020 2061 7831  2))..        ax1
-00007130: 2e73 6574 5f78 6c69 6d28 5b31 3235 302c  .set_xlim([1250,
-00007140: 2031 3530 302b 692a 355d 290a 2020 2020   1500+i*5]).    
-00007150: 2020 2020 6178 312e 7365 745f 7874 6963      ax1.set_xtic
-00007160: 6b73 285b 5d29 0a20 2020 2020 2020 2061  ks([]).        a
-00007170: 7831 2e73 6574 5f79 7469 636b 7328 5b5d  x1.set_yticks([]
-00007180: 290a 2020 2020 6966 2073 756d 2866 696c  ).    if sum(fil
-00007190: 7429 3e30 3a0a 2020 2020 2020 2020 666f  t)>0:.        fo
-000071a0: 7220 6920 696e 2072 616e 6765 2830 2c20  r i in range(0, 
-000071b0: 6e70 2e73 6861 7065 2864 6174 615f 795f  np.shape(data_y_
-000071c0: 6669 6c74 295b 315d 293a 0a20 2020 2020  filt)[1]):.     
-000071d0: 2020 2020 2020 2044 6966 663d 6e70 2e6e         Diff=np.n
-000071e0: 616e 6d61 7828 6461 7461 5f79 5f66 696c  anmax(data_y_fil
-000071f0: 745b 3a2c 2069 5d29 2d6e 702e 6e61 6e6d  t[:, i])-np.nanm
-00007200: 696e 2864 6174 615f 795f 6669 6c74 5b3a  in(data_y_filt[:
-00007210: 2c20 695d 290a 2020 2020 2020 2020 2020  , i]).          
-00007220: 2020 6176 5f70 726f 6d5f 4b65 6570 3d66    av_prom_Keep=f
-00007230: 6974 5f70 6172 616d 735f 6669 6c74 5b27  it_params_filt['
-00007240: 4469 6164 315f 6162 735f 7072 6f6d 275d  Diad1_abs_prom']
-00007250: 2e69 6c6f 635b 695d 0a20 2020 2020 2020  .iloc[i].       
-00007260: 2020 2020 2070 726f 6d5f 6669 6c74 3d70       prom_filt=p
-00007270: 726f 6d5f 6669 6c74 2b61 765f 7072 6f6d  rom_filt+av_prom
-00007280: 5f4b 6565 700a 2020 2020 2020 2020 2020  _Keep.          
-00007290: 2020 6178 322e 706c 6f74 2878 5f63 6f72    ax2.plot(x_cor
-000072a0: 642b 692a 352c 2028 6461 7461 5f79 5f66  d+i*5, (data_y_f
-000072b0: 696c 745b 3a2c 2069 5d2d 6e70 2e6e 616e  ilt[:, i]-np.nan
-000072c0: 6d69 6e28 6461 7461 5f79 5f66 696c 745b  min(data_y_filt[
-000072d0: 3a2c 2069 5d29 292f 4469 6666 2b69 2f33  :, i]))/Diff+i/3
-000072e0: 2c20 272d 6227 2c20 6c77 3d30 2e35 290a  , '-b', lw=0.5).
-000072f0: 0a0a 2020 2020 2020 2020 6178 322e 7365  ..        ax2.se
-00007300: 745f 786c 696d 285b 3132 3530 2c20 3134  t_xlim([1250, 14
-00007310: 3530 2b69 2a35 5d29 0a20 2020 2020 2020  50+i*5]).       
-00007320: 2061 7832 2e73 6574 5f78 7469 636b 7328   ax2.set_xticks(
-00007330: 5b5d 290a 2020 2020 2020 2020 6178 322e  []).        ax2.
-00007340: 7365 745f 7974 6963 6b73 285b 5d29 0a0a  set_yticks([])..
-00007350: 2020 2020 7265 7475 726e 2066 6974 5f70      return fit_p
-00007360: 6172 616d 735f 6669 6c74 2c20 6461 7461  arams_filt, data
-00007370: 5f79 5f66 696c 742c 2066 6974 5f70 6172  _y_filt, fit_par
-00007380: 616d 735f 6469 7363 2c20 6461 7461 5f79  ams_disc, data_y
-00007390: 5f64 6973 630a 0a0a 6465 6620 6964 656e  _disc...def iden
-000073a0: 7469 6679 5f64 6961 645f 6772 6f75 7028  tify_diad_group(
-000073b0: 2a2c 2066 6974 5f70 6172 616d 732c 2064  *, fit_params, d
-000073c0: 6174 615f 792c 2020 785f 636f 7264 2c20  ata_y,  x_cord, 
-000073d0: 6669 6c74 6572 5f62 6f6f 6c2c 795f 6669  filter_bool,y_fi
-000073e0: 675f 7363 616c 653d 302e 312c 2067 7270  g_scale=0.1, grp
-000073f0: 5f66 696c 7465 723d 2757 6561 6b27 293a  _filter='Weak'):
-00007400: 0a0a 2020 2020 2222 2253 6f72 7473 2064  ..    """Sorts d
-00007410: 6961 6473 2069 6e74 6f20 7477 6f20 6772  iads into two gr
-00007420: 6f75 7073 2e20 5468 6f73 6520 6d65 6574  oups. Those meet
-00007430: 696e 6720 7468 6520 2766 696c 7465 725f  ing the 'filter_
-00007440: 626f 6f6c 2720 6372 6974 6572 6961 2c20  bool' criteria, 
-00007450: 616e 6420 7468 6f73 6520 6e6f 740a 2020  and those not.  
-00007460: 2020 206d 6565 7469 6e67 2074 6869 7320     meeting this 
-00007470: 6372 6974 6572 6961 2e20 4f6e 6573 206d  criteria. Ones m
-00007480: 6565 7469 6e67 2074 6865 2063 7269 7465  eeting the crite
-00007490: 7269 6120 6172 6520 7368 6f77 6e20 6f6e  ria are shown on
-000074a0: 2074 6865 206c 6566 7420 6861 6e64 2070   the left hand p
-000074b0: 6c6f 742c 0a20 2020 206f 6e65 7320 6e6f  lot,.    ones no
-000074c0: 7420 6d65 6574 696e 6720 7468 6520 6372  t meeting the cr
-000074d0: 6974 6572 6961 2061 7265 2073 686f 776e  iteria are shown
-000074e0: 2069 6e20 7468 6520 7269 6768 7420 6861   in the right ha
-000074f0: 6e64 2070 6c6f 740a 0a20 2020 2050 6172  nd plot..    Par
-00007500: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-00007510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
-00007520: 2020 6669 745f 7061 7261 6d73 3a20 7064    fit_params: pd
-00007530: 2e44 6174 6146 7261 6d65 0a20 2020 2020  .DataFrame.     
-00007540: 2020 2064 6174 6166 7261 6d65 206f 6620     dataframe of 
-00007550: 6170 7072 6f78 696d 6174 6520 7065 616b  approximate peak
-00007560: 2070 6172 616d 6574 6572 7320 6672 6f6d   parameters from
-00007570: 206c 6f6f 705f 6170 7072 6f78 5f64 6961   loop_approx_dia
-00007580: 645f 6669 7473 0a0a 2020 2020 6461 7461  d_fits..    data
-00007590: 5f79 3a20 6e70 2e61 7272 6179 0a20 2020  _y: np.array.   
-000075a0: 2020 2020 2079 2063 6f6f 7264 696e 6174       y coordinat
-000075b0: 6573 206f 6620 6561 6368 2066 696c 6520  es of each file 
-000075c0: 696e 2066 6974 5f70 6172 616d 730a 0a20  in fit_params.. 
-000075d0: 2020 2078 5f63 6f72 643a 206e 702e 6172     x_cord: np.ar
-000075e0: 7261 790a 2020 2020 2020 2020 7820 636f  ray.        x co
-000075f0: 6f72 6469 6e61 7465 206f 6620 3120 7370  ordinate of 1 sp
-00007600: 6563 7472 612e 2041 7373 756d 6573 2061  ectra. Assumes a
-00007610: 6c6c 2073 7065 6374 7261 2068 6176 6520  ll spectra have 
-00007620: 7468 6520 7361 6d65 2078 636f 6f72 6469  the same xcoordi
-00007630: 6e61 7465 0a0a 2020 2020 6669 6c74 6572  nate..    filter
-00007640: 5f62 6f6f 6c3a 2050 616e 6461 732e 7365  _bool: Pandas.se
-00007650: 7269 6573 206f 6620 626f 6f6c 2028 652e  ries of bool (e.
-00007660: 672e 2054 7275 652c 2046 616c 7365 2c20  g. True, False, 
-00007670: 5472 7565 2c20 4661 6c73 6529 0a20 2020  True, False).   
-00007680: 2020 2020 2054 6869 7320 6973 2074 6865       This is the
-00007690: 2066 696c 7465 7220 746f 2075 7365 2074   filter to use t
-000076a0: 6f20 7375 6264 6976 6964 6520 7370 6563  o subdivide spec
-000076b0: 7472 6120 696e 746f 2074 776f 2067 726f  tra into two gro
-000076c0: 7570 732e 0a0a 2020 2020 795f 6669 675f  ups...    y_fig_
-000076d0: 7363 616c 653a 2066 6c6f 6174 2c20 696e  scale: float, in
-000076e0: 7420 2830 2e31 290a 2020 2020 2020 2020  t (0.1).        
-000076f0: 4465 7465 726d 696e 7320 686f 7720 6661  Determins how fa
-00007700: 7220 6170 6172 7420 7468 6520 7370 6563  r apart the spec
-00007710: 7472 6120 6172 6520 6469 7370 6c61 7965  tra are displaye
-00007720: 6420 6f6e 2074 6865 2070 6c6f 742e 204c  d on the plot. L
-00007730: 6172 6765 7220 6e75 6d62 6572 2c20 7468  arger number, th
-00007740: 6520 6c6f 6e67 6572 2074 6865 2070 6c6f  e longer the plo
-00007750: 7420 6973 0a20 2020 2020 2020 2028 616e  t is.        (an
-00007760: 6420 6561 7369 6572 2073 7065 6374 7261  d easier spectra
-00007770: 2061 7265 2074 6f20 7365 6529 2e20 5468   are to see). Th
-00007780: 6520 746f 7461 6c20 6865 6967 6874 206f  e total height o
-00007790: 6620 7468 6520 6669 6775 7265 2069 7320  f the figure is 
-000077a0: 322b 795f 6669 675f 7363 616c 652a 6e75  2+y_fig_scale*nu
-000077b0: 6d62 6572 206f 6620 7370 6563 7472 610a  mber of spectra.
-000077c0: 0a20 2020 2067 7270 5f66 696c 7465 723a  .    grp_filter:
-000077d0: 2073 7472 0a20 2020 2020 2020 2054 6865   str.        The
-000077e0: 206e 616d 6520 6f66 2074 6865 2067 726f   name of the gro
-000077f0: 7570 2077 6865 7265 2074 6865 2066 696c  up where the fil
-00007800: 7465 725f 626f 6f6c 2069 7320 7472 7565  ter_bool is true
-00007810: 2e20 452e 672e 2069 6620 796f 7520 6170  . E.g. if you ap
-00007820: 706c 7920 6120 6669 6c74 6572 2074 6f20  ply a filter to 
-00007830: 6765 7420 7468 6520 7765 616b 2064 6961  get the weak dia
-00007840: 6473 2c0a 2020 2020 2020 2020 656e 7465  ds,.        ente
-00007850: 7220 2757 6561 6b27 2068 6572 652e 2049  r 'Weak' here. I
-00007860: 6620 6669 6c74 6572 5f62 6f6f 6c20 6973  f filter_bool is
-00007870: 2074 6f20 6964 656e 7469 6679 2053 7472   to identify Str
-00007880: 6f6e 6720 7370 6563 7472 612c 2065 6e74  ong spectra, ent
-00007890: 6572 2027 4d65 6469 756d 2d53 7472 6f6e  er 'Medium-Stron
-000078a0: 6727 2068 6572 652e 0a0a 2020 2020 5265  g' here...    Re
-000078b0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-000078c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
-000078d0: 7064 2e44 6174 6146 7261 6d65 206f 6620  pd.DataFrame of 
-000078e0: 6669 7420 7061 7261 6d65 7465 7273 2077  fit parameters w
-000078f0: 6865 7265 2066 696c 7465 725f 626f 6f6c  here filter_bool
-00007900: 2069 7320 5472 7565 0a20 2020 2070 642e   is True.    pd.
-00007910: 4461 7461 4672 616d 6520 6f66 2066 6974  DataFrame of fit
-00007920: 2070 6172 616d 6574 6572 7320 7768 6572   parameters wher
-00007930: 6520 6669 6c74 6572 5f62 6f6f 6c20 6973  e filter_bool is
-00007940: 2046 616c 7365 0a20 2020 206e 702e 6172   False.    np.ar
-00007950: 7261 7920 6f66 2079 2063 6f6f 7264 696e  ray of y coordin
-00007960: 6174 6573 2077 6865 7265 2066 696c 7465  ates where filte
-00007970: 725f 626f 6f6c 2069 7320 5472 7565 0a20  r_bool is True. 
-00007980: 2020 206e 702e 6172 7261 7920 6f66 2079     np.array of y
-00007990: 2063 6f6f 7264 696e 6174 6573 2077 6865   coordinates whe
-000079a0: 7265 2066 696c 7465 725f 626f 6f6c 2069  re filter_bool i
-000079b0: 7320 4661 6c73 650a 0a0a 0a0a 2020 2020  s False.....    
-000079c0: 2222 220a 0a20 2020 2069 6620 6e70 2e73  """..    if np.s
-000079d0: 6861 7065 2864 6174 615f 7929 5b31 5d3d  hape(data_y)[1]=
-000079e0: 3d30 3a0a 2020 2020 2020 2020 4772 6f75  =0:.        Grou
-000079f0: 7031 5f64 663d 7064 2e44 6174 6146 7261  p1_df=pd.DataFra
-00007a00: 6d65 2829 2e72 6569 6e64 6578 5f6c 696b  me().reindex_lik
-00007a10: 6528 6669 745f 7061 7261 6d73 290a 2020  e(fit_params).  
-00007a20: 2020 2020 2020 4772 6f75 706e 6f74 315f        Groupnot1_
-00007a30: 6466 3d70 642e 4461 7461 4672 616d 6528  df=pd.DataFrame(
-00007a40: 292e 7265 696e 6465 785f 6c69 6b65 2866  ).reindex_like(f
-00007a50: 6974 5f70 6172 616d 7329 0a20 2020 2020  it_params).     
-00007a60: 2020 2047 726f 7570 315f 6e70 5f79 3d6e     Group1_np_y=n
-00007a70: 702e 656d 7074 7928 302c 2064 7479 7065  p.empty(0, dtype
-00007a80: 3d27 666c 6f61 7427 290a 2020 2020 2020  ='float').      
-00007a90: 2020 4772 6f75 706e 6f74 315f 6e70 5f79    Groupnot1_np_y
-00007aa0: 3d6e 702e 656d 7074 7928 302c 2064 7479  =np.empty(0, dty
-00007ab0: 7065 3d27 666c 6f61 7427 290a 2020 2020  pe='float').    
-00007ac0: 2020 2020 7265 7475 726e 2047 726f 7570      return Group
-00007ad0: 315f 6466 2c20 4772 6f75 706e 6f74 315f  1_df, Groupnot1_
-00007ae0: 6466 2c20 4772 6f75 7031 5f6e 705f 792c  df, Group1_np_y,
-00007af0: 2047 726f 7570 6e6f 7431 5f6e 705f 790a   Groupnot1_np_y.
-00007b00: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00007b10: 2020 2023 2047 7270 3120 6973 2077 6865     # Grp1 is whe
-00007b20: 7265 2074 6865 2062 6f6f 6c20 6973 2074  re the bool is t
-00007b30: 7275 652e 0a0a 2020 2020 2020 2020 6772  rue...        gr
-00007b40: 7031 3d66 696c 7465 725f 626f 6f6c 0a0a  p1=filter_bool..
-00007b50: 2020 2020 2020 2020 6669 745f 7061 7261          fit_para
-00007b60: 6d73 5f6e 6f74 6772 7031 3d66 6974 5f70  ms_notgrp1=fit_p
-00007b70: 6172 616d 732e 6c6f 635b 7e67 7270 315d  arams.loc[~grp1]
-00007b80: 0a0a 0a20 2020 2020 2020 2023 2046 696e  ...        # Fin
-00007b90: 6420 6f6e 6573 2069 6e20 6772 6f75 7031  d ones in group1
-00007ba0: 2c20 696e 2064 6174 6166 7261 6d65 2061  , in dataframe a
-00007bb0: 6e64 206e 756d 7079 2066 6f72 6d0a 2020  nd numpy form.  
-00007bc0: 2020 2020 2020 4772 6f75 7031 5f64 663d        Group1_df=
-00007bd0: 6669 745f 7061 7261 6d73 2e6c 6f63 5b67  fit_params.loc[g
-00007be0: 7270 315d 232e 7265 7365 745f 696e 6465  rp1]#.reset_inde
-00007bf0: 7828 6472 6f70 3d54 7275 6529 0a20 2020  x(drop=True).   
-00007c00: 2020 2020 2047 726f 7570 315f 6466 5f72       Group1_df_r
-00007c10: 6573 6574 3d66 6974 5f70 6172 616d 732e  eset=fit_params.
-00007c20: 6c6f 635b 6772 7031 5d2e 7265 7365 745f  loc[grp1].reset_
-00007c30: 696e 6465 7828 6472 6f70 3d54 7275 6529  index(drop=True)
-00007c40: 0a20 2020 2020 2020 2069 6e64 6578 5f47  .        index_G
-00007c50: 7270 313d 4772 6f75 7031 5f64 662e 696e  rp1=Group1_df.in
-00007c60: 6465 780a 2020 2020 2020 2020 4772 6f75  dex.        Grou
-00007c70: 7031 5f6e 705f 793d 6461 7461 5f79 5b3a  p1_np_y=data_y[:
-00007c80: 2c20 696e 6465 785f 4772 7031 5d0a 0a20  , index_Grp1].. 
-00007c90: 2020 2020 2020 2023 204f 6e65 7320 6e6f         # Ones no
-00007ca0: 7420 696e 2067 726f 7570 310a 2020 2020  t in group1.    
-00007cb0: 2020 2020 4772 6f75 706e 6f74 315f 6466      Groupnot1_df
-00007cc0: 3d66 6974 5f70 6172 616d 732e 6c6f 635b  =fit_params.loc[
-00007cd0: 7e67 7270 315d 232e 7265 7365 745f 696e  ~grp1]#.reset_in
-00007ce0: 6465 7828 6472 6f70 3d54 7275 6529 0a20  dex(drop=True). 
-00007cf0: 2020 2020 2020 2047 726f 7570 6e6f 7431         Groupnot1
-00007d00: 5f64 665f 7265 7365 743d 6669 745f 7061  _df_reset=fit_pa
-00007d10: 7261 6d73 2e6c 6f63 5b7e 6772 7031 5d2e  rams.loc[~grp1].
-00007d20: 7265 7365 745f 696e 6465 7828 6472 6f70  reset_index(drop
-00007d30: 3d54 7275 6529 0a20 2020 2020 2020 2069  =True).        i
-00007d40: 6e64 6578 5f47 7270 6e6f 7431 3d47 726f  ndex_Grpnot1=Gro
-00007d50: 7570 6e6f 7431 5f64 662e 696e 6465 780a  upnot1_df.index.
-00007d60: 2020 2020 2020 2020 4772 6f75 706e 6f74          Groupnot
-00007d70: 315f 6e70 5f79 3d64 6174 615f 795b 3a2c  1_np_y=data_y[:,
-00007d80: 2069 6e64 6578 5f47 7270 6e6f 7431 5d0a   index_Grpnot1].
-00007d90: 0a0a 2020 2020 2020 2020 6669 672c 2028  ..        fig, (
-00007da0: 6178 302c 2061 7831 2920 3d20 706c 742e  ax0, ax1) = plt.
-00007db0: 7375 6270 6c6f 7473 2831 2c20 322c 2066  subplots(1, 2, f
-00007dc0: 6967 7369 7a65 3d28 3132 2c20 322b 795f  igsize=(12, 2+y_
-00007dd0: 6669 675f 7363 616c 652a 6c65 6e28 6669  fig_scale*len(fi
-00007de0: 745f 7061 7261 6d73 2929 290a 2020 2020  t_params))).    
-00007df0: 2020 2020 696e 7463 3d38 0a0a 0a20 2020      intc=8...   
-00007e00: 2020 2020 2023 0a20 2020 2020 2020 2069       #.        i
-00007e10: 6620 7375 6d28 6772 7031 293e 303a 0a0a  f sum(grp1)>0:..
-00007e20: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00007e30: 2073 756d 2867 7270 3129 3d3d 313a 0a20   sum(grp1)==1:. 
-00007e40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00007e50: 3d30 0a20 2020 2020 2020 2020 2020 2020  =0.             
-00007e60: 2020 2061 765f 7072 6f6d 5f64 6973 633d     av_prom_disc=
-00007e70: 6e70 2e61 6273 286e 702e 6e61 6e6d 6564  np.abs(np.nanmed
-00007e80: 6961 6e28 4772 6f75 7031 5f64 665b 2744  ian(Group1_df['D
-00007e90: 6961 6431 5f61 6273 5f70 726f 6d27 5d29  iad1_abs_prom'])
-00007ea0: 2f69 6e74 6329 0a20 2020 2020 2020 2020  /intc).         
-00007eb0: 2020 2020 2020 2044 6966 663d 6e70 2e6e         Diff=np.n
-00007ec0: 616e 6d61 7828 4772 6f75 7031 5f6e 705f  anmax(Group1_np_
-00007ed0: 795b 3a2c 2069 5d29 2d6e 702e 6e61 6e6d  y[:, i])-np.nanm
-00007ee0: 696e 2847 726f 7570 315f 6e70 5f79 5b3a  in(Group1_np_y[:
-00007ef0: 2c20 695d 290a 2020 2020 2020 2020 2020  , i]).          
-00007f00: 2020 2020 2020 6178 302e 706c 6f74 2878        ax0.plot(x
-00007f10: 5f63 6f72 642d 692a 352c 2028 4772 6f75  _cord-i*5, (Grou
-00007f20: 7031 5f6e 705f 795b 3a2c 2069 5d2d 6e70  p1_np_y[:, i]-np
-00007f30: 2e6e 616e 6d69 6e28 4772 6f75 7031 5f6e  .nanmin(Group1_n
-00007f40: 705f 795b 3a2c 2069 5d29 292f 4469 6666  p_y[:, i]))/Diff
-00007f50: 2b69 2f33 2c20 272d 7227 2c20 6c77 3d30  +i/3, '-r', lw=0
-00007f60: 2e35 290a 2020 2020 2020 2020 2020 2020  .5).            
-00007f70: 2020 2020 7970 6c6f 743d 6e70 2e71 7561      yplot=np.qua
-00007f80: 6e74 696c 6528 2847 726f 7570 315f 6e70  ntile((Group1_np
-00007f90: 5f79 5b3a 2c20 695d 2d6e 702e 6e61 6e6d  _y[:, i]-np.nanm
-00007fa0: 696e 2847 726f 7570 315f 6e70 5f79 5b3a  in(Group1_np_y[:
-00007fb0: 2c20 695d 2929 2f44 6966 662b 692f 332c  , i]))/Diff+i/3,
-00007fc0: 2030 2e36 3529 0a20 2020 2020 2020 2020   0.65).         
-00007fd0: 2020 2020 2020 2066 696c 653d 4772 6f75         file=Grou
-00007fe0: 7031 5f64 665f 7265 7365 745b 2766 696c  p1_df_reset['fil
-00007ff0: 656e 616d 6527 5d2e 696c 6f63 5b69 5d0a  ename'].iloc[i].
-00008000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008010: 6669 6c65 203d 2066 696c 652e 7265 706c  file = file.repl
-00008020: 6163 6528 225f 4352 525f 4469 6164 4669  ace("_CRR_DiadFi
-00008030: 7422 2c20 2222 290a 2020 2020 2020 2020  t", "").        
-00008040: 2020 2020 2020 2020 6178 302e 616e 6e6f          ax0.anno
-00008050: 7461 7465 2873 7472 2866 696c 6529 2c20  tate(str(file), 
-00008060: 7879 3d28 3134 3530 2d69 2a35 2c20 7970  xy=(1450-i*5, yp
-00008070: 6c6f 7429 2c0a 2020 2020 2020 2020 2020  lot),.          
-00008080: 2020 2020 2020 2020 2020 7879 636f 6f72            xycoor
-00008090: 6473 3d22 6461 7461 222c 2066 6f6e 7473  ds="data", fonts
-000080a0: 697a 653d 382c 2062 626f 783d 6469 6374  ize=8, bbox=dict
-000080b0: 2866 6163 6563 6f6c 6f72 3d27 7768 6974  (facecolor='whit
-000080c0: 6527 2c20 6564 6765 636f 6c6f 723d 276e  e', edgecolor='n
-000080d0: 6f6e 6527 2c20 7061 643d 3229 290a 0a0a  one', pad=2))...
-000080e0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000080f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008100: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-00008110: 2830 2c20 6e70 2e73 6861 7065 2847 726f  (0, np.shape(Gro
-00008120: 7570 315f 6e70 5f79 295b 315d 293a 0a0a  up1_np_y)[1]):..
-00008130: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008140: 2020 2020 2020 6176 5f70 726f 6d5f 6469        av_prom_di
-00008150: 7363 3d6e 702e 6162 7328 6e70 2e6e 616e  sc=np.abs(np.nan
-00008160: 6d65 6469 616e 2847 726f 7570 315f 6466  median(Group1_df
-00008170: 5b27 4469 6164 315f 6162 735f 7072 6f6d  ['Diad1_abs_prom
-00008180: 275d 292f 696e 7463 290a 2020 2020 2020  '])/intc).      
-00008190: 2020 2020 2020 2020 2020 2020 2020 4469                Di
-000081a0: 6666 3d6e 702e 6e61 6e6d 6178 2847 726f  ff=np.nanmax(Gro
-000081b0: 7570 315f 6e70 5f79 5b3a 2c20 695d 292d  up1_np_y[:, i])-
-000081c0: 6e70 2e6e 616e 6d69 6e28 4772 6f75 7031  np.nanmin(Group1
-000081d0: 5f6e 705f 795b 3a2c 2069 5d29 0a20 2020  _np_y[:, i]).   
-000081e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000081f0: 2061 7830 2e70 6c6f 7428 785f 636f 7264   ax0.plot(x_cord
-00008200: 2d69 2a35 2c20 2847 726f 7570 315f 6e70  -i*5, (Group1_np
-00008210: 5f79 5b3a 2c20 695d 2d6e 702e 6e61 6e6d  _y[:, i]-np.nanm
-00008220: 696e 2847 726f 7570 315f 6e70 5f79 5b3a  in(Group1_np_y[:
-00008230: 2c20 695d 2929 2f44 6966 662b 692f 332c  , i]))/Diff+i/3,
-00008240: 2027 2d72 272c 206c 773d 302e 3529 0a0a   '-r', lw=0.5)..
-00008250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008260: 2020 2020 7970 6c6f 743d 6e70 2e71 7561      yplot=np.qua
-00008270: 6e74 696c 6528 2847 726f 7570 315f 6e70  ntile((Group1_np
-00008280: 5f79 5b3a 2c20 695d 2d6e 702e 6e61 6e6d  _y[:, i]-np.nanm
-00008290: 696e 2847 726f 7570 315f 6e70 5f79 5b3a  in(Group1_np_y[:
-000082a0: 2c20 695d 2929 2f44 6966 662b 692f 332c  , i]))/Diff+i/3,
-000082b0: 2030 2e35 290a 2020 2020 2020 2020 2020   0.5).          
-000082c0: 2020 2020 2020 2020 2020 6669 6c65 3d47            file=G
-000082d0: 726f 7570 315f 6466 5f72 6573 6574 5b27  roup1_df_reset['
-000082e0: 6669 6c65 6e61 6d65 275d 2e69 6c6f 635b  filename'].iloc[
-000082f0: 695d 0a20 2020 2020 2020 2020 2020 2020  i].             
-00008300: 2020 2020 2020 2066 696c 6520 3d20 6669         file = fi
-00008310: 6c65 2e72 6570 6c61 6365 2822 5f43 5252  le.replace("_CRR
-00008320: 5f44 6961 6446 6974 222c 2022 2229 0a20  _DiadFit", ""). 
-00008330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008340: 2020 2061 7830 2e61 6e6e 6f74 6174 6528     ax0.annotate(
-00008350: 7374 7228 6669 6c65 292c 2078 793d 2831  str(file), xy=(1
-00008360: 3435 302d 692a 352c 2079 706c 6f74 292c  450-i*5, yplot),
-00008370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008380: 2020 2020 2020 2020 2078 7963 6f6f 7264           xycoord
-00008390: 733d 2264 6174 6122 2c20 666f 6e74 7369  s="data", fontsi
-000083a0: 7a65 3d38 2c20 6262 6f78 3d64 6963 7428  ze=8, bbox=dict(
-000083b0: 6661 6365 636f 6c6f 723d 2777 6869 7465  facecolor='white
-000083c0: 272c 2065 6467 6563 6f6c 6f72 3d27 6e6f  ', edgecolor='no
-000083d0: 6e65 272c 2070 6164 3d32 2929 0a20 2020  ne', pad=2)).   
-000083e0: 2020 2020 2020 2020 2061 7830 2e73 6574           ax0.set
-000083f0: 5f78 6c69 6d28 5b31 3235 302d 692a 352c  _xlim([1250-i*5,
-00008400: 2031 3535 305d 290a 2020 2020 2020 2020   1550]).        
-00008410: 2020 2020 6178 302e 7365 745f 7874 6963      ax0.set_xtic
-00008420: 6b73 285b 5d29 0a20 2020 2020 2020 2020  ks([]).         
-00008430: 2020 2061 7830 2e73 6574 5f79 7469 636b     ax0.set_ytick
-00008440: 7328 5b5d 290a 0a0a 0a20 2020 2020 2020  s([])....       
-00008450: 2020 2020 2023 2061 765f 7072 6f6d 5f47       # av_prom_G
-00008460: 726f 7570 313d 6e70 2e61 6273 286e 702e  roup1=np.abs(np.
-00008470: 6e61 6e6d 6564 6961 6e28 4772 6f75 7031  nanmedian(Group1
-00008480: 5f64 665b 785f 7061 7261 6d5d 292f 696e  _df[x_param])/in
-00008490: 7463 290a 2020 2020 2020 2020 2020 2020  tc).            
-000084a0: 2320 6178 302e 706c 6f74 2878 5f63 6f72  # ax0.plot(x_cor
-000084b0: 642c 2047 726f 7570 315f 6e70 5f79 5b3a  d, Group1_np_y[:
-000084c0: 2c20 695d 2b61 765f 7072 6f6d 5f47 726f  , i]+av_prom_Gro
-000084d0: 7570 312a 692c 2027 2d72 2729 0a0a 2020  up1*i, '-r')..  
-000084e0: 2020 2020 2020 6966 2073 756d 287e 6772        if sum(~gr
-000084f0: 7031 293e 303a 0a0a 0a20 2020 2020 2020  p1)>0:...       
-00008500: 2020 2020 2069 6620 7375 6d28 7e67 7270       if sum(~grp
-00008510: 3129 3d3d 313a 0a20 2020 2020 2020 2020  1)==1:.         
-00008520: 2020 2020 2020 206a 3d30 0a20 2020 2020         j=0.     
-00008530: 2020 2020 2020 2020 2020 2061 765f 7072             av_pr
-00008540: 6f6d 5f64 6973 633d 6e70 2e61 6273 286e  om_disc=np.abs(n
-00008550: 702e 6e61 6e6d 6564 6961 6e28 4772 6f75  p.nanmedian(Grou
-00008560: 706e 6f74 315f 6466 5b27 4469 6164 315f  pnot1_df['Diad1_
-00008570: 6162 735f 7072 6f6d 275d 292f 696e 7463  abs_prom'])/intc
-00008580: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00008590: 2020 4469 6666 3d6e 702e 6e61 6e6d 6178    Diff=np.nanmax
-000085a0: 2847 726f 7570 6e6f 7431 5f6e 705f 795b  (Groupnot1_np_y[
-000085b0: 3a2c 206a 5d29 2d6e 702e 6e61 6e6d 696e  :, j])-np.nanmin
-000085c0: 2847 726f 7570 6e6f 7431 5f6e 705f 795b  (Groupnot1_np_y[
-000085d0: 3a2c 206a 5d29 0a20 2020 2020 2020 2020  :, j]).         
-000085e0: 2020 2020 2020 2061 7831 2e70 6c6f 7428         ax1.plot(
-000085f0: 785f 636f 7264 2d6a 2a35 2c0a 2020 2020  x_cord-j*5,.    
-00008600: 2020 2020 2020 2020 2020 2020 2847 726f              (Gro
-00008610: 7570 6e6f 7431 5f6e 705f 795b 3a2c 206a  upnot1_np_y[:, j
-00008620: 5d2d 6e70 2e6e 616e 6d69 6e28 4772 6f75  ]-np.nanmin(Grou
-00008630: 706e 6f74 315f 6e70 5f79 5b3a 2c20 6a5d  pnot1_np_y[:, j]
-00008640: 2929 2f44 6966 662b 6a2f 332c 2027 2d6b  ))/Diff+j/3, '-k
-00008650: 272c 206c 773d 302e 3529 0a20 2020 2020  ', lw=0.5).     
-00008660: 2020 2020 2020 2020 2020 2079 706c 6f74             yplot
-00008670: 3d6e 702e 7175 616e 7469 6c65 2828 4772  =np.quantile((Gr
-00008680: 6f75 706e 6f74 315f 6e70 5f79 5b3a 2c20  oupnot1_np_y[:, 
-00008690: 6a5d 2d6e 702e 6e61 6e6d 696e 2847 726f  j]-np.nanmin(Gro
-000086a0: 7570 6e6f 7431 5f6e 705f 795b 3a2c 206a  upnot1_np_y[:, j
-000086b0: 5d29 292f 4469 6666 2b6a 2f33 2c20 302e  ]))/Diff+j/3, 0.
-000086c0: 3635 290a 2020 2020 2020 2020 2020 2020  65).            
-000086d0: 2020 2020 6669 6c65 3d47 726f 7570 6e6f      file=Groupno
-000086e0: 7431 5f64 665f 7265 7365 745b 2766 696c  t1_df_reset['fil
-000086f0: 656e 616d 6527 5d2e 696c 6f63 5b6a 5d0a  ename'].iloc[j].
-00008700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008710: 6669 6c65 203d 2066 696c 652e 7265 706c  file = file.repl
-00008720: 6163 6528 225f 4352 525f 4469 6164 4669  ace("_CRR_DiadFi
-00008730: 7422 2c20 2222 290a 2020 2020 2020 2020  t", "").        
-00008740: 2020 2020 2020 2020 6178 312e 616e 6e6f          ax1.anno
-00008750: 7461 7465 2873 7472 2866 696c 6529 2c20  tate(str(file), 
-00008760: 7879 3d28 3134 3530 2d6a 2a35 2c20 7970  xy=(1450-j*5, yp
-00008770: 6c6f 7429 2c0a 2020 2020 2020 2020 2020  lot),.          
-00008780: 2020 2020 2020 2020 2020 7879 636f 6f72            xycoor
-00008790: 6473 3d22 6461 7461 222c 2066 6f6e 7473  ds="data", fonts
-000087a0: 697a 653d 382c 2062 626f 783d 6469 6374  ize=8, bbox=dict
-000087b0: 2866 6163 6563 6f6c 6f72 3d27 7768 6974  (facecolor='whit
-000087c0: 6527 2c20 6564 6765 636f 6c6f 723d 276e  e', edgecolor='n
-000087d0: 6f6e 6527 2c20 7061 643d 3229 290a 0a0a  one', pad=2))...
-000087e0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000087f0: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
-00008800: 2020 2066 6f72 206a 2069 6e20 7261 6e67     for j in rang
-00008810: 6528 302c 206e 702e 7368 6170 6528 4772  e(0, np.shape(Gr
-00008820: 6f75 706e 6f74 315f 6e70 5f79 295b 315d  oupnot1_np_y)[1]
-00008830: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
-00008840: 2020 2020 2020 2020 6176 5f70 726f 6d5f          av_prom_
-00008850: 6469 7363 3d6e 702e 6162 7328 6e70 2e6e  disc=np.abs(np.n
-00008860: 616e 6d65 6469 616e 2847 726f 7570 6e6f  anmedian(Groupno
-00008870: 7431 5f64 665b 2744 6961 6431 5f61 6273  t1_df['Diad1_abs
-00008880: 5f70 726f 6d27 5d29 2f69 6e74 6329 0a20  _prom'])/intc). 
-00008890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000088a0: 2020 2044 6966 663d 6e70 2e6e 616e 6d61     Diff=np.nanma
-000088b0: 7828 4772 6f75 706e 6f74 315f 6e70 5f79  x(Groupnot1_np_y
-000088c0: 5b3a 2c20 6a5d 292d 6e70 2e6e 616e 6d69  [:, j])-np.nanmi
-000088d0: 6e28 4772 6f75 706e 6f74 315f 6e70 5f79  n(Groupnot1_np_y
-000088e0: 5b3a 2c20 6a5d 290a 2020 2020 2020 2020  [:, j]).        
-000088f0: 2020 2020 2020 2020 2020 2020 6178 312e              ax1.
-00008900: 706c 6f74 2878 5f63 6f72 642d 6a2a 352c  plot(x_cord-j*5,
-00008910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008920: 2020 2020 2028 4772 6f75 706e 6f74 315f       (Groupnot1_
-00008930: 6e70 5f79 5b3a 2c20 6a5d 2d6e 702e 6e61  np_y[:, j]-np.na
-00008940: 6e6d 696e 2847 726f 7570 6e6f 7431 5f6e  nmin(Groupnot1_n
-00008950: 705f 795b 3a2c 206a 5d29 292f 4469 6666  p_y[:, j]))/Diff
-00008960: 2b6a 2f33 2c20 272d 6b27 2c20 6c77 3d30  +j/3, '-k', lw=0
-00008970: 2e35 290a 2020 2020 2020 2020 2020 2020  .5).            
-00008980: 2020 2020 2020 2020 7970 6c6f 743d 6e70          yplot=np
-00008990: 2e71 7561 6e74 696c 6528 2847 726f 7570  .quantile((Group
-000089a0: 6e6f 7431 5f6e 705f 795b 3a2c 206a 5d2d  not1_np_y[:, j]-
-000089b0: 6e70 2e6e 616e 6d69 6e28 4772 6f75 706e  np.nanmin(Groupn
-000089c0: 6f74 315f 6e70 5f79 5b3a 2c20 6a5d 2929  ot1_np_y[:, j]))
-000089d0: 2f44 6966 662b 6a2f 332c 2030 2e35 290a  /Diff+j/3, 0.5).
-000089e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000089f0: 2020 2020 6669 6c65 3d47 726f 7570 6e6f      file=Groupno
-00008a00: 7431 5f64 665f 7265 7365 745b 2766 696c  t1_df_reset['fil
-00008a10: 656e 616d 6527 5d2e 696c 6f63 5b6a 5d0a  ename'].iloc[j].
-00008a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a30: 2020 2020 6669 6c65 203d 2066 696c 652e      file = file.
-00008a40: 7265 706c 6163 6528 225f 4352 525f 4469  replace("_CRR_Di
-00008a50: 6164 4669 7422 2c20 2222 290a 2020 2020  adFit", "").    
-00008a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a70: 6178 312e 616e 6e6f 7461 7465 2873 7472  ax1.annotate(str
-00008a80: 2866 696c 6529 2c20 7879 3d28 3134 3530  (file), xy=(1450
-00008a90: 2d6a 2a35 2c20 7970 6c6f 7429 2c0a 2020  -j*5, yplot),.  
-00008aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ab0: 2020 2020 2020 7879 636f 6f72 6473 3d22        xycoords="
-00008ac0: 6461 7461 222c 2066 6f6e 7473 697a 653d  data", fontsize=
-00008ad0: 382c 2062 626f 783d 6469 6374 2866 6163  8, bbox=dict(fac
-00008ae0: 6563 6f6c 6f72 3d27 7768 6974 6527 2c20  ecolor='white', 
-00008af0: 6564 6765 636f 6c6f 723d 276e 6f6e 6527  edgecolor='none'
-00008b00: 2c20 7061 643d 3229 290a 0a20 2020 2020  , pad=2))..     
-00008b10: 2020 2020 2020 2061 7831 2e73 6574 5f78         ax1.set_x
-00008b20: 6c69 6d28 5b31 3235 302d 6a2a 352c 2031  lim([1250-j*5, 1
-00008b30: 3535 305d 290a 2020 2020 2020 2020 2020  550]).          
-00008b40: 2020 6178 312e 7365 745f 7874 6963 6b73    ax1.set_xticks
-00008b50: 285b 5d29 0a20 2020 2020 2020 2020 2020  ([]).           
-00008b60: 2061 7831 2e73 6574 5f79 7469 636b 7328   ax1.set_yticks(
-00008b70: 5b5d 290a 0a0a 0a20 2020 2020 2020 2069  [])....        i
-00008b80: 6620 6772 705f 6669 6c74 6572 3d3d 274d  f grp_filter=='M
-00008b90: 6564 6975 6d2d 5374 726f 6e67 273a 0a20  edium-Strong':. 
-00008ba0: 2020 2020 2020 2020 2020 2061 7830 2e73             ax0.s
-00008bb0: 6574 5f74 6974 6c65 2827 436c 6173 7369  et_title('Classi
-00008bc0: 6669 6564 2061 7320 5374 726f 6e67 2729  fied as Strong')
-00008bd0: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
-00008be0: 2e73 6574 5f74 6974 6c65 2827 436c 6173  .set_title('Clas
-00008bf0: 7369 6669 6564 2061 7320 4d65 6469 756d  sified as Medium
-00008c00: 2729 0a20 2020 2020 2020 2069 6620 6772  ').        if gr
-00008c10: 705f 6669 6c74 6572 3d3d 2757 6561 6b27  p_filter=='Weak'
-00008c20: 3a0a 2020 2020 2020 2020 2020 2020 6178  :.            ax
-00008c30: 302e 7365 745f 7469 746c 6528 2743 6c61  0.set_title('Cla
-00008c40: 7373 6966 6965 6420 6173 2057 6561 6b27  ssified as Weak'
-00008c50: 290a 2020 2020 2020 2020 2020 2020 6178  ).            ax
-00008c60: 312e 7365 745f 7469 746c 6528 274f 6e65  1.set_title('One
-00008c70: 7320 6c65 6674 2028 6e6f 7420 636c 6173  s left (not clas
-00008c80: 7369 6669 6564 2079 6574 2927 290a 0a0a  sified yet)')...
-00008c90: 2020 2020 2020 2020 706c 742e 7375 6270          plt.subp
-00008ca0: 6c6f 7473 5f61 646a 7573 7428 7773 7061  lots_adjust(wspa
-00008cb0: 6365 3d30 290a 0a20 2020 2020 2020 2072  ce=0)..        r
-00008cc0: 6574 7572 6e20 4772 6f75 7031 5f64 662e  eturn Group1_df.
-00008cd0: 7265 7365 745f 696e 6465 7828 6472 6f70  reset_index(drop
-00008ce0: 3d54 7275 6529 2c20 4772 6f75 706e 6f74  =True), Groupnot
-00008cf0: 315f 6466 2e72 6573 6574 5f69 6e64 6578  1_df.reset_index
-00008d00: 2864 726f 703d 5472 7565 292c 4772 6f75  (drop=True),Grou
-00008d10: 7031 5f6e 705f 792c 2047 726f 7570 6e6f  p1_np_y, Groupno
-00008d20: 7431 5f6e 705f 790a 0a0a 0a64 6566 2070  t1_np_y....def p
-00008d30: 6c6f 745f 6469 6164 5f67 726f 7570 7328  lot_diad_groups(
-00008d40: 2a2c 2078 5f63 6f72 642c 2020 5765 616b  *, x_cord,  Weak
-00008d50: 5f6e 703d 4e6f 6e65 2c20 4d65 6469 756d  _np=None, Medium
-00008d60: 5f6e 703d 4e6f 6e65 2c20 5374 726f 6e67  _np=None, Strong
-00008d70: 5f6e 703d 4e6f 6e65 2c20 795f 6669 675f  _np=None, y_fig_
-00008d80: 7363 616c 653d 302e 3529 3a0a 2020 2020  scale=0.5):.    
-00008d90: 2222 220a 2020 2020 5468 6973 206d 616b  """.    This mak
-00008da0: 6573 2061 2066 6967 7572 6520 7368 6f77  es a figure show
-00008db0: 696e 6720 7370 6563 7472 6120 636c 6173  ing spectra clas
-00008dc0: 7369 6669 6564 2069 6e74 6f20 5765 616b  sified into Weak
-00008dd0: 2c20 4d65 6469 756d 2061 6e64 2053 7472  , Medium and Str
-00008de0: 6f6e 6720 6772 6f75 7073 206f 6e20 6120  ong groups on a 
-00008df0: 3320 7061 6e65 6c20 706c 6f74 0a0a 2020  3 panel plot..  
-00008e00: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00008e10: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a   --------------.
-00008e20: 2020 2020 785f 636f 7264 3a20 6e70 2e61      x_cord: np.a
-00008e30: 7272 6179 0a20 2020 2020 2020 2078 5f63  rray.        x_c
-00008e40: 6f6f 7264 696e 6174 6520 666f 7220 616c  oordinate for al
-00008e50: 6c20 7370 6563 7472 6120 286d 7573 7420  l spectra (must 
-00008e60: 6265 2074 6865 2073 616d 6529 0a0a 2020  be the same)..  
-00008e70: 2020 5765 616b 5f6e 703a 206e 702e 6172    Weak_np: np.ar
-00008e80: 7261 790a 2020 2020 2020 2020 7920 636f  ray.        y co
-00008e90: 6f72 6469 6e61 7465 7320 6f66 2073 7065  ordinates of spe
-00008ea0: 6374 7261 2063 6c61 7373 6966 6965 6420  ctra classified 
-00008eb0: 6173 2077 6561 6b0a 0a20 2020 204d 6564  as weak..    Med
-00008ec0: 6975 6d5f 6e70 3a20 6e70 2e61 7272 6179  ium_np: np.array
-00008ed0: 0a20 2020 2020 2020 2079 2063 6f6f 7264  .        y coord
-00008ee0: 696e 6174 6573 206f 6620 7370 6563 7472  inates of spectr
-00008ef0: 6120 636c 6173 7369 6669 6564 2061 7320  a classified as 
-00008f00: 6d65 6469 756d 0a0a 2020 2020 5374 726f  medium..    Stro
-00008f10: 6e67 5f6e 703a 206e 702e 6172 7261 790a  ng_np: np.array.
-00008f20: 2020 2020 2020 2020 7920 636f 6f72 6469          y coordi
-00008f30: 6e61 7465 7320 6f66 2073 7065 6374 7261  nates of spectra
-00008f40: 2063 6c61 7373 6966 6965 6420 6173 2073   classified as s
-00008f50: 7472 6f6e 670a 0a20 2020 2079 5f66 6967  trong..    y_fig
-00008f60: 5f73 6361 6c65 3a20 666c 6f61 740a 2020  _scale: float.  
-00008f70: 2020 2020 2020 5468 6520 746f 7461 6c20        The total 
-00008f80: 6865 6967 6874 206f 6620 7468 6520 6669  height of the fi
-00008f90: 6775 7265 2069 7320 322b 795f 6669 675f  gure is 2+y_fig_
-00008fa0: 7363 616c 652a 746f 7461 6c20 6e75 6d62  scale*total numb
-00008fb0: 6572 206f 6620 7370 6563 7472 6120 656e  er of spectra en
-00008fc0: 7465 7265 642e 0a0a 0a20 2020 2052 6574  tered....    Ret
-00008fd0: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
-00008fe0: 2d2d 2d2d 2d2d 0a20 2020 2066 6967 7572  ------.    figur
-00008ff0: 6520 7368 6f77 696e 6720 3320 6469 6164  e showing 3 diad
-00009000: 2067 726f 7570 732e 0a0a 0a0a 0a20 2020   groups......   
-00009010: 2022 2222 0a0a 0a20 2020 2023 0a20 2020   """...    #.   
-00009020: 2069 6620 6c65 6e28 5765 616b 5f6e 7029   if len(Weak_np)
-00009030: 3e30 3a0a 2020 2020 2020 2020 4e75 6d5f  >0:.        Num_
-00009040: 5765 616b 3d6e 702e 7368 6170 6528 5765  Weak=np.shape(We
-00009050: 616b 5f6e 7029 5b31 5d0a 2020 2020 656c  ak_np)[1].    el
-00009060: 7365 3a0a 2020 2020 2020 2020 4e75 6d5f  se:.        Num_
-00009070: 5765 616b 3d30 0a20 2020 2069 6620 6c65  Weak=0.    if le
-00009080: 6e28 4d65 6469 756d 5f6e 7029 3e30 3a0a  n(Medium_np)>0:.
-00009090: 2020 2020 2020 2020 4e75 6d5f 4d65 6469          Num_Medi
-000090a0: 756d 3d6e 702e 7368 6170 6528 4d65 6469  um=np.shape(Medi
-000090b0: 756d 5f6e 7029 5b31 5d0a 2020 2020 656c  um_np)[1].    el
-000090c0: 7365 3a0a 2020 2020 2020 2020 4e75 6d5f  se:.        Num_
-000090d0: 4d65 6469 756d 3d30 0a20 2020 2069 6620  Medium=0.    if 
-000090e0: 6c65 6e28 5374 726f 6e67 5f6e 7029 3e30  len(Strong_np)>0
-000090f0: 3a0a 2020 2020 2020 2020 4e75 6d5f 5374  :.        Num_St
-00009100: 726f 6e67 3d6e 702e 7368 6170 6528 5374  rong=np.shape(St
-00009110: 726f 6e67 5f6e 7029 5b31 5d0a 2020 2020  rong_np)[1].    
-00009120: 656c 7365 3a0a 2020 2020 2020 2020 4e75  else:.        Nu
-00009130: 6d5f 5374 726f 6e67 3d30 0a0a 0a20 2020  m_Strong=0...   
-00009140: 2054 6f74 616c 3d4e 756d 5f53 7472 6f6e   Total=Num_Stron
-00009150: 672b 4e75 6d5f 4d65 6469 756d 2b4e 756d  g+Num_Medium+Num
-00009160: 5f57 6561 6b0a 2020 2020 6669 672c 2028  _Weak.    fig, (
-00009170: 6178 302c 2061 7831 2c20 6178 3229 203d  ax0, ax1, ax2) =
-00009180: 2070 6c74 2e73 7562 706c 6f74 7328 312c   plt.subplots(1,
-00009190: 2033 2c20 6669 6773 697a 653d 2831 352c   3, figsize=(15,
-000091a0: 322b 795f 6669 675f 7363 616c 652a 546f  2+y_fig_scale*To
-000091b0: 7461 6c29 290a 2020 2020 6966 204e 756d  tal)).    if Num
-000091c0: 5f57 6561 6b3e 303a 0a20 2020 2020 2020  _Weak>0:.       
-000091d0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-000091e0: 302c 206e 702e 7368 6170 6528 5765 616b  0, np.shape(Weak
-000091f0: 5f6e 7029 5b31 5d29 3a0a 2020 2020 2020  _np)[1]):.      
-00009200: 2020 2020 2020 4469 6666 3d6e 702e 6e61        Diff=np.na
-00009210: 6e6d 6178 2857 6561 6b5f 6e70 5b3a 2c20  nmax(Weak_np[:, 
-00009220: 695d 292d 6e70 2e6e 616e 6d69 6e28 5765  i])-np.nanmin(We
-00009230: 616b 5f6e 705b 3a2c 2069 5d29 0a20 2020  ak_np[:, i]).   
-00009240: 2020 2020 2020 2020 2061 7830 2e70 6c6f           ax0.plo
-00009250: 7428 785f 636f 7264 2d69 2a35 2c20 2857  t(x_cord-i*5, (W
-00009260: 6561 6b5f 6e70 5b3a 2c20 695d 2d6e 702e  eak_np[:, i]-np.
-00009270: 6e61 6e6d 696e 2857 6561 6b5f 6e70 5b3a  nanmin(Weak_np[:
-00009280: 2c20 695d 2929 2f44 6966 662b 692f 332c  , i]))/Diff+i/3,
-00009290: 2027 2d72 272c 206c 773d 302e 3529 0a20   '-r', lw=0.5). 
-000092a0: 2020 2020 2020 2061 7830 2e73 6574 5f78         ax0.set_x
-000092b0: 6c69 6d28 5b31 3235 302d 692a 352c 2031  lim([1250-i*5, 1
-000092c0: 3435 305d 290a 2020 2020 2020 2020 6178  450]).        ax
-000092d0: 302e 7365 745f 7874 6963 6b73 285b 5d29  0.set_xticks([])
-000092e0: 0a20 2020 2020 2020 2061 7830 2e73 6574  .        ax0.set
-000092f0: 5f79 7469 636b 7328 5b5d 290a 0a20 2020  _yticks([])..   
-00009300: 2069 6620 4e75 6d5f 4d65 6469 756d 3e30   if Num_Medium>0
-00009310: 3a0a 2020 2020 2020 2020 666f 7220 6920  :.        for i 
-00009320: 696e 2072 616e 6765 2830 2c20 6e70 2e73  in range(0, np.s
-00009330: 6861 7065 284d 6564 6975 6d5f 6e70 295b  hape(Medium_np)[
-00009340: 315d 293a 0a20 2020 2020 2020 2020 2020  1]):.           
-00009350: 2044 6966 663d 6e70 2e6e 616e 6d61 7828   Diff=np.nanmax(
-00009360: 4d65 6469 756d 5f6e 705b 3a2c 2069 5d29  Medium_np[:, i])
-00009370: 2d6e 702e 6e61 6e6d 696e 284d 6564 6975  -np.nanmin(Mediu
-00009380: 6d5f 6e70 5b3a 2c20 695d 290a 2020 2020  m_np[:, i]).    
-00009390: 2020 2020 2020 2020 6178 312e 706c 6f74          ax1.plot
-000093a0: 2878 5f63 6f72 642d 692a 352c 2028 4d65  (x_cord-i*5, (Me
-000093b0: 6469 756d 5f6e 705b 3a2c 2069 5d2d 6e70  dium_np[:, i]-np
-000093c0: 2e6e 616e 6d69 6e28 4d65 6469 756d 5f6e  .nanmin(Medium_n
-000093d0: 705b 3a2c 2069 5d29 292f 4469 6666 2b69  p[:, i]))/Diff+i
-000093e0: 2f33 2c20 272d 6227 2c20 6c77 3d30 2e35  /3, '-b', lw=0.5
-000093f0: 290a 2020 2020 2020 2020 6178 312e 7365  ).        ax1.se
-00009400: 745f 786c 696d 285b 3132 3530 2d69 2a35  t_xlim([1250-i*5
-00009410: 2c20 3134 3530 5d29 0a20 2020 2020 2020  , 1450]).       
-00009420: 2061 7831 2e73 6574 5f78 7469 636b 7328   ax1.set_xticks(
-00009430: 5b5d 290a 2020 2020 2020 2020 6178 312e  []).        ax1.
-00009440: 7365 745f 7974 6963 6b73 285b 5d29 0a0a  set_yticks([])..
-00009450: 2020 2020 6966 204e 756d 5f53 7472 6f6e      if Num_Stron
-00009460: 673e 303a 0a20 2020 2020 2020 2066 6f72  g>0:.        for
-00009470: 2069 2069 6e20 7261 6e67 6528 302c 206e   i in range(0, n
-00009480: 702e 7368 6170 6528 5374 726f 6e67 5f6e  p.shape(Strong_n
-00009490: 7029 5b31 5d29 3a0a 2020 2020 2020 2020  p)[1]):.        
-000094a0: 2020 2020 4469 6666 3d6e 702e 6e61 6e6d      Diff=np.nanm
-000094b0: 6178 2853 7472 6f6e 675f 6e70 5b3a 2c20  ax(Strong_np[:, 
-000094c0: 695d 292d 6e70 2e6e 616e 6d69 6e28 5374  i])-np.nanmin(St
-000094d0: 726f 6e67 5f6e 705b 3a2c 2069 5d29 0a20  rong_np[:, i]). 
-000094e0: 2020 2020 2020 2020 2020 2061 7832 2e70             ax2.p
-000094f0: 6c6f 7428 785f 636f 7264 2d69 2a35 2c20  lot(x_cord-i*5, 
-00009500: 2853 7472 6f6e 675f 6e70 5b3a 2c20 695d  (Strong_np[:, i]
-00009510: 2d6e 702e 6e61 6e6d 696e 2853 7472 6f6e  -np.nanmin(Stron
-00009520: 675f 6e70 5b3a 2c20 695d 2929 2f44 6966  g_np[:, i]))/Dif
-00009530: 662b 692f 332c 2027 2d67 272c 206c 773d  f+i/3, '-g', lw=
-00009540: 302e 3529 0a20 2020 2020 2020 2061 7832  0.5).        ax2
-00009550: 2e73 6574 5f78 6c69 6d28 5b31 3235 302d  .set_xlim([1250-
-00009560: 692a 352c 2031 3435 305d 290a 2020 2020  i*5, 1450]).    
-00009570: 2020 2020 6178 322e 7365 745f 7874 6963      ax2.set_xtic
-00009580: 6b73 285b 5d29 0a20 2020 2020 2020 2061  ks([]).        a
-00009590: 7832 2e73 6574 5f79 7469 636b 7328 5b5d  x2.set_yticks([]
-000095a0: 290a 0a20 2020 2061 7830 2e73 6574 5f74  )..    ax0.set_t
-000095b0: 6974 6c65 2827 5765 616b 2c20 4e3d 272b  itle('Weak, N='+
-000095c0: 7374 7228 4e75 6d5f 5765 616b 2929 0a20  str(Num_Weak)). 
-000095d0: 2020 2061 7831 2e73 6574 5f74 6974 6c65     ax1.set_title
-000095e0: 2827 4d65 6469 756d 2c20 4e3d 272b 7374  ('Medium, N='+st
-000095f0: 7228 4e75 6d5f 4d65 6469 756d 2929 0a20  r(Num_Medium)). 
-00009600: 2020 2061 7832 2e73 6574 5f74 6974 6c65     ax2.set_title
-00009610: 2827 5374 726f 6e67 2c20 4e3d 272b 7374  ('Strong, N='+st
-00009620: 7228 4e75 6d5f 5374 726f 6e67 2929 0a20  r(Num_Strong)). 
-00009630: 2020 2070 6c74 2e73 7562 706c 6f74 735f     plt.subplots_
-00009640: 6164 6a75 7374 2877 7370 6163 653d 3029  adjust(wspace=0)
-00009650: 0a0a 2020 2020 7265 7475 726e 2066 6967  ..    return fig
-00009660: 0a0a 0a64 6566 2072 656d 6f76 655f 6469  ...def remove_di
-00009670: 6164 5f62 6173 656c 696e 6528 2a2c 2070  ad_baseline(*, p
-00009680: 6174 683d 4e6f 6e65 2c20 6669 6c65 6e61  ath=None, filena
-00009690: 6d65 3d4e 6f6e 652c 2044 6961 645f 6669  me=None, Diad_fi
-000096a0: 6c65 733d 4e6f 6e65 2c20 6669 6c65 7479  les=None, filety
-000096b0: 7065 3d27 5769 7465 635f 4153 4349 4927  pe='Witec_ASCII'
-000096c0: 2c20 6469 6164 5f61 7272 6179 3d4e 6f6e  , diad_array=Non
-000096d0: 652c 0a20 2020 2020 2020 2020 2020 2065  e,.            e
-000096e0: 7863 6c75 6465 5f72 616e 6765 313d 4e6f  xclude_range1=No
-000096f0: 6e65 2c20 6578 636c 7564 655f 7261 6e67  ne, exclude_rang
-00009700: 6532 3d4e 6f6e 652c 4e5f 706f 6c79 3d31  e2=None,N_poly=1
-00009710: 2c20 785f 7261 6e67 655f 6261 7365 6c69  , x_range_baseli
-00009720: 6e65 3d31 302c 0a20 2020 2020 2020 2020  ne=10,.         
-00009730: 2020 206c 6f77 6572 5f62 636b 3d5b 3132     lower_bck=[12
-00009740: 3030 2c20 3132 3530 5d2c 2075 7070 6572  00, 1250], upper
-00009750: 5f62 636b 3d5b 3133 3230 2c20 3133 3330  _bck=[1320, 1330
-00009760: 5d2c 2073 6967 6d61 3d34 2c0a 2020 2020  ], sigma=4,.    
-00009770: 2020 2020 2020 2020 706c 6f74 5f66 6967          plot_fig
-00009780: 7572 653d 5472 7565 293a 0a20 2020 2022  ure=True):.    "
-00009790: 2222 2054 6869 7320 6675 6e63 7469 6f6e  "" This function
-000097a0: 2066 6974 7320 616e 204e 7468 2064 6567   fits an Nth deg
-000097b0: 7265 6520 706f 6c79 6e6f 6d69 616c 2066  ree polynomial f
-000097c0: 6974 7465 6420 7468 726f 7567 6820 7370  itted through sp
-000097d0: 6563 7472 6120 706f 696e 7473 2062 6574  ectra points bet
-000097e0: 7765 656e 2074 776f 2062 6163 6b67 726f  ween two backgro
-000097f0: 756e 6420 706f 7369 7469 6f6e 732e 2049  und positions. I
-00009800: 7420 7265 7475 726e 7320 6261 7365 6c69  t returns baseli
-00009810: 6e65 2d73 7562 7472 6163 7465 6420 6461  ne-subtracted da
-00009820: 7461 0a0a 2020 2020 5061 7261 6d65 7465  ta..    Paramete
-00009830: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00009840: 2d2d 0a20 2020 2070 6174 683a 2073 7472  --.    path: str
-00009850: 0a20 2020 2020 2020 2046 6f6c 6465 7220  .        Folder 
-00009860: 7768 6572 6520 7370 6563 7472 6120 6973  where spectra is
-00009870: 2073 746f 7265 640a 0a20 2020 2066 696c   stored..    fil
-00009880: 656e 616d 653a 2073 7472 0a20 2020 2020  ename: str.     
-00009890: 2020 2053 7065 6369 6669 6320 6669 6c65     Specific file
-000098a0: 2062 6569 6e67 2072 6561 640a 0a20 2020   being read..   
-000098b0: 204f 520a 0a20 2020 2044 6961 645f 6669   OR..    Diad_fi
-000098c0: 6c65 733a 2073 7472 0a20 2020 2020 2020  les: str.       
-000098d0: 2046 696c 656e 616d 6520 6966 2069 6e20   Filename if in 
-000098e0: 7361 6d65 2066 6f6c 6465 7220 6173 2073  same folder as s
-000098f0: 6372 6970 742e 0a0a 2020 2020 6669 6c65  cript...    file
-00009900: 7479 7065 3a20 7374 720a 2020 2020 2020  type: str.      
-00009910: 2020 4964 656e 7469 6669 6573 2074 7970    Identifies typ
-00009920: 6520 6f66 2066 696c 652e 2063 686f 6f73  e of file. choos
-00009930: 6520 6672 6f6d 2027 5769 7465 635f 4153  e from 'Witec_AS
-00009940: 4349 4927 2c20 2768 6561 646c 6573 735f  CII', 'headless_
-00009950: 7478 7427 2c20 2768 6561 646c 6573 735f  txt', 'headless_
-00009960: 6373 7627 2c20 2768 6561 645f 6373 7627  csv', 'head_csv'
-00009970: 2c20 2757 6974 6563 5f41 5343 4949 272c  , 'Witec_ASCII',
-00009980: 0a20 2020 2020 2020 2027 484f 5249 4241  .        'HORIBA
-00009990: 5f74 7874 272c 2027 5265 6e69 7368 6177  _txt', 'Renishaw
-000099a0: 5f74 7874 270a 0a20 2020 2065 7863 6c75  _txt'..    exclu
-000099b0: 6465 5f72 616e 6765 313a 204e 6f6e 6520  de_range1: None 
-000099c0: 6f72 206c 6973 7420 6c65 6e67 7468 2032  or list length 2
-000099d0: 0a20 2020 2020 2020 2045 7863 6c75 6465  .        Exclude
-000099e0: 7320 6120 7265 6769 6f6e 2c20 652e 672e  s a region, e.g.
-000099f0: 2061 2063 6f73 6d69 6320 7261 790a 0a20   a cosmic ray.. 
-00009a00: 2020 2065 7863 6c75 6465 5f72 616e 6765     exclude_range
-00009a10: 323a 204e 6f6e 6520 6f72 206c 6973 7420  2: None or list 
-00009a20: 6c65 6e67 7468 2032 0a20 2020 2020 2020  length 2.       
-00009a30: 2045 7863 6c75 6465 7320 6120 7265 6769   Excludes a regi
-00009a40: 6f6e 2c20 652e 672e 2061 2063 6f73 6d69  on, e.g. a cosmi
-00009a50: 6320 7261 790a 0a20 2020 2073 6967 6d61  c ray..    sigma
-00009a60: 3a20 696e 740a 2020 2020 2020 2020 4669  : int.        Fi
-00009a70: 6c74 6572 7320 6f75 7420 706f 696e 7473  lters out points
-00009a80: 2074 6861 7420 6172 6520 6d6f 7265 2074   that are more t
-00009a90: 6861 6e20 7468 6973 206e 756d 6265 7220  han this number 
-00009aa0: 6f66 2073 6967 6d61 2066 726f 6d20 7468  of sigma from th
-00009ab0: 6520 6d65 6469 616e 206f 6620 7468 6520  e median of the 
-00009ac0: 6261 7365 6c69 6e65 2e0a 0a20 2020 204e  baseline...    N
-00009ad0: 5f70 6f6c 793a 2069 6e74 0a20 2020 2020  _poly: int.     
-00009ae0: 2020 2044 6567 7265 6520 6f66 2070 6f6c     Degree of pol
-00009af0: 796e 6f6d 6961 6c20 746f 2066 6974 2074  ynomial to fit t
-00009b00: 6f20 7468 6520 6261 636b 6772 6f75 6e0a  o the backgroun.
-00009b10: 0a20 2020 206c 6f77 6572 5f62 636b 3a20  .    lower_bck: 
-00009b20: 6c69 7374 206c 656e 2032 0a20 2020 2020  list len 2.     
-00009b30: 2020 2077 6176 656e 756d 6265 7273 206f     wavenumbers o
-00009b40: 6620 6261 7365 6c69 6e65 2072 6567 696f  f baseline regio
-00009b50: 6e20 746f 2074 6865 206c 6566 7420 6f66  n to the left of
-00009b60: 2074 6865 2070 6561 6b20 6f66 2069 6e74   the peak of int
-00009b70: 6572 6573 740a 0a20 2020 2075 7070 6572  erest..    upper
-00009b80: 5f62 636b 3a20 6c69 7374 206c 656e 2032  _bck: list len 2
-00009b90: 0a20 2020 2020 2020 2077 6176 656e 756d  .        wavenum
-00009ba0: 6265 7273 2074 6f20 7468 6520 7269 6768  bers to the righ
-00009bb0: 7420 6f66 2074 6865 2070 6561 6b20 6f66  t of the peak of
-00009bc0: 2069 6e74 6572 6573 740a 0a0a 2020 2020   interest...    
-00009bd0: 706c 6f74 5f66 6967 7572 653a 2062 6f6f  plot_figure: boo
-00009be0: 6c0a 2020 2020 2020 2020 6966 2054 7275  l.        if Tru
-00009bf0: 652c 2070 6c6f 7473 2066 6967 7572 652c  e, plots figure,
-00009c00: 2069 6620 4661 6c73 652c 2064 6f65 736e   if False, doesn
-00009c10: 2774 2e0a 0a20 2020 2052 6574 7572 6e73  't...    Returns
-00009c20: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d  .    -----------
-00009c30: 0a20 2020 2079 5f63 6f72 722c 2050 795f  .    y_corr, Py_
-00009c40: 6261 7365 2c20 782c 2020 4469 6164 5f73  base, x,  Diad_s
-00009c50: 686f 7274 2c20 5079 5f62 6173 652c 2050  hort, Py_base, P
-00009c60: 665f 6261 7365 6c69 6e65 2c20 4261 7365  f_baseline, Base
-00009c70: 6c69 6e65 5f79 7375 622c 2042 6173 656c  line_ysub, Basel
-00009c80: 696e 655f 782c 2042 6173 656c 696e 652c  ine_x, Baseline,
-00009c90: 2073 7061 6e0a 0a20 2020 2020 2020 2079   span..        y
-00009ca0: 5f63 6f72 723a 2042 6163 6b67 726f 756e  _corr: Backgroun
-00009cb0: 6420 7375 6274 7261 6374 6564 2079 2076  d subtracted y v
-00009cc0: 616c 7565 7320 7472 696d 6d65 6420 696e  alues trimmed in
-00009cd0: 2062 6173 656c 696e 6520 7261 6e67 650a   baseline range.
-00009ce0: 2020 2020 2020 2020 783a 2069 6e69 7469          x: initi
-00009cf0: 616c 2078 2076 616c 7565 7320 7472 696d  al x values trim
-00009d00: 6d65 6420 696e 2062 6173 656c 696e 6520  med in baseline 
-00009d10: 7261 6e67 650a 2020 2020 2020 2020 4469  range.        Di
-00009d20: 6164 5f73 686f 7274 3a20 496e 6974 6961  ad_short: Initia
-00009d30: 6c20 6461 7461 2028 7820 616e 6420 7929  l data (x and y)
-00009d40: 2074 7269 6d6d 6564 2069 6e20 6261 7365   trimmed in base
-00009d50: 6c69 6e65 2072 616e 6765 0a20 2020 2020  line range.     
-00009d60: 2020 2050 795f 6261 7365 3a20 4669 7474     Py_base: Fitt
-00009d70: 6564 2062 6173 656c 696e 6520 666f 7220  ed baseline for 
-00009d80: 7472 696d 6d65 6420 7820 636f 6f72 6469  trimmed x coordi
-00009d90: 6e61 7465 730a 2020 2020 2020 2020 5066  nates.        Pf
-00009da0: 5f62 6173 656c 696e 653a 2070 6f6c 796e  _baseline: polyn
-00009db0: 6f6d 6961 6c20 6d6f 6465 6c20 6669 7474  omial model fitt
-00009dc0: 6564 2074 6f20 6261 7365 6c69 6e65 0a20  ed to baseline. 
-00009dd0: 2020 2020 2020 2042 6173 656c 696e 655f         Baseline_
-00009de0: 7973 7562 3a20 4261 7365 6c69 6e65 2066  ysub: Baseline f
-00009df0: 6974 7465 6420 666f 7220 7820 636f 6f72  itted for x coor
-00009e00: 6469 6e61 7465 7320 696e 2062 6173 656c  dinates in basel
-00009e10: 696e 650a 2020 2020 2020 2020 4261 7365  ine.        Base
-00009e20: 6c69 6e65 5f78 3a20 7820 636f 2d6f 7264  line_x: x co-ord
-00009e30: 696e 6174 6573 2069 6e20 6261 7365 6c69  inates in baseli
-00009e40: 6e65 2e0a 2020 2020 2020 2020 4261 7365  ne..        Base
-00009e50: 6c69 6e65 3a20 4669 6c74 6572 6564 2074  line: Filtered t
-00009e60: 6f20 7265 6d6f 7665 2070 6f69 6e74 7320  o remove points 
-00009e70: 6f75 7473 6964 6520 7369 676d 612a 7374  outside sigma*st
-00009e80: 6420 6465 7620 6f66 2062 6173 656c 696e  d dev of baselin
-00009e90: 650a 2020 2020 2020 2020 7370 616e 3a20  e.        span: 
-00009ea0: 6c6f 7765 7220 616e 6420 7570 7065 7220  lower and upper 
-00009eb0: 7820 636f 6f72 6469 6e61 7465 206f 6620  x coordinate of 
-00009ec0: 7265 6769 6f6e 2074 6861 7420 6973 6e74  region that isnt
-00009ed0: 2074 6865 2062 6173 656c 696e 650a 0a0a   the baseline...
-00009ee0: 0a20 2020 2022 2222 0a0a 2020 2020 6966  .    """..    if
-00009ef0: 2064 6961 645f 6172 7261 7920 6973 204e   diad_array is N
-00009f00: 6f6e 653a 0a20 2020 2020 2020 2044 6961  one:.        Dia
-00009f10: 645f 6466 3d67 6574 5f64 6174 6128 7061  d_df=get_data(pa
-00009f20: 7468 3d70 6174 682c 2066 696c 656e 616d  th=path, filenam
-00009f30: 653d 6669 6c65 6e61 6d65 2c20 6669 6c65  e=filename, file
-00009f40: 7479 7065 3d66 696c 6574 7970 6529 0a20  type=filetype). 
-00009f50: 2020 2020 2020 2044 6961 643d 6e70 2e61         Diad=np.a
-00009f60: 7272 6179 2844 6961 645f 6466 290a 2020  rray(Diad_df).  
-00009f70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00009f80: 4469 6164 3d64 6961 645f 6172 7261 790a  Diad=diad_array.
-00009f90: 0a0a 0a20 2020 2069 6620 6578 636c 7564  ...    if exclud
-00009fa0: 655f 7261 6e67 6531 2069 7320 6e6f 7420  e_range1 is not 
-00009fb0: 4e6f 6e65 2061 6e64 2065 7863 6c75 6465  None and exclude
-00009fc0: 5f72 616e 6765 3220 6973 204e 6f6e 653a  _range2 is None:
-00009fd0: 0a20 2020 2020 2020 2044 6961 645f 6f6c  .        Diad_ol
-00009fe0: 643d 4469 6164 2e63 6f70 7928 290a 2020  d=Diad.copy().  
-00009ff0: 2020 2020 2020 4469 6164 3d44 6961 645b        Diad=Diad[
-0000a000: 2844 6961 645b 3a2c 2030 5d3c 6578 636c  (Diad[:, 0]<excl
-0000a010: 7564 655f 7261 6e67 6531 5b30 5d29 7c28  ude_range1[0])|(
-0000a020: 4469 6164 5b3a 2c20 305d 3e65 7863 6c75  Diad[:, 0]>exclu
-0000a030: 6465 5f72 616e 6765 315b 315d 295d 0a20  de_range1[1])]. 
-0000a040: 2020 2020 2020 2044 6973 6361 7264 3d44         Discard=D
-0000a050: 6961 645f 6f6c 645b 2844 6961 645f 6f6c  iad_old[(Diad_ol
-0000a060: 645b 3a2c 2030 5d3e 3d65 7863 6c75 6465  d[:, 0]>=exclude
-0000a070: 5f72 616e 6765 315b 305d 2920 2620 2844  _range1[0]) & (D
-0000a080: 6961 645f 6f6c 645b 3a2c 2030 5d3c 3d65  iad_old[:, 0]<=e
-0000a090: 7863 6c75 6465 5f72 616e 6765 315b 315d  xclude_range1[1]
-0000a0a0: 295d 0a0a 0a20 2020 2069 6620 6578 636c  )]...    if excl
-0000a0b0: 7564 655f 7261 6e67 6532 2069 7320 6e6f  ude_range2 is no
-0000a0c0: 7420 4e6f 6e65 2061 6e64 2065 7863 6c75  t None and exclu
-0000a0d0: 6465 5f72 616e 6765 3120 6973 204e 6f6e  de_range1 is Non
-0000a0e0: 653a 0a20 2020 2020 2020 2044 6961 645f  e:.        Diad_
-0000a0f0: 6f6c 643d 4469 6164 2e63 6f70 7928 290a  old=Diad.copy().
-0000a100: 2020 2020 2020 2020 4469 6164 3d44 6961          Diad=Dia
-0000a110: 645b 2844 6961 645b 3a2c 2030 5d3c 6578  d[(Diad[:, 0]<ex
-0000a120: 636c 7564 655f 7261 6e67 6532 5b30 5d29  clude_range2[0])
-0000a130: 7c28 4469 6164 5b3a 2c20 305d 3e65 7863  |(Diad[:, 0]>exc
-0000a140: 6c75 6465 5f72 616e 6765 325b 315d 295d  lude_range2[1])]
-0000a150: 0a0a 2020 2020 2020 2020 4469 7363 6172  ..        Discar
-0000a160: 643d 4469 6164 5f6f 6c64 5b28 4469 6164  d=Diad_old[(Diad
-0000a170: 5f6f 6c64 5b3a 2c20 305d 3e3d 6578 636c  _old[:, 0]>=excl
-0000a180: 7564 655f 7261 6e67 6532 5b30 5d29 2026  ude_range2[0]) &
-0000a190: 2028 4469 6164 5f6f 6c64 5b3a 2c20 305d   (Diad_old[:, 0]
-0000a1a0: 3c3d 6578 636c 7564 655f 7261 6e67 6532  <=exclude_range2
-0000a1b0: 5b31 5d29 5d0a 0a20 2020 2069 6620 6578  [1])]..    if ex
-0000a1c0: 636c 7564 655f 7261 6e67 6531 2069 7320  clude_range1 is 
-0000a1d0: 6e6f 7420 4e6f 6e65 2061 6e64 2065 7863  not None and exc
-0000a1e0: 6c75 6465 5f72 616e 6765 3220 6973 206e  lude_range2 is n
-0000a1f0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000a200: 2044 6961 645f 6f6c 643d 4469 6164 2e63   Diad_old=Diad.c
-0000a210: 6f70 7928 290a 2020 2020 2020 2020 4469  opy().        Di
-0000a220: 6164 3d44 6961 645b 0a20 2020 2020 2020  ad=Diad[.       
-0000a230: 2028 2844 6961 645b 3a2c 2030 5d3c 6578   ((Diad[:, 0]<ex
-0000a240: 636c 7564 655f 7261 6e67 6531 5b30 5d29  clude_range1[0])
-0000a250: 7c28 4469 6164 5b3a 2c20 305d 3e65 7863  |(Diad[:, 0]>exc
-0000a260: 6c75 6465 5f72 616e 6765 315b 315d 2929  lude_range1[1]))
-0000a270: 0a20 2020 2020 2020 2026 0a20 2020 2020  .        &.     
-0000a280: 2020 2028 2844 6961 645b 3a2c 2030 5d3c     ((Diad[:, 0]<
-0000a290: 6578 636c 7564 655f 7261 6e67 6532 5b30  exclude_range2[0
-0000a2a0: 5d29 7c28 4469 6164 5b3a 2c20 305d 3e65  ])|(Diad[:, 0]>e
-0000a2b0: 7863 6c75 6465 5f72 616e 6765 325b 315d  xclude_range2[1]
-0000a2c0: 2929 0a20 2020 2020 2020 205d 0a0a 2020  )).        ]..  
-0000a2d0: 2020 2020 2020 4469 7363 6172 643d 4469        Discard=Di
-0000a2e0: 6164 5f6f 6c64 5b0a 2020 2020 2020 2020  ad_old[.        
-0000a2f0: 2828 4469 6164 5f6f 6c64 5b3a 2c20 305d  ((Diad_old[:, 0]
-0000a300: 3e3d 6578 636c 7564 655f 7261 6e67 6531  >=exclude_range1
-0000a310: 5b30 5d29 2026 2028 4469 6164 5f6f 6c64  [0]) & (Diad_old
-0000a320: 5b3a 2c20 305d 3c3d 6578 636c 7564 655f  [:, 0]<=exclude_
-0000a330: 7261 6e67 6531 5b31 5d29 290a 2020 2020  range1[1])).    
-0000a340: 2020 2020 7c0a 2020 2020 2020 2020 2828      |.        ((
-0000a350: 4469 6164 5f6f 6c64 5b3a 2c20 305d 3e3d  Diad_old[:, 0]>=
-0000a360: 6578 636c 7564 655f 7261 6e67 6532 5b30  exclude_range2[0
-0000a370: 5d29 2026 2028 4469 6164 5f6f 6c64 5b3a  ]) & (Diad_old[:
-0000a380: 2c20 305d 3c3d 6578 636c 7564 655f 7261  , 0]<=exclude_ra
-0000a390: 6e67 6532 5b31 5d29 290a 2020 2020 2020  nge2[1])).      
-0000a3a0: 2020 5d0a 0a0a 2020 2020 6c6f 7765 725f    ]...    lower_
-0000a3b0: 3062 6173 656c 696e 653d 6c6f 7765 725f  0baseline=lower_
-0000a3c0: 6263 6b5b 305d 0a20 2020 2075 7070 6572  bck[0].    upper
-0000a3d0: 5f30 6261 7365 6c69 6e65 3d6c 6f77 6572  _0baseline=lower
-0000a3e0: 5f62 636b 5b31 5d0a 2020 2020 6c6f 7765  _bck[1].    lowe
-0000a3f0: 725f 3162 6173 656c 696e 653d 7570 7065  r_1baseline=uppe
-0000a400: 725f 6263 6b5b 305d 0a20 2020 2075 7070  r_bck[0].    upp
-0000a410: 6572 5f31 6261 7365 6c69 6e65 3d75 7070  er_1baseline=upp
-0000a420: 6572 5f62 636b 5b31 5d0a 2020 2020 2320  er_bck[1].    # 
-0000a430: 4269 7420 7468 6174 2069 7320 6163 7475  Bit that is actu
-0000a440: 616c 6c79 2070 6561 6b2c 206e 6f74 2062  ally peak, not b
-0000a450: 6173 656c 696e 650a 2020 2020 7370 616e  aseline.    span
-0000a460: 3d5b 7570 7065 725f 3062 6173 656c 696e  =[upper_0baselin
-0000a470: 652c 206c 6f77 6572 5f31 6261 7365 6c69  e, lower_1baseli
-0000a480: 6e65 5d0a 0a20 2020 2023 206c 6f77 6572  ne]..    # lower
-0000a490: 5f32 6261 7365 6c69 6e65 3d31 3332 300a  _2baseline=1320.
-0000a4a0: 2020 2020 2320 7570 7065 725f 3262 6173      # upper_2bas
-0000a4b0: 656c 696e 653d 3133 3330 0a0a 2020 2020  eline=1330..    
-0000a4c0: 2320 5472 696d 2066 6f72 2065 6e74 6972  # Trim for entir
-0000a4d0: 6520 7261 6e67 650a 2020 2020 4469 6164  e range.    Diad
-0000a4e0: 5f73 686f 7274 3d44 6961 645b 2028 4469  _short=Diad[ (Di
-0000a4f0: 6164 5b3a 2c30 5d3e 6c6f 7765 725f 3062  ad[:,0]>lower_0b
-0000a500: 6173 656c 696e 6529 2026 2028 4469 6164  aseline) & (Diad
-0000a510: 5b3a 2c30 5d3c 7570 7065 725f 3162 6173  [:,0]<upper_1bas
-0000a520: 656c 696e 6529 205d 0a0a 2020 2020 2320  eline) ]..    # 
-0000a530: 4765 7420 6163 7475 616c 2062 6173 656c  Get actual basel
-0000a540: 696e 650a 2020 2020 4261 7365 6c69 6e65  ine.    Baseline
-0000a550: 5f77 6974 685f 6f75 746c 3d44 6961 645f  _with_outl=Diad_
-0000a560: 7368 6f72 745b 0a20 2020 2028 2844 6961  short[.    ((Dia
-0000a570: 645f 7368 6f72 745b 3a2c 2030 5d3c 7570  d_short[:, 0]<up
-0000a580: 7065 725f 3062 6173 656c 696e 6529 2026  per_0baseline) &
-0000a590: 2844 6961 645f 7368 6f72 745b 3a2c 2030  (Diad_short[:, 0
-0000a5a0: 5d3e 6c6f 7765 725f 3062 6173 656c 696e  ]>lower_0baselin
-0000a5b0: 6529 290a 2020 2020 2020 2020 207c 0a20  e)).         |. 
-0000a5c0: 2020 2028 2844 6961 645f 7368 6f72 745b     ((Diad_short[
-0000a5d0: 3a2c 2030 5d3c 7570 7065 725f 3162 6173  :, 0]<upper_1bas
-0000a5e0: 656c 696e 6529 2026 2844 6961 645f 7368  eline) &(Diad_sh
-0000a5f0: 6f72 745b 3a2c 2030 5d3e 6c6f 7765 725f  ort[:, 0]>lower_
-0000a600: 3162 6173 656c 696e 6529 295d 0a0a 2020  1baseline))]..  
-0000a610: 2020 2320 4361 6c63 756c 6174 6573 2074    # Calculates t
-0000a620: 6865 206d 6564 6961 6e20 666f 7220 7468  he median for th
-0000a630: 6520 6261 7365 6c69 6e65 2061 6e64 2074  e baseline and t
-0000a640: 6865 2073 7461 6e64 6172 6420 6465 7669  he standard devi
-0000a650: 6174 696f 6e0a 2020 2020 4d65 6469 616e  ation.    Median
-0000a660: 5f42 6173 656c 696e 653d 6e70 2e6d 6561  _Baseline=np.mea
-0000a670: 6e28 4261 7365 6c69 6e65 5f77 6974 685f  n(Baseline_with_
-0000a680: 6f75 746c 5b3a 2c20 315d 290a 2020 2020  outl[:, 1]).    
-0000a690: 5374 645f 4261 7365 6c69 6e65 3d6e 702e  Std_Baseline=np.
-0000a6a0: 7374 6428 4261 7365 6c69 6e65 5f77 6974  std(Baseline_wit
-0000a6b0: 685f 6f75 746c 5b3a 2c20 315d 290a 0a20  h_outl[:, 1]).. 
-0000a6c0: 2020 2023 2052 656d 6f76 6573 2061 6e79     # Removes any
-0000a6d0: 2070 6f69 6e74 7320 696e 2074 6865 2062   points in the b
-0000a6e0: 6173 656c 696e 6520 6f75 7473 6964 6520  aseline outside 
-0000a6f0: 6f66 2032 2073 6967 6d61 2028 6865 6c70  of 2 sigma (help
-0000a700: 7320 7265 6d6f 7665 2063 6f73 6d69 6320  s remove cosmic 
-0000a710: 7261 7973 2065 7463 292e 0a20 2020 2042  rays etc)..    B
-0000a720: 6173 656c 696e 653d 4261 7365 6c69 6e65  aseline=Baseline
-0000a730: 5f77 6974 685f 6f75 746c 5b28 4261 7365  _with_outl[(Base
-0000a740: 6c69 6e65 5f77 6974 685f 6f75 746c 5b3a  line_with_outl[:
-0000a750: 2c20 315d 3c4d 6564 6961 6e5f 4261 7365  , 1]<Median_Base
-0000a760: 6c69 6e65 2b73 6967 6d61 2a53 7464 5f42  line+sigma*Std_B
-0000a770: 6173 656c 696e 6529 0a20 2020 2020 2020  aseline).       
-0000a780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a790: 2020 2020 2020 2020 2026 0a20 2020 2020           &.     
-0000a7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7b0: 2020 2020 2020 2020 2020 2028 4261 7365             (Base
-0000a7c0: 6c69 6e65 5f77 6974 685f 6f75 746c 5b3a  line_with_outl[:
-0000a7d0: 2c20 315d 3e4d 6564 6961 6e5f 4261 7365  , 1]>Median_Base
-0000a7e0: 6c69 6e65 2d73 6967 6d61 2a53 7464 5f42  line-sigma*Std_B
-0000a7f0: 6173 656c 696e 6529 0a20 2020 2020 2020  aseline).       
-0000a800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a810: 2020 2020 2020 2020 5d0a 0a0a 2020 2020          ]...    
-0000a820: 2342 6173 656c 696e 653d 4261 7365 6c69  #Baseline=Baseli
-0000a830: 6e65 5f77 6974 685f 6f75 746c 0a0a 0a0a  ne_with_outl....
-0000a840: 2020 2020 2320 4669 7473 2061 2070 6f6c      # Fits a pol
-0000a850: 796e 6f6d 6961 6c20 746f 2074 6865 2062  ynomial to the b
-0000a860: 6173 656c 696e 6520 6f66 2064 6567 7265  aseline of degre
-0000a870: 650a 2020 2020 5066 5f62 6173 656c 696e  e.    Pf_baselin
-0000a880: 6520 3d20 6e70 2e70 6f6c 7931 6428 6e70  e = np.poly1d(np
-0000a890: 2e70 6f6c 7966 6974 2842 6173 656c 696e  .polyfit(Baselin
-0000a8a0: 655b 3a2c 2030 5d2c 2042 6173 656c 696e  e[:, 0], Baselin
-0000a8b0: 655b 3a2c 2031 5d2c 204e 5f70 6f6c 7929  e[:, 1], N_poly)
-0000a8c0: 290a 2020 2020 5079 5f62 6173 6520 3d50  ).    Py_base =P
-0000a8d0: 665f 6261 7365 6c69 6e65 2844 6961 645f  f_baseline(Diad_
-0000a8e0: 7368 6f72 745b 3a2c 2030 5d29 0a0a 0a20  short[:, 0])... 
-0000a8f0: 2020 2042 6173 656c 696e 655f 7973 7562     Baseline_ysub
-0000a900: 3d50 665f 6261 7365 6c69 6e65 2842 6173  =Pf_baseline(Bas
-0000a910: 656c 696e 655b 3a2c 2030 5d29 0a20 2020  eline[:, 0]).   
-0000a920: 2042 6173 656c 696e 655f 783d 4261 7365   Baseline_x=Base
-0000a930: 6c69 6e65 5b3a 2c20 305d 0a20 2020 2079  line[:, 0].    y
-0000a940: 5f63 6f72 723d 2044 6961 645f 7368 6f72  _corr= Diad_shor
-0000a950: 745b 3a2c 2031 5d2d 2020 5079 5f62 6173  t[:, 1]-  Py_bas
-0000a960: 650a 2020 2020 783d 4469 6164 5f73 686f  e.    x=Diad_sho
-0000a970: 7274 5b3a 2c20 305d 0a0a 2020 2020 2023  rt[:, 0]..     #
-0000a980: 2050 6c6f 7474 696e 6720 7768 6174 2069   Plotting what i
-0000a990: 7473 2064 6f69 6e67 0a20 2020 2069 6620  ts doing.    if 
-0000a9a0: 706c 6f74 5f66 6967 7572 6520 6973 2054  plot_figure is T
-0000a9b0: 7275 653a 0a0a 2020 2020 2020 2020 6669  rue:..        fi
-0000a9c0: 672c 2028 6178 312c 2061 7832 2920 3d20  g, (ax1, ax2) = 
-0000a9d0: 706c 742e 7375 6270 6c6f 7473 2831 2c20  plt.subplots(1, 
-0000a9e0: 322c 2066 6967 7369 7a65 3d28 3132 2c34  2, figsize=(12,4
-0000a9f0: 2929 0a20 2020 2020 2020 2061 7831 2e73  )).        ax1.s
-0000aa00: 6574 5f74 6974 6c65 2827 4261 636b 6772  et_title('Backgr
-0000aa10: 6f75 6e64 2066 6974 2729 0a20 2020 2020  ound fit').     
-0000aa20: 2020 2061 7831 2e70 6c6f 7428 4469 6164     ax1.plot(Diad
-0000aa30: 5b3a 2c20 305d 2c20 4469 6164 5b3a 2c20  [:, 0], Diad[:, 
-0000aa40: 315d 2c20 272d 272c 2063 6f6c 6f72 3d27  1], '-', color='
-0000aa50: 6772 6579 2729 0a20 2020 2020 2020 2061  grey').        a
-0000aa60: 7831 2e70 6c6f 7428 4469 6164 5f73 686f  x1.plot(Diad_sho
-0000aa70: 7274 5b3a 2c20 305d 2c20 4469 6164 5f73  rt[:, 0], Diad_s
-0000aa80: 686f 7274 5b3a 2c20 315d 2c20 272d 7227  hort[:, 1], '-r'
-0000aa90: 2c20 6c61 6265 6c3d 2772 6567 696f 6e5f  , label='region_
-0000aaa0: 325f 6263 6b5f 7375 6227 290a 0a20 2020  2_bck_sub')..   
-0000aab0: 2020 2020 2023 6178 312e 706c 6f74 2842       #ax1.plot(B
-0000aac0: 6173 656c 696e 655b 3a2c 2030 5d2c 2042  aseline[:, 0], B
-0000aad0: 6173 656c 696e 655b 3a2c 2031 5d2c 2027  aseline[:, 1], '
-0000aae0: 2d62 272c 206c 6162 656c 3d27 4263 6b20  -b', label='Bck 
-0000aaf0: 706f 696e 7473 2729 0a20 2020 2020 2020  points').       
-0000ab00: 2061 7831 2e70 6c6f 7428 4261 7365 6c69   ax1.plot(Baseli
-0000ab10: 6e65 5b3a 2c20 305d 2c20 4261 7365 6c69  ne[:, 0], Baseli
-0000ab20: 6e65 5b3a 2c20 315d 2c20 272e 6227 2c20  ne[:, 1], '.b', 
-0000ab30: 6c61 6265 6c3d 2742 636b 2070 6f69 6e74  label='Bck point
-0000ab40: 7327 290a 2020 2020 2020 2020 6178 312e  s').        ax1.
-0000ab50: 706c 6f74 2844 6961 645f 7368 6f72 745b  plot(Diad_short[
-0000ab60: 3a2c 2030 5d2c 2050 795f 6261 7365 2c20  :, 0], Py_base, 
-0000ab70: 272d 6b27 290a 0a0a 0a20 2020 2020 2020  '-k')....       
-0000ab80: 2061 7831 5f79 6d69 6e3d 6e70 2e6d 696e   ax1_ymin=np.min
-0000ab90: 2842 6173 656c 696e 655b 3a2c 2031 5d29  (Baseline[:, 1])
-0000aba0: 2d31 302a 6e70 2e73 7464 2842 6173 656c  -10*np.std(Basel
-0000abb0: 696e 655b 3a2c 2031 5d29 0a20 2020 2020  ine[:, 1]).     
-0000abc0: 2020 2061 7831 5f79 6d61 783d 6e70 2e6d     ax1_ymax=np.m
-0000abd0: 6178 2842 6173 656c 696e 655b 3a2c 2031  ax(Baseline[:, 1
-0000abe0: 5d29 2b31 302a 6e70 2e73 7464 2842 6173  ])+10*np.std(Bas
-0000abf0: 656c 696e 655b 3a2c 2031 5d29 0a20 2020  eline[:, 1]).   
-0000ac00: 2020 2020 2061 7831 5f78 6d69 6e3d 6c6f       ax1_xmin=lo
-0000ac10: 7765 725f 3062 6173 656c 696e 652d 3330  wer_0baseline-30
-0000ac20: 0a20 2020 2020 2020 2061 7831 5f78 6d61  .        ax1_xma
-0000ac30: 783d 7570 7065 725f 3162 6173 656c 696e  x=upper_1baselin
-0000ac40: 652b 3330 0a20 2020 2020 2020 2023 2041  e+30.        # A
-0000ac50: 6464 696e 6720 7061 7463 6865 730a 0a0a  dding patches...
-0000ac60: 2020 2020 2020 2020 7265 6374 5f64 6961          rect_dia
-0000ac70: 6431 5f62 313d 7061 7463 6865 732e 5265  d1_b1=patches.Re
-0000ac80: 6374 616e 676c 6528 286c 6f77 6572 5f30  ctangle((lower_0
-0000ac90: 6261 7365 6c69 6e65 2c20 6178 315f 796d  baseline, ax1_ym
-0000aca0: 696e 292c 7570 7065 725f 3062 6173 656c  in),upper_0basel
-0000acb0: 696e 652d 6c6f 7765 725f 3062 6173 656c  ine-lower_0basel
-0000acc0: 696e 652c 6178 315f 796d 6178 2d61 7831  ine,ax1_ymax-ax1
-0000acd0: 5f79 6d69 6e2c 0a20 2020 2020 2020 2020  _ymin,.         
-0000ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acf0: 2020 2020 206c 696e 6577 6964 7468 3d31       linewidth=1
-0000ad00: 2c65 6467 6563 6f6c 6f72 3d27 6e6f 6e65  ,edgecolor='none
-0000ad10: 272c 6661 6365 636f 6c6f 723d 2763 7961  ',facecolor='cya
-0000ad20: 6e27 2c20 6c61 6265 6c3d 2762 636b 272c  n', label='bck',
-0000ad30: 2061 6c70 6861 3d30 2e33 2c20 7a6f 7264   alpha=0.3, zord
-0000ad40: 6572 3d30 290a 2020 2020 2020 2020 6178  er=0).        ax
-0000ad50: 312e 6164 645f 7061 7463 6828 7265 6374  1.add_patch(rect
-0000ad60: 5f64 6961 6431 5f62 3129 0a20 2020 2020  _diad1_b1).     
-0000ad70: 2020 2072 6563 745f 6469 6164 315f 6232     rect_diad1_b2
-0000ad80: 3d70 6174 6368 6573 2e52 6563 7461 6e67  =patches.Rectang
-0000ad90: 6c65 2828 6c6f 7765 725f 3162 6173 656c  le((lower_1basel
-0000ada0: 696e 652c 2061 7831 5f79 6d69 6e29 2c75  ine, ax1_ymin),u
-0000adb0: 7070 6572 5f31 6261 7365 6c69 6e65 2d6c  pper_1baseline-l
-0000adc0: 6f77 6572 5f31 6261 7365 6c69 6e65 2c61  ower_1baseline,a
-0000add0: 7831 5f79 6d61 782d 6178 315f 796d 696e  x1_ymax-ax1_ymin
-0000ade0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000adf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae00: 6c69 6e65 7769 6474 683d 312c 6564 6765  linewidth=1,edge
-0000ae10: 636f 6c6f 723d 276e 6f6e 6527 2c66 6163  color='none',fac
-0000ae20: 6563 6f6c 6f72 3d27 6379 616e 272c 2061  ecolor='cyan', a
-0000ae30: 6c70 6861 3d30 2e33 2c20 7a6f 7264 6572  lpha=0.3, zorder
-0000ae40: 3d30 290a 2020 2020 2020 2020 6178 312e  =0).        ax1.
-0000ae50: 6164 645f 7061 7463 6828 7265 6374 5f64  add_patch(rect_d
-0000ae60: 6961 6431 5f62 3229 0a20 2020 2020 2020  iad1_b2).       
-0000ae70: 2061 7831 2e73 6574 5f78 6c69 6d28 5b61   ax1.set_xlim([a
-0000ae80: 7831 5f78 6d69 6e2c 2061 7831 5f78 6d61  x1_xmin, ax1_xma
-0000ae90: 785d 290a 2020 2020 2020 2020 6178 312e  x]).        ax1.
-0000aea0: 7365 745f 796c 696d 285b 6178 315f 796d  set_ylim([ax1_ym
-0000aeb0: 696e 2c20 6178 315f 796d 6178 5d29 0a0a  in, ax1_ymax])..
-0000aec0: 2020 2020 2020 2020 6178 312e 7365 745f          ax1.set_
-0000aed0: 796c 6162 656c 2827 496e 7465 6e73 6974  ylabel('Intensit
-0000aee0: 7927 290a 2020 2020 2020 2020 6178 322e  y').        ax2.
-0000aef0: 7365 745f 796c 6162 656c 2827 496e 7465  set_ylabel('Inte
-0000af00: 6e73 6974 7927 290a 2020 2020 2020 2020  nsity').        
-0000af10: 6178 322e 7365 745f 786c 6162 656c 2827  ax2.set_xlabel('
-0000af20: 5761 7665 6e75 6d62 6572 2729 0a20 2020  Wavenumber').   
-0000af30: 2020 2020 2061 7831 2e6c 6567 656e 6428       ax1.legend(
-0000af40: 290a 0a0a 0a20 2020 2020 2020 2061 7832  )....        ax2
-0000af50: 2e73 6574 5f74 6974 6c65 2827 4261 636b  .set_title('Back
-0000af60: 6772 6f75 6e64 2073 7562 7472 6163 7465  ground subtracte
-0000af70: 6427 290a 2020 2020 2020 2020 6178 322e  d').        ax2.
-0000af80: 706c 6f74 2878 2c20 795f 636f 7272 2c20  plot(x, y_corr, 
-0000af90: 272d 7227 290a 2020 2020 2020 2020 6865  '-r').        he
-0000afa0: 6967 6874 5f70 3d6e 702e 6d61 7828 4469  ight_p=np.max(Di
-0000afb0: 6164 5f73 686f 7274 5b3a 2c20 315d 292d  ad_short[:, 1])-
-0000afc0: 6e70 2e6d 696e 2844 6961 645f 7368 6f72  np.min(Diad_shor
-0000afd0: 745b 3a2c 2031 5d29 0a20 2020 2020 2020  t[:, 1]).       
-0000afe0: 2061 7832 2e73 6574 5f79 6c69 6d28 5b6e   ax2.set_ylim([n
-0000aff0: 702e 6d69 6e28 795f 636f 7272 292c 2031  p.min(y_corr), 1
-0000b000: 2e32 2a68 6569 6768 745f 7020 5d29 0a20  .2*height_p ]). 
-0000b010: 2020 2020 2020 2061 7831 2e73 6574 5f78         ax1.set_x
-0000b020: 6c61 6265 6c28 2757 6176 656e 756d 6265  label('Wavenumbe
-0000b030: 7227 290a 0a0a 2020 2020 7265 7475 726e  r')...    return
-0000b040: 2079 5f63 6f72 722c 2050 795f 6261 7365   y_corr, Py_base
-0000b050: 2c20 782c 2020 4469 6164 5f73 686f 7274  , x,  Diad_short
-0000b060: 2c20 5079 5f62 6173 652c 2050 665f 6261  , Py_base, Pf_ba
-0000b070: 7365 6c69 6e65 2c20 4261 7365 6c69 6e65  seline, Baseline
-0000b080: 5f79 7375 622c 2042 6173 656c 696e 655f  _ysub, Baseline_
-0000b090: 782c 2042 6173 656c 696e 652c 2073 7061  x, Baseline, spa
-0000b0a0: 6e0a 0a0a 0a64 6566 2061 6464 5f70 6561  n....def add_pea
-0000b0b0: 6b28 2a2c 2070 7265 6669 783d 4e6f 6e65  k(*, prefix=None
-0000b0c0: 2c20 6365 6e74 6572 3d4e 6f6e 652c 206d  , center=None, m
-0000b0d0: 6f64 656c 5f6e 616d 653d 2756 6f69 6774  odel_name='Voigt
-0000b0e0: 4d6f 6465 6c27 2c0a 6d69 6e5f 6365 6e74  Model',.min_cent
-0000b0f0: 3d4e 6f6e 652c 206d 6178 5f63 656e 743d  =None, max_cent=
-0000b100: 4e6f 6e65 2c20 6d69 6e5f 7369 676d 613d  None, min_sigma=
-0000b110: 4e6f 6e65 2c20 6d61 785f 7369 676d 613d  None, max_sigma=
-0000b120: 4e6f 6e65 2c20 616d 706c 6974 7564 653d  None, amplitude=
-0000b130: 3130 302c 206d 696e 5f61 6d70 6c69 7475  100, min_amplitu
-0000b140: 6465 3d4e 6f6e 652c 206d 6178 5f61 6d70  de=None, max_amp
-0000b150: 6c69 7475 6465 3d4e 6f6e 652c 2073 6967  litude=None, sig
-0000b160: 6d61 3d30 2e32 293a 0a20 2020 2022 2222  ma=0.2):.    """
-0000b170: 0a20 2020 2054 6869 7320 6675 6e63 7469  .    This functi
-0000b180: 6f6e 2069 7465 7261 7469 7665 6c79 2061  on iteratively a
-0000b190: 6464 7320 6120 7065 616b 2075 7369 6e67  dds a peak using
-0000b1a0: 206c 6d66 6974 2c20 7573 6564 2066 6f72   lmfit, used for
-0000b1b0: 2069 7465 7261 7469 7665 6c79 2066 6974   iteratively fit
-0000b1c0: 7469 6e67 2048 422c 2043 3133 2065 7463  ting HB, C13 etc
-0000b1d0: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-0000b1e0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-0000b1f0: 2d2d 2d2d 0a20 2020 2070 7265 6669 783a  ----.    prefix:
-0000b200: 2073 7472 0a20 2020 2020 2020 2050 7265   str.        Pre
-0000b210: 6669 7820 6164 6465 6420 746f 2070 6561  fix added to pea
-0000b220: 6b20 6e61 6d65 2c20 652e 672e 2027 6469  k name, e.g. 'di
-0000b230: 6164 3127 2c20 736f 2069 7420 7265 6164  ad1', so it read
-0000b240: 7320 6469 6164 315f 6365 6e74 6572 2c20  s diad1_center, 
-0000b250: 6469 6164 315f 7369 676d 6120 6574 632e  diad1_sigma etc.
-0000b260: 0a0a 2020 2020 6365 6e74 6572 3a20 666c  ..    center: fl
-0000b270: 6f61 742c 2069 6e74 0a20 2020 2020 2020  oat, int.       
-0000b280: 2045 7374 696d 6174 6520 6f66 2070 6561   Estimate of pea
-0000b290: 6b20 6365 6e74 6572 2028 652e 672e 2078  k center (e.g. x
-0000b2a0: 2063 6f6f 7264 696e 6174 6520 6f66 2070   coordinate of p
-0000b2b0: 6561 6b29 0a0a 2020 2020 7369 676d 613a  eak)..    sigma:
-0000b2c0: 2066 6c6f 6174 2c20 696e 7420 2864 6566   float, int (def
-0000b2d0: 6175 6c74 2030 2e32 290a 2020 2020 2020  ault 0.2).      
-0000b2e0: 2020 4573 7469 6d61 7465 206f 6620 7369    Estimate of si
-0000b2f0: 676d 6120 6f66 2070 6561 6b20 6669 740a  gma of peak fit.
-0000b300: 0a20 2020 2061 6d70 6c69 7475 6465 3a20  .    amplitude: 
-0000b310: 666c 6f61 742c 2069 6e74 0a20 2020 2020  float, int.     
-0000b320: 2020 2045 7374 696d 6174 6520 6f66 2061     Estimate of a
-0000b330: 6d70 6c69 7475 6465 206f 6620 7065 616b  mplitude of peak
-0000b340: 6620 6974 0a0a 0a20 2020 206d 6f64 656c  f it...    model
-0000b350: 5f6e 616d 653a 2073 7472 2027 566f 6967  _name: str 'Voig
-0000b360: 744d 6f64 656c 2720 6f72 2027 5073 6575  tModel' or 'Pseu
-0000b370: 646f 566f 6967 744d 6f64 656c 270a 2020  doVoigtModel'.  
-0000b380: 2020 2020 2020 5479 7065 206f 6620 7065        Type of pe
-0000b390: 616b 2077 6869 6368 2069 7320 6265 696e  ak which is bein
-0000b3a0: 6720 6164 6465 642e 0a0a 2020 2020 4f70  g added...    Op
-0000b3b0: 7469 6f6e 616c 3a0a 0a20 2020 206d 696e  tional:..    min
-0000b3c0: 5f63 656e 742c 206d 6178 5f63 656e 743a  _cent, max_cent:
-0000b3d0: 2066 6c6f 6174 0a20 2020 2020 2020 204d   float.        M
-0000b3e0: 696e 696d 756d 2061 6e64 206d 6178 696d  inimum and maxim
-0000b3f0: 756d 2078 2063 6f6f 7264 696e 6174 6520  um x coordinate 
-0000b400: 746f 2070 6c61 6365 2070 6561 6b20 6365  to place peak ce
-0000b410: 6e74 6572 2061 740a 0a20 2020 206d 696e  nter at..    min
-0000b420: 5f73 6967 6d61 2c20 6d61 785f 7369 676d  _sigma, max_sigm
-0000b430: 613a 2066 6c6f 6174 0a20 2020 2020 2020  a: float.       
-0000b440: 204d 696e 696d 756d 2061 6e64 206d 6178   Minimum and max
-0000b450: 696d 756d 2073 6967 6d61 206f 6620 7065  imum sigma of pe
-0000b460: 616b 2066 6974 0a0a 2020 2020 6d69 6e5f  ak fit..    min_
-0000b470: 616d 706c 6974 7564 652c 206d 6178 5f61  amplitude, max_a
-0000b480: 6d70 6c69 7475 6465 3a20 666c 6f61 740a  mplitude: float.
-0000b490: 2020 2020 2020 2020 4d69 6e69 6d75 6d20          Minimum 
-0000b4a0: 616e 6420 6d61 7869 6d75 6d20 7369 676d  and maximum sigm
-0000b4b0: 6120 6f66 2070 6561 6b20 6669 740a 0a20  a of peak fit.. 
-0000b4c0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
-0000b4d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a0a  --------------..
-0000b4e0: 2020 2020 7065 616b 3a20 4669 7474 6564      peak: Fitted
-0000b4f0: 206d 6f64 656c 0a20 2020 2070 6172 616d   model.    param
-0000b500: 733a 2050 6561 6b20 6669 7420 7061 7261  s: Peak fit para
-0000b510: 6d65 7465 7273 0a0a 2020 2020 2222 220a  meters..    """.
-0000b520: 2020 2020 4d6f 6465 6c5f 636f 6d62 6f20      Model_combo 
-0000b530: 3d20 676c 6f62 616c 7328 295b 6d6f 6465  = globals()[mode
-0000b540: 6c5f 6e61 6d65 5d28 7072 6566 6978 3d70  l_name](prefix=p
-0000b550: 7265 6669 7829 0a0a 2020 2020 7065 616b  refix)..    peak
-0000b560: 203d 2020 4d6f 6465 6c5f 636f 6d62 6f0a   =  Model_combo.
-0000b570: 2020 2020 7061 7273 203d 2070 6561 6b2e      pars = peak.
-0000b580: 6d61 6b65 5f70 6172 616d 7328 290a 0a20  make_params().. 
-0000b590: 2020 2069 6620 6d69 6e5f 6365 6e74 2069     if min_cent i
-0000b5a0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206d  s not None and m
-0000b5b0: 6178 5f63 656e 7420 6973 206e 6f74 204e  ax_cent is not N
-0000b5c0: 6f6e 653a 0a20 2020 2020 2020 2070 6172  one:.        par
-0000b5d0: 735b 7072 6566 6978 202b 2027 6365 6e74  s[prefix + 'cent
-0000b5e0: 6572 275d 2e73 6574 2863 656e 7465 722c  er'].set(center,
-0000b5f0: 206d 696e 3d6d 696e 5f63 656e 742c 206d   min=min_cent, m
-0000b600: 6178 3d6d 6178 5f63 656e 7429 0a20 2020  ax=max_cent).   
-0000b610: 2065 6c73 653a 0a20 2020 2020 2020 2070   else:.        p
-0000b620: 6172 735b 7072 6566 6978 202b 2027 6365  ars[prefix + 'ce
-0000b630: 6e74 6572 275d 2e73 6574 2863 656e 7465  nter'].set(cente
-0000b640: 7229 0a0a 0a20 2020 2070 6172 735b 7072  r)...    pars[pr
-0000b650: 6566 6978 202b 2027 616d 706c 6974 7564  efix + 'amplitud
-0000b660: 6527 5d2e 7365 7428 616d 706c 6974 7564  e'].set(amplitud
-0000b670: 652c 206d 696e 3d6d 696e 5f61 6d70 6c69  e, min=min_ampli
-0000b680: 7475 6465 2c20 6d61 783d 6d61 785f 616d  tude, max=max_am
-0000b690: 706c 6974 7564 6529 0a0a 2020 2020 6966  plitude)..    if
-0000b6a0: 206d 696e 5f73 6967 6d61 2069 7320 6e6f   min_sigma is no
-0000b6b0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000b6c0: 7061 7273 5b70 7265 6669 782b 2773 6967  pars[prefix+'sig
-0000b6d0: 6d61 275d 2e73 6574 2873 6967 6d61 2c20  ma'].set(sigma, 
-0000b6e0: 6d61 783d 6d61 785f 7369 676d 6129 0a0a  max=max_sigma)..
-0000b6f0: 2020 2020 6966 206d 696e 5f73 6967 6d61      if min_sigma
-0000b700: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0000b710: 206d 6178 5f73 6967 6d61 2069 7320 6e6f   max_sigma is no
-0000b720: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000b730: 7061 7273 5b70 7265 6669 782b 2773 6967  pars[prefix+'sig
-0000b740: 6d61 275d 2e73 6574 2873 6967 6d61 2c20  ma'].set(sigma, 
-0000b750: 6d61 783d 6d61 785f 7369 676d 612c 206d  max=max_sigma, m
-0000b760: 696e 3d6d 696e 5f73 6967 6d61 290a 0a20  in=min_sigma).. 
-0000b770: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000b780: 2070 6172 735b 7072 6566 6978 202b 2027   pars[prefix + '
-0000b790: 7369 676d 6127 5d2e 7365 7428 7369 676d  sigma'].set(sigm
-0000b7a0: 612c 206d 696e 3d30 290a 0a0a 2020 2020  a, min=0)...    
-0000b7b0: 7265 7475 726e 2070 6561 6b2c 2070 6172  return peak, par
-0000b7c0: 730a 0a0a 0a0a 0a0a 2323 204f 7665 7261  s.......## Overa
-0000b7d0: 6c6c 2066 756e 6374 696f 6e20 666f 7220  ll function for 
-0000b7e0: 6669 7474 696e 6720 6469 6164 7320 696e  fitting diads in
-0000b7f0: 2031 2073 696e 676c 6520 7374 6570 0a40   1 single step.@
-0000b800: 6461 7461 636c 6173 730a 636c 6173 7320  dataclass.class 
-0000b810: 6469 6164 315f 6669 745f 636f 6e66 6967  diad1_fit_config
-0000b820: 3a0a 2020 2020 2222 220a 2020 2020 436f  :.    """.    Co
-0000b830: 6e66 6967 7572 6174 696f 6e20 636c 6173  nfiguration clas
-0000b840: 7320 666f 7220 6669 7474 696e 6720 4469  s for fitting Di
-0000b850: 6164 2031 0a0a 2020 2020 5468 6973 2063  ad 1..    This c
-0000b860: 6c61 7373 2073 746f 7265 7320 636f 6e66  lass stores conf
-0000b870: 6967 7572 6174 696f 6e20 7061 7261 6d65  iguration parame
-0000b880: 7465 7273 2066 6f72 2066 6974 7469 6e67  ters for fitting
-0000b890: 2044 6961 6420 3120 616e 6420 6173 736f   Diad 1 and asso
-0000b8a0: 6369 6174 6564 2070 6561 6b73 2e0a 2020  ciated peaks..  
-0000b8b0: 2020 5468 6520 636c 6173 7320 616c 6c6f    The class allo
-0000b8c0: 7773 2066 6f72 2065 6173 7920 6375 7374  ws for easy cust
-0000b8d0: 6f6d 697a 6174 696f 6e20 6f66 2074 6865  omization of the
-0000b8e0: 2066 6974 7469 6e67 2070 726f 6365 7373   fitting process
-0000b8f0: 2e0a 0a20 2020 2041 7474 7269 6275 7465  ...    Attribute
-0000b900: 733a 0a20 2020 2020 2020 206d 6f64 656c  s:.        model
-0000b910: 5f6e 616d 6520 2873 7472 293a 2044 6566  _name (str): Def
-0000b920: 6175 6c74 2027 5073 6575 646f 566f 6967  ault 'PseudoVoig
-0000b930: 744d 6f64 656c 272e 0a20 2020 2020 2020  tModel'..       
-0000b940: 2020 2020 204d 6f64 656c 206e 616d 6520       Model name 
-0000b950: 666f 7220 7065 616b 2066 6974 7469 6e67  for peak fitting
-0000b960: 2e20 4368 6f6f 7365 2066 726f 6d0a 2020  . Choose from.  
-0000b970: 2020 2020 2020 2020 2020 2750 7365 7564            'Pseud
-0000b980: 6f56 6f69 6774 4d6f 6465 6c27 2c20 2756  oVoigtModel', 'V
-0000b990: 6f69 6774 4d6f 6465 6c27 2c20 2747 6175  oigtModel', 'Gau
-0000b9a0: 7373 6961 6e4d 6f64 656c 272c 2027 4c6f  ssianModel', 'Lo
-0000b9b0: 7265 6e74 7a69 616e 4d6f 6465 6c27 2c20  rentzianModel', 
-0000b9c0: 6574 632e 0a0a 2020 2020 2020 2020 6669  etc...        fi
-0000b9d0: 745f 7065 616b 7320 2869 6e74 293a 2044  t_peaks (int): D
-0000b9e0: 6566 6175 6c74 2032 0a20 2020 2020 2020  efault 2.       
-0000b9f0: 2020 2020 204e 756d 6265 7220 6f66 2070       Number of p
-0000ba00: 6561 6b73 2074 6f20 6669 742e 2032 203d  eaks to fit. 2 =
-0000ba10: 2044 6961 6420 2b20 4842 2c20 3120 3d20   Diad + HB, 1 = 
-0000ba20: 4469 6164 2e0a 0a20 2020 2020 2020 204e  Diad...        N
-0000ba30: 5f70 6f6c 795f 6263 6b5f 6469 6164 3120  _poly_bck_diad1 
-0000ba40: 2866 6c6f 6174 293a 2044 6566 6175 6c74  (float): Default
-0000ba50: 203d 2031 0a20 2020 2020 2020 2020 2020   = 1.           
-0000ba60: 2044 6567 7265 6520 6f66 2070 6f6c 796e   Degree of polyn
-0000ba70: 6f6d 6961 6c20 666f 7220 6261 636b 6772  omial for backgr
-0000ba80: 6f75 6e64 2073 7562 7472 6163 7469 6f6e  ound subtraction
-0000ba90: 2e20 4465 6661 756c 7420 312e 0a0a 2020  . Default 1...  
-0000baa0: 2020 2020 2020 6c6f 7765 725f 6263 6b5f        lower_bck_
-0000bab0: 6469 6164 3120 2854 7570 6c65 5b66 6c6f  diad1 (Tuple[flo
-0000bac0: 6174 2c20 666c 6f61 745d 293a 0a20 2020  at, float]):.   
-0000bad0: 2020 2020 2020 2020 204c 6f77 6572 2062           Lower b
-0000bae0: 6f75 6e64 6172 7920 666f 7220 6261 636b  oundary for back
-0000baf0: 6772 6f75 6e64 2066 6974 7469 6e67 2069  ground fitting i
-0000bb00: 6e20 636d 2d31 2e20 4465 6661 756c 7420  n cm-1. Default 
-0000bb10: 2831 3138 302c 2031 3232 3029 0a0a 2020  (1180, 1220)..  
-0000bb20: 2020 2020 2020 7570 7065 725f 6263 6b5f        upper_bck_
-0000bb30: 6469 6164 3120 2854 7570 6c65 5b66 6c6f  diad1 (Tuple[flo
-0000bb40: 6174 2c20 666c 6f61 745d 293a 0a20 2020  at, float]):.   
-0000bb50: 2020 2020 2020 2020 2055 7070 6572 2062           Upper b
-0000bb60: 6f75 6e64 6172 7920 666f 7220 6261 636b  oundary for back
-0000bb70: 6772 6f75 6e64 2066 6974 7469 6e67 2069  ground fitting i
-0000bb80: 6e20 636d 2d31 2044 6566 6175 6c74 2028  n cm-1 Default (
-0000bb90: 3133 3030 2c20 3133 3530 292e 0a0a 2020  1300, 1350)...  
-0000bba0: 2020 2020 2020 6669 745f 6761 7573 7320        fit_gauss 
-0000bbb0: 284f 7074 696f 6e61 6c5b 626f 6f6c 5d29  (Optional[bool])
-0000bbc0: 3a20 4465 6661 756c 7420 5472 7565 0a20  : Default True. 
-0000bbd0: 2020 2020 2020 2020 2020 2046 6974 2061             Fit a
-0000bbe0: 2047 6175 7373 6961 6e20 7065 616b 2069   Gaussian peak i
-0000bbf0: 6620 5472 7565 2e20 4865 6c70 6675 6c20  f True. Helpful 
-0000bc00: 666f 7220 7665 7279 2065 6c65 7661 7465  for very elevate
-0000bc10: 6420 7370 6563 7472 610a 0a20 2020 2020  d spectra..     
-0000bc20: 2020 2067 6175 7373 5f61 6d70 2028 4f70     gauss_amp (Op
-0000bc30: 7469 6f6e 616c 5b66 6c6f 6174 5d29 3a20  tional[float]): 
-0000bc40: 2044 6566 6175 6c74 203d 2031 3030 300a   Default = 1000.
-0000bc50: 2020 2020 2020 2020 2020 2020 4761 7573              Gaus
-0000bc60: 7369 616e 2070 6561 6b20 616d 706c 6974  sian peak amplit
-0000bc70: 7564 6520 6966 2060 6669 745f 6761 7573  ude if `fit_gaus
-0000bc80: 7360 2069 7320 5472 7565 2e20 4465 6661  s` is True. Defa
-0000bc90: 756c 7420 3130 3030 2e0a 2020 2020 2020  ult 1000..      
-0000bca0: 2020 2020 2020 5765 2066 696e 6420 3258        We find 2X
-0000bcb0: 2048 4220 696e 7465 6e73 6974 7920 6973   HB intensity is
-0000bcc0: 2061 2067 6f6f 6420 6775 6573 7320 6f6e   a good guess on
-0000bcd0: 206d 616e 7920 696e 7374 7275 6d65 6e74   many instrument
-0000bce0: 730a 0a20 2020 2020 2020 2064 6961 645f  s..        diad_
-0000bcf0: 7369 676d 6120 2866 6c6f 6174 293a 2044  sigma (float): D
-0000bd00: 6566 6175 6c74 203d 2030 2e32 0a20 2020  efault = 0.2.   
-0000bd10: 2020 2020 2020 2020 2053 6967 6d61 206f           Sigma o
-0000bd20: 6620 6469 6164 2070 6561 6b2e 0a0a 2020  f diad peak...  
-0000bd30: 2020 2020 2020 6469 6164 5f73 6967 6d61        diad_sigma
-0000bd40: 5f6d 696e 5f61 6c6c 6f77 616e 6365 2028  _min_allowance (
-0000bd50: 666c 6f61 7429 3a20 4465 6661 756c 7420  float): Default 
-0000bd60: 3d20 302e 320a 2020 2020 2020 2020 2020  = 0.2.          
-0000bd70: 2020 546f 6c65 7261 6e63 6520 6f6e 2065    Tolerance on e
-0000bd80: 6e74 6572 6564 2073 6967 6d61 2e20 4d65  ntered sigma. Me
-0000bd90: 616e 7320 6d69 6e69 6d75 6d20 616c 6c6f  ans minimum allo
-0000bda0: 7765 6420 7369 676d 6120 6973 2030 2e32  wed sigma is 0.2
-0000bdb0: 2a73 6967 6d61 0a0a 2020 2020 2020 2020  *sigma..        
-0000bdc0: 6469 6164 5f73 6967 6d61 5f6d 6178 5f61  diad_sigma_max_a
-0000bdd0: 6c6c 6f77 616e 6365 2028 666c 6f61 7429  llowance (float)
-0000bde0: 3a20 4465 6661 756c 7420 3d20 350a 2020  : Default = 5.  
-0000bdf0: 2020 2020 2020 2020 2020 546f 6c65 7261            Tolera
-0000be00: 6e63 6520 6f6e 2065 6e74 6572 6564 2073  nce on entered s
-0000be10: 6967 6d61 2e20 4d65 616e 7320 6d69 6e69  igma. Means mini
-0000be20: 6d75 6d20 616c 6c6f 7765 6420 7369 676d  mum allowed sigm
-0000be30: 6120 6973 2035 2a73 6967 6d61 0a0a 0a20  a is 5*sigma... 
-0000be40: 2020 2020 2020 2064 6961 645f 7072 6f6d         diad_prom
-0000be50: 2028 666c 6f61 7429 3a20 4465 6661 756c   (float): Defaul
-0000be60: 7420 3d20 3130 300a 2020 2020 2020 2020  t = 100.        
-0000be70: 2020 2020 5065 616b 2061 6d70 6c69 7475      Peak amplitu
-0000be80: 6465 2066 6f72 206f 6620 7468 6520 6469  de for of the di
-0000be90: 6164 2e20 5375 6767 6573 7420 7573 6572  ad. Suggest user
-0000bea0: 7320 6f62 7461 696e 2066 726f 6d20 7468  s obtain from th
-0000beb0: 6520 6573 7469 6d61 7465 6420 7065 616b  e estimated peak
-0000bec0: 2070 6172 616d 6574 6572 2064 6174 6166   parameter dataf
-0000bed0: 7261 6d65 0a0a 2020 2020 2020 2020 4842  rame..        HB
-0000bee0: 5f70 726f 6d20 2866 6c6f 6174 293a 2020  _prom (float):  
-0000bef0: 4465 6661 756c 7420 3d20 3230 0a20 2020  Default = 20.   
-0000bf00: 2020 2020 2020 2020 2050 6561 6b20 616d           Peak am
-0000bf10: 706c 6974 7564 6520 666f 7220 4842 2e20  plitude for HB. 
-0000bf20: 5375 6767 6573 7420 7573 6572 7320 6f62  Suggest users ob
-0000bf30: 7461 696e 2066 726f 6d20 7468 6520 6573  tain from the es
-0000bf40: 7469 6d61 7465 6420 7065 616b 2070 6172  timated peak par
-0000bf50: 616d 6574 6572 2064 6174 6166 7261 6d65  ameter dataframe
-0000bf60: 0a0a 2020 2020 2020 2020 4842 5f73 6967  ..        HB_sig
-0000bf70: 6d61 5f6d 696e 5f61 6c6c 6f77 616e 6365  ma_min_allowance
-0000bf80: 2028 666c 6f61 7429 3a20 4465 6661 756c   (float): Defaul
-0000bf90: 7420 3d20 302e 3035 0a20 2020 2020 2020  t = 0.05.       
-0000bfa0: 2020 2020 204d 6561 6e73 2048 4220 7369       Means HB si
-0000bfb0: 676d 6120 6361 6e74 2062 6520 6c65 7373  gma cant be less
-0000bfc0: 2074 6861 6e20 302e 3035 2a20 7369 676d   than 0.05* sigm
-0000bfd0: 6120 6f66 2066 6972 7374 2066 6974 7469  a of first fitti
-0000bfe0: 6e67 2070 6561 6b20 2864 6961 6429 2e0a  ng peak (diad)..
-0000bff0: 0a20 2020 2020 2020 2048 425f 7369 676d  .        HB_sigm
-0000c000: 615f 6d61 785f 616c 6c6f 7761 6e63 6520  a_max_allowance 
-0000c010: 2866 6c6f 6174 293a 2044 6566 6175 6c74  (float): Default
-0000c020: 203d 2033 3a0a 2020 2020 2020 2020 2020   = 3:.          
-0000c030: 2020 4d65 616e 7320 4842 2073 6967 6d61    Means HB sigma
-0000c040: 2063 616e 7420 6578 6365 6564 2033 2a20   cant exceed 3* 
-0000c050: 7369 676d 6120 6f66 2066 6972 7374 2066  sigma of first f
-0000c060: 6974 7469 6e67 2070 6561 6b20 2864 6961  itting peak (dia
-0000c070: 6429 0a0a 2020 2020 2020 2020 4842 5f61  d)..        HB_a
-0000c080: 6d70 5f6d 696e 5f61 6c6c 6f77 616e 6365  mp_min_allowance
-0000c090: 2028 666c 6f61 7429 3a20 4465 6661 756c   (float): Defaul
-0000c0a0: 7420 3d30 2e30 310a 2020 2020 2020 2020  t =0.01.        
-0000c0b0: 2020 2020 4d65 616e 7320 4842 2061 6d70      Means HB amp
-0000c0c0: 6c69 7475 6465 2063 616e 7420 6265 206c  litude cant be l
-0000c0d0: 6573 7320 7468 616e 2030 2e30 312a 616d  ess than 0.01*am
-0000c0e0: 706c 6974 7564 6520 6f66 2066 6972 7374  plitude of first
-0000c0f0: 2066 6974 7465 6420 7065 616b 2028 6469   fitted peak (di
-0000c100: 6164 292e 0a0a 2020 2020 2020 2020 4842  ad)...        HB
-0000c110: 5f61 6d70 5f6d 6178 5f61 6c6c 6f77 616e  _amp_max_allowan
-0000c120: 6365 2028 666c 6f61 7429 3a20 4465 6661  ce (float): Defa
-0000c130: 756c 7420 3d20 310a 2020 2020 2020 2020  ult = 1.        
-0000c140: 2020 2020 4d65 616e 7320 4842 2061 6d70      Means HB amp
-0000c150: 6c69 7475 6465 2063 616e 7420 6265 206d  litude cant be m
-0000c160: 6f72 6520 7468 616e 2031 2a61 6d70 6c69  ore than 1*ampli
-0000c170: 7475 6465 206f 6620 6669 7273 7420 6669  tude of first fi
-0000c180: 7474 6564 2070 6561 6b20 2864 6961 6429  tted peak (diad)
-0000c190: 2e0a 0a20 2020 2020 2020 2078 5f72 616e  ...        x_ran
-0000c1a0: 6765 5f62 6173 656c 696e 6520 2866 6c6f  ge_baseline (flo
-0000c1b0: 6174 293a 2044 6566 6175 6c74 2037 352e  at): Default 75.
-0000c1c0: 0a20 2020 2020 2020 2020 2020 204d 6561  .            Mea
-0000c1d0: 6e73 2074 6861 7420 7820 6178 6973 206f  ns that x axis o
-0000c1e0: 6620 6261 7365 6c69 6e65 2073 686f 7773  f baseline shows
-0000c1f0: 2064 6961 6420 706f 7369 7469 6f6e 202b   diad position +
-0000c200: 2d20 3735 2078 2075 6e69 7473 2e0a 0a20  - 75 x units... 
-0000c210: 2020 2020 2020 2079 5f72 616e 6765 5f62         y_range_b
-0000c220: 6173 656c 696e 6520 2866 6c6f 6174 293a  aseline (float):
-0000c230: 2059 2d61 7869 7320 7261 6e67 6520 666f   Y-axis range fo
-0000c240: 7220 6261 7365 6c69 6e65 2064 6973 706c  r baseline displ
-0000c250: 6179 2e20 4465 6661 756c 7420 3130 302e  ay. Default 100.
-0000c260: 0a20 2020 2020 2020 2020 2020 2053 686f  .            Sho
-0000c270: 7773 2061 2079 2061 7869 7320 7363 616c  ws a y axis scal
-0000c280: 6520 7468 6174 2069 7320 3130 3020 7920  e that is 100 y 
-0000c290: 756e 6974 7320 6162 6f76 6520 7468 6520  units above the 
-0000c2a0: 6d69 6e69 6d75 6d20 6261 7365 6c69 6e65  minimum baseline
-0000c2b0: 2076 616c 7565 2c20 616e 6420 3130 3020   value, and 100 
-0000c2c0: 756e 6974 7320 6162 6f76 6520 7468 6520  units above the 
-0000c2d0: 6d61 7869 6d75 6d20 7661 6c75 650a 0a20  maximum value.. 
-0000c2e0: 2020 2020 2020 2064 7069 2028 666c 6f61         dpi (floa
-0000c2f0: 7429 3a20 4465 6661 756c 7420 3230 300a  t): Default 200.
-0000c300: 2020 2020 2020 2020 2020 2020 4669 6775              Figu
-0000c310: 7265 2072 6573 6f6c 7574 696f 6e20 696e  re resolution in
-0000c320: 2064 6f74 7320 7065 7220 696e 6368 2e20   dots per inch. 
-0000c330: 4465 6661 756c 7420 3230 302e 0a0a 2020  Default 200...  
-0000c340: 2020 2020 2020 785f 7261 6e67 655f 7265        x_range_re
-0000c350: 7369 6475 616c 2028 666c 6f61 7429 3a20  sidual (float): 
-0000c360: 2044 6566 6175 6c74 2032 302e 0a20 2020   Default 20..   
-0000c370: 2020 2020 2020 2020 2053 686f 7773 2078           Shows x
-0000c380: 2076 616c 7565 7320 2b2d 3230 2065 6974   values +-20 eit
-0000c390: 6865 7220 7369 6465 206f 6620 7468 6520  her side of the 
-0000c3a0: 6469 6164 2070 6561 6b20 706f 7369 7469  diad peak positi
-0000c3b0: 6f6e 2069 6e20 7468 6520 7265 7369 6475  on in the residu
-0000c3c0: 616c 2070 6c6f 742e 0a0a 2020 2020 2020  al plot...      
-0000c3d0: 2020 7265 7475 726e 5f6f 7468 6572 5f70    return_other_p
-0000c3e0: 6172 616d 7320 2862 6f6f 6c29 3a20 5265  arams (bool): Re
-0000c3f0: 7475 726e 206e 6f6e 2d66 6974 7465 6420  turn non-fitted 
-0000c400: 7061 7261 6d65 7465 7273 2069 6620 5472  parameters if Tr
-0000c410: 7565 2e20 4465 6661 756c 7420 4661 6c73  ue. Default Fals
-0000c420: 652e 0a0a 2020 2020 4d65 7468 6f64 733a  e...    Methods:
-0000c430: 0a20 2020 2020 2020 2075 7064 6174 655f  .        update_
-0000c440: 7061 7228 2a2a 6b77 6172 6773 293a 0a20  par(**kwargs):. 
-0000c450: 2020 2020 2020 2020 2020 2055 7064 6174             Updat
-0000c460: 6573 2063 6f6e 6669 6775 7261 7469 6f6e  es configuration
-0000c470: 2070 6172 616d 6574 6572 732e 2052 6169   parameters. Rai
-0000c480: 7365 7320 4174 7472 6962 7574 6545 7272  ses AttributeErr
-0000c490: 6f72 2066 6f72 2075 6e6b 6e6f 776e 2061  or for unknown a
-0000c4a0: 7474 7269 6275 7465 732e 0a0a 2020 2020  ttributes...    
-0000c4b0: 2222 220a 2020 2020 2320 5768 6174 206d  """.    # What m
-0000c4c0: 6f64 656c 2074 6f20 7573 650a 2020 2020  odel to use.    
-0000c4d0: 6d6f 6465 6c5f 6e61 6d65 3a20 7374 7220  model_name: str 
-0000c4e0: 3d20 2750 7365 7564 6f56 6f69 6774 4d6f  = 'PseudoVoigtMo
-0000c4f0: 6465 6c27 0a20 2020 2066 6974 5f70 6561  del'.    fit_pea
-0000c500: 6b73 3a69 6e74 203d 2032 0a0a 2020 2020  ks:int = 2..    
-0000c510: 2320 4465 6772 6565 206f 6620 706f 6c79  # Degree of poly
-0000c520: 6e6f 6d69 616c 2074 6f20 7573 650a 2020  nomial to use.  
-0000c530: 2020 4e5f 706f 6c79 5f62 636b 5f64 6961    N_poly_bck_dia
-0000c540: 6431 3a20 666c 6f61 7420 3d31 0a0a 2020  d1: float =1..  
-0000c550: 2020 2320 4261 636b 6772 6f75 6e64 2f62    # Background/b
-0000c560: 6173 656c 696e 6520 706f 7369 7469 6f6e  aseline position
-0000c570: 730a 2020 2020 6c6f 7765 725f 6263 6b5f  s.    lower_bck_
-0000c580: 6469 6164 313a 2054 7570 6c65 5b66 6c6f  diad1: Tuple[flo
-0000c590: 6174 2c20 666c 6f61 745d 3d28 3131 3830  at, float]=(1180
-0000c5a0: 2c20 3132 3230 290a 2020 2020 7570 7065  , 1220).    uppe
-0000c5b0: 725f 6263 6b5f 6469 6164 313a 2054 7570  r_bck_diad1: Tup
-0000c5c0: 6c65 5b66 6c6f 6174 2c20 666c 6f61 745d  le[float, float]
-0000c5d0: 3d28 3133 3030 2c20 3133 3530 290a 0a20  =(1300, 1350).. 
-0000c5e0: 2020 2023 2044 6f20 796f 7520 6e65 6564     # Do you need
-0000c5f0: 2061 2067 6175 7373 6961 6e3f 2053 6574   a gaussian? Set
-0000c600: 2070 6f73 6974 696f 6e20 6865 7265 2069   position here i
-0000c610: 6620 736f 0a20 2020 2066 6974 5f67 6175  f so.    fit_gau
-0000c620: 7373 3a20 4f70 7469 6f6e 616c 205b 626f  ss: Optional [bo
-0000c630: 6f6c 5d20 3d46 616c 7365 0a20 2020 2067  ol] =False.    g
-0000c640: 6175 7373 5f61 6d70 3a20 4f70 7469 6f6e  auss_amp: Option
-0000c650: 616c 205b 666c 6f61 745d 3d31 3030 300a  al [float]=1000.
-0000c660: 0a20 2020 2064 6961 645f 7369 676d 613a  .    diad_sigma:
-0000c670: 2066 6c6f 6174 3d30 2e32 0a20 2020 2064   float=0.2.    d
-0000c680: 6961 645f 7369 676d 615f 6d69 6e5f 616c  iad_sigma_min_al
-0000c690: 6c6f 7761 6e63 653a 2066 6c6f 6174 3d30  lowance: float=0
-0000c6a0: 2e32 0a20 2020 2064 6961 645f 7369 676d  .2.    diad_sigm
-0000c6b0: 615f 6d61 785f 616c 6c6f 7761 6e63 653a  a_max_allowance:
-0000c6c0: 2066 6c6f 6174 3d35 0a0a 0a0a 0a20 2020   float=5.....   
-0000c6d0: 2023 2050 6561 6b20 616d 706c 6974 7564   # Peak amplitud
-0000c6e0: 650a 2020 2020 6469 6164 5f70 726f 6d3a  e.    diad_prom:
-0000c6f0: 2066 6c6f 6174 203d 2031 3030 0a20 2020   float = 100.   
-0000c700: 2048 425f 7072 6f6d 3a20 666c 6f61 7420   HB_prom: float 
-0000c710: 3d20 3230 0a20 2020 2048 425f 7369 676d  = 20.    HB_sigm
-0000c720: 615f 6d69 6e5f 616c 6c6f 7761 6e63 653d  a_min_allowance=
-0000c730: 302e 3035 0a20 2020 2048 425f 7369 676d  0.05.    HB_sigm
-0000c740: 615f 6d61 785f 616c 6c6f 7761 6e63 653d  a_max_allowance=
-0000c750: 330a 2020 2020 4842 5f61 6d70 5f6d 696e  3.    HB_amp_min
-0000c760: 5f61 6c6c 6f77 616e 6365 3d30 2e30 310a  _allowance=0.01.
-0000c770: 2020 2020 4842 5f61 6d70 5f6d 6178 5f61      HB_amp_max_a
-0000c780: 6c6c 6f77 616e 6365 3d31 0a20 2020 2023  llowance=1.    #
-0000c790: 2048 6f77 206d 7563 6820 746f 2073 686f   How much to sho
-0000c7a0: 7720 6f6e 2078 2061 6e78 2079 2061 7869  w on x anx y axi
-0000c7b0: 7320 6f66 2066 6967 7572 6520 7368 6f77  s of figure show
-0000c7c0: 696e 6720 6261 636b 6772 6f75 6e64 0a20  ing background. 
-0000c7d0: 2020 2078 5f72 616e 6765 5f62 6173 656c     x_range_basel
-0000c7e0: 696e 653a 2066 6c6f 6174 3d37 350a 2020  ine: float=75.  
-0000c7f0: 2020 795f 7261 6e67 655f 6261 7365 6c69    y_range_baseli
-0000c800: 6e65 3a20 666c 6f61 743d 3130 300a 0a20  ne: float=100.. 
-0000c810: 2020 2023 446f 2079 6f75 2077 616e 7420     #Do you want 
-0000c820: 746f 2073 6176 6520 7468 6520 6669 6775  to save the figu
-0000c830: 7265 3f0a 0a0a 2020 2020 6470 693a 2066  re?...    dpi: f
-0000c840: 6c6f 6174 203d 2032 3030 0a20 2020 2078  loat = 200.    x
-0000c850: 5f72 616e 6765 5f72 6573 6964 7561 6c3a  _range_residual:
-0000c860: 2066 6c6f 6174 3d32 300a 0a20 2020 2023   float=20..    #
-0000c870: 2044 6f20 796f 7520 7761 6e74 2074 6f20   Do you want to 
-0000c880: 7265 7475 726e 206f 7468 6572 2070 6172  return other par
-0000c890: 616d 6574 6572 733f 0a20 2020 2072 6574  ameters?.    ret
-0000c8a0: 7572 6e5f 6f74 6865 725f 7061 7261 6d73  urn_other_params
-0000c8b0: 3a20 626f 6f6c 203d 4661 6c73 650a 0a20  : bool =False.. 
-0000c8c0: 2020 2064 6566 2075 7064 6174 655f 7061     def update_pa
-0000c8d0: 7228 7365 6c66 2c20 2a2a 6b77 6172 6773  r(self, **kwargs
-0000c8e0: 293a 0a20 2020 2020 2020 2066 6f72 206b  ):.        for k
-0000c8f0: 6579 2c20 7661 6c75 6520 696e 206b 7761  ey, value in kwa
-0000c900: 7267 732e 6974 656d 7328 293a 0a20 2020  rgs.items():.   
-0000c910: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
-0000c920: 7474 7228 7365 6c66 2c20 6b65 7929 3a0a  ttr(self, key):.
-0000c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c940: 7365 7461 7474 7228 7365 6c66 2c20 6b65  setattr(self, ke
-0000c950: 792c 2076 616c 7565 290a 2020 2020 2020  y, value).      
-0000c960: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000c970: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000c980: 6520 4174 7472 6962 7574 6545 7272 6f72  e AttributeError
-0000c990: 2866 2227 6469 6164 315f 6669 745f 636f  (f"'diad1_fit_co
-0000c9a0: 6e66 6967 2720 6f62 6a65 6374 2068 6173  nfig' object has
-0000c9b0: 206e 6f20 6174 7472 6962 7574 6520 277b   no attribute '{
-0000c9c0: 6b65 797d 2722 290a 0a0a 0a0a 4064 6174  key}'").....@dat
-0000c9d0: 6163 6c61 7373 0a63 6c61 7373 2064 6961  aclass.class dia
-0000c9e0: 6432 5f66 6974 5f63 6f6e 6669 673a 0a0a  d2_fit_config:..
-0000c9f0: 2020 2020 2222 220a 2020 2020 436f 6e66      """.    Conf
-0000ca00: 6967 7572 6174 696f 6e20 636c 6173 7320  iguration class 
-0000ca10: 666f 7220 6669 7474 696e 6720 4469 6164  for fitting Diad
-0000ca20: 2032 0a0a 2020 2020 5468 6973 2063 6c61   2..    This cla
-0000ca30: 7373 2073 746f 7265 7320 636f 6e66 6967  ss stores config
-0000ca40: 7572 6174 696f 6e20 7061 7261 6d65 7465  uration paramete
-0000ca50: 7273 2066 6f72 2066 6974 7469 6e67 2044  rs for fitting D
-0000ca60: 6961 6420 3220 616e 6420 6173 736f 6369  iad 2 and associ
-0000ca70: 6174 6564 2070 6561 6b73 2e0a 2020 2020  ated peaks..    
-0000ca80: 5468 6520 636c 6173 7320 616c 6c6f 7773  The class allows
-0000ca90: 2066 6f72 2065 6173 7920 6375 7374 6f6d   for easy custom
-0000caa0: 697a 6174 696f 6e20 6f66 2074 6865 2066  ization of the f
-0000cab0: 6974 7469 6e67 2070 726f 6365 7373 2e0a  itting process..
-0000cac0: 0a20 2020 2041 7474 7269 6275 7465 733a  .    Attributes:
-0000cad0: 0a20 2020 2020 2020 206d 6f64 656c 5f6e  .        model_n
-0000cae0: 616d 6520 2873 7472 293a 2044 6566 6175  ame (str): Defau
-0000caf0: 6c74 2027 5073 6575 646f 566f 6967 744d  lt 'PseudoVoigtM
-0000cb00: 6f64 656c 272e 0a20 2020 2020 2020 2020  odel'..         
-0000cb10: 2020 204d 6f64 656c 206e 616d 6520 666f     Model name fo
-0000cb20: 7220 7065 616b 2066 6974 7469 6e67 2e20  r peak fitting. 
-0000cb30: 4368 6f6f 7365 2066 726f 6d0a 2020 2020  Choose from.    
-0000cb40: 2020 2020 2020 2020 2750 7365 7564 6f56          'PseudoV
-0000cb50: 6f69 6774 4d6f 6465 6c27 2c20 2756 6f69  oigtModel', 'Voi
-0000cb60: 6774 4d6f 6465 6c27 2c20 2747 6175 7373  gtModel', 'Gauss
-0000cb70: 6961 6e4d 6f64 656c 272c 2027 4c6f 7265  ianModel', 'Lore
-0000cb80: 6e74 7a69 616e 4d6f 6465 6c27 2c20 6574  ntzianModel', et
-0000cb90: 632e 0a0a 2020 2020 2020 2020 6669 745f  c...        fit_
-0000cba0: 7065 616b 7320 2869 6e74 293a 2044 6566  peaks (int): Def
-0000cbb0: 6175 6c74 2032 0a20 2020 2020 2020 2020  ault 2.         
-0000cbc0: 2020 204e 756d 6265 7220 6f66 2070 6561     Number of pea
-0000cbd0: 6b73 2074 6f20 6669 742e 2033 203d 2048  ks to fit. 3 = H
-0000cbe0: 4220 2b20 4469 6164 202b 2043 3133 2c20  B + Diad + C13, 
-0000cbf0: 3220 3d20 4469 6164 202b 2048 422c 2031  2 = Diad + HB, 1
-0000cc00: 203d 2044 6961 642e 0a0a 2020 2020 2020   = Diad...      
-0000cc10: 2020 4e5f 706f 6c79 5f62 636b 5f64 6961    N_poly_bck_dia
-0000cc20: 6432 2028 666c 6f61 7429 3a20 4465 6661  d2 (float): Defa
-0000cc30: 756c 7420 3d20 310a 2020 2020 2020 2020  ult = 1.        
-0000cc40: 2020 2020 4465 6772 6565 206f 6620 706f      Degree of po
-0000cc50: 6c79 6e6f 6d69 616c 2066 6f72 2062 6163  lynomial for bac
-0000cc60: 6b67 726f 756e 6420 7375 6274 7261 6374  kground subtract
-0000cc70: 696f 6e2e 2044 6566 6175 6c74 2031 2e0a  ion. Default 1..
-0000cc80: 0a20 2020 2020 2020 206c 6f77 6572 5f62  .        lower_b
-0000cc90: 636b 5f64 6961 6432 2028 5475 706c 655b  ck_diad2 (Tuple[
-0000cca0: 666c 6f61 742c 2066 6c6f 6174 5d29 3a0a  float, float]):.
-0000ccb0: 2020 2020 2020 2020 2020 2020 4c6f 7765              Lowe
-0000ccc0: 7220 626f 756e 6461 7279 2066 6f72 2062  r boundary for b
-0000ccd0: 6163 6b67 726f 756e 6420 6669 7474 696e  ackground fittin
-0000cce0: 6720 696e 2063 6d2d 312e 2044 6566 6175  g in cm-1. Defau
-0000ccf0: 6c74 2028 3133 3030 2c20 3133 3630 290a  lt (1300, 1360).
-0000cd00: 0a20 2020 2020 2020 2075 7070 6572 5f62  .        upper_b
-0000cd10: 636b 5f64 6961 6432 2028 5475 706c 655b  ck_diad2 (Tuple[
-0000cd20: 666c 6f61 742c 2066 6c6f 6174 5d29 3a0a  float, float]):.
-0000cd30: 2020 2020 2020 2020 2020 2020 5570 7065              Uppe
-0000cd40: 7220 626f 756e 6461 7279 2066 6f72 2062  r boundary for b
-0000cd50: 6163 6b67 726f 756e 6420 6669 7474 696e  ackground fittin
-0000cd60: 6720 696e 2063 6d2d 3120 4465 6661 756c  g in cm-1 Defaul
-0000cd70: 7420 2831 3434 302c 2031 3437 3029 0a0a  t (1440, 1470)..
-0000cd80: 2020 2020 2020 2020 6669 745f 6761 7573          fit_gaus
-0000cd90: 7320 284f 7074 696f 6e61 6c5b 626f 6f6c  s (Optional[bool
-0000cda0: 5d29 3a20 4465 6661 756c 7420 5472 7565  ]): Default True
-0000cdb0: 0a20 2020 2020 2020 2020 2020 2046 6974  .            Fit
-0000cdc0: 2061 2047 6175 7373 6961 6e20 7065 616b   a Gaussian peak
-0000cdd0: 2069 6620 5472 7565 2e20 4865 6c70 6675   if True. Helpfu
-0000cde0: 6c20 666f 7220 7665 7279 2065 6c65 7661  l for very eleva
-0000cdf0: 7465 6420 7370 6563 7472 610a 0a20 2020  ted spectra..   
-0000ce00: 2020 2020 2067 6175 7373 5f61 6d70 2028       gauss_amp (
-0000ce10: 4f70 7469 6f6e 616c 5b66 6c6f 6174 5d29  Optional[float])
-0000ce20: 3a20 2044 6566 6175 6c74 203d 2031 3030  :  Default = 100
-0000ce30: 300a 2020 2020 2020 2020 2020 2020 4761  0.            Ga
-0000ce40: 7573 7369 616e 2070 6561 6b20 616d 706c  ussian peak ampl
-0000ce50: 6974 7564 6520 6966 2060 6669 745f 6761  itude if `fit_ga
-0000ce60: 7573 7360 2069 7320 5472 7565 2e20 4465  uss` is True. De
-0000ce70: 6661 756c 7420 3130 3030 2e0a 2020 2020  fault 1000..    
-0000ce80: 2020 2020 2020 2020 5765 2066 696e 6420          We find 
-0000ce90: 3258 2048 4220 696e 7465 6e73 6974 7920  2X HB intensity 
-0000cea0: 6973 2061 2067 6f6f 6420 6775 6573 7320  is a good guess 
-0000ceb0: 6f6e 206d 616e 7920 696e 7374 7275 6d65  on many instrume
-0000cec0: 6e74 730a 0a20 2020 2020 2020 2064 6961  nts..        dia
-0000ced0: 645f 7369 676d 6120 2866 6c6f 6174 293a  d_sigma (float):
-0000cee0: 2044 6566 6175 6c74 203d 2030 2e32 0a20   Default = 0.2. 
-0000cef0: 2020 2020 2020 2020 2020 2053 6967 6d61             Sigma
-0000cf00: 206f 6620 6469 6164 2070 6561 6b2e 0a0a   of diad peak...
-0000cf10: 2020 2020 2020 2020 6469 6164 5f73 6967          diad_sig
-0000cf20: 6d61 5f6d 696e 5f61 6c6c 6f77 616e 6365  ma_min_allowance
-0000cf30: 2028 666c 6f61 7429 3a20 4465 6661 756c   (float): Defaul
-0000cf40: 7420 3d20 302e 320a 2020 2020 2020 2020  t = 0.2.        
-0000cf50: 2020 2020 546f 6c65 7261 6e63 6520 6f6e      Tolerance on
-0000cf60: 2065 6e74 6572 6564 2073 6967 6d61 2e20   entered sigma. 
-0000cf70: 4d65 616e 7320 6d69 6e69 6d75 6d20 616c  Means minimum al
-0000cf80: 6c6f 7765 6420 7369 676d 6120 6973 2030  lowed sigma is 0
-0000cf90: 2e32 2a73 6967 6d61 0a0a 2020 2020 2020  .2*sigma..      
-0000cfa0: 2020 6469 6164 5f73 6967 6d61 5f6d 6178    diad_sigma_max
-0000cfb0: 5f61 6c6c 6f77 616e 6365 2028 666c 6f61  _allowance (floa
-0000cfc0: 7429 3a20 4465 6661 756c 7420 3d20 350a  t): Default = 5.
-0000cfd0: 2020 2020 2020 2020 2020 2020 546f 6c65              Tole
-0000cfe0: 7261 6e63 6520 6f6e 2065 6e74 6572 6564  rance on entered
-0000cff0: 2073 6967 6d61 2e20 4d65 616e 7320 6d69   sigma. Means mi
-0000d000: 6e69 6d75 6d20 616c 6c6f 7765 6420 7369  nimum allowed si
-0000d010: 676d 6120 6973 2035 2a73 6967 6d61 0a0a  gma is 5*sigma..
-0000d020: 0a20 2020 2020 2020 2064 6961 645f 7072  .        diad_pr
-0000d030: 6f6d 2028 666c 6f61 7429 3a20 4465 6661  om (float): Defa
-0000d040: 756c 7420 3d20 3130 300a 2020 2020 2020  ult = 100.      
-0000d050: 2020 2020 2020 5065 616b 2061 6d70 6c69        Peak ampli
-0000d060: 7475 6465 2066 6f72 206f 6620 7468 6520  tude for of the 
-0000d070: 6469 6164 2e20 5375 6767 6573 7420 7573  diad. Suggest us
-0000d080: 6572 7320 6f62 7461 696e 2066 726f 6d20  ers obtain from 
-0000d090: 7468 6520 6573 7469 6d61 7465 6420 7065  the estimated pe
-0000d0a0: 616b 2070 6172 616d 6574 6572 2064 6174  ak parameter dat
-0000d0b0: 6166 7261 6d65 0a0a 2020 2020 2020 2020  aframe..        
-0000d0c0: 4842 5f70 726f 6d20 2866 6c6f 6174 293a  HB_prom (float):
-0000d0d0: 2020 4465 6661 756c 7420 3d20 3230 0a20    Default = 20. 
-0000d0e0: 2020 2020 2020 2020 2020 2050 6561 6b20             Peak 
-0000d0f0: 616d 706c 6974 7564 6520 666f 7220 4842  amplitude for HB
-0000d100: 2e20 5375 6767 6573 7420 7573 6572 7320  . Suggest users 
-0000d110: 6f62 7461 696e 2066 726f 6d20 7468 6520  obtain from the 
-0000d120: 6573 7469 6d61 7465 6420 7065 616b 2070  estimated peak p
-0000d130: 6172 616d 6574 6572 2064 6174 6166 7261  arameter datafra
-0000d140: 6d65 0a0a 2020 2020 2020 2020 4331 335f  me..        C13_
-0000d150: 7072 6f6d 2028 666c 6f61 7429 3a20 2044  prom (float):  D
-0000d160: 6566 6175 6c74 203d 2031 300a 2020 2020  efault = 10.    
-0000d170: 2020 2020 2020 2020 5065 616b 2061 6d70          Peak amp
-0000d180: 6c69 7475 6465 2066 6f72 2043 3133 2e20  litude for C13. 
-0000d190: 5375 6767 6573 7420 7573 6572 7320 6f62  Suggest users ob
-0000d1a0: 7461 696e 2066 726f 6d20 7468 6520 6573  tain from the es
-0000d1b0: 7469 6d61 7465 6420 7065 616b 2070 6172  timated peak par
-0000d1c0: 616d 6574 6572 2064 6174 6166 7261 6d65  ameter dataframe
-0000d1d0: 0a0a 2020 2020 2020 2020 4842 5f73 6967  ..        HB_sig
-0000d1e0: 6d61 5f6d 696e 5f61 6c6c 6f77 616e 6365  ma_min_allowance
-0000d1f0: 2028 666c 6f61 7429 3a20 4465 6661 756c   (float): Defaul
-0000d200: 7420 3d20 302e 3035 0a20 2020 2020 2020  t = 0.05.       
-0000d210: 2020 2020 204d 6561 6e73 2048 4220 7369       Means HB si
-0000d220: 676d 6120 6361 6e74 2062 6520 6c65 7373  gma cant be less
-0000d230: 2074 6861 6e20 302e 3035 2a20 7369 676d   than 0.05* sigm
-0000d240: 6120 6f66 2066 6972 7374 2066 6974 7469  a of first fitti
-0000d250: 6e67 2070 6561 6b20 2864 6961 6429 2e0a  ng peak (diad)..
-0000d260: 0a20 2020 2020 2020 2048 425f 7369 676d  .        HB_sigm
-0000d270: 615f 6d61 785f 616c 6c6f 7761 6e63 6520  a_max_allowance 
-0000d280: 2866 6c6f 6174 293a 2044 6566 6175 6c74  (float): Default
-0000d290: 203d 2033 3a0a 2020 2020 2020 2020 2020   = 3:.          
-0000d2a0: 2020 4d65 616e 7320 4842 2073 6967 6d61    Means HB sigma
-0000d2b0: 2063 616e 7420 6578 6365 6564 2033 2a20   cant exceed 3* 
-0000d2c0: 7369 676d 6120 6f66 2066 6972 7374 2066  sigma of first f
-0000d2d0: 6974 7469 6e67 2070 6561 6b20 2864 6961  itting peak (dia
-0000d2e0: 6429 0a0a 2020 2020 2020 2020 4842 5f61  d)..        HB_a
-0000d2f0: 6d70 5f6d 696e 5f61 6c6c 6f77 616e 6365  mp_min_allowance
-0000d300: 2028 666c 6f61 7429 3a20 4465 6661 756c   (float): Defaul
-0000d310: 7420 3d30 2e30 310a 2020 2020 2020 2020  t =0.01.        
-0000d320: 2020 2020 4d65 616e 7320 4842 2061 6d70      Means HB amp
-0000d330: 6c69 7475 6465 2063 616e 7420 6265 206c  litude cant be l
-0000d340: 6573 7320 7468 616e 2030 2e30 312a 616d  ess than 0.01*am
-0000d350: 706c 6974 7564 6520 6f66 2066 6972 7374  plitude of first
-0000d360: 2066 6974 7465 6420 7065 616b 2028 6469   fitted peak (di
-0000d370: 6164 292e 0a0a 2020 2020 2020 2020 4842  ad)...        HB
-0000d380: 5f61 6d70 5f6d 6178 5f61 6c6c 6f77 616e  _amp_max_allowan
-0000d390: 6365 2028 666c 6f61 7429 3a20 4465 6661  ce (float): Defa
-0000d3a0: 756c 7420 3d20 310a 2020 2020 2020 2020  ult = 1.        
-0000d3b0: 2020 2020 4d65 616e 7320 4842 2061 6d70      Means HB amp
-0000d3c0: 6c69 7475 6465 2063 616e 7420 6265 206d  litude cant be m
-0000d3d0: 6f72 6520 7468 616e 2031 2a61 6d70 6c69  ore than 1*ampli
-0000d3e0: 7475 6465 206f 6620 6669 7273 7420 6669  tude of first fi
-0000d3f0: 7474 6564 2070 6561 6b20 2864 6961 6429  tted peak (diad)
-0000d400: 2e0a 0a20 2020 2020 2020 2078 5f72 616e  ...        x_ran
-0000d410: 6765 5f62 6173 656c 696e 6520 2866 6c6f  ge_baseline (flo
-0000d420: 6174 293a 2044 6566 6175 6c74 2037 352e  at): Default 75.
-0000d430: 0a20 2020 2020 2020 2020 2020 204d 6561  .            Mea
-0000d440: 6e73 2074 6861 7420 7820 6178 6973 206f  ns that x axis o
-0000d450: 6620 6261 7365 6c69 6e65 2073 686f 7773  f baseline shows
-0000d460: 2064 6961 6420 706f 7369 7469 6f6e 202b   diad position +
-0000d470: 2d20 3735 2078 2075 6e69 7473 2e0a 0a20  - 75 x units... 
-0000d480: 2020 2020 2020 2079 5f72 616e 6765 5f62         y_range_b
-0000d490: 6173 656c 696e 6520 2866 6c6f 6174 293a  aseline (float):
-0000d4a0: 2059 2d61 7869 7320 7261 6e67 6520 666f   Y-axis range fo
-0000d4b0: 7220 6261 7365 6c69 6e65 2064 6973 706c  r baseline displ
-0000d4c0: 6179 2e20 4465 6661 756c 7420 3130 302e  ay. Default 100.
-0000d4d0: 0a20 2020 2020 2020 2020 2020 2053 686f  .            Sho
-0000d4e0: 7773 2061 2079 2061 7869 7320 7363 616c  ws a y axis scal
-0000d4f0: 6520 7468 6174 2069 7320 3130 3020 7920  e that is 100 y 
-0000d500: 756e 6974 7320 6162 6f76 6520 7468 6520  units above the 
-0000d510: 6d69 6e69 6d75 6d20 6261 7365 6c69 6e65  minimum baseline
-0000d520: 2076 616c 7565 2c20 616e 6420 3130 3020   value, and 100 
-0000d530: 756e 6974 7320 6162 6f76 6520 7468 6520  units above the 
-0000d540: 6d61 7869 6d75 6d20 7661 6c75 650a 0a20  maximum value.. 
-0000d550: 2020 2020 2020 2064 7069 2028 666c 6f61         dpi (floa
-0000d560: 7429 3a20 4465 6661 756c 7420 3230 300a  t): Default 200.
-0000d570: 2020 2020 2020 2020 2020 2020 4669 6775              Figu
-0000d580: 7265 2072 6573 6f6c 7574 696f 6e20 696e  re resolution in
-0000d590: 2064 6f74 7320 7065 7220 696e 6368 2e20   dots per inch. 
-0000d5a0: 4465 6661 756c 7420 3230 302e 0a0a 2020  Default 200...  
-0000d5b0: 2020 2020 2020 785f 7261 6e67 655f 7265        x_range_re
-0000d5c0: 7369 6475 616c 2028 666c 6f61 7429 3a20  sidual (float): 
-0000d5d0: 2044 6566 6175 6c74 2032 302e 0a20 2020   Default 20..   
-0000d5e0: 2020 2020 2020 2020 2053 686f 7773 2078           Shows x
-0000d5f0: 2076 616c 7565 7320 2b2d 3230 2065 6974   values +-20 eit
-0000d600: 6865 7220 7369 6465 206f 6620 7468 6520  her side of the 
-0000d610: 6469 6164 2070 6561 6b20 706f 7369 7469  diad peak positi
-0000d620: 6f6e 2069 6e20 7468 6520 7265 7369 6475  on in the residu
-0000d630: 616c 2070 6c6f 742e 0a0a 2020 2020 2020  al plot...      
-0000d640: 2020 7265 7475 726e 5f6f 7468 6572 5f70    return_other_p
-0000d650: 6172 616d 7320 2862 6f6f 6c29 3a20 5265  arams (bool): Re
-0000d660: 7475 726e 206e 6f6e 2d66 6974 7465 6420  turn non-fitted 
-0000d670: 7061 7261 6d65 7465 7273 2069 6620 5472  parameters if Tr
-0000d680: 7565 2e20 4465 6661 756c 7420 4661 6c73  ue. Default Fals
-0000d690: 652e 0a0a 2020 2020 4d65 7468 6f64 733a  e...    Methods:
-0000d6a0: 0a20 2020 2020 2020 2075 7064 6174 655f  .        update_
-0000d6b0: 7061 7228 2a2a 6b77 6172 6773 293a 0a20  par(**kwargs):. 
-0000d6c0: 2020 2020 2020 2020 2020 2055 7064 6174             Updat
-0000d6d0: 6573 2063 6f6e 6669 6775 7261 7469 6f6e  es configuration
-0000d6e0: 2070 6172 616d 6574 6572 732e 2052 6169   parameters. Rai
-0000d6f0: 7365 7320 4174 7472 6962 7574 6545 7272  ses AttributeErr
-0000d700: 6f72 2066 6f72 2075 6e6b 6e6f 776e 2061  or for unknown a
-0000d710: 7474 7269 6275 7465 732e 0a0a 2020 2020  ttributes...    
-0000d720: 2222 220a 0a20 2020 2023 2044 6f20 796f  """..    # Do yo
-0000d730: 7520 6e65 6564 2061 2067 6175 7373 6961  u need a gaussia
-0000d740: 6e3f 2053 6574 2070 6f73 6974 696f 6e20  n? Set position 
-0000d750: 6865 7265 2069 6620 736f 0a0a 2020 2020  here if so..    
-0000d760: 2320 5768 6174 206d 6f64 656c 2074 6f20  # What model to 
-0000d770: 7573 650a 2020 2020 6d6f 6465 6c5f 6e61  use.    model_na
-0000d780: 6d65 3a20 7374 7220 3d20 2750 7365 7564  me: str = 'Pseud
-0000d790: 6f56 6f69 6774 4d6f 6465 6c27 0a20 2020  oVoigtModel'.   
-0000d7a0: 2066 6974 5f70 6561 6b73 3a69 6e74 203d   fit_peaks:int =
-0000d7b0: 2033 0a0a 2020 2020 2320 4465 6772 6565   3..    # Degree
-0000d7c0: 206f 6620 706f 6c79 6e6f 6d69 616c 2074   of polynomial t
-0000d7d0: 6f20 7573 650a 2020 2020 4e5f 706f 6c79  o use.    N_poly
-0000d7e0: 5f62 636b 5f64 6961 6432 3a20 666c 6f61  _bck_diad2: floa
-0000d7f0: 7420 3d31 0a20 2020 2023 2054 6872 6573  t =1.    # Thres
-0000d800: 686f 6c64 2069 6e74 6573 6e69 7479 0a20  hold intesnity. 
-0000d810: 2020 2074 6872 6573 686f 6c64 5f69 6e74     threshold_int
-0000d820: 656e 7369 7479 3d35 300a 0a20 2020 2023  ensity=50..    #
-0000d830: 2042 6163 6b67 726f 756e 642f 6261 7365   Background/base
-0000d840: 6c69 6e65 2070 6f73 6974 696f 6e73 0a20  line positions. 
-0000d850: 2020 206c 6f77 6572 5f62 636b 5f64 6961     lower_bck_dia
-0000d860: 6432 3a20 5475 706c 655b 666c 6f61 742c  d2: Tuple[float,
-0000d870: 2066 6c6f 6174 5d3d 2831 3330 302c 2031   float]=(1300, 1
-0000d880: 3336 3029 0a20 2020 2075 7070 6572 5f62  360).    upper_b
-0000d890: 636b 5f64 6961 6432 3a20 5475 706c 655b  ck_diad2: Tuple[
-0000d8a0: 666c 6f61 742c 2066 6c6f 6174 5d3d 2831  float, float]=(1
-0000d8b0: 3434 302c 2031 3437 3029 0a0a 0a20 2020  440, 1470)...   
-0000d8c0: 2066 6974 5f67 6175 7373 3a20 4f70 7469   fit_gauss: Opti
-0000d8d0: 6f6e 616c 205b 626f 6f6c 5d20 3d46 616c  onal [bool] =Fal
-0000d8e0: 7365 0a20 2020 2067 6175 7373 5f61 6d70  se.    gauss_amp
-0000d8f0: 3a20 4f70 7469 6f6e 616c 205b 666c 6f61  : Optional [floa
-0000d900: 745d 3d31 3030 300a 0a20 2020 2064 6961  t]=1000..    dia
-0000d910: 645f 7369 676d 613a 2066 6c6f 6174 3d30  d_sigma: float=0
-0000d920: 2e32 0a20 2020 2064 6961 645f 7369 676d  .2.    diad_sigm
-0000d930: 615f 6d69 6e5f 616c 6c6f 7761 6e63 653a  a_min_allowance:
-0000d940: 2066 6c6f 6174 3d30 2e32 0a20 2020 2064   float=0.2.    d
-0000d950: 6961 645f 7369 676d 615f 6d61 785f 616c  iad_sigma_max_al
-0000d960: 6c6f 7761 6e63 653a 2066 6c6f 6174 3d35  lowance: float=5
-0000d970: 0a0a 0a20 2020 2023 2050 6561 6b20 616d  ...    # Peak am
-0000d980: 706c 6974 7564 650a 2020 2020 6469 6164  plitude.    diad
-0000d990: 5f70 726f 6d3a 2066 6c6f 6174 203d 2031  _prom: float = 1
-0000d9a0: 3030 0a20 2020 2048 425f 7072 6f6d 3a20  00.    HB_prom: 
-0000d9b0: 666c 6f61 7420 3d20 3230 0a20 2020 2043  float = 20.    C
-0000d9c0: 3133 5f70 726f 6d3a 2066 6c6f 6174 3d31  13_prom: float=1
-0000d9d0: 300a 2020 2020 4842 5f73 6967 6d61 5f6d  0.    HB_sigma_m
-0000d9e0: 696e 5f61 6c6c 6f77 616e 6365 3d30 2e30  in_allowance=0.0
-0000d9f0: 350a 2020 2020 4842 5f73 6967 6d61 5f6d  5.    HB_sigma_m
-0000da00: 6178 5f61 6c6c 6f77 616e 6365 3d33 0a20  ax_allowance=3. 
-0000da10: 2020 2048 425f 616d 705f 6d69 6e5f 616c     HB_amp_min_al
-0000da20: 6c6f 7761 6e63 653d 302e 3031 0a20 2020  lowance=0.01.   
-0000da30: 2048 425f 616d 705f 6d61 785f 616c 6c6f   HB_amp_max_allo
-0000da40: 7761 6e63 653d 310a 2020 2020 2320 486f  wance=1.    # Ho
-0000da50: 7720 6d75 6368 2074 6f20 7368 6f77 206f  w much to show o
-0000da60: 6e20 7820 616e 7820 7920 6178 6973 206f  n x anx y axis o
-0000da70: 6620 6669 6775 7265 2073 686f 7769 6e67  f figure showing
-0000da80: 2062 6163 6b67 726f 756e 6420 7769 7468   background with
-0000da90: 2061 6c6c 2070 6561 6b73 2069 6d70 6f73   all peaks impos
-0000daa0: 6564 0a20 2020 2078 5f72 616e 6765 5f62  ed.    x_range_b
-0000dab0: 6173 656c 696e 653a 2066 6c6f 6174 3d37  aseline: float=7
-0000dac0: 350a 2020 2020 795f 7261 6e67 655f 6261  5.    y_range_ba
-0000dad0: 7365 6c69 6e65 3a20 666c 6f61 743d 3130  seline: float=10
-0000dae0: 300a 0a20 2020 2023 446f 2079 6f75 2077  0..    #Do you w
-0000daf0: 616e 7420 746f 2073 6176 6520 7468 6520  ant to save the 
-0000db00: 6669 6775 7265 3f0a 2020 2020 706c 6f74  figure?.    plot
-0000db10: 5f66 6967 7572 653a 2062 6f6f 6c20 3d20  _figure: bool = 
-0000db20: 5472 7565 0a20 2020 2064 7069 3a20 666c  True.    dpi: fl
-0000db30: 6f61 7420 3d20 3230 300a 2020 2020 785f  oat = 200.    x_
-0000db40: 7261 6e67 655f 7265 7369 6475 616c 3a20  range_residual: 
-0000db50: 666c 6f61 743d 3230 0a0a 2020 2020 2320  float=20..    # 
-0000db60: 446f 2079 6f75 2077 616e 7420 746f 2072  Do you want to r
-0000db70: 6574 7572 6e20 6f74 6865 7220 7061 7261  eturn other para
-0000db80: 6d65 7465 7273 3f0a 2020 2020 7265 7475  meters?.    retu
-0000db90: 726e 5f6f 7468 6572 5f70 6172 616d 733a  rn_other_params:
-0000dba0: 2062 6f6f 6c20 3d46 616c 7365 0a0a 0a0a   bool =False....
-0000dbb0: 2020 2020 6465 6620 7570 6461 7465 5f70      def update_p
-0000dbc0: 6172 2873 656c 662c 202a 2a6b 7761 7267  ar(self, **kwarg
-0000dbd0: 7329 3a0a 2020 2020 2020 2020 666f 7220  s):.        for 
-0000dbe0: 6b65 792c 2076 616c 7565 2069 6e20 6b77  key, value in kw
-0000dbf0: 6172 6773 2e69 7465 6d73 2829 3a0a 2020  args.items():.  
-0000dc00: 2020 2020 2020 2020 2020 6966 2068 6173            if has
-0000dc10: 6174 7472 2873 656c 662c 206b 6579 293a  attr(self, key):
-0000dc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dc30: 2073 6574 6174 7472 2873 656c 662c 206b   setattr(self, k
-0000dc40: 6579 2c20 7661 6c75 6529 0a20 2020 2020  ey, value).     
-0000dc50: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000dc60: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000dc70: 7365 2041 7474 7269 6275 7465 4572 726f  se AttributeErro
-0000dc80: 7228 6622 2764 6961 6432 5f66 6974 5f63  r(f"'diad2_fit_c
-0000dc90: 6f6e 6669 6727 206f 626a 6563 7420 6861  onfig' object ha
-0000dca0: 7320 6e6f 2061 7474 7269 6275 7465 2027  s no attribute '
-0000dcb0: 7b6b 6579 7d27 2229 0a0a 2323 2054 6573  {key}'")..## Tes
-0000dcc0: 7469 6e67 2067 656e 6572 6963 206d 6f64  ting generic mod
-0000dcd0: 656c 0a0a 0a64 6566 2066 6974 5f67 6175  el...def fit_gau
-0000dce0: 7373 6961 6e5f 766f 6967 745f 6765 6e65  ssian_voigt_gene
-0000dcf0: 7269 635f 6469 6164 2863 6f6e 6669 6731  ric_diad(config1
-0000dd00: 2c20 2a2c 2064 6961 6431 3d46 616c 7365  , *, diad1=False
-0000dd10: 2c20 6469 6164 323d 4661 6c73 652c 2070  , diad2=False, p
-0000dd20: 6174 683d 4e6f 6e65 2c20 6669 6c65 6e61  ath=None, filena
-0000dd30: 6d65 3d4e 6f6e 652c 2078 6461 743d 4e6f  me=None, xdat=No
-0000dd40: 6e65 2c20 7964 6174 3d4e 6f6e 652c 2073  ne, ydat=None, s
-0000dd50: 7061 6e3d 4e6f 6e65 2c20 2070 6c6f 745f  pan=None,  plot_
-0000dd60: 6669 6775 7265 3d54 7275 652c 2064 7069  figure=True, dpi
-0000dd70: 3d32 3030 2c20 4469 6164 5f70 6f73 3d4e  =200, Diad_pos=N
-0000dd80: 6f6e 652c 2048 425f 706f 733d 4e6f 6e65  one, HB_pos=None
-0000dd90: 2c20 4331 335f 706f 733d 4e6f 6e65 2c20  , C13_pos=None, 
-0000dda0: 6669 745f 7065 616b 733d 4e6f 6e65 2c20  fit_peaks=None, 
-0000ddb0: 626c 6f63 6b5f 7072 696e 743d 5472 7565  block_print=True
-0000ddc0: 293a 0a0a 0a20 2020 2022 2222 2054 6869  ):...    """ Thi
-0000ddd0: 7320 6675 6e63 7469 6f6e 2066 6974 7320  s function fits 
-0000dde0: 6120 766f 6967 742f 5073 6575 646f 766f  a voigt/Pseudovo
-0000ddf0: 6967 7420 6375 7276 6573 2074 6f20 6261  igt curves to ba
-0000de00: 636b 6772 6f75 6e64 2073 7562 7472 6163  ckground subtrac
-0000de10: 7465 6420 6461 7461 2066 6f72 2079 6f75  ted data for you
-0000de20: 7220 6469 6164 730a 2020 2020 2b2d 2048  r diads.    +- H
-0000de30: 4273 2b2d 4331 3320 7065 616b 732e 2049  Bs+-C13 peaks. I
-0000de40: 7420 6361 6e20 616c 736f 2066 6974 2061  t can also fit a
-0000de50: 2073 6563 6f6e 6420 4761 7573 7369 616e   second Gaussian
-0000de60: 2062 6163 6b67 726f 756e 6420 6974 6572   background iter
-0000de70: 6174 6976 656c 7920 7769 7468 2074 6865  atively with the
-0000de80: 7365 2070 6561 6b73 0a0a 0a20 2020 2050  se peaks...    P
-0000de90: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-0000dea0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 636f  ---------.    co
-0000deb0: 6e66 6967 313a 2066 6974 2063 6f6e 6669  nfig1: fit confi
-0000dec0: 6775 7261 7469 6f6e 2066 696c 652c 2066  guration file, f
-0000ded0: 726f 6d20 6469 6164 325f 6669 745f 636f  rom diad2_fit_co
-0000dee0: 6e66 6967 206f 7220 6469 6164 315f 6669  nfig or diad1_fi
-0000def0: 745f 636f 6e66 6967 2064 6174 6120 636c  t_config data cl
-0000df00: 6173 7365 732e 0a20 2020 2020 2020 2044  asses..        D
-0000df10: 6574 6169 6c65 6420 6465 7363 7269 7074  etailed descript
-0000df20: 696f 6e73 206f 6620 7468 696e 6773 2069  ions of things i
-0000df30: 6e20 7468 6973 2066 696c 6520 6172 6520  n this file are 
-0000df40: 666f 756e 6420 696e 2064 6f63 7320 666f  found in docs fo
-0000df50: 7220 6669 745f 6469 6164 5f32 5f77 5f62  r fit_diad_2_w_b
-0000df60: 636b 2c20 616e 6420 6669 745f 6469 6164  ck, and fit_diad
-0000df70: 5f31 5f77 5f62 636b 0a0a 2020 2020 6469  _1_w_bck..    di
-0000df80: 6164 313a 2062 6f6f 6c0a 2020 2020 2020  ad1: bool.      
-0000df90: 2020 5472 7565 2069 6620 6669 7474 696e    True if fittin
-0000dfa0: 6720 4469 6164 312c 2046 616c 7365 2069  g Diad1, False i
-0000dfb0: 6620 4469 6164 320a 0a20 2020 2064 6961  f Diad2..    dia
-0000dfc0: 6432 3a20 626f 6f6c 0a20 2020 2020 2020  d2: bool.       
-0000dfd0: 2054 7275 6520 6966 2066 6974 7469 6e67   True if fitting
-0000dfe0: 2044 6961 6432 2c20 4661 6c73 6520 6966   Diad2, False if
-0000dff0: 2044 6961 6431 0a0a 2020 2020 7061 7468   Diad1..    path
-0000e000: 3a20 7374 720a 2020 2020 2020 2020 5061  : str.        Pa
-0000e010: 7468 2074 6f20 7370 6563 7472 6120 666f  th to spectra fo
-0000e020: 6c64 6572 2e20 5573 6564 2074 6f20 6d61  lder. Used to ma
-0000e030: 6b65 2061 2066 6f6c 6465 7220 696e 7369  ke a folder insi
-0000e040: 6465 2074 6869 7320 666f 6c64 6572 2074  de this folder t
-0000e050: 6f20 7374 6f72 6520 7065 616b 2066 6974  o store peak fit
-0000e060: 2069 6d61 6765 7320 696e 0a0a 2020 2020   images in..    
-0000e070: 6669 6c65 6e61 6d65 3a20 7374 720a 2020  filename: str.  
-0000e080: 2020 2020 2020 6669 6c65 6e61 6d65 206f        filename o
-0000e090: 6620 7370 6563 6966 6963 2064 6961 6420  f specific diad 
-0000e0a0: 6265 696e 6720 6669 7474 6564 0a0a 2020  being fitted..  
-0000e0b0: 2020 7864 6174 3a20 6e70 2e61 7272 6179    xdat: np.array
-0000e0c0: 0a20 2020 2020 2020 2078 2063 6f6f 7264  .        x coord
-0000e0d0: 696e 6174 6573 206f 6620 7468 6520 7370  inates of the sp
-0000e0e0: 6563 7472 610a 0a20 2020 2079 6461 743a  ectra..    ydat:
-0000e0f0: 206e 702e 6172 7261 790a 2020 2020 2020   np.array.      
-0000e100: 2020 7920 636f 6f72 6469 6e61 7465 7320    y coordinates 
-0000e110: 6f66 2074 6865 2073 7065 6374 7261 0a0a  of the spectra..
-0000e120: 2020 2020 7370 616e 3a20 6c69 7374 2028      span: list (
-0000e130: 652e 672e 205b 3131 3030 2c20 3133 3030  e.g. [1100, 1300
-0000e140: 5d29 0a20 2020 2020 2020 2043 6f6d 6573  ]).        Comes
-0000e150: 2066 726f 6d20 7265 6d6f 7665 5f64 6961   from remove_dia
-0000e160: 645f 6261 7365 6c69 6e65 2066 756e 6374  d_baseline funct
-0000e170: 696f 6e2e 2053 6574 7320 6d69 6e20 616e  ion. Sets min an
-0000e180: 6420 6d61 7820 7820 636f 6f72 6469 6e61  d max x coordina
-0000e190: 7465 206f 6620 6e65 7720 6c69 6e73 7061  te of new linspa
-0000e1a0: 6365 0a20 2020 2020 2020 2066 6f72 2070  ce.        for p
-0000e1b0: 6c6f 7474 696e 6720 7468 6520 6f76 6572  lotting the over
-0000e1c0: 616c 6c20 7065 616b 2066 6974 206f 7665  all peak fit ove
-0000e1d0: 7220 7468 6520 6461 7461 0a0a 2020 2020  r the data..    
-0000e1e0: 706c 6f74 5f66 6967 7572 653a 2062 6f6f  plot_figure: boo
-0000e1f0: 6c0a 2020 2020 2020 2020 6966 2054 7275  l.        if Tru
-0000e200: 652c 2070 6c6f 7473 2066 6967 7572 6520  e, plots figure 
-0000e210: 6672 6f6d 2074 6869 7320 6675 6e63 7469  from this functi
-0000e220: 6f6e 2073 7065 6369 6669 6361 6c6c 792e  on specifically.
-0000e230: 2045 7665 6e20 6966 2046 616c 7365 2c20   Even if False, 
-0000e240: 6966 2063 616c 6c65 6420 7468 726f 7567  if called throug
-0000e250: 680a 2020 2020 2020 2020 6669 745f 6469  h.        fit_di
-0000e260: 6164 5f32 5f77 5f62 636b 206f 7220 6669  ad_2_w_bck or fi
-0000e270: 745f 6469 6164 5f31 5f77 5f62 636b 2c20  t_diad_1_w_bck, 
-0000e280: 6765 7420 6120 6669 6775 7265 2066 726f  get a figure fro
-0000e290: 6d20 7468 6f73 6520 6675 6e63 7469 6f6e  m those function
-0000e2a0: 7320 7769 7468 2072 656c 6576 616e 7420  s with relevant 
-0000e2b0: 6461 7461 206f 6e0a 0a20 2020 2064 7069  data on..    dpi
-0000e2c0: 3a20 696e 740a 2020 2020 2020 2020 6470  : int.        dp
-0000e2d0: 6920 6f66 2073 6176 6564 2066 6967 7572  i of saved figur
-0000e2e0: 650a 0a20 2020 2044 6961 645f 706f 732c  e..    Diad_pos,
-0000e2f0: 2048 425f 706f 732c 2043 3133 5f70 6f73   HB_pos, C13_pos
-0000e300: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
-0000e310: 496e 6974 6961 6c20 6775 6573 7320 6f66  Initial guess of
-0000e320: 2044 6961 642c 2048 422c 2043 3133 2070   Diad, HB, C13 p
-0000e330: 6f73 0a0a 2020 2020 6669 745f 7065 616b  os..    fit_peak
-0000e340: 733a 2069 6e74 0a20 2020 2020 2020 204e  s: int.        N
-0000e350: 756d 6265 7220 6f66 2070 6561 6b73 2074  umber of peaks t
-0000e360: 6f20 6669 742e 2031 3d20 6a75 7374 2064  o fit. 1= just d
-0000e370: 6961 642c 2032 203d 2064 6961 6420 2b20  iad, 2 = diad + 
-0000e380: 4842 2c20 3320 3d20 6469 6164 2b20 4842  HB, 3 = diad+ HB
-0000e390: 202b 4331 330a 0a20 2020 2062 6c6f 636b   +C13..    block
-0000e3a0: 5f70 7269 6e74 3a20 626f 6f6c 0a20 2020  _print: bool.   
-0000e3b0: 2020 2020 2049 6620 7472 7565 2c20 7072       If true, pr
-0000e3c0: 696e 7473 2061 2066 6577 2073 7461 7475  ints a few statu
-0000e3d0: 7320 7570 6461 7465 7320 6173 2069 7420  s updates as it 
-0000e3e0: 676f 6573 2074 6f20 6865 6c70 2064 6562  goes to help deb
-0000e3f0: 7567 0a0a 2020 2020 5265 7475 726e 730a  ug..    Returns.
-0000e400: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
-0000e410: 2d2d 2d2d 2d2d 2d0a 2020 2020 7265 7375  -------.    resu
-0000e420: 6c74 2c20 6466 5f6f 7574 2c20 795f 6265  lt, df_out, y_be
-0000e430: 7374 5f66 6974 2c20 785f 6c69 6e2c 2063  st_fit, x_lin, c
-0000e440: 6f6d 706f 6e65 6e74 732c 2078 6461 742c  omponents, xdat,
-0000e450: 2079 6461 742c 2061 7831 5f78 6c69 6d2c   ydat, ax1_xlim,
-0000e460: 2061 7832 5f78 6c69 6d2c 2063 6f6e 6669   ax2_xlim, confi
-0000e470: 6731 2e66 6974 5f67 6175 7373 2c20 7265  g1.fit_gauss, re
-0000e480: 7369 6475 616c 5f64 6961 645f 636f 6f72  sidual_diad_coor
-0000e490: 6473 2c20 7964 6174 5f69 6e72 616e 6765  ds, ydat_inrange
-0000e4a0: 2c20 2078 6461 745f 696e 7261 6e67 650a  ,  xdat_inrange.
-0000e4b0: 0a20 2020 2072 6573 756c 743a 206c 6d66  .    result: lmf
-0000e4c0: 6974 2e6d 6f64 656c 2e4d 6f64 656c 5265  it.model.ModelRe
-0000e4d0: 7375 6c74 2028 6d6f 6465 6c20 666f 726d  sult (model form
-0000e4e0: 206c 6d66 6974 290a 2020 2020 6466 5f6f   lmfit).    df_o
-0000e4f0: 7574 3a20 6461 7461 6672 616d 6520 6f66  ut: dataframe of
-0000e500: 2070 6561 6b20 6669 7420 7061 7261 6d65   peak fit parame
-0000e510: 7465 7273 0a20 2020 2079 5f62 6573 745f  ters.    y_best_
-0000e520: 6669 743a 206e 702e 6172 7261 7920 6f66  fit: np.array of
-0000e530: 2062 6573 7420 7065 616b 2066 6974 2079   best peak fit y
-0000e540: 2070 6172 616d 6574 6572 730a 2020 2020   parameters.    
-0000e550: 785f 6c69 6e3a 206e 702e 6172 7261 7920  x_lin: np.array 
-0000e560: 6f66 2078 2063 6f6f 7264 696e 6174 6573  of x coordinates
-0000e570: 2063 6f72 7265 7370 6f6e 6469 6e67 2074   corresponding t
-0000e580: 6f20 795f 6265 7374 5f66 6974 0a20 2020  o y_best_fit.   
-0000e590: 2063 6f6d 706f 6e65 6e74 733a 2079 2063   components: y c
-0000e5a0: 6f6f 7264 696e 6174 6573 206f 6620 7468  oordinates of th
-0000e5b0: 6520 6469 6666 6572 656e 7420 636f 6d70  e different comp
-0000e5c0: 6f6e 656e 7473 206f 6620 7468 6520 7065  onents of the pe
-0000e5d0: 616b 2066 6974 2e0a 2020 2020 7864 6174  ak fit..    xdat
-0000e5e0: 3a20 696e 7075 7420 7864 6174 0a20 2020  : input xdat.   
-0000e5f0: 2079 6461 743a 2069 6e70 7574 2079 6461   ydat: input yda
-0000e600: 740a 2020 2020 6178 315f 786c 696d 2c20  t.    ax1_xlim, 
-0000e610: 6178 325f 786c 696d 3a20 786c 696d 2066  ax2_xlim: xlim f
-0000e620: 6f72 2070 6c6f 7420 696e 2066 696e 616c  or plot in final
-0000e630: 2066 6967 7572 6520 696e 2066 6974 5f77   figure in fit_w
-0000e640: 5f62 636b 2066 6f72 2064 6966 6665 7265  _bck for differe
-0000e650: 6e74 2066 6974 2063 6f6d 706f 6e65 6e74  nt fit component
-0000e660: 730a 2020 2020 7265 7369 6475 616c 5f64  s.    residual_d
-0000e670: 6961 645f 636f 6f72 6469 6e61 7465 733a  iad_coordinates:
-0000e680: 206e 702e 6172 7261 7920 6f66 2079 2063   np.array of y c
-0000e690: 6f6f 7264 696e 6174 6520 6f66 2072 6573  oordinate of res
-0000e6a0: 6964 7561 6c20 706c 6f74 0a20 2020 2079  idual plot.    y
-0000e6b0: 6461 745f 696e 7261 6e67 653a 206e 702e  dat_inrange: np.
-0000e6c0: 6172 7261 7920 6f66 2064 6174 6120 7769  array of data wi
-0000e6d0: 7468 696e 2027 7370 616e 270a 2020 2020  thin 'span'.    
-0000e6e0: 7864 6174 5f69 6e72 616e 6765 3a6e 702e  xdat_inrange:np.
-0000e6f0: 6172 7261 7920 6f66 2064 6174 6120 7769  array of data wi
-0000e700: 7468 696e 2027 7370 616e 270a 0a0a 0a20  thin 'span'.... 
-0000e710: 2020 2022 2222 0a0a 0a0a 2020 2020 2320     """....    # 
-0000e720: 4361 6c63 756c 6174 6520 7468 6520 616d  Calculate the am
-0000e730: 706c 6974 7564 6520 6672 6f6d 2074 6865  plitude from the
-0000e740: 2073 6967 6d61 2061 6e64 2074 6865 2070   sigma and the p
-0000e750: 726f 6d69 6e65 6e63 650a 2020 2020 6361  rominence.    ca
-0000e760: 6c63 5f64 6961 645f 616d 706c 6974 7564  lc_diad_amplitud
-0000e770: 653d 2828 636f 6e66 6967 312e 6469 6164  e=((config1.diad
-0000e780: 5f73 6967 6d61 292a 2863 6f6e 6669 6731  _sigma)*(config1
-0000e790: 2e64 6961 645f 7072 6f6d 2929 2f30 2e33  .diad_prom))/0.3
-0000e7a0: 3933 390a 2020 2020 6361 6c63 5f48 425f  939.    calc_HB_
-0000e7b0: 616d 706c 6974 7564 653d 2828 636f 6e66  amplitude=((conf
-0000e7c0: 6967 312e 6469 6164 5f73 6967 6d61 292a  ig1.diad_sigma)*
-0000e7d0: 2863 6f6e 6669 6731 2e48 425f 7072 6f6d  (config1.HB_prom
-0000e7e0: 2929 2f30 2e33 3933 390a 0a20 2020 2023  ))/0.3939..    #
-0000e7f0: 2049 6620 6173 6b20 666f 7220 4761 7573   If ask for Gaus
-0000e800: 7369 616e 2c20 6275 7420 6669 7420 7065  sian, but fit pe
-0000e810: 616b 7320 6973 2031 2c20 7265 6d6f 7665  aks is 1, remove
-0000e820: 2067 6175 7373 6961 6e0a 2020 2020 6966   gaussian.    if
-0000e830: 2066 6974 5f70 6561 6b73 3d3d 3120 616e   fit_peaks==1 an
-0000e840: 6420 636f 6e66 6967 312e 6669 745f 6761  d config1.fit_ga
-0000e850: 7573 7320 6973 2054 7275 653a 0a20 2020  uss is True:.   
-0000e860: 2020 2020 2063 6f6e 6669 6731 2e66 6974       config1.fit
-0000e870: 5f67 6175 7373 3d46 616c 7365 0a0a 0a20  _gauss=False... 
-0000e880: 2020 2069 6620 6469 6164 3220 6973 2054     if diad2 is T
-0000e890: 7275 6520 616e 6420 6669 745f 7065 616b  rue and fit_peak
-0000e8a0: 733d 3d33 3a0a 2020 2020 2020 2020 6361  s==3:.        ca
-0000e8b0: 6c63 5f43 3133 5f61 6d70 6c69 7475 6465  lc_C13_amplitude
-0000e8c0: 3d28 302e 352a 2863 6f6e 6669 6731 2e64  =(0.5*(config1.d
-0000e8d0: 6961 645f 7369 676d 6129 2a28 636f 6e66  iad_sigma)*(conf
-0000e8e0: 6967 312e 4331 335f 7072 6f6d 2929 2f30  ig1.C13_prom))/0
-0000e8f0: 2e33 3933 390a 2020 2020 2320 4765 7473  .3939.    # Gets
-0000e900: 206f 7665 7272 6964 6465 6e20 6966 2079   overridden if y
-0000e910: 6f75 2068 6176 6520 7472 6967 6765 7265  ou have triggere
-0000e920: 6420 616e 7920 6f66 2074 6865 2077 6172  d any of the war
-0000e930: 6e69 6e67 730a 2020 2020 7265 6669 743d  nings.    refit=
-0000e940: 4661 6c73 650a 2020 2020 7265 6669 745f  False.    refit_
-0000e950: 7061 7261 6d3d 2746 6c61 6767 6564 2057  param='Flagged W
-0000e960: 6172 6e69 6e67 733a 270a 2020 2020 7370  arnings:'.    sp
-0000e970: 6563 5f72 6573 3d6e 702e 6162 7328 7864  ec_res=np.abs(xd
-0000e980: 6174 5b31 5d2d 7864 6174 5b30 5d29 0a0a  at[1]-xdat[0])..
-0000e990: 0a0a 0a0a 0a20 2020 2069 6e69 7469 616c  .....    initial
-0000e9a0: 5f67 7565 7373 3d44 6961 645f 706f 730a  _guess=Diad_pos.
-0000e9b0: 2020 2020 4842 5f69 6e69 7469 616c 5f67      HB_initial_g
-0000e9c0: 7565 7373 3d48 425f 706f 730a 2020 2020  uess=HB_pos.    
-0000e9d0: 4331 335f 696e 6974 6961 6c5f 6775 6573  C13_initial_gues
-0000e9e0: 733d 4331 335f 706f 730a 0a0a 2020 2020  s=C13_pos...    
-0000e9f0: 6d6f 6465 6c5f 696e 6920 3d20 676c 6f62  model_ini = glob
-0000ea00: 616c 7328 295b 636f 6e66 6967 312e 6d6f  als()[config1.mo
-0000ea10: 6465 6c5f 6e61 6d65 5d28 290a 0a0a 0a0a  del_name]().....
-0000ea20: 2020 2020 2320 4372 6561 7465 2069 6e69      # Create ini
-0000ea30: 7469 616c 2070 6561 6b20 7061 7261 6d73  tial peak params
-0000ea40: 0a20 2020 2023 2053 6574 2070 6561 6b20  .    # Set peak 
-0000ea50: 706f 7369 7469 6f6e 2074 6f20 3220 7370  position to 2 sp
-0000ea60: 6563 7472 616c 2072 6573 2075 6e69 7473  ectral res units
-0000ea70: 2065 6974 6865 7220 7369 6465 206f 6620   either side of 
-0000ea80: 7468 6520 696e 6974 6961 6c20 6775 6573  the initial gues
-0000ea90: 7320 6d61 6465 2061 626f 7665 0a20 2020  s made above.   
-0000eaa0: 2070 6172 616d 735f 696e 6920 3d20 6d6f   params_ini = mo
-0000eab0: 6465 6c5f 696e 692e 6d61 6b65 5f70 6172  del_ini.make_par
-0000eac0: 616d 7328 6365 6e74 6572 3d69 6e69 7469  ams(center=initi
-0000ead0: 616c 5f67 7565 7373 2c20 6d61 783d 696e  al_guess, max=in
-0000eae0: 6974 6961 6c5f 6775 6573 732b 7370 6563  itial_guess+spec
-0000eaf0: 5f72 6573 2a35 2c20 6d69 6e3d 696e 6974  _res*5, min=init
-0000eb00: 6961 6c5f 6775 6573 732d 7370 6563 5f72  ial_guess-spec_r
-0000eb10: 6573 2a35 290a 2020 2020 2320 5365 7420  es*5).    # Set 
-0000eb20: 7468 6520 616d 706c 6974 7564 6520 746f  the amplitude to
-0000eb30: 2077 6974 6869 6e20 5830 2e31 206f 7220   within X0.1 or 
-0000eb40: 3130 5820 6f66 2074 6865 2067 7565 7373  10X of the guess
-0000eb50: 6564 2061 6d70 6c69 7475 6465 0a20 2020  ed amplitude.   
-0000eb60: 2070 6172 616d 735f 696e 695b 2761 6d70   params_ini['amp
-0000eb70: 6c69 7475 6465 275d 2e73 6574 2863 616c  litude'].set(cal
-0000eb80: 635f 6469 6164 5f61 6d70 6c69 7475 6465  c_diad_amplitude
-0000eb90: 2c20 6d69 6e3d 6361 6c63 5f64 6961 645f  , min=calc_diad_
-0000eba0: 616d 706c 6974 7564 652f 352c 0a20 2020  amplitude/5,.   
-0000ebb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ebc0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0000ebd0: 783d 6361 6c63 5f64 6961 645f 616d 706c  x=calc_diad_ampl
-0000ebe0: 6974 7564 652a 3529 0a20 2020 2023 2053  itude*5).    # S
-0000ebf0: 6574 2073 6967 6d61 2074 6f20 6265 2074  et sigma to be t
-0000ec00: 6865 2065 6e74 6572 6564 2076 616c 7565  he entered value
-0000ec10: 2c20 7468 656e 0a20 2020 2070 6172 616d  , then.    param
-0000ec20: 735f 696e 695b 2773 6967 6d61 275d 2e73  s_ini['sigma'].s
-0000ec30: 6574 2863 6f6e 6669 6731 2e64 6961 645f  et(config1.diad_
-0000ec40: 7369 676d 612c 206d 696e 3d63 6f6e 6669  sigma, min=confi
-0000ec50: 6731 2e64 6961 645f 7369 676d 612a 636f  g1.diad_sigma*co
-0000ec60: 6e66 6967 312e 6469 6164 5f73 6967 6d61  nfig1.diad_sigma
-0000ec70: 5f6d 696e 5f61 6c6c 6f77 616e 6365 2c0a  _min_allowance,.
-0000ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eca0: 6d61 783d 636f 6e66 6967 312e 6469 6164  max=config1.diad
-0000ecb0: 5f73 6967 6d61 2a63 6f6e 6669 6731 2e64  _sigma*config1.d
-0000ecc0: 6961 645f 7369 676d 615f 6d61 785f 616c  iad_sigma_max_al
-0000ecd0: 6c6f 7761 6e63 6529 0a0a 2020 2020 2320  lowance)..    # 
-0000ece0: 4e6f 7720 6c65 7473 2074 7765 616b 2061  Now lets tweak a
-0000ecf0: 6e20 696e 6974 6961 6c20 6d6f 6465 6c20  n initial model 
-0000ed00: 7769 7468 206a 7573 7420 3120 7065 616b  with just 1 peak
-0000ed10: 2c20 7468 6973 2072 6561 6c6c 7920 6865  , this really he
-0000ed20: 6c70 7320 7769 7468 2074 6865 2066 6974  lps with the fit
-0000ed30: 0a20 2020 2069 6e69 745f 696e 6920 3d20  .    init_ini = 
-0000ed40: 6d6f 6465 6c5f 696e 692e 6576 616c 2870  model_ini.eval(p
-0000ed50: 6172 616d 735f 696e 692c 2078 3d78 6461  arams_ini, x=xda
-0000ed60: 7429 0a20 2020 2072 6573 756c 745f 696e  t).    result_in
-0000ed70: 6920 203d 206d 6f64 656c 5f69 6e69 2e66  i  = model_ini.f
-0000ed80: 6974 2879 6461 742c 2070 6172 616d 735f  it(ydat, params_
-0000ed90: 696e 692c 2078 3d78 6461 7429 0a20 2020  ini, x=xdat).   
-0000eda0: 2063 6f6d 7073 5f69 6e69 2020 3d20 7265   comps_ini  = re
-0000edb0: 7375 6c74 5f69 6e69 2e65 7661 6c5f 636f  sult_ini.eval_co
-0000edc0: 6d70 6f6e 656e 7473 2829 0a20 2020 2043  mponents().    C
-0000edd0: 656e 7465 725f 696e 693d 7265 7375 6c74  enter_ini=result
-0000ede0: 5f69 6e69 2e70 6172 616d 732e 6765 7428  _ini.params.get(
-0000edf0: 2763 656e 7465 7227 290a 2020 2020 416d  'center').    Am
-0000ee00: 706c 6974 7564 655f 696e 693d 7265 7375  plitude_ini=resu
-0000ee10: 6c74 5f69 6e69 2e70 6172 616d 732e 6765  lt_ini.params.ge
-0000ee20: 7428 2761 6d70 6c69 7475 6465 2729 0a20  t('amplitude'). 
-0000ee30: 2020 2073 6967 6d61 5f69 6e69 3d72 6573     sigma_ini=res
-0000ee40: 756c 745f 696e 692e 7061 7261 6d73 2e67  ult_ini.params.g
-0000ee50: 6574 2827 7369 676d 6127 290a 2020 2020  et('sigma').    
-0000ee60: 6677 686d 5f69 6e69 3d72 6573 756c 745f  fwhm_ini=result_
-0000ee70: 696e 692e 7061 7261 6d73 2e67 6574 2827  ini.params.get('
-0000ee80: 6677 686d 2729 0a0a 0a0a 2020 2020 2320  fwhm')....    # 
-0000ee90: 466f 7220 7265 6c61 7469 7665 6c79 2077  For relatively w
-0000eea0: 6561 6b20 7065 616b 732c 2079 6f75 2077  eak peaks, you w
-0000eeb0: 6f6e 7420 7761 6e74 2061 2067 6175 7373  ont want a gauss
-0000eec0: 6961 6e20 6261 636b 6772 6f75 6e64 0a20  ian background. 
-0000eed0: 2020 2069 6620 636f 6e66 6967 312e 6669     if config1.fi
-0000eee0: 745f 6761 7573 7320 6973 2046 616c 7365  t_gauss is False
-0000eef0: 3a0a 0a20 2020 2020 2020 2023 2049 6620  :..        # If 
-0000ef00: 7468 6572 6520 6973 2031 2070 6561 6b2c  there is 1 peak,
-0000ef10: 2065 2e67 2e20 6966 2068 6176 6520 6120   e.g. if have a 
-0000ef20: 4e61 6e20 666f 7220 686f 7462 616e 640a  Nan for hotband.
-0000ef30: 2020 2020 2020 2020 6966 2066 6974 5f70          if fit_p
-0000ef40: 6561 6b73 3d3d 313a 0a20 2020 2020 2020  eaks==1:.       
-0000ef50: 2020 2020 206d 6f64 656c 5f46 203d 2067       model_F = g
-0000ef60: 6c6f 6261 6c73 2829 5b63 6f6e 6669 6731  lobals()[config1
-0000ef70: 2e6d 6f64 656c 5f6e 616d 655d 2870 7265  .model_name](pre
-0000ef80: 6669 783d 276c 7a31 5f27 290a 2020 2020  fix='lz1_').    
-0000ef90: 2020 2020 2020 2020 7061 7273 3120 3d20          pars1 = 
-0000efa0: 6d6f 6465 6c5f 462e 6d61 6b65 5f70 6172  model_F.make_par
-0000efb0: 616d 7328 290a 2020 2020 2020 2020 2020  ams().          
-0000efc0: 2020 7061 7273 315b 276c 7a31 5f27 2b20    pars1['lz1_'+ 
-0000efd0: 2761 6d70 6c69 7475 6465 275d 2e73 6574  'amplitude'].set
-0000efe0: 2863 616c 635f 6469 6164 5f61 6d70 6c69  (calc_diad_ampli
-0000eff0: 7475 6465 2c20 6d69 6e3d 302c 206d 6178  tude, min=0, max
-0000f000: 3d63 616c 635f 6469 6164 5f61 6d70 6c69  =calc_diad_ampli
-0000f010: 7475 6465 2a31 3029 0a20 2020 2020 2020  tude*10).       
-0000f020: 2020 2020 2070 6172 7331 5b27 6c7a 315f       pars1['lz1_
-0000f030: 272b 2027 6365 6e74 6572 275d 2e73 6574  '+ 'center'].set
-0000f040: 2843 656e 7465 725f 696e 692c 206d 696e  (Center_ini, min
-0000f050: 3d43 656e 7465 725f 696e 692d 352a 7370  =Center_ini-5*sp
-0000f060: 6563 5f72 6573 2c20 6d61 783d 4365 6e74  ec_res, max=Cent
-0000f070: 6572 5f69 6e69 2b35 2a73 7065 635f 7265  er_ini+5*spec_re
-0000f080: 7329 0a20 2020 2020 2020 2020 2020 2070  s).            p
-0000f090: 6172 7331 5b27 6c7a 315f 272b 2027 7369  ars1['lz1_'+ 'si
-0000f0a0: 676d 6127 5d2e 7365 7428 636f 6e66 6967  gma'].set(config
-0000f0b0: 312e 6469 6164 5f73 6967 6d61 2c20 6d69  1.diad_sigma, mi
-0000f0c0: 6e3d 636f 6e66 6967 312e 6469 6164 5f73  n=config1.diad_s
-0000f0d0: 6967 6d61 2a63 6f6e 6669 6731 2e64 6961  igma*config1.dia
-0000f0e0: 645f 7369 676d 615f 6d69 6e5f 616c 6c6f  d_sigma_min_allo
-0000f0f0: 7761 6e63 652c 0a20 2020 2020 2020 2020  wance,.         
-0000f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f110: 6d61 783d 636f 6e66 6967 312e 6469 6164  max=config1.diad
-0000f120: 5f73 6967 6d61 2a63 6f6e 6669 6731 2e64  _sigma*config1.d
-0000f130: 6961 645f 7369 676d 615f 6d61 785f 616c  iad_sigma_max_al
-0000f140: 6c6f 7761 6e63 6529 0a20 2020 2020 2020  lowance).       
-0000f150: 2020 2020 2070 6172 616d 733d 7061 7273       params=pars
-0000f160: 310a 0a0a 2020 2020 2020 2020 2320 4966  1...        # If
-0000f170: 2074 6865 7265 2069 7320 6d6f 7265 2074   there is more t
-0000f180: 6861 6e20 6f6e 6520 7065 616b 0a20 2020  han one peak.   
-0000f190: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000f1a0: 2020 2020 2020 2023 2050 7265 7669 6f75         # Previou
-0000f1b0: 7320 7665 7273 696f 6e73 2068 6164 2061  s versions had a
-0000f1c0: 2063 6f6e 7374 616e 7420 666f 7220 5056   constant for PV
-0000f1d0: 2061 6e64 2050 3420 6275 7420 6e6f 7420   and P4 but not 
-0000f1e0: 566f 6967 742e 204e 6f77 2072 656d 6f76  Voigt. Now remov
-0000f1f0: 6564 2066 6f72 2061 6c6c 0a20 2020 2020  ed for all.     
-0000f200: 2020 2020 2020 206d 6f64 656c 3120 3d20         model1 = 
-0000f210: 676c 6f62 616c 7328 295b 636f 6e66 6967  globals()[config
-0000f220: 312e 6d6f 6465 6c5f 6e61 6d65 5d28 7072  1.model_name](pr
-0000f230: 6566 6978 3d27 6c7a 315f 2729 0a20 2020  efix='lz1_').   
-0000f240: 2020 2020 2020 2020 2070 6172 7331 203d           pars1 =
-0000f250: 206d 6f64 656c 312e 6d61 6b65 5f70 6172   model1.make_par
-0000f260: 616d 7328 290a 2020 2020 2020 2020 2020  ams().          
-0000f270: 2020 7061 7273 315b 276c 7a31 5f27 2b20    pars1['lz1_'+ 
-0000f280: 2761 6d70 6c69 7475 6465 275d 2e73 6574  'amplitude'].set
-0000f290: 2863 616c 635f 6469 6164 5f61 6d70 6c69  (calc_diad_ampli
-0000f2a0: 7475 6465 2c20 6d69 6e3d 302c 206d 6178  tude, min=0, max
-0000f2b0: 3d63 616c 635f 6469 6164 5f61 6d70 6c69  =calc_diad_ampli
-0000f2c0: 7475 6465 2a31 3029 0a0a 2020 2020 2020  tude*10)..      
-0000f2d0: 2020 2020 2020 7061 7273 315b 276c 7a31        pars1['lz1
-0000f2e0: 5f27 2b20 2763 656e 7465 7227 5d2e 7365  _'+ 'center'].se
-0000f2f0: 7428 4365 6e74 6572 5f69 6e69 2c20 6d69  t(Center_ini, mi
-0000f300: 6e3d 4365 6e74 6572 5f69 6e69 2d33 2a73  n=Center_ini-3*s
-0000f310: 7065 635f 7265 732c 206d 6178 3d43 656e  pec_res, max=Cen
-0000f320: 7465 725f 696e 692b 332a 7370 6563 5f72  ter_ini+3*spec_r
-0000f330: 6573 290a 0a20 2020 2020 2020 2020 2020  es)..           
-0000f340: 2070 6172 7331 5b27 6c7a 315f 272b 2027   pars1['lz1_'+ '
-0000f350: 7369 676d 6127 5d2e 7365 7428 636f 6e66  sigma'].set(conf
-0000f360: 6967 312e 6469 6164 5f73 6967 6d61 2c20  ig1.diad_sigma, 
-0000f370: 6d69 6e3d 636f 6e66 6967 312e 6469 6164  min=config1.diad
-0000f380: 5f73 6967 6d61 2a63 6f6e 6669 6731 2e64  _sigma*config1.d
-0000f390: 6961 645f 7369 676d 615f 6d69 6e5f 616c  iad_sigma_min_al
-0000f3a0: 6c6f 7761 6e63 652c 0a20 2020 2020 2020  lowance,.       
-0000f3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3c0: 206d 6178 3d63 6f6e 6669 6731 2e64 6961   max=config1.dia
-0000f3d0: 645f 7369 676d 612a 636f 6e66 6967 312e  d_sigma*config1.
-0000f3e0: 6469 6164 5f73 6967 6d61 5f6d 6178 5f61  diad_sigma_max_a
-0000f3f0: 6c6c 6f77 616e 6365 290a 0a0a 0a0a 2020  llowance).....  
-0000f400: 2020 2020 2020 2020 2020 6966 2066 6974            if fit
-0000f410: 5f70 6561 6b73 3e31 3a0a 2020 2020 2020  _peaks>1:.      
-0000f420: 2020 2020 2020 2020 2020 6d6f 6465 6c5f            model_
-0000f430: 463d 6d6f 6465 6c31 0a20 2020 2020 2020  F=model1.       
-0000f440: 2020 2020 2020 2020 2070 6172 616d 733d           params=
-0000f450: 7061 7273 310a 0a20 2020 2020 2020 2020  pars1..         
-0000f460: 2020 2069 6620 6669 745f 7065 616b 733d     if fit_peaks=
-0000f470: 3d32 3a0a 0a20 2020 2020 2020 2020 2020  =2:..           
-0000f480: 2020 2020 2023 2053 6563 6f6e 6420 7765       # Second we
-0000f490: 6520 7065 616b 0a20 2020 2020 2020 2020  e peak.         
-0000f4a0: 2020 2020 2020 2070 7265 6669 783d 276c         prefix='l
-0000f4b0: 7a32 5f27 0a0a 2020 2020 2020 2020 2020  z2_'..          
-0000f4c0: 2020 2020 2020 7065 616b 203d 2067 6c6f        peak = glo
-0000f4d0: 6261 6c73 2829 5b63 6f6e 6669 6731 2e6d  bals()[config1.m
-0000f4e0: 6f64 656c 5f6e 616d 655d 2870 7265 6669  odel_name](prefi
-0000f4f0: 783d 276c 7a32 5f27 290a 0a0a 2020 2020  x='lz2_')...    
-0000f500: 2020 2020 2020 2020 2020 2020 7061 7273              pars
-0000f510: 203d 2070 6561 6b2e 6d61 6b65 5f70 6172   = peak.make_par
-0000f520: 616d 7328 290a 0a20 2020 2020 2020 2020  ams()..         
-0000f530: 2020 2020 2020 2070 6172 735b 7072 6566         pars[pref
-0000f540: 6978 202b 2027 6365 6e74 6572 275d 2e73  ix + 'center'].s
-0000f550: 6574 2848 425f 696e 6974 6961 6c5f 6775  et(HB_initial_gu
-0000f560: 6573 732c 0a20 2020 2020 2020 2020 2020  ess,.           
-0000f570: 2020 2020 2020 2020 206d 696e 3d48 425f           min=HB_
-0000f580: 696e 6974 6961 6c5f 6775 6573 732d 322a  initial_guess-2*
-0000f590: 7370 6563 5f72 6573 2c20 6d61 783d 4842  spec_res, max=HB
-0000f5a0: 5f69 6e69 7469 616c 5f67 7565 7373 2b32  _initial_guess+2
-0000f5b0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000f5c0: 2020 2070 6172 735b 7072 6566 6978 202b     pars[prefix +
-0000f5d0: 2027 616d 706c 6974 7564 6527 5d2e 7365   'amplitude'].se
-0000f5e0: 7428 6361 6c63 5f48 425f 616d 706c 6974  t(calc_HB_amplit
-0000f5f0: 7564 652c 206d 696e 3d41 6d70 6c69 7475  ude, min=Amplitu
-0000f600: 6465 5f69 6e69 2a63 6f6e 6669 6731 2e48  de_ini*config1.H
-0000f610: 425f 616d 705f 6d69 6e5f 616c 6c6f 7761  B_amp_min_allowa
-0000f620: 6e63 652c 206d 6178 3d41 6d70 6c69 7475  nce, max=Amplitu
-0000f630: 6465 5f69 6e69 2a63 6f6e 6669 6731 2e48  de_ini*config1.H
-0000f640: 425f 616d 705f 6d61 785f 616c 6c6f 7761  B_amp_max_allowa
-0000f650: 6e63 6529 0a20 2020 2020 2020 2020 2020  nce).           
-0000f660: 2020 2020 2070 6172 735b 7072 6566 6978       pars[prefix
-0000f670: 2b20 2773 6967 6d61 275d 2e73 6574 2873  + 'sigma'].set(s
-0000f680: 6967 6d61 5f69 6e69 2c20 6d69 6e3d 7369  igma_ini, min=si
-0000f690: 676d 615f 696e 692a 636f 6e66 6967 312e  gma_ini*config1.
-0000f6a0: 4842 5f73 6967 6d61 5f6d 696e 5f61 6c6c  HB_sigma_min_all
-0000f6b0: 6f77 616e 6365 2c20 6d61 783d 7369 676d  owance, max=sigm
-0000f6c0: 615f 696e 692a 636f 6e66 6967 312e 4842  a_ini*config1.HB
-0000f6d0: 5f73 6967 6d61 5f6d 6178 5f61 6c6c 6f77  _sigma_max_allow
-0000f6e0: 616e 6365 290a 0a0a 2020 2020 2020 2020  ance)...        
-0000f6f0: 2020 2020 2020 2020 6d6f 6465 6c5f 463d          model_F=
-0000f700: 6d6f 6465 6c31 2b70 6561 6b0a 0a20 2020  model1+peak..   
-0000f710: 2020 2020 2020 2020 2020 2020 2023 2075               # u
-0000f720: 7064 6174 696e 6720 7061 7273 2031 2077  pdating pars 1 w
-0000f730: 6974 6820 7661 6c75 6573 2069 6e20 7061  ith values in pa
-0000f740: 7273 0a20 2020 2020 2020 2020 2020 2020  rs.             
-0000f750: 2020 2070 6172 7331 2e75 7064 6174 6528     pars1.update(
-0000f760: 7061 7273 290a 2020 2020 2020 2020 2020  pars).          
-0000f770: 2020 2020 2020 7061 7261 6d73 3d70 6172        params=par
-0000f780: 7331 0a0a 0a20 2020 2020 2020 2020 2020  s1...           
-0000f790: 2020 2020 2023 2041 7474 656d 7074 2061       # Attempt a
-0000f7a0: 7420 7374 6162 696c 697a 696e 6720 7065  t stabilizing pe
-0000f7b0: 616b 2066 6974 0a20 2020 2020 2020 2020  ak fit.         
-0000f7c0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-0000f7d0: 6d6f 6465 6c5f 462e 6669 7428 7964 6174  model_F.fit(ydat
-0000f7e0: 2c20 7061 7273 312c 2078 3d78 6461 7429  , pars1, x=xdat)
-0000f7f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f800: 2072 6573 756c 742e 7061 7261 6d73 5b27   result.params['
-0000f810: 6c7a 325f 6365 6e74 6572 275d 2e76 6172  lz2_center'].var
-0000f820: 7920 3d20 4661 6c73 650a 2020 2020 2020  y = False.      
-0000f830: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-0000f840: 2e70 6172 616d 735b 276c 7a32 5f61 6d70  .params['lz2_amp
-0000f850: 6c69 7475 6465 275d 2e76 6172 7920 3d20  litude'].vary = 
-0000f860: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0000f870: 2020 2020 2020 7265 7375 6c74 2e70 6172        result.par
-0000f880: 616d 735b 276c 7a32 5f73 6967 6d61 275d  ams['lz2_sigma']
-0000f890: 2e76 6172 7920 3d20 4661 6c73 650a 2020  .vary = False.  
-0000f8a0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0000f8b0: 6e61 6c5f 7265 7375 6c74 203d 206d 6f64  nal_result = mod
-0000f8c0: 656c 5f46 2e66 6974 2879 6461 742c 2072  el_F.fit(ydat, r
-0000f8d0: 6573 756c 742e 7061 7261 6d73 2c20 783d  esult.params, x=
-0000f8e0: 7864 6174 290a 2020 2020 2020 2020 2020  xdat).          
-0000f8f0: 2020 2020 2020 7061 7261 6d73 2e75 7064        params.upd
-0000f900: 6174 6528 6669 6e61 6c5f 7265 7375 6c74  ate(final_result
-0000f910: 2e70 6172 616d 7329 0a20 2020 2020 2020  .params).       
-0000f920: 2020 2020 2020 2020 2070 6172 616d 732e           params.
-0000f930: 7570 6461 7465 2866 696e 616c 5f72 6573  update(final_res
-0000f940: 756c 742e 7061 7261 6d73 290a 2020 2020  ult.params).    
-0000f950: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0000f960: 6c74 3d66 696e 616c 5f72 6573 756c 740a  lt=final_result.
-0000f970: 0a0a 0a0a 0a0a 0a20 2020 2020 2020 2020  .......         
-0000f980: 2020 2069 6620 6669 745f 7065 616b 733d     if fit_peaks=
-0000f990: 3d33 3a0a 2020 2020 2020 2020 2020 2020  =3:.            
-0000f9a0: 2020 2020 6966 2062 6c6f 636b 5f70 7269      if block_pri
-0000f9b0: 6e74 2069 7320 4661 6c73 653a 0a20 2020  nt is False:.   
-0000f9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f9d0: 2070 7269 6e74 2827 5472 7969 6e67 2074   print('Trying t
-0000f9e0: 6f20 6974 6572 6174 6976 656c 7920 6669  o iteratively fi
-0000f9f0: 7420 3320 7065 616b 7327 290a 0a20 2020  t 3 peaks')..   
-0000fa00: 2020 2020 2020 2020 2020 2020 2070 6561               pea
-0000fa10: 6b5f 706f 735f 6c65 6674 3d6e 702e 6172  k_pos_left=np.ar
-0000fa20: 7261 7928 5b48 425f 696e 6974 6961 6c5f  ray([HB_initial_
-0000fa30: 6775 6573 732c 2043 3133 5f69 6e69 7469  guess, C13_initi
-0000fa40: 616c 5f67 7565 7373 5d29 0a0a 2020 2020  al_guess])..    
-0000fa50: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000fa60: 692c 2063 656e 2069 6e20 656e 756d 6572  i, cen in enumer
-0000fa70: 6174 6528 7065 616b 5f70 6f73 5f6c 6566  ate(peak_pos_lef
-0000fa80: 7429 3a0a 0a20 2020 2020 2020 2020 2020  t):..           
-0000fa90: 2020 2020 2020 2020 2069 6620 693d 3d30           if i==0
-0000faa0: 3a20 2320 5468 6973 2069 7320 7468 6520  : # This is the 
-0000fab0: 686f 7462 616e 640a 2020 2020 2020 2020  hotband.        
-0000fac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fad0: 7065 616b 2c20 7061 7273 203d 2061 6464  peak, pars = add
-0000fae0: 5f70 6561 6b28 7072 6566 6978 3d27 6c7a  _peak(prefix='lz
-0000faf0: 2564 5f27 2025 2028 692b 3229 2c20 6365  %d_' % (i+2), ce
-0000fb00: 6e74 6572 3d63 656e 2c0a 2020 2020 2020  nter=cen,.      
-0000fb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb20: 2020 6d69 6e5f 6365 6e74 3d63 656e 2d33    min_cent=cen-3
-0000fb30: 2a73 7065 635f 7265 732c 206d 6178 5f63  *spec_res, max_c
-0000fb40: 656e 743d 6365 6e2b 332a 7370 6563 5f72  ent=cen+3*spec_r
-0000fb50: 6573 2c20 7369 676d 613d 7369 676d 615f  es, sigma=sigma_
-0000fb60: 696e 692c 0a20 2020 2020 2020 2020 2020  ini,.           
-0000fb70: 2020 2020 2020 2020 2020 2020 206d 696e               min
-0000fb80: 5f73 6967 6d61 3d73 6967 6d61 5f69 6e69  _sigma=sigma_ini
-0000fb90: 2a63 6f6e 6669 6731 2e48 425f 7369 676d  *config1.HB_sigm
-0000fba0: 615f 6d69 6e5f 616c 6c6f 7761 6e63 652c  a_min_allowance,
-0000fbb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fbc0: 2020 2020 2020 2020 206d 6178 5f73 6967           max_sig
-0000fbd0: 6d61 3d73 6967 6d61 5f69 6e69 2a63 6f6e  ma=sigma_ini*con
-0000fbe0: 6669 6731 2e48 425f 7369 676d 615f 6d61  fig1.HB_sigma_ma
-0000fbf0: 785f 616c 6c6f 7761 6e63 652c 0a20 2020  x_allowance,.   
-0000fc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc10: 2020 2020 2061 6d70 6c69 7475 6465 3d63       amplitude=c
-0000fc20: 616c 635f 4842 5f61 6d70 6c69 7475 6465  alc_HB_amplitude
-0000fc30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000fc40: 2020 2020 2020 2020 2020 6d69 6e5f 616d            min_am
-0000fc50: 706c 6974 7564 653d 416d 706c 6974 7564  plitude=Amplitud
-0000fc60: 655f 696e 692a 636f 6e66 6967 312e 4842  e_ini*config1.HB
-0000fc70: 5f61 6d70 5f6d 696e 5f61 6c6c 6f77 616e  _amp_min_allowan
-0000fc80: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-0000fc90: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
-0000fca0: 616d 706c 6974 7564 653d 416d 706c 6974  amplitude=Amplit
-0000fcb0: 7564 655f 696e 692a 636f 6e66 6967 312e  ude_ini*config1.
-0000fcc0: 4842 5f61 6d70 5f6d 6178 5f61 6c6c 6f77  HB_amp_max_allow
-0000fcd0: 616e 6365 2c0a 2020 2020 2020 2020 2020  ance,.          
-0000fce0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-0000fcf0: 6465 6c5f 6e61 6d65 3d63 6f6e 6669 6731  del_name=config1
-0000fd00: 2e6d 6f64 656c 5f6e 616d 6529 0a20 2020  .model_name).   
-0000fd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd20: 2020 2020 206d 6f64 656c 203d 2070 6561       model = pea
-0000fd30: 6b2b 6d6f 6465 6c31 0a20 2020 2020 2020  k+model1.       
-0000fd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd50: 2070 6172 616d 732e 7570 6461 7465 2870   params.update(p
-0000fd60: 6172 7329 0a20 2020 2020 2020 2020 2020  ars).           
-0000fd70: 2020 2020 2020 2020 2069 6620 693d 3d31           if i==1
-0000fd80: 3a20 2320 5468 6973 2069 7320 6331 330a  : # This is c13.
-0000fd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fda0: 2020 2020 2020 2020 7065 616b 2c20 7061          peak, pa
-0000fdb0: 7273 203d 2061 6464 5f70 6561 6b28 7072  rs = add_peak(pr
-0000fdc0: 6566 6978 3d27 6c7a 2564 5f27 2025 2028  efix='lz%d_' % (
-0000fdd0: 692b 3229 2c20 6365 6e74 6572 3d63 656e  i+2), center=cen
-0000fde0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000fdf0: 2020 2020 2020 2020 2020 6d69 6e5f 6365            min_ce
-0000fe00: 6e74 3d63 656e 2d33 2a73 7065 635f 7265  nt=cen-3*spec_re
-0000fe10: 732c 206d 6178 5f63 656e 743d 6365 6e2b  s, max_cent=cen+
-0000fe20: 332a 7370 6563 5f72 6573 2c0a 2020 2020  3*spec_res,.    
-0000fe30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe40: 2020 2020 7369 676d 613d 7369 676d 615f      sigma=sigma_
-0000fe50: 696e 692f 352c 0a20 2020 2020 2020 2020  ini/5,.         
-0000fe60: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000fe70: 696e 5f73 6967 6d61 3d73 6967 6d61 5f69  in_sigma=sigma_i
-0000fe80: 6e69 2f32 302c 0a20 2020 2020 2020 2020  ni/20,.         
-0000fe90: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000fea0: 6178 5f73 6967 6d61 3d73 6967 6d61 5f69  ax_sigma=sigma_i
-0000feb0: 6e69 2f32 2c0a 2020 2020 2020 2020 2020  ni/2,.          
-0000fec0: 2020 2020 2020 2020 2020 2020 2020 616d                am
-0000fed0: 706c 6974 7564 653d 6361 6c63 5f43 3133  plitude=calc_C13
-0000fee0: 5f61 6d70 6c69 7475 6465 2c0a 2020 2020  _amplitude,.    
-0000fef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff00: 2020 2020 6d69 6e5f 616d 706c 6974 7564      min_amplitud
-0000ff10: 653d 6361 6c63 5f43 3133 5f61 6d70 6c69  e=calc_C13_ampli
-0000ff20: 7475 6465 2a28 302e 352a 636f 6e66 6967  tude*(0.5*config
-0000ff30: 312e 4842 5f61 6d70 5f6d 696e 5f61 6c6c  1.HB_amp_min_all
-0000ff40: 6f77 616e 6365 292c 0a20 2020 2020 2020  owance),.       
-0000ff50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff60: 206d 6178 5f61 6d70 6c69 7475 6465 3d63   max_amplitude=c
-0000ff70: 616c 635f 4331 335f 616d 706c 6974 7564  alc_C13_amplitud
-0000ff80: 652a 322a 2863 6f6e 6669 6731 2e48 425f  e*2*(config1.HB_
-0000ff90: 616d 705f 6d61 785f 616c 6c6f 7761 6e63  amp_max_allowanc
-0000ffa0: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-0000ffb0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-0000ffc0: 6c5f 6e61 6d65 3d63 6f6e 6669 6731 2e6d  l_name=config1.m
-0000ffd0: 6f64 656c 5f6e 616d 6529 0a20 2020 2020  odel_name).     
-0000ffe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fff0: 2020 206d 6f64 656c 203d 2070 6561 6b2b     model = peak+
-00010000: 6d6f 6465 6c0a 2020 2020 2020 2020 2020  model.          
-00010010: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00010020: 7261 6d73 2e75 7064 6174 6528 7061 7273  rams.update(pars
-00010030: 290a 0a0a 0a0a 2020 2020 2020 2020 2020  ).....          
-00010040: 2020 2020 2020 6d6f 6465 6c5f 463d 6d6f        model_F=mo
-00010050: 6465 6c0a 0a0a 0a20 2020 2020 2020 2020  del....         
-00010060: 2020 2020 2020 2023 2041 7474 656d 7074         # Attempt
-00010070: 2061 7420 7374 6162 696c 697a 696e 6720   at stabilizing 
-00010080: 7065 616b 2066 6974 0a20 2020 2020 2020  peak fit.       
-00010090: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-000100a0: 3d20 6d6f 6465 6c5f 462e 6669 7428 7964  = model_F.fit(yd
-000100b0: 6174 2c20 7061 7273 312c 2078 3d78 6461  at, pars1, x=xda
-000100c0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-000100d0: 2020 2072 6573 756c 742e 7061 7261 6d73     result.params
-000100e0: 5b27 6c7a 325f 6365 6e74 6572 275d 2e76  ['lz2_center'].v
-000100f0: 6172 7920 3d20 4661 6c73 650a 2020 2020  ary = False.    
-00010100: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00010110: 6c74 2e70 6172 616d 735b 276c 7a32 5f61  lt.params['lz2_a
-00010120: 6d70 6c69 7475 6465 275d 2e76 6172 7920  mplitude'].vary 
-00010130: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00010140: 2020 2020 2020 2020 7265 7375 6c74 2e70          result.p
-00010150: 6172 616d 735b 276c 7a32 5f73 6967 6d61  arams['lz2_sigma
-00010160: 275d 2e76 6172 7920 3d20 4661 6c73 650a  '].vary = False.
+00000100: 5f70 6561 6b73 0a69 6d70 6f72 7420 6f73  _peaks.import os
+00000110: 0a69 6d70 6f72 7420 7265 0a66 726f 6d20  .import re.from 
+00000120: 6f73 2069 6d70 6f72 7420 6c69 7374 6469  os import listdi
+00000130: 720a 6672 6f6d 206f 732e 7061 7468 2069  r.from os.path i
+00000140: 6d70 6f72 7420 6973 6669 6c65 2c20 6a6f  mport isfile, jo
+00000150: 696e 0a66 726f 6d20 4469 6164 4669 742e  in.from DiadFit.
+00000160: 696d 706f 7274 696e 675f 6461 7461 5f66  importing_data_f
+00000170: 696c 6573 2069 6d70 6f72 7420 2a0a 6672  iles import *.fr
+00000180: 6f6d 2074 7970 696e 6720 696d 706f 7274  om typing import
+00000190: 2054 7570 6c65 2c20 4f70 7469 6f6e 616c   Tuple, Optional
+000001a0: 0a66 726f 6d20 6461 7461 636c 6173 7365  .from dataclasse
+000001b0: 7320 696d 706f 7274 2064 6174 6163 6c61  s import datacla
+000001c0: 7373 0a69 6d70 6f72 7420 6d61 7470 6c6f  ss.import matplo
+000001d0: 746c 6962 2e70 6174 6368 6573 2061 7320  tlib.patches as 
+000001e0: 7061 7463 6865 730a 696d 706f 7274 2077  patches.import w
+000001f0: 6172 6e69 6e67 7320 6173 2077 0a66 726f  arnings as w.fro
+00000200: 6d20 7471 646d 2069 6d70 6f72 7420 7471  m tqdm import tq
+00000210: 646d 0a66 726f 6d20 6e75 6d70 7920 696d  dm.from numpy im
+00000220: 706f 7274 2074 7261 707a 0a66 726f 6d20  port trapz.from 
+00000230: 7363 6970 792e 696e 7465 6772 6174 6520  scipy.integrate 
+00000240: 696d 706f 7274 2073 696d 7073 0a66 726f  import simps.fro
+00000250: 6d20 7363 6970 792e 696e 7465 7270 6f6c  m scipy.interpol
+00000260: 6174 6520 696d 706f 7274 2069 6e74 6572  ate import inter
+00000270: 7031 640a 0a23 2041 6c6c 6f77 6564 206d  p1d..# Allowed m
+00000280: 6f64 656c 730a 0a61 6c6c 6f77 6564 5f6d  odels..allowed_m
+00000290: 6f64 656c 7320 3d20 5b22 566f 6967 744d  odels = ["VoigtM
+000002a0: 6f64 656c 222c 2022 5073 6575 646f 566f  odel", "PseudoVo
+000002b0: 6967 744d 6f64 656c 222c 2022 5065 6172  igtModel", "Pear
+000002c0: 736f 6e34 4d6f 6465 6c22 2c20 2253 6b65  son4Model", "Ske
+000002d0: 7765 6456 6f69 6774 4d6f 6465 6c22 5d0a  wedVoigtModel"].
+000002e0: 0a23 2046 6f72 2064 6562 7567 6769 6e0a  .# For debuggin.
+000002f0: 0a23 696d 706f 7274 2077 6172 6e69 6e67  .#import warning
+00000300: 730a 2377 6172 6e69 6e67 732e 7369 6d70  s.#warnings.simp
+00000310: 6c65 6669 6c74 6572 2827 6572 726f 7227  lefilter('error'
+00000320: 290a 0a65 6e63 6f64 653d 2249 534f 2d38  )..encode="ISO-8
+00000330: 3835 392d 3122 0a23 2320 5261 7469 6f20  859-1".## Ratio 
+00000340: 6f66 2064 6966 6665 7265 6e74 2070 6561  of different pea
+00000350: 6b73 0a0a 0a64 6566 2063 616c 6375 6c61  ks...def calcula
+00000360: 7465 5f53 4f32 5f43 4f32 5f72 6174 696f  te_SO2_CO2_ratio
+00000370: 2853 4f32 5f61 7265 612c 2064 6961 6431  (SO2_area, diad1
+00000380: 5f61 7265 612c 2064 6961 6432 5f61 7265  _area, diad2_are
+00000390: 612c 2053 4f32 5f63 726f 7373 5f73 6563  a, SO2_cross_sec
+000003a0: 3d35 2e33 2c20 6469 6164 315f 6372 6f73  =5.3, diad1_cros
+000003b0: 735f 7365 633d 302e 3839 2c20 6469 6164  s_sec=0.89, diad
+000003c0: 325f 6372 6f73 735f 7365 633d 312e 3429  2_cross_sec=1.4)
+000003d0: 3a0a 2020 2020 2222 2220 4361 6c63 756c  :.    """ Calcul
+000003e0: 6174 6573 2053 4f32 3a43 4f32 2072 6174  ates SO2:CO2 rat
+000003f0: 696f 2075 7369 6e67 2074 6865 2070 6172  io using the par
+00000400: 616d 6574 6572 7320 6672 6f6d 204d 6172  ameters from Mar
+00000410: 6965 2d43 616d 696c 6c65 2043 6175 6d6f  ie-Camille Caumo
+00000420: 6e73 206c 6162 2222 220a 0a0a 2020 2020  ns lab"""...    
+00000430: 415f 434f 325f 7374 6172 3d28 2064 6961  A_CO2_star=( dia
+00000440: 6431 5f61 7265 6120 2b20 6469 6164 325f  d1_area + diad2_
+00000450: 6172 6561 292f 2864 6961 6432 5f63 726f  area)/(diad2_cro
+00000460: 7373 5f73 6563 2b64 6961 6431 5f63 726f  ss_sec+diad1_cro
+00000470: 7373 5f73 6563 290a 2020 2020 415f 534f  ss_sec).    A_SO
+00000480: 325f 7374 6172 3d28 534f 325f 6172 6561  2_star=(SO2_area
+00000490: 292f 2853 4f32 5f63 726f 7373 5f73 6563  )/(SO2_cross_sec
+000004a0: 290a 2020 2020 5261 7469 6f3d 415f 534f  ).    Ratio=A_SO
+000004b0: 325f 7374 6172 2f28 415f 534f 325f 7374  2_star/(A_SO2_st
+000004c0: 6172 2b41 5f43 4f32 5f73 7461 7229 0a0a  ar+A_CO2_star)..
+000004d0: 2020 2020 7265 7475 726e 2052 6174 696f      return Ratio
+000004e0: 0a0a 6465 6620 6361 6c63 756c 6174 655f  ..def calculate_
+000004f0: 6d6f 6c65 5f66 7261 6374 696f 6e5f 3263  mole_fraction_2c
+00000500: 6f6d 7028 7065 616b 5f61 7265 615f 612c  omp(peak_area_a,
+00000510: 2070 6561 6b5f 6172 6561 5f62 2c20 6372   peak_area_b, cr
+00000520: 6f73 735f 7365 6374 696f 6e5f 612c 2063  oss_section_a, c
+00000530: 726f 7373 5f73 6563 7469 6f6e 5f62 2c20  ross_section_b, 
+00000540: 696e 7374 7275 6d65 6e74 5f65 6666 5f61  instrument_eff_a
+00000550: 2c20 696e 7374 7275 6d65 6e74 5f65 6666  , instrument_eff
+00000560: 5f62 293a 0a20 2020 2022 2222 2054 6869  _b):.    """ Thi
+00000570: 7320 6675 6e63 7469 6f6e 2063 616c 6375  s function calcu
+00000580: 6c61 7465 7320 7468 6520 6d6f 6c61 7220  lates the molar 
+00000590: 7261 7469 6f6e 206f 6620 3220 636f 6d70  ration of 2 comp
+000005a0: 6f6e 656e 7473 2061 2061 6e64 2062 2062  onents a and b b
+000005b0: 6173 6564 206f 6e20 7065 616b 2061 7265  ased on peak are
+000005c0: 6173 2c0a 2020 2020 6372 6f73 7320 7365  as,.    cross se
+000005d0: 6374 696f 6e20 616e 6420 696e 7374 7275  ction and instru
+000005e0: 6d65 6e74 2065 6666 6963 6965 6e63 790a  ment efficiency.
+000005f0: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
+00000600: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
+00000610: 0a0a 2020 2020 7065 616b 5f61 7265 615f  ..    peak_area_
+00000620: 613a 2069 6e74 2c20 666c 6f61 742c 2070  a: int, float, p
+00000630: 642e 5365 7269 6573 2c20 6e70 2e61 7272  d.Series, np.arr
+00000640: 6179 0a20 2020 2020 2020 2050 6561 6b20  ay.        Peak 
+00000650: 6172 6561 206f 6620 636f 6d70 6f6e 656e  area of componen
+00000660: 7420 610a 0a20 2020 2070 6561 6b5f 6172  t a..    peak_ar
+00000670: 6561 5f62 3a20 696e 742c 2066 6c6f 6174  ea_b: int, float
+00000680: 2c20 7064 2e53 6572 6965 732c 206e 702e  , pd.Series, np.
+00000690: 6172 7261 790a 2020 2020 2020 2020 5065  array.        Pe
+000006a0: 616b 2061 7265 6120 6f66 2063 6f6d 706f  ak area of compo
+000006b0: 6e65 6e74 2062 0a0a 2020 2020 6372 6f73  nent b..    cros
+000006c0: 735f 7365 6374 696f 6e5f 612c 2063 726f  s_section_a, cro
+000006d0: 7373 5f73 6563 7469 6f6e 5f61 3a20 696e  ss_section_a: in
+000006e0: 742c 2066 6c6f 6174 0a20 2020 2020 2020  t, float.       
+000006f0: 2052 616d 616e 2063 726f 7373 2073 6563   Raman cross sec
+00000700: 7469 6f6e 2066 6f72 2063 6f6d 706f 6e65  tion for compone
+00000710: 6e74 2061 2061 6e64 2062 0a0a 2020 2020  nt a and b..    
+00000720: 696e 7374 7275 6d65 6e74 5f65 6666 5f61  instrument_eff_a
+00000730: 2c20 696e 7374 7275 6d65 6e74 5f65 6666  , instrument_eff
+00000740: 5f62 3a20 696e 742c 2066 6c6f 6174 0a20  _b: int, float. 
+00000750: 2020 2020 2020 2049 6e73 7472 756d 656e         Instrumen
+00000760: 7420 6566 6665 6369 656e 6379 206f 6620  t effeciency of 
+00000770: 6120 616e 6420 622e 0a0a 2020 2020 5265  a and b...    Re
+00000780: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00000790: 2d2d 2d2d 2d2d 0a20 2020 2070 642e 4461  ------.    pd.Da
+000007a0: 7461 4672 616d 650a 2020 2020 2020 2020  taFrame.        
+000007b0: 4d6f 6c61 7220 7261 7469 6f20 6f66 2061  Molar ratio of a
+000007c0: 2f62 0a0a 0a20 2020 2022 2222 0a0a 2020  /b...    """..  
+000007d0: 2020 5375 6d5f 7068 6173 655f 613d 7065    Sum_phase_a=pe
+000007e0: 616b 5f61 7265 615f 612f 2863 726f 7373  ak_area_a/(cross
+000007f0: 5f73 6563 7469 6f6e 5f61 2a69 6e73 7472  _section_a*instr
+00000800: 756d 656e 745f 6566 665f 6129 0a20 2020  ument_eff_a).   
+00000810: 2053 756d 5f70 6861 7365 5f62 3d70 6561   Sum_phase_b=pea
+00000820: 6b5f 6172 6561 5f62 2f28 6372 6f73 735f  k_area_b/(cross_
+00000830: 7365 6374 696f 6e5f 622a 696e 7374 7275  section_b*instru
+00000840: 6d65 6e74 5f65 6666 5f62 290a 0a20 2020  ment_eff_b)..   
+00000850: 2064 663d 7064 2e44 6174 6146 7261 6d65   df=pd.DataFrame
+00000860: 2864 6174 613d 7b27 2520 4127 3a20 3130  (data={'% A': 10
+00000870: 302a 5375 6d5f 7068 6173 655f 612f 2853  0*Sum_phase_a/(S
+00000880: 756d 5f70 6861 7365 5f62 2b53 756d 5f70  um_phase_b+Sum_p
+00000890: 6861 7365 5f61 292c 0a20 2020 2027 2520  hase_a),.    '% 
+000008a0: 4227 3a20 3130 302d 3130 302a 5375 6d5f  B': 100-100*Sum_
+000008b0: 7068 6173 655f 612f 2853 756d 5f70 6861  phase_a/(Sum_pha
+000008c0: 7365 5f62 2b53 756d 5f70 6861 7365 5f61  se_b+Sum_phase_a
+000008d0: 297d 0a20 2020 2029 0a0a 2020 2020 7265  )}.    )..    re
+000008e0: 7475 726e 2064 660a 6465 6620 706c 6f74  turn df.def plot
+000008f0: 5f64 6961 6428 2a2c 7061 7468 3d4e 6f6e  _diad(*,path=Non
+00000900: 652c 2066 696c 656e 616d 653d 4e6f 6e65  e, filename=None
+00000910: 2c20 6669 6c65 7479 7065 3d27 5769 7465  , filetype='Wite
+00000920: 635f 4153 4349 4927 2c20 5370 6563 7472  c_ASCII', Spectr
+00000930: 615f 783d 4e6f 6e65 2c20 5370 6563 7472  a_x=None, Spectr
+00000940: 615f 793d 4e6f 6e65 293a 0a20 2020 2022  a_y=None):.    "
+00000950: 2222 5468 6973 2066 756e 6374 696f 6e20  ""This function 
+00000960: 6d61 6b65 7320 6120 706c 6f74 206f 6620  makes a plot of 
+00000970: 7468 6520 7370 6563 7472 6120 666f 7220  the spectra for 
+00000980: 6120 7370 6563 6966 6963 2066 696c 6520  a specific file 
+00000990: 746f 2061 6c6c 6f77 2076 6973 7561 6c20  to allow visual 
+000009a0: 696e 7370 6563 746f 696e 0a0a 2020 2020  inspectoin..    
+000009b0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+000009c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
+000009d0: 2020 2020 4569 7468 6572 0a0a 2020 2020      Either..    
+000009e0: 7061 7468 3a20 7374 720a 2020 2020 2020  path: str.      
+000009f0: 2020 466f 6c64 6572 2077 6865 7265 2073    Folder where s
+00000a00: 7065 6374 7261 2069 7320 7374 6f72 6564  pectra is stored
+00000a10: 0a20 2020 2066 696c 656e 616d 653a 2073  .    filename: s
+00000a20: 7472 0a20 2020 2020 2020 2046 696c 656e  tr.        Filen
+00000a30: 616d 6520 6f66 2073 7065 6369 6669 6320  ame of specific 
+00000a40: 7370 6563 7472 6120 6669 6c65 206f 6620  spectra file of 
+00000a50: 696e 7465 7265 7374 0a20 2020 2066 696c  interest.    fil
+00000a60: 6574 7970 653a 2073 7472 0a20 2020 2020  etype: str.     
+00000a70: 2020 2063 686f 6f73 6520 6672 6f6d 2027     choose from '
+00000a80: 5769 7465 635f 4153 4349 4927 2c20 2768  Witec_ASCII', 'h
+00000a90: 6561 646c 6573 735f 7478 7427 2c20 2768  eadless_txt', 'h
+00000aa0: 6561 646c 6573 735f 6373 7627 2c20 2768  eadless_csv', 'h
+00000ab0: 6561 645f 6373 7627 2c20 2757 6974 6563  ead_csv', 'Witec
+00000ac0: 5f41 5343 4949 272c 0a20 2020 2020 2020  _ASCII',.       
+00000ad0: 2027 484f 5249 4241 5f74 7874 272c 2027   'HORIBA_txt', '
+00000ae0: 5265 6e69 7368 6177 5f74 7874 270a 2020  Renishaw_txt'.  
+00000af0: 2020 4f72 0a20 2020 2020 2020 2053 7065    Or.        Spe
+00000b00: 6374 7261 5f78 3a20 6e70 2e61 7272 6179  ctra_x: np.array
+00000b10: 206f 6620 7820 636f 6f72 6469 6e61 7465   of x coordinate
+00000b20: 730a 2020 2020 2020 2020 5370 6563 7472  s.        Spectr
+00000b30: 615f 793a 206e 702e 6172 7261 7920 6f66  a_y: np.array of
+00000b40: 2079 2063 6f6f 7264 696e 6174 6573 0a0a   y coordinates..
+00000b50: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00000b60: 2020 2020 706c 6f74 7320 6669 6775 7265      plots figure
+00000b70: 2077 6974 6820 636f 6d6d 6f6e 2070 6561   with common pea
+00000b80: 6b73 206f 7665 726c 6169 6e0a 0a0a 2020  ks overlain...  
+00000b90: 2020 2222 220a 2020 2020 6966 2027 4352    """.    if 'CR
+00000ba0: 5227 2069 6e20 6669 6c65 6e61 6d65 3a0a  R' in filename:.
+00000bb0: 2020 2020 2020 2020 6669 6c65 7479 7065          filetype
+00000bc0: 3d27 6865 6164 6c65 7373 5f74 7874 270a  ='headless_txt'.
+00000bd0: 0a20 2020 2069 6620 5370 6563 7472 615f  .    if Spectra_
+00000be0: 7820 6973 204e 6f6e 653a 0a20 2020 2020  x is None:.     
+00000bf0: 2020 2053 7065 6374 7261 5f64 663d 6765     Spectra_df=ge
+00000c00: 745f 6461 7461 2870 6174 683d 7061 7468  t_data(path=path
+00000c10: 2c20 6669 6c65 6e61 6d65 3d66 696c 656e  , filename=filen
+00000c20: 616d 652c 2066 696c 6574 7970 653d 6669  ame, filetype=fi
+00000c30: 6c65 7479 7065 290a 0a20 2020 2020 2020  letype)..       
+00000c40: 2053 7065 6374 7261 3d6e 702e 6172 7261   Spectra=np.arra
+00000c50: 7928 5370 6563 7472 615f 6466 290a 0a20  y(Spectra_df).. 
+00000c60: 2020 2020 2020 2053 7065 6374 7261 5f78         Spectra_x
+00000c70: 3d53 7065 6374 7261 5b3a 2c20 305d 0a20  =Spectra[:, 0]. 
+00000c80: 2020 2020 2020 2053 7065 6374 7261 5f79         Spectra_y
+00000c90: 3d53 7065 6374 7261 5b3a 2c20 315d 0a0a  =Spectra[:, 1]..
+00000ca0: 0a0a 0a20 2020 2066 6967 2c20 2861 7831  ...    fig, (ax1
+00000cb0: 2920 3d20 706c 742e 7375 6270 6c6f 7473  ) = plt.subplots
+00000cc0: 2831 2c20 312c 2066 6967 7369 7a65 3d28  (1, 1, figsize=(
+00000cd0: 342c 3329 290a 0a20 2020 206d 696e 793d  4,3))..    miny=
+00000ce0: 6e70 2e6d 696e 2853 7065 6374 7261 5f79  np.min(Spectra_y
+00000cf0: 290a 2020 2020 6d61 7879 3d6e 702e 6d61  ).    maxy=np.ma
+00000d00: 7828 5370 6563 7472 615f 7929 0a20 2020  x(Spectra_y).   
+00000d10: 2061 7831 2e70 6c6f 7428 5b31 3039 302c   ax1.plot([1090,
+00000d20: 2031 3039 305d 2c20 5b6d 696e 792c 206d   1090], [miny, m
+00000d30: 6178 795d 2c20 273a 6b27 2c20 6c61 6265  axy], ':k', labe
+00000d40: 6c3d 274d 6167 6e65 7369 7465 2729 0a20  l='Magnesite'). 
+00000d50: 2020 2061 7831 2e70 6c6f 7428 5b31 3133     ax1.plot([113
+00000d60: 312c 2031 3133 315d 2c20 5b6d 696e 792c  1, 1131], [miny,
+00000d70: 206d 6178 795d 2c20 272d 272c 2020 616c   maxy], '-',  al
+00000d80: 7068 613d 302e 352c 636f 6c6f 723d 2767  pha=0.5,color='g
+00000d90: 7265 7927 2c20 6c61 6265 6c3d 2741 6e68  rey', label='Anh
+00000da0: 7964 7269 7465 2f4d 672d 5375 6c66 6174  ydrite/Mg-Sulfat
+00000db0: 6527 290a 2020 2020 2361 7831 2e70 6c6f  e').    #ax1.plo
+00000dc0: 7428 5b31 3133 362c 2031 3133 365d 2c20  t([1136, 1136], 
+00000dd0: 5b6d 696e 792c 206d 6178 795d 2c20 272d  [miny, maxy], '-
+00000de0: 272c 2063 6f6c 6f72 3d27 6772 6579 272c  ', color='grey',
+00000df0: 206c 6162 656c 3d27 4d67 2d53 756c 6661   label='Mg-Sulfa
+00000e00: 7465 2729 0a20 2020 2061 7831 2e70 6c6f  te').    ax1.plo
+00000e10: 7428 5b31 3135 312c 2031 3135 315d 2c20  t([1151, 1151], 
+00000e20: 5b6d 696e 792c 206d 6178 795d 2c20 273a  [miny, maxy], ':
+00000e30: 6327 2c20 6c61 6265 6c3d 2753 4f32 2729  c', label='SO2')
+00000e40: 0a20 2020 2061 7831 2e70 6c6f 7428 5b31  .    ax1.plot([1
+00000e50: 3238 362c 2031 3238 365d 2c20 5b6d 696e  286, 1286], [min
+00000e60: 792c 206d 6178 795d 2c20 272d 6727 2c20  y, maxy], '-g', 
+00000e70: 2061 6c70 6861 3d30 2e35 2c6c 6162 656c   alpha=0.5,label
+00000e80: 3d27 4469 6164 3127 290a 2020 2020 6178  ='Diad1').    ax
+00000e90: 312e 706c 6f74 285b 3133 3839 2c20 3133  1.plot([1389, 13
+00000ea0: 3839 5d2c 205b 6d69 6e79 2c20 6d61 7879  89], [miny, maxy
+00000eb0: 5d2c 2027 2d6d 272c 2061 6c70 6861 3d30  ], '-m', alpha=0
+00000ec0: 2e35 2c20 6c61 6265 6c3d 2744 6961 6432  .5, label='Diad2
+00000ed0: 2729 0a20 2020 2061 7831 2e6c 6567 656e  ').    ax1.legen
+00000ee0: 6428 290a 2020 2020 6178 312e 706c 6f74  d().    ax1.plot
+00000ef0: 2853 7065 6374 7261 5f78 2c20 5370 6563  (Spectra_x, Spec
+00000f00: 7472 615f 792c 2027 2d72 2729 0a20 2020  tra_y, '-r').   
+00000f10: 2061 7831 2e73 6574 5f78 6c61 6265 6c28   ax1.set_xlabel(
+00000f20: 2757 6176 656e 756d 6265 7220 2863 6d2d  'Wavenumber (cm-
+00000f30: 3129 2729 0a20 2020 2061 7831 2e73 6574  1)').    ax1.set
+00000f40: 5f79 6c61 6265 6c28 2749 6e74 656e 7369  _ylabel('Intensi
+00000f50: 7479 2729 0a0a 0a0a 0a0a 4064 6174 6163  ty')......@datac
+00000f60: 6c61 7373 0a63 6c61 7373 2064 6961 645f  lass.class diad_
+00000f70: 6964 5f63 6f6e 6669 673a 0a0a 2020 2020  id_config:..    
+00000f80: 2320 5468 7265 7368 6f6c 6473 2066 6f72  # Thresholds for
+00000f90: 2053 6369 7079 2066 696e 6420 7065 616b   Scipy find peak
+00000fa0: 730a 2020 2020 6865 6967 6874 3a20 666c  s.    height: fl
+00000fb0: 6f61 7420 3d20 310a 2020 2020 7769 6474  oat = 1.    widt
+00000fc0: 683a 2066 6c6f 6174 3d30 2e35 0a20 2020  h: float=0.5.   
+00000fd0: 2070 726f 6d69 6e65 6e63 653a 2066 6c6f   prominence: flo
+00000fe0: 6174 3d35 300a 0a20 2020 2023 2074 6f20  at=50..    # to 
+00000ff0: 706c 6f74 206f 7220 6e6f 7420 746f 2070  plot or not to p
+00001000: 6c6f 740a 2020 2020 706c 6f74 5f66 6967  lot.    plot_fig
+00001010: 7572 653a 2062 6f6f 6c20 3d20 5472 7565  ure: bool = True
+00001020: 0a0a 0a20 2020 2023 2045 7863 6c75 6465  ...    # Exclude
+00001030: 2061 2072 616e 6765 2c20 652e 672e 2063   a range, e.g. c
+00001040: 6f73 6d69 6320 7261 7973 0a20 2020 2065  osmic rays.    e
+00001050: 7863 6c75 6465 5f72 616e 6765 313a 204f  xclude_range1: O
+00001060: 7074 696f 6e61 6c20 5b54 7570 6c65 5b66  ptional [Tuple[f
+00001070: 6c6f 6174 2c20 666c 6f61 745d 5d20 3d20  loat, float]] = 
+00001080: 4e6f 6e65 0a20 2020 2065 7863 6c75 6465  None.    exclude
+00001090: 5f72 616e 6765 323a 204f 7074 696f 6e61  _range2: Optiona
+000010a0: 6c20 5b54 7570 6c65 5b66 6c6f 6174 2c20  l [Tuple[float, 
+000010b0: 666c 6f61 745d 5d20 3d20 4e6f 6e65 0a20  float]] = None. 
+000010c0: 2020 2023 2041 7070 726f 7869 6d61 7465     # Approximate
+000010d0: 2064 6961 6420 706f 7369 7469 6f6e 0a20   diad position. 
+000010e0: 2020 2061 7070 726f 785f 6469 6164 325f     approx_diad2_
+000010f0: 706f 733a 2054 7570 6c65 5b66 6c6f 6174  pos: Tuple[float
+00001100: 2c20 666c 6f61 745d 3d28 3133 3739 2c20  , float]=(1379, 
+00001110: 3133 3935 290a 2020 2020 6170 7072 6f78  1395).    approx
+00001120: 5f64 6961 6431 5f70 6f73 3a20 5475 706c  _diad1_pos: Tupl
+00001130: 655b 666c 6f61 742c 2066 6c6f 6174 5d3d  e[float, float]=
+00001140: 2831 3237 352c 2031 3239 3029 0a0a 0a20  (1275, 1290)... 
+00001150: 2020 2023 2042 6163 6b67 726f 756e 6420     # Background 
+00001160: 706f 7369 7469 6f6e 7320 666f 7220 7072  positions for pr
+00001170: 6f6d 696e 656e 6365 0a20 2020 204c 485f  ominence.    LH_
+00001180: 6263 6b5f 6469 6164 313d 5b31 3138 302c  bck_diad1=[1180,
+00001190: 2031 3232 305d 0a20 2020 204c 485f 6263   1220].    LH_bc
+000011a0: 6b5f 6469 6164 323d 5b31 3333 302c 2031  k_diad2=[1330, 1
+000011b0: 3335 305d 0a20 2020 2052 485f 6263 6b5f  350].    RH_bck_
+000011c0: 6469 6164 313d 5b31 3333 302c 2031 3335  diad1=[1330, 135
+000011d0: 305d 0a20 2020 2052 485f 6263 6b5f 6469  0].    RH_bck_di
+000011e0: 6164 323d 5b31 3435 302c 2031 3437 305d  ad2=[1450, 1470]
+000011f0: 0a0a 2020 2020 4469 6164 5f77 696e 646f  ..    Diad_windo
+00001200: 775f 7769 6474 683d 3330 0a0a 2020 2020  w_width=30..    
+00001210: 4469 6164 325f 7769 6e64 6f77 3a20 5475  Diad2_window: Tu
+00001220: 706c 655b 666c 6f61 742c 2066 6c6f 6174  ple[float, float
+00001230: 5d3d 2861 7070 726f 785f 6469 6164 325f  ]=(approx_diad2_
+00001240: 706f 735b 305d 2d44 6961 645f 7769 6e64  pos[0]-Diad_wind
+00001250: 6f77 5f77 6964 7468 2c20 6170 7072 6f78  ow_width, approx
+00001260: 5f64 6961 6432 5f70 6f73 5b31 5d2b 4469  _diad2_pos[1]+Di
+00001270: 6164 5f77 696e 646f 775f 7769 6474 6829  ad_window_width)
+00001280: 0a20 2020 2044 6961 6431 5f77 696e 646f  .    Diad1_windo
+00001290: 773a 2054 7570 6c65 5b66 6c6f 6174 2c20  w: Tuple[float, 
+000012a0: 666c 6f61 745d 3d28 6170 7072 6f78 5f64  float]=(approx_d
+000012b0: 6961 6431 5f70 6f73 5b30 5d2d 4469 6164  iad1_pos[0]-Diad
+000012c0: 5f77 696e 646f 775f 7769 6474 682c 2061  _window_width, a
+000012d0: 7070 726f 785f 6469 6164 315f 706f 735b  pprox_diad1_pos[
+000012e0: 315d 290a 0a20 2020 2061 7070 726f 785f  1])..    approx_
+000012f0: 6469 6164 325f 706f 735f 3370 6561 6b73  diad2_pos_3peaks
+00001300: 3a20 5475 706c 655b 666c 6f61 742c 2066  : Tuple[float, f
+00001310: 6c6f 6174 5d3d 2831 3337 392c 2031 3339  loat]=(1379, 139
+00001320: 352c 2031 3337 392d 3137 290a 0a0a 0a0a  5, 1379-17).....
+00001330: 0a0a 6465 6620 6964 656e 7469 6679 5f64  ..def identify_d
+00001340: 6961 645f 7065 616b 7328 2a2c 2063 6f6e  iad_peaks(*, con
+00001350: 6669 673a 2064 6961 645f 6964 5f63 6f6e  fig: diad_id_con
+00001360: 6669 673d 6469 6164 5f69 645f 636f 6e66  fig=diad_id_conf
+00001370: 6967 2829 2c20 7061 7468 3d4e 6f6e 652c  ig(), path=None,
+00001380: 2066 696c 656e 616d 653d 4e6f 6e65 2c20   filename=None, 
+00001390: 6469 6164 5f61 7272 6179 3d4e 6f6e 652c  diad_array=None,
+000013a0: 0a20 6669 6c65 7479 7065 3d27 5769 7465  . filetype='Wite
+000013b0: 635f 4153 4349 4927 2c20 2070 6c6f 745f  c_ASCII',  plot_
+000013c0: 6669 6775 7265 3d54 7275 6529 3a0a 0a20  figure=True):.. 
+000013d0: 2020 2022 2222 2054 6869 7320 6675 6e63     """ This func
+000013e0: 7469 6f6e 2066 6974 7320 6120 7370 6c69  tion fits a spli
+000013f0: 6e65 2074 6f20 7468 6520 7370 6563 7472  ne to the spectr
+00001400: 616c 2064 6174 612e 2049 7420 7468 656e  al data. It then
+00001410: 2075 7365 7320 5363 6970 7920 6669 6e64   uses Scipy find
+00001420: 2070 6561 6b73 2074 6f20 6964 656e 7469   peaks to identi
+00001430: 6679 2074 6865 2064 6961 642c 0a20 2020  fy the diad,.   
+00001440: 2048 4220 616e 6420 4331 3320 7065 616b   HB and C13 peak
+00001450: 732e 2049 7420 6f75 7470 7574 7320 7061  s. It outputs pa
+00001460: 7261 6d65 7465 7273 2073 7563 6820 6173  rameters such as
+00001470: 2070 6561 6b20 706f 7369 7469 6f6e 732c   peak positions,
+00001480: 2070 6561 6b20 7072 6f6d 696e 656e 6365   peak prominence
+00001490: 732c 0a20 2020 2061 6e64 2070 6561 6b20  s,.    and peak 
+000014a0: 6865 6967 6874 2072 6174 696f 7320 7468  height ratios th
+000014b0: 6174 2063 616e 2062 6520 7665 7279 2075  at can be very u
+000014c0: 7365 6675 6c20 7768 656e 2073 706c 6974  seful when split
+000014d0: 7469 6e67 2064 6174 6120 696e 746f 2067  ting data into g
+000014e0: 726f 7570 732e 0a20 2020 2049 7420 7573  roups..    It us
+000014f0: 6573 2069 6e66 6f72 6d61 7469 6f6e 2073  es information s
+00001500: 746f 7265 6420 696e 2064 6961 645f 6964  tored in diad_id
+00001510: 5f63 6f6e 6669 6720 666f 7220 6d6f 7374  _config for most
+00001520: 2070 6172 616d 6574 6572 730a 0a20 2020   parameters..   
+00001530: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00001540: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
+00001550: 2020 636f 6e66 6967 3a20 6461 7461 636c    config: datacl
+00001560: 6173 730a 2020 2020 2020 2020 5468 6973  ass.        This
+00001570: 2069 7320 6469 6164 5f69 645f 636f 6e66   is diad_id_conf
+00001580: 6967 2c20 7768 6963 6820 796f 7520 7368  ig, which you sh
+00001590: 6f75 6c64 2065 6469 7420 6265 666f 7265  ould edit before
+000015a0: 2079 6f75 2066 6565 6420 696e 746f 2074   you feed into t
+000015b0: 6865 2066 756e 6374 696f 6e20 746f 2061  he function to a
+000015c0: 646a 7573 7420 7065 616b 2066 696e 6469  djust peak findi
+000015d0: 6e67 0a20 2020 2020 2020 2070 6172 616d  ng.        param
+000015e0: 6574 6572 732e 2045 2e67 2e20 746f 2063  eters. E.g. to c
+000015f0: 6861 6e67 6520 7072 6f6d 696e 656e 6365  hange prominence
+00001600: 206f 6620 7065 616b 7320 666f 756e 6420   of peaks found 
+00001610: 6279 2073 6369 7079 2c20 646f 2063 6f6e  by scipy, do con
+00001620: 6669 673d 7066 2e64 6961 645f 6964 5f63  fig=pf.diad_id_c
+00001630: 6f6e 6669 6728 7072 6f6d 696e 656e 6365  onfig(prominence
+00001640: 3d31 3229 2c0a 2020 2020 2020 2020 7468  =12),.        th
+00001650: 656e 2069 6e70 7574 2069 6e74 6f20 7468  en input into th
+00001660: 6973 2066 756e 6374 696f 6e0a 0a20 2020  is function..   
+00001670: 2020 2020 2054 6869 6e67 7320 7468 6174       Things that
+00001680: 2063 616e 2062 6520 6164 6a75 7374 6564   can be adjusted
+00001690: 2069 6e20 7468 6973 2063 6f6e 6669 6720   in this config 
+000016a0: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
+000016b0: 2068 6569 6768 743a 2031 2028 7468 7265   height: 1 (thre
+000016c0: 7368 6f6c 6420 6865 6967 6874 2066 6f72  shold height for
+000016d0: 2053 6369 7079 2066 696e 6420 7065 616b   Scipy find peak
+000016e0: 7329 0a20 2020 2020 2020 2020 2020 2077  s).            w
+000016f0: 6964 7468 3a20 302e 3520 2874 6872 6573  idth: 0.5 (thres
+00001700: 686f 6c64 2077 6964 7468 2066 6f72 2053  hold width for S
+00001710: 6369 7079 2066 696e 6420 7065 616b 7329  cipy find peaks)
+00001720: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+00001730: 6d69 6e65 6e63 653a 2035 3020 2874 6872  minence: 50 (thr
+00001740: 6573 686f 6c64 2070 726f 6d69 6e65 6e63  eshold prominenc
+00001750: 6520 666f 7220 7363 6970 7920 6669 6e64  e for scipy find
+00001760: 2070 6561 6b73 290a 2020 2020 2020 2020   peaks).        
+00001770: 2020 2020 6578 636c 7564 655f 7261 6e67      exclude_rang
+00001780: 6531 3a20 4e6f 6e65 2028 6465 6661 756c  e1: None (defaul
+00001790: 7420 2920 6f72 206c 6973 7420 2d20 6578  t ) or list - ex
+000017a0: 636c 7564 6573 2061 2063 6572 7461 696e  cludes a certain
+000017b0: 2072 6567 696f 6e20 6f66 2074 6865 2073   region of the s
+000017c0: 7065 6374 7261 2028 652e 672c 205b 3132  pectra (e.g, [12
+000017d0: 3030 2c20 3132 3530 5d29 0a20 2020 2020  00, 1250]).     
+000017e0: 2020 2020 2020 2065 7863 6c75 6465 5f72         exclude_r
+000017f0: 616e 6765 323a 204e 6f6e 6520 2864 6566  ange2: None (def
+00001800: 6175 6c74 2029 206f 7220 6c69 7374 202d  ault ) or list -
+00001810: 2065 7863 6c75 6465 7320 6120 6365 7274   excludes a cert
+00001820: 6169 6e20 7265 6769 6f6e 206f 6620 7468  ain region of th
+00001830: 6520 7370 6563 7472 6120 2865 2e67 2c20  e spectra (e.g, 
+00001840: 5b31 3330 302c 2031 3331 305d 290a 2020  [1300, 1310]).  
+00001850: 2020 2020 2020 2020 2020 4469 6164 5f77            Diad_w
+00001860: 696e 646f 775f 7769 6474 683a 2033 3020  indow_width: 30 
+00001870: 2d20 5769 6e64 6f77 2074 6f20 7468 6520  - Window to the 
+00001880: 6c65 6674 206f 6620 4469 6164 3120 616e  left of Diad1 an
+00001890: 6420 746f 2074 6865 2072 6967 6874 206f  d to the right o
+000018a0: 6620 4469 6164 3220 746f 206c 6f6f 6b20  f Diad2 to look 
+000018b0: 666f 2072 6469 6164 202b 2068 6f74 6261  fo rdiad + hotba
+000018c0: 6e64 732e 0a20 2020 2020 2020 2020 2020  nds..           
+000018d0: 2061 7070 726f 785f 6469 6164 325f 706f   approx_diad2_po
+000018e0: 733a 2028 3133 3739 2c20 3133 3935 2920  s: (1379, 1395) 
+000018f0: 2d20 5265 6769 6f6e 2066 6f72 2063 6f64  - Region for cod
+00001900: 6520 746f 206c 6f6f 6b20 666f 7220 6469  e to look for di
+00001910: 6164 3220 282b 2d44 6961 645f 7769 6e64  ad2 (+-Diad_wind
+00001920: 6f77 5f77 6964 7468 292e 0a20 2020 2020  ow_width)..     
+00001930: 2020 2020 2020 2061 7070 726f 785f 6469         approx_di
+00001940: 6164 315f 706f 733a 2028 3132 3735 2c20  ad1_pos: (1275, 
+00001950: 3132 3930 2920 2d20 5265 6769 6f6e 2066  1290) - Region f
+00001960: 6f72 2063 6f64 6520 746f 206c 6f6f 6b20  or code to look 
+00001970: 666f 7220 6469 6164 3120 282b 2d44 6961  for diad1 (+-Dia
+00001980: 645f 7769 6e64 6f77 5f77 6964 7468 292e  d_window_width).
+00001990: 0a20 2020 2020 2020 2020 2020 204c 485f  .            LH_
+000019a0: 6263 6b5f 6469 6164 312c 204c 485f 6263  bck_diad1, LH_bc
+000019b0: 6b5f 6469 6164 322c 2052 485f 6263 6b5f  k_diad2, RH_bck_
+000019c0: 6469 6164 312c 2052 485f 6263 6b5f 6469  diad1, RH_bck_di
+000019d0: 6164 323a 2050 6f73 6974 696f 6e73 2065  ad2: Positions e
+000019e0: 6974 6865 7220 7369 6465 206f 6620 7065  ither side of pe
+000019f0: 616b 7320 746f 2063 616c 6375 6c61 7465  aks to calculate
+00001a00: 2070 726f 6d69 6e65 6e63 6573 2028 652e   prominences (e.
+00001a10: 672e 204c 485f 6263 6b5f 6469 6164 313d  g. LH_bck_diad1=
+00001a20: 5b31 3138 302c 2031 3232 305d 290a 0a0a  [1180, 1220])...
+00001a30: 2020 2020 7061 7468 3a20 7374 720a 2020      path: str.  
+00001a40: 2020 2020 2020 5061 7468 2077 6865 7265        Path where
+00001a50: 2073 7065 6374 7261 2069 7320 7374 6f72   spectra is stor
+00001a60: 6564 0a0a 2020 2020 6669 6c65 6e61 6d65  ed..    filename
+00001a70: 3a20 7374 720a 2020 2020 2020 2020 5370  : str.        Sp
+00001a80: 6563 6966 6963 206e 616d 6520 6f66 2066  ecific name of f
+00001a90: 696c 6520 6265 696e 6720 706c 6f74 7465  ile being plotte
+00001aa0: 640a 0a20 2020 2066 696c 6574 7970 653a  d..    filetype:
+00001ab0: 2073 7472 0a20 2020 2020 2020 2063 686f   str.        cho
+00001ac0: 6f73 6520 6672 6f6d 2027 5769 7465 635f  ose from 'Witec_
+00001ad0: 4153 4349 4927 2c20 2768 6561 646c 6573  ASCII', 'headles
+00001ae0: 735f 7478 7427 2c20 2768 6561 646c 6573  s_txt', 'headles
+00001af0: 735f 6373 7627 2c20 2768 6561 645f 6373  s_csv', 'head_cs
+00001b00: 7627 2c20 2757 6974 6563 5f41 5343 4949  v', 'Witec_ASCII
+00001b10: 272c 0a20 2020 2020 2020 2027 484f 5249  ',.        'HORI
+00001b20: 4241 5f74 7874 272c 2027 5265 6e69 7368  BA_txt', 'Renish
+00001b30: 6177 5f74 7874 270a 0a20 2020 2070 6c6f  aw_txt'..    plo
+00001b40: 745f 6669 6775 7265 3a20 626f 6f6c 0a20  t_figure: bool. 
+00001b50: 2020 2020 2020 2069 6620 5472 7565 2c20         if True, 
+00001b60: 706c 6f74 7320 6120 6669 6775 7265 206f  plots a figure o
+00001b70: 6620 7065 616b 732c 2061 6e64 2074 6865  f peaks, and the
+00001b80: 2069 6465 6e74 6966 6965 6420 7065 616b   identified peak
+00001b90: 7320 7468 6174 2053 6369 7079 2066 6f75  s that Scipy fou
+00001ba0: 6e64 0a0a 2020 2020 5265 7475 726e 730a  nd..    Returns.
+00001bb0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
+00001bc0: 2d0a 2020 2020 7064 2e44 6174 6146 7261  -.    pd.DataFra
+00001bd0: 6d65 0a20 2020 2020 2020 2044 6174 6166  me.        Dataf
+00001be0: 7261 6d65 206f 6620 6170 7072 6f78 696d  rame of approxim
+00001bf0: 6174 6520 7065 616b 2070 6f73 6974 696f  ate peak positio
+00001c00: 6e73 2c20 7072 6f6d 696e 656e 6365 732c  ns, prominences,
+00001c10: 2065 7463 2e0a 0a20 2020 206e 702e 6172   etc...    np.ar
+00001c20: 7261 7920 6f66 2078 2061 6e64 2079 2063  ray of x and y c
+00001c30: 6f6f 7264 696e 6174 6573 206f 6620 7370  oordinates of sp
+00001c40: 6563 7472 610a 0a20 2020 2066 6967 7572  ectra..    figur
+00001c50: 6520 6966 2070 6c6f 745f 6669 6775 7265  e if plot_figure
+00001c60: 2069 7320 5472 7565 0a0a 0a20 2020 2022   is True...    "
+00001c70: 2222 0a20 2020 2069 6620 6469 6164 5f61  "".    if diad_a
+00001c80: 7272 6179 2069 7320 4e6f 6e65 3a0a 2020  rray is None:.  
+00001c90: 2020 2020 2020 4469 6164 5f64 663d 6765        Diad_df=ge
+00001ca0: 745f 6461 7461 2870 6174 683d 7061 7468  t_data(path=path
+00001cb0: 2c20 6669 6c65 6e61 6d65 3d66 696c 656e  , filename=filen
+00001cc0: 616d 652c 2066 696c 6574 7970 653d 6669  ame, filetype=fi
+00001cd0: 6c65 7479 7065 290a 2020 2020 2020 2020  letype).        
+00001ce0: 4469 6164 3d6e 702e 6172 7261 7928 4469  Diad=np.array(Di
+00001cf0: 6164 5f64 6629 0a20 2020 2065 6c73 653a  ad_df).    else:
+00001d00: 0a20 2020 2020 2020 2044 6961 643d 6469  .        Diad=di
+00001d10: 6164 5f61 7272 6179 0a0a 0a0a 2020 2020  ad_array....    
+00001d20: 2320 4669 7273 7420 6c65 7473 2075 7365  # First lets use
+00001d30: 2066 696e 6420 7065 616b 730a 2020 2020   find peaks.    
+00001d40: 795f 696e 3d44 6961 645b 3a2c 2031 5d0a  y_in=Diad[:, 1].
+00001d50: 2020 2020 785f 696e 3d44 6961 645b 3a2c      x_in=Diad[:,
+00001d60: 2030 5d0a 2020 2020 7370 6563 5f72 6573   0].    spec_res
+00001d70: 3d6e 702e 6162 7328 785f 696e 5b31 5d2d  =np.abs(x_in[1]-
+00001d80: 785f 696e 5b30 5d29 0a0a 2020 2020 2320  x_in[0])..    # 
+00001d90: 4e6f 7720 6c65 7473 2066 6974 2061 2063  Now lets fit a c
+00001da0: 7562 6963 2073 706c 696e 6520 746f 2073  ubic spline to s
+00001db0: 6d6f 6f6f 7468 2069 7420 616c 6c20 6f75  moooth it all ou
+00001dc0: 7420 6120 6269 740a 2020 2020 2320 4765  t a bit.    # Ge
+00001dd0: 7420 7820 616e 6420 7920 7265 6164 7920  t x and y ready 
+00001de0: 746f 206d 616b 6520 6120 6375 6269 6320  to make a cubic 
+00001df0: 7370 6c69 6e65 2074 6872 6f75 6768 2064  spline through d
+00001e00: 6174 610a 2020 2020 2320 4669 7420 6120  ata.    # Fit a 
+00001e10: 2063 7562 6963 2073 706c 696e 650a 2020   cubic spline.  
+00001e20: 2020 6632 203d 2069 6e74 6572 7031 6428    f2 = interp1d(
+00001e30: 785f 696e 2c20 795f 696e 2c20 6b69 6e64  x_in, y_in, kind
+00001e40: 3d27 6375 6269 6327 290a 2020 2020 785f  ='cubic').    x_
+00001e50: 6e65 773d 6e70 2e6c 696e 7370 6163 6528  new=np.linspace(
+00001e60: 6e70 2e6d 696e 2878 5f69 6e29 2c20 6e70  np.min(x_in), np
+00001e70: 2e6d 6178 2878 5f69 6e29 2c20 3130 3030  .max(x_in), 1000
+00001e80: 3030 290a 0a20 2020 2079 5f63 7562 3d66  00)..    y_cub=f
+00001e90: 3228 785f 6e65 7729 0a0a 2020 2020 793d  2(x_new)..    y=
+00001ea0: 795f 6375 620a 2020 2020 783d 785f 6e65  y_cub.    x=x_ne
+00001eb0: 770a 0a0a 0a20 2020 2023 2053 7061 6369  w....    # Spaci
+00001ec0: 6e67 206f 6620 686f 7462 616e 6420 6672  ng of hotband fr
+00001ed0: 6f6d 206d 6169 6e20 7065 616b 0a20 2020  om main peak.   
+00001ee0: 2064 6961 6432 5f48 4232 5f6d 696e 5f6f   diad2_HB2_min_o
+00001ef0: 6666 7365 743d 3139 2d73 7065 635f 7265  ffset=19-spec_re
+00001f00: 730a 2020 2020 6469 6164 325f 4842 325f  s.    diad2_HB2_
+00001f10: 6d61 785f 6f66 6673 6574 3d32 332b 7370  max_offset=23+sp
+00001f20: 6563 5f72 6573 0a0a 2020 2020 2320 5370  ec_res..    # Sp
+00001f30: 6163 696e 6720 6f66 2048 4220 6672 6f6d  acing of HB from
+00001f40: 206d 6169 6e20 7065 616b 2e0a 2020 2020   main peak..    
+00001f50: 6469 6164 315f 4842 315f 6d69 6e5f 6f66  diad1_HB1_min_of
+00001f60: 6673 6574 3d31 392d 7370 6563 5f72 6573  fset=19-spec_res
+00001f70: 0a20 2020 2064 6961 6431 5f48 4231 5f6d  .    diad1_HB1_m
+00001f80: 6178 5f6f 6666 7365 743d 3233 2b73 7065  ax_offset=23+spe
+00001f90: 635f 7265 730a 0a20 2020 2023 2053 7061  c_res..    # Spa
+00001fa0: 6369 6e67 206f 6620 6331 3320 6672 6f6d  cing of c13 from
+00001fb0: 206d 6169 6e20 7065 616b 0a20 2020 2064   main peak.    d
+00001fc0: 6961 6432 5f43 3133 5f6d 696e 5f6f 6666  iad2_C13_min_off
+00001fd0: 7365 743d 3136 2e35 2d73 7065 635f 7265  set=16.5-spec_re
+00001fe0: 730a 2020 2020 6469 6164 325f 4331 335f  s.    diad2_C13_
+00001ff0: 6d61 785f 6f66 6673 6574 3d32 302b 7370  max_offset=20+sp
+00002000: 6563 5f72 6573 0a0a 2020 2020 7065 616b  ec_res..    peak
+00002010: 7320 3d20 6669 6e64 5f70 6561 6b73 2879  s = find_peaks(y
+00002020: 2c20 6865 6967 6874 203d 2063 6f6e 6669  , height = confi
+00002030: 672e 6865 6967 6874 2c20 7072 6f6d 696e  g.height, promin
+00002040: 656e 6365 3d63 6f6e 6669 672e 7072 6f6d  ence=config.prom
+00002050: 696e 656e 6365 2c20 7769 6474 683d 636f  inence, width=co
+00002060: 6e66 6967 2e77 6964 7468 290a 0a0a 2020  nfig.width)...  
+00002070: 2020 2320 5468 6973 2067 6574 7320 7468    # This gets th
+00002080: 6520 6c69 7374 206f 6620 7065 616b 2070  e list of peak p
+00002090: 6f73 6974 696f 6e73 2e0a 2020 2020 7065  ositions..    pe
+000020a0: 616b 5f70 6f73 203d 2078 5b70 6561 6b73  ak_pos = x[peaks
+000020b0: 5b30 5d5d 0a20 2020 2068 6569 6768 7420  [0]].    height 
+000020c0: 3d20 7065 616b 735b 315d 5b27 7065 616b  = peaks[1]['peak
+000020d0: 5f68 6569 6768 7473 275d 0a20 2020 2064  _heights'].    d
+000020e0: 663d 7064 2e44 6174 6146 7261 6d65 2864  f=pd.DataFrame(d
+000020f0: 6174 613d 7b27 706f 7327 3a20 7065 616b  ata={'pos': peak
+00002100: 5f70 6f73 2c0a 2020 2020 2020 2020 2020  _pos,.          
+00002110: 2020 2020 2020 2020 2020 2020 2020 2768                'h
+00002120: 6569 6768 7427 3a20 6865 6967 6874 7d29  eight': height})
+00002130: 0a0a 2020 2020 2320 4865 7265 2c20 7765  ..    # Here, we
+00002140: 2061 7265 206c 6f6f 6b69 6e67 2066 6f72   are looking for
+00002150: 2070 6561 6b73 2069 6e20 7468 6520 6469   peaks in the di
+00002160: 6164 2077 696e 646f 772e 0a0a 2020 2020  ad window...    
+00002170: 6466 5f70 6b73 5f64 6961 6431 3d64 665b  df_pks_diad1=df[
+00002180: 2864 665b 2770 6f73 275d 3e63 6f6e 6669  (df['pos']>confi
+00002190: 672e 4469 6164 315f 7769 6e64 6f77 5b30  g.Diad1_window[0
+000021a0: 5d29 2026 2028 6466 5b27 706f 7327 5d3c  ]) & (df['pos']<
+000021b0: 636f 6e66 6967 2e44 6961 6431 5f77 696e  config.Diad1_win
+000021c0: 646f 775b 315d 2920 5d0a 0a20 2020 2023  dow[1]) ]..    #
+000021d0: 2046 696e 6420 7065 616b 7320 7769 7468   Find peaks with
+000021e0: 696e 2074 6865 2032 6e64 2064 6961 6420  in the 2nd diad 
+000021f0: 7769 6e64 6f77 0a20 2020 2064 665f 706b  window.    df_pk
+00002200: 735f 6469 6164 323d 6466 5b28 6466 5b27  s_diad2=df[(df['
+00002210: 706f 7327 5d3e 636f 6e66 6967 2e44 6961  pos']>config.Dia
+00002220: 6432 5f77 696e 646f 775b 305d 2920 2620  d2_window[0]) & 
+00002230: 2864 665b 2770 6f73 275d 3c63 6f6e 6669  (df['pos']<confi
+00002240: 672e 4469 6164 325f 7769 6e64 6f77 5b31  g.Diad2_window[1
+00002250: 5d29 205d 0a0a 0a20 2020 2023 2046 696e  ]) ]...    # Fin
+00002260: 6420 4e20 6869 6768 6573 7420 7065 616b  d N highest peak
+00002270: 7320 7769 7468 696e 2072 616e 6765 2079  s within range y
+00002280: 6f75 2068 6176 6520 7365 6c65 6374 6564  ou have selected
+00002290: 2e0a 2020 2020 6466 5f73 6f72 745f 6469  ..    df_sort_di
+000022a0: 6164 313d 6466 5f70 6b73 5f64 6961 6431  ad1=df_pks_diad1
+000022b0: 2e73 6f72 745f 7661 6c75 6573 2827 6865  .sort_values('he
+000022c0: 6967 6874 272c 2061 7869 733d 302c 2061  ight', axis=0, a
+000022d0: 7363 656e 6469 6e67 3d46 616c 7365 290a  scending=False).
+000022e0: 2020 2020 6966 206c 656e 2864 665f 736f      if len(df_so
+000022f0: 7274 5f64 6961 6431 293e 323a 0a20 2020  rt_diad1)>2:.   
+00002300: 2020 2020 2064 665f 736f 7274 5f64 6961       df_sort_dia
+00002310: 6431 5f74 7269 6d3d 6466 5f73 6f72 745f  d1_trim=df_sort_
+00002320: 6469 6164 3120 235b 303a 325d 0a20 2020  diad1 #[0:2].   
+00002330: 2065 6c73 653a 0a20 2020 2020 2020 2064   else:.        d
+00002340: 665f 736f 7274 5f64 6961 6431 5f74 7269  f_sort_diad1_tri
+00002350: 6d3d 6466 5f73 6f72 745f 6469 6164 310a  m=df_sort_diad1.
+00002360: 0a20 2020 2064 665f 736f 7274 5f64 6961  .    df_sort_dia
+00002370: 6432 3d64 665f 706b 735f 6469 6164 322e  d2=df_pks_diad2.
+00002380: 736f 7274 5f76 616c 7565 7328 2768 6569  sort_values('hei
+00002390: 6768 7427 2c20 6178 6973 3d30 2c20 6173  ght', axis=0, as
+000023a0: 6365 6e64 696e 673d 4661 6c73 6529 0a20  cending=False). 
+000023b0: 2020 2069 6620 6c65 6e28 6466 5f73 6f72     if len(df_sor
+000023c0: 745f 6469 6164 3229 3e33 3a0a 2020 2020  t_diad2)>3:.    
+000023d0: 2020 2020 6466 5f73 6f72 745f 6469 6164      df_sort_diad
+000023e0: 325f 7472 696d 3d64 665f 736f 7274 5f64  2_trim=df_sort_d
+000023f0: 6961 6432 2020 235b 303a 335d 0a0a 2020  iad2  #[0:3]..  
+00002400: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00002410: 6466 5f73 6f72 745f 6469 6164 325f 7472  df_sort_diad2_tr
+00002420: 696d 3d64 665f 736f 7274 5f64 6961 6432  im=df_sort_diad2
+00002430: 0a0a 2020 2020 2320 4368 6563 6b20 6966  ..    # Check if
+00002440: 2061 6e79 2070 6561 6b73 206c 6965 2077   any peaks lie w
+00002450: 6865 7265 2077 6520 6578 7065 6374 2074  here we expect t
+00002460: 6865 2073 6563 6f6e 6420 6469 6164 0a20  he second diad. 
+00002470: 2020 2072 6967 6874 5f70 6f73 5f64 6961     right_pos_dia
+00002480: 6432 3d64 665f 736f 7274 5f64 6961 6432  d2=df_sort_diad2
+00002490: 5f74 7269 6d5b 2770 6f73 275d 2e62 6574  _trim['pos'].bet
+000024a0: 7765 656e 2863 6f6e 6669 672e 6170 7072  ween(config.appr
+000024b0: 6f78 5f64 6961 6432 5f70 6f73 5b30 5d2c  ox_diad2_pos[0],
+000024c0: 2063 6f6e 6669 672e 6170 7072 6f78 5f64   config.approx_d
+000024d0: 6961 6432 5f70 6f73 5b31 5d29 0a20 2020  iad2_pos[1]).   
+000024e0: 2069 6620 616e 7928 7269 6768 745f 706f   if any(right_po
+000024f0: 735f 6469 6164 3229 3a0a 0a20 2020 2020  s_diad2):..     
+00002500: 2020 206d 616e 7561 6c5f 6469 6164 323d     manual_diad2=
+00002510: 4661 6c73 650a 2020 2020 2020 2020 6466  False.        df
+00002520: 5f73 6f72 745f 6469 6164 325f 7269 6768  _sort_diad2_righ
+00002530: 7470 6f73 3d64 665f 736f 7274 5f64 6961  tpos=df_sort_dia
+00002540: 6432 5f74 7269 6d2e 6c6f 635b 7269 6768  d2_trim.loc[righ
+00002550: 745f 706f 735f 6469 6164 325d 0a20 2020  t_pos_diad2].   
+00002560: 2020 2020 2064 6961 645f 325f 6469 6164       diad_2_diad
+00002570: 3d64 665f 736f 7274 5f64 6961 6432 5f72  =df_sort_diad2_r
+00002580: 6967 6874 706f 732e 6c6f 635b 6466 5f73  ightpos.loc[df_s
+00002590: 6f72 745f 6469 6164 325f 7269 6768 7470  ort_diad2_rightp
+000025a0: 6f73 5b27 6865 6967 6874 275d 3d3d 6e70  os['height']==np
+000025b0: 2e6d 6178 2864 665f 736f 7274 5f64 6961  .max(df_sort_dia
+000025c0: 6432 5f72 6967 6874 706f 735b 2768 6569  d2_rightpos['hei
+000025d0: 6768 7427 5d29 5d0a 2020 2020 2020 2020  ght'])].        
+000025e0: 6466 5f6f 7574 3d70 642e 4461 7461 4672  df_out=pd.DataFr
+000025f0: 616d 6528 6461 7461 3d7b 2766 696c 656e  ame(data={'filen
+00002600: 616d 6527 3a20 6669 6c65 6e61 6d65 2c0a  ame': filename,.
+00002610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002630: 2744 6961 6432 5f70 6f73 273a 2064 6961  'Diad2_pos': dia
+00002640: 645f 325f 6469 6164 5b27 706f 7327 5d2c  d_2_diad['pos'],
+00002650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002670: 2027 4469 6164 325f 6865 6967 6874 273a   'Diad2_height':
+00002680: 2064 6961 645f 325f 6469 6164 5b27 6865   diad_2_diad['he
+00002690: 6967 6874 275d 7d29 0a0a 0a0a 0a20 2020  ight']}).....   
+000026a0: 2020 2020 2023 2041 6c6c 6f63 6174 6520       # Allocate 
+000026b0: 686f 7420 6261 6e64 2032 2070 6f73 6974  hot band 2 posit
+000026c0: 696f 6e0a 0a20 2020 2020 2020 2069 6620  ion..        if 
+000026d0: 616e 7928 6466 5f73 6f72 745f 6469 6164  any(df_sort_diad
+000026e0: 325f 7472 696d 5b27 706f 7327 5d2e 6265  2_trim['pos'].be
+000026f0: 7477 6565 6e28 6469 6164 5f32 5f64 6961  tween(diad_2_dia
+00002700: 645b 2770 6f73 275d 2e69 6c6f 635b 305d  d['pos'].iloc[0]
+00002710: 2b64 6961 6432 5f48 4232 5f6d 696e 5f6f  +diad2_HB2_min_o
+00002720: 6666 7365 742c 2064 6961 645f 325f 6469  ffset, diad_2_di
+00002730: 6164 5b27 706f 7327 5d2e 696c 6f63 5b30  ad['pos'].iloc[0
+00002740: 5d2b 6469 6164 325f 4842 325f 6d61 785f  ]+diad2_HB2_max_
+00002750: 6f66 6673 6574 2929 3a0a 0a20 2020 2020  offset)):..     
+00002760: 2020 2020 2020 2064 6961 645f 325f 4842         diad_2_HB
+00002770: 3d64 665f 736f 7274 5f64 6961 6432 5f74  =df_sort_diad2_t
+00002780: 7269 6d2e 6c6f 635b 6466 5f73 6f72 745f  rim.loc[df_sort_
+00002790: 6469 6164 325f 7472 696d 5b27 706f 7327  diad2_trim['pos'
+000027a0: 5d2e 6265 7477 6565 6e28 6469 6164 5f32  ].between(diad_2
+000027b0: 5f64 6961 645b 2770 6f73 275d 2e69 6c6f  _diad['pos'].ilo
+000027c0: 635b 305d 2b64 6961 6432 5f48 4232 5f6d  c[0]+diad2_HB2_m
+000027d0: 696e 5f6f 6666 7365 742c 2064 6961 645f  in_offset, diad_
+000027e0: 325f 6469 6164 5b27 706f 7327 5d2e 696c  2_diad['pos'].il
+000027f0: 6f63 5b30 5d2b 6469 6164 325f 4842 325f  oc[0]+diad2_HB2_
+00002800: 6d61 785f 6f66 6673 6574 295d 0a0a 2020  max_offset)]..  
+00002810: 2020 2020 2020 2020 2020 6466 5f6f 7574            df_out
+00002820: 5b27 4842 325f 706f 7327 5d3d 6469 6164  ['HB2_pos']=diad
+00002830: 5f32 5f48 425b 2770 6f73 275d 2e69 6c6f  _2_HB['pos'].ilo
+00002840: 635b 305d 0a20 2020 2020 2020 2020 2020  c[0].           
+00002850: 2064 665f 6f75 745b 2748 4232 5f68 6569   df_out['HB2_hei
+00002860: 6768 7427 5d3d 6469 6164 5f32 5f48 425b  ght']=diad_2_HB[
+00002870: 2768 6569 6768 7427 5d2e 696c 6f63 5b30  'height'].iloc[0
+00002880: 5d0a 0a0a 2020 2020 2020 2020 656c 7365  ]...        else
+00002890: 3a0a 0a20 2020 2020 2020 2020 2020 2064  :..            d
+000028a0: 665f 6f75 745b 2748 4232 5f70 6f73 275d  f_out['HB2_pos']
+000028b0: 3d6e 702e 6e61 6e0a 2020 2020 2020 2020  =np.nan.        
+000028c0: 2020 2020 6466 5f6f 7574 5b27 4842 325f      df_out['HB2_
+000028d0: 6865 6967 6874 275d 3d6e 702e 6e61 6e0a  height']=np.nan.
+000028e0: 0a0a 2020 2020 2020 2020 2320 4c6f 6f6b  ..        # Look
+000028f0: 2066 6f72 2043 3133 2070 6f73 6974 696f   for C13 positio
+00002900: 6e0a 2020 2020 2020 2020 6966 2061 6e79  n.        if any
+00002910: 2864 665f 736f 7274 5f64 6961 6432 5f74  (df_sort_diad2_t
+00002920: 7269 6d5b 2770 6f73 275d 2e62 6574 7765  rim['pos'].betwe
+00002930: 656e 2864 6961 645f 325f 6469 6164 5b27  en(diad_2_diad['
+00002940: 706f 7327 5d2e 696c 6f63 5b30 5d2d 6469  pos'].iloc[0]-di
+00002950: 6164 325f 4331 335f 6d61 785f 6f66 6673  ad2_C13_max_offs
+00002960: 6574 2c20 6469 6164 5f32 5f64 6961 645b  et, diad_2_diad[
+00002970: 2770 6f73 275d 2e69 6c6f 635b 305d 2d64  'pos'].iloc[0]-d
+00002980: 6961 6432 5f43 3133 5f6d 696e 5f6f 6666  iad2_C13_min_off
+00002990: 7365 7429 293a 0a20 2020 2020 2020 2020  set)):.         
+000029a0: 2020 2064 6961 645f 325f 4331 333d 6466     diad_2_C13=df
+000029b0: 5f73 6f72 745f 6469 6164 325f 7472 696d  _sort_diad2_trim
+000029c0: 2e6c 6f63 5b64 665f 736f 7274 5f64 6961  .loc[df_sort_dia
+000029d0: 6432 5f74 7269 6d5b 2770 6f73 275d 2e62  d2_trim['pos'].b
+000029e0: 6574 7765 656e 2864 6961 645f 325f 6469  etween(diad_2_di
+000029f0: 6164 5b27 706f 7327 5d2e 696c 6f63 5b30  ad['pos'].iloc[0
+00002a00: 5d2d 6469 6164 325f 4331 335f 6d61 785f  ]-diad2_C13_max_
+00002a10: 6f66 6673 6574 2c20 6469 6164 5f32 5f64  offset, diad_2_d
+00002a20: 6961 645b 2770 6f73 275d 2e69 6c6f 635b  iad['pos'].iloc[
+00002a30: 305d 2d64 6961 6432 5f43 3133 5f6d 696e  0]-diad2_C13_min
+00002a40: 5f6f 6666 7365 7429 5d0a 2020 2020 2020  _offset)].      
+00002a50: 2020 2020 2020 6466 5f6f 7574 5b27 4331        df_out['C1
+00002a60: 335f 706f 7327 5d3d 6469 6164 5f32 5f43  3_pos']=diad_2_C
+00002a70: 3133 5b27 706f 7327 5d2e 696c 6f63 5b30  13['pos'].iloc[0
+00002a80: 5d0a 2020 2020 2020 2020 2020 2020 6466  ].            df
+00002a90: 5f6f 7574 5b27 4331 335f 6865 6967 6874  _out['C13_height
+00002aa0: 275d 3d64 6961 645f 325f 4331 335b 2768  ']=diad_2_C13['h
+00002ab0: 6569 6768 7427 5d2e 696c 6f63 5b30 5d0a  eight'].iloc[0].
+00002ac0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00002ad0: 2020 2020 2020 2020 2020 6466 5f6f 7574            df_out
+00002ae0: 5b27 4331 335f 706f 7327 5d3d 6e70 2e6e  ['C13_pos']=np.n
+00002af0: 616e 0a20 2020 2020 2020 2020 2020 2064  an.            d
+00002b00: 665f 6f75 745b 2743 3133 5f68 6569 6768  f_out['C13_heigh
+00002b10: 7427 5d3d 6e70 2e6e 616e 0a20 2020 2023  t']=np.nan.    #
+00002b20: 2049 6620 6974 2064 6964 6e74 2066 696e   If it didnt fin
+00002b30: 6420 616e 7974 6869 6e67 2077 6865 7265  d anything where
+00002b40: 2077 6520 6578 7065 6374 2044 6961 6432   we expect Diad2
+00002b50: 2074 6f20 6265 2c20 6669 6e64 206d 6178   to be, find max
+00002b60: 2070 6f73 6974 696f 6e0a 2020 2020 656c   position.    el
+00002b70: 7365 3a0a 2020 2020 2020 2020 6d61 6e75  se:.        manu
+00002b80: 616c 5f64 6961 6432 3d54 7275 650a 2020  al_diad2=True.  
+00002b90: 2020 2020 2020 2320 4c65 7473 2066 696e        # Lets fin
+00002ba0: 6420 7468 6520 6869 6768 6573 7420 6269  d the highest bi
+00002bb0: 7420 7769 7468 696e 2074 6869 7320 7261  t within this ra
+00002bc0: 6e67 650a 2020 2020 2020 2020 6469 6164  nge.        diad
+00002bd0: 325f 7261 6e67 653d 2844 6961 645b 3a2c  2_range=(Diad[:,
+00002be0: 2030 5d3e 636f 6e66 6967 2e61 7070 726f   0]>config.appro
+00002bf0: 785f 6469 6164 325f 706f 735b 305d 2920  x_diad2_pos[0]) 
+00002c00: 2620 2844 6961 645b 3a2c 2030 5d3c 636f  & (Diad[:, 0]<co
+00002c10: 6e66 6967 2e61 7070 726f 785f 6469 6164  nfig.approx_diad
+00002c20: 325f 706f 735b 315d 290a 2020 2020 2020  2_pos[1]).      
+00002c30: 2020 6469 6164 325f 6865 6967 6874 3d6e    diad2_height=n
+00002c40: 702e 6d61 7828 4469 6164 5b3a 2c20 315d  p.max(Diad[:, 1]
+00002c50: 5b64 6961 6432 5f72 616e 6765 5d29 0a20  [diad2_range]). 
+00002c60: 2020 2020 2020 2064 6961 6432 5f70 6f73         diad2_pos
+00002c70: 3d44 6961 645b 3a2c 2030 5d5b 2844 6961  =Diad[:, 0][(Dia
+00002c80: 645b 3a2c 2031 5d3d 3d64 6961 6432 5f68  d[:, 1]==diad2_h
+00002c90: 6569 6768 7429 2664 6961 6432 5f72 616e  eight)&diad2_ran
+00002ca0: 6765 5d0a 0a20 2020 2020 2020 2064 665f  ge]..        df_
+00002cb0: 6f75 743d 7064 2e44 6174 6146 7261 6d65  out=pd.DataFrame
+00002cc0: 2864 6174 613d 7b27 6669 6c65 6e61 6d65  (data={'filename
+00002cd0: 273a 2066 696c 656e 616d 652c 0a20 2020  ': filename,.   
+00002ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d00: 2027 4469 6164 325f 706f 7327 3a20 6469   'Diad2_pos': di
+00002d10: 6164 325f 706f 735b 305d 202c 0a20 2020  ad2_pos[0] ,.   
+00002d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d30: 2020 2020 2020 2020 2020 2020 2027 4469               'Di
+00002d40: 6164 325f 6865 6967 6874 273a 6469 6164  ad2_height':diad
+00002d50: 325f 6865 6967 6874 7d2c 2069 6e64 6578  2_height}, index
+00002d60: 3d5b 305d 290a 0a20 2020 2020 2020 2023  =[0])..        #
+00002d70: 204c 6574 7320 7472 7920 746f 2066 696e   Lets try to fin
+00002d80: 6420 7468 6520 686f 7462 616e 6420 616e  d the hotband an
+00002d90: 6420 686f 7065 2069 7473 2068 6572 6521  d hope its here!
+00002da0: 0a20 2020 2020 2020 2069 6620 616e 7928  .        if any(
+00002db0: 6466 5f73 6f72 745f 6469 6164 325f 7472  df_sort_diad2_tr
+00002dc0: 696d 5b27 706f 7327 5d2e 6265 7477 6565  im['pos'].betwee
+00002dd0: 6e28 6466 5f6f 7574 5b27 4469 6164 325f  n(df_out['Diad2_
+00002de0: 706f 7327 5d2e 696c 6f63 5b30 5d2b 6469  pos'].iloc[0]+di
+00002df0: 6164 325f 4842 325f 6d69 6e5f 6f66 6673  ad2_HB2_min_offs
+00002e00: 6574 2c20 6466 5f6f 7574 5b27 4469 6164  et, df_out['Diad
+00002e10: 325f 706f 7327 5d2e 696c 6f63 5b30 5d2b  2_pos'].iloc[0]+
+00002e20: 6469 6164 325f 4842 325f 6d61 785f 6f66  diad2_HB2_max_of
+00002e30: 6673 6574 2929 3a0a 0a20 2020 2020 2020  fset)):..       
+00002e40: 2020 2020 2064 6961 645f 325f 4842 3d64       diad_2_HB=d
+00002e50: 665f 736f 7274 5f64 6961 6432 5f74 7269  f_sort_diad2_tri
+00002e60: 6d2e 6c6f 635b 6466 5f73 6f72 745f 6469  m.loc[df_sort_di
+00002e70: 6164 325f 7472 696d 5b27 706f 7327 5d2e  ad2_trim['pos'].
+00002e80: 6265 7477 6565 6e28 6466 5f6f 7574 5b27  between(df_out['
+00002e90: 4469 6164 325f 706f 7327 5d2e 696c 6f63  Diad2_pos'].iloc
+00002ea0: 5b30 5d2b 6469 6164 325f 4842 325f 6d69  [0]+diad2_HB2_mi
+00002eb0: 6e5f 6f66 6673 6574 2c20 6466 5f6f 7574  n_offset, df_out
+00002ec0: 5b27 4469 6164 325f 706f 7327 5d2e 696c  ['Diad2_pos'].il
+00002ed0: 6f63 5b30 5d2b 6469 6164 325f 4842 325f  oc[0]+diad2_HB2_
+00002ee0: 6d61 785f 6f66 6673 6574 295d 0a0a 2020  max_offset)]..  
+00002ef0: 2020 2020 2020 2020 2020 6466 5f6f 7574            df_out
+00002f00: 5b27 4842 325f 706f 7327 5d3d 6469 6164  ['HB2_pos']=diad
+00002f10: 5f32 5f48 425b 2770 6f73 275d 2e69 6c6f  _2_HB['pos'].ilo
+00002f20: 635b 305d 0a20 2020 2020 2020 2020 2020  c[0].           
+00002f30: 2064 665f 6f75 745b 2748 4232 5f68 6569   df_out['HB2_hei
+00002f40: 6768 7427 5d3d 6469 6164 5f32 5f48 425b  ght']=diad_2_HB[
+00002f50: 2768 6569 6768 7427 5d2e 696c 6f63 5b30  'height'].iloc[0
+00002f60: 5d0a 0a20 2020 2020 2020 2065 6c73 653a  ]..        else:
+00002f70: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
+00002f80: 6f75 745b 2748 4232 5f70 6f73 275d 3d6e  out['HB2_pos']=n
+00002f90: 702e 6e61 6e0a 2020 2020 2020 2020 2020  p.nan.          
+00002fa0: 2020 6466 5f6f 7574 5b27 4842 325f 6865    df_out['HB2_he
+00002fb0: 6967 6874 275d 3d6e 702e 6e61 6e0a 0a20  ight']=np.nan.. 
+00002fc0: 2020 2020 2020 2023 204c 6574 7320 7472         # Lets tr
+00002fd0: 7920 616e 6420 6669 6e64 2074 6865 2043  y and find the C
+00002fe0: 3133 2070 6561 6b0a 0a20 2020 2020 2020  13 peak..       
+00002ff0: 2069 6620 616e 7928 6466 5f73 6f72 745f   if any(df_sort_
+00003000: 6469 6164 325f 7472 696d 5b27 706f 7327  diad2_trim['pos'
+00003010: 5d2e 6265 7477 6565 6e28 6466 5f6f 7574  ].between(df_out
+00003020: 5b27 4469 6164 325f 706f 7327 5d2e 696c  ['Diad2_pos'].il
+00003030: 6f63 5b30 5d2d 6469 6164 325f 4331 335f  oc[0]-diad2_C13_
+00003040: 6d61 785f 6f66 6673 6574 2c20 6466 5f6f  max_offset, df_o
+00003050: 7574 5b27 4469 6164 325f 706f 7327 5d2e  ut['Diad2_pos'].
+00003060: 696c 6f63 5b30 5d2d 6469 6164 325f 4331  iloc[0]-diad2_C1
+00003070: 335f 6d69 6e5f 6f66 6673 6574 2929 3a0a  3_min_offset)):.
+00003080: 2020 2020 2020 2020 2020 2020 6469 6164              diad
+00003090: 5f32 5f43 3133 3d64 665f 736f 7274 5f64  _2_C13=df_sort_d
+000030a0: 6961 6432 5f74 7269 6d2e 6c6f 635b 6466  iad2_trim.loc[df
+000030b0: 5f73 6f72 745f 6469 6164 325f 7472 696d  _sort_diad2_trim
+000030c0: 5b27 706f 7327 5d2e 6265 7477 6565 6e28  ['pos'].between(
+000030d0: 6466 5f6f 7574 5b27 4469 6164 325f 706f  df_out['Diad2_po
+000030e0: 7327 5d2e 696c 6f63 5b30 5d2d 6469 6164  s'].iloc[0]-diad
+000030f0: 325f 4331 335f 6d61 785f 6f66 6673 6574  2_C13_max_offset
+00003100: 2c20 6466 5f6f 7574 5b27 4469 6164 325f  , df_out['Diad2_
+00003110: 706f 7327 5d2e 696c 6f63 5b30 5d2d 6469  pos'].iloc[0]-di
+00003120: 6164 325f 4331 335f 6d69 6e5f 6f66 6673  ad2_C13_min_offs
+00003130: 6574 295d 0a0a 2020 2020 2020 2020 2020  et)]..          
+00003140: 2020 6466 5f6f 7574 5b27 4331 335f 706f    df_out['C13_po
+00003150: 7327 5d3d 6469 6164 5f32 5f43 3133 5b27  s']=diad_2_C13['
+00003160: 706f 7327 5d2e 696c 6f63 5b30 5d0a 2020  pos'].iloc[0].  
+00003170: 2020 2020 2020 2020 2020 6466 5f6f 7574            df_out
+00003180: 5b27 4331 335f 6865 6967 6874 275d 3d64  ['C13_height']=d
+00003190: 6961 645f 325f 4331 335b 2768 6569 6768  iad_2_C13['heigh
+000031a0: 7427 5d2e 696c 6f63 5b30 5d0a 2020 2020  t'].iloc[0].    
+000031b0: 2020 2020 656c 7365 3a0a 0a20 2020 2020      else:..     
+000031c0: 2020 2020 2020 2064 665f 6f75 745b 2743         df_out['C
+000031d0: 3133 5f70 6f73 275d 3d6e 702e 6e61 6e0a  13_pos']=np.nan.
+000031e0: 2020 2020 2020 2020 2020 2020 6466 5f6f              df_o
+000031f0: 7574 5b27 4331 335f 6865 6967 6874 275d  ut['C13_height']
+00003200: 3d6e 702e 6e61 6e0a 0a0a 0a20 2020 2023  =np.nan....    #
+00003210: 2044 6f20 7468 6520 7361 6d65 2066 6f72   Do the same for
+00003220: 2064 6961 6420 310a 0a20 2020 2072 6967   diad 1..    rig
+00003230: 6874 5f70 6f73 5f64 6961 6431 3d64 665f  ht_pos_diad1=df_
+00003240: 736f 7274 5f64 6961 6431 5f74 7269 6d5b  sort_diad1_trim[
+00003250: 2770 6f73 275d 2e62 6574 7765 656e 2863  'pos'].between(c
+00003260: 6f6e 6669 672e 6170 7072 6f78 5f64 6961  onfig.approx_dia
+00003270: 6431 5f70 6f73 5b30 5d2c 2063 6f6e 6669  d1_pos[0], confi
+00003280: 672e 6170 7072 6f78 5f64 6961 6431 5f70  g.approx_diad1_p
+00003290: 6f73 5b31 5d29 0a20 2020 2069 6620 616e  os[1]).    if an
+000032a0: 7928 7269 6768 745f 706f 735f 6469 6164  y(right_pos_diad
+000032b0: 3129 3a0a 2020 2020 2020 2020 6d61 6e75  1):.        manu
+000032c0: 616c 5f64 6961 6431 3d46 616c 7365 0a20  al_diad1=False. 
+000032d0: 2020 2020 2020 2064 665f 736f 7274 5f64         df_sort_d
+000032e0: 6961 6431 5f72 6967 6874 706f 733d 6466  iad1_rightpos=df
+000032f0: 5f73 6f72 745f 6469 6164 315f 7472 696d  _sort_diad1_trim
+00003300: 2e6c 6f63 5b72 6967 6874 5f70 6f73 5f64  .loc[right_pos_d
+00003310: 6961 6431 5d0a 2020 2020 2020 2020 6469  iad1].        di
+00003320: 6164 5f31 5f64 6961 643d 6466 5f73 6f72  ad_1_diad=df_sor
+00003330: 745f 6469 6164 315f 7269 6768 7470 6f73  t_diad1_rightpos
+00003340: 2e6c 6f63 5b64 665f 736f 7274 5f64 6961  .loc[df_sort_dia
+00003350: 6431 5f72 6967 6874 706f 735b 2768 6569  d1_rightpos['hei
+00003360: 6768 7427 5d3d 3d6e 702e 6d61 7828 6466  ght']==np.max(df
+00003370: 5f73 6f72 745f 6469 6164 315f 7269 6768  _sort_diad1_righ
+00003380: 7470 6f73 5b27 6865 6967 6874 275d 295d  tpos['height'])]
+00003390: 0a0a 2020 2020 2020 2020 6466 5f6f 7574  ..        df_out
+000033a0: 5b27 4469 6164 315f 706f 7327 5d3d 6469  ['Diad1_pos']=di
+000033b0: 6164 5f31 5f64 6961 645b 2770 6f73 275d  ad_1_diad['pos']
+000033c0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+000033d0: 2064 665f 6f75 745b 2744 6961 6431 5f68   df_out['Diad1_h
+000033e0: 6569 6768 7427 5d3d 6469 6164 5f31 5f64  eight']=diad_1_d
+000033f0: 6961 645b 2768 6569 6768 7427 5d2e 696c  iad['height'].il
+00003400: 6f63 5b30 5d0a 0a20 2020 2020 2020 2069  oc[0]..        i
+00003410: 6620 616e 7928 6466 5f73 6f72 745f 6469  f any(df_sort_di
+00003420: 6164 315f 7472 696d 5b27 706f 7327 5d2e  ad1_trim['pos'].
+00003430: 6265 7477 6565 6e28 6469 6164 5f31 5f64  between(diad_1_d
+00003440: 6961 645b 2770 6f73 275d 2e69 6c6f 635b  iad['pos'].iloc[
+00003450: 305d 2d64 6961 6431 5f48 4231 5f6d 6178  0]-diad1_HB1_max
+00003460: 5f6f 6666 7365 742c 2064 6961 645f 315f  _offset, diad_1_
+00003470: 6469 6164 5b27 706f 7327 5d2e 696c 6f63  diad['pos'].iloc
+00003480: 5b30 5d2d 6469 6164 315f 4842 315f 6d69  [0]-diad1_HB1_mi
+00003490: 6e5f 6f66 6673 6574 2929 3a0a 2020 2020  n_offset)):.    
+000034a0: 2020 2020 2020 2020 6469 6164 5f31 5f48          diad_1_H
+000034b0: 423d 6466 5f73 6f72 745f 6469 6164 315f  B=df_sort_diad1_
+000034c0: 7472 696d 2e6c 6f63 5b64 665f 736f 7274  trim.loc[df_sort
+000034d0: 5f64 6961 6431 5f74 7269 6d5b 2770 6f73  _diad1_trim['pos
+000034e0: 275d 2e62 6574 7765 656e 2864 6961 645f  '].between(diad_
+000034f0: 315f 6469 6164 5b27 706f 7327 5d2e 696c  1_diad['pos'].il
+00003500: 6f63 5b30 5d2d 6469 6164 315f 4842 315f  oc[0]-diad1_HB1_
+00003510: 6d61 785f 6f66 6673 6574 2c20 6469 6164  max_offset, diad
+00003520: 5f31 5f64 6961 645b 2770 6f73 275d 2e69  _1_diad['pos'].i
+00003530: 6c6f 635b 305d 2d64 6961 6431 5f48 4231  loc[0]-diad1_HB1
+00003540: 5f6d 696e 5f6f 6666 7365 7429 5d0a 2020  _min_offset)].  
+00003550: 2020 2020 2020 2020 2020 6466 5f6f 7574            df_out
+00003560: 5b27 4842 315f 706f 7327 5d3d 6469 6164  ['HB1_pos']=diad
+00003570: 5f31 5f48 425b 2770 6f73 275d 2e69 6c6f  _1_HB['pos'].ilo
+00003580: 635b 305d 0a20 2020 2020 2020 2020 2020  c[0].           
+00003590: 2064 665f 6f75 745b 2748 4231 5f68 6569   df_out['HB1_hei
+000035a0: 6768 7427 5d3d 6469 6164 5f31 5f48 425b  ght']=diad_1_HB[
+000035b0: 2768 6569 6768 7427 5d2e 696c 6f63 5b30  'height'].iloc[0
+000035c0: 5d0a 0a20 2020 2020 2020 2065 6c73 653a  ]..        else:
+000035d0: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
+000035e0: 6f75 745b 2748 4231 5f70 6f73 275d 3d6e  out['HB1_pos']=n
+000035f0: 702e 6e61 6e0a 2020 2020 2020 2020 2020  p.nan.          
+00003600: 2020 6466 5f6f 7574 5b27 4842 315f 6865    df_out['HB1_he
+00003610: 6967 6874 275d 3d6e 702e 6e61 6e0a 0a0a  ight']=np.nan...
+00003620: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00003630: 2020 6d61 6e75 616c 5f64 6961 6431 3d54    manual_diad1=T
+00003640: 7275 650a 2020 2020 2020 2020 6469 6164  rue.        diad
+00003650: 315f 7261 6e67 653d 2844 6961 645b 3a2c  1_range=(Diad[:,
+00003660: 2030 5d3e 636f 6e66 6967 2e61 7070 726f   0]>config.appro
+00003670: 785f 6469 6164 315f 706f 735b 305d 2920  x_diad1_pos[0]) 
+00003680: 2620 2844 6961 645b 3a2c 2030 5d3c 636f  & (Diad[:, 0]<co
+00003690: 6e66 6967 2e61 7070 726f 785f 6469 6164  nfig.approx_diad
+000036a0: 315f 706f 735b 315d 290a 2020 2020 2020  1_pos[1]).      
+000036b0: 2020 6469 6164 315f 6865 6967 6874 3d6e    diad1_height=n
+000036c0: 702e 6d61 7828 4469 6164 5b3a 2c20 315d  p.max(Diad[:, 1]
+000036d0: 5b64 6961 6431 5f72 616e 6765 5d29 0a20  [diad1_range]). 
+000036e0: 2020 2020 2020 2064 6961 6431 5f70 6f73         diad1_pos
+000036f0: 3d44 6961 645b 3a2c 2030 5d5b 2844 6961  =Diad[:, 0][(Dia
+00003700: 645b 3a2c 2031 5d3d 3d64 6961 6431 5f68  d[:, 1]==diad1_h
+00003710: 6569 6768 7429 2664 6961 6431 5f72 616e  eight)&diad1_ran
+00003720: 6765 5d0a 0a0a 2020 2020 2020 2020 6466  ge]...        df
+00003730: 5f6f 7574 5b27 4469 6164 315f 706f 7327  _out['Diad1_pos'
+00003740: 5d3d 2064 6961 6431 5f70 6f73 5b30 5d0a  ]= diad1_pos[0].
+00003750: 2020 2020 2020 2020 6466 5f6f 7574 5b27          df_out['
+00003760: 4469 6164 315f 6865 6967 6874 275d 3d64  Diad1_height']=d
+00003770: 6961 6431 5f68 6569 6768 740a 0a20 2020  iad1_height..   
+00003780: 2020 2020 2023 204c 6574 7320 7365 6520       # Lets see 
+00003790: 6966 2077 6520 6361 6e20 6669 6e64 2061  if we can find a
+000037a0: 2068 6f74 6261 6e64 2069 6e20 6865 7265   hotband in here
+000037b0: 206e 6f77 0a20 2020 2020 2020 2069 6620   now.        if 
+000037c0: 616e 7928 6466 5f73 6f72 745f 6469 6164  any(df_sort_diad
+000037d0: 315f 7472 696d 5b27 706f 7327 5d2e 6265  1_trim['pos'].be
+000037e0: 7477 6565 6e28 6466 5f6f 7574 5b27 4469  tween(df_out['Di
+000037f0: 6164 315f 706f 7327 5d2e 696c 6f63 5b30  ad1_pos'].iloc[0
+00003800: 5d2d 6469 6164 315f 4842 315f 6d61 785f  ]-diad1_HB1_max_
+00003810: 6f66 6673 6574 2c20 6466 5f6f 7574 5b27  offset, df_out['
+00003820: 4469 6164 315f 706f 7327 5d2e 696c 6f63  Diad1_pos'].iloc
+00003830: 5b30 5d2d 6469 6164 315f 4842 315f 6d69  [0]-diad1_HB1_mi
+00003840: 6e5f 6f66 6673 6574 2929 3a0a 2020 2020  n_offset)):.    
+00003850: 2020 2020 2020 2020 6469 6164 5f31 5f48          diad_1_H
+00003860: 423d 6466 5f73 6f72 745f 6469 6164 315f  B=df_sort_diad1_
+00003870: 7472 696d 2e6c 6f63 5b64 665f 736f 7274  trim.loc[df_sort
+00003880: 5f64 6961 6431 5f74 7269 6d5b 2770 6f73  _diad1_trim['pos
+00003890: 275d 2e62 6574 7765 656e 2864 665f 6f75  '].between(df_ou
+000038a0: 745b 2744 6961 6431 5f70 6f73 275d 2e69  t['Diad1_pos'].i
+000038b0: 6c6f 635b 305d 2d64 6961 6431 5f48 4231  loc[0]-diad1_HB1
+000038c0: 5f6d 6178 5f6f 6666 7365 742c 2064 665f  _max_offset, df_
+000038d0: 6f75 745b 2744 6961 6431 5f70 6f73 275d  out['Diad1_pos']
+000038e0: 2e69 6c6f 635b 305d 2d64 6961 6431 5f48  .iloc[0]-diad1_H
+000038f0: 4231 5f6d 696e 5f6f 6666 7365 7429 5d0a  B1_min_offset)].
+00003900: 2020 2020 2020 2020 2020 2020 6466 5f6f              df_o
+00003910: 7574 5b27 4842 315f 706f 7327 5d3d 6469  ut['HB1_pos']=di
+00003920: 6164 5f31 5f48 425b 2770 6f73 275d 2e69  ad_1_HB['pos'].i
+00003930: 6c6f 635b 305d 0a20 2020 2020 2020 2020  loc[0].         
+00003940: 2020 2064 665f 6f75 745b 2748 4231 5f68     df_out['HB1_h
+00003950: 6569 6768 7427 5d3d 6469 6164 5f31 5f48  eight']=diad_1_H
+00003960: 425b 2768 6569 6768 7427 5d2e 696c 6f63  B['height'].iloc
+00003970: 5b30 5d0a 0a20 2020 2020 2020 2065 6c73  [0]..        els
+00003980: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
+00003990: 665f 6f75 745b 2748 4231 5f70 6f73 275d  f_out['HB1_pos']
+000039a0: 3d6e 702e 6e61 6e0a 2020 2020 2020 2020  =np.nan.        
+000039b0: 2020 2020 6466 5f6f 7574 5b27 4842 315f      df_out['HB1_
+000039c0: 6865 6967 6874 275d 3d6e 702e 6e61 6e0a  height']=np.nan.
+000039d0: 0a20 2020 2023 204c 6574 7320 6765 7420  .    # Lets get 
+000039e0: 7468 6520 7072 6f6d 696e 656e 6365 206f  the prominence o
+000039f0: 6620 7468 6520 6d61 696e 2070 6561 6b73  f the main peaks
+00003a00: 2061 6e64 2068 6f74 6261 6e64 7320 6e6f   and hotbands no
+00003a10: 7720 7765 2068 6176 6520 666f 756e 6420  w we have found 
+00003a20: 7468 656d 0a20 2020 2044 6961 645f 783d  them.    Diad_x=
+00003a30: 4469 6164 5b3a 2c20 305d 0a20 2020 2044  Diad[:, 0].    D
+00003a40: 6961 645f 793d 4469 6164 5b3a 2c20 315d  iad_y=Diad[:, 1]
+00003a50: 0a20 2020 204d 6564 5f4c 4853 5f64 6961  .    Med_LHS_dia
+00003a60: 6431 3d6e 702e 6e61 6e6d 6564 6961 6e28  d1=np.nanmedian(
+00003a70: 4469 6164 5f79 5b28 4469 6164 5b3a 2c20  Diad_y[(Diad[:, 
+00003a80: 305d 3e63 6f6e 6669 672e 4c48 5f62 636b  0]>config.LH_bck
+00003a90: 5f64 6961 6431 5b30 5d29 2620 2844 6961  _diad1[0])& (Dia
+00003aa0: 645b 3a2c 2030 5d3c 636f 6e66 6967 2e4c  d[:, 0]<config.L
+00003ab0: 485f 6263 6b5f 6469 6164 315b 315d 295d  H_bck_diad1[1])]
+00003ac0: 290a 2020 2020 4d65 645f 5248 535f 6469  ).    Med_RHS_di
+00003ad0: 6164 313d 6e70 2e6e 616e 6d65 6469 616e  ad1=np.nanmedian
+00003ae0: 2844 6961 645f 795b 2844 6961 645b 3a2c  (Diad_y[(Diad[:,
+00003af0: 2030 5d3e 636f 6e66 6967 2e52 485f 6263   0]>config.RH_bc
+00003b00: 6b5f 6469 6164 315b 305d 2926 2028 4469  k_diad1[0])& (Di
+00003b10: 6164 5b3a 2c20 305d 3c63 6f6e 6669 672e  ad[:, 0]<config.
+00003b20: 5248 5f62 636b 5f64 6961 6431 5b31 5d29  RH_bck_diad1[1])
+00003b30: 5d29 0a20 2020 204d 6564 5f4c 4853 5f64  ]).    Med_LHS_d
+00003b40: 6961 6432 3d6e 702e 6e61 6e6d 6564 6961  iad2=np.nanmedia
+00003b50: 6e28 4469 6164 5f79 5b28 4469 6164 5b3a  n(Diad_y[(Diad[:
+00003b60: 2c20 305d 3e63 6f6e 6669 672e 4c48 5f62  , 0]>config.LH_b
+00003b70: 636b 5f64 6961 6432 5b30 5d29 2620 2844  ck_diad2[0])& (D
+00003b80: 6961 645b 3a2c 2030 5d3c 636f 6e66 6967  iad[:, 0]<config
+00003b90: 2e4c 485f 6263 6b5f 6469 6164 325b 315d  .LH_bck_diad2[1]
+00003ba0: 295d 290a 2020 2020 4d65 645f 5248 535f  )]).    Med_RHS_
+00003bb0: 6469 6164 323d 6e70 2e6e 616e 6d65 6469  diad2=np.nanmedi
+00003bc0: 616e 2844 6961 645f 795b 2844 6961 645b  an(Diad_y[(Diad[
+00003bd0: 3a2c 2030 5d3e 636f 6e66 6967 2e52 485f  :, 0]>config.RH_
+00003be0: 6263 6b5f 6469 6164 325b 305d 2926 2028  bck_diad2[0])& (
+00003bf0: 4469 6164 5b3a 2c20 305d 3c63 6f6e 6669  Diad[:, 0]<confi
+00003c00: 672e 5248 5f62 636b 5f64 6961 6432 5b31  g.RH_bck_diad2[1
+00003c10: 5d29 5d29 0a20 2020 2023 4d65 645f 6365  ])]).    #Med_ce
+00003c20: 6e74 7261 6c5f 6261 636b 5f64 6961 6432  ntral_back_diad2
+00003c30: 3d6e 702e 6e61 6e6d 6564 6961 6e28 4469  =np.nanmedian(Di
+00003c40: 6164 5b28 4469 6164 5b3a 2c20 305d 3e31  ad[(Diad[:, 0]>1
+00003c50: 3330 3029 2620 2844 6961 645b 3a2c 2030  300)& (Diad[:, 0
+00003c60: 5d3c 3133 3530 295d 0a0a 2020 2020 4469  ]<1350)]..    Di
+00003c70: 6164 5f64 6961 6431 3d44 6961 645f 795b  ad_diad1=Diad_y[
+00003c80: 2844 6961 645b 3a2c 2030 5d3e 3132 3630  (Diad[:, 0]>1260
+00003c90: 2926 2028 4469 6164 5b3a 2c20 305d 3c31  )& (Diad[:, 0]<1
+00003ca0: 3330 3029 5d0a 2020 2020 4469 6164 5f64  300)].    Diad_d
+00003cb0: 6961 6432 3d44 6961 645f 795b 2844 6961  iad2=Diad_y[(Dia
+00003cc0: 645b 3a2c 2030 5d3e 3133 3830 2926 2028  d[:, 0]>1380)& (
+00003cd0: 4469 6164 5b3a 2c20 305d 3c31 3430 3029  Diad[:, 0]<1400)
+00003ce0: 5d0a 2020 2020 4d65 645f 6263 6b5f 6469  ].    Med_bck_di
+00003cf0: 6164 313d 284d 6564 5f4c 4853 5f64 6961  ad1=(Med_LHS_dia
+00003d00: 6431 2b4d 6564 5f52 4853 5f64 6961 6431  d1+Med_RHS_diad1
+00003d10: 292f 320a 2020 2020 4d65 645f 6263 6b5f  )/2.    Med_bck_
+00003d20: 6469 6164 323d 284d 6564 5f52 4853 5f64  diad2=(Med_RHS_d
+00003d30: 6961 6432 2b4d 6564 5f4c 4853 5f64 6961  iad2+Med_LHS_dia
+00003d40: 6432 292f 320a 0a20 2020 2064 665f 6f75  d2)/2..    df_ou
+00003d50: 745b 2744 6961 6431 5f4d 6564 6961 6e5f  t['Diad1_Median_
+00003d60: 4263 6b27 5d3d 4d65 645f 6263 6b5f 6469  Bck']=Med_bck_di
+00003d70: 6164 310a 2020 2020 6466 5f6f 7574 5b27  ad1.    df_out['
+00003d80: 4469 6164 325f 4d65 6469 616e 5f42 636b  Diad2_Median_Bck
+00003d90: 275d 3d4d 6564 5f62 636b 5f64 6961 6432  ']=Med_bck_diad2
+00003da0: 0a0a 2020 2020 6466 5f6f 7574 5b27 4469  ..    df_out['Di
+00003db0: 6164 315f 6162 735f 7072 6f6d 275d 3d64  ad1_abs_prom']=d
+00003dc0: 665f 6f75 745b 2744 6961 6431 5f68 6569  f_out['Diad1_hei
+00003dd0: 6768 7427 5d2d 4d65 645f 6263 6b5f 6469  ght']-Med_bck_di
+00003de0: 6164 310a 2020 2020 6466 5f6f 7574 5b27  ad1.    df_out['
+00003df0: 4469 6164 325f 6162 735f 7072 6f6d 275d  Diad2_abs_prom']
+00003e00: 3d64 665f 6f75 745b 2744 6961 6432 5f68  =df_out['Diad2_h
+00003e10: 6569 6768 7427 5d2d 4d65 645f 6263 6b5f  eight']-Med_bck_
+00003e20: 6469 6164 320a 2020 2020 6466 5f6f 7574  diad2.    df_out
+00003e30: 5b27 4469 6164 315f 7265 6c5f 7072 6f6d  ['Diad1_rel_prom
+00003e40: 275d 3d64 665f 6f75 745b 2744 6961 6431  ']=df_out['Diad1
+00003e50: 5f68 6569 6768 7427 5d2f 4d65 645f 6263  _height']/Med_bc
+00003e60: 6b5f 6469 6164 310a 2020 2020 6466 5f6f  k_diad1.    df_o
+00003e70: 7574 5b27 4469 6164 325f 7265 6c5f 7072  ut['Diad2_rel_pr
+00003e80: 6f6d 275d 3d64 665f 6f75 745b 2744 6961  om']=df_out['Dia
+00003e90: 6432 5f68 6569 6768 7427 5d2f 4d65 645f  d2_height']/Med_
+00003ea0: 6263 6b5f 6469 6164 320a 2020 2020 6466  bck_diad2.    df
+00003eb0: 5f6f 7574 5b27 4842 315f 6162 735f 7072  _out['HB1_abs_pr
+00003ec0: 6f6d 275d 3d64 665f 6f75 745b 2748 4231  om']=df_out['HB1
+00003ed0: 5f68 6569 6768 7427 5d2d 4d65 645f 4c48  _height']-Med_LH
+00003ee0: 535f 6469 6164 310a 2020 2020 6466 5f6f  S_diad1.    df_o
+00003ef0: 7574 5b27 4842 325f 6162 735f 7072 6f6d  ut['HB2_abs_prom
+00003f00: 275d 3d64 665f 6f75 745b 2748 4232 5f68  ']=df_out['HB2_h
+00003f10: 6569 6768 7427 5d2d 4d65 645f 5248 535f  eight']-Med_RHS_
+00003f20: 6469 6164 320a 2020 2020 6466 5f6f 7574  diad2.    df_out
+00003f30: 5b27 4842 315f 7265 6c5f 7072 6f6d 275d  ['HB1_rel_prom']
+00003f40: 3d64 665f 6f75 745b 2748 4231 5f68 6569  =df_out['HB1_hei
+00003f50: 6768 7427 5d2f 4d65 645f 4c48 535f 6469  ght']/Med_LHS_di
+00003f60: 6164 310a 2020 2020 6466 5f6f 7574 5b27  ad1.    df_out['
+00003f70: 4842 325f 7265 6c5f 7072 6f6d 275d 3d64  HB2_rel_prom']=d
+00003f80: 665f 6f75 745b 2748 4232 5f68 6569 6768  f_out['HB2_heigh
+00003f90: 7427 5d2f 4d65 645f 5248 535f 6469 6164  t']/Med_RHS_diad
+00003fa0: 320a 0a20 2020 2064 665f 6f75 745b 2761  2..    df_out['a
+00003fb0: 7070 726f 785f 7370 6c69 7427 5d3d 6466  pprox_split']=df
+00003fc0: 5f6f 7574 5b27 4469 6164 325f 706f 7327  _out['Diad2_pos'
+00003fd0: 5d2d 6466 5f6f 7574 5b27 4469 6164 315f  ]-df_out['Diad1_
+00003fe0: 706f 7327 5d0a 0a0a 2020 2020 2320 4c65  pos']...    # Le
+00003ff0: 7473 2067 6574 2074 6865 2043 3133 2070  ts get the C13 p
+00004000: 726f 6d69 6e65 6e63 650a 2020 2020 6966  rominence.    if
+00004010: 2061 6e79 2864 665f 6f75 745b 2743 3133   any(df_out['C13
+00004020: 5f70 6f73 275d 3e2d 3530 3029 3a0a 2020  _pos']>-500):.  
+00004030: 2020 2020 2020 4331 335f 6261 636b 3d6e        C13_back=n
+00004040: 702e 7175 616e 7469 6c65 2844 6961 645f  p.quantile(Diad_
+00004050: 795b 0a20 2020 2020 2020 2028 2844 6961  y[.        ((Dia
+00004060: 645f 783e 2864 665f 6f75 745b 2743 3133  d_x>(df_out['C13
+00004070: 5f70 6f73 275d 2e69 6c6f 635b 305d 2d33  _pos'].iloc[0]-3
+00004080: 2929 2628 4469 6164 5f78 3c28 6466 5f6f  ))&(Diad_x<(df_o
+00004090: 7574 5b27 4331 335f 706f 7327 5d2e 696c  ut['C13_pos'].il
+000040a0: 6f63 5b30 5d2b 3329 2929 0a20 2020 2020  oc[0]+3))).     
+000040b0: 2020 205d 2c20 302e 3235 290a 0a20 2020     ], 0.25)..   
+000040c0: 2020 2020 2064 665f 6f75 745b 2743 3133       df_out['C13
+000040d0: 5f61 6273 5f70 726f 6d27 5d3d 6466 5f6f  _abs_prom']=df_o
+000040e0: 7574 5b27 4331 335f 6865 6967 6874 275d  ut['C13_height']
+000040f0: 2d43 3133 5f62 6163 6b0a 2020 2020 2020  -C13_back.      
+00004100: 2020 6466 5f6f 7574 5b27 4331 335f 7265    df_out['C13_re
+00004110: 6c5f 7072 6f6d 275d 3d64 665f 6f75 745b  l_prom']=df_out[
+00004120: 2743 3133 5f68 6569 6768 7427 5d2f 4331  'C13_height']/C1
+00004130: 335f 6261 636b 0a20 2020 2020 2020 2064  3_back.        d
+00004140: 665f 6f75 745b 2743 3133 5f48 4232 5f61  f_out['C13_HB2_a
+00004150: 6273 5f70 726f 6d5f 7261 7469 6f27 5d3d  bs_prom_ratio']=
+00004160: 6466 5f6f 7574 5b27 4842 325f 6162 735f  df_out['HB2_abs_
+00004170: 7072 6f6d 275d 2f64 665f 6f75 745b 2743  prom']/df_out['C
+00004180: 3133 5f61 6273 5f70 726f 6d27 5d0a 2020  13_abs_prom'].  
+00004190: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000041a0: 6466 5f6f 7574 5b27 4331 335f 6162 735f  df_out['C13_abs_
+000041b0: 7072 6f6d 275d 3d6e 702e 6e61 6e0a 2020  prom']=np.nan.  
+000041c0: 2020 2020 2020 6466 5f6f 7574 5b27 4331        df_out['C1
+000041d0: 335f 7265 6c5f 7072 6f6d 275d 3d6e 702e  3_rel_prom']=np.
+000041e0: 6e61 6e0a 2020 2020 2020 2020 6466 5f6f  nan.        df_o
+000041f0: 7574 5b27 4331 335f 4842 325f 6162 735f  ut['C13_HB2_abs_
+00004200: 7072 6f6d 5f72 6174 696f 275d 3d6e 702e  prom_ratio']=np.
+00004210: 6e61 6e0a 0a20 2020 2023 204c 6574 7320  nan..    # Lets 
+00004220: 6765 7420 7468 6520 7072 6f6d 696e 656e  get the prominen
+00004230: 6365 206f 6620 7468 6520 7661 6c6c 6579  ce of the valley
+00004240: 2062 6574 7765 656e 2068 6f74 6261 6e64   between hotband
+00004250: 7320 616e 6420 7468 6520 6469 6164 0a0a  s and the diad..
+00004260: 2020 2020 2320 4669 6e64 2074 6865 206d      # Find the m
+00004270: 696e 696d 756d 2069 6e74 656e 7369 7479  inimum intensity
+00004280: 2062 6574 7765 656e 2074 6865 2064 6961   between the dia
+00004290: 6420 616e 6420 4842 0a0a 2020 2020 6966  d and HB..    if
+000042a0: 206e 6f74 206e 702e 6973 6e61 6e28 6466   not np.isnan(df
+000042b0: 5f6f 7574 5b27 4842 325f 706f 7327 5d2e  _out['HB2_pos'].
+000042c0: 696c 6f63 5b30 5d29 3a0a 0a0a 2020 2020  iloc[0]):...    
+000042d0: 2020 2020 4469 6164 325f 6265 7477 6565      Diad2_betwee
+000042e0: 6e3d 4469 6164 5b28 4469 6164 5b3a 2c20  n=Diad[(Diad[:, 
+000042f0: 305d 3c64 665f 6f75 745b 2748 4232 5f70  0]<df_out['HB2_p
+00004300: 6f73 275d 2e69 6c6f 635b 305d 2926 2028  os'].iloc[0])& (
+00004310: 4469 6164 5b3a 2c20 305d 3e64 665f 6f75  Diad[:, 0]>df_ou
+00004320: 745b 2744 6961 6432 5f70 6f73 275d 2e69  t['Diad2_pos'].i
+00004330: 6c6f 635b 305d 295d 0a20 2020 2020 2020  loc[0])].       
+00004340: 204d 696e 5f79 5f6d 6964 706f 696e 7432   Min_y_midpoint2
+00004350: 3d6e 702e 6d69 6e28 4469 6164 325f 6265  =np.min(Diad2_be
+00004360: 7477 6565 6e5b 3a2c 2031 5d29 0a0a 2020  tween[:, 1])..  
+00004370: 2020 2020 2020 2320 4f70 7469 6f6e 2068        # Option h
+00004380: 6572 650a 2020 2020 2020 2020 5248 535f  ere.        RHS_
+00004390: 785f 4469 6164 323d 2864 665f 6f75 745b  x_Diad2=(df_out[
+000043a0: 2748 4232 5f70 6f73 275d 2e69 6c6f 635b  'HB2_pos'].iloc[
+000043b0: 305d 292b 3230 0a20 2020 2020 2020 2052  0])+20.        R
+000043c0: 4853 5f79 5f44 6961 6432 3d6e 702e 6d65  HS_y_Diad2=np.me
+000043d0: 6469 616e 2844 6961 645b 3a2c 2031 5d5b  dian(Diad[:, 1][
+000043e0: 0a20 2020 2020 2020 2020 2020 2028 4469  .            (Di
+000043f0: 6164 5b3a 2c20 305d 3c52 4853 5f78 5f44  ad[:, 0]<RHS_x_D
+00004400: 6961 6432 2b32 2a73 7065 635f 7265 7329  iad2+2*spec_res)
+00004410: 0a20 2020 2020 2020 2020 2020 2026 2844  .            &(D
+00004420: 6961 645b 3a2c 2030 5d3e 5248 535f 785f  iad[:, 0]>RHS_x_
+00004430: 4469 6164 322d 322a 7370 6563 5f72 6573  Diad2-2*spec_res
+00004440: 295d 290a 0a20 2020 2020 2020 2064 665f  )])..        df_
+00004450: 6f75 745b 2744 6961 6432 5f48 4232 5f56  out['Diad2_HB2_V
+00004460: 616c 6c65 795f 7072 6f6d 275d 3d4d 696e  alley_prom']=Min
+00004470: 5f79 5f6d 6964 706f 696e 7432 2f52 4853  _y_midpoint2/RHS
+00004480: 5f79 5f44 6961 6432 0a20 2020 2065 6c73  _y_Diad2.    els
+00004490: 653a 0a0a 2020 2020 2020 2020 6466 5f6f  e:..        df_o
+000044a0: 7574 5b27 4469 6164 325f 4842 325f 5661  ut['Diad2_HB2_Va
+000044b0: 6c6c 6579 5f70 726f 6d27 5d3d 6e70 2e6e  lley_prom']=np.n
+000044c0: 616e 0a0a 2020 2020 6966 206e 6f74 206e  an..    if not n
+000044d0: 702e 6973 6e61 6e28 6466 5f6f 7574 5b27  p.isnan(df_out['
+000044e0: 4842 315f 706f 7327 5d2e 696c 6f63 5b30  HB1_pos'].iloc[0
+000044f0: 5d29 3a0a 2020 2020 2020 2020 4469 6164  ]):.        Diad
+00004500: 315f 6265 7477 6565 6e3d 4469 6164 5b28  1_between=Diad[(
+00004510: 4469 6164 5b3a 2c20 305d 3e64 665f 6f75  Diad[:, 0]>df_ou
+00004520: 745b 2748 4231 5f70 6f73 275d 2e69 6c6f  t['HB1_pos'].ilo
+00004530: 635b 305d 2926 2028 4469 6164 5b3a 2c20  c[0])& (Diad[:, 
+00004540: 305d 3c64 665f 6f75 745b 2744 6961 6431  0]<df_out['Diad1
+00004550: 5f70 6f73 275d 2e69 6c6f 635b 305d 295d  _pos'].iloc[0])]
+00004560: 0a20 2020 2020 2020 204d 696e 5f79 5f6d  .        Min_y_m
+00004570: 6964 706f 696e 7431 3d6e 702e 6d69 6e28  idpoint1=np.min(
+00004580: 4469 6164 315f 6265 7477 6565 6e5b 3a2c  Diad1_between[:,
+00004590: 2031 5d29 0a0a 2020 2020 2020 2020 2320   1])..        # 
+000045a0: 6f70 7469 6f6e 2068 6572 6520 7365 656d  option here seem
+000045b0: 7320 746f 2077 6f72 6b20 6265 7474 6572  s to work better
+000045c0: 0a20 2020 2020 2020 204c 4853 5f78 5f44  .        LHS_x_D
+000045d0: 6961 6431 3d28 6466 5f6f 7574 5b27 4842  iad1=(df_out['HB
+000045e0: 315f 706f 7327 5d2e 696c 6f63 5b30 5d29  1_pos'].iloc[0])
+000045f0: 2d32 300a 2020 2020 2020 2020 4c48 535f  -20.        LHS_
+00004600: 795f 4469 6164 313d 6e70 2e6d 6564 6961  y_Diad1=np.media
+00004610: 6e28 4469 6164 5b3a 2c20 315d 5b0a 2020  n(Diad[:, 1][.  
+00004620: 2020 2020 2020 2020 2020 2844 6961 645b            (Diad[
+00004630: 3a2c 2030 5d3c 4c48 535f 785f 4469 6164  :, 0]<LHS_x_Diad
+00004640: 312b 322e 312a 7370 6563 5f72 6573 290a  1+2.1*spec_res).
+00004650: 2020 2020 2020 2020 2020 2020 2628 4469              &(Di
+00004660: 6164 5b3a 2c20 305d 3e4c 4853 5f78 5f44  ad[:, 0]>LHS_x_D
+00004670: 6961 6431 2d32 2e31 2a73 7065 635f 7265  iad1-2.1*spec_re
+00004680: 7329 5d29 0a0a 0a20 2020 2020 2020 2064  s)])...        d
+00004690: 665f 6f75 745b 2744 6961 6431 5f48 4231  f_out['Diad1_HB1
+000046a0: 5f56 616c 6c65 795f 7072 6f6d 275d 3d4d  _Valley_prom']=M
+000046b0: 696e 5f79 5f6d 6964 706f 696e 7431 2f4c  in_y_midpoint1/L
+000046c0: 4853 5f79 5f44 6961 6431 0a20 2020 2065  HS_y_Diad1.    e
+000046d0: 6c73 653a 0a20 2020 2020 2020 2064 665f  lse:.        df_
+000046e0: 6f75 745b 2744 6961 6431 5f48 4231 5f56  out['Diad1_HB1_V
+000046f0: 616c 6c65 795f 7072 6f6d 275d 3d6e 702e  alley_prom']=np.
+00004700: 6e61 6e0a 2020 2020 2320 4469 7669 6465  nan.    # Divide
+00004710: 2062 7920 7468 6520 6d65 6469 616e 2062   by the median b
+00004720: 6163 6b67 726f 756e 6420 706f 7369 7469  ackground positi
+00004730: 6f6e 2066 6f75 6e64 2061 626f 7665 0a0a  on found above..
+00004740: 0a0a 0a0a 0a20 2020 2023 204f 7468 6572  .....    # Other
+00004750: 2075 7365 6675 6c20 7061 7261 6d73 0a0a   useful params..
+00004760: 2020 2020 2320 4d65 616e 206f 6620 4842      # Mean of HB
+00004770: 2065 6c65 7661 7469 6f6e 2e0a 2020 2020   elevation..    
+00004780: 6466 5f6f 7574 5b27 4d65 616e 5f44 6961  df_out['Mean_Dia
+00004790: 645f 4842 5f56 616c 6c65 795f 7072 6f6d  d_HB_Valley_prom
+000047a0: 275d 3d28 6466 5f6f 7574 5b27 4469 6164  ']=(df_out['Diad
+000047b0: 325f 4842 325f 5661 6c6c 6579 5f70 726f  2_HB2_Valley_pro
+000047c0: 6d27 5d2b 6466 5f6f 7574 5b27 4469 6164  m']+df_out['Diad
+000047d0: 315f 4842 315f 5661 6c6c 6579 5f70 726f  1_HB1_Valley_pro
+000047e0: 6d27 5d29 2f32 0a0a 2020 2020 2320 4d65  m'])/2..    # Me
+000047f0: 616e 2048 4220 7072 6f6d 696e 656e 6365  an HB prominence
+00004800: 0a20 2020 2064 665f 6f75 745b 274d 6561  .    df_out['Mea
+00004810: 6e5f 6162 735f 4842 5f70 726f 6d27 5d3d  n_abs_HB_prom']=
+00004820: 2864 665f 6f75 745b 2748 4231 5f61 6273  (df_out['HB1_abs
+00004830: 5f70 726f 6d27 5d2b 6466 5f6f 7574 5b27  _prom']+df_out['
+00004840: 4842 325f 6162 735f 7072 6f6d 275d 290a  HB2_abs_prom']).
+00004850: 0a20 2020 2064 665f 6f75 745b 2744 6961  .    df_out['Dia
+00004860: 6432 5f48 4232 5f61 6273 5f70 726f 6d5f  d2_HB2_abs_prom_
+00004870: 7261 7469 6f27 5d3d 6466 5f6f 7574 5b27  ratio']=df_out['
+00004880: 4469 6164 325f 6162 735f 7072 6f6d 275d  Diad2_abs_prom']
+00004890: 2f64 665f 6f75 745b 2748 4232 5f61 6273  /df_out['HB2_abs
+000048a0: 5f70 726f 6d27 5d0a 2020 2020 6466 5f6f  _prom'].    df_o
+000048b0: 7574 5b27 4469 6164 315f 4842 315f 6162  ut['Diad1_HB1_ab
+000048c0: 735f 7072 6f6d 5f72 6174 696f 275d 3d64  s_prom_ratio']=d
+000048d0: 665f 6f75 745b 2744 6961 6431 5f61 6273  f_out['Diad1_abs
+000048e0: 5f70 726f 6d27 5d2f 6466 5f6f 7574 5b27  _prom']/df_out['
+000048f0: 4842 315f 6162 735f 7072 6f6d 275d 0a20  HB1_abs_prom']. 
+00004900: 2020 2023 2041 7665 7261 6765 2074 6865     # Average the
+00004910: 7365 0a20 2020 2064 665f 6f75 745b 2741  se.    df_out['A
+00004920: 765f 4469 6164 5f48 425f 7072 6f6d 5f72  v_Diad_HB_prom_r
+00004930: 6174 696f 275d 3d28 6466 5f6f 7574 5b27  atio']=(df_out['
+00004940: 4469 6164 325f 4842 325f 6162 735f 7072  Diad2_HB2_abs_pr
+00004950: 6f6d 5f72 6174 696f 275d 2b64 665f 6f75  om_ratio']+df_ou
+00004960: 745b 2744 6961 6431 5f48 4231 5f61 6273  t['Diad1_HB1_abs
+00004970: 5f70 726f 6d5f 7261 7469 6f27 5d29 2f32  _prom_ratio'])/2
+00004980: 0a20 2020 2023 2050 6172 616d 6574 6572  .    # Parameter
+00004990: 2066 6f72 2061 6d6f 756e 7420 6f66 206e   for amount of n
+000049a0: 6f69 7365 2062 6574 7765 656e 2064 6961  oise between dia
+000049b0: 6473 2076 732e 2068 6569 6768 7420 6f66  ds vs. height of
+000049c0: 2070 6561 6b73 0a0a 2020 2020 6265 7477   peaks..    betw
+000049d0: 6565 6e5f 6469 6164 735f 783d 2878 3e64  een_diads_x=(x>d
+000049e0: 6961 645f 6964 5f63 6f6e 6669 672e 5248  iad_id_config.RH
+000049f0: 5f62 636b 5f64 6961 6431 5b30 5d29 2628  _bck_diad1[0])&(
+00004a00: 783c 6469 6164 5f69 645f 636f 6e66 6967  x<diad_id_config
+00004a10: 2e4c 485f 6263 6b5f 6469 6164 325b 315d  .LH_bck_diad2[1]
+00004a20: 290a 2020 2020 7374 645f 6265 745f 6469  ).    std_bet_di
+00004a30: 6164 3d6e 702e 7374 6428 795b 6265 7477  ad=np.std(y[betw
+00004a40: 6565 6e5f 6469 6164 735f 785d 290a 0a20  een_diads_x]).. 
+00004a50: 2020 2064 665f 6f75 745b 2744 6961 6431     df_out['Diad1
+00004a60: 5f70 726f 6d2f 7374 645f 6265 7477 6565  _prom/std_betwee
+00004a70: 6e64 6961 6473 275d 3d64 665f 6f75 745b  ndiads']=df_out[
+00004a80: 2744 6961 6431 5f61 6273 5f70 726f 6d27  'Diad1_abs_prom'
+00004a90: 5d2f 7374 645f 6265 745f 6469 6164 0a20  ]/std_bet_diad. 
+00004aa0: 2020 2064 665f 6f75 745b 2744 6961 6432     df_out['Diad2
+00004ab0: 5f70 726f 6d2f 7374 645f 6265 7477 6565  _prom/std_betwee
+00004ac0: 6e64 6961 6473 275d 3d64 665f 6f75 745b  ndiads']=df_out[
+00004ad0: 2744 6961 6432 5f61 6273 5f70 726f 6d27  'Diad2_abs_prom'
+00004ae0: 5d2f 7374 645f 6265 745f 6469 6164 0a20  ]/std_bet_diad. 
+00004af0: 2020 2064 665f 6f75 745b 2748 4231 5f70     df_out['HB1_p
+00004b00: 726f 6d2f 7374 645f 6265 7477 6565 6e64  rom/std_betweend
+00004b10: 6961 6473 275d 3d64 665f 6f75 745b 2748  iads']=df_out['H
+00004b20: 4231 5f61 6273 5f70 726f 6d27 5d2f 7374  B1_abs_prom']/st
+00004b30: 645f 6265 745f 6469 6164 0a20 2020 2064  d_bet_diad.    d
+00004b40: 665f 6f75 745b 2748 4232 5f70 726f 6d2f  f_out['HB2_prom/
+00004b50: 7374 645f 6265 7477 6565 6e64 6961 6473  std_betweendiads
+00004b60: 275d 3d64 665f 6f75 745b 2748 4232 5f61  ']=df_out['HB2_a
+00004b70: 6273 5f70 726f 6d27 5d2f 7374 645f 6265  bs_prom']/std_be
+00004b80: 745f 6469 6164 0a0a 2020 2020 2320 4e65  t_diad..    # Ne
+00004b90: 7720 6f6e 6573 0a20 2020 2064 665f 6f75  w ones.    df_ou
+00004ba0: 745b 2741 765f 4469 6164 5f70 726f 6d2f  t['Av_Diad_prom/
+00004bb0: 7374 645f 6265 7477 6565 6e64 6961 6473  std_betweendiads
+00004bc0: 275d 3d28 6466 5f6f 7574 5b27 4469 6164  ']=(df_out['Diad
+00004bd0: 315f 7072 6f6d 2f73 7464 5f62 6574 7765  1_prom/std_betwe
+00004be0: 656e 6469 6164 7327 5d2b 6466 5f6f 7574  endiads']+df_out
+00004bf0: 5b27 4469 6164 325f 7072 6f6d 2f73 7464  ['Diad2_prom/std
+00004c00: 5f62 6574 7765 656e 6469 6164 7327 5d29  _betweendiads'])
+00004c10: 2f32 0a20 2020 2064 665f 6f75 745b 2743  /2.    df_out['C
+00004c20: 3133 5f70 726f 6d2f 4842 325f 7072 6f6d  13_prom/HB2_prom
+00004c30: 275d 3d64 665f 6f75 745b 2743 3133 5f61  ']=df_out['C13_a
+00004c40: 6273 5f70 726f 6d27 5d2f 6466 5f6f 7574  bs_prom']/df_out
+00004c50: 5b27 4842 325f 6162 735f 7072 6f6d 275d  ['HB2_abs_prom']
+00004c60: 0a0a 2020 2020 6466 5f6f 7574 5b27 4c65  ..    df_out['Le
+00004c70: 6674 5f76 735f 5269 6768 7427 5d3d 4d65  ft_vs_Right']=Me
+00004c80: 645f 4c48 535f 6469 6164 312f 4d65 645f  d_LHS_diad1/Med_
+00004c90: 5248 535f 6469 6164 320a 0a0a 0a20 2020  RHS_diad2....   
+00004ca0: 2023 204c 6574 7320 736f 7274 2062 6173   # Lets sort bas
+00004cb0: 6564 206f 6e20 636f 6c75 6d6e 7320 7765  ed on columns we
+00004cc0: 2077 616e 7420 6e65 6172 2065 6163 6820   want near each 
+00004cd0: 6f74 6865 720a 2020 2020 636f 6c73 5f74  other.    cols_t
+00004ce0: 6f5f 6d6f 7665 203d 205b 2766 696c 656e  o_move = ['filen
+00004cf0: 616d 6527 2c20 2761 7070 726f 785f 7370  ame', 'approx_sp
+00004d00: 6c69 7427 2c0a 2020 2020 2744 6961 6431  lit',.    'Diad1
+00004d10: 5f70 6f73 272c 2027 4469 6164 325f 706f  _pos', 'Diad2_po
+00004d20: 7327 2c27 4842 315f 706f 7327 2c20 2748  s','HB1_pos', 'H
+00004d30: 4232 5f70 6f73 272c 2027 4331 335f 706f  B2_pos', 'C13_po
+00004d40: 7327 2c0a 2020 2020 2744 6961 6431 5f61  s',.    'Diad1_a
+00004d50: 6273 5f70 726f 6d27 2c20 2744 6961 6432  bs_prom', 'Diad2
+00004d60: 5f61 6273 5f70 726f 6d27 2c20 2748 4231  _abs_prom', 'HB1
+00004d70: 5f61 6273 5f70 726f 6d27 2c20 2748 4232  _abs_prom', 'HB2
+00004d80: 5f61 6273 5f70 726f 6d27 2c20 2743 3133  _abs_prom', 'C13
+00004d90: 5f61 6273 5f70 726f 6d27 2c0a 2020 2020  _abs_prom',.    
+00004da0: 274d 6561 6e5f 6162 735f 4842 5f70 726f  'Mean_abs_HB_pro
+00004db0: 6d27 2c20 2744 6961 6432 5f48 4232 5f61  m', 'Diad2_HB2_a
+00004dc0: 6273 5f70 726f 6d5f 7261 7469 6f27 2c20  bs_prom_ratio', 
+00004dd0: 2744 6961 6431 5f48 4231 5f61 6273 5f70  'Diad1_HB1_abs_p
+00004de0: 726f 6d5f 7261 7469 6f27 2c0a 2020 2020  rom_ratio',.    
+00004df0: 2744 6961 6431 5f72 656c 5f70 726f 6d27  'Diad1_rel_prom'
+00004e00: 2c20 2744 6961 6432 5f72 656c 5f70 726f  , 'Diad2_rel_pro
+00004e10: 6d27 2c20 2748 4231 5f72 656c 5f70 726f  m', 'HB1_rel_pro
+00004e20: 6d27 2c20 2748 4232 5f72 656c 5f70 726f  m', 'HB2_rel_pro
+00004e30: 6d27 2c20 2743 3133 5f72 656c 5f70 726f  m', 'C13_rel_pro
+00004e40: 6d27 2c0a 2020 2020 2744 6961 6431 5f48  m',.    'Diad1_H
+00004e50: 4231 5f56 616c 6c65 795f 7072 6f6d 272c  B1_Valley_prom',
+00004e60: 0a20 2020 2027 4d65 616e 5f44 6961 645f  .    'Mean_Diad_
+00004e70: 4842 5f56 616c 6c65 795f 7072 6f6d 272c  HB_Valley_prom',
+00004e80: 0a20 2020 2027 4469 6164 315f 7072 6f6d  .    'Diad1_prom
+00004e90: 2f73 7464 5f62 6574 7765 656e 6469 6164  /std_betweendiad
+00004ea0: 7327 2c20 2744 6961 6432 5f70 726f 6d2f  s', 'Diad2_prom/
+00004eb0: 7374 645f 6265 7477 6565 6e64 6961 6473  std_betweendiads
+00004ec0: 272c 0a20 2020 2027 4176 5f44 6961 645f  ',.    'Av_Diad_
+00004ed0: 7072 6f6d 2f73 7464 5f62 6574 7765 656e  prom/std_between
+00004ee0: 6469 6164 7327 2c20 2743 3133 5f70 726f  diads', 'C13_pro
+00004ef0: 6d2f 4842 325f 7072 6f6d 272c 2027 4176  m/HB2_prom', 'Av
+00004f00: 5f44 6961 645f 4842 5f70 726f 6d5f 7261  _Diad_HB_prom_ra
+00004f10: 7469 6f27 2c20 274c 6566 745f 7673 5f52  tio', 'Left_vs_R
+00004f20: 6967 6874 275d 0a0a 2020 2020 6466 5f6f  ight']..    df_o
+00004f30: 7574 203d 2064 665f 6f75 745b 636f 6c73  ut = df_out[cols
+00004f40: 5f74 6f5f 6d6f 7665 202b 205b 0a20 2020  _to_move + [.   
+00004f50: 2020 2020 2063 6f6c 2066 6f72 2063 6f6c       col for col
+00004f60: 2069 6e20 6466 5f6f 7574 2e63 6f6c 756d   in df_out.colum
+00004f70: 6e73 2069 6620 636f 6c20 6e6f 7420 696e  ns if col not in
+00004f80: 2063 6f6c 735f 746f 5f6d 6f76 655d 5d0a   cols_to_move]].
+00004f90: 2020 2020 2320 4e6f 7720 6c65 7473 2067      # Now lets g
+00004fa0: 6574 2061 7070 726f 7869 6d61 7465 2073  et approximate s
+00004fb0: 7472 656e 6774 6820 7375 6274 7261 6374  trength subtract
+00004fc0: 696e 6720 7468 6520 6261 636b 6772 726f  ing the backgrro
+00004fd0: 756e 640a 0a20 2020 2023 204e 6f77 206c  und..    # Now l
+00004fe0: 6574 7320 6d61 6b65 2061 2070 6c6f 740a  ets make a plot.
+00004ff0: 2020 2020 6966 2070 6c6f 745f 6669 6775      if plot_figu
+00005000: 7265 2069 7320 5472 7565 3a0a 2020 2020  re is True:.    
+00005010: 2020 2020 6669 672c 2028 6178 302c 2061      fig, (ax0, a
+00005020: 7831 2c20 6178 3229 203d 2070 6c74 2e73  x1, ax2) = plt.s
+00005030: 7562 706c 6f74 7328 312c 2033 2c20 6669  ubplots(1, 3, fi
+00005040: 6773 697a 653d 2831 322c 3429 290a 0a20  gsize=(12,4)).. 
+00005050: 2020 2020 2020 2061 7830 2e70 6c6f 7428         ax0.plot(
+00005060: 4469 6164 5b3a 2c20 305d 2c20 4469 6164  Diad[:, 0], Diad
+00005070: 5b3a 2c20 315d 2c20 272d 7227 290a 2020  [:, 1], '-r').  
+00005080: 2020 2020 2020 6178 302e 706c 6f74 2864        ax0.plot(d
+00005090: 665b 2770 6f73 275d 2c20 6466 5b27 6865  f['pos'], df['he
+000050a0: 6967 6874 275d 2c20 272a 6b27 290a 2020  ight'], '*k').  
+000050b0: 2020 2020 2020 6178 312e 706c 6f74 2864        ax1.plot(d
+000050c0: 665b 2770 6f73 275d 2c20 6466 5b27 6865  f['pos'], df['he
+000050d0: 6967 6874 275d 2c20 272a 6b27 2c20 6c61  ight'], '*k', la
+000050e0: 6265 6c3d 2741 6c6c 2053 6369 7079 2050  bel='All Scipy P
+000050f0: 6561 6b73 2729 0a20 2020 2020 2020 2061  eaks').        a
+00005100: 7832 2e70 6c6f 7428 6466 5b27 706f 7327  x2.plot(df['pos'
+00005110: 5d2c 2064 665b 2768 6569 6768 7427 5d2c  ], df['height'],
+00005120: 2027 2a6b 2729 0a20 2020 2020 2020 2069   '*k').        i
+00005130: 6620 6d61 6e75 616c 5f64 6961 6431 2069  f manual_diad1 i
+00005140: 7320 5472 7565 3a0a 2020 2020 2020 2020  s True:.        
+00005150: 2020 2020 6178 312e 706c 6f74 2864 6961      ax1.plot(dia
+00005160: 6431 5f70 6f73 5b30 5d2c 2064 6961 6431  d1_pos[0], diad1
+00005170: 5f68 6569 6768 742c 2027 646b 272c 206d  _height, 'dk', m
+00005180: 6663 3d27 7965 6c6c 6f77 272c 206d 733d  fc='yellow', ms=
+00005190: 372c 206c 6162 656c 3d27 5363 6950 794d  7, label='SciPyM
+000051a0: 6973 7365 6427 290a 0a20 2020 2020 2020  issed')..       
+000051b0: 2069 6620 6d61 6e75 616c 5f64 6961 6432   if manual_diad2
+000051c0: 2069 7320 5472 7565 3a0a 2020 2020 2020   is True:.      
+000051d0: 2020 2020 2020 6178 312e 706c 6f74 2864        ax1.plot(d
+000051e0: 6961 6432 5f70 6f73 5b30 5d2c 2064 6961  iad2_pos[0], dia
+000051f0: 6432 5f68 6569 6768 742c 2027 646b 272c  d2_height, 'dk',
+00005200: 206d 6663 3d27 7965 6c6c 6f77 272c 206d   mfc='yellow', m
+00005210: 733d 3729 0a20 2020 2020 2020 2023 6178  s=7).        #ax
+00005220: 302e 6c65 6765 6e64 2829 0a20 2020 2020  0.legend().     
+00005230: 2020 2061 7831 2e73 6574 5f74 6974 6c65     ax1.set_title
+00005240: 2827 4469 6164 3127 290a 2020 2020 2020  ('Diad1').      
+00005250: 2020 6178 312e 706c 6f74 2844 6961 645b    ax1.plot(Diad[
+00005260: 3a2c 2030 5d2c 4469 6164 5b3a 2c20 315d  :, 0],Diad[:, 1]
+00005270: 2c20 272d 7227 290a 2020 2020 2020 2020  , '-r').        
+00005280: 6178 312e 7365 745f 786c 696d 285b 636f  ax1.set_xlim([co
+00005290: 6e66 6967 2e44 6961 6431 5f77 696e 646f  nfig.Diad1_windo
+000052a0: 775b 305d 2c20 636f 6e66 6967 2e44 6961  w[0], config.Dia
+000052b0: 6431 5f77 696e 646f 775b 315d 5d29 0a20  d1_window[1]]). 
+000052c0: 2020 2020 2020 2061 7832 2e73 6574 5f74         ax2.set_t
+000052d0: 6974 6c65 2827 4469 6164 3227 290a 2020  itle('Diad2').  
+000052e0: 2020 2020 2020 6178 322e 706c 6f74 2844        ax2.plot(D
+000052f0: 6961 645b 3a2c 2030 5d2c 4469 6164 5b3a  iad[:, 0],Diad[:
+00005300: 2c20 315d 2c20 272d 7227 290a 2020 2020  , 1], '-r').    
+00005310: 2020 2020 6178 322e 7365 745f 786c 696d      ax2.set_xlim
+00005320: 285b 636f 6e66 6967 2e44 6961 6432 5f77  ([config.Diad2_w
+00005330: 696e 646f 775b 305d 2c20 636f 6e66 6967  indow[0], config
+00005340: 2e44 6961 6432 5f77 696e 646f 775b 315d  .Diad2_window[1]
+00005350: 5d29 0a20 2020 2020 2020 2023 6178 302e  ]).        #ax0.
+00005360: 7365 745f 796c 696d 5b6e 702e 6e61 6e6d  set_ylim[np.nanm
+00005370: 696e 2844 6961 645b 3a2c 2031 5d29 2c20  in(Diad[:, 1]), 
+00005380: 6e70 2e6e 616e 6d61 7828 4469 6164 5b3a  np.nanmax(Diad[:
+00005390: 2c20 315d 2920 5d29 0a20 2020 2020 2020  , 1]) ]).       
+000053a0: 2066 6967 2e74 6967 6874 5f6c 6179 6f75   fig.tight_layou
+000053b0: 7428 290a 2020 2020 2020 2020 6178 322e  t().        ax2.
+000053c0: 706c 6f74 2864 665f 736f 7274 5f64 6961  plot(df_sort_dia
+000053d0: 6432 5f74 7269 6d5b 2770 6f73 275d 2c20  d2_trim['pos'], 
+000053e0: 6466 5f73 6f72 745f 6469 6164 325f 7472  df_sort_diad2_tr
+000053f0: 696d 5b27 6865 6967 6874 275d 2c20 272a  im['height'], '*
+00005400: 6b27 2c20 6d66 633d 2779 656c 6c6f 7727  k', mfc='yellow'
+00005410: 2c20 6d73 3d31 3029 0a20 2020 2020 2020  , ms=10).       
+00005420: 2061 7831 2e70 6c6f 7428 6466 5f73 6f72   ax1.plot(df_sor
+00005430: 745f 6469 6164 315f 7472 696d 5b27 706f  t_diad1_trim['po
+00005440: 7327 5d2c 2064 665f 736f 7274 5f64 6961  s'], df_sort_dia
+00005450: 6431 5f74 7269 6d5b 2768 6569 6768 7427  d1_trim['height'
+00005460: 5d2c 2027 2a6b 272c 2020 6d66 633d 2779  ], '*k',  mfc='y
+00005470: 656c 6c6f 7727 2c20 6d73 3d31 302c 206c  ellow', ms=10, l
+00005480: 6162 656c 3d27 5365 6c65 6374 6564 2050  abel='Selected P
+00005490: 6b73 2729 0a20 2020 2020 2020 2061 7831  ks').        ax1
+000054a0: 2e6c 6567 656e 6428 290a 2020 2020 2020  .legend().      
+000054b0: 2020 6178 302e 7365 745f 786c 6162 656c    ax0.set_xlabel
+000054c0: 2827 5761 7665 6e75 6d62 6572 2729 0a20  ('Wavenumber'). 
+000054d0: 2020 2020 2020 2061 7830 2e73 6574 5f79         ax0.set_y
+000054e0: 6c61 6265 6c28 2749 6e74 656e 7369 7479  label('Intensity
+000054f0: 2729 0a20 2020 2020 2020 2061 7831 2e73  ').        ax1.s
+00005500: 6574 5f78 6c61 6265 6c28 2757 6176 656e  et_xlabel('Waven
+00005510: 756d 6265 7227 290a 2020 2020 2020 2020  umber').        
+00005520: 6178 312e 7365 745f 796c 6162 656c 2827  ax1.set_ylabel('
+00005530: 496e 7465 6e73 6974 7927 290a 2020 2020  Intensity').    
+00005540: 2020 2020 6178 322e 7365 745f 786c 6162      ax2.set_xlab
+00005550: 656c 2827 5761 7665 6e75 6d62 6572 2729  el('Wavenumber')
+00005560: 0a20 2020 2020 2020 2061 7832 2e73 6574  .        ax2.set
+00005570: 5f79 6c61 6265 6c28 2749 6e74 656e 7369  _ylabel('Intensi
+00005580: 7479 2729 0a0a 2020 2020 2020 2020 666f  ty')..        fo
+00005590: 7220 6920 696e 2072 616e 6765 2830 2c20  r i in range(0, 
+000055a0: 6c65 6e28 6466 5f73 6f72 745f 6469 6164  len(df_sort_diad
+000055b0: 315f 7472 696d 2929 3a0a 2020 2020 2020  1_trim)):.      
+000055c0: 2020 2020 2020 6178 312e 616e 6e6f 7461        ax1.annota
+000055d0: 7465 2873 7472 286e 702e 726f 756e 6428  te(str(np.round(
+000055e0: 6466 5f73 6f72 745f 6469 6164 315f 7472  df_sort_diad1_tr
+000055f0: 696d 5b27 706f 7327 5d2e 696c 6f63 5b69  im['pos'].iloc[i
+00005600: 5d2c 2031 2929 2c20 7879 3d28 6466 5f73  ], 1)), xy=(df_s
+00005610: 6f72 745f 6469 6164 315f 7472 696d 5b27  ort_diad1_trim['
+00005620: 706f 7327 5d2e 696c 6f63 5b69 5d2d 3130  pos'].iloc[i]-10
+00005630: 2c0a 2020 2020 2020 2020 2020 2020 6466  ,.            df
+00005640: 5f73 6f72 745f 6469 6164 315f 7472 696d  _sort_diad1_trim
+00005650: 5b27 6865 6967 6874 275d 2e69 6c6f 635b  ['height'].iloc[
+00005660: 695d 2d31 2f37 2a28 6466 5f73 6f72 745f  i]-1/7*(df_sort_
+00005670: 6469 6164 315f 7472 696d 5b27 6865 6967  diad1_trim['heig
+00005680: 6874 275d 2e69 6c6f 635b 695d 2d37 3030  ht'].iloc[i]-700
+00005690: 2929 2c20 7879 636f 6f72 6473 3d22 6461  )), xycoords="da
+000056a0: 7461 222c 2066 6f6e 7473 697a 653d 3130  ta", fontsize=10
+000056b0: 2c20 726f 7461 7469 6f6e 3d39 3029 0a0a  , rotation=90)..
+000056c0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+000056d0: 2072 616e 6765 2830 2c20 6c65 6e28 6466   range(0, len(df
+000056e0: 5f73 6f72 745f 6469 6164 325f 7472 696d  _sort_diad2_trim
+000056f0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00005700: 6178 322e 616e 6e6f 7461 7465 2873 7472  ax2.annotate(str
+00005710: 286e 702e 726f 756e 6428 6466 5f73 6f72  (np.round(df_sor
+00005720: 745f 6469 6164 325f 7472 696d 5b27 706f  t_diad2_trim['po
+00005730: 7327 5d2e 696c 6f63 5b69 5d2c 2031 2929  s'].iloc[i], 1))
+00005740: 2c20 7879 3d28 6466 5f73 6f72 745f 6469  , xy=(df_sort_di
+00005750: 6164 325f 7472 696d 5b27 706f 7327 5d2e  ad2_trim['pos'].
+00005760: 696c 6f63 5b69 5d2d 3130 2c0a 2020 2020  iloc[i]-10,.    
+00005770: 2020 2020 2020 2020 6466 5f73 6f72 745f          df_sort_
+00005780: 6469 6164 325f 7472 696d 5b27 6865 6967  diad2_trim['heig
+00005790: 6874 275d 2e69 6c6f 635b 695d 2d31 2f37  ht'].iloc[i]-1/7
+000057a0: 2a28 6466 5f73 6f72 745f 6469 6164 325f  *(df_sort_diad2_
+000057b0: 7472 696d 5b27 6865 6967 6874 275d 2e69  trim['height'].i
+000057c0: 6c6f 635b 695d 2d37 3030 2929 2c20 7879  loc[i]-700)), xy
+000057d0: 636f 6f72 6473 3d22 6461 7461 222c 2066  coords="data", f
+000057e0: 6f6e 7473 697a 653d 3130 2c20 726f 7461  ontsize=10, rota
+000057f0: 7469 6f6e 3d39 3029 0a0a 0a20 2020 2072  tion=90)...    r
+00005800: 6574 7572 6e20 6466 5f6f 7574 2c20 4469  eturn df_out, Di
+00005810: 6164 2c20 6669 6720 6966 2027 6669 6727  ad, fig if 'fig'
+00005820: 2069 6e20 6c6f 6361 6c73 2829 2065 6c73   in locals() els
+00005830: 6520 4e6f 6e65 0a0a 0a0a 0a0a 0a0a 0a0a  e None..........
+00005840: 6465 6620 6c6f 6f70 5f61 7070 726f 785f  def loop_approx_
+00005850: 6469 6164 5f66 6974 7328 2a2c 2073 7065  diad_fits(*, spe
+00005860: 6374 7261 5f70 6174 682c 2063 6f6e 6669  ctra_path, confi
+00005870: 672c 2044 6961 645f 4669 6c65 732c 2066  g, Diad_Files, f
+00005880: 696c 6574 7970 652c 2070 6c6f 745f 6669  iletype, plot_fi
+00005890: 6775 7265 293a 0a20 2020 2022 2222 2055  gure):.    """ U
+000058a0: 7365 7320 7468 6520 6964 656e 7469 6679  ses the identify
+000058b0: 5f64 6961 645f 7065 616b 7320 6675 6e63  _diad_peaks func
+000058c0: 7469 6f6e 2074 6f20 6c6f 6f70 206f 7665  tion to loop ove
+000058d0: 7220 616c 6c20 6669 6c65 732e 0a20 2020  r all files..   
+000058e0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+000058f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00005900: 0a20 2020 2063 6f6e 6669 673a 2064 6174  .    config: dat
+00005910: 6163 6c61 7373 0a20 2020 2020 2020 2053  aclass.        S
+00005920: 6565 2064 6f63 756d 656e 7461 7469 6f6e  ee documentation
+00005930: 2066 6f72 2069 6465 6e74 6966 795f 6469   for identify_di
+00005940: 6164 5f70 6561 6b73 0a0a 2020 2020 7370  ad_peaks..    sp
+00005950: 6563 7472 615f 7061 7468 3a20 7374 720a  ectra_path: str.
+00005960: 2020 2020 2020 2020 5061 7468 2077 6865          Path whe
+00005970: 7265 2073 7065 6374 7261 2069 7320 7374  re spectra is st
+00005980: 6f72 6564 0a0a 2020 2020 4469 6164 5f46  ored..    Diad_F
+00005990: 696c 6573 3a20 6c69 7374 0a20 2020 2020  iles: list.     
+000059a0: 2020 204c 6973 7420 6f66 2066 696c 6520     List of file 
+000059b0: 6e61 6d65 7320 746f 206c 6f6f 7020 6f76  names to loop ov
+000059c0: 6572 0a0a 2020 2020 6669 6c65 7479 7065  er..    filetype
+000059d0: 3a20 7374 720a 2020 2020 2020 2020 6368  : str.        ch
+000059e0: 6f6f 7365 2066 726f 6d20 2757 6974 6563  oose from 'Witec
+000059f0: 5f41 5343 4949 272c 2027 6865 6164 6c65  _ASCII', 'headle
+00005a00: 7373 5f74 7874 272c 2027 6865 6164 6c65  ss_txt', 'headle
+00005a10: 7373 5f63 7376 272c 2027 6865 6164 5f63  ss_csv', 'head_c
+00005a20: 7376 272c 2027 5769 7465 635f 4153 4349  sv', 'Witec_ASCI
+00005a30: 4927 2c0a 2020 2020 2020 2020 2748 4f52  I',.        'HOR
+00005a40: 4942 415f 7478 7427 2c20 2752 656e 6973  IBA_txt', 'Renis
+00005a50: 6861 775f 7478 7427 0a0a 2020 2020 706c  haw_txt'..    pl
+00005a60: 6f74 5f66 6967 7572 653a 2062 6f6f 6c0a  ot_figure: bool.
+00005a70: 2020 2020 2020 2020 6966 2054 7275 652c          if True,
+00005a80: 2070 6c6f 7473 2061 2066 6967 7572 6520   plots a figure 
+00005a90: 6f66 2070 6561 6b73 2c20 616e 6420 7468  of peaks, and th
+00005aa0: 6520 6964 656e 7469 6669 6564 2070 6561  e identified pea
+00005ab0: 6b73 2074 6861 7420 5363 6970 7920 666f  ks that Scipy fo
+00005ac0: 756e 640a 0a20 2020 2052 6574 7572 6e73  und..    Returns
+00005ad0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d  .    -----------
+00005ae0: 0a20 2020 2070 642e 4461 7461 4672 616d  .    pd.DataFram
+00005af0: 6520 6f66 2074 6865 2061 7070 726f 7869  e of the approxi
+00005b00: 6d61 7465 2070 6561 6b20 7061 7261 6d65  mate peak parame
+00005b10: 7465 7273 2066 6f72 2065 6163 6820 6669  ters for each fi
+00005b20: 6c65 2e0a 0a20 2020 206e 702e 6172 7261  le...    np.arra
+00005b30: 7920 6f66 2079 2063 6f6f 7264 696e 6174  y of y coordinat
+00005b40: 6573 206f 6620 6576 6572 7920 7370 6563  es of every spec
+00005b50: 7472 612e 0a0a 0a20 2020 2022 2222 0a0a  tra....    """..
+00005b60: 2020 2020 2320 446f 2066 6974 2066 6f72      # Do fit for
+00005b70: 2066 6972 7374 2066 696c 6520 746f 2067   first file to g
+00005b80: 6574 206c 656e 6774 680a 2020 2020 6466  et length.    df
+00005b90: 5f70 6561 6b73 2c20 4469 6164 2c20 6669  _peaks, Diad, fi
+00005ba0: 673d 6964 656e 7469 6679 5f64 6961 645f  g=identify_diad_
+00005bb0: 7065 616b 7328 0a20 2020 2063 6f6e 6669  peaks(.    confi
+00005bc0: 673d 636f 6e66 6967 2c20 7061 7468 3d73  g=config, path=s
+00005bd0: 7065 6374 7261 5f70 6174 682c 2066 696c  pectra_path, fil
+00005be0: 656e 616d 653d 4469 6164 5f46 696c 6573  ename=Diad_Files
+00005bf0: 5b30 5d2c 0a20 2020 2066 696c 6574 7970  [0],.    filetyp
+00005c00: 653d 6669 6c65 7479 7065 2c20 706c 6f74  e=filetype, plot
+00005c10: 5f66 6967 7572 653d 706c 6f74 5f66 6967  _figure=plot_fig
+00005c20: 7572 6529 0a0a 2020 2020 2320 4e6f 7720  ure)..    # Now 
+00005c30: 646f 2066 6f72 2061 6c6c 2066 696c 6573  do for all files
+00005c40: 0a20 2020 2066 6974 5f70 6172 616d 7320  .    fit_params 
+00005c50: 3d20 7064 2e44 6174 6146 7261 6d65 285b  = pd.DataFrame([
+00005c60: 5d29 0a20 2020 2078 5f63 6f72 643d 4469  ]).    x_cord=Di
+00005c70: 6164 5b3a 2c20 305d 0a20 2020 2064 6174  ad[:, 0].    dat
+00005c80: 615f 795f 616c 6c3d 6e70 2e7a 6572 6f73  a_y_all=np.zeros
+00005c90: 285b 2020 6c65 6e28 785f 636f 7264 292c  ([  len(x_cord),
+00005ca0: 206c 656e 2844 6961 645f 4669 6c65 7329   len(Diad_Files)
+00005cb0: 5d2c 2066 6c6f 6174 290a 2020 2020 6461  ], float).    da
+00005cc0: 7461 5f78 5f61 6c6c 3d6e 702e 7a65 726f  ta_x_all=np.zero
+00005cd0: 7328 5b20 206c 656e 2878 5f63 6f72 6429  s([  len(x_cord)
+00005ce0: 2c20 6c65 6e28 4469 6164 5f46 696c 6573  , len(Diad_Files
+00005cf0: 295d 2c20 666c 6f61 7429 0a20 2020 2069  )], float).    i
+00005d00: 3d30 0a20 2020 2066 6f72 2066 696c 6520  =0.    for file 
+00005d10: 696e 2074 7164 6d28 4469 6164 5f46 696c  in tqdm(Diad_Fil
+00005d20: 6573 293a 0a0a 0a20 2020 2020 2020 2064  es):...        d
+00005d30: 665f 7065 616b 732c 2044 6961 642c 2066  f_peaks, Diad, f
+00005d40: 6967 3d69 6465 6e74 6966 795f 6469 6164  ig=identify_diad
+00005d50: 5f70 6561 6b73 280a 2020 2020 2020 2020  _peaks(.        
+00005d60: 636f 6e66 6967 3d63 6f6e 6669 672c 2070  config=config, p
+00005d70: 6174 683d 7370 6563 7472 615f 7061 7468  ath=spectra_path
+00005d80: 2c20 6669 6c65 6e61 6d65 3d66 696c 652c  , filename=file,
+00005d90: 0a20 2020 2066 696c 6574 7970 653d 6669  .    filetype=fi
+00005da0: 6c65 7479 7065 2c20 706c 6f74 5f66 6967  letype, plot_fig
+00005db0: 7572 653d 706c 6f74 5f66 6967 7572 6529  ure=plot_figure)
+00005dc0: 0a0a 2020 2020 2020 2020 6461 7461 5f79  ..        data_y
+00005dd0: 5f61 6c6c 5b3a 2c20 695d 3d44 6961 645b  _all[:, i]=Diad[
+00005de0: 3a2c 2031 5d0a 2020 2020 2020 2020 6461  :, 1].        da
+00005df0: 7461 5f78 5f61 6c6c 5b3a 2c20 695d 3d44  ta_x_all[:, i]=D
+00005e00: 6961 645b 3a2c 2030 5d0a 2020 2020 2020  iad[:, 0].      
+00005e10: 2020 2364 6174 6120 3d20 7064 2e63 6f6e    #data = pd.con
+00005e20: 6361 7428 5b44 6961 642c 2064 6174 615d  cat([Diad, data]
+00005e30: 2c20 6178 6973 3d30 290a 2020 2020 2020  , axis=0).      
+00005e40: 2020 6669 745f 7061 7261 6d73 203d 2070    fit_params = p
+00005e50: 642e 636f 6e63 6174 285b 6669 745f 7061  d.concat([fit_pa
+00005e60: 7261 6d73 2c20 6466 5f70 6561 6b73 5d2c  rams, df_peaks],
+00005e70: 2061 7869 733d 3029 0a20 2020 2020 2020   axis=0).       
+00005e80: 2069 3d69 2b31 0a0a 2020 2020 6669 745f   i=i+1..    fit_
+00005e90: 7061 7261 6d73 3d66 6974 5f70 6172 616d  params=fit_param
+00005ea0: 732e 7265 7365 745f 696e 6465 7828 6472  s.reset_index(dr
+00005eb0: 6f70 3d54 7275 6529 0a20 2020 2023 204c  op=True).    # L
+00005ec0: 6574 7320 6368 6563 6b20 616c 6c20 6461  ets check all da
+00005ed0: 7461 2078 2061 7265 2074 6865 2073 616d  ta x are the sam
+00005ee0: 652e 0a20 2020 2061 3d64 6174 615f 785f  e..    a=data_x_
+00005ef0: 616c 6c0a 2020 2020 7361 6d65 203d 206e  all.    same = n
+00005f00: 702e 616c 6c28 615b 302c 203a 5d20 3d3d  p.all(a[0, :] ==
+00005f10: 2061 5b30 2c20 305d 290a 0a20 2020 2069   a[0, 0])..    i
+00005f20: 6620 7361 6d65 3d3d 5472 7565 3a0a 0a20  f same==True:.. 
+00005f30: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
+00005f40: 745f 7061 7261 6d73 2c20 6461 7461 5f79  t_params, data_y
+00005f50: 5f61 6c6c 0a20 2020 2069 6620 7361 6d65  _all.    if same
+00005f60: 3d3d 4661 6c73 653a 0a20 2020 2020 2020  ==False:.       
+00005f70: 2070 7269 6e74 2827 596f 7520 646f 206e   print('You do n
+00005f80: 6f74 2068 6176 6520 7468 6520 7361 6d65  ot have the same
+00005f90: 2078 2061 7869 7320 666f 7220 616c 6c20   x axis for all 
+00005fa0: 7370 6563 7472 612e 2027 290a 2020 2020  spectra. ').    
+00005fb0: 2020 2020 6469 6666 5f76 616c 5f72 6f77      diff_val_row
+00005fc0: 203d 206e 702e 7768 6572 6528 6e70 2e61   = np.where(np.a
+00005fd0: 6e79 2861 2021 3d20 615b 305d 2c20 6178  ny(a != a[0], ax
+00005fe0: 6973 3d31 2929 5b30 5d0a 2020 2020 2020  is=1))[0].      
+00005ff0: 2020 7072 696e 7428 6469 6666 5f76 616c    print(diff_val
+00006000: 5f72 6f77 290a 0a0a 2020 2020 2020 2020  _row)...        
+00006010: 7265 7475 726e 2066 6974 5f70 6172 616d  return fit_param
+00006020: 732c 2064 6174 615f 795f 616c 6c0a 0a0a  s, data_y_all...
+00006030: 0a64 6566 2070 6c6f 745f 7065 616b 5f70  .def plot_peak_p
+00006040: 6172 616d 7328 6669 745f 7061 7261 6d73  arams(fit_params
+00006050: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006060: 2020 2020 2020 2078 5f70 6172 616d 3d27         x_param='
+00006070: 4469 6164 315f 706f 7327 2c20 2079 315f  Diad1_pos',  y1_
+00006080: 7061 7261 6d3d 2761 7070 726f 785f 7370  param='approx_sp
+00006090: 6c69 7427 2c0a 2020 2020 2020 2020 2020  lit',.          
+000060a0: 2020 2020 2020 2020 2020 7932 5f70 6172            y2_par
+000060b0: 616d 3d27 4d65 616e 5f56 616c 6c65 795f  am='Mean_Valley_
+000060c0: 7072 6f6d 272c 2079 335f 7061 7261 6d3d  prom', y3_param=
+000060d0: 2743 3133 5f61 6273 5f70 726f 6d27 2c0a  'C13_abs_prom',.
+000060e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000060f0: 2020 2020 7934 5f70 6172 616d 3d27 4842      y4_param='HB
+00006100: 325f 6162 735f 7072 6f6d 272c 2066 696c  2_abs_prom', fil
+00006110: 6c5f 6e61 3d30 293a 0a0a 2020 2020 2222  l_na=0):..    ""
+00006120: 2220 4d61 6b65 7320 6120 3258 3220 6669  " Makes a 2X2 fi
+00006130: 6775 7265 206f 6620 6669 7420 7061 7261  gure of fit para
+00006140: 6d65 7465 7273 2c20 7769 7468 2074 6865  meters, with the
+00006150: 2073 616d 6520 7820 6178 6973 2c20 616e   same x axis, an
+00006160: 6420 3420 6469 6666 6572 656e 7420 7920  d 4 different y 
+00006170: 6178 6973 0a0a 2020 2020 5061 7261 6d65  axis..    Parame
+00006180: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+00006190: 2d2d 2d2d 0a0a 2020 2020 6669 745f 7061  ----..    fit_pa
+000061a0: 7261 6d73 3a20 5061 6e64 6173 2044 6174  rams: Pandas Dat
+000061b0: 6146 7261 6d65 0a20 2020 2020 2020 2064  aFrame.        d
+000061c0: 6174 6166 7261 6d65 206f 6620 6170 7072  ataframe of appr
+000061d0: 6f78 696d 6174 6520 6669 7420 7061 7261  oximate fit para
+000061e0: 6d73 2066 726f 6d20 6675 6e63 7469 6f6e  ms from function
+000061f0: 206c 6f6f 705f 6170 7072 6f78 5f64 6961   loop_approx_dia
+00006200: 645f 6669 7473 0a20 2020 2078 5f70 6172  d_fits.    x_par
+00006210: 616d 3a20 7374 720a 2020 2020 2020 2020  am: str.        
+00006220: 7061 7261 6d65 7465 7220 796f 7520 7761  parameter you wa
+00006230: 6e74 206f 6e20 7468 6520 7820 6178 6973  nt on the x axis
+00006240: 206f 6620 616c 6c20 706c 6f74 730a 2020   of all plots.  
+00006250: 2020 7931 5f70 6172 616d 3a20 7374 720a    y1_param: str.
+00006260: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
+00006270: 7220 6f6e 2079 2061 7869 7320 6f66 2031  r on y axis of 1
+00006280: 7374 2073 7562 706c 6f74 2028 746f 7020  st subplot (top 
+00006290: 6c65 6674 290a 2020 2020 7932 5f70 6172  left).    y2_par
+000062a0: 616d 3a20 7374 720a 2020 2020 2020 2020  am: str.        
+000062b0: 7061 7261 6d65 7465 7220 6f6e 2079 2061  parameter on y a
+000062c0: 7869 7320 6f66 2032 6e64 2073 7562 706c  xis of 2nd subpl
+000062d0: 6f74 2028 746f 7020 7269 6768 7429 0a20  ot (top right). 
+000062e0: 2020 2079 335f 7061 7261 6d3a 2073 7472     y3_param: str
+000062f0: 0a20 2020 2020 2020 2070 6172 616d 6574  .        paramet
+00006300: 6572 206f 6e20 7920 6178 6973 206f 6620  er on y axis of 
+00006310: 3372 6420 7375 6270 6c6f 7420 2862 6f74  3rd subplot (bot
+00006320: 746f 6d20 6c65 6674 290a 2020 2020 7934  tom left).    y4
+00006330: 5f70 6172 616d 3a20 7374 720a 2020 2020  _param: str.    
+00006340: 2020 2020 7061 7261 6d65 7465 7220 6f6e      parameter on
+00006350: 2079 2061 7869 7320 6f66 2034 7468 2073   y axis of 4th s
+00006360: 7562 706c 6f74 2028 626f 7474 6f6d 2072  ubplot (bottom r
+00006370: 6967 6874 290a 2020 2020 6669 6c6c 5f6e  ight).    fill_n
+00006380: 613a 2069 6e74 0a20 2020 2020 2020 2054  a: int.        T
+00006390: 6865 2069 6e74 6567 6572 2076 616c 7565  he integer value
+000063a0: 2074 6f20 6669 6c6c 204e 616e 7320 7769   to fill Nans wi
+000063b0: 7468 2074 6f20 7368 6f77 2075 7020 6f6e  th to show up on
+000063c0: 2070 6c6f 7473 2e0a 0a20 2020 2052 6574   plots...    Ret
+000063d0: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
+000063e0: 2d2d 2d0a 2020 2020 3420 7061 7274 2066  ---.    4 part f
+000063f0: 6967 7572 650a 0a20 2020 2022 2222 0a20  igure..    """. 
+00006400: 2020 2066 6974 5f70 6172 616d 735f 6e6f     fit_params_no
+00006410: 6e61 3d66 6974 5f70 6172 616d 732e 6669  na=fit_params.fi
+00006420: 6c6c 6e61 2866 696c 6c5f 6e61 290a 0a20  llna(fill_na).. 
+00006430: 2020 2066 6967 2c20 2828 6178 312c 2061     fig, ((ax1, a
+00006440: 7832 292c 2028 6178 332c 2061 7834 2929  x2), (ax3, ax4))
+00006450: 203d 2070 6c74 2e73 7562 706c 6f74 7328   = plt.subplots(
+00006460: 322c 2032 2c20 6669 6773 697a 653d 2831  2, 2, figsize=(1
+00006470: 302a 302e 382c 382a 302e 3829 290a 0a0a  0*0.8,8*0.8))...
+00006480: 2020 2020 6178 312e 706c 6f74 2866 6974      ax1.plot(fit
+00006490: 5f70 6172 616d 735f 6e6f 6e61 5b78 5f70  _params_nona[x_p
+000064a0: 6172 616d 5d2c 2066 6974 5f70 6172 616d  aram], fit_param
+000064b0: 735f 6e6f 6e61 5b79 315f 7061 7261 6d5d  s_nona[y1_param]
+000064c0: 2c0a 2020 2020 2020 2020 2778 7227 290a  ,.        'xr').
+000064d0: 2020 2020 6178 312e 7365 745f 786c 6162      ax1.set_xlab
+000064e0: 656c 2878 5f70 6172 616d 290a 2020 2020  el(x_param).    
+000064f0: 6178 312e 7365 745f 796c 6162 656c 2879  ax1.set_ylabel(y
+00006500: 315f 7061 7261 6d29 0a0a 2020 2020 6178  1_param)..    ax
+00006510: 322e 706c 6f74 2866 6974 5f70 6172 616d  2.plot(fit_param
+00006520: 735f 6e6f 6e61 5b78 5f70 6172 616d 5d2c  s_nona[x_param],
+00006530: 2066 6974 5f70 6172 616d 735f 6e6f 6e61   fit_params_nona
+00006540: 5b79 325f 7061 7261 6d5d 2c0a 2020 2020  [y2_param],.    
+00006550: 2020 2020 2778 7227 290a 2020 2020 6178      'xr').    ax
+00006560: 322e 7365 745f 786c 6162 656c 2878 5f70  2.set_xlabel(x_p
+00006570: 6172 616d 290a 2020 2020 6178 322e 7365  aram).    ax2.se
+00006580: 745f 796c 6162 656c 2879 325f 7061 7261  t_ylabel(y2_para
+00006590: 6d29 0a20 2020 2066 6967 2e74 6967 6874  m).    fig.tight
+000065a0: 5f6c 6179 6f75 7428 290a 0a20 2020 2061  _layout()..    a
+000065b0: 7833 2e70 6c6f 7428 6669 745f 7061 7261  x3.plot(fit_para
+000065c0: 6d73 5f6e 6f6e 615b 785f 7061 7261 6d5d  ms_nona[x_param]
+000065d0: 2c20 6669 745f 7061 7261 6d73 5f6e 6f6e  , fit_params_non
+000065e0: 615b 7933 5f70 6172 616d 5d2c 0a20 2020  a[y3_param],.   
+000065f0: 2020 2020 2027 7872 2729 0a20 2020 2061       'xr').    a
+00006600: 7833 2e73 6574 5f78 6c61 6265 6c28 785f  x3.set_xlabel(x_
+00006610: 7061 7261 6d29 0a20 2020 2061 7833 2e73  param).    ax3.s
+00006620: 6574 5f79 6c61 6265 6c28 7933 5f70 6172  et_ylabel(y3_par
+00006630: 616d 290a 0a20 2020 2061 7834 2e70 6c6f  am)..    ax4.plo
+00006640: 7428 6669 745f 7061 7261 6d73 5f6e 6f6e  t(fit_params_non
+00006650: 615b 785f 7061 7261 6d5d 2c20 6669 745f  a[x_param], fit_
+00006660: 7061 7261 6d73 5f6e 6f6e 615b 7934 5f70  params_nona[y4_p
+00006670: 6172 616d 5d2c 0a20 2020 2020 2020 2027  aram],.        '
+00006680: 7872 2729 0a20 2020 2061 7834 2e73 6574  xr').    ax4.set
+00006690: 5f78 6c61 6265 6c28 785f 7061 7261 6d29  _xlabel(x_param)
+000066a0: 0a20 2020 2061 7834 2e73 6574 5f79 6c61  .    ax4.set_yla
+000066b0: 6265 6c28 7934 5f70 6172 616d 290a 2020  bel(y4_param).  
+000066c0: 2020 6669 672e 7469 6768 745f 6c61 796f    fig.tight_layo
+000066d0: 7574 2829 0a0a 2020 2020 7265 7475 726e  ut()..    return
+000066e0: 2066 6967 0a0a 0a64 6566 2066 696c 7465   fig...def filte
+000066f0: 725f 7370 6c69 7474 696e 675f 7072 6f6d  r_splitting_prom
+00006700: 696e 656e 6365 282a 2c20 6669 745f 7061  inence(*, fit_pa
+00006710: 7261 6d73 2c20 6461 7461 5f79 5f61 6c6c  rams, data_y_all
+00006720: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006740: 2020 785f 636f 7264 2c0a 2020 2020 2020    x_cord,.      
+00006750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006760: 2020 2020 2020 2020 2020 7370 6c69 7474            splitt
+00006770: 696e 675f 6c69 6d69 7473 3d5b 3130 302c  ing_limits=[100,
+00006780: 2031 3037 5d2c 0a20 2020 2020 2020 2020   107],.         
+00006790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000067a0: 2020 2020 2020 206c 6f77 6572 5f64 6961         lower_dia
+000067b0: 6431 5f70 726f 6d3d 3130 2c20 6578 636c  d1_prom=10, excl
+000067c0: 7564 655f 7374 7229 3a0a 2020 2020 2222  ude_str):.    ""
+000067d0: 2220 4669 6c74 6572 7320 5370 6563 7472  " Filters Spectr
+000067e0: 6120 6261 7365 6420 6f6e 2061 7070 726f  a based on appro
+000067f0: 7869 6d61 7465 2073 706c 6974 7469 6e67  ximate splitting
+00006800: 2c20 6472 6177 7320 6120 706c 6f74 2073  , draws a plot s
+00006810: 686f 7769 6e67 2073 7065 6374 7261 2074  howing spectra t
+00006820: 6f20 6469 7363 6172 6420 616e 6420 7468  o discard and th
+00006830: 6f73 6520 746f 206b 6565 700a 0a20 2020  ose to keep..   
+00006840: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00006850: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
+00006860: 2020 2066 6974 5f70 6172 616d 733a 2070     fit_params: p
+00006870: 642e 6461 7461 6672 616d 650a 2020 2020  d.dataframe.    
+00006880: 2020 2020 6461 7461 6672 616d 6520 6f66      dataframe of
+00006890: 2066 6974 2070 6172 616d 6574 6572 7320   fit parameters 
+000068a0: 6672 6f6d 206c 6f6f 705f 6170 7072 6f78  from loop_approx
+000068b0: 5f64 6961 645f 6669 7473 0a0a 2020 2020  _diad_fits..    
+000068c0: 6461 7461 5f79 5f61 6c6c 3a20 6e70 2e61  data_y_all: np.a
+000068d0: 7272 6179 0a20 2020 2020 2020 2079 2063  rray.        y c
+000068e0: 6f6f 7264 696e 6174 6573 206f 6620 6561  oordinates of ea
+000068f0: 6368 2073 7065 6374 7261 2066 726f 6d20  ch spectra from 
+00006900: 6c6f 6f70 5f61 7070 726f 785f 6469 6164  loop_approx_diad
+00006910: 5f66 6974 732c 2075 7365 6420 666f 7220  _fits, used for 
+00006920: 706c 6f74 7469 6e67 2076 6973 7561 6c69  plotting visuali
+00006930: 7a61 746f 696e 730a 0a20 2020 2078 5f63  zatoins..    x_c
+00006940: 6f72 643a 206e 702e 6172 7261 790a 2020  ord: np.array.  
+00006950: 2020 2020 2020 7820 636f 6f72 6469 6e61        x coordina
+00006960: 7465 7320 6f66 2031 2073 7065 6374 7261  tes of 1 spectra
+00006970: 2e20 4173 7375 6d65 7320 616c 6c20 7820  . Assumes all x 
+00006980: 636f 6f72 6469 6e61 7465 7320 7468 6520  coordinates the 
+00006990: 7361 6d65 206c 656e 6774 680a 0a20 2020  same length..   
+000069a0: 2073 706c 6974 7469 6e67 5f6c 696d 6974   splitting_limit
+000069b0: 733a 206c 6973 7420 2865 2e67 2e20 5b31  s: list (e.g. [1
+000069c0: 3030 2c20 3130 375d 290a 2020 2020 2020  00, 107]).      
+000069d0: 2020 6f6e 6c79 206b 6565 7073 2073 7065    only keeps spe
+000069e0: 6374 7261 2077 6974 6820 7370 6c69 7474  ctra with splitt
+000069f0: 696e 6720 696e 2074 6869 7320 7261 6e67  ing in this rang
+00006a00: 650a 0a20 2020 206c 6f77 6572 5f64 6961  e..    lower_dia
+00006a10: 6431 5f70 726f 6d3a 2069 6e74 2c20 666c  d1_prom: int, fl
+00006a20: 6f61 740a 2020 2020 2020 2020 4f6e 6c79  oat.        Only
+00006a30: 206b 6565 7073 2073 7065 6374 7261 2074   keeps spectra t
+00006a40: 6861 7420 6d65 6574 2074 6865 2073 706c  hat meet the spl
+00006a50: 6974 7469 6e67 2070 6172 616d 6574 6572  itting parameter
+00006a60: 2c20 616e 6420 6861 7665 2061 6e20 6162  , and have an ab
+00006a70: 736f 6c75 7465 0a20 2020 2020 2020 2064  solute.        d
+00006a80: 6961 6431 2070 726f 6d69 6e65 6e63 6520  iad1 prominence 
+00006a90: 6772 6561 7465 7220 7468 616e 2074 6869  greater than thi
+00006aa0: 7320 7661 6c75 6520 2868 656c 7073 2066  s value (helps f
+00006ab0: 696c 7465 7220 6f75 7420 6f74 6865 7220  ilter out other 
+00006ac0: 7765 6972 6420 7370 6563 7472 6129 0a0a  weird spectra)..
+00006ad0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00006ae0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
+00006af0: 2020 2066 6974 5f70 6172 616d 735f 6669     fit_params_fi
+00006b00: 6c74 3a20 7064 2e44 6174 6146 7261 6d65  lt: pd.DataFrame
+00006b10: 0a20 2020 2020 2020 2064 6174 6166 7261  .        datafra
+00006b20: 6d65 206f 6620 6669 7420 7061 7261 6d65  me of fit parame
+00006b30: 7465 7273 2066 6f72 2073 7065 6374 7261  ters for spectra
+00006b40: 2074 6f20 6b65 6570 0a20 2020 2064 6174   to keep.    dat
+00006b50: 615f 795f 6669 6c74 3a20 6e70 2e61 7272  a_y_filt: np.arr
+00006b60: 6179 0a20 2020 2020 2020 2079 2063 6f6f  ay.        y coo
+00006b70: 7264 696e 6174 6573 206f 6620 7370 6563  rdinates of spec
+00006b80: 7472 6120 746f 206b 6565 700a 2020 2020  tra to keep.    
+00006b90: 6669 745f 7061 7261 6d73 5f64 6973 633a  fit_params_disc:
+00006ba0: 2070 642e 4461 7461 4672 616d 650a 2020   pd.DataFrame.  
+00006bb0: 2020 2020 2020 6461 7461 6672 616d 6520        dataframe 
+00006bc0: 6f66 2066 6974 2070 6172 616d 6574 6572  of fit parameter
+00006bd0: 7320 666f 7220 7370 6563 7472 6120 746f  s for spectra to
+00006be0: 2064 6973 6361 7264 0a20 2020 2064 6174   discard.    dat
+00006bf0: 615f 795f 6469 7363 3a20 6e70 2e61 7272  a_y_disc: np.arr
+00006c00: 6179 0a20 2020 2020 2020 2079 2063 6f6f  ay.        y coo
+00006c10: 7264 696e 6174 6573 206f 6620 7370 6563  rdinates of spec
+00006c20: 7472 6120 746f 2064 6973 6361 7264 0a0a  tra to discard..
+00006c30: 0a20 2020 2022 2222 0a0a 2020 2020 7265  .    """..    re
+00006c40: 6173 5f73 706c 6974 3d28 6669 745f 7061  as_split=(fit_pa
+00006c50: 7261 6d73 5b27 6170 7072 6f78 5f73 706c  rams['approx_spl
+00006c60: 6974 275d 2e62 6574 7765 656e 2873 706c  it'].between(spl
+00006c70: 6974 7469 6e67 5f6c 696d 6974 735b 305d  itting_limits[0]
+00006c80: 2c20 7370 6c69 7474 696e 675f 6c69 6d69  , splitting_limi
+00006c90: 7473 5b31 5d29 290a 2020 2020 7265 6173  ts[1])).    reas
+00006ca0: 5f68 6569 6768 3d66 6974 5f70 6172 616d  _heigh=fit_param
+00006cb0: 735b 2744 6961 6431 5f61 6273 5f70 726f  s['Diad1_abs_pro
+00006cc0: 6d27 5d3e 6c6f 7765 725f 6469 6164 315f  m']>lower_diad1_
+00006cd0: 7072 6f6d 0a20 2020 2069 6620 6578 636c  prom.    if excl
+00006ce0: 7564 655f 7374 7220 6973 206e 6f74 204e  ude_str is not N
+00006cf0: 6f6e 653a 0a20 2020 2020 2020 206e 616d  one:.        nam
+00006d00: 655f 696e 5f66 696c 653d 7e66 6974 5f70  e_in_file=~fit_p
+00006d10: 6172 616d 735b 2766 696c 656e 616d 6527  arams['filename'
+00006d20: 5d2e 7374 722e 636f 6e74 6169 6e73 2865  ].str.contains(e
+00006d30: 7863 6c75 6465 5f73 7472 290a 2020 2020  xclude_str).    
+00006d40: 656c 7365 3a0a 2020 2020 2020 2020 6e61  else:.        na
+00006d50: 6d65 5f69 6e5f 6669 6c65 3d72 6561 735f  me_in_file=reas_
+00006d60: 6865 6967 680a 0a20 2020 2066 6974 5f70  heigh..    fit_p
+00006d70: 6172 616d 735f 6669 6c74 3d66 6974 5f70  arams_filt=fit_p
+00006d80: 6172 616d 732e 6c6f 635b 2872 6561 735f  arams.loc[(reas_
+00006d90: 7370 6c69 7426 7265 6173 5f68 6569 6768  split&reas_heigh
+00006da0: 266e 616d 655f 696e 5f66 696c 6529 5d2e  &name_in_file)].
+00006db0: 7265 7365 745f 696e 6465 7828 6472 6f70  reset_index(drop
+00006dc0: 3d54 7275 6529 0a20 2020 2066 6974 5f70  =True).    fit_p
+00006dd0: 6172 616d 735f 6469 7363 3d66 6974 5f70  arams_disc=fit_p
+00006de0: 6172 616d 732e 6c6f 635b 7e28 7265 6173  arams.loc[~(reas
+00006df0: 5f73 706c 6974 2672 6561 735f 6865 6967  _split&reas_heig
+00006e00: 6826 6e61 6d65 5f69 6e5f 6669 6c65 295d  h&name_in_file)]
+00006e10: 2e72 6573 6574 5f69 6e64 6578 2864 726f  .reset_index(dro
+00006e20: 703d 5472 7565 290a 0a20 2020 2070 7269  p=True)..    pri
+00006e30: 6e74 2827 4b65 6570 696e 6720 4e3d 272b  nt('Keeping N='+
+00006e40: 7374 7228 6c65 6e28 6669 745f 7061 7261  str(len(fit_para
+00006e50: 6d73 5f66 696c 7429 2929 0a20 2020 2070  ms_filt))).    p
+00006e60: 7269 6e74 2827 4469 7363 6172 6469 6e67  rint('Discarding
+00006e70: 204e 3d27 2b73 7472 286c 656e 2866 6974   N='+str(len(fit
+00006e80: 5f70 6172 616d 735f 6469 7363 2929 290a  _params_disc))).
+00006e90: 0a20 2020 2066 696c 743d 7265 6173 5f73  .    filt=reas_s
+00006ea0: 706c 6974 2672 6561 735f 6865 6967 6826  plit&reas_heigh&
+00006eb0: 6e61 6d65 5f69 6e5f 6669 6c65 0a20 2020  name_in_file.   
+00006ec0: 2064 6174 615f 795f 6669 6c74 3d64 6174   data_y_filt=dat
+00006ed0: 615f 795f 616c 6c5b 3a2c 2028 6669 6c74  a_y_all[:, (filt
+00006ee0: 295d 0a20 2020 2064 6174 615f 795f 6469  )].    data_y_di
+00006ef0: 7363 3d64 6174 615f 795f 616c 6c5b 3a2c  sc=data_y_all[:,
+00006f00: 207e 2866 696c 7429 5d0a 0a20 2020 2069   ~(filt)]..    i
+00006f10: 6e74 633d 3830 300a 2020 2020 7072 6f6d  ntc=800.    prom
+00006f20: 5f66 696c 743d 300a 2020 2020 7072 6f6d  _filt=0.    prom
+00006f30: 5f64 6973 633d 300a 2020 2020 6669 672c  _disc=0.    fig,
+00006f40: 2028 6178 312c 2061 7832 2920 3d20 706c   (ax1, ax2) = pl
+00006f50: 742e 7375 6270 6c6f 7473 2831 2c20 322c  t.subplots(1, 2,
+00006f60: 2066 6967 7369 7a65 3d28 3132 2c35 2929   figsize=(12,5))
+00006f70: 0a20 2020 2061 7831 2e73 6574 5f74 6974  .    ax1.set_tit
+00006f80: 6c65 2827 5370 6563 7472 6120 746f 2044  le('Spectra to D
+00006f90: 6973 6361 7264 2729 0a20 2020 2061 7832  iscard').    ax2
+00006fa0: 2e73 6574 5f74 6974 6c65 2827 5370 6563  .set_title('Spec
+00006fb0: 7472 6120 746f 204b 6565 7027 290a 2020  tra to Keep').  
+00006fc0: 2020 6966 2073 756d 287e 6669 6c74 293e    if sum(~filt)>
+00006fd0: 303a 0a20 2020 2020 2020 2066 6f72 2069  0:.        for i
+00006fe0: 2069 6e20 7261 6e67 6528 302c 206e 702e   in range(0, np.
+00006ff0: 7368 6170 6528 6461 7461 5f79 5f64 6973  shape(data_y_dis
+00007000: 6329 5b31 5d29 3a0a 2020 2020 2020 2020  c)[1]):.        
+00007010: 2020 2020 6176 5f70 726f 6d5f 6469 7363      av_prom_disc
+00007020: 3d6e 702e 6162 7328 6e70 2e6e 616e 6d65  =np.abs(np.nanme
+00007030: 6469 616e 2866 6974 5f70 6172 616d 735f  dian(fit_params_
+00007040: 6469 7363 5b27 4469 6164 315f 6162 735f  disc['Diad1_abs_
+00007050: 7072 6f6d 275d 292f 696e 7463 290a 2020  prom'])/intc).  
+00007060: 2020 2020 2020 2020 2020 4469 6666 3d6e            Diff=n
+00007070: 702e 6e61 6e6d 6178 2864 6174 615f 795f  p.nanmax(data_y_
+00007080: 6469 7363 5b3a 2c20 695d 292d 6e70 2e6e  disc[:, i])-np.n
+00007090: 616e 6d69 6e28 6461 7461 5f79 5f64 6973  anmin(data_y_dis
+000070a0: 635b 3a2c 2069 5d29 0a20 2020 2020 2020  c[:, i]).       
+000070b0: 2020 2020 2061 765f 7072 6f6d 5f4b 6565       av_prom_Kee
+000070c0: 703d 6669 745f 7061 7261 6d73 5f64 6973  p=fit_params_dis
+000070d0: 635b 2744 6961 6431 5f61 6273 5f70 726f  c['Diad1_abs_pro
+000070e0: 6d27 5d2e 696c 6f63 5b69 5d0a 2020 2020  m'].iloc[i].    
+000070f0: 2020 2020 2020 2020 7072 6f6d 5f64 6973          prom_dis
+00007100: 633d 7072 6f6d 5f64 6973 632b 6176 5f70  c=prom_disc+av_p
+00007110: 726f 6d5f 6469 7363 0a20 2020 2020 2020  rom_disc.       
+00007120: 2020 2020 2061 7831 2e70 6c6f 7428 785f       ax1.plot(x_
+00007130: 636f 7264 2b69 2a35 2c20 2864 6174 615f  cord+i*5, (data_
+00007140: 795f 6469 7363 5b3a 2c20 695d 2d6e 702e  y_disc[:, i]-np.
+00007150: 6e61 6e6d 696e 2864 6174 615f 795f 6469  nanmin(data_y_di
+00007160: 7363 5b3a 2c20 695d 2929 2f44 6966 662b  sc[:, i]))/Diff+
+00007170: 692f 332c 2027 2d72 272c 206c 773d 302e  i/3, '-r', lw=0.
+00007180: 3529 0a20 2020 2020 2020 2020 2020 2079  5).            y
+00007190: 706c 6f74 3d6e 702e 7175 616e 7469 6c65  plot=np.quantile
+000071a0: 2828 6461 7461 5f79 5f64 6973 635b 3a2c  ((data_y_disc[:,
+000071b0: 2069 5d2d 6e70 2e6e 616e 6d69 6e28 6461   i]-np.nanmin(da
+000071c0: 7461 5f79 5f64 6973 635b 3a2c 2069 5d29  ta_y_disc[:, i])
+000071d0: 292f 4469 6666 2b69 2f33 2c20 302e 3635  )/Diff+i/3, 0.65
+000071e0: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
+000071f0: 6c65 3d66 6974 5f70 6172 616d 735f 6469  le=fit_params_di
+00007200: 7363 5b27 6669 6c65 6e61 6d65 275d 2e69  sc['filename'].i
+00007210: 6c6f 635b 695d 0a20 2020 2020 2020 2020  loc[i].         
+00007220: 2020 2066 696c 6520 3d20 6669 6c65 2e72     file = file.r
+00007230: 6570 6c61 6365 2822 5f43 5252 5f44 6961  eplace("_CRR_Dia
+00007240: 6446 6974 222c 2022 2229 0a20 2020 2020  dFit", "").     
+00007250: 2020 2020 2020 2061 7831 2e61 6e6e 6f74         ax1.annot
+00007260: 6174 6528 7374 7228 6669 6c65 292c 2078  ate(str(file), x
+00007270: 793d 2831 3435 302b 692a 352c 2079 706c  y=(1450+i*5, ypl
+00007280: 6f74 292c 0a20 2020 2020 2020 2020 2020  ot),.           
+00007290: 2020 2020 2020 2020 2078 7963 6f6f 7264           xycoord
+000072a0: 733d 2264 6174 6122 2c20 666f 6e74 7369  s="data", fontsi
+000072b0: 7a65 3d38 2c20 6262 6f78 3d64 6963 7428  ze=8, bbox=dict(
+000072c0: 6661 6365 636f 6c6f 723d 2777 6869 7465  facecolor='white
+000072d0: 272c 2065 6467 6563 6f6c 6f72 3d27 6e6f  ', edgecolor='no
+000072e0: 6e65 272c 2070 6164 3d32 2929 0a0a 2020  ne', pad=2))..  
+000072f0: 2020 2020 2020 6178 312e 7365 745f 786c        ax1.set_xl
+00007300: 696d 285b 3132 3530 2c20 3135 3030 2b69  im([1250, 1500+i
+00007310: 2a35 5d29 0a20 2020 2020 2020 2061 7831  *5]).        ax1
+00007320: 2e73 6574 5f78 7469 636b 7328 5b5d 290a  .set_xticks([]).
+00007330: 2020 2020 2020 2020 6178 312e 7365 745f          ax1.set_
+00007340: 7974 6963 6b73 285b 5d29 0a20 2020 2069  yticks([]).    i
+00007350: 6620 7375 6d28 6669 6c74 293e 303a 0a20  f sum(filt)>0:. 
+00007360: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+00007370: 7261 6e67 6528 302c 206e 702e 7368 6170  range(0, np.shap
+00007380: 6528 6461 7461 5f79 5f66 696c 7429 5b31  e(data_y_filt)[1
+00007390: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+000073a0: 4469 6666 3d6e 702e 6e61 6e6d 6178 2864  Diff=np.nanmax(d
+000073b0: 6174 615f 795f 6669 6c74 5b3a 2c20 695d  ata_y_filt[:, i]
+000073c0: 292d 6e70 2e6e 616e 6d69 6e28 6461 7461  )-np.nanmin(data
+000073d0: 5f79 5f66 696c 745b 3a2c 2069 5d29 0a20  _y_filt[:, i]). 
+000073e0: 2020 2020 2020 2020 2020 2061 765f 7072             av_pr
+000073f0: 6f6d 5f4b 6565 703d 6669 745f 7061 7261  om_Keep=fit_para
+00007400: 6d73 5f66 696c 745b 2744 6961 6431 5f61  ms_filt['Diad1_a
+00007410: 6273 5f70 726f 6d27 5d2e 696c 6f63 5b69  bs_prom'].iloc[i
+00007420: 5d0a 2020 2020 2020 2020 2020 2020 7072  ].            pr
+00007430: 6f6d 5f66 696c 743d 7072 6f6d 5f66 696c  om_filt=prom_fil
+00007440: 742b 6176 5f70 726f 6d5f 4b65 6570 0a20  t+av_prom_Keep. 
+00007450: 2020 2020 2020 2020 2020 2061 7832 2e70             ax2.p
+00007460: 6c6f 7428 785f 636f 7264 2b69 2a35 2c20  lot(x_cord+i*5, 
+00007470: 2864 6174 615f 795f 6669 6c74 5b3a 2c20  (data_y_filt[:, 
+00007480: 695d 2d6e 702e 6e61 6e6d 696e 2864 6174  i]-np.nanmin(dat
+00007490: 615f 795f 6669 6c74 5b3a 2c20 695d 2929  a_y_filt[:, i]))
+000074a0: 2f44 6966 662b 692f 332c 2027 2d62 272c  /Diff+i/3, '-b',
+000074b0: 206c 773d 302e 3529 0a0a 0a20 2020 2020   lw=0.5)...     
+000074c0: 2020 2061 7832 2e73 6574 5f78 6c69 6d28     ax2.set_xlim(
+000074d0: 5b31 3235 302c 2031 3435 302b 692a 355d  [1250, 1450+i*5]
+000074e0: 290a 2020 2020 2020 2020 6178 322e 7365  ).        ax2.se
+000074f0: 745f 7874 6963 6b73 285b 5d29 0a20 2020  t_xticks([]).   
+00007500: 2020 2020 2061 7832 2e73 6574 5f79 7469       ax2.set_yti
+00007510: 636b 7328 5b5d 290a 0a20 2020 2072 6574  cks([])..    ret
+00007520: 7572 6e20 6669 745f 7061 7261 6d73 5f66  urn fit_params_f
+00007530: 696c 742c 2064 6174 615f 795f 6669 6c74  ilt, data_y_filt
+00007540: 2c20 6669 745f 7061 7261 6d73 5f64 6973  , fit_params_dis
+00007550: 632c 2064 6174 615f 795f 6469 7363 0a0a  c, data_y_disc..
+00007560: 0a64 6566 2069 6465 6e74 6966 795f 6469  .def identify_di
+00007570: 6164 5f67 726f 7570 282a 2c20 6669 745f  ad_group(*, fit_
+00007580: 7061 7261 6d73 2c20 6461 7461 5f79 2c20  params, data_y, 
+00007590: 2078 5f63 6f72 642c 2066 696c 7465 725f   x_cord, filter_
+000075a0: 626f 6f6c 2c79 5f66 6967 5f73 6361 6c65  bool,y_fig_scale
+000075b0: 3d30 2e31 2c20 6772 705f 6669 6c74 6572  =0.1, grp_filter
+000075c0: 3d27 5765 616b 2729 3a0a 0a20 2020 2022  ='Weak'):..    "
+000075d0: 2222 536f 7274 7320 6469 6164 7320 696e  ""Sorts diads in
+000075e0: 746f 2074 776f 2067 726f 7570 732e 2054  to two groups. T
+000075f0: 686f 7365 206d 6565 7469 6e67 2074 6865  hose meeting the
+00007600: 2027 6669 6c74 6572 5f62 6f6f 6c27 2063   'filter_bool' c
+00007610: 7269 7465 7269 612c 2061 6e64 2074 686f  riteria, and tho
+00007620: 7365 206e 6f74 0a20 2020 2020 6d65 6574  se not.     meet
+00007630: 696e 6720 7468 6973 2063 7269 7465 7269  ing this criteri
+00007640: 612e 204f 6e65 7320 6d65 6574 696e 6720  a. Ones meeting 
+00007650: 7468 6520 6372 6974 6572 6961 2061 7265  the criteria are
+00007660: 2073 686f 776e 206f 6e20 7468 6520 6c65   shown on the le
+00007670: 6674 2068 616e 6420 706c 6f74 2c0a 2020  ft hand plot,.  
+00007680: 2020 6f6e 6573 206e 6f74 206d 6565 7469    ones not meeti
+00007690: 6e67 2074 6865 2063 7269 7465 7269 6120  ng the criteria 
+000076a0: 6172 6520 7368 6f77 6e20 696e 2074 6865  are shown in the
+000076b0: 2072 6967 6874 2068 616e 6420 706c 6f74   right hand plot
+000076c0: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+000076d0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d  .    -----------
+000076e0: 2d2d 2d2d 2d2d 0a20 2020 2066 6974 5f70  ------.    fit_p
+000076f0: 6172 616d 733a 2070 642e 4461 7461 4672  arams: pd.DataFr
+00007700: 616d 650a 2020 2020 2020 2020 6461 7461  ame.        data
+00007710: 6672 616d 6520 6f66 2061 7070 726f 7869  frame of approxi
+00007720: 6d61 7465 2070 6561 6b20 7061 7261 6d65  mate peak parame
+00007730: 7465 7273 2066 726f 6d20 6c6f 6f70 5f61  ters from loop_a
+00007740: 7070 726f 785f 6469 6164 5f66 6974 730a  pprox_diad_fits.
+00007750: 0a20 2020 2064 6174 615f 793a 206e 702e  .    data_y: np.
+00007760: 6172 7261 790a 2020 2020 2020 2020 7920  array.        y 
+00007770: 636f 6f72 6469 6e61 7465 7320 6f66 2065  coordinates of e
+00007780: 6163 6820 6669 6c65 2069 6e20 6669 745f  ach file in fit_
+00007790: 7061 7261 6d73 0a0a 2020 2020 785f 636f  params..    x_co
+000077a0: 7264 3a20 6e70 2e61 7272 6179 0a20 2020  rd: np.array.   
+000077b0: 2020 2020 2078 2063 6f6f 7264 696e 6174       x coordinat
+000077c0: 6520 6f66 2031 2073 7065 6374 7261 2e20  e of 1 spectra. 
+000077d0: 4173 7375 6d65 7320 616c 6c20 7370 6563  Assumes all spec
+000077e0: 7472 6120 6861 7665 2074 6865 2073 616d  tra have the sam
+000077f0: 6520 7863 6f6f 7264 696e 6174 650a 0a20  e xcoordinate.. 
+00007800: 2020 2066 696c 7465 725f 626f 6f6c 3a20     filter_bool: 
+00007810: 5061 6e64 6173 2e73 6572 6965 7320 6f66  Pandas.series of
+00007820: 2062 6f6f 6c20 2865 2e67 2e20 5472 7565   bool (e.g. True
+00007830: 2c20 4661 6c73 652c 2054 7275 652c 2046  , False, True, F
+00007840: 616c 7365 290a 2020 2020 2020 2020 5468  alse).        Th
+00007850: 6973 2069 7320 7468 6520 6669 6c74 6572  is is the filter
+00007860: 2074 6f20 7573 6520 746f 2073 7562 6469   to use to subdi
+00007870: 7669 6465 2073 7065 6374 7261 2069 6e74  vide spectra int
+00007880: 6f20 7477 6f20 6772 6f75 7073 2e0a 0a20  o two groups... 
+00007890: 2020 2079 5f66 6967 5f73 6361 6c65 3a20     y_fig_scale: 
+000078a0: 666c 6f61 742c 2069 6e74 2028 302e 3129  float, int (0.1)
+000078b0: 0a20 2020 2020 2020 2044 6574 6572 6d69  .        Determi
+000078c0: 6e73 2068 6f77 2066 6172 2061 7061 7274  ns how far apart
+000078d0: 2074 6865 2073 7065 6374 7261 2061 7265   the spectra are
+000078e0: 2064 6973 706c 6179 6564 206f 6e20 7468   displayed on th
+000078f0: 6520 706c 6f74 2e20 4c61 7267 6572 206e  e plot. Larger n
+00007900: 756d 6265 722c 2074 6865 206c 6f6e 6765  umber, the longe
+00007910: 7220 7468 6520 706c 6f74 2069 730a 2020  r the plot is.  
+00007920: 2020 2020 2020 2861 6e64 2065 6173 6965        (and easie
+00007930: 7220 7370 6563 7472 6120 6172 6520 746f  r spectra are to
+00007940: 2073 6565 292e 2054 6865 2074 6f74 616c   see). The total
+00007950: 2068 6569 6768 7420 6f66 2074 6865 2066   height of the f
+00007960: 6967 7572 6520 6973 2032 2b79 5f66 6967  igure is 2+y_fig
+00007970: 5f73 6361 6c65 2a6e 756d 6265 7220 6f66  _scale*number of
+00007980: 2073 7065 6374 7261 0a0a 2020 2020 6772   spectra..    gr
+00007990: 705f 6669 6c74 6572 3a20 7374 720a 2020  p_filter: str.  
+000079a0: 2020 2020 2020 5468 6520 6e61 6d65 206f        The name o
+000079b0: 6620 7468 6520 6772 6f75 7020 7768 6572  f the group wher
+000079c0: 6520 7468 6520 6669 6c74 6572 5f62 6f6f  e the filter_boo
+000079d0: 6c20 6973 2074 7275 652e 2045 2e67 2e20  l is true. E.g. 
+000079e0: 6966 2079 6f75 2061 7070 6c79 2061 2066  if you apply a f
+000079f0: 696c 7465 7220 746f 2067 6574 2074 6865  ilter to get the
+00007a00: 2077 6561 6b20 6469 6164 732c 0a20 2020   weak diads,.   
+00007a10: 2020 2020 2065 6e74 6572 2027 5765 616b       enter 'Weak
+00007a20: 2720 6865 7265 2e20 4966 2066 696c 7465  ' here. If filte
+00007a30: 725f 626f 6f6c 2069 7320 746f 2069 6465  r_bool is to ide
+00007a40: 6e74 6966 7920 5374 726f 6e67 2073 7065  ntify Strong spe
+00007a50: 6374 7261 2c20 656e 7465 7220 274d 6564  ctra, enter 'Med
+00007a60: 6975 6d2d 5374 726f 6e67 2720 6865 7265  ium-Strong' here
+00007a70: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
+00007a80: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     -------------
+00007a90: 2d2d 2d2d 0a20 2020 2070 642e 4461 7461  ----.    pd.Data
+00007aa0: 4672 616d 6520 6f66 2066 6974 2070 6172  Frame of fit par
+00007ab0: 616d 6574 6572 7320 7768 6572 6520 6669  ameters where fi
+00007ac0: 6c74 6572 5f62 6f6f 6c20 6973 2054 7275  lter_bool is Tru
+00007ad0: 650a 2020 2020 7064 2e44 6174 6146 7261  e.    pd.DataFra
+00007ae0: 6d65 206f 6620 6669 7420 7061 7261 6d65  me of fit parame
+00007af0: 7465 7273 2077 6865 7265 2066 696c 7465  ters where filte
+00007b00: 725f 626f 6f6c 2069 7320 4661 6c73 650a  r_bool is False.
+00007b10: 2020 2020 6e70 2e61 7272 6179 206f 6620      np.array of 
+00007b20: 7920 636f 6f72 6469 6e61 7465 7320 7768  y coordinates wh
+00007b30: 6572 6520 6669 6c74 6572 5f62 6f6f 6c20  ere filter_bool 
+00007b40: 6973 2054 7275 650a 2020 2020 6e70 2e61  is True.    np.a
+00007b50: 7272 6179 206f 6620 7920 636f 6f72 6469  rray of y coordi
+00007b60: 6e61 7465 7320 7768 6572 6520 6669 6c74  nates where filt
+00007b70: 6572 5f62 6f6f 6c20 6973 2046 616c 7365  er_bool is False
+00007b80: 0a0a 0a0a 0a20 2020 2022 2222 0a0a 2020  .....    """..  
+00007b90: 2020 6966 206e 702e 7368 6170 6528 6461    if np.shape(da
+00007ba0: 7461 5f79 295b 315d 3d3d 303a 0a20 2020  ta_y)[1]==0:.   
+00007bb0: 2020 2020 2047 726f 7570 315f 6466 3d70       Group1_df=p
+00007bc0: 642e 4461 7461 4672 616d 6528 292e 7265  d.DataFrame().re
+00007bd0: 696e 6465 785f 6c69 6b65 2866 6974 5f70  index_like(fit_p
+00007be0: 6172 616d 7329 0a20 2020 2020 2020 2047  arams).        G
+00007bf0: 726f 7570 6e6f 7431 5f64 663d 7064 2e44  roupnot1_df=pd.D
+00007c00: 6174 6146 7261 6d65 2829 2e72 6569 6e64  ataFrame().reind
+00007c10: 6578 5f6c 696b 6528 6669 745f 7061 7261  ex_like(fit_para
+00007c20: 6d73 290a 2020 2020 2020 2020 4772 6f75  ms).        Grou
+00007c30: 7031 5f6e 705f 793d 6e70 2e7a 6572 6f73  p1_np_y=np.zeros
+00007c40: 2830 2c20 6474 7970 653d 2766 6c6f 6174  (0, dtype='float
+00007c50: 2729 0a20 2020 2020 2020 2047 726f 7570  ').        Group
+00007c60: 6e6f 7431 5f6e 705f 793d 6e70 2e7a 6572  not1_np_y=np.zer
+00007c70: 6f73 2830 2c20 6474 7970 653d 2766 6c6f  os(0, dtype='flo
+00007c80: 6174 2729 0a20 2020 2020 2020 2072 6574  at').        ret
+00007c90: 7572 6e20 4772 6f75 7031 5f64 662c 2047  urn Group1_df, G
+00007ca0: 726f 7570 6e6f 7431 5f64 662c 2047 726f  roupnot1_df, Gro
+00007cb0: 7570 315f 6e70 5f79 2c20 4772 6f75 706e  up1_np_y, Groupn
+00007cc0: 6f74 315f 6e70 5f79 0a0a 2020 2020 656c  ot1_np_y..    el
+00007cd0: 7365 3a0a 2020 2020 2020 2020 2320 4772  se:.        # Gr
+00007ce0: 7031 2069 7320 7768 6572 6520 7468 6520  p1 is where the 
+00007cf0: 626f 6f6c 2069 7320 7472 7565 2e0a 0a20  bool is true... 
+00007d00: 2020 2020 2020 2067 7270 313d 6669 6c74         grp1=filt
+00007d10: 6572 5f62 6f6f 6c0a 0a20 2020 2020 2020  er_bool..       
+00007d20: 2066 6974 5f70 6172 616d 735f 6e6f 7467   fit_params_notg
+00007d30: 7270 313d 6669 745f 7061 7261 6d73 2e6c  rp1=fit_params.l
+00007d40: 6f63 5b7e 6772 7031 5d0a 0a0a 2020 2020  oc[~grp1]...    
+00007d50: 2020 2020 2320 4669 6e64 206f 6e65 7320      # Find ones 
+00007d60: 696e 2067 726f 7570 312c 2069 6e20 6461  in group1, in da
+00007d70: 7461 6672 616d 6520 616e 6420 6e75 6d70  taframe and nump
+00007d80: 7920 666f 726d 0a20 2020 2020 2020 2047  y form.        G
+00007d90: 726f 7570 315f 6466 3d66 6974 5f70 6172  roup1_df=fit_par
+00007da0: 616d 732e 6c6f 635b 6772 7031 5d23 2e72  ams.loc[grp1]#.r
+00007db0: 6573 6574 5f69 6e64 6578 2864 726f 703d  eset_index(drop=
+00007dc0: 5472 7565 290a 2020 2020 2020 2020 4772  True).        Gr
+00007dd0: 6f75 7031 5f64 665f 7265 7365 743d 6669  oup1_df_reset=fi
+00007de0: 745f 7061 7261 6d73 2e6c 6f63 5b67 7270  t_params.loc[grp
+00007df0: 315d 2e72 6573 6574 5f69 6e64 6578 2864  1].reset_index(d
+00007e00: 726f 703d 5472 7565 290a 2020 2020 2020  rop=True).      
+00007e10: 2020 696e 6465 785f 4772 7031 3d47 726f    index_Grp1=Gro
+00007e20: 7570 315f 6466 2e69 6e64 6578 0a20 2020  up1_df.index.   
+00007e30: 2020 2020 2047 726f 7570 315f 6e70 5f79       Group1_np_y
+00007e40: 3d64 6174 615f 795b 3a2c 2069 6e64 6578  =data_y[:, index
+00007e50: 5f47 7270 315d 0a0a 2020 2020 2020 2020  _Grp1]..        
+00007e60: 2320 4f6e 6573 206e 6f74 2069 6e20 6772  # Ones not in gr
+00007e70: 6f75 7031 0a20 2020 2020 2020 2047 726f  oup1.        Gro
+00007e80: 7570 6e6f 7431 5f64 663d 6669 745f 7061  upnot1_df=fit_pa
+00007e90: 7261 6d73 2e6c 6f63 5b7e 6772 7031 5d23  rams.loc[~grp1]#
+00007ea0: 2e72 6573 6574 5f69 6e64 6578 2864 726f  .reset_index(dro
+00007eb0: 703d 5472 7565 290a 2020 2020 2020 2020  p=True).        
+00007ec0: 4772 6f75 706e 6f74 315f 6466 5f72 6573  Groupnot1_df_res
+00007ed0: 6574 3d66 6974 5f70 6172 616d 732e 6c6f  et=fit_params.lo
+00007ee0: 635b 7e67 7270 315d 2e72 6573 6574 5f69  c[~grp1].reset_i
+00007ef0: 6e64 6578 2864 726f 703d 5472 7565 290a  ndex(drop=True).
+00007f00: 2020 2020 2020 2020 696e 6465 785f 4772          index_Gr
+00007f10: 706e 6f74 313d 4772 6f75 706e 6f74 315f  pnot1=Groupnot1_
+00007f20: 6466 2e69 6e64 6578 0a20 2020 2020 2020  df.index.       
+00007f30: 2047 726f 7570 6e6f 7431 5f6e 705f 793d   Groupnot1_np_y=
+00007f40: 6461 7461 5f79 5b3a 2c20 696e 6465 785f  data_y[:, index_
+00007f50: 4772 706e 6f74 315d 0a0a 0a20 2020 2020  Grpnot1]...     
+00007f60: 2020 2066 6967 2c20 2861 7830 2c20 6178     fig, (ax0, ax
+00007f70: 3129 203d 2070 6c74 2e73 7562 706c 6f74  1) = plt.subplot
+00007f80: 7328 312c 2032 2c20 6669 6773 697a 653d  s(1, 2, figsize=
+00007f90: 2831 322c 2032 2b79 5f66 6967 5f73 6361  (12, 2+y_fig_sca
+00007fa0: 6c65 2a6c 656e 2866 6974 5f70 6172 616d  le*len(fit_param
+00007fb0: 7329 2929 0a20 2020 2020 2020 2069 6e74  s))).        int
+00007fc0: 633d 380a 0a0a 2020 2020 2020 2020 230a  c=8...        #.
+00007fd0: 2020 2020 2020 2020 6966 2073 756d 2867          if sum(g
+00007fe0: 7270 3129 3e30 3a0a 0a0a 0a20 2020 2020  rp1)>0:....     
+00007ff0: 2020 2020 2020 2069 6620 7375 6d28 6772         if sum(gr
+00008000: 7031 293d 3d31 3a0a 2020 2020 2020 2020  p1)==1:.        
+00008010: 2020 2020 2020 2020 693d 300a 2020 2020          i=0.    
+00008020: 2020 2020 2020 2020 2020 2020 6176 5f70              av_p
+00008030: 726f 6d5f 6469 7363 3d6e 702e 6162 7328  rom_disc=np.abs(
+00008040: 6e70 2e6e 616e 6d65 6469 616e 2847 726f  np.nanmedian(Gro
+00008050: 7570 315f 6466 5b27 4469 6164 315f 6162  up1_df['Diad1_ab
+00008060: 735f 7072 6f6d 275d 292f 696e 7463 290a  s_prom'])/intc).
+00008070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008080: 4469 6666 3d6e 702e 6e61 6e6d 6178 2847  Diff=np.nanmax(G
+00008090: 726f 7570 315f 6e70 5f79 5b3a 2c20 695d  roup1_np_y[:, i]
+000080a0: 292d 6e70 2e6e 616e 6d69 6e28 4772 6f75  )-np.nanmin(Grou
+000080b0: 7031 5f6e 705f 795b 3a2c 2069 5d29 0a20  p1_np_y[:, i]). 
+000080c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000080d0: 7830 2e70 6c6f 7428 785f 636f 7264 2d69  x0.plot(x_cord-i
+000080e0: 2a35 2c20 2847 726f 7570 315f 6e70 5f79  *5, (Group1_np_y
+000080f0: 5b3a 2c20 695d 2d6e 702e 6e61 6e6d 696e  [:, i]-np.nanmin
+00008100: 2847 726f 7570 315f 6e70 5f79 5b3a 2c20  (Group1_np_y[:, 
+00008110: 695d 2929 2f44 6966 662b 692f 332c 2027  i]))/Diff+i/3, '
+00008120: 2d72 272c 206c 773d 302e 3529 0a20 2020  -r', lw=0.5).   
+00008130: 2020 2020 2020 2020 2020 2020 2079 706c               ypl
+00008140: 6f74 3d6e 702e 7175 616e 7469 6c65 2828  ot=np.quantile((
+00008150: 4772 6f75 7031 5f6e 705f 795b 3a2c 2069  Group1_np_y[:, i
+00008160: 5d2d 6e70 2e6e 616e 6d69 6e28 4772 6f75  ]-np.nanmin(Grou
+00008170: 7031 5f6e 705f 795b 3a2c 2069 5d29 292f  p1_np_y[:, i]))/
+00008180: 4469 6666 2b69 2f33 2c20 302e 3635 290a  Diff+i/3, 0.65).
+00008190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081a0: 6669 6c65 3d47 726f 7570 315f 6466 5f72  file=Group1_df_r
+000081b0: 6573 6574 5b27 6669 6c65 6e61 6d65 275d  eset['filename']
+000081c0: 2e69 6c6f 635b 695d 0a20 2020 2020 2020  .iloc[i].       
+000081d0: 2020 2020 2020 2020 2066 696c 6520 3d20           file = 
+000081e0: 6669 6c65 2e72 6570 6c61 6365 2822 5f43  file.replace("_C
+000081f0: 5252 5f44 6961 6446 6974 222c 2022 2229  RR_DiadFit", "")
+00008200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008210: 2061 7830 2e61 6e6e 6f74 6174 6528 7374   ax0.annotate(st
+00008220: 7228 6669 6c65 292c 2078 793d 2831 3435  r(file), xy=(145
+00008230: 302d 692a 352c 2079 706c 6f74 292c 0a20  0-i*5, yplot),. 
+00008240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008250: 2020 2078 7963 6f6f 7264 733d 2264 6174     xycoords="dat
+00008260: 6122 2c20 666f 6e74 7369 7a65 3d38 2c20  a", fontsize=8, 
+00008270: 6262 6f78 3d64 6963 7428 6661 6365 636f  bbox=dict(faceco
+00008280: 6c6f 723d 2777 6869 7465 272c 2065 6467  lor='white', edg
+00008290: 6563 6f6c 6f72 3d27 6e6f 6e65 272c 2070  ecolor='none', p
+000082a0: 6164 3d32 2929 0a0a 0a20 2020 2020 2020  ad=2))...       
+000082b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000082c0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+000082d0: 2069 6e20 7261 6e67 6528 302c 206e 702e   in range(0, np.
+000082e0: 7368 6170 6528 4772 6f75 7031 5f6e 705f  shape(Group1_np_
+000082f0: 7929 5b31 5d29 3a0a 0a0a 0a20 2020 2020  y)[1]):....     
+00008300: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00008310: 765f 7072 6f6d 5f64 6973 633d 6e70 2e61  v_prom_disc=np.a
+00008320: 6273 286e 702e 6e61 6e6d 6564 6961 6e28  bs(np.nanmedian(
+00008330: 4772 6f75 7031 5f64 665b 2744 6961 6431  Group1_df['Diad1
+00008340: 5f61 6273 5f70 726f 6d27 5d29 2f69 6e74  _abs_prom'])/int
+00008350: 6329 0a20 2020 2020 2020 2020 2020 2020  c).             
+00008360: 2020 2020 2020 2044 6966 663d 6e70 2e6e         Diff=np.n
+00008370: 616e 6d61 7828 4772 6f75 7031 5f6e 705f  anmax(Group1_np_
+00008380: 795b 3a2c 2069 5d29 2d6e 702e 6e61 6e6d  y[:, i])-np.nanm
+00008390: 696e 2847 726f 7570 315f 6e70 5f79 5b3a  in(Group1_np_y[:
+000083a0: 2c20 695d 290a 2020 2020 2020 2020 2020  , i]).          
+000083b0: 2020 2020 2020 2020 2020 6178 302e 706c            ax0.pl
+000083c0: 6f74 2878 5f63 6f72 642d 692a 352c 2028  ot(x_cord-i*5, (
+000083d0: 4772 6f75 7031 5f6e 705f 795b 3a2c 2069  Group1_np_y[:, i
+000083e0: 5d2d 6e70 2e6e 616e 6d69 6e28 4772 6f75  ]-np.nanmin(Grou
+000083f0: 7031 5f6e 705f 795b 3a2c 2069 5d29 292f  p1_np_y[:, i]))/
+00008400: 4469 6666 2b69 2f33 2c20 272d 7227 2c20  Diff+i/3, '-r', 
+00008410: 6c77 3d30 2e35 290a 0a20 2020 2020 2020  lw=0.5)..       
+00008420: 2020 2020 2020 2020 2020 2020 2079 706c               ypl
+00008430: 6f74 3d6e 702e 7175 616e 7469 6c65 2828  ot=np.quantile((
+00008440: 4772 6f75 7031 5f6e 705f 795b 3a2c 2069  Group1_np_y[:, i
+00008450: 5d2d 6e70 2e6e 616e 6d69 6e28 4772 6f75  ]-np.nanmin(Grou
+00008460: 7031 5f6e 705f 795b 3a2c 2069 5d29 292f  p1_np_y[:, i]))/
+00008470: 4469 6666 2b69 2f33 2c20 302e 3529 0a20  Diff+i/3, 0.5). 
+00008480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008490: 2020 2066 696c 653d 4772 6f75 7031 5f64     file=Group1_d
+000084a0: 665f 7265 7365 745b 2766 696c 656e 616d  f_reset['filenam
+000084b0: 6527 5d2e 696c 6f63 5b69 5d0a 2020 2020  e'].iloc[i].    
+000084c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000084d0: 6669 6c65 203d 2066 696c 652e 7265 706c  file = file.repl
+000084e0: 6163 6528 225f 4352 525f 4469 6164 4669  ace("_CRR_DiadFi
+000084f0: 7422 2c20 2222 290a 2020 2020 2020 2020  t", "").        
+00008500: 2020 2020 2020 2020 2020 2020 6178 302e              ax0.
+00008510: 616e 6e6f 7461 7465 2873 7472 2866 696c  annotate(str(fil
+00008520: 6529 2c20 7879 3d28 3134 3530 2d69 2a35  e), xy=(1450-i*5
+00008530: 2c20 7970 6c6f 7429 2c0a 2020 2020 2020  , yplot),.      
+00008540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008550: 2020 7879 636f 6f72 6473 3d22 6461 7461    xycoords="data
+00008560: 222c 2066 6f6e 7473 697a 653d 382c 2062  ", fontsize=8, b
+00008570: 626f 783d 6469 6374 2866 6163 6563 6f6c  box=dict(facecol
+00008580: 6f72 3d27 7768 6974 6527 2c20 6564 6765  or='white', edge
+00008590: 636f 6c6f 723d 276e 6f6e 6527 2c20 7061  color='none', pa
+000085a0: 643d 3229 290a 2020 2020 2020 2020 2020  d=2)).          
+000085b0: 2020 6178 302e 7365 745f 786c 696d 285b    ax0.set_xlim([
+000085c0: 3132 3530 2d69 2a35 2c20 3135 3530 5d29  1250-i*5, 1550])
+000085d0: 0a20 2020 2020 2020 2020 2020 2061 7830  .            ax0
+000085e0: 2e73 6574 5f78 7469 636b 7328 5b5d 290a  .set_xticks([]).
+000085f0: 2020 2020 2020 2020 2020 2020 6178 302e              ax0.
+00008600: 7365 745f 7974 6963 6b73 285b 5d29 0a0a  set_yticks([])..
+00008610: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00008620: 6176 5f70 726f 6d5f 4772 6f75 7031 3d6e  av_prom_Group1=n
+00008630: 702e 6162 7328 6e70 2e6e 616e 6d65 6469  p.abs(np.nanmedi
+00008640: 616e 2847 726f 7570 315f 6466 5b78 5f70  an(Group1_df[x_p
+00008650: 6172 616d 5d29 2f69 6e74 6329 0a20 2020  aram])/intc).   
+00008660: 2020 2020 2020 2020 2023 2061 7830 2e70           # ax0.p
+00008670: 6c6f 7428 785f 636f 7264 2c20 4772 6f75  lot(x_cord, Grou
+00008680: 7031 5f6e 705f 795b 3a2c 2069 5d2b 6176  p1_np_y[:, i]+av
+00008690: 5f70 726f 6d5f 4772 6f75 7031 2a69 2c20  _prom_Group1*i, 
+000086a0: 272d 7227 290a 0a20 2020 2020 2020 2069  '-r')..        i
+000086b0: 6620 7375 6d28 7e67 7270 3129 3e30 3a0a  f sum(~grp1)>0:.
+000086c0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000086d0: 2073 756d 287e 6772 7031 293d 3d31 3a0a   sum(~grp1)==1:.
+000086e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000086f0: 6a3d 300a 2020 2020 2020 2020 2020 2020  j=0.            
+00008700: 2020 2020 6176 5f70 726f 6d5f 6469 7363      av_prom_disc
+00008710: 3d6e 702e 6162 7328 6e70 2e6e 616e 6d65  =np.abs(np.nanme
+00008720: 6469 616e 2847 726f 7570 6e6f 7431 5f64  dian(Groupnot1_d
+00008730: 665b 2744 6961 6431 5f61 6273 5f70 726f  f['Diad1_abs_pro
+00008740: 6d27 5d29 2f69 6e74 6329 0a20 2020 2020  m'])/intc).     
+00008750: 2020 2020 2020 2020 2020 2044 6966 663d             Diff=
+00008760: 6e70 2e6e 616e 6d61 7828 4772 6f75 706e  np.nanmax(Groupn
+00008770: 6f74 315f 6e70 5f79 5b3a 2c20 6a5d 292d  ot1_np_y[:, j])-
+00008780: 6e70 2e6e 616e 6d69 6e28 4772 6f75 706e  np.nanmin(Groupn
+00008790: 6f74 315f 6e70 5f79 5b3a 2c20 6a5d 290a  ot1_np_y[:, j]).
+000087a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000087b0: 6178 312e 706c 6f74 2878 5f63 6f72 642d  ax1.plot(x_cord-
+000087c0: 6a2a 352c 0a20 2020 2020 2020 2020 2020  j*5,.           
+000087d0: 2020 2020 2028 4772 6f75 706e 6f74 315f       (Groupnot1_
+000087e0: 6e70 5f79 5b3a 2c20 6a5d 2d6e 702e 6e61  np_y[:, j]-np.na
+000087f0: 6e6d 696e 2847 726f 7570 6e6f 7431 5f6e  nmin(Groupnot1_n
+00008800: 705f 795b 3a2c 206a 5d29 292f 4469 6666  p_y[:, j]))/Diff
+00008810: 2b6a 2f33 2c20 272d 6b27 2c20 6c77 3d30  +j/3, '-k', lw=0
+00008820: 2e35 290a 2020 2020 2020 2020 2020 2020  .5).            
+00008830: 2020 2020 7970 6c6f 743d 6e70 2e71 7561      yplot=np.qua
+00008840: 6e74 696c 6528 2847 726f 7570 6e6f 7431  ntile((Groupnot1
+00008850: 5f6e 705f 795b 3a2c 206a 5d2d 6e70 2e6e  _np_y[:, j]-np.n
+00008860: 616e 6d69 6e28 4772 6f75 706e 6f74 315f  anmin(Groupnot1_
+00008870: 6e70 5f79 5b3a 2c20 6a5d 2929 2f44 6966  np_y[:, j]))/Dif
+00008880: 662b 6a2f 332c 2030 2e36 3529 0a20 2020  f+j/3, 0.65).   
+00008890: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+000088a0: 653d 4772 6f75 706e 6f74 315f 6466 5f72  e=Groupnot1_df_r
+000088b0: 6573 6574 5b27 6669 6c65 6e61 6d65 275d  eset['filename']
+000088c0: 2e69 6c6f 635b 6a5d 0a20 2020 2020 2020  .iloc[j].       
+000088d0: 2020 2020 2020 2020 2066 696c 6520 3d20           file = 
+000088e0: 6669 6c65 2e72 6570 6c61 6365 2822 5f43  file.replace("_C
+000088f0: 5252 5f44 6961 6446 6974 222c 2022 2229  RR_DiadFit", "")
+00008900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008910: 2061 7831 2e61 6e6e 6f74 6174 6528 7374   ax1.annotate(st
+00008920: 7228 6669 6c65 292c 2078 793d 2831 3435  r(file), xy=(145
+00008930: 302d 6a2a 352c 2079 706c 6f74 292c 0a20  0-j*5, yplot),. 
+00008940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008950: 2020 2078 7963 6f6f 7264 733d 2264 6174     xycoords="dat
+00008960: 6122 2c20 666f 6e74 7369 7a65 3d38 2c20  a", fontsize=8, 
+00008970: 6262 6f78 3d64 6963 7428 6661 6365 636f  bbox=dict(faceco
+00008980: 6c6f 723d 2777 6869 7465 272c 2065 6467  lor='white', edg
+00008990: 6563 6f6c 6f72 3d27 6e6f 6e65 272c 2070  ecolor='none', p
+000089a0: 6164 3d32 2929 0a0a 0a20 2020 2020 2020  ad=2))...       
+000089b0: 2020 2020 2065 6c73 653a 0a0a 2020 2020       else:..    
+000089c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000089d0: 6a20 696e 2072 616e 6765 2830 2c20 6e70  j in range(0, np
+000089e0: 2e73 6861 7065 2847 726f 7570 6e6f 7431  .shape(Groupnot1
+000089f0: 5f6e 705f 7929 5b31 5d29 3a0a 0a20 2020  _np_y)[1]):..   
+00008a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008a10: 2061 765f 7072 6f6d 5f64 6973 633d 6e70   av_prom_disc=np
+00008a20: 2e61 6273 286e 702e 6e61 6e6d 6564 6961  .abs(np.nanmedia
+00008a30: 6e28 4772 6f75 706e 6f74 315f 6466 5b27  n(Groupnot1_df['
+00008a40: 4469 6164 315f 6162 735f 7072 6f6d 275d  Diad1_abs_prom']
+00008a50: 292f 696e 7463 290a 2020 2020 2020 2020  )/intc).        
+00008a60: 2020 2020 2020 2020 2020 2020 4469 6666              Diff
+00008a70: 3d6e 702e 6e61 6e6d 6178 2847 726f 7570  =np.nanmax(Group
+00008a80: 6e6f 7431 5f6e 705f 795b 3a2c 206a 5d29  not1_np_y[:, j])
+00008a90: 2d6e 702e 6e61 6e6d 696e 2847 726f 7570  -np.nanmin(Group
+00008aa0: 6e6f 7431 5f6e 705f 795b 3a2c 206a 5d29  not1_np_y[:, j])
+00008ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008ac0: 2020 2020 2061 7831 2e70 6c6f 7428 785f       ax1.plot(x_
+00008ad0: 636f 7264 2d6a 2a35 2c0a 2020 2020 2020  cord-j*5,.      
+00008ae0: 2020 2020 2020 2020 2020 2020 2020 2847                (G
+00008af0: 726f 7570 6e6f 7431 5f6e 705f 795b 3a2c  roupnot1_np_y[:,
+00008b00: 206a 5d2d 6e70 2e6e 616e 6d69 6e28 4772   j]-np.nanmin(Gr
+00008b10: 6f75 706e 6f74 315f 6e70 5f79 5b3a 2c20  oupnot1_np_y[:, 
+00008b20: 6a5d 2929 2f44 6966 662b 6a2f 332c 2027  j]))/Diff+j/3, '
+00008b30: 2d6b 272c 206c 773d 302e 3529 0a20 2020  -k', lw=0.5).   
+00008b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008b50: 2079 706c 6f74 3d6e 702e 7175 616e 7469   yplot=np.quanti
+00008b60: 6c65 2828 4772 6f75 706e 6f74 315f 6e70  le((Groupnot1_np
+00008b70: 5f79 5b3a 2c20 6a5d 2d6e 702e 6e61 6e6d  _y[:, j]-np.nanm
+00008b80: 696e 2847 726f 7570 6e6f 7431 5f6e 705f  in(Groupnot1_np_
+00008b90: 795b 3a2c 206a 5d29 292f 4469 6666 2b6a  y[:, j]))/Diff+j
+00008ba0: 2f33 2c20 302e 3529 0a20 2020 2020 2020  /3, 0.5).       
+00008bb0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00008bc0: 653d 4772 6f75 706e 6f74 315f 6466 5f72  e=Groupnot1_df_r
+00008bd0: 6573 6574 5b27 6669 6c65 6e61 6d65 275d  eset['filename']
+00008be0: 2e69 6c6f 635b 6a5d 0a20 2020 2020 2020  .iloc[j].       
+00008bf0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00008c00: 6520 3d20 6669 6c65 2e72 6570 6c61 6365  e = file.replace
+00008c10: 2822 5f43 5252 5f44 6961 6446 6974 222c  ("_CRR_DiadFit",
+00008c20: 2022 2229 0a20 2020 2020 2020 2020 2020   "").           
+00008c30: 2020 2020 2020 2020 2061 7831 2e61 6e6e           ax1.ann
+00008c40: 6f74 6174 6528 7374 7228 6669 6c65 292c  otate(str(file),
+00008c50: 2078 793d 2831 3435 302d 6a2a 352c 2079   xy=(1450-j*5, y
+00008c60: 706c 6f74 292c 0a20 2020 2020 2020 2020  plot),.         
+00008c70: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+00008c80: 7963 6f6f 7264 733d 2264 6174 6122 2c20  ycoords="data", 
+00008c90: 666f 6e74 7369 7a65 3d38 2c20 6262 6f78  fontsize=8, bbox
+00008ca0: 3d64 6963 7428 6661 6365 636f 6c6f 723d  =dict(facecolor=
+00008cb0: 2777 6869 7465 272c 2065 6467 6563 6f6c  'white', edgecol
+00008cc0: 6f72 3d27 6e6f 6e65 272c 2070 6164 3d32  or='none', pad=2
+00008cd0: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
+00008ce0: 6178 312e 7365 745f 786c 696d 285b 3132  ax1.set_xlim([12
+00008cf0: 3530 2d6a 2a35 2c20 3135 3530 5d29 0a20  50-j*5, 1550]). 
+00008d00: 2020 2020 2020 2020 2020 2061 7831 2e73             ax1.s
+00008d10: 6574 5f78 7469 636b 7328 5b5d 290a 2020  et_xticks([]).  
+00008d20: 2020 2020 2020 2020 2020 6178 312e 7365            ax1.se
+00008d30: 745f 7974 6963 6b73 285b 5d29 0a0a 0a0a  t_yticks([])....
+00008d40: 2020 2020 2020 2020 6966 2067 7270 5f66          if grp_f
+00008d50: 696c 7465 723d 3d27 4d65 6469 756d 2d53  ilter=='Medium-S
+00008d60: 7472 6f6e 6727 3a0a 2020 2020 2020 2020  trong':.        
+00008d70: 2020 2020 6178 302e 7365 745f 7469 746c      ax0.set_titl
+00008d80: 6528 2743 6c61 7373 6966 6965 6420 6173  e('Classified as
+00008d90: 2053 7472 6f6e 6727 290a 2020 2020 2020   Strong').      
+00008da0: 2020 2020 2020 6178 312e 7365 745f 7469        ax1.set_ti
+00008db0: 746c 6528 2743 6c61 7373 6966 6965 6420  tle('Classified 
+00008dc0: 6173 204d 6564 6975 6d27 290a 2020 2020  as Medium').    
+00008dd0: 2020 2020 6966 2067 7270 5f66 696c 7465      if grp_filte
+00008de0: 723d 3d27 5765 616b 273a 0a20 2020 2020  r=='Weak':.     
+00008df0: 2020 2020 2020 2061 7830 2e73 6574 5f74         ax0.set_t
+00008e00: 6974 6c65 2827 436c 6173 7369 6669 6564  itle('Classified
+00008e10: 2061 7320 5765 616b 2729 0a20 2020 2020   as Weak').     
+00008e20: 2020 2020 2020 2061 7831 2e73 6574 5f74         ax1.set_t
+00008e30: 6974 6c65 2827 4f6e 6573 206c 6566 7420  itle('Ones left 
+00008e40: 286e 6f74 2063 6c61 7373 6966 6965 6420  (not classified 
+00008e50: 7965 7429 2729 0a0a 0a20 2020 2020 2020  yet)')...       
+00008e60: 2070 6c74 2e73 7562 706c 6f74 735f 6164   plt.subplots_ad
+00008e70: 6a75 7374 2877 7370 6163 653d 3029 0a0a  just(wspace=0)..
+00008e80: 2020 2020 2020 2020 7265 7475 726e 2047          return G
+00008e90: 726f 7570 315f 6466 2e72 6573 6574 5f69  roup1_df.reset_i
+00008ea0: 6e64 6578 2864 726f 703d 5472 7565 292c  ndex(drop=True),
+00008eb0: 2047 726f 7570 6e6f 7431 5f64 662e 7265   Groupnot1_df.re
+00008ec0: 7365 745f 696e 6465 7828 6472 6f70 3d54  set_index(drop=T
+00008ed0: 7275 6529 2c47 726f 7570 315f 6e70 5f79  rue),Group1_np_y
+00008ee0: 2c20 4772 6f75 706e 6f74 315f 6e70 5f79  , Groupnot1_np_y
+00008ef0: 0a0a 0a0a 6465 6620 706c 6f74 5f64 6961  ....def plot_dia
+00008f00: 645f 6772 6f75 7073 282a 2c20 785f 636f  d_groups(*, x_co
+00008f10: 7264 2c20 2057 6561 6b5f 6e70 3d4e 6f6e  rd,  Weak_np=Non
+00008f20: 652c 204d 6564 6975 6d5f 6e70 3d4e 6f6e  e, Medium_np=Non
+00008f30: 652c 2053 7472 6f6e 675f 6e70 3d4e 6f6e  e, Strong_np=Non
+00008f40: 652c 2079 5f66 6967 5f73 6361 6c65 3d30  e, y_fig_scale=0
+00008f50: 2e35 293a 0a20 2020 2022 2222 0a20 2020  .5):.    """.   
+00008f60: 2054 6869 7320 6d61 6b65 7320 6120 6669   This makes a fi
+00008f70: 6775 7265 2073 686f 7769 6e67 2073 7065  gure showing spe
+00008f80: 6374 7261 2063 6c61 7373 6966 6965 6420  ctra classified 
+00008f90: 696e 746f 2057 6561 6b2c 204d 6564 6975  into Weak, Mediu
+00008fa0: 6d20 616e 6420 5374 726f 6e67 2067 726f  m and Strong gro
+00008fb0: 7570 7320 6f6e 2061 2033 2070 616e 656c  ups on a 3 panel
+00008fc0: 2070 6c6f 740a 0a20 2020 2050 6172 616d   plot..    Param
+00008fd0: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
+00008fe0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2078 5f63  --------.    x_c
+00008ff0: 6f72 643a 206e 702e 6172 7261 790a 2020  ord: np.array.  
+00009000: 2020 2020 2020 785f 636f 6f72 6469 6e61        x_coordina
+00009010: 7465 2066 6f72 2061 6c6c 2073 7065 6374  te for all spect
+00009020: 7261 2028 6d75 7374 2062 6520 7468 6520  ra (must be the 
+00009030: 7361 6d65 290a 0a20 2020 2057 6561 6b5f  same)..    Weak_
+00009040: 6e70 3a20 6e70 2e61 7272 6179 0a20 2020  np: np.array.   
+00009050: 2020 2020 2079 2063 6f6f 7264 696e 6174       y coordinat
+00009060: 6573 206f 6620 7370 6563 7472 6120 636c  es of spectra cl
+00009070: 6173 7369 6669 6564 2061 7320 7765 616b  assified as weak
+00009080: 0a0a 2020 2020 4d65 6469 756d 5f6e 703a  ..    Medium_np:
+00009090: 206e 702e 6172 7261 790a 2020 2020 2020   np.array.      
+000090a0: 2020 7920 636f 6f72 6469 6e61 7465 7320    y coordinates 
+000090b0: 6f66 2073 7065 6374 7261 2063 6c61 7373  of spectra class
+000090c0: 6966 6965 6420 6173 206d 6564 6975 6d0a  ified as medium.
+000090d0: 0a20 2020 2053 7472 6f6e 675f 6e70 3a20  .    Strong_np: 
+000090e0: 6e70 2e61 7272 6179 0a20 2020 2020 2020  np.array.       
+000090f0: 2079 2063 6f6f 7264 696e 6174 6573 206f   y coordinates o
+00009100: 6620 7370 6563 7472 6120 636c 6173 7369  f spectra classi
+00009110: 6669 6564 2061 7320 7374 726f 6e67 0a0a  fied as strong..
+00009120: 2020 2020 795f 6669 675f 7363 616c 653a      y_fig_scale:
+00009130: 2066 6c6f 6174 0a20 2020 2020 2020 2054   float.        T
+00009140: 6865 2074 6f74 616c 2068 6569 6768 7420  he total height 
+00009150: 6f66 2074 6865 2066 6967 7572 6520 6973  of the figure is
+00009160: 2032 2b79 5f66 6967 5f73 6361 6c65 2a74   2+y_fig_scale*t
+00009170: 6f74 616c 206e 756d 6265 7220 6f66 2073  otal number of s
+00009180: 7065 6374 7261 2065 6e74 6572 6564 2e0a  pectra entered..
+00009190: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
+000091a0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a    -------------.
+000091b0: 2020 2020 6669 6775 7265 2073 686f 7769      figure showi
+000091c0: 6e67 2033 2064 6961 6420 6772 6f75 7073  ng 3 diad groups
+000091d0: 2e0a 0a0a 0a0a 2020 2020 2222 220a 0a0a  ......    """...
+000091e0: 2020 2020 230a 2020 2020 6966 206c 656e      #.    if len
+000091f0: 2857 6561 6b5f 6e70 293e 303a 0a20 2020  (Weak_np)>0:.   
+00009200: 2020 2020 204e 756d 5f57 6561 6b3d 6e70       Num_Weak=np
+00009210: 2e73 6861 7065 2857 6561 6b5f 6e70 295b  .shape(Weak_np)[
+00009220: 315d 0a20 2020 2065 6c73 653a 0a20 2020  1].    else:.   
+00009230: 2020 2020 204e 756d 5f57 6561 6b3d 300a       Num_Weak=0.
+00009240: 2020 2020 6966 206c 656e 284d 6564 6975      if len(Mediu
+00009250: 6d5f 6e70 293e 303a 0a20 2020 2020 2020  m_np)>0:.       
+00009260: 204e 756d 5f4d 6564 6975 6d3d 6e70 2e73   Num_Medium=np.s
+00009270: 6861 7065 284d 6564 6975 6d5f 6e70 295b  hape(Medium_np)[
+00009280: 315d 0a20 2020 2065 6c73 653a 0a20 2020  1].    else:.   
+00009290: 2020 2020 204e 756d 5f4d 6564 6975 6d3d       Num_Medium=
+000092a0: 300a 2020 2020 6966 206c 656e 2853 7472  0.    if len(Str
+000092b0: 6f6e 675f 6e70 293e 303a 0a20 2020 2020  ong_np)>0:.     
+000092c0: 2020 204e 756d 5f53 7472 6f6e 673d 6e70     Num_Strong=np
+000092d0: 2e73 6861 7065 2853 7472 6f6e 675f 6e70  .shape(Strong_np
+000092e0: 295b 315d 0a20 2020 2065 6c73 653a 0a20  )[1].    else:. 
+000092f0: 2020 2020 2020 204e 756d 5f53 7472 6f6e         Num_Stron
+00009300: 673d 300a 0a0a 2020 2020 546f 7461 6c3d  g=0...    Total=
+00009310: 4e75 6d5f 5374 726f 6e67 2b4e 756d 5f4d  Num_Strong+Num_M
+00009320: 6564 6975 6d2b 4e75 6d5f 5765 616b 0a20  edium+Num_Weak. 
+00009330: 2020 2066 6967 2c20 2861 7830 2c20 6178     fig, (ax0, ax
+00009340: 312c 2061 7832 2920 3d20 706c 742e 7375  1, ax2) = plt.su
+00009350: 6270 6c6f 7473 2831 2c20 332c 2066 6967  bplots(1, 3, fig
+00009360: 7369 7a65 3d28 3135 2c32 2b79 5f66 6967  size=(15,2+y_fig
+00009370: 5f73 6361 6c65 2a54 6f74 616c 2929 0a20  _scale*Total)). 
+00009380: 2020 2069 6620 4e75 6d5f 5765 616b 3e30     if Num_Weak>0
+00009390: 3a0a 2020 2020 2020 2020 666f 7220 6920  :.        for i 
+000093a0: 696e 2072 616e 6765 2830 2c20 6e70 2e73  in range(0, np.s
+000093b0: 6861 7065 2857 6561 6b5f 6e70 295b 315d  hape(Weak_np)[1]
+000093c0: 293a 0a20 2020 2020 2020 2020 2020 2044  ):.            D
+000093d0: 6966 663d 6e70 2e6e 616e 6d61 7828 5765  iff=np.nanmax(We
+000093e0: 616b 5f6e 705b 3a2c 2069 5d29 2d6e 702e  ak_np[:, i])-np.
+000093f0: 6e61 6e6d 696e 2857 6561 6b5f 6e70 5b3a  nanmin(Weak_np[:
+00009400: 2c20 695d 290a 2020 2020 2020 2020 2020  , i]).          
+00009410: 2020 6178 302e 706c 6f74 2878 5f63 6f72    ax0.plot(x_cor
+00009420: 642d 692a 352c 2028 5765 616b 5f6e 705b  d-i*5, (Weak_np[
+00009430: 3a2c 2069 5d2d 6e70 2e6e 616e 6d69 6e28  :, i]-np.nanmin(
+00009440: 5765 616b 5f6e 705b 3a2c 2069 5d29 292f  Weak_np[:, i]))/
+00009450: 4469 6666 2b69 2f33 2c20 272d 7227 2c20  Diff+i/3, '-r', 
+00009460: 6c77 3d30 2e35 290a 2020 2020 2020 2020  lw=0.5).        
+00009470: 6178 302e 7365 745f 786c 696d 285b 3132  ax0.set_xlim([12
+00009480: 3530 2d69 2a35 2c20 3134 3530 5d29 0a20  50-i*5, 1450]). 
+00009490: 2020 2020 2020 2061 7830 2e73 6574 5f78         ax0.set_x
+000094a0: 7469 636b 7328 5b5d 290a 2020 2020 2020  ticks([]).      
+000094b0: 2020 6178 302e 7365 745f 7974 6963 6b73    ax0.set_yticks
+000094c0: 285b 5d29 0a0a 2020 2020 6966 204e 756d  ([])..    if Num
+000094d0: 5f4d 6564 6975 6d3e 303a 0a20 2020 2020  _Medium>0:.     
+000094e0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+000094f0: 6528 302c 206e 702e 7368 6170 6528 4d65  e(0, np.shape(Me
+00009500: 6469 756d 5f6e 7029 5b31 5d29 3a0a 2020  dium_np)[1]):.  
+00009510: 2020 2020 2020 2020 2020 4469 6666 3d6e            Diff=n
+00009520: 702e 6e61 6e6d 6178 284d 6564 6975 6d5f  p.nanmax(Medium_
+00009530: 6e70 5b3a 2c20 695d 292d 6e70 2e6e 616e  np[:, i])-np.nan
+00009540: 6d69 6e28 4d65 6469 756d 5f6e 705b 3a2c  min(Medium_np[:,
+00009550: 2069 5d29 0a20 2020 2020 2020 2020 2020   i]).           
+00009560: 2061 7831 2e70 6c6f 7428 785f 636f 7264   ax1.plot(x_cord
+00009570: 2d69 2a35 2c20 284d 6564 6975 6d5f 6e70  -i*5, (Medium_np
+00009580: 5b3a 2c20 695d 2d6e 702e 6e61 6e6d 696e  [:, i]-np.nanmin
+00009590: 284d 6564 6975 6d5f 6e70 5b3a 2c20 695d  (Medium_np[:, i]
+000095a0: 2929 2f44 6966 662b 692f 332c 2027 2d62  ))/Diff+i/3, '-b
+000095b0: 272c 206c 773d 302e 3529 0a20 2020 2020  ', lw=0.5).     
+000095c0: 2020 2061 7831 2e73 6574 5f78 6c69 6d28     ax1.set_xlim(
+000095d0: 5b31 3235 302d 692a 352c 2031 3435 305d  [1250-i*5, 1450]
+000095e0: 290a 2020 2020 2020 2020 6178 312e 7365  ).        ax1.se
+000095f0: 745f 7874 6963 6b73 285b 5d29 0a20 2020  t_xticks([]).   
+00009600: 2020 2020 2061 7831 2e73 6574 5f79 7469       ax1.set_yti
+00009610: 636b 7328 5b5d 290a 0a20 2020 2069 6620  cks([])..    if 
+00009620: 4e75 6d5f 5374 726f 6e67 3e30 3a0a 2020  Num_Strong>0:.  
+00009630: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00009640: 616e 6765 2830 2c20 6e70 2e73 6861 7065  ange(0, np.shape
+00009650: 2853 7472 6f6e 675f 6e70 295b 315d 293a  (Strong_np)[1]):
+00009660: 0a20 2020 2020 2020 2020 2020 2044 6966  .            Dif
+00009670: 663d 6e70 2e6e 616e 6d61 7828 5374 726f  f=np.nanmax(Stro
+00009680: 6e67 5f6e 705b 3a2c 2069 5d29 2d6e 702e  ng_np[:, i])-np.
+00009690: 6e61 6e6d 696e 2853 7472 6f6e 675f 6e70  nanmin(Strong_np
+000096a0: 5b3a 2c20 695d 290a 2020 2020 2020 2020  [:, i]).        
+000096b0: 2020 2020 6178 322e 706c 6f74 2878 5f63      ax2.plot(x_c
+000096c0: 6f72 642d 692a 352c 2028 5374 726f 6e67  ord-i*5, (Strong
+000096d0: 5f6e 705b 3a2c 2069 5d2d 6e70 2e6e 616e  _np[:, i]-np.nan
+000096e0: 6d69 6e28 5374 726f 6e67 5f6e 705b 3a2c  min(Strong_np[:,
+000096f0: 2069 5d29 292f 4469 6666 2b69 2f33 2c20   i]))/Diff+i/3, 
+00009700: 272d 6727 2c20 6c77 3d30 2e35 290a 2020  '-g', lw=0.5).  
+00009710: 2020 2020 2020 6178 322e 7365 745f 786c        ax2.set_xl
+00009720: 696d 285b 3132 3530 2d69 2a35 2c20 3134  im([1250-i*5, 14
+00009730: 3530 5d29 0a20 2020 2020 2020 2061 7832  50]).        ax2
+00009740: 2e73 6574 5f78 7469 636b 7328 5b5d 290a  .set_xticks([]).
+00009750: 2020 2020 2020 2020 6178 322e 7365 745f          ax2.set_
+00009760: 7974 6963 6b73 285b 5d29 0a0a 2020 2020  yticks([])..    
+00009770: 6178 302e 7365 745f 7469 746c 6528 2757  ax0.set_title('W
+00009780: 6561 6b2c 204e 3d27 2b73 7472 284e 756d  eak, N='+str(Num
+00009790: 5f57 6561 6b29 290a 2020 2020 6178 312e  _Weak)).    ax1.
+000097a0: 7365 745f 7469 746c 6528 274d 6564 6975  set_title('Mediu
+000097b0: 6d2c 204e 3d27 2b73 7472 284e 756d 5f4d  m, N='+str(Num_M
+000097c0: 6564 6975 6d29 290a 2020 2020 6178 322e  edium)).    ax2.
+000097d0: 7365 745f 7469 746c 6528 2753 7472 6f6e  set_title('Stron
+000097e0: 672c 204e 3d27 2b73 7472 284e 756d 5f53  g, N='+str(Num_S
+000097f0: 7472 6f6e 6729 290a 2020 2020 706c 742e  trong)).    plt.
+00009800: 7375 6270 6c6f 7473 5f61 646a 7573 7428  subplots_adjust(
+00009810: 7773 7061 6365 3d30 290a 0a20 2020 2072  wspace=0)..    r
+00009820: 6574 7572 6e20 6669 670a 0a0a 6465 6620  eturn fig...def 
+00009830: 7265 6d6f 7665 5f64 6961 645f 6261 7365  remove_diad_base
+00009840: 6c69 6e65 282a 2c20 7061 7468 3d4e 6f6e  line(*, path=Non
+00009850: 652c 2066 696c 656e 616d 653d 4e6f 6e65  e, filename=None
+00009860: 2c20 4469 6164 5f66 696c 6573 3d4e 6f6e  , Diad_files=Non
+00009870: 652c 2066 696c 6574 7970 653d 2757 6974  e, filetype='Wit
+00009880: 6563 5f41 5343 4949 272c 2064 6961 645f  ec_ASCII', diad_
+00009890: 6172 7261 793d 4e6f 6e65 2c0a 2020 2020  array=None,.    
+000098a0: 2020 2020 2020 2020 6578 636c 7564 655f          exclude_
+000098b0: 7261 6e67 6531 3d4e 6f6e 652c 2065 7863  range1=None, exc
+000098c0: 6c75 6465 5f72 616e 6765 323d 4e6f 6e65  lude_range2=None
+000098d0: 2c4e 5f70 6f6c 793d 312c 2078 5f72 616e  ,N_poly=1, x_ran
+000098e0: 6765 5f62 6173 656c 696e 653d 3130 2c0a  ge_baseline=10,.
+000098f0: 2020 2020 2020 2020 2020 2020 6c6f 7765              lowe
+00009900: 725f 6263 6b3d 5b31 3230 302c 2031 3235  r_bck=[1200, 125
+00009910: 305d 2c20 7570 7065 725f 6263 6b3d 5b31  0], upper_bck=[1
+00009920: 3332 302c 2031 3333 305d 2c20 7369 676d  320, 1330], sigm
+00009930: 613d 342c 0a20 2020 2020 2020 2020 2020  a=4,.           
+00009940: 2070 6c6f 745f 6669 6775 7265 3d54 7275   plot_figure=Tru
+00009950: 6529 3a0a 2020 2020 2222 2220 5468 6973  e):.    """ This
+00009960: 2066 756e 6374 696f 6e20 6669 7473 2061   function fits a
+00009970: 6e20 4e74 6820 6465 6772 6565 2070 6f6c  n Nth degree pol
+00009980: 796e 6f6d 6961 6c20 6669 7474 6564 2074  ynomial fitted t
+00009990: 6872 6f75 6768 2073 7065 6374 7261 2070  hrough spectra p
+000099a0: 6f69 6e74 7320 6265 7477 6565 6e20 7477  oints between tw
+000099b0: 6f20 6261 636b 6772 6f75 6e64 2070 6f73  o background pos
+000099c0: 6974 696f 6e73 2e20 4974 2072 6574 7572  itions. It retur
+000099d0: 6e73 2062 6173 656c 696e 652d 7375 6274  ns baseline-subt
+000099e0: 7261 6374 6564 2064 6174 610a 0a20 2020  racted data..   
+000099f0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00009a00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+00009a10: 7061 7468 3a20 7374 720a 2020 2020 2020  path: str.      
+00009a20: 2020 466f 6c64 6572 2077 6865 7265 2073    Folder where s
+00009a30: 7065 6374 7261 2069 7320 7374 6f72 6564  pectra is stored
+00009a40: 0a0a 2020 2020 6669 6c65 6e61 6d65 3a20  ..    filename: 
+00009a50: 7374 720a 2020 2020 2020 2020 5370 6563  str.        Spec
+00009a60: 6966 6963 2066 696c 6520 6265 696e 6720  ific file being 
+00009a70: 7265 6164 0a0a 2020 2020 4f52 0a0a 2020  read..    OR..  
+00009a80: 2020 4469 6164 5f66 696c 6573 3a20 7374    Diad_files: st
+00009a90: 720a 2020 2020 2020 2020 4669 6c65 6e61  r.        Filena
+00009aa0: 6d65 2069 6620 696e 2073 616d 6520 666f  me if in same fo
+00009ab0: 6c64 6572 2061 7320 7363 7269 7074 2e0a  lder as script..
+00009ac0: 0a20 2020 2066 696c 6574 7970 653a 2073  .    filetype: s
+00009ad0: 7472 0a20 2020 2020 2020 2049 6465 6e74  tr.        Ident
+00009ae0: 6966 6965 7320 7479 7065 206f 6620 6669  ifies type of fi
+00009af0: 6c65 2e20 6368 6f6f 7365 2066 726f 6d20  le. choose from 
+00009b00: 2757 6974 6563 5f41 5343 4949 272c 2027  'Witec_ASCII', '
+00009b10: 6865 6164 6c65 7373 5f74 7874 272c 2027  headless_txt', '
+00009b20: 6865 6164 6c65 7373 5f63 7376 272c 2027  headless_csv', '
+00009b30: 6865 6164 5f63 7376 272c 2027 5769 7465  head_csv', 'Wite
+00009b40: 635f 4153 4349 4927 2c0a 2020 2020 2020  c_ASCII',.      
+00009b50: 2020 2748 4f52 4942 415f 7478 7427 2c20    'HORIBA_txt', 
+00009b60: 2752 656e 6973 6861 775f 7478 7427 0a0a  'Renishaw_txt'..
+00009b70: 2020 2020 6578 636c 7564 655f 7261 6e67      exclude_rang
+00009b80: 6531 3a20 4e6f 6e65 206f 7220 6c69 7374  e1: None or list
+00009b90: 206c 656e 6774 6820 320a 2020 2020 2020   length 2.      
+00009ba0: 2020 4578 636c 7564 6573 2061 2072 6567    Excludes a reg
+00009bb0: 696f 6e2c 2065 2e67 2e20 6120 636f 736d  ion, e.g. a cosm
+00009bc0: 6963 2072 6179 0a0a 2020 2020 6578 636c  ic ray..    excl
+00009bd0: 7564 655f 7261 6e67 6532 3a20 4e6f 6e65  ude_range2: None
+00009be0: 206f 7220 6c69 7374 206c 656e 6774 6820   or list length 
+00009bf0: 320a 2020 2020 2020 2020 4578 636c 7564  2.        Exclud
+00009c00: 6573 2061 2072 6567 696f 6e2c 2065 2e67  es a region, e.g
+00009c10: 2e20 6120 636f 736d 6963 2072 6179 0a0a  . a cosmic ray..
+00009c20: 2020 2020 7369 676d 613a 2069 6e74 0a20      sigma: int. 
+00009c30: 2020 2020 2020 2046 696c 7465 7273 206f         Filters o
+00009c40: 7574 2070 6f69 6e74 7320 7468 6174 2061  ut points that a
+00009c50: 7265 206d 6f72 6520 7468 616e 2074 6869  re more than thi
+00009c60: 7320 6e75 6d62 6572 206f 6620 7369 676d  s number of sigm
+00009c70: 6120 6672 6f6d 2074 6865 206d 6564 6961  a from the media
+00009c80: 6e20 6f66 2074 6865 2062 6173 656c 696e  n of the baselin
+00009c90: 652e 0a0a 2020 2020 4e5f 706f 6c79 3a20  e...    N_poly: 
+00009ca0: 696e 740a 2020 2020 2020 2020 4465 6772  int.        Degr
+00009cb0: 6565 206f 6620 706f 6c79 6e6f 6d69 616c  ee of polynomial
+00009cc0: 2074 6f20 6669 7420 746f 2074 6865 2062   to fit to the b
+00009cd0: 6163 6b67 726f 756e 0a0a 2020 2020 6c6f  ackgroun..    lo
+00009ce0: 7765 725f 6263 6b3a 206c 6973 7420 6c65  wer_bck: list le
+00009cf0: 6e20 320a 2020 2020 2020 2020 7761 7665  n 2.        wave
+00009d00: 6e75 6d62 6572 7320 6f66 2062 6173 656c  numbers of basel
+00009d10: 696e 6520 7265 6769 6f6e 2074 6f20 7468  ine region to th
+00009d20: 6520 6c65 6674 206f 6620 7468 6520 7065  e left of the pe
+00009d30: 616b 206f 6620 696e 7465 7265 7374 0a0a  ak of interest..
+00009d40: 2020 2020 7570 7065 725f 6263 6b3a 206c      upper_bck: l
+00009d50: 6973 7420 6c65 6e20 320a 2020 2020 2020  ist len 2.      
+00009d60: 2020 7761 7665 6e75 6d62 6572 7320 746f    wavenumbers to
+00009d70: 2074 6865 2072 6967 6874 206f 6620 7468   the right of th
+00009d80: 6520 7065 616b 206f 6620 696e 7465 7265  e peak of intere
+00009d90: 7374 0a0a 0a20 2020 2070 6c6f 745f 6669  st...    plot_fi
+00009da0: 6775 7265 3a20 626f 6f6c 0a20 2020 2020  gure: bool.     
+00009db0: 2020 2069 6620 5472 7565 2c20 706c 6f74     if True, plot
+00009dc0: 7320 6669 6775 7265 2c20 6966 2046 616c  s figure, if Fal
+00009dd0: 7365 2c20 646f 6573 6e27 742e 0a0a 2020  se, doesn't...  
+00009de0: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+00009df0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 795f  ---------.    y_
+00009e00: 636f 7272 2c20 5079 5f62 6173 652c 2078  corr, Py_base, x
+00009e10: 2c20 2044 6961 645f 7368 6f72 742c 2050  ,  Diad_short, P
+00009e20: 795f 6261 7365 2c20 5066 5f62 6173 656c  y_base, Pf_basel
+00009e30: 696e 652c 2042 6173 656c 696e 655f 7973  ine, Baseline_ys
+00009e40: 7562 2c20 4261 7365 6c69 6e65 5f78 2c20  ub, Baseline_x, 
+00009e50: 4261 7365 6c69 6e65 2c20 7370 616e 0a0a  Baseline, span..
+00009e60: 2020 2020 2020 2020 795f 636f 7272 3a20          y_corr: 
+00009e70: 4261 636b 6772 6f75 6e64 2073 7562 7472  Background subtr
+00009e80: 6163 7465 6420 7920 7661 6c75 6573 2074  acted y values t
+00009e90: 7269 6d6d 6564 2069 6e20 6261 7365 6c69  rimmed in baseli
+00009ea0: 6e65 2072 616e 6765 0a20 2020 2020 2020  ne range.       
+00009eb0: 2078 3a20 696e 6974 6961 6c20 7820 7661   x: initial x va
+00009ec0: 6c75 6573 2074 7269 6d6d 6564 2069 6e20  lues trimmed in 
+00009ed0: 6261 7365 6c69 6e65 2072 616e 6765 0a20  baseline range. 
+00009ee0: 2020 2020 2020 2044 6961 645f 7368 6f72         Diad_shor
+00009ef0: 743a 2049 6e69 7469 616c 2064 6174 6120  t: Initial data 
+00009f00: 2878 2061 6e64 2079 2920 7472 696d 6d65  (x and y) trimme
+00009f10: 6420 696e 2062 6173 656c 696e 6520 7261  d in baseline ra
+00009f20: 6e67 650a 2020 2020 2020 2020 5079 5f62  nge.        Py_b
+00009f30: 6173 653a 2046 6974 7465 6420 6261 7365  ase: Fitted base
+00009f40: 6c69 6e65 2066 6f72 2074 7269 6d6d 6564  line for trimmed
+00009f50: 2078 2063 6f6f 7264 696e 6174 6573 0a20   x coordinates. 
+00009f60: 2020 2020 2020 2050 665f 6261 7365 6c69         Pf_baseli
+00009f70: 6e65 3a20 706f 6c79 6e6f 6d69 616c 206d  ne: polynomial m
+00009f80: 6f64 656c 2066 6974 7465 6420 746f 2062  odel fitted to b
+00009f90: 6173 656c 696e 650a 2020 2020 2020 2020  aseline.        
+00009fa0: 4261 7365 6c69 6e65 5f79 7375 623a 2042  Baseline_ysub: B
+00009fb0: 6173 656c 696e 6520 6669 7474 6564 2066  aseline fitted f
+00009fc0: 6f72 2078 2063 6f6f 7264 696e 6174 6573  or x coordinates
+00009fd0: 2069 6e20 6261 7365 6c69 6e65 0a20 2020   in baseline.   
+00009fe0: 2020 2020 2042 6173 656c 696e 655f 783a       Baseline_x:
+00009ff0: 2078 2063 6f2d 6f72 6469 6e61 7465 7320   x co-ordinates 
+0000a000: 696e 2062 6173 656c 696e 652e 0a20 2020  in baseline..   
+0000a010: 2020 2020 2042 6173 656c 696e 653a 2046       Baseline: F
+0000a020: 696c 7465 7265 6420 746f 2072 656d 6f76  iltered to remov
+0000a030: 6520 706f 696e 7473 206f 7574 7369 6465  e points outside
+0000a040: 2073 6967 6d61 2a73 7464 2064 6576 206f   sigma*std dev o
+0000a050: 6620 6261 7365 6c69 6e65 0a20 2020 2020  f baseline.     
+0000a060: 2020 2073 7061 6e3a 206c 6f77 6572 2061     span: lower a
+0000a070: 6e64 2075 7070 6572 2078 2063 6f6f 7264  nd upper x coord
+0000a080: 696e 6174 6520 6f66 2072 6567 696f 6e20  inate of region 
+0000a090: 7468 6174 2069 736e 7420 7468 6520 6261  that isnt the ba
+0000a0a0: 7365 6c69 6e65 0a0a 0a0a 2020 2020 2222  seline....    ""
+0000a0b0: 220a 0a20 2020 2069 6620 6469 6164 5f61  "..    if diad_a
+0000a0c0: 7272 6179 2069 7320 4e6f 6e65 3a0a 2020  rray is None:.  
+0000a0d0: 2020 2020 2020 4469 6164 5f64 663d 6765        Diad_df=ge
+0000a0e0: 745f 6461 7461 2870 6174 683d 7061 7468  t_data(path=path
+0000a0f0: 2c20 6669 6c65 6e61 6d65 3d66 696c 656e  , filename=filen
+0000a100: 616d 652c 2066 696c 6574 7970 653d 6669  ame, filetype=fi
+0000a110: 6c65 7479 7065 290a 2020 2020 2020 2020  letype).        
+0000a120: 4469 6164 3d6e 702e 6172 7261 7928 4469  Diad=np.array(Di
+0000a130: 6164 5f64 6629 0a20 2020 2065 6c73 653a  ad_df).    else:
+0000a140: 0a20 2020 2020 2020 2044 6961 643d 6469  .        Diad=di
+0000a150: 6164 5f61 7272 6179 0a0a 0a0a 2020 2020  ad_array....    
+0000a160: 6966 2065 7863 6c75 6465 5f72 616e 6765  if exclude_range
+0000a170: 3120 6973 206e 6f74 204e 6f6e 6520 616e  1 is not None an
+0000a180: 6420 6578 636c 7564 655f 7261 6e67 6532  d exclude_range2
+0000a190: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000a1a0: 2020 4469 6164 5f6f 6c64 3d44 6961 642e    Diad_old=Diad.
+0000a1b0: 636f 7079 2829 0a20 2020 2020 2020 2044  copy().        D
+0000a1c0: 6961 643d 4469 6164 5b28 4469 6164 5b3a  iad=Diad[(Diad[:
+0000a1d0: 2c20 305d 3c65 7863 6c75 6465 5f72 616e  , 0]<exclude_ran
+0000a1e0: 6765 315b 305d 297c 2844 6961 645b 3a2c  ge1[0])|(Diad[:,
+0000a1f0: 2030 5d3e 6578 636c 7564 655f 7261 6e67   0]>exclude_rang
+0000a200: 6531 5b31 5d29 5d0a 2020 2020 2020 2020  e1[1])].        
+0000a210: 4469 7363 6172 643d 4469 6164 5f6f 6c64  Discard=Diad_old
+0000a220: 5b28 4469 6164 5f6f 6c64 5b3a 2c20 305d  [(Diad_old[:, 0]
+0000a230: 3e3d 6578 636c 7564 655f 7261 6e67 6531  >=exclude_range1
+0000a240: 5b30 5d29 2026 2028 4469 6164 5f6f 6c64  [0]) & (Diad_old
+0000a250: 5b3a 2c20 305d 3c3d 6578 636c 7564 655f  [:, 0]<=exclude_
+0000a260: 7261 6e67 6531 5b31 5d29 5d0a 0a0a 2020  range1[1])]...  
+0000a270: 2020 6966 2065 7863 6c75 6465 5f72 616e    if exclude_ran
+0000a280: 6765 3220 6973 206e 6f74 204e 6f6e 6520  ge2 is not None 
+0000a290: 616e 6420 6578 636c 7564 655f 7261 6e67  and exclude_rang
+0000a2a0: 6531 2069 7320 4e6f 6e65 3a0a 2020 2020  e1 is None:.    
+0000a2b0: 2020 2020 4469 6164 5f6f 6c64 3d44 6961      Diad_old=Dia
+0000a2c0: 642e 636f 7079 2829 0a20 2020 2020 2020  d.copy().       
+0000a2d0: 2044 6961 643d 4469 6164 5b28 4469 6164   Diad=Diad[(Diad
+0000a2e0: 5b3a 2c20 305d 3c65 7863 6c75 6465 5f72  [:, 0]<exclude_r
+0000a2f0: 616e 6765 325b 305d 297c 2844 6961 645b  ange2[0])|(Diad[
+0000a300: 3a2c 2030 5d3e 6578 636c 7564 655f 7261  :, 0]>exclude_ra
+0000a310: 6e67 6532 5b31 5d29 5d0a 0a20 2020 2020  nge2[1])]..     
+0000a320: 2020 2044 6973 6361 7264 3d44 6961 645f     Discard=Diad_
+0000a330: 6f6c 645b 2844 6961 645f 6f6c 645b 3a2c  old[(Diad_old[:,
+0000a340: 2030 5d3e 3d65 7863 6c75 6465 5f72 616e   0]>=exclude_ran
+0000a350: 6765 325b 305d 2920 2620 2844 6961 645f  ge2[0]) & (Diad_
+0000a360: 6f6c 645b 3a2c 2030 5d3c 3d65 7863 6c75  old[:, 0]<=exclu
+0000a370: 6465 5f72 616e 6765 325b 315d 295d 0a0a  de_range2[1])]..
+0000a380: 2020 2020 6966 2065 7863 6c75 6465 5f72      if exclude_r
+0000a390: 616e 6765 3120 6973 206e 6f74 204e 6f6e  ange1 is not Non
+0000a3a0: 6520 616e 6420 6578 636c 7564 655f 7261  e and exclude_ra
+0000a3b0: 6e67 6532 2069 7320 6e6f 7420 4e6f 6e65  nge2 is not None
+0000a3c0: 3a0a 2020 2020 2020 2020 4469 6164 5f6f  :.        Diad_o
+0000a3d0: 6c64 3d44 6961 642e 636f 7079 2829 0a20  ld=Diad.copy(). 
+0000a3e0: 2020 2020 2020 2044 6961 643d 4469 6164         Diad=Diad
+0000a3f0: 5b0a 2020 2020 2020 2020 2828 4469 6164  [.        ((Diad
+0000a400: 5b3a 2c20 305d 3c65 7863 6c75 6465 5f72  [:, 0]<exclude_r
+0000a410: 616e 6765 315b 305d 297c 2844 6961 645b  ange1[0])|(Diad[
+0000a420: 3a2c 2030 5d3e 6578 636c 7564 655f 7261  :, 0]>exclude_ra
+0000a430: 6e67 6531 5b31 5d29 290a 2020 2020 2020  nge1[1])).      
+0000a440: 2020 260a 2020 2020 2020 2020 2828 4469    &.        ((Di
+0000a450: 6164 5b3a 2c20 305d 3c65 7863 6c75 6465  ad[:, 0]<exclude
+0000a460: 5f72 616e 6765 325b 305d 297c 2844 6961  _range2[0])|(Dia
+0000a470: 645b 3a2c 2030 5d3e 6578 636c 7564 655f  d[:, 0]>exclude_
+0000a480: 7261 6e67 6532 5b31 5d29 290a 2020 2020  range2[1])).    
+0000a490: 2020 2020 5d0a 0a20 2020 2020 2020 2044      ]..        D
+0000a4a0: 6973 6361 7264 3d44 6961 645f 6f6c 645b  iscard=Diad_old[
+0000a4b0: 0a20 2020 2020 2020 2028 2844 6961 645f  .        ((Diad_
+0000a4c0: 6f6c 645b 3a2c 2030 5d3e 3d65 7863 6c75  old[:, 0]>=exclu
+0000a4d0: 6465 5f72 616e 6765 315b 305d 2920 2620  de_range1[0]) & 
+0000a4e0: 2844 6961 645f 6f6c 645b 3a2c 2030 5d3c  (Diad_old[:, 0]<
+0000a4f0: 3d65 7863 6c75 6465 5f72 616e 6765 315b  =exclude_range1[
+0000a500: 315d 2929 0a20 2020 2020 2020 207c 0a20  1])).        |. 
+0000a510: 2020 2020 2020 2028 2844 6961 645f 6f6c         ((Diad_ol
+0000a520: 645b 3a2c 2030 5d3e 3d65 7863 6c75 6465  d[:, 0]>=exclude
+0000a530: 5f72 616e 6765 325b 305d 2920 2620 2844  _range2[0]) & (D
+0000a540: 6961 645f 6f6c 645b 3a2c 2030 5d3c 3d65  iad_old[:, 0]<=e
+0000a550: 7863 6c75 6465 5f72 616e 6765 325b 315d  xclude_range2[1]
+0000a560: 2929 0a20 2020 2020 2020 205d 0a0a 0a20  )).        ]... 
+0000a570: 2020 206c 6f77 6572 5f30 6261 7365 6c69     lower_0baseli
+0000a580: 6e65 3d6c 6f77 6572 5f62 636b 5b30 5d0a  ne=lower_bck[0].
+0000a590: 2020 2020 7570 7065 725f 3062 6173 656c      upper_0basel
+0000a5a0: 696e 653d 6c6f 7765 725f 6263 6b5b 315d  ine=lower_bck[1]
+0000a5b0: 0a20 2020 206c 6f77 6572 5f31 6261 7365  .    lower_1base
+0000a5c0: 6c69 6e65 3d75 7070 6572 5f62 636b 5b30  line=upper_bck[0
+0000a5d0: 5d0a 2020 2020 7570 7065 725f 3162 6173  ].    upper_1bas
+0000a5e0: 656c 696e 653d 7570 7065 725f 6263 6b5b  eline=upper_bck[
+0000a5f0: 315d 0a20 2020 2023 2042 6974 2074 6861  1].    # Bit tha
+0000a600: 7420 6973 2061 6374 7561 6c6c 7920 7065  t is actually pe
+0000a610: 616b 2c20 6e6f 7420 6261 7365 6c69 6e65  ak, not baseline
+0000a620: 0a20 2020 2073 7061 6e3d 5b75 7070 6572  .    span=[upper
+0000a630: 5f30 6261 7365 6c69 6e65 2c20 6c6f 7765  _0baseline, lowe
+0000a640: 725f 3162 6173 656c 696e 655d 0a0a 2020  r_1baseline]..  
+0000a650: 2020 2320 6c6f 7765 725f 3262 6173 656c    # lower_2basel
+0000a660: 696e 653d 3133 3230 0a20 2020 2023 2075  ine=1320.    # u
+0000a670: 7070 6572 5f32 6261 7365 6c69 6e65 3d31  pper_2baseline=1
+0000a680: 3333 300a 0a20 2020 2023 2054 7269 6d20  330..    # Trim 
+0000a690: 666f 7220 656e 7469 7265 2072 616e 6765  for entire range
+0000a6a0: 0a20 2020 2044 6961 645f 7368 6f72 743d  .    Diad_short=
+0000a6b0: 4469 6164 5b20 2844 6961 645b 3a2c 305d  Diad[ (Diad[:,0]
+0000a6c0: 3e6c 6f77 6572 5f30 6261 7365 6c69 6e65  >lower_0baseline
+0000a6d0: 2920 2620 2844 6961 645b 3a2c 305d 3c75  ) & (Diad[:,0]<u
+0000a6e0: 7070 6572 5f31 6261 7365 6c69 6e65 2920  pper_1baseline) 
+0000a6f0: 5d0a 0a20 2020 2023 2047 6574 2061 6374  ]..    # Get act
+0000a700: 7561 6c20 6261 7365 6c69 6e65 0a20 2020  ual baseline.   
+0000a710: 2042 6173 656c 696e 655f 7769 7468 5f6f   Baseline_with_o
+0000a720: 7574 6c3d 4469 6164 5f73 686f 7274 5b0a  utl=Diad_short[.
+0000a730: 2020 2020 2828 4469 6164 5f73 686f 7274      ((Diad_short
+0000a740: 5b3a 2c20 305d 3c75 7070 6572 5f30 6261  [:, 0]<upper_0ba
+0000a750: 7365 6c69 6e65 2920 2628 4469 6164 5f73  seline) &(Diad_s
+0000a760: 686f 7274 5b3a 2c20 305d 3e6c 6f77 6572  hort[:, 0]>lower
+0000a770: 5f30 6261 7365 6c69 6e65 2929 0a20 2020  _0baseline)).   
+0000a780: 2020 2020 2020 7c0a 2020 2020 2828 4469        |.    ((Di
+0000a790: 6164 5f73 686f 7274 5b3a 2c20 305d 3c75  ad_short[:, 0]<u
+0000a7a0: 7070 6572 5f31 6261 7365 6c69 6e65 2920  pper_1baseline) 
+0000a7b0: 2628 4469 6164 5f73 686f 7274 5b3a 2c20  &(Diad_short[:, 
+0000a7c0: 305d 3e6c 6f77 6572 5f31 6261 7365 6c69  0]>lower_1baseli
+0000a7d0: 6e65 2929 5d0a 0a20 2020 2023 2043 616c  ne))]..    # Cal
+0000a7e0: 6375 6c61 7465 7320 7468 6520 6d65 6469  culates the medi
+0000a7f0: 616e 2066 6f72 2074 6865 2062 6173 656c  an for the basel
+0000a800: 696e 6520 616e 6420 7468 6520 7374 616e  ine and the stan
+0000a810: 6461 7264 2064 6576 6961 7469 6f6e 0a20  dard deviation. 
+0000a820: 2020 204d 6564 6961 6e5f 4261 7365 6c69     Median_Baseli
+0000a830: 6e65 3d6e 702e 6d65 616e 2842 6173 656c  ne=np.mean(Basel
+0000a840: 696e 655f 7769 7468 5f6f 7574 6c5b 3a2c  ine_with_outl[:,
+0000a850: 2031 5d29 0a20 2020 2053 7464 5f42 6173   1]).    Std_Bas
+0000a860: 656c 696e 653d 6e70 2e73 7464 2842 6173  eline=np.std(Bas
+0000a870: 656c 696e 655f 7769 7468 5f6f 7574 6c5b  eline_with_outl[
+0000a880: 3a2c 2031 5d29 0a0a 2020 2020 2320 5265  :, 1])..    # Re
+0000a890: 6d6f 7665 7320 616e 7920 706f 696e 7473  moves any points
+0000a8a0: 2069 6e20 7468 6520 6261 7365 6c69 6e65   in the baseline
+0000a8b0: 206f 7574 7369 6465 206f 6620 3220 7369   outside of 2 si
+0000a8c0: 676d 6120 2868 656c 7073 2072 656d 6f76  gma (helps remov
+0000a8d0: 6520 636f 736d 6963 2072 6179 7320 6574  e cosmic rays et
+0000a8e0: 6329 2e0a 2020 2020 4261 7365 6c69 6e65  c)..    Baseline
+0000a8f0: 3d42 6173 656c 696e 655f 7769 7468 5f6f  =Baseline_with_o
+0000a900: 7574 6c5b 2842 6173 656c 696e 655f 7769  utl[(Baseline_wi
+0000a910: 7468 5f6f 7574 6c5b 3a2c 2031 5d3c 4d65  th_outl[:, 1]<Me
+0000a920: 6469 616e 5f42 6173 656c 696e 652b 7369  dian_Baseline+si
+0000a930: 676d 612a 5374 645f 4261 7365 6c69 6e65  gma*Std_Baseline
+0000a940: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a960: 2020 260a 2020 2020 2020 2020 2020 2020    &.            
+0000a970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a980: 2020 2020 2842 6173 656c 696e 655f 7769      (Baseline_wi
+0000a990: 7468 5f6f 7574 6c5b 3a2c 2031 5d3e 4d65  th_outl[:, 1]>Me
+0000a9a0: 6469 616e 5f42 6173 656c 696e 652d 7369  dian_Baseline-si
+0000a9b0: 676d 612a 5374 645f 4261 7365 6c69 6e65  gma*Std_Baseline
+0000a9c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000a9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a9e0: 205d 0a0a 0a20 2020 2023 4261 7365 6c69   ]...    #Baseli
+0000a9f0: 6e65 3d42 6173 656c 696e 655f 7769 7468  ne=Baseline_with
+0000aa00: 5f6f 7574 6c0a 0a0a 0a20 2020 2023 2046  _outl....    # F
+0000aa10: 6974 7320 6120 706f 6c79 6e6f 6d69 616c  its a polynomial
+0000aa20: 2074 6f20 7468 6520 6261 7365 6c69 6e65   to the baseline
+0000aa30: 206f 6620 6465 6772 6565 0a20 2020 2050   of degree.    P
+0000aa40: 665f 6261 7365 6c69 6e65 203d 206e 702e  f_baseline = np.
+0000aa50: 706f 6c79 3164 286e 702e 706f 6c79 6669  poly1d(np.polyfi
+0000aa60: 7428 4261 7365 6c69 6e65 5b3a 2c20 305d  t(Baseline[:, 0]
+0000aa70: 2c20 4261 7365 6c69 6e65 5b3a 2c20 315d  , Baseline[:, 1]
+0000aa80: 2c20 4e5f 706f 6c79 2929 0a20 2020 2050  , N_poly)).    P
+0000aa90: 795f 6261 7365 203d 5066 5f62 6173 656c  y_base =Pf_basel
+0000aaa0: 696e 6528 4469 6164 5f73 686f 7274 5b3a  ine(Diad_short[:
+0000aab0: 2c20 305d 290a 0a0a 2020 2020 4261 7365  , 0])...    Base
+0000aac0: 6c69 6e65 5f79 7375 623d 5066 5f62 6173  line_ysub=Pf_bas
+0000aad0: 656c 696e 6528 4261 7365 6c69 6e65 5b3a  eline(Baseline[:
+0000aae0: 2c20 305d 290a 2020 2020 4261 7365 6c69  , 0]).    Baseli
+0000aaf0: 6e65 5f78 3d42 6173 656c 696e 655b 3a2c  ne_x=Baseline[:,
+0000ab00: 2030 5d0a 2020 2020 795f 636f 7272 3d20   0].    y_corr= 
+0000ab10: 4469 6164 5f73 686f 7274 5b3a 2c20 315d  Diad_short[:, 1]
+0000ab20: 2d20 2050 795f 6261 7365 0a20 2020 2078  -  Py_base.    x
+0000ab30: 3d44 6961 645f 7368 6f72 745b 3a2c 2030  =Diad_short[:, 0
+0000ab40: 5d0a 0a20 2020 2020 2320 506c 6f74 7469  ]..     # Plotti
+0000ab50: 6e67 2077 6861 7420 6974 7320 646f 696e  ng what its doin
+0000ab60: 670a 2020 2020 6966 2070 6c6f 745f 6669  g.    if plot_fi
+0000ab70: 6775 7265 2069 7320 5472 7565 3a0a 0a20  gure is True:.. 
+0000ab80: 2020 2020 2020 2066 6967 2c20 2861 7831         fig, (ax1
+0000ab90: 2c20 6178 3229 203d 2070 6c74 2e73 7562  , ax2) = plt.sub
+0000aba0: 706c 6f74 7328 312c 2032 2c20 6669 6773  plots(1, 2, figs
+0000abb0: 697a 653d 2831 322c 3429 290a 2020 2020  ize=(12,4)).    
+0000abc0: 2020 2020 6178 312e 7365 745f 7469 746c      ax1.set_titl
+0000abd0: 6528 2742 6163 6b67 726f 756e 6420 6669  e('Background fi
+0000abe0: 7427 290a 2020 2020 2020 2020 6178 312e  t').        ax1.
+0000abf0: 706c 6f74 2844 6961 645b 3a2c 2030 5d2c  plot(Diad[:, 0],
+0000ac00: 2044 6961 645b 3a2c 2031 5d2c 2027 2d27   Diad[:, 1], '-'
+0000ac10: 2c20 636f 6c6f 723d 2767 7265 7927 290a  , color='grey').
+0000ac20: 2020 2020 2020 2020 6178 312e 706c 6f74          ax1.plot
+0000ac30: 2844 6961 645f 7368 6f72 745b 3a2c 2030  (Diad_short[:, 0
+0000ac40: 5d2c 2044 6961 645f 7368 6f72 745b 3a2c  ], Diad_short[:,
+0000ac50: 2031 5d2c 2027 2d72 272c 206c 6162 656c   1], '-r', label
+0000ac60: 3d27 7265 6769 6f6e 5f32 5f62 636b 5f73  ='region_2_bck_s
+0000ac70: 7562 2729 0a0a 2020 2020 2020 2020 2361  ub')..        #a
+0000ac80: 7831 2e70 6c6f 7428 4261 7365 6c69 6e65  x1.plot(Baseline
+0000ac90: 5b3a 2c20 305d 2c20 4261 7365 6c69 6e65  [:, 0], Baseline
+0000aca0: 5b3a 2c20 315d 2c20 272d 6227 2c20 6c61  [:, 1], '-b', la
+0000acb0: 6265 6c3d 2742 636b 2070 6f69 6e74 7327  bel='Bck points'
+0000acc0: 290a 2020 2020 2020 2020 6178 312e 706c  ).        ax1.pl
+0000acd0: 6f74 2842 6173 656c 696e 655b 3a2c 2030  ot(Baseline[:, 0
+0000ace0: 5d2c 2042 6173 656c 696e 655b 3a2c 2031  ], Baseline[:, 1
+0000acf0: 5d2c 2027 2e62 272c 206c 6162 656c 3d27  ], '.b', label='
+0000ad00: 4263 6b20 706f 696e 7473 2729 0a20 2020  Bck points').   
+0000ad10: 2020 2020 2061 7831 2e70 6c6f 7428 4469       ax1.plot(Di
+0000ad20: 6164 5f73 686f 7274 5b3a 2c20 305d 2c20  ad_short[:, 0], 
+0000ad30: 5079 5f62 6173 652c 2027 2d6b 2729 0a0a  Py_base, '-k')..
+0000ad40: 0a0a 2020 2020 2020 2020 6178 315f 796d  ..        ax1_ym
+0000ad50: 696e 3d6e 702e 6d69 6e28 4261 7365 6c69  in=np.min(Baseli
+0000ad60: 6e65 5b3a 2c20 315d 292d 3130 2a6e 702e  ne[:, 1])-10*np.
+0000ad70: 7374 6428 4261 7365 6c69 6e65 5b3a 2c20  std(Baseline[:, 
+0000ad80: 315d 290a 2020 2020 2020 2020 6178 315f  1]).        ax1_
+0000ad90: 796d 6178 3d6e 702e 6d61 7828 4261 7365  ymax=np.max(Base
+0000ada0: 6c69 6e65 5b3a 2c20 315d 292b 3130 2a6e  line[:, 1])+10*n
+0000adb0: 702e 7374 6428 4261 7365 6c69 6e65 5b3a  p.std(Baseline[:
+0000adc0: 2c20 315d 290a 2020 2020 2020 2020 6178  , 1]).        ax
+0000add0: 315f 786d 696e 3d6c 6f77 6572 5f30 6261  1_xmin=lower_0ba
+0000ade0: 7365 6c69 6e65 2d33 300a 2020 2020 2020  seline-30.      
+0000adf0: 2020 6178 315f 786d 6178 3d75 7070 6572    ax1_xmax=upper
+0000ae00: 5f31 6261 7365 6c69 6e65 2b33 300a 2020  _1baseline+30.  
+0000ae10: 2020 2020 2020 2320 4164 6469 6e67 2070        # Adding p
+0000ae20: 6174 6368 6573 0a0a 0a20 2020 2020 2020  atches...       
+0000ae30: 2072 6563 745f 6469 6164 315f 6231 3d70   rect_diad1_b1=p
+0000ae40: 6174 6368 6573 2e52 6563 7461 6e67 6c65  atches.Rectangle
+0000ae50: 2828 6c6f 7765 725f 3062 6173 656c 696e  ((lower_0baselin
+0000ae60: 652c 2061 7831 5f79 6d69 6e29 2c75 7070  e, ax1_ymin),upp
+0000ae70: 6572 5f30 6261 7365 6c69 6e65 2d6c 6f77  er_0baseline-low
+0000ae80: 6572 5f30 6261 7365 6c69 6e65 2c61 7831  er_0baseline,ax1
+0000ae90: 5f79 6d61 782d 6178 315f 796d 696e 2c0a  _ymax-ax1_ymin,.
+0000aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aeb0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+0000aec0: 6e65 7769 6474 683d 312c 6564 6765 636f  newidth=1,edgeco
+0000aed0: 6c6f 723d 276e 6f6e 6527 2c66 6163 6563  lor='none',facec
+0000aee0: 6f6c 6f72 3d27 6379 616e 272c 206c 6162  olor='cyan', lab
+0000aef0: 656c 3d27 6263 6b27 2c20 616c 7068 613d  el='bck', alpha=
+0000af00: 302e 332c 207a 6f72 6465 723d 3029 0a20  0.3, zorder=0). 
+0000af10: 2020 2020 2020 2061 7831 2e61 6464 5f70         ax1.add_p
+0000af20: 6174 6368 2872 6563 745f 6469 6164 315f  atch(rect_diad1_
+0000af30: 6231 290a 2020 2020 2020 2020 7265 6374  b1).        rect
+0000af40: 5f64 6961 6431 5f62 323d 7061 7463 6865  _diad1_b2=patche
+0000af50: 732e 5265 6374 616e 676c 6528 286c 6f77  s.Rectangle((low
+0000af60: 6572 5f31 6261 7365 6c69 6e65 2c20 6178  er_1baseline, ax
+0000af70: 315f 796d 696e 292c 7570 7065 725f 3162  1_ymin),upper_1b
+0000af80: 6173 656c 696e 652d 6c6f 7765 725f 3162  aseline-lower_1b
+0000af90: 6173 656c 696e 652c 6178 315f 796d 6178  aseline,ax1_ymax
+0000afa0: 2d61 7831 5f79 6d69 6e2c 0a20 2020 2020  -ax1_ymin,.     
+0000afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000afc0: 2020 2020 2020 2020 206c 696e 6577 6964           linewid
+0000afd0: 7468 3d31 2c65 6467 6563 6f6c 6f72 3d27  th=1,edgecolor='
+0000afe0: 6e6f 6e65 272c 6661 6365 636f 6c6f 723d  none',facecolor=
+0000aff0: 2763 7961 6e27 2c20 616c 7068 613d 302e  'cyan', alpha=0.
+0000b000: 332c 207a 6f72 6465 723d 3029 0a20 2020  3, zorder=0).   
+0000b010: 2020 2020 2061 7831 2e61 6464 5f70 6174       ax1.add_pat
+0000b020: 6368 2872 6563 745f 6469 6164 315f 6232  ch(rect_diad1_b2
+0000b030: 290a 2020 2020 2020 2020 6178 312e 7365  ).        ax1.se
+0000b040: 745f 786c 696d 285b 6178 315f 786d 696e  t_xlim([ax1_xmin
+0000b050: 2c20 6178 315f 786d 6178 5d29 0a20 2020  , ax1_xmax]).   
+0000b060: 2020 2020 2061 7831 2e73 6574 5f79 6c69       ax1.set_yli
+0000b070: 6d28 5b61 7831 5f79 6d69 6e2c 2061 7831  m([ax1_ymin, ax1
+0000b080: 5f79 6d61 785d 290a 0a20 2020 2020 2020  _ymax])..       
+0000b090: 2061 7831 2e73 6574 5f79 6c61 6265 6c28   ax1.set_ylabel(
+0000b0a0: 2749 6e74 656e 7369 7479 2729 0a20 2020  'Intensity').   
+0000b0b0: 2020 2020 2061 7832 2e73 6574 5f79 6c61       ax2.set_yla
+0000b0c0: 6265 6c28 2749 6e74 656e 7369 7479 2729  bel('Intensity')
+0000b0d0: 0a20 2020 2020 2020 2061 7832 2e73 6574  .        ax2.set
+0000b0e0: 5f78 6c61 6265 6c28 2757 6176 656e 756d  _xlabel('Wavenum
+0000b0f0: 6265 7227 290a 2020 2020 2020 2020 6178  ber').        ax
+0000b100: 312e 6c65 6765 6e64 2829 0a0a 0a0a 2020  1.legend()....  
+0000b110: 2020 2020 2020 6178 322e 7365 745f 7469        ax2.set_ti
+0000b120: 746c 6528 2742 6163 6b67 726f 756e 6420  tle('Background 
+0000b130: 7375 6274 7261 6374 6564 2729 0a20 2020  subtracted').   
+0000b140: 2020 2020 2061 7832 2e70 6c6f 7428 782c       ax2.plot(x,
+0000b150: 2079 5f63 6f72 722c 2027 2d72 2729 0a20   y_corr, '-r'). 
+0000b160: 2020 2020 2020 2068 6569 6768 745f 703d         height_p=
+0000b170: 6e70 2e6d 6178 2844 6961 645f 7368 6f72  np.max(Diad_shor
+0000b180: 745b 3a2c 2031 5d29 2d6e 702e 6d69 6e28  t[:, 1])-np.min(
+0000b190: 4469 6164 5f73 686f 7274 5b3a 2c20 315d  Diad_short[:, 1]
+0000b1a0: 290a 2020 2020 2020 2020 6178 322e 7365  ).        ax2.se
+0000b1b0: 745f 796c 696d 285b 6e70 2e6d 696e 2879  t_ylim([np.min(y
+0000b1c0: 5f63 6f72 7229 2c20 312e 322a 6865 6967  _corr), 1.2*heig
+0000b1d0: 6874 5f70 205d 290a 2020 2020 2020 2020  ht_p ]).        
+0000b1e0: 6178 312e 7365 745f 786c 6162 656c 2827  ax1.set_xlabel('
+0000b1f0: 5761 7665 6e75 6d62 6572 2729 0a0a 0a20  Wavenumber')... 
+0000b200: 2020 2072 6574 7572 6e20 795f 636f 7272     return y_corr
+0000b210: 2c20 5079 5f62 6173 652c 2078 2c20 2044  , Py_base, x,  D
+0000b220: 6961 645f 7368 6f72 742c 2050 795f 6261  iad_short, Py_ba
+0000b230: 7365 2c20 5066 5f62 6173 656c 696e 652c  se, Pf_baseline,
+0000b240: 2042 6173 656c 696e 655f 7973 7562 2c20   Baseline_ysub, 
+0000b250: 4261 7365 6c69 6e65 5f78 2c20 4261 7365  Baseline_x, Base
+0000b260: 6c69 6e65 2c20 7370 616e 0a0a 0a0a 6465  line, span....de
+0000b270: 6620 6164 645f 7065 616b 282a 2c20 7072  f add_peak(*, pr
+0000b280: 6566 6978 3d4e 6f6e 652c 2063 656e 7465  efix=None, cente
+0000b290: 723d 4e6f 6e65 2c20 6d6f 6465 6c5f 6e61  r=None, model_na
+0000b2a0: 6d65 3d27 566f 6967 744d 6f64 656c 272c  me='VoigtModel',
+0000b2b0: 0a6d 696e 5f63 656e 743d 4e6f 6e65 2c20  .min_cent=None, 
+0000b2c0: 6d61 785f 6365 6e74 3d4e 6f6e 652c 206d  max_cent=None, m
+0000b2d0: 696e 5f73 6967 6d61 3d4e 6f6e 652c 206d  in_sigma=None, m
+0000b2e0: 6178 5f73 6967 6d61 3d4e 6f6e 652c 2061  ax_sigma=None, a
+0000b2f0: 6d70 6c69 7475 6465 3d31 3030 2c20 6d69  mplitude=100, mi
+0000b300: 6e5f 616d 706c 6974 7564 653d 4e6f 6e65  n_amplitude=None
+0000b310: 2c20 6d61 785f 616d 706c 6974 7564 653d  , max_amplitude=
+0000b320: 4e6f 6e65 2c20 7369 676d 613d 302e 3229  None, sigma=0.2)
+0000b330: 3a0a 2020 2020 2222 220a 2020 2020 5468  :.    """.    Th
+0000b340: 6973 2066 756e 6374 696f 6e20 6974 6572  is function iter
+0000b350: 6174 6976 656c 7920 6164 6473 2061 2070  atively adds a p
+0000b360: 6561 6b20 7573 696e 6720 6c6d 6669 742c  eak using lmfit,
+0000b370: 2075 7365 6420 666f 7220 6974 6572 6174   used for iterat
+0000b380: 6976 656c 7920 6669 7474 696e 6720 4842  ively fitting HB
+0000b390: 2c20 4331 3320 6574 632e 0a0a 2020 2020  , C13 etc...    
+0000b3a0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+0000b3b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
+0000b3c0: 2020 7072 6566 6978 3a20 7374 720a 2020    prefix: str.  
+0000b3d0: 2020 2020 2020 5072 6566 6978 2061 6464        Prefix add
+0000b3e0: 6564 2074 6f20 7065 616b 206e 616d 652c  ed to peak name,
+0000b3f0: 2065 2e67 2e20 2764 6961 6431 272c 2073   e.g. 'diad1', s
+0000b400: 6f20 6974 2072 6561 6473 2064 6961 6431  o it reads diad1
+0000b410: 5f63 656e 7465 722c 2064 6961 6431 5f73  _center, diad1_s
+0000b420: 6967 6d61 2065 7463 2e0a 0a20 2020 2063  igma etc...    c
+0000b430: 656e 7465 723a 2066 6c6f 6174 2c20 696e  enter: float, in
+0000b440: 740a 2020 2020 2020 2020 4573 7469 6d61  t.        Estima
+0000b450: 7465 206f 6620 7065 616b 2063 656e 7465  te of peak cente
+0000b460: 7220 2865 2e67 2e20 7820 636f 6f72 6469  r (e.g. x coordi
+0000b470: 6e61 7465 206f 6620 7065 616b 290a 0a20  nate of peak).. 
+0000b480: 2020 2073 6967 6d61 3a20 666c 6f61 742c     sigma: float,
+0000b490: 2069 6e74 2028 6465 6661 756c 7420 302e   int (default 0.
+0000b4a0: 3229 0a20 2020 2020 2020 2045 7374 696d  2).        Estim
+0000b4b0: 6174 6520 6f66 2073 6967 6d61 206f 6620  ate of sigma of 
+0000b4c0: 7065 616b 2066 6974 0a0a 2020 2020 616d  peak fit..    am
+0000b4d0: 706c 6974 7564 653a 2066 6c6f 6174 2c20  plitude: float, 
+0000b4e0: 696e 740a 2020 2020 2020 2020 4573 7469  int.        Esti
+0000b4f0: 6d61 7465 206f 6620 616d 706c 6974 7564  mate of amplitud
+0000b500: 6520 6f66 2070 6561 6b66 2069 740a 0a0a  e of peakf it...
+0000b510: 2020 2020 6d6f 6465 6c5f 6e61 6d65 3a20      model_name: 
+0000b520: 7374 7220 2756 6f69 6774 4d6f 6465 6c27  str 'VoigtModel'
+0000b530: 206f 7220 2750 7365 7564 6f56 6f69 6774   or 'PseudoVoigt
+0000b540: 4d6f 6465 6c27 0a20 2020 2020 2020 2054  Model'.        T
+0000b550: 7970 6520 6f66 2070 6561 6b20 7768 6963  ype of peak whic
+0000b560: 6820 6973 2062 6569 6e67 2061 6464 6564  h is being added
+0000b570: 2e0a 0a20 2020 204f 7074 696f 6e61 6c3a  ...    Optional:
+0000b580: 0a0a 2020 2020 6d69 6e5f 6365 6e74 2c20  ..    min_cent, 
+0000b590: 6d61 785f 6365 6e74 3a20 666c 6f61 740a  max_cent: float.
+0000b5a0: 2020 2020 2020 2020 4d69 6e69 6d75 6d20          Minimum 
+0000b5b0: 616e 6420 6d61 7869 6d75 6d20 7820 636f  and maximum x co
+0000b5c0: 6f72 6469 6e61 7465 2074 6f20 706c 6163  ordinate to plac
+0000b5d0: 6520 7065 616b 2063 656e 7465 7220 6174  e peak center at
+0000b5e0: 0a0a 2020 2020 6d69 6e5f 7369 676d 612c  ..    min_sigma,
+0000b5f0: 206d 6178 5f73 6967 6d61 3a20 666c 6f61   max_sigma: floa
+0000b600: 740a 2020 2020 2020 2020 4d69 6e69 6d75  t.        Minimu
+0000b610: 6d20 616e 6420 6d61 7869 6d75 6d20 7369  m and maximum si
+0000b620: 676d 6120 6f66 2070 6561 6b20 6669 740a  gma of peak fit.
+0000b630: 0a20 2020 206d 696e 5f61 6d70 6c69 7475  .    min_amplitu
+0000b640: 6465 2c20 6d61 785f 616d 706c 6974 7564  de, max_amplitud
+0000b650: 653a 2066 6c6f 6174 0a20 2020 2020 2020  e: float.       
+0000b660: 204d 696e 696d 756d 2061 6e64 206d 6178   Minimum and max
+0000b670: 696d 756d 2073 6967 6d61 206f 6620 7065  imum sigma of pe
+0000b680: 616b 2066 6974 0a0a 2020 2020 5265 7475  ak fit..    Retu
+0000b690: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  rns.    --------
+0000b6a0: 2d2d 2d2d 2d2d 2d0a 0a20 2020 2070 6561  -------..    pea
+0000b6b0: 6b3a 2046 6974 7465 6420 6d6f 6465 6c0a  k: Fitted model.
+0000b6c0: 2020 2020 7061 7261 6d73 3a20 5065 616b      params: Peak
+0000b6d0: 2066 6974 2070 6172 616d 6574 6572 730a   fit parameters.
+0000b6e0: 0a20 2020 2022 2222 0a20 2020 204d 6f64  .    """.    Mod
+0000b6f0: 656c 5f63 6f6d 626f 203d 2067 6c6f 6261  el_combo = globa
+0000b700: 6c73 2829 5b6d 6f64 656c 5f6e 616d 655d  ls()[model_name]
+0000b710: 2870 7265 6669 783d 7072 6566 6978 290a  (prefix=prefix).
+0000b720: 0a20 2020 2070 6561 6b20 3d20 204d 6f64  .    peak =  Mod
+0000b730: 656c 5f63 6f6d 626f 0a20 2020 2070 6172  el_combo.    par
+0000b740: 7320 3d20 7065 616b 2e6d 616b 655f 7061  s = peak.make_pa
+0000b750: 7261 6d73 2829 0a0a 2020 2020 6966 206d  rams()..    if m
+0000b760: 696e 5f63 656e 7420 6973 206e 6f74 204e  in_cent is not N
+0000b770: 6f6e 6520 616e 6420 6d61 785f 6365 6e74  one and max_cent
+0000b780: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0000b790: 2020 2020 2020 7061 7273 5b70 7265 6669        pars[prefi
+0000b7a0: 7820 2b20 2763 656e 7465 7227 5d2e 7365  x + 'center'].se
+0000b7b0: 7428 6365 6e74 6572 2c20 6d69 6e3d 6d69  t(center, min=mi
+0000b7c0: 6e5f 6365 6e74 2c20 6d61 783d 6d61 785f  n_cent, max=max_
+0000b7d0: 6365 6e74 290a 2020 2020 656c 7365 3a0a  cent).    else:.
+0000b7e0: 2020 2020 2020 2020 7061 7273 5b70 7265          pars[pre
+0000b7f0: 6669 7820 2b20 2763 656e 7465 7227 5d2e  fix + 'center'].
+0000b800: 7365 7428 6365 6e74 6572 290a 0a0a 2020  set(center)...  
+0000b810: 2020 7061 7273 5b70 7265 6669 7820 2b20    pars[prefix + 
+0000b820: 2761 6d70 6c69 7475 6465 275d 2e73 6574  'amplitude'].set
+0000b830: 2861 6d70 6c69 7475 6465 2c20 6d69 6e3d  (amplitude, min=
+0000b840: 6d69 6e5f 616d 706c 6974 7564 652c 206d  min_amplitude, m
+0000b850: 6178 3d6d 6178 5f61 6d70 6c69 7475 6465  ax=max_amplitude
+0000b860: 290a 0a20 2020 2069 6620 6d69 6e5f 7369  )..    if min_si
+0000b870: 676d 6120 6973 206e 6f74 204e 6f6e 653a  gma is not None:
+0000b880: 0a20 2020 2020 2020 2070 6172 735b 7072  .        pars[pr
+0000b890: 6566 6978 2b27 7369 676d 6127 5d2e 7365  efix+'sigma'].se
+0000b8a0: 7428 7369 676d 612c 206d 6178 3d6d 6178  t(sigma, max=max
+0000b8b0: 5f73 6967 6d61 290a 0a20 2020 2069 6620  _sigma)..    if 
+0000b8c0: 6d69 6e5f 7369 676d 6120 6973 206e 6f74  min_sigma is not
+0000b8d0: 204e 6f6e 6520 616e 6420 6d61 785f 7369   None and max_si
+0000b8e0: 676d 6120 6973 206e 6f74 204e 6f6e 653a  gma is not None:
+0000b8f0: 0a20 2020 2020 2020 2070 6172 735b 7072  .        pars[pr
+0000b900: 6566 6978 2b27 7369 676d 6127 5d2e 7365  efix+'sigma'].se
+0000b910: 7428 7369 676d 612c 206d 6178 3d6d 6178  t(sigma, max=max
+0000b920: 5f73 6967 6d61 2c20 6d69 6e3d 6d69 6e5f  _sigma, min=min_
+0000b930: 7369 676d 6129 0a0a 2020 2020 656c 7365  sigma)..    else
+0000b940: 3a0a 2020 2020 2020 2020 7061 7273 5b70  :.        pars[p
+0000b950: 7265 6669 7820 2b20 2773 6967 6d61 275d  refix + 'sigma']
+0000b960: 2e73 6574 2873 6967 6d61 2c20 6d69 6e3d  .set(sigma, min=
+0000b970: 3029 0a0a 0a20 2020 2072 6574 7572 6e20  0)...    return 
+0000b980: 7065 616b 2c20 7061 7273 0a0a 0a0a 0a0a  peak, pars......
+0000b990: 0a23 2320 4f76 6572 616c 6c20 6675 6e63  .## Overall func
+0000b9a0: 7469 6f6e 2066 6f72 2066 6974 7469 6e67  tion for fitting
+0000b9b0: 2064 6961 6473 2069 6e20 3120 7369 6e67   diads in 1 sing
+0000b9c0: 6c65 2073 7465 700a 4064 6174 6163 6c61  le step.@datacla
+0000b9d0: 7373 0a63 6c61 7373 2064 6961 6431 5f66  ss.class diad1_f
+0000b9e0: 6974 5f63 6f6e 6669 673a 0a20 2020 2022  it_config:.    "
+0000b9f0: 2222 0a20 2020 2043 6f6e 6669 6775 7261  "".    Configura
+0000ba00: 7469 6f6e 2063 6c61 7373 2066 6f72 2066  tion class for f
+0000ba10: 6974 7469 6e67 2044 6961 6420 310a 0a20  itting Diad 1.. 
+0000ba20: 2020 2054 6869 7320 636c 6173 7320 7374     This class st
+0000ba30: 6f72 6573 2063 6f6e 6669 6775 7261 7469  ores configurati
+0000ba40: 6f6e 2070 6172 616d 6574 6572 7320 666f  on parameters fo
+0000ba50: 7220 6669 7474 696e 6720 4469 6164 2031  r fitting Diad 1
+0000ba60: 2061 6e64 2061 7373 6f63 6961 7465 6420   and associated 
+0000ba70: 7065 616b 732e 0a20 2020 2054 6865 2063  peaks..    The c
+0000ba80: 6c61 7373 2061 6c6c 6f77 7320 666f 7220  lass allows for 
+0000ba90: 6561 7379 2063 7573 746f 6d69 7a61 7469  easy customizati
+0000baa0: 6f6e 206f 6620 7468 6520 6669 7474 696e  on of the fittin
+0000bab0: 6720 7072 6f63 6573 732e 0a0a 2020 2020  g process...    
+0000bac0: 4174 7472 6962 7574 6573 3a0a 2020 2020  Attributes:.    
+0000bad0: 2020 2020 6d6f 6465 6c5f 6e61 6d65 2028      model_name (
+0000bae0: 7374 7229 3a20 4465 6661 756c 7420 2750  str): Default 'P
+0000baf0: 7365 7564 6f56 6f69 6774 4d6f 6465 6c27  seudoVoigtModel'
+0000bb00: 2e0a 2020 2020 2020 2020 2020 2020 4d6f  ..            Mo
+0000bb10: 6465 6c20 6e61 6d65 2066 6f72 2070 6561  del name for pea
+0000bb20: 6b20 6669 7474 696e 672e 2043 686f 6f73  k fitting. Choos
+0000bb30: 6520 6672 6f6d 0a20 2020 2020 2020 2020  e from.         
+0000bb40: 2020 2027 5073 6575 646f 566f 6967 744d     'PseudoVoigtM
+0000bb50: 6f64 656c 272c 2027 566f 6967 744d 6f64  odel', 'VoigtMod
+0000bb60: 656c 272c 2027 4761 7573 7369 616e 4d6f  el', 'GaussianMo
+0000bb70: 6465 6c27 2c20 274c 6f72 656e 747a 6961  del', 'Lorentzia
+0000bb80: 6e4d 6f64 656c 272c 2065 7463 2e0a 0a20  nModel', etc... 
+0000bb90: 2020 2020 2020 2066 6974 5f70 6561 6b73         fit_peaks
+0000bba0: 2028 696e 7429 3a20 4465 6661 756c 7420   (int): Default 
+0000bbb0: 320a 2020 2020 2020 2020 2020 2020 4e75  2.            Nu
+0000bbc0: 6d62 6572 206f 6620 7065 616b 7320 746f  mber of peaks to
+0000bbd0: 2066 6974 2e20 3220 3d20 4469 6164 202b   fit. 2 = Diad +
+0000bbe0: 2048 422c 2031 203d 2044 6961 642e 0a0a   HB, 1 = Diad...
+0000bbf0: 2020 2020 2020 2020 4e5f 706f 6c79 5f62          N_poly_b
+0000bc00: 636b 5f64 6961 6431 2028 666c 6f61 7429  ck_diad1 (float)
+0000bc10: 3a20 4465 6661 756c 7420 3d20 310a 2020  : Default = 1.  
+0000bc20: 2020 2020 2020 2020 2020 4465 6772 6565            Degree
+0000bc30: 206f 6620 706f 6c79 6e6f 6d69 616c 2066   of polynomial f
+0000bc40: 6f72 2062 6163 6b67 726f 756e 6420 7375  or background su
+0000bc50: 6274 7261 6374 696f 6e2e 2044 6566 6175  btraction. Defau
+0000bc60: 6c74 2031 2e0a 0a20 2020 2020 2020 206c  lt 1...        l
+0000bc70: 6f77 6572 5f62 636b 5f64 6961 6431 2028  ower_bck_diad1 (
+0000bc80: 5475 706c 655b 666c 6f61 742c 2066 6c6f  Tuple[float, flo
+0000bc90: 6174 5d29 3a0a 2020 2020 2020 2020 2020  at]):.          
+0000bca0: 2020 4c6f 7765 7220 626f 756e 6461 7279    Lower boundary
+0000bcb0: 2066 6f72 2062 6163 6b67 726f 756e 6420   for background 
+0000bcc0: 6669 7474 696e 6720 696e 2063 6d2d 312e  fitting in cm-1.
+0000bcd0: 2044 6566 6175 6c74 2028 3131 3830 2c20   Default (1180, 
+0000bce0: 3132 3230 290a 0a20 2020 2020 2020 2075  1220)..        u
+0000bcf0: 7070 6572 5f62 636b 5f64 6961 6431 2028  pper_bck_diad1 (
+0000bd00: 5475 706c 655b 666c 6f61 742c 2066 6c6f  Tuple[float, flo
+0000bd10: 6174 5d29 3a0a 2020 2020 2020 2020 2020  at]):.          
+0000bd20: 2020 5570 7065 7220 626f 756e 6461 7279    Upper boundary
+0000bd30: 2066 6f72 2062 6163 6b67 726f 756e 6420   for background 
+0000bd40: 6669 7474 696e 6720 696e 2063 6d2d 3120  fitting in cm-1 
+0000bd50: 4465 6661 756c 7420 2831 3330 302c 2031  Default (1300, 1
+0000bd60: 3335 3029 2e0a 0a20 2020 2020 2020 2066  350)...        f
+0000bd70: 6974 5f67 6175 7373 2028 4f70 7469 6f6e  it_gauss (Option
+0000bd80: 616c 5b62 6f6f 6c5d 293a 2044 6566 6175  al[bool]): Defau
+0000bd90: 6c74 2054 7275 650a 2020 2020 2020 2020  lt True.        
+0000bda0: 2020 2020 4669 7420 6120 4761 7573 7369      Fit a Gaussi
+0000bdb0: 616e 2070 6561 6b20 6966 2054 7275 652e  an peak if True.
+0000bdc0: 2048 656c 7066 756c 2066 6f72 2076 6572   Helpful for ver
+0000bdd0: 7920 656c 6576 6174 6564 2073 7065 6374  y elevated spect
+0000bde0: 7261 0a0a 2020 2020 2020 2020 6761 7573  ra..        gaus
+0000bdf0: 735f 616d 7020 284f 7074 696f 6e61 6c5b  s_amp (Optional[
+0000be00: 666c 6f61 745d 293a 2020 4465 6661 756c  float]):  Defaul
+0000be10: 7420 3d20 3130 3030 0a20 2020 2020 2020  t = 1000.       
+0000be20: 2020 2020 2047 6175 7373 6961 6e20 7065       Gaussian pe
+0000be30: 616b 2061 6d70 6c69 7475 6465 2069 6620  ak amplitude if 
+0000be40: 6066 6974 5f67 6175 7373 6020 6973 2054  `fit_gauss` is T
+0000be50: 7275 652e 2044 6566 6175 6c74 2031 3030  rue. Default 100
+0000be60: 302e 0a20 2020 2020 2020 2020 2020 2057  0..            W
+0000be70: 6520 6669 6e64 2032 5820 4842 2069 6e74  e find 2X HB int
+0000be80: 656e 7369 7479 2069 7320 6120 676f 6f64  ensity is a good
+0000be90: 2067 7565 7373 206f 6e20 6d61 6e79 2069   guess on many i
+0000bea0: 6e73 7472 756d 656e 7473 0a0a 2020 2020  nstruments..    
+0000beb0: 2020 2020 6469 6164 5f73 6967 6d61 2028      diad_sigma (
+0000bec0: 666c 6f61 7429 3a20 4465 6661 756c 7420  float): Default 
+0000bed0: 3d20 302e 320a 2020 2020 2020 2020 2020  = 0.2.          
+0000bee0: 2020 5369 676d 6120 6f66 2064 6961 6420    Sigma of diad 
+0000bef0: 7065 616b 2e0a 0a20 2020 2020 2020 2064  peak...        d
+0000bf00: 6961 645f 7369 676d 615f 6d69 6e5f 616c  iad_sigma_min_al
+0000bf10: 6c6f 7761 6e63 6520 2866 6c6f 6174 293a  lowance (float):
+0000bf20: 2044 6566 6175 6c74 203d 2030 2e32 0a20   Default = 0.2. 
+0000bf30: 2020 2020 2020 2020 2020 2054 6f6c 6572             Toler
+0000bf40: 616e 6365 206f 6e20 656e 7465 7265 6420  ance on entered 
+0000bf50: 7369 676d 612e 204d 6561 6e73 206d 696e  sigma. Means min
+0000bf60: 696d 756d 2061 6c6c 6f77 6564 2073 6967  imum allowed sig
+0000bf70: 6d61 2069 7320 302e 322a 7369 676d 610a  ma is 0.2*sigma.
+0000bf80: 0a20 2020 2020 2020 2064 6961 645f 7369  .        diad_si
+0000bf90: 676d 615f 6d61 785f 616c 6c6f 7761 6e63  gma_max_allowanc
+0000bfa0: 6520 2866 6c6f 6174 293a 2044 6566 6175  e (float): Defau
+0000bfb0: 6c74 203d 2035 0a20 2020 2020 2020 2020  lt = 5.         
+0000bfc0: 2020 2054 6f6c 6572 616e 6365 206f 6e20     Tolerance on 
+0000bfd0: 656e 7465 7265 6420 7369 676d 612e 204d  entered sigma. M
+0000bfe0: 6561 6e73 206d 696e 696d 756d 2061 6c6c  eans minimum all
+0000bff0: 6f77 6564 2073 6967 6d61 2069 7320 352a  owed sigma is 5*
+0000c000: 7369 676d 610a 0a0a 2020 2020 2020 2020  sigma...        
+0000c010: 6469 6164 5f70 726f 6d20 2866 6c6f 6174  diad_prom (float
+0000c020: 293a 2044 6566 6175 6c74 203d 2031 3030  ): Default = 100
+0000c030: 0a20 2020 2020 2020 2020 2020 2050 6561  .            Pea
+0000c040: 6b20 616d 706c 6974 7564 6520 666f 7220  k amplitude for 
+0000c050: 6f66 2074 6865 2064 6961 642e 2053 7567  of the diad. Sug
+0000c060: 6765 7374 2075 7365 7273 206f 6274 6169  gest users obtai
+0000c070: 6e20 6672 6f6d 2074 6865 2065 7374 696d  n from the estim
+0000c080: 6174 6564 2070 6561 6b20 7061 7261 6d65  ated peak parame
+0000c090: 7465 7220 6461 7461 6672 616d 650a 0a20  ter dataframe.. 
+0000c0a0: 2020 2020 2020 2048 425f 7072 6f6d 2028         HB_prom (
+0000c0b0: 666c 6f61 7429 3a20 2044 6566 6175 6c74  float):  Default
+0000c0c0: 203d 2032 300a 2020 2020 2020 2020 2020   = 20.          
+0000c0d0: 2020 5065 616b 2061 6d70 6c69 7475 6465    Peak amplitude
+0000c0e0: 2066 6f72 2048 422e 2053 7567 6765 7374   for HB. Suggest
+0000c0f0: 2075 7365 7273 206f 6274 6169 6e20 6672   users obtain fr
+0000c100: 6f6d 2074 6865 2065 7374 696d 6174 6564  om the estimated
+0000c110: 2070 6561 6b20 7061 7261 6d65 7465 7220   peak parameter 
+0000c120: 6461 7461 6672 616d 650a 0a20 2020 2020  dataframe..     
+0000c130: 2020 2048 425f 7369 676d 615f 6d69 6e5f     HB_sigma_min_
+0000c140: 616c 6c6f 7761 6e63 6520 2866 6c6f 6174  allowance (float
+0000c150: 293a 2044 6566 6175 6c74 203d 2030 2e30  ): Default = 0.0
+0000c160: 350a 2020 2020 2020 2020 2020 2020 4d65  5.            Me
+0000c170: 616e 7320 4842 2073 6967 6d61 2063 616e  ans HB sigma can
+0000c180: 7420 6265 206c 6573 7320 7468 616e 2030  t be less than 0
+0000c190: 2e30 352a 2073 6967 6d61 206f 6620 6669  .05* sigma of fi
+0000c1a0: 7273 7420 6669 7474 696e 6720 7065 616b  rst fitting peak
+0000c1b0: 2028 6469 6164 292e 0a0a 2020 2020 2020   (diad)...      
+0000c1c0: 2020 4842 5f73 6967 6d61 5f6d 6178 5f61    HB_sigma_max_a
+0000c1d0: 6c6c 6f77 616e 6365 2028 666c 6f61 7429  llowance (float)
+0000c1e0: 3a20 4465 6661 756c 7420 3d20 333a 0a20  : Default = 3:. 
+0000c1f0: 2020 2020 2020 2020 2020 204d 6561 6e73             Means
+0000c200: 2048 4220 7369 676d 6120 6361 6e74 2065   HB sigma cant e
+0000c210: 7863 6565 6420 332a 2073 6967 6d61 206f  xceed 3* sigma o
+0000c220: 6620 6669 7273 7420 6669 7474 696e 6720  f first fitting 
+0000c230: 7065 616b 2028 6469 6164 290a 0a20 2020  peak (diad)..   
+0000c240: 2020 2020 2048 425f 616d 705f 6d69 6e5f       HB_amp_min_
+0000c250: 616c 6c6f 7761 6e63 6520 2866 6c6f 6174  allowance (float
+0000c260: 293a 2044 6566 6175 6c74 203d 302e 3031  ): Default =0.01
+0000c270: 0a20 2020 2020 2020 2020 2020 204d 6561  .            Mea
+0000c280: 6e73 2048 4220 616d 706c 6974 7564 6520  ns HB amplitude 
+0000c290: 6361 6e74 2062 6520 6c65 7373 2074 6861  cant be less tha
+0000c2a0: 6e20 302e 3031 2a61 6d70 6c69 7475 6465  n 0.01*amplitude
+0000c2b0: 206f 6620 6669 7273 7420 6669 7474 6564   of first fitted
+0000c2c0: 2070 6561 6b20 2864 6961 6429 2e0a 0a20   peak (diad)... 
+0000c2d0: 2020 2020 2020 2048 425f 616d 705f 6d61         HB_amp_ma
+0000c2e0: 785f 616c 6c6f 7761 6e63 6520 2866 6c6f  x_allowance (flo
+0000c2f0: 6174 293a 2044 6566 6175 6c74 203d 2031  at): Default = 1
+0000c300: 0a20 2020 2020 2020 2020 2020 204d 6561  .            Mea
+0000c310: 6e73 2048 4220 616d 706c 6974 7564 6520  ns HB amplitude 
+0000c320: 6361 6e74 2062 6520 6d6f 7265 2074 6861  cant be more tha
+0000c330: 6e20 312a 616d 706c 6974 7564 6520 6f66  n 1*amplitude of
+0000c340: 2066 6972 7374 2066 6974 7465 6420 7065   first fitted pe
+0000c350: 616b 2028 6469 6164 292e 0a0a 2020 2020  ak (diad)...    
+0000c360: 2020 2020 785f 7261 6e67 655f 6261 7365      x_range_base
+0000c370: 6c69 6e65 2028 666c 6f61 7429 3a20 4465  line (float): De
+0000c380: 6661 756c 7420 3735 2e0a 2020 2020 2020  fault 75..      
+0000c390: 2020 2020 2020 4d65 616e 7320 7468 6174        Means that
+0000c3a0: 2078 2061 7869 7320 6f66 2062 6173 656c   x axis of basel
+0000c3b0: 696e 6520 7368 6f77 7320 6469 6164 2070  ine shows diad p
+0000c3c0: 6f73 6974 696f 6e20 2b2d 2037 3520 7820  osition +- 75 x 
+0000c3d0: 756e 6974 732e 0a0a 2020 2020 2020 2020  units...        
+0000c3e0: 795f 7261 6e67 655f 6261 7365 6c69 6e65  y_range_baseline
+0000c3f0: 2028 666c 6f61 7429 3a20 592d 6178 6973   (float): Y-axis
+0000c400: 2072 616e 6765 2066 6f72 2062 6173 656c   range for basel
+0000c410: 696e 6520 6469 7370 6c61 792e 2044 6566  ine display. Def
+0000c420: 6175 6c74 2031 3030 2e0a 2020 2020 2020  ault 100..      
+0000c430: 2020 2020 2020 5368 6f77 7320 6120 7920        Shows a y 
+0000c440: 6178 6973 2073 6361 6c65 2074 6861 7420  axis scale that 
+0000c450: 6973 2031 3030 2079 2075 6e69 7473 2061  is 100 y units a
+0000c460: 626f 7665 2074 6865 206d 696e 696d 756d  bove the minimum
+0000c470: 2062 6173 656c 696e 6520 7661 6c75 652c   baseline value,
+0000c480: 2061 6e64 2031 3030 2075 6e69 7473 2061   and 100 units a
+0000c490: 626f 7665 2074 6865 206d 6178 696d 756d  bove the maximum
+0000c4a0: 2076 616c 7565 0a0a 2020 2020 2020 2020   value..        
+0000c4b0: 6470 6920 2866 6c6f 6174 293a 2044 6566  dpi (float): Def
+0000c4c0: 6175 6c74 2032 3030 0a20 2020 2020 2020  ault 200.       
+0000c4d0: 2020 2020 2046 6967 7572 6520 7265 736f       Figure reso
+0000c4e0: 6c75 7469 6f6e 2069 6e20 646f 7473 2070  lution in dots p
+0000c4f0: 6572 2069 6e63 682e 2044 6566 6175 6c74  er inch. Default
+0000c500: 2032 3030 2e0a 0a20 2020 2020 2020 2078   200...        x
+0000c510: 5f72 616e 6765 5f72 6573 6964 7561 6c20  _range_residual 
+0000c520: 2866 6c6f 6174 293a 2020 4465 6661 756c  (float):  Defaul
+0000c530: 7420 3230 2e0a 2020 2020 2020 2020 2020  t 20..          
+0000c540: 2020 5368 6f77 7320 7820 7661 6c75 6573    Shows x values
+0000c550: 202b 2d32 3020 6569 7468 6572 2073 6964   +-20 either sid
+0000c560: 6520 6f66 2074 6865 2064 6961 6420 7065  e of the diad pe
+0000c570: 616b 2070 6f73 6974 696f 6e20 696e 2074  ak position in t
+0000c580: 6865 2072 6573 6964 7561 6c20 706c 6f74  he residual plot
+0000c590: 2e0a 0a20 2020 2020 2020 2072 6574 7572  ...        retur
+0000c5a0: 6e5f 6f74 6865 725f 7061 7261 6d73 2028  n_other_params (
+0000c5b0: 626f 6f6c 293a 2052 6574 7572 6e20 6e6f  bool): Return no
+0000c5c0: 6e2d 6669 7474 6564 2070 6172 616d 6574  n-fitted paramet
+0000c5d0: 6572 7320 6966 2054 7275 652e 2044 6566  ers if True. Def
+0000c5e0: 6175 6c74 2046 616c 7365 2e0a 0a20 2020  ault False...   
+0000c5f0: 204d 6574 686f 6473 3a0a 2020 2020 2020   Methods:.      
+0000c600: 2020 7570 6461 7465 5f70 6172 282a 2a6b    update_par(**k
+0000c610: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+0000c620: 2020 2020 5570 6461 7465 7320 636f 6e66      Updates conf
+0000c630: 6967 7572 6174 696f 6e20 7061 7261 6d65  iguration parame
+0000c640: 7465 7273 2e20 5261 6973 6573 2041 7474  ters. Raises Att
+0000c650: 7269 6275 7465 4572 726f 7220 666f 7220  ributeError for 
+0000c660: 756e 6b6e 6f77 6e20 6174 7472 6962 7574  unknown attribut
+0000c670: 6573 2e0a 0a20 2020 2022 2222 0a20 2020  es...    """.   
+0000c680: 2023 2057 6861 7420 6d6f 6465 6c20 746f   # What model to
+0000c690: 2075 7365 0a20 2020 206d 6f64 656c 5f6e   use.    model_n
+0000c6a0: 616d 653a 2073 7472 203d 2027 5073 6575  ame: str = 'Pseu
+0000c6b0: 646f 566f 6967 744d 6f64 656c 270a 2020  doVoigtModel'.  
+0000c6c0: 2020 6669 745f 7065 616b 733a 696e 7420    fit_peaks:int 
+0000c6d0: 3d20 320a 0a20 2020 2023 2044 6567 7265  = 2..    # Degre
+0000c6e0: 6520 6f66 2070 6f6c 796e 6f6d 6961 6c20  e of polynomial 
+0000c6f0: 746f 2075 7365 0a20 2020 204e 5f70 6f6c  to use.    N_pol
+0000c700: 795f 6263 6b5f 6469 6164 313a 2066 6c6f  y_bck_diad1: flo
+0000c710: 6174 203d 310a 0a20 2020 2023 2042 6163  at =1..    # Bac
+0000c720: 6b67 726f 756e 642f 6261 7365 6c69 6e65  kground/baseline
+0000c730: 2070 6f73 6974 696f 6e73 0a20 2020 206c   positions.    l
+0000c740: 6f77 6572 5f62 636b 5f64 6961 6431 3a20  ower_bck_diad1: 
+0000c750: 5475 706c 655b 666c 6f61 742c 2066 6c6f  Tuple[float, flo
+0000c760: 6174 5d3d 2831 3138 302c 2031 3232 3029  at]=(1180, 1220)
+0000c770: 0a20 2020 2075 7070 6572 5f62 636b 5f64  .    upper_bck_d
+0000c780: 6961 6431 3a20 5475 706c 655b 666c 6f61  iad1: Tuple[floa
+0000c790: 742c 2066 6c6f 6174 5d3d 2831 3330 302c  t, float]=(1300,
+0000c7a0: 2031 3335 3029 0a0a 2020 2020 2320 446f   1350)..    # Do
+0000c7b0: 2079 6f75 206e 6565 6420 6120 6761 7573   you need a gaus
+0000c7c0: 7369 616e 3f20 5365 7420 706f 7369 7469  sian? Set positi
+0000c7d0: 6f6e 2068 6572 6520 6966 2073 6f0a 2020  on here if so.  
+0000c7e0: 2020 6669 745f 6761 7573 733a 204f 7074    fit_gauss: Opt
+0000c7f0: 696f 6e61 6c20 5b62 6f6f 6c5d 203d 4661  ional [bool] =Fa
+0000c800: 6c73 650a 2020 2020 6761 7573 735f 616d  lse.    gauss_am
+0000c810: 703a 204f 7074 696f 6e61 6c20 5b66 6c6f  p: Optional [flo
+0000c820: 6174 5d3d 3130 3030 0a0a 2020 2020 6469  at]=1000..    di
+0000c830: 6164 5f73 6967 6d61 3a20 666c 6f61 743d  ad_sigma: float=
+0000c840: 302e 320a 2020 2020 6469 6164 5f73 6967  0.2.    diad_sig
+0000c850: 6d61 5f6d 696e 5f61 6c6c 6f77 616e 6365  ma_min_allowance
+0000c860: 3a20 666c 6f61 743d 302e 320a 2020 2020  : float=0.2.    
+0000c870: 6469 6164 5f73 6967 6d61 5f6d 6178 5f61  diad_sigma_max_a
+0000c880: 6c6c 6f77 616e 6365 3a20 666c 6f61 743d  llowance: float=
+0000c890: 350a 0a0a 0a0a 2020 2020 2320 5065 616b  5.....    # Peak
+0000c8a0: 2061 6d70 6c69 7475 6465 0a20 2020 2064   amplitude.    d
+0000c8b0: 6961 645f 7072 6f6d 3a20 666c 6f61 7420  iad_prom: float 
+0000c8c0: 3d20 3130 300a 2020 2020 4842 5f70 726f  = 100.    HB_pro
+0000c8d0: 6d3a 2066 6c6f 6174 203d 2032 300a 2020  m: float = 20.  
+0000c8e0: 2020 4842 5f73 6967 6d61 5f6d 696e 5f61    HB_sigma_min_a
+0000c8f0: 6c6c 6f77 616e 6365 3d30 2e30 350a 2020  llowance=0.05.  
+0000c900: 2020 4842 5f73 6967 6d61 5f6d 6178 5f61    HB_sigma_max_a
+0000c910: 6c6c 6f77 616e 6365 3d33 0a20 2020 2048  llowance=3.    H
+0000c920: 425f 616d 705f 6d69 6e5f 616c 6c6f 7761  B_amp_min_allowa
+0000c930: 6e63 653d 302e 3031 0a20 2020 2048 425f  nce=0.01.    HB_
+0000c940: 616d 705f 6d61 785f 616c 6c6f 7761 6e63  amp_max_allowanc
+0000c950: 653d 310a 2020 2020 2320 486f 7720 6d75  e=1.    # How mu
+0000c960: 6368 2074 6f20 7368 6f77 206f 6e20 7820  ch to show on x 
+0000c970: 616e 7820 7920 6178 6973 206f 6620 6669  anx y axis of fi
+0000c980: 6775 7265 2073 686f 7769 6e67 2062 6163  gure showing bac
+0000c990: 6b67 726f 756e 640a 2020 2020 785f 7261  kground.    x_ra
+0000c9a0: 6e67 655f 6261 7365 6c69 6e65 3a20 666c  nge_baseline: fl
+0000c9b0: 6f61 743d 3735 0a20 2020 2079 5f72 616e  oat=75.    y_ran
+0000c9c0: 6765 5f62 6173 656c 696e 653a 2066 6c6f  ge_baseline: flo
+0000c9d0: 6174 3d31 3030 0a0a 2020 2020 2344 6f20  at=100..    #Do 
+0000c9e0: 796f 7520 7761 6e74 2074 6f20 7361 7665  you want to save
+0000c9f0: 2074 6865 2066 6967 7572 653f 0a0a 0a20   the figure?... 
+0000ca00: 2020 2064 7069 3a20 666c 6f61 7420 3d20     dpi: float = 
+0000ca10: 3230 300a 2020 2020 785f 7261 6e67 655f  200.    x_range_
+0000ca20: 7265 7369 6475 616c 3a20 666c 6f61 743d  residual: float=
+0000ca30: 3230 0a0a 2020 2020 2320 446f 2079 6f75  20..    # Do you
+0000ca40: 2077 616e 7420 746f 2072 6574 7572 6e20   want to return 
+0000ca50: 6f74 6865 7220 7061 7261 6d65 7465 7273  other parameters
+0000ca60: 3f0a 2020 2020 7265 7475 726e 5f6f 7468  ?.    return_oth
+0000ca70: 6572 5f70 6172 616d 733a 2062 6f6f 6c20  er_params: bool 
+0000ca80: 3d46 616c 7365 0a0a 2020 2020 6465 6620  =False..    def 
+0000ca90: 7570 6461 7465 5f70 6172 2873 656c 662c  update_par(self,
+0000caa0: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+0000cab0: 2020 2020 666f 7220 6b65 792c 2076 616c      for key, val
+0000cac0: 7565 2069 6e20 6b77 6172 6773 2e69 7465  ue in kwargs.ite
+0000cad0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+0000cae0: 2020 6966 2068 6173 6174 7472 2873 656c    if hasattr(sel
+0000caf0: 662c 206b 6579 293a 0a20 2020 2020 2020  f, key):.       
+0000cb00: 2020 2020 2020 2020 2073 6574 6174 7472           setattr
+0000cb10: 2873 656c 662c 206b 6579 2c20 7661 6c75  (self, key, valu
+0000cb20: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
+0000cb30: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000cb40: 2020 2020 2072 6169 7365 2041 7474 7269       raise Attri
+0000cb50: 6275 7465 4572 726f 7228 6622 2764 6961  buteError(f"'dia
+0000cb60: 6431 5f66 6974 5f63 6f6e 6669 6727 206f  d1_fit_config' o
+0000cb70: 626a 6563 7420 6861 7320 6e6f 2061 7474  bject has no att
+0000cb80: 7269 6275 7465 2027 7b6b 6579 7d27 2229  ribute '{key}'")
+0000cb90: 0a0a 0a0a 0a40 6461 7461 636c 6173 730a  .....@dataclass.
+0000cba0: 636c 6173 7320 6469 6164 325f 6669 745f  class diad2_fit_
+0000cbb0: 636f 6e66 6967 3a0a 0a20 2020 2022 2222  config:..    """
+0000cbc0: 0a20 2020 2043 6f6e 6669 6775 7261 7469  .    Configurati
+0000cbd0: 6f6e 2063 6c61 7373 2066 6f72 2066 6974  on class for fit
+0000cbe0: 7469 6e67 2044 6961 6420 320a 0a20 2020  ting Diad 2..   
+0000cbf0: 2054 6869 7320 636c 6173 7320 7374 6f72   This class stor
+0000cc00: 6573 2063 6f6e 6669 6775 7261 7469 6f6e  es configuration
+0000cc10: 2070 6172 616d 6574 6572 7320 666f 7220   parameters for 
+0000cc20: 6669 7474 696e 6720 4469 6164 2032 2061  fitting Diad 2 a
+0000cc30: 6e64 2061 7373 6f63 6961 7465 6420 7065  nd associated pe
+0000cc40: 616b 732e 0a20 2020 2054 6865 2063 6c61  aks..    The cla
+0000cc50: 7373 2061 6c6c 6f77 7320 666f 7220 6561  ss allows for ea
+0000cc60: 7379 2063 7573 746f 6d69 7a61 7469 6f6e  sy customization
+0000cc70: 206f 6620 7468 6520 6669 7474 696e 6720   of the fitting 
+0000cc80: 7072 6f63 6573 732e 0a0a 2020 2020 4174  process...    At
+0000cc90: 7472 6962 7574 6573 3a0a 2020 2020 2020  tributes:.      
+0000cca0: 2020 6d6f 6465 6c5f 6e61 6d65 2028 7374    model_name (st
+0000ccb0: 7229 3a20 4465 6661 756c 7420 2750 7365  r): Default 'Pse
+0000ccc0: 7564 6f56 6f69 6774 4d6f 6465 6c27 2e0a  udoVoigtModel'..
+0000ccd0: 2020 2020 2020 2020 2020 2020 4d6f 6465              Mode
+0000cce0: 6c20 6e61 6d65 2066 6f72 2070 6561 6b20  l name for peak 
+0000ccf0: 6669 7474 696e 672e 2043 686f 6f73 6520  fitting. Choose 
+0000cd00: 6672 6f6d 0a20 2020 2020 2020 2020 2020  from.           
+0000cd10: 2027 5073 6575 646f 566f 6967 744d 6f64   'PseudoVoigtMod
+0000cd20: 656c 272c 2027 566f 6967 744d 6f64 656c  el', 'VoigtModel
+0000cd30: 272c 2027 4761 7573 7369 616e 4d6f 6465  ', 'GaussianMode
+0000cd40: 6c27 2c20 274c 6f72 656e 747a 6961 6e4d  l', 'LorentzianM
+0000cd50: 6f64 656c 272c 2065 7463 2e0a 0a20 2020  odel', etc...   
+0000cd60: 2020 2020 2066 6974 5f70 6561 6b73 2028       fit_peaks (
+0000cd70: 696e 7429 3a20 4465 6661 756c 7420 320a  int): Default 2.
+0000cd80: 2020 2020 2020 2020 2020 2020 4e75 6d62              Numb
+0000cd90: 6572 206f 6620 7065 616b 7320 746f 2066  er of peaks to f
+0000cda0: 6974 2e20 3320 3d20 4842 202b 2044 6961  it. 3 = HB + Dia
+0000cdb0: 6420 2b20 4331 332c 2032 203d 2044 6961  d + C13, 2 = Dia
+0000cdc0: 6420 2b20 4842 2c20 3120 3d20 4469 6164  d + HB, 1 = Diad
+0000cdd0: 2e0a 0a20 2020 2020 2020 204e 5f70 6f6c  ...        N_pol
+0000cde0: 795f 6263 6b5f 6469 6164 3220 2866 6c6f  y_bck_diad2 (flo
+0000cdf0: 6174 293a 2044 6566 6175 6c74 203d 2031  at): Default = 1
+0000ce00: 0a20 2020 2020 2020 2020 2020 2044 6567  .            Deg
+0000ce10: 7265 6520 6f66 2070 6f6c 796e 6f6d 6961  ree of polynomia
+0000ce20: 6c20 666f 7220 6261 636b 6772 6f75 6e64  l for background
+0000ce30: 2073 7562 7472 6163 7469 6f6e 2e20 4465   subtraction. De
+0000ce40: 6661 756c 7420 312e 0a0a 2020 2020 2020  fault 1...      
+0000ce50: 2020 6c6f 7765 725f 6263 6b5f 6469 6164    lower_bck_diad
+0000ce60: 3220 2854 7570 6c65 5b66 6c6f 6174 2c20  2 (Tuple[float, 
+0000ce70: 666c 6f61 745d 293a 0a20 2020 2020 2020  float]):.       
+0000ce80: 2020 2020 204c 6f77 6572 2062 6f75 6e64       Lower bound
+0000ce90: 6172 7920 666f 7220 6261 636b 6772 6f75  ary for backgrou
+0000cea0: 6e64 2066 6974 7469 6e67 2069 6e20 636d  nd fitting in cm
+0000ceb0: 2d31 2e20 4465 6661 756c 7420 2831 3330  -1. Default (130
+0000cec0: 302c 2031 3336 3029 0a0a 2020 2020 2020  0, 1360)..      
+0000ced0: 2020 7570 7065 725f 6263 6b5f 6469 6164    upper_bck_diad
+0000cee0: 3220 2854 7570 6c65 5b66 6c6f 6174 2c20  2 (Tuple[float, 
+0000cef0: 666c 6f61 745d 293a 0a20 2020 2020 2020  float]):.       
+0000cf00: 2020 2020 2055 7070 6572 2062 6f75 6e64       Upper bound
+0000cf10: 6172 7920 666f 7220 6261 636b 6772 6f75  ary for backgrou
+0000cf20: 6e64 2066 6974 7469 6e67 2069 6e20 636d  nd fitting in cm
+0000cf30: 2d31 2044 6566 6175 6c74 2028 3134 3430  -1 Default (1440
+0000cf40: 2c20 3134 3730 290a 0a20 2020 2020 2020  , 1470)..       
+0000cf50: 2066 6974 5f67 6175 7373 2028 4f70 7469   fit_gauss (Opti
+0000cf60: 6f6e 616c 5b62 6f6f 6c5d 293a 2044 6566  onal[bool]): Def
+0000cf70: 6175 6c74 2054 7275 650a 2020 2020 2020  ault True.      
+0000cf80: 2020 2020 2020 4669 7420 6120 4761 7573        Fit a Gaus
+0000cf90: 7369 616e 2070 6561 6b20 6966 2054 7275  sian peak if Tru
+0000cfa0: 652e 2048 656c 7066 756c 2066 6f72 2076  e. Helpful for v
+0000cfb0: 6572 7920 656c 6576 6174 6564 2073 7065  ery elevated spe
+0000cfc0: 6374 7261 0a0a 2020 2020 2020 2020 6761  ctra..        ga
+0000cfd0: 7573 735f 616d 7020 284f 7074 696f 6e61  uss_amp (Optiona
+0000cfe0: 6c5b 666c 6f61 745d 293a 2020 4465 6661  l[float]):  Defa
+0000cff0: 756c 7420 3d20 3130 3030 0a20 2020 2020  ult = 1000.     
+0000d000: 2020 2020 2020 2047 6175 7373 6961 6e20         Gaussian 
+0000d010: 7065 616b 2061 6d70 6c69 7475 6465 2069  peak amplitude i
+0000d020: 6620 6066 6974 5f67 6175 7373 6020 6973  f `fit_gauss` is
+0000d030: 2054 7275 652e 2044 6566 6175 6c74 2031   True. Default 1
+0000d040: 3030 302e 0a20 2020 2020 2020 2020 2020  000..           
+0000d050: 2057 6520 6669 6e64 2032 5820 4842 2069   We find 2X HB i
+0000d060: 6e74 656e 7369 7479 2069 7320 6120 676f  ntensity is a go
+0000d070: 6f64 2067 7565 7373 206f 6e20 6d61 6e79  od guess on many
+0000d080: 2069 6e73 7472 756d 656e 7473 0a0a 2020   instruments..  
+0000d090: 2020 2020 2020 6469 6164 5f73 6967 6d61        diad_sigma
+0000d0a0: 2028 666c 6f61 7429 3a20 4465 6661 756c   (float): Defaul
+0000d0b0: 7420 3d20 302e 320a 2020 2020 2020 2020  t = 0.2.        
+0000d0c0: 2020 2020 5369 676d 6120 6f66 2064 6961      Sigma of dia
+0000d0d0: 6420 7065 616b 2e0a 0a20 2020 2020 2020  d peak...       
+0000d0e0: 2064 6961 645f 7369 676d 615f 6d69 6e5f   diad_sigma_min_
+0000d0f0: 616c 6c6f 7761 6e63 6520 2866 6c6f 6174  allowance (float
+0000d100: 293a 2044 6566 6175 6c74 203d 2030 2e32  ): Default = 0.2
+0000d110: 0a20 2020 2020 2020 2020 2020 2054 6f6c  .            Tol
+0000d120: 6572 616e 6365 206f 6e20 656e 7465 7265  erance on entere
+0000d130: 6420 7369 676d 612e 204d 6561 6e73 206d  d sigma. Means m
+0000d140: 696e 696d 756d 2061 6c6c 6f77 6564 2073  inimum allowed s
+0000d150: 6967 6d61 2069 7320 302e 322a 7369 676d  igma is 0.2*sigm
+0000d160: 610a 0a20 2020 2020 2020 2064 6961 645f  a..        diad_
+0000d170: 7369 676d 615f 6d61 785f 616c 6c6f 7761  sigma_max_allowa
+0000d180: 6e63 6520 2866 6c6f 6174 293a 2044 6566  nce (float): Def
+0000d190: 6175 6c74 203d 2035 0a20 2020 2020 2020  ault = 5.       
+0000d1a0: 2020 2020 2054 6f6c 6572 616e 6365 206f       Tolerance o
+0000d1b0: 6e20 656e 7465 7265 6420 7369 676d 612e  n entered sigma.
+0000d1c0: 204d 6561 6e73 206d 696e 696d 756d 2061   Means minimum a
+0000d1d0: 6c6c 6f77 6564 2073 6967 6d61 2069 7320  llowed sigma is 
+0000d1e0: 352a 7369 676d 610a 0a0a 2020 2020 2020  5*sigma...      
+0000d1f0: 2020 6469 6164 5f70 726f 6d20 2866 6c6f    diad_prom (flo
+0000d200: 6174 293a 2044 6566 6175 6c74 203d 2031  at): Default = 1
+0000d210: 3030 0a20 2020 2020 2020 2020 2020 2050  00.            P
+0000d220: 6561 6b20 616d 706c 6974 7564 6520 666f  eak amplitude fo
+0000d230: 7220 6f66 2074 6865 2064 6961 642e 2053  r of the diad. S
+0000d240: 7567 6765 7374 2075 7365 7273 206f 6274  uggest users obt
+0000d250: 6169 6e20 6672 6f6d 2074 6865 2065 7374  ain from the est
+0000d260: 696d 6174 6564 2070 6561 6b20 7061 7261  imated peak para
+0000d270: 6d65 7465 7220 6461 7461 6672 616d 650a  meter dataframe.
+0000d280: 0a20 2020 2020 2020 2048 425f 7072 6f6d  .        HB_prom
+0000d290: 2028 666c 6f61 7429 3a20 2044 6566 6175   (float):  Defau
+0000d2a0: 6c74 203d 2032 300a 2020 2020 2020 2020  lt = 20.        
+0000d2b0: 2020 2020 5065 616b 2061 6d70 6c69 7475      Peak amplitu
+0000d2c0: 6465 2066 6f72 2048 422e 2053 7567 6765  de for HB. Sugge
+0000d2d0: 7374 2075 7365 7273 206f 6274 6169 6e20  st users obtain 
+0000d2e0: 6672 6f6d 2074 6865 2065 7374 696d 6174  from the estimat
+0000d2f0: 6564 2070 6561 6b20 7061 7261 6d65 7465  ed peak paramete
+0000d300: 7220 6461 7461 6672 616d 650a 0a20 2020  r dataframe..   
+0000d310: 2020 2020 2043 3133 5f70 726f 6d20 2866       C13_prom (f
+0000d320: 6c6f 6174 293a 2020 4465 6661 756c 7420  loat):  Default 
+0000d330: 3d20 3130 0a20 2020 2020 2020 2020 2020  = 10.           
+0000d340: 2050 6561 6b20 616d 706c 6974 7564 6520   Peak amplitude 
+0000d350: 666f 7220 4331 332e 2053 7567 6765 7374  for C13. Suggest
+0000d360: 2075 7365 7273 206f 6274 6169 6e20 6672   users obtain fr
+0000d370: 6f6d 2074 6865 2065 7374 696d 6174 6564  om the estimated
+0000d380: 2070 6561 6b20 7061 7261 6d65 7465 7220   peak parameter 
+0000d390: 6461 7461 6672 616d 650a 0a20 2020 2020  dataframe..     
+0000d3a0: 2020 2048 425f 7369 676d 615f 6d69 6e5f     HB_sigma_min_
+0000d3b0: 616c 6c6f 7761 6e63 6520 2866 6c6f 6174  allowance (float
+0000d3c0: 293a 2044 6566 6175 6c74 203d 2030 2e30  ): Default = 0.0
+0000d3d0: 350a 2020 2020 2020 2020 2020 2020 4d65  5.            Me
+0000d3e0: 616e 7320 4842 2073 6967 6d61 2063 616e  ans HB sigma can
+0000d3f0: 7420 6265 206c 6573 7320 7468 616e 2030  t be less than 0
+0000d400: 2e30 352a 2073 6967 6d61 206f 6620 6669  .05* sigma of fi
+0000d410: 7273 7420 6669 7474 696e 6720 7065 616b  rst fitting peak
+0000d420: 2028 6469 6164 292e 0a0a 2020 2020 2020   (diad)...      
+0000d430: 2020 4842 5f73 6967 6d61 5f6d 6178 5f61    HB_sigma_max_a
+0000d440: 6c6c 6f77 616e 6365 2028 666c 6f61 7429  llowance (float)
+0000d450: 3a20 4465 6661 756c 7420 3d20 333a 0a20  : Default = 3:. 
+0000d460: 2020 2020 2020 2020 2020 204d 6561 6e73             Means
+0000d470: 2048 4220 7369 676d 6120 6361 6e74 2065   HB sigma cant e
+0000d480: 7863 6565 6420 332a 2073 6967 6d61 206f  xceed 3* sigma o
+0000d490: 6620 6669 7273 7420 6669 7474 696e 6720  f first fitting 
+0000d4a0: 7065 616b 2028 6469 6164 290a 0a20 2020  peak (diad)..   
+0000d4b0: 2020 2020 2048 425f 616d 705f 6d69 6e5f       HB_amp_min_
+0000d4c0: 616c 6c6f 7761 6e63 6520 2866 6c6f 6174  allowance (float
+0000d4d0: 293a 2044 6566 6175 6c74 203d 302e 3031  ): Default =0.01
+0000d4e0: 0a20 2020 2020 2020 2020 2020 204d 6561  .            Mea
+0000d4f0: 6e73 2048 4220 616d 706c 6974 7564 6520  ns HB amplitude 
+0000d500: 6361 6e74 2062 6520 6c65 7373 2074 6861  cant be less tha
+0000d510: 6e20 302e 3031 2a61 6d70 6c69 7475 6465  n 0.01*amplitude
+0000d520: 206f 6620 6669 7273 7420 6669 7474 6564   of first fitted
+0000d530: 2070 6561 6b20 2864 6961 6429 2e0a 0a20   peak (diad)... 
+0000d540: 2020 2020 2020 2048 425f 616d 705f 6d61         HB_amp_ma
+0000d550: 785f 616c 6c6f 7761 6e63 6520 2866 6c6f  x_allowance (flo
+0000d560: 6174 293a 2044 6566 6175 6c74 203d 2031  at): Default = 1
+0000d570: 0a20 2020 2020 2020 2020 2020 204d 6561  .            Mea
+0000d580: 6e73 2048 4220 616d 706c 6974 7564 6520  ns HB amplitude 
+0000d590: 6361 6e74 2062 6520 6d6f 7265 2074 6861  cant be more tha
+0000d5a0: 6e20 312a 616d 706c 6974 7564 6520 6f66  n 1*amplitude of
+0000d5b0: 2066 6972 7374 2066 6974 7465 6420 7065   first fitted pe
+0000d5c0: 616b 2028 6469 6164 292e 0a0a 2020 2020  ak (diad)...    
+0000d5d0: 2020 2020 785f 7261 6e67 655f 6261 7365      x_range_base
+0000d5e0: 6c69 6e65 2028 666c 6f61 7429 3a20 4465  line (float): De
+0000d5f0: 6661 756c 7420 3735 2e0a 2020 2020 2020  fault 75..      
+0000d600: 2020 2020 2020 4d65 616e 7320 7468 6174        Means that
+0000d610: 2078 2061 7869 7320 6f66 2062 6173 656c   x axis of basel
+0000d620: 696e 6520 7368 6f77 7320 6469 6164 2070  ine shows diad p
+0000d630: 6f73 6974 696f 6e20 2b2d 2037 3520 7820  osition +- 75 x 
+0000d640: 756e 6974 732e 0a0a 2020 2020 2020 2020  units...        
+0000d650: 795f 7261 6e67 655f 6261 7365 6c69 6e65  y_range_baseline
+0000d660: 2028 666c 6f61 7429 3a20 592d 6178 6973   (float): Y-axis
+0000d670: 2072 616e 6765 2066 6f72 2062 6173 656c   range for basel
+0000d680: 696e 6520 6469 7370 6c61 792e 2044 6566  ine display. Def
+0000d690: 6175 6c74 2031 3030 2e0a 2020 2020 2020  ault 100..      
+0000d6a0: 2020 2020 2020 5368 6f77 7320 6120 7920        Shows a y 
+0000d6b0: 6178 6973 2073 6361 6c65 2074 6861 7420  axis scale that 
+0000d6c0: 6973 2031 3030 2079 2075 6e69 7473 2061  is 100 y units a
+0000d6d0: 626f 7665 2074 6865 206d 696e 696d 756d  bove the minimum
+0000d6e0: 2062 6173 656c 696e 6520 7661 6c75 652c   baseline value,
+0000d6f0: 2061 6e64 2031 3030 2075 6e69 7473 2061   and 100 units a
+0000d700: 626f 7665 2074 6865 206d 6178 696d 756d  bove the maximum
+0000d710: 2076 616c 7565 0a0a 2020 2020 2020 2020   value..        
+0000d720: 6470 6920 2866 6c6f 6174 293a 2044 6566  dpi (float): Def
+0000d730: 6175 6c74 2032 3030 0a20 2020 2020 2020  ault 200.       
+0000d740: 2020 2020 2046 6967 7572 6520 7265 736f       Figure reso
+0000d750: 6c75 7469 6f6e 2069 6e20 646f 7473 2070  lution in dots p
+0000d760: 6572 2069 6e63 682e 2044 6566 6175 6c74  er inch. Default
+0000d770: 2032 3030 2e0a 0a20 2020 2020 2020 2078   200...        x
+0000d780: 5f72 616e 6765 5f72 6573 6964 7561 6c20  _range_residual 
+0000d790: 2866 6c6f 6174 293a 2020 4465 6661 756c  (float):  Defaul
+0000d7a0: 7420 3230 2e0a 2020 2020 2020 2020 2020  t 20..          
+0000d7b0: 2020 5368 6f77 7320 7820 7661 6c75 6573    Shows x values
+0000d7c0: 202b 2d32 3020 6569 7468 6572 2073 6964   +-20 either sid
+0000d7d0: 6520 6f66 2074 6865 2064 6961 6420 7065  e of the diad pe
+0000d7e0: 616b 2070 6f73 6974 696f 6e20 696e 2074  ak position in t
+0000d7f0: 6865 2072 6573 6964 7561 6c20 706c 6f74  he residual plot
+0000d800: 2e0a 0a20 2020 2020 2020 2072 6574 7572  ...        retur
+0000d810: 6e5f 6f74 6865 725f 7061 7261 6d73 2028  n_other_params (
+0000d820: 626f 6f6c 293a 2052 6574 7572 6e20 6e6f  bool): Return no
+0000d830: 6e2d 6669 7474 6564 2070 6172 616d 6574  n-fitted paramet
+0000d840: 6572 7320 6966 2054 7275 652e 2044 6566  ers if True. Def
+0000d850: 6175 6c74 2046 616c 7365 2e0a 0a20 2020  ault False...   
+0000d860: 204d 6574 686f 6473 3a0a 2020 2020 2020   Methods:.      
+0000d870: 2020 7570 6461 7465 5f70 6172 282a 2a6b    update_par(**k
+0000d880: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+0000d890: 2020 2020 5570 6461 7465 7320 636f 6e66      Updates conf
+0000d8a0: 6967 7572 6174 696f 6e20 7061 7261 6d65  iguration parame
+0000d8b0: 7465 7273 2e20 5261 6973 6573 2041 7474  ters. Raises Att
+0000d8c0: 7269 6275 7465 4572 726f 7220 666f 7220  ributeError for 
+0000d8d0: 756e 6b6e 6f77 6e20 6174 7472 6962 7574  unknown attribut
+0000d8e0: 6573 2e0a 0a20 2020 2022 2222 0a0a 2020  es...    """..  
+0000d8f0: 2020 2320 446f 2079 6f75 206e 6565 6420    # Do you need 
+0000d900: 6120 6761 7573 7369 616e 3f20 5365 7420  a gaussian? Set 
+0000d910: 706f 7369 7469 6f6e 2068 6572 6520 6966  position here if
+0000d920: 2073 6f0a 0a20 2020 2023 2057 6861 7420   so..    # What 
+0000d930: 6d6f 6465 6c20 746f 2075 7365 0a20 2020  model to use.   
+0000d940: 206d 6f64 656c 5f6e 616d 653a 2073 7472   model_name: str
+0000d950: 203d 2027 5073 6575 646f 566f 6967 744d   = 'PseudoVoigtM
+0000d960: 6f64 656c 270a 2020 2020 6669 745f 7065  odel'.    fit_pe
+0000d970: 616b 733a 696e 7420 3d20 330a 0a20 2020  aks:int = 3..   
+0000d980: 2023 2044 6567 7265 6520 6f66 2070 6f6c   # Degree of pol
+0000d990: 796e 6f6d 6961 6c20 746f 2075 7365 0a20  ynomial to use. 
+0000d9a0: 2020 204e 5f70 6f6c 795f 6263 6b5f 6469     N_poly_bck_di
+0000d9b0: 6164 323a 2066 6c6f 6174 203d 310a 2020  ad2: float =1.  
+0000d9c0: 2020 2320 5468 7265 7368 6f6c 6420 696e    # Threshold in
+0000d9d0: 7465 736e 6974 790a 2020 2020 7468 7265  tesnity.    thre
+0000d9e0: 7368 6f6c 645f 696e 7465 6e73 6974 793d  shold_intensity=
+0000d9f0: 3530 0a0a 2020 2020 2320 4261 636b 6772  50..    # Backgr
+0000da00: 6f75 6e64 2f62 6173 656c 696e 6520 706f  ound/baseline po
+0000da10: 7369 7469 6f6e 730a 2020 2020 6c6f 7765  sitions.    lowe
+0000da20: 725f 6263 6b5f 6469 6164 323a 2054 7570  r_bck_diad2: Tup
+0000da30: 6c65 5b66 6c6f 6174 2c20 666c 6f61 745d  le[float, float]
+0000da40: 3d28 3133 3030 2c20 3133 3630 290a 2020  =(1300, 1360).  
+0000da50: 2020 7570 7065 725f 6263 6b5f 6469 6164    upper_bck_diad
+0000da60: 323a 2054 7570 6c65 5b66 6c6f 6174 2c20  2: Tuple[float, 
+0000da70: 666c 6f61 745d 3d28 3134 3430 2c20 3134  float]=(1440, 14
+0000da80: 3730 290a 0a0a 2020 2020 6669 745f 6761  70)...    fit_ga
+0000da90: 7573 733a 204f 7074 696f 6e61 6c20 5b62  uss: Optional [b
+0000daa0: 6f6f 6c5d 203d 4661 6c73 650a 2020 2020  ool] =False.    
+0000dab0: 6761 7573 735f 616d 703a 204f 7074 696f  gauss_amp: Optio
+0000dac0: 6e61 6c20 5b66 6c6f 6174 5d3d 3130 3030  nal [float]=1000
+0000dad0: 0a0a 2020 2020 6469 6164 5f73 6967 6d61  ..    diad_sigma
+0000dae0: 3a20 666c 6f61 743d 302e 320a 2020 2020  : float=0.2.    
+0000daf0: 6469 6164 5f73 6967 6d61 5f6d 696e 5f61  diad_sigma_min_a
+0000db00: 6c6c 6f77 616e 6365 3a20 666c 6f61 743d  llowance: float=
+0000db10: 302e 320a 2020 2020 6469 6164 5f73 6967  0.2.    diad_sig
+0000db20: 6d61 5f6d 6178 5f61 6c6c 6f77 616e 6365  ma_max_allowance
+0000db30: 3a20 666c 6f61 743d 350a 0a0a 2020 2020  : float=5...    
+0000db40: 2320 5065 616b 2061 6d70 6c69 7475 6465  # Peak amplitude
+0000db50: 0a20 2020 2064 6961 645f 7072 6f6d 3a20  .    diad_prom: 
+0000db60: 666c 6f61 7420 3d20 3130 300a 2020 2020  float = 100.    
+0000db70: 4842 5f70 726f 6d3a 2066 6c6f 6174 203d  HB_prom: float =
+0000db80: 2032 300a 2020 2020 4331 335f 7072 6f6d   20.    C13_prom
+0000db90: 3a20 666c 6f61 743d 3130 0a20 2020 2048  : float=10.    H
+0000dba0: 425f 7369 676d 615f 6d69 6e5f 616c 6c6f  B_sigma_min_allo
+0000dbb0: 7761 6e63 653d 302e 3035 0a20 2020 2048  wance=0.05.    H
+0000dbc0: 425f 7369 676d 615f 6d61 785f 616c 6c6f  B_sigma_max_allo
+0000dbd0: 7761 6e63 653d 330a 2020 2020 4842 5f61  wance=3.    HB_a
+0000dbe0: 6d70 5f6d 696e 5f61 6c6c 6f77 616e 6365  mp_min_allowance
+0000dbf0: 3d30 2e30 310a 2020 2020 4842 5f61 6d70  =0.01.    HB_amp
+0000dc00: 5f6d 6178 5f61 6c6c 6f77 616e 6365 3d31  _max_allowance=1
+0000dc10: 0a20 2020 2023 2048 6f77 206d 7563 6820  .    # How much 
+0000dc20: 746f 2073 686f 7720 6f6e 2078 2061 6e78  to show on x anx
+0000dc30: 2079 2061 7869 7320 6f66 2066 6967 7572   y axis of figur
+0000dc40: 6520 7368 6f77 696e 6720 6261 636b 6772  e showing backgr
+0000dc50: 6f75 6e64 2077 6974 6820 616c 6c20 7065  ound with all pe
+0000dc60: 616b 7320 696d 706f 7365 640a 2020 2020  aks imposed.    
+0000dc70: 785f 7261 6e67 655f 6261 7365 6c69 6e65  x_range_baseline
+0000dc80: 3a20 666c 6f61 743d 3735 0a20 2020 2079  : float=75.    y
+0000dc90: 5f72 616e 6765 5f62 6173 656c 696e 653a  _range_baseline:
+0000dca0: 2066 6c6f 6174 3d31 3030 0a0a 2020 2020   float=100..    
+0000dcb0: 2344 6f20 796f 7520 7761 6e74 2074 6f20  #Do you want to 
+0000dcc0: 7361 7665 2074 6865 2066 6967 7572 653f  save the figure?
+0000dcd0: 0a20 2020 2070 6c6f 745f 6669 6775 7265  .    plot_figure
+0000dce0: 3a20 626f 6f6c 203d 2054 7275 650a 2020  : bool = True.  
+0000dcf0: 2020 6470 693a 2066 6c6f 6174 203d 2032    dpi: float = 2
+0000dd00: 3030 0a20 2020 2078 5f72 616e 6765 5f72  00.    x_range_r
+0000dd10: 6573 6964 7561 6c3a 2066 6c6f 6174 3d32  esidual: float=2
+0000dd20: 300a 0a20 2020 2023 2044 6f20 796f 7520  0..    # Do you 
+0000dd30: 7761 6e74 2074 6f20 7265 7475 726e 206f  want to return o
+0000dd40: 7468 6572 2070 6172 616d 6574 6572 733f  ther parameters?
+0000dd50: 0a20 2020 2072 6574 7572 6e5f 6f74 6865  .    return_othe
+0000dd60: 725f 7061 7261 6d73 3a20 626f 6f6c 203d  r_params: bool =
+0000dd70: 4661 6c73 650a 0a0a 0a20 2020 2064 6566  False....    def
+0000dd80: 2075 7064 6174 655f 7061 7228 7365 6c66   update_par(self
+0000dd90: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+0000dda0: 2020 2020 2066 6f72 206b 6579 2c20 7661       for key, va
+0000ddb0: 6c75 6520 696e 206b 7761 7267 732e 6974  lue in kwargs.it
+0000ddc0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+0000ddd0: 2020 2069 6620 6861 7361 7474 7228 7365     if hasattr(se
+0000dde0: 6c66 2c20 6b65 7929 3a0a 2020 2020 2020  lf, key):.      
+0000ddf0: 2020 2020 2020 2020 2020 7365 7461 7474            setatt
+0000de00: 7228 7365 6c66 2c20 6b65 792c 2076 616c  r(self, key, val
+0000de10: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+0000de20: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000de30: 2020 2020 2020 7261 6973 6520 4174 7472        raise Attr
+0000de40: 6962 7574 6545 7272 6f72 2866 2227 6469  ibuteError(f"'di
+0000de50: 6164 325f 6669 745f 636f 6e66 6967 2720  ad2_fit_config' 
+0000de60: 6f62 6a65 6374 2068 6173 206e 6f20 6174  object has no at
+0000de70: 7472 6962 7574 6520 277b 6b65 797d 2722  tribute '{key}'"
+0000de80: 290a 0a23 2320 5465 7374 696e 6720 6765  )..## Testing ge
+0000de90: 6e65 7269 6320 6d6f 6465 6c0a 0a0a 6465  neric model...de
+0000dea0: 6620 6669 745f 6761 7573 7369 616e 5f76  f fit_gaussian_v
+0000deb0: 6f69 6774 5f67 656e 6572 6963 5f64 6961  oigt_generic_dia
+0000dec0: 6428 636f 6e66 6967 312c 202a 2c20 6469  d(config1, *, di
+0000ded0: 6164 313d 4661 6c73 652c 2064 6961 6432  ad1=False, diad2
+0000dee0: 3d46 616c 7365 2c20 7061 7468 3d4e 6f6e  =False, path=Non
+0000def0: 652c 2066 696c 656e 616d 653d 4e6f 6e65  e, filename=None
+0000df00: 2c20 7864 6174 3d4e 6f6e 652c 2079 6461  , xdat=None, yda
+0000df10: 743d 4e6f 6e65 2c20 7370 616e 3d4e 6f6e  t=None, span=Non
+0000df20: 652c 2020 706c 6f74 5f66 6967 7572 653d  e,  plot_figure=
+0000df30: 5472 7565 2c20 6470 693d 3230 302c 2044  True, dpi=200, D
+0000df40: 6961 645f 706f 733d 4e6f 6e65 2c20 4842  iad_pos=None, HB
+0000df50: 5f70 6f73 3d4e 6f6e 652c 2043 3133 5f70  _pos=None, C13_p
+0000df60: 6f73 3d4e 6f6e 652c 2066 6974 5f70 6561  os=None, fit_pea
+0000df70: 6b73 3d4e 6f6e 652c 2062 6c6f 636b 5f70  ks=None, block_p
+0000df80: 7269 6e74 3d54 7275 6529 3a0a 0a0a 2020  rint=True):...  
+0000df90: 2020 2222 2220 5468 6973 2066 756e 6374    """ This funct
+0000dfa0: 696f 6e20 6669 7473 2061 2076 6f69 6774  ion fits a voigt
+0000dfb0: 2f50 7365 7564 6f76 6f69 6774 2063 7572  /Pseudovoigt cur
+0000dfc0: 7665 7320 746f 2062 6163 6b67 726f 756e  ves to backgroun
+0000dfd0: 6420 7375 6274 7261 6374 6564 2064 6174  d subtracted dat
+0000dfe0: 6120 666f 7220 796f 7572 2064 6961 6473  a for your diads
+0000dff0: 0a20 2020 202b 2d20 4842 732b 2d43 3133  .    +- HBs+-C13
+0000e000: 2070 6561 6b73 2e20 4974 2063 616e 2061   peaks. It can a
+0000e010: 6c73 6f20 6669 7420 6120 7365 636f 6e64  lso fit a second
+0000e020: 2047 6175 7373 6961 6e20 6261 636b 6772   Gaussian backgr
+0000e030: 6f75 6e64 2069 7465 7261 7469 7665 6c79  ound iteratively
+0000e040: 2077 6974 6820 7468 6573 6520 7065 616b   with these peak
+0000e050: 730a 0a0a 2020 2020 5061 7261 6d65 7465  s...    Paramete
+0000e060: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+0000e070: 2d2d 0a20 2020 2063 6f6e 6669 6731 3a20  --.    config1: 
+0000e080: 6669 7420 636f 6e66 6967 7572 6174 696f  fit configuratio
+0000e090: 6e20 6669 6c65 2c20 6672 6f6d 2064 6961  n file, from dia
+0000e0a0: 6432 5f66 6974 5f63 6f6e 6669 6720 6f72  d2_fit_config or
+0000e0b0: 2064 6961 6431 5f66 6974 5f63 6f6e 6669   diad1_fit_confi
+0000e0c0: 6720 6461 7461 2063 6c61 7373 6573 2e0a  g data classes..
+0000e0d0: 2020 2020 2020 2020 4465 7461 696c 6564          Detailed
+0000e0e0: 2064 6573 6372 6970 7469 6f6e 7320 6f66   descriptions of
+0000e0f0: 2074 6869 6e67 7320 696e 2074 6869 7320   things in this 
+0000e100: 6669 6c65 2061 7265 2066 6f75 6e64 2069  file are found i
+0000e110: 6e20 646f 6373 2066 6f72 2066 6974 5f64  n docs for fit_d
+0000e120: 6961 645f 325f 775f 6263 6b2c 2061 6e64  iad_2_w_bck, and
+0000e130: 2066 6974 5f64 6961 645f 315f 775f 6263   fit_diad_1_w_bc
+0000e140: 6b0a 0a20 2020 2064 6961 6431 3a20 626f  k..    diad1: bo
+0000e150: 6f6c 0a20 2020 2020 2020 2054 7275 6520  ol.        True 
+0000e160: 6966 2066 6974 7469 6e67 2044 6961 6431  if fitting Diad1
+0000e170: 2c20 4661 6c73 6520 6966 2044 6961 6432  , False if Diad2
+0000e180: 0a0a 2020 2020 6469 6164 323a 2062 6f6f  ..    diad2: boo
+0000e190: 6c0a 2020 2020 2020 2020 5472 7565 2069  l.        True i
+0000e1a0: 6620 6669 7474 696e 6720 4469 6164 322c  f fitting Diad2,
+0000e1b0: 2046 616c 7365 2069 6620 4469 6164 310a   False if Diad1.
+0000e1c0: 0a20 2020 2070 6174 683a 2073 7472 0a20  .    path: str. 
+0000e1d0: 2020 2020 2020 2050 6174 6820 746f 2073         Path to s
+0000e1e0: 7065 6374 7261 2066 6f6c 6465 722e 2055  pectra folder. U
+0000e1f0: 7365 6420 746f 206d 616b 6520 6120 666f  sed to make a fo
+0000e200: 6c64 6572 2069 6e73 6964 6520 7468 6973  lder inside this
+0000e210: 2066 6f6c 6465 7220 746f 2073 746f 7265   folder to store
+0000e220: 2070 6561 6b20 6669 7420 696d 6167 6573   peak fit images
+0000e230: 2069 6e0a 0a20 2020 2066 696c 656e 616d   in..    filenam
+0000e240: 653a 2073 7472 0a20 2020 2020 2020 2066  e: str.        f
+0000e250: 696c 656e 616d 6520 6f66 2073 7065 6369  ilename of speci
+0000e260: 6669 6320 6469 6164 2062 6569 6e67 2066  fic diad being f
+0000e270: 6974 7465 640a 0a20 2020 2078 6461 743a  itted..    xdat:
+0000e280: 206e 702e 6172 7261 790a 2020 2020 2020   np.array.      
+0000e290: 2020 7820 636f 6f72 6469 6e61 7465 7320    x coordinates 
+0000e2a0: 6f66 2074 6865 2073 7065 6374 7261 0a0a  of the spectra..
+0000e2b0: 2020 2020 7964 6174 3a20 6e70 2e61 7272      ydat: np.arr
+0000e2c0: 6179 0a20 2020 2020 2020 2079 2063 6f6f  ay.        y coo
+0000e2d0: 7264 696e 6174 6573 206f 6620 7468 6520  rdinates of the 
+0000e2e0: 7370 6563 7472 610a 0a20 2020 2073 7061  spectra..    spa
+0000e2f0: 6e3a 206c 6973 7420 2865 2e67 2e20 5b31  n: list (e.g. [1
+0000e300: 3130 302c 2031 3330 305d 290a 2020 2020  100, 1300]).    
+0000e310: 2020 2020 436f 6d65 7320 6672 6f6d 2072      Comes from r
+0000e320: 656d 6f76 655f 6469 6164 5f62 6173 656c  emove_diad_basel
+0000e330: 696e 6520 6675 6e63 7469 6f6e 2e20 5365  ine function. Se
+0000e340: 7473 206d 696e 2061 6e64 206d 6178 2078  ts min and max x
+0000e350: 2063 6f6f 7264 696e 6174 6520 6f66 206e   coordinate of n
+0000e360: 6577 206c 696e 7370 6163 650a 2020 2020  ew linspace.    
+0000e370: 2020 2020 666f 7220 706c 6f74 7469 6e67      for plotting
+0000e380: 2074 6865 206f 7665 7261 6c6c 2070 6561   the overall pea
+0000e390: 6b20 6669 7420 6f76 6572 2074 6865 2064  k fit over the d
+0000e3a0: 6174 610a 0a20 2020 2070 6c6f 745f 6669  ata..    plot_fi
+0000e3b0: 6775 7265 3a20 626f 6f6c 0a20 2020 2020  gure: bool.     
+0000e3c0: 2020 2069 6620 5472 7565 2c20 706c 6f74     if True, plot
+0000e3d0: 7320 6669 6775 7265 2066 726f 6d20 7468  s figure from th
+0000e3e0: 6973 2066 756e 6374 696f 6e20 7370 6563  is function spec
+0000e3f0: 6966 6963 616c 6c79 2e20 4576 656e 2069  ifically. Even i
+0000e400: 6620 4661 6c73 652c 2069 6620 6361 6c6c  f False, if call
+0000e410: 6564 2074 6872 6f75 6768 0a20 2020 2020  ed through.     
+0000e420: 2020 2066 6974 5f64 6961 645f 325f 775f     fit_diad_2_w_
+0000e430: 6263 6b20 6f72 2066 6974 5f64 6961 645f  bck or fit_diad_
+0000e440: 315f 775f 6263 6b2c 2067 6574 2061 2066  1_w_bck, get a f
+0000e450: 6967 7572 6520 6672 6f6d 2074 686f 7365  igure from those
+0000e460: 2066 756e 6374 696f 6e73 2077 6974 6820   functions with 
+0000e470: 7265 6c65 7661 6e74 2064 6174 6120 6f6e  relevant data on
+0000e480: 0a0a 2020 2020 6470 693a 2069 6e74 0a20  ..    dpi: int. 
+0000e490: 2020 2020 2020 2064 7069 206f 6620 7361         dpi of sa
+0000e4a0: 7665 6420 6669 6775 7265 0a0a 2020 2020  ved figure..    
+0000e4b0: 4469 6164 5f70 6f73 2c20 4842 5f70 6f73  Diad_pos, HB_pos
+0000e4c0: 2c20 4331 335f 706f 733a 2066 6c6f 6174  , C13_pos: float
+0000e4d0: 0a20 2020 2020 2020 2049 6e69 7469 616c  .        Initial
+0000e4e0: 2067 7565 7373 206f 6620 4469 6164 2c20   guess of Diad, 
+0000e4f0: 4842 2c20 4331 3320 706f 730a 0a20 2020  HB, C13 pos..   
+0000e500: 2066 6974 5f70 6561 6b73 3a20 696e 740a   fit_peaks: int.
+0000e510: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
+0000e520: 6620 7065 616b 7320 746f 2066 6974 2e20  f peaks to fit. 
+0000e530: 313d 206a 7573 7420 6469 6164 2c20 3220  1= just diad, 2 
+0000e540: 3d20 6469 6164 202b 2048 422c 2033 203d  = diad + HB, 3 =
+0000e550: 2064 6961 642b 2048 4220 2b43 3133 0a0a   diad+ HB +C13..
+0000e560: 2020 2020 626c 6f63 6b5f 7072 696e 743a      block_print:
+0000e570: 2062 6f6f 6c0a 2020 2020 2020 2020 4966   bool.        If
+0000e580: 2074 7275 652c 2070 7269 6e74 7320 6120   true, prints a 
+0000e590: 6665 7720 7374 6174 7573 2075 7064 6174  few status updat
+0000e5a0: 6573 2061 7320 6974 2067 6f65 7320 746f  es as it goes to
+0000e5b0: 2068 656c 7020 6465 6275 670a 0a20 2020   help debug..   
+0000e5c0: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
+0000e5d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000e5e0: 0a20 2020 2072 6573 756c 742c 2064 665f  .    result, df_
+0000e5f0: 6f75 742c 2079 5f62 6573 745f 6669 742c  out, y_best_fit,
+0000e600: 2078 5f6c 696e 2c20 636f 6d70 6f6e 656e   x_lin, componen
+0000e610: 7473 2c20 7864 6174 2c20 7964 6174 2c20  ts, xdat, ydat, 
+0000e620: 6178 315f 786c 696d 2c20 6178 325f 786c  ax1_xlim, ax2_xl
+0000e630: 696d 2c20 636f 6e66 6967 312e 6669 745f  im, config1.fit_
+0000e640: 6761 7573 732c 2072 6573 6964 7561 6c5f  gauss, residual_
+0000e650: 6469 6164 5f63 6f6f 7264 732c 2079 6461  diad_coords, yda
+0000e660: 745f 696e 7261 6e67 652c 2020 7864 6174  t_inrange,  xdat
+0000e670: 5f69 6e72 616e 6765 0a0a 2020 2020 7265  _inrange..    re
+0000e680: 7375 6c74 3a20 6c6d 6669 742e 6d6f 6465  sult: lmfit.mode
+0000e690: 6c2e 4d6f 6465 6c52 6573 756c 7420 286d  l.ModelResult (m
+0000e6a0: 6f64 656c 2066 6f72 6d20 6c6d 6669 7429  odel form lmfit)
+0000e6b0: 0a20 2020 2064 665f 6f75 743a 2064 6174  .    df_out: dat
+0000e6c0: 6166 7261 6d65 206f 6620 7065 616b 2066  aframe of peak f
+0000e6d0: 6974 2070 6172 616d 6574 6572 730a 2020  it parameters.  
+0000e6e0: 2020 795f 6265 7374 5f66 6974 3a20 6e70    y_best_fit: np
+0000e6f0: 2e61 7272 6179 206f 6620 6265 7374 2070  .array of best p
+0000e700: 6561 6b20 6669 7420 7920 7061 7261 6d65  eak fit y parame
+0000e710: 7465 7273 0a20 2020 2078 5f6c 696e 3a20  ters.    x_lin: 
+0000e720: 6e70 2e61 7272 6179 206f 6620 7820 636f  np.array of x co
+0000e730: 6f72 6469 6e61 7465 7320 636f 7272 6573  ordinates corres
+0000e740: 706f 6e64 696e 6720 746f 2079 5f62 6573  ponding to y_bes
+0000e750: 745f 6669 740a 2020 2020 636f 6d70 6f6e  t_fit.    compon
+0000e760: 656e 7473 3a20 7920 636f 6f72 6469 6e61  ents: y coordina
+0000e770: 7465 7320 6f66 2074 6865 2064 6966 6665  tes of the diffe
+0000e780: 7265 6e74 2063 6f6d 706f 6e65 6e74 7320  rent components 
+0000e790: 6f66 2074 6865 2070 6561 6b20 6669 742e  of the peak fit.
+0000e7a0: 0a20 2020 2078 6461 743a 2069 6e70 7574  .    xdat: input
+0000e7b0: 2078 6461 740a 2020 2020 7964 6174 3a20   xdat.    ydat: 
+0000e7c0: 696e 7075 7420 7964 6174 0a20 2020 2061  input ydat.    a
+0000e7d0: 7831 5f78 6c69 6d2c 2061 7832 5f78 6c69  x1_xlim, ax2_xli
+0000e7e0: 6d3a 2078 6c69 6d20 666f 7220 706c 6f74  m: xlim for plot
+0000e7f0: 2069 6e20 6669 6e61 6c20 6669 6775 7265   in final figure
+0000e800: 2069 6e20 6669 745f 775f 6263 6b20 666f   in fit_w_bck fo
+0000e810: 7220 6469 6666 6572 656e 7420 6669 7420  r different fit 
+0000e820: 636f 6d70 6f6e 656e 7473 0a20 2020 2072  components.    r
+0000e830: 6573 6964 7561 6c5f 6469 6164 5f63 6f6f  esidual_diad_coo
+0000e840: 7264 696e 6174 6573 3a20 6e70 2e61 7272  rdinates: np.arr
+0000e850: 6179 206f 6620 7920 636f 6f72 6469 6e61  ay of y coordina
+0000e860: 7465 206f 6620 7265 7369 6475 616c 2070  te of residual p
+0000e870: 6c6f 740a 2020 2020 7964 6174 5f69 6e72  lot.    ydat_inr
+0000e880: 616e 6765 3a20 6e70 2e61 7272 6179 206f  ange: np.array o
+0000e890: 6620 6461 7461 2077 6974 6869 6e20 2773  f data within 's
+0000e8a0: 7061 6e27 0a20 2020 2078 6461 745f 696e  pan'.    xdat_in
+0000e8b0: 7261 6e67 653a 6e70 2e61 7272 6179 206f  range:np.array o
+0000e8c0: 6620 6461 7461 2077 6974 6869 6e20 2773  f data within 's
+0000e8d0: 7061 6e27 0a0a 0a0a 2020 2020 2222 220a  pan'....    """.
+0000e8e0: 0a0a 0a20 2020 2023 2043 616c 6375 6c61  ...    # Calcula
+0000e8f0: 7465 2074 6865 2061 6d70 6c69 7475 6465  te the amplitude
+0000e900: 2066 726f 6d20 7468 6520 7369 676d 6120   from the sigma 
+0000e910: 616e 6420 7468 6520 7072 6f6d 696e 656e  and the prominen
+0000e920: 6365 0a20 2020 2063 616c 635f 6469 6164  ce.    calc_diad
+0000e930: 5f61 6d70 6c69 7475 6465 3d28 2863 6f6e  _amplitude=((con
+0000e940: 6669 6731 2e64 6961 645f 7369 676d 6129  fig1.diad_sigma)
+0000e950: 2a28 636f 6e66 6967 312e 6469 6164 5f70  *(config1.diad_p
+0000e960: 726f 6d29 292f 302e 3339 3339 0a20 2020  rom))/0.3939.   
+0000e970: 2063 616c 635f 4842 5f61 6d70 6c69 7475   calc_HB_amplitu
+0000e980: 6465 3d28 2863 6f6e 6669 6731 2e64 6961  de=((config1.dia
+0000e990: 645f 7369 676d 6129 2a28 636f 6e66 6967  d_sigma)*(config
+0000e9a0: 312e 4842 5f70 726f 6d29 292f 302e 3339  1.HB_prom))/0.39
+0000e9b0: 3339 0a0a 2020 2020 2320 4966 2061 736b  39..    # If ask
+0000e9c0: 2066 6f72 2047 6175 7373 6961 6e2c 2062   for Gaussian, b
+0000e9d0: 7574 2066 6974 2070 6561 6b73 2069 7320  ut fit peaks is 
+0000e9e0: 312c 2072 656d 6f76 6520 6761 7573 7369  1, remove gaussi
+0000e9f0: 616e 0a20 2020 2069 6620 6669 745f 7065  an.    if fit_pe
+0000ea00: 616b 733d 3d31 2061 6e64 2063 6f6e 6669  aks==1 and confi
+0000ea10: 6731 2e66 6974 5f67 6175 7373 2069 7320  g1.fit_gauss is 
+0000ea20: 5472 7565 3a0a 2020 2020 2020 2020 636f  True:.        co
+0000ea30: 6e66 6967 312e 6669 745f 6761 7573 733d  nfig1.fit_gauss=
+0000ea40: 4661 6c73 650a 0a0a 2020 2020 6966 2064  False...    if d
+0000ea50: 6961 6432 2069 7320 5472 7565 2061 6e64  iad2 is True and
+0000ea60: 2066 6974 5f70 6561 6b73 3d3d 333a 0a20   fit_peaks==3:. 
+0000ea70: 2020 2020 2020 2063 616c 635f 4331 335f         calc_C13_
+0000ea80: 616d 706c 6974 7564 653d 2830 2e35 2a28  amplitude=(0.5*(
+0000ea90: 636f 6e66 6967 312e 6469 6164 5f73 6967  config1.diad_sig
+0000eaa0: 6d61 292a 2863 6f6e 6669 6731 2e43 3133  ma)*(config1.C13
+0000eab0: 5f70 726f 6d29 292f 302e 3339 3339 0a20  _prom))/0.3939. 
+0000eac0: 2020 2023 2047 6574 7320 6f76 6572 7269     # Gets overri
+0000ead0: 6464 656e 2069 6620 796f 7520 6861 7665  dden if you have
+0000eae0: 2074 7269 6767 6572 6564 2061 6e79 206f   triggered any o
+0000eaf0: 6620 7468 6520 7761 726e 696e 6773 0a20  f the warnings. 
+0000eb00: 2020 2072 6566 6974 3d46 616c 7365 0a20     refit=False. 
+0000eb10: 2020 2072 6566 6974 5f70 6172 616d 3d27     refit_param='
+0000eb20: 466c 6167 6765 6420 5761 726e 696e 6773  Flagged Warnings
+0000eb30: 3a27 0a20 2020 2073 7065 635f 7265 733d  :'.    spec_res=
+0000eb40: 6e70 2e61 6273 2878 6461 745b 315d 2d78  np.abs(xdat[1]-x
+0000eb50: 6461 745b 305d 290a 0a0a 0a0a 0a0a 2020  dat[0]).......  
+0000eb60: 2020 696e 6974 6961 6c5f 6775 6573 733d    initial_guess=
+0000eb70: 4469 6164 5f70 6f73 0a20 2020 2048 425f  Diad_pos.    HB_
+0000eb80: 696e 6974 6961 6c5f 6775 6573 733d 4842  initial_guess=HB
+0000eb90: 5f70 6f73 0a20 2020 2043 3133 5f69 6e69  _pos.    C13_ini
+0000eba0: 7469 616c 5f67 7565 7373 3d43 3133 5f70  tial_guess=C13_p
+0000ebb0: 6f73 0a0a 0a20 2020 206d 6f64 656c 5f69  os...    model_i
+0000ebc0: 6e69 203d 2067 6c6f 6261 6c73 2829 5b63  ni = globals()[c
+0000ebd0: 6f6e 6669 6731 2e6d 6f64 656c 5f6e 616d  onfig1.model_nam
+0000ebe0: 655d 2829 0a0a 0a0a 0a20 2020 2023 2043  e]().....    # C
+0000ebf0: 7265 6174 6520 696e 6974 6961 6c20 7065  reate initial pe
+0000ec00: 616b 2070 6172 616d 730a 2020 2020 2320  ak params.    # 
+0000ec10: 5365 7420 7065 616b 2070 6f73 6974 696f  Set peak positio
+0000ec20: 6e20 746f 2032 2073 7065 6374 7261 6c20  n to 2 spectral 
+0000ec30: 7265 7320 756e 6974 7320 6569 7468 6572  res units either
+0000ec40: 2073 6964 6520 6f66 2074 6865 2069 6e69   side of the ini
+0000ec50: 7469 616c 2067 7565 7373 206d 6164 6520  tial guess made 
+0000ec60: 6162 6f76 650a 2020 2020 7061 7261 6d73  above.    params
+0000ec70: 5f69 6e69 203d 206d 6f64 656c 5f69 6e69  _ini = model_ini
+0000ec80: 2e6d 616b 655f 7061 7261 6d73 2863 656e  .make_params(cen
+0000ec90: 7465 723d 696e 6974 6961 6c5f 6775 6573  ter=initial_gues
+0000eca0: 732c 206d 6178 3d69 6e69 7469 616c 5f67  s, max=initial_g
+0000ecb0: 7565 7373 2b73 7065 635f 7265 732a 352c  uess+spec_res*5,
+0000ecc0: 206d 696e 3d69 6e69 7469 616c 5f67 7565   min=initial_gue
+0000ecd0: 7373 2d73 7065 635f 7265 732a 3529 0a20  ss-spec_res*5). 
+0000ece0: 2020 2023 2053 6574 2074 6865 2061 6d70     # Set the amp
+0000ecf0: 6c69 7475 6465 2074 6f20 7769 7468 696e  litude to within
+0000ed00: 2058 302e 3120 6f72 2031 3058 206f 6620   X0.1 or 10X of 
+0000ed10: 7468 6520 6775 6573 7365 6420 616d 706c  the guessed ampl
+0000ed20: 6974 7564 650a 2020 2020 7061 7261 6d73  itude.    params
+0000ed30: 5f69 6e69 5b27 616d 706c 6974 7564 6527  _ini['amplitude'
+0000ed40: 5d2e 7365 7428 6361 6c63 5f64 6961 645f  ].set(calc_diad_
+0000ed50: 616d 706c 6974 7564 652c 206d 696e 3d63  amplitude, min=c
+0000ed60: 616c 635f 6469 6164 5f61 6d70 6c69 7475  alc_diad_amplitu
+0000ed70: 6465 2f35 2c0a 2020 2020 2020 2020 2020  de/5,.          
+0000ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed90: 2020 2020 2020 206d 6178 3d63 616c 635f         max=calc_
+0000eda0: 6469 6164 5f61 6d70 6c69 7475 6465 2a35  diad_amplitude*5
+0000edb0: 290a 2020 2020 2320 5365 7420 7369 676d  ).    # Set sigm
+0000edc0: 6120 746f 2062 6520 7468 6520 656e 7465  a to be the ente
+0000edd0: 7265 6420 7661 6c75 652c 2074 6865 6e0a  red value, then.
+0000ede0: 2020 2020 7061 7261 6d73 5f69 6e69 5b27      params_ini['
+0000edf0: 7369 676d 6127 5d2e 7365 7428 636f 6e66  sigma'].set(conf
+0000ee00: 6967 312e 6469 6164 5f73 6967 6d61 2c20  ig1.diad_sigma, 
+0000ee10: 6d69 6e3d 636f 6e66 6967 312e 6469 6164  min=config1.diad
+0000ee20: 5f73 6967 6d61 2a63 6f6e 6669 6731 2e64  _sigma*config1.d
+0000ee30: 6961 645f 7369 676d 615f 6d69 6e5f 616c  iad_sigma_min_al
+0000ee40: 6c6f 7761 6e63 652c 0a20 2020 2020 2020  lowance,.       
+0000ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee60: 2020 2020 2020 2020 206d 6178 3d63 6f6e           max=con
+0000ee70: 6669 6731 2e64 6961 645f 7369 676d 612a  fig1.diad_sigma*
+0000ee80: 636f 6e66 6967 312e 6469 6164 5f73 6967  config1.diad_sig
+0000ee90: 6d61 5f6d 6178 5f61 6c6c 6f77 616e 6365  ma_max_allowance
+0000eea0: 290a 0a20 2020 2023 204e 6f77 206c 6574  )..    # Now let
+0000eeb0: 7320 7477 6561 6b20 616e 2069 6e69 7469  s tweak an initi
+0000eec0: 616c 206d 6f64 656c 2077 6974 6820 6a75  al model with ju
+0000eed0: 7374 2031 2070 6561 6b2c 2074 6869 7320  st 1 peak, this 
+0000eee0: 7265 616c 6c79 2068 656c 7073 2077 6974  really helps wit
+0000eef0: 6820 7468 6520 6669 740a 2020 2020 696e  h the fit.    in
+0000ef00: 6974 5f69 6e69 203d 206d 6f64 656c 5f69  it_ini = model_i
+0000ef10: 6e69 2e65 7661 6c28 7061 7261 6d73 5f69  ni.eval(params_i
+0000ef20: 6e69 2c20 783d 7864 6174 290a 2020 2020  ni, x=xdat).    
+0000ef30: 7265 7375 6c74 5f69 6e69 2020 3d20 6d6f  result_ini  = mo
+0000ef40: 6465 6c5f 696e 692e 6669 7428 7964 6174  del_ini.fit(ydat
+0000ef50: 2c20 7061 7261 6d73 5f69 6e69 2c20 783d  , params_ini, x=
+0000ef60: 7864 6174 290a 2020 2020 636f 6d70 735f  xdat).    comps_
+0000ef70: 696e 6920 203d 2072 6573 756c 745f 696e  ini  = result_in
+0000ef80: 692e 6576 616c 5f63 6f6d 706f 6e65 6e74  i.eval_component
+0000ef90: 7328 290a 2020 2020 4365 6e74 6572 5f69  s().    Center_i
+0000efa0: 6e69 3d72 6573 756c 745f 696e 692e 7061  ni=result_ini.pa
+0000efb0: 7261 6d73 2e67 6574 2827 6365 6e74 6572  rams.get('center
+0000efc0: 2729 0a20 2020 2041 6d70 6c69 7475 6465  ').    Amplitude
+0000efd0: 5f69 6e69 3d72 6573 756c 745f 696e 692e  _ini=result_ini.
+0000efe0: 7061 7261 6d73 2e67 6574 2827 616d 706c  params.get('ampl
+0000eff0: 6974 7564 6527 290a 2020 2020 7369 676d  itude').    sigm
+0000f000: 615f 696e 693d 7265 7375 6c74 5f69 6e69  a_ini=result_ini
+0000f010: 2e70 6172 616d 732e 6765 7428 2773 6967  .params.get('sig
+0000f020: 6d61 2729 0a20 2020 2066 7768 6d5f 696e  ma').    fwhm_in
+0000f030: 693d 7265 7375 6c74 5f69 6e69 2e70 6172  i=result_ini.par
+0000f040: 616d 732e 6765 7428 2766 7768 6d27 290a  ams.get('fwhm').
+0000f050: 0a0a 0a20 2020 2023 2046 6f72 2072 656c  ...    # For rel
+0000f060: 6174 6976 656c 7920 7765 616b 2070 6561  atively weak pea
+0000f070: 6b73 2c20 796f 7520 776f 6e74 2077 616e  ks, you wont wan
+0000f080: 7420 6120 6761 7573 7369 616e 2062 6163  t a gaussian bac
+0000f090: 6b67 726f 756e 640a 2020 2020 6966 2063  kground.    if c
+0000f0a0: 6f6e 6669 6731 2e66 6974 5f67 6175 7373  onfig1.fit_gauss
+0000f0b0: 2069 7320 4661 6c73 653a 0a0a 2020 2020   is False:..    
+0000f0c0: 2020 2020 2320 4966 2074 6865 7265 2069      # If there i
+0000f0d0: 7320 3120 7065 616b 2c20 652e 672e 2069  s 1 peak, e.g. i
+0000f0e0: 6620 6861 7665 2061 204e 616e 2066 6f72  f have a Nan for
+0000f0f0: 2068 6f74 6261 6e64 0a20 2020 2020 2020   hotband.       
+0000f100: 2069 6620 6669 745f 7065 616b 733d 3d31   if fit_peaks==1
+0000f110: 3a0a 2020 2020 2020 2020 2020 2020 6d6f  :.            mo
+0000f120: 6465 6c5f 4620 3d20 676c 6f62 616c 7328  del_F = globals(
+0000f130: 295b 636f 6e66 6967 312e 6d6f 6465 6c5f  )[config1.model_
+0000f140: 6e61 6d65 5d28 7072 6566 6978 3d27 6c7a  name](prefix='lz
+0000f150: 315f 2729 0a20 2020 2020 2020 2020 2020  1_').           
+0000f160: 2070 6172 7331 203d 206d 6f64 656c 5f46   pars1 = model_F
+0000f170: 2e6d 616b 655f 7061 7261 6d73 2829 0a20  .make_params(). 
+0000f180: 2020 2020 2020 2020 2020 2070 6172 7331             pars1
+0000f190: 5b27 6c7a 315f 272b 2027 616d 706c 6974  ['lz1_'+ 'amplit
+0000f1a0: 7564 6527 5d2e 7365 7428 6361 6c63 5f64  ude'].set(calc_d
+0000f1b0: 6961 645f 616d 706c 6974 7564 652c 206d  iad_amplitude, m
+0000f1c0: 696e 3d30 2c20 6d61 783d 6361 6c63 5f64  in=0, max=calc_d
+0000f1d0: 6961 645f 616d 706c 6974 7564 652a 3130  iad_amplitude*10
+0000f1e0: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
+0000f1f0: 7273 315b 276c 7a31 5f27 2b20 2763 656e  rs1['lz1_'+ 'cen
+0000f200: 7465 7227 5d2e 7365 7428 4365 6e74 6572  ter'].set(Center
+0000f210: 5f69 6e69 2c20 6d69 6e3d 4365 6e74 6572  _ini, min=Center
+0000f220: 5f69 6e69 2d35 2a73 7065 635f 7265 732c  _ini-5*spec_res,
+0000f230: 206d 6178 3d43 656e 7465 725f 696e 692b   max=Center_ini+
+0000f240: 352a 7370 6563 5f72 6573 290a 2020 2020  5*spec_res).    
+0000f250: 2020 2020 2020 2020 7061 7273 315b 276c          pars1['l
+0000f260: 7a31 5f27 2b20 2773 6967 6d61 275d 2e73  z1_'+ 'sigma'].s
+0000f270: 6574 2863 6f6e 6669 6731 2e64 6961 645f  et(config1.diad_
+0000f280: 7369 676d 612c 206d 696e 3d63 6f6e 6669  sigma, min=confi
+0000f290: 6731 2e64 6961 645f 7369 676d 612a 636f  g1.diad_sigma*co
+0000f2a0: 6e66 6967 312e 6469 6164 5f73 6967 6d61  nfig1.diad_sigma
+0000f2b0: 5f6d 696e 5f61 6c6c 6f77 616e 6365 2c0a  _min_allowance,.
+0000f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2d0: 2020 2020 2020 2020 206d 6178 3d63 6f6e           max=con
+0000f2e0: 6669 6731 2e64 6961 645f 7369 676d 612a  fig1.diad_sigma*
+0000f2f0: 636f 6e66 6967 312e 6469 6164 5f73 6967  config1.diad_sig
+0000f300: 6d61 5f6d 6178 5f61 6c6c 6f77 616e 6365  ma_max_allowance
+0000f310: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
+0000f320: 7261 6d73 3d70 6172 7331 0a0a 0a20 2020  rams=pars1...   
+0000f330: 2020 2020 2023 2049 6620 7468 6572 6520       # If there 
+0000f340: 6973 206d 6f72 6520 7468 616e 206f 6e65  is more than one
+0000f350: 2070 6561 6b0a 2020 2020 2020 2020 656c   peak.        el
+0000f360: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000f370: 2320 5072 6576 696f 7573 2076 6572 7369  # Previous versi
+0000f380: 6f6e 7320 6861 6420 6120 636f 6e73 7461  ons had a consta
+0000f390: 6e74 2066 6f72 2050 5620 616e 6420 5034  nt for PV and P4
+0000f3a0: 2062 7574 206e 6f74 2056 6f69 6774 2e20   but not Voigt. 
+0000f3b0: 4e6f 7720 7265 6d6f 7665 6420 666f 7220  Now removed for 
+0000f3c0: 616c 6c0a 2020 2020 2020 2020 2020 2020  all.            
+0000f3d0: 6d6f 6465 6c31 203d 2067 6c6f 6261 6c73  model1 = globals
+0000f3e0: 2829 5b63 6f6e 6669 6731 2e6d 6f64 656c  ()[config1.model
+0000f3f0: 5f6e 616d 655d 2870 7265 6669 783d 276c  _name](prefix='l
+0000f400: 7a31 5f27 290a 2020 2020 2020 2020 2020  z1_').          
+0000f410: 2020 7061 7273 3120 3d20 6d6f 6465 6c31    pars1 = model1
+0000f420: 2e6d 616b 655f 7061 7261 6d73 2829 0a20  .make_params(). 
+0000f430: 2020 2020 2020 2020 2020 2070 6172 7331             pars1
+0000f440: 5b27 6c7a 315f 272b 2027 616d 706c 6974  ['lz1_'+ 'amplit
+0000f450: 7564 6527 5d2e 7365 7428 6361 6c63 5f64  ude'].set(calc_d
+0000f460: 6961 645f 616d 706c 6974 7564 652c 206d  iad_amplitude, m
+0000f470: 696e 3d30 2c20 6d61 783d 6361 6c63 5f64  in=0, max=calc_d
+0000f480: 6961 645f 616d 706c 6974 7564 652a 3130  iad_amplitude*10
+0000f490: 290a 0a20 2020 2020 2020 2020 2020 2070  )..            p
+0000f4a0: 6172 7331 5b27 6c7a 315f 272b 2027 6365  ars1['lz1_'+ 'ce
+0000f4b0: 6e74 6572 275d 2e73 6574 2843 656e 7465  nter'].set(Cente
+0000f4c0: 725f 696e 692c 206d 696e 3d43 656e 7465  r_ini, min=Cente
+0000f4d0: 725f 696e 692d 332a 7370 6563 5f72 6573  r_ini-3*spec_res
+0000f4e0: 2c20 6d61 783d 4365 6e74 6572 5f69 6e69  , max=Center_ini
+0000f4f0: 2b33 2a73 7065 635f 7265 7329 0a0a 2020  +3*spec_res)..  
+0000f500: 2020 2020 2020 2020 2020 7061 7273 315b            pars1[
+0000f510: 276c 7a31 5f27 2b20 2773 6967 6d61 275d  'lz1_'+ 'sigma']
+0000f520: 2e73 6574 2863 6f6e 6669 6731 2e64 6961  .set(config1.dia
+0000f530: 645f 7369 676d 612c 206d 696e 3d63 6f6e  d_sigma, min=con
+0000f540: 6669 6731 2e64 6961 645f 7369 676d 612a  fig1.diad_sigma*
+0000f550: 636f 6e66 6967 312e 6469 6164 5f73 6967  config1.diad_sig
+0000f560: 6d61 5f6d 696e 5f61 6c6c 6f77 616e 6365  ma_min_allowance
+0000f570: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f580: 2020 2020 2020 2020 2020 6d61 783d 636f            max=co
+0000f590: 6e66 6967 312e 6469 6164 5f73 6967 6d61  nfig1.diad_sigma
+0000f5a0: 2a63 6f6e 6669 6731 2e64 6961 645f 7369  *config1.diad_si
+0000f5b0: 676d 615f 6d61 785f 616c 6c6f 7761 6e63  gma_max_allowanc
+0000f5c0: 6529 0a0a 0a0a 0a20 2020 2020 2020 2020  e).....         
+0000f5d0: 2020 2069 6620 6669 745f 7065 616b 733e     if fit_peaks>
+0000f5e0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+0000f5f0: 2020 206d 6f64 656c 5f46 3d6d 6f64 656c     model_F=model
+0000f600: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+0000f610: 2020 7061 7261 6d73 3d70 6172 7331 0a0a    params=pars1..
+0000f620: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+0000f630: 6974 5f70 6561 6b73 3d3d 323a 0a0a 2020  it_peaks==2:..  
+0000f640: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000f650: 5365 636f 6e64 2077 6565 2070 6561 6b0a  Second wee peak.
+0000f660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f670: 7072 6566 6978 3d27 6c7a 325f 270a 0a20  prefix='lz2_'.. 
+0000f680: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000f690: 6561 6b20 3d20 676c 6f62 616c 7328 295b  eak = globals()[
+0000f6a0: 636f 6e66 6967 312e 6d6f 6465 6c5f 6e61  config1.model_na
+0000f6b0: 6d65 5d28 7072 6566 6978 3d27 6c7a 325f  me](prefix='lz2_
+0000f6c0: 2729 0a0a 0a20 2020 2020 2020 2020 2020  ')...           
+0000f6d0: 2020 2020 2070 6172 7320 3d20 7065 616b       pars = peak
+0000f6e0: 2e6d 616b 655f 7061 7261 6d73 2829 0a0a  .make_params()..
+0000f6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f700: 7061 7273 5b70 7265 6669 7820 2b20 2763  pars[prefix + 'c
+0000f710: 656e 7465 7227 5d2e 7365 7428 4842 5f69  enter'].set(HB_i
+0000f720: 6e69 7469 616c 5f67 7565 7373 2c0a 2020  nitial_guess,.  
+0000f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f740: 2020 6d69 6e3d 4842 5f69 6e69 7469 616c    min=HB_initial
+0000f750: 5f67 7565 7373 2d32 2a73 7065 635f 7265  _guess-2*spec_re
+0000f760: 732c 206d 6178 3d48 425f 696e 6974 6961  s, max=HB_initia
+0000f770: 6c5f 6775 6573 732b 3229 0a0a 2020 2020  l_guess+2)..    
+0000f780: 2020 2020 2020 2020 2020 2020 7061 7273              pars
+0000f790: 5b70 7265 6669 7820 2b20 2761 6d70 6c69  [prefix + 'ampli
+0000f7a0: 7475 6465 275d 2e73 6574 2863 616c 635f  tude'].set(calc_
+0000f7b0: 4842 5f61 6d70 6c69 7475 6465 2c20 6d69  HB_amplitude, mi
+0000f7c0: 6e3d 416d 706c 6974 7564 655f 696e 692a  n=Amplitude_ini*
+0000f7d0: 636f 6e66 6967 312e 4842 5f61 6d70 5f6d  config1.HB_amp_m
+0000f7e0: 696e 5f61 6c6c 6f77 616e 6365 2c20 6d61  in_allowance, ma
+0000f7f0: 783d 416d 706c 6974 7564 655f 696e 692a  x=Amplitude_ini*
+0000f800: 636f 6e66 6967 312e 4842 5f61 6d70 5f6d  config1.HB_amp_m
+0000f810: 6178 5f61 6c6c 6f77 616e 6365 290a 2020  ax_allowance).  
+0000f820: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0000f830: 7273 5b70 7265 6669 782b 2027 7369 676d  rs[prefix+ 'sigm
+0000f840: 6127 5d2e 7365 7428 7369 676d 615f 696e  a'].set(sigma_in
+0000f850: 692c 206d 696e 3d73 6967 6d61 5f69 6e69  i, min=sigma_ini
+0000f860: 2a63 6f6e 6669 6731 2e48 425f 7369 676d  *config1.HB_sigm
+0000f870: 615f 6d69 6e5f 616c 6c6f 7761 6e63 652c  a_min_allowance,
+0000f880: 206d 6178 3d73 6967 6d61 5f69 6e69 2a63   max=sigma_ini*c
+0000f890: 6f6e 6669 6731 2e48 425f 7369 676d 615f  onfig1.HB_sigma_
+0000f8a0: 6d61 785f 616c 6c6f 7761 6e63 6529 0a0a  max_allowance)..
+0000f8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f8c0: 206d 6f64 656c 5f46 3d6d 6f64 656c 312b   model_F=model1+
+0000f8d0: 7065 616b 0a0a 2020 2020 2020 2020 2020  peak..          
+0000f8e0: 2020 2020 2020 2320 7570 6461 7469 6e67        # updating
+0000f8f0: 2070 6172 7320 3120 7769 7468 2076 616c   pars 1 with val
+0000f900: 7565 7320 696e 2070 6172 730a 2020 2020  ues in pars.    
+0000f910: 2020 2020 2020 2020 2020 2020 7061 7273              pars
+0000f920: 312e 7570 6461 7465 2870 6172 7329 0a20  1.update(pars). 
+0000f930: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000f940: 6172 616d 733d 7061 7273 310a 0a0a 2020  arams=pars1...  
+0000f950: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000f960: 4174 7465 6d70 7420 6174 2073 7461 6269  Attempt at stabi
+0000f970: 6c69 7a69 6e67 2070 6561 6b20 6669 740a  lizing peak fit.
+0000f980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f990: 7265 7375 6c74 203d 206d 6f64 656c 5f46  result = model_F
+0000f9a0: 2e66 6974 2879 6461 742c 2070 6172 7331  .fit(ydat, pars1
+0000f9b0: 2c20 783d 7864 6174 290a 2020 2020 2020  , x=xdat).      
+0000f9c0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+0000f9d0: 2e70 6172 616d 735b 276c 7a32 5f63 656e  .params['lz2_cen
+0000f9e0: 7465 7227 5d2e 7661 7279 203d 2046 616c  ter'].vary = Fal
+0000f9f0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+0000fa00: 2020 2072 6573 756c 742e 7061 7261 6d73     result.params
+0000fa10: 5b27 6c7a 325f 616d 706c 6974 7564 6527  ['lz2_amplitude'
+0000fa20: 5d2e 7661 7279 203d 2046 616c 7365 0a20  ].vary = False. 
+0000fa30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000fa40: 6573 756c 742e 7061 7261 6d73 5b27 6c7a  esult.params['lz
+0000fa50: 325f 7369 676d 6127 5d2e 7661 7279 203d  2_sigma'].vary =
+0000fa60: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+0000fa70: 2020 2020 2020 2066 696e 616c 5f72 6573         final_res
+0000fa80: 756c 7420 3d20 6d6f 6465 6c5f 462e 6669  ult = model_F.fi
+0000fa90: 7428 7964 6174 2c20 7265 7375 6c74 2e70  t(ydat, result.p
+0000faa0: 6172 616d 732c 2078 3d78 6461 7429 0a20  arams, x=xdat). 
+0000fab0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000fac0: 6172 616d 732e 7570 6461 7465 2866 696e  arams.update(fin
+0000fad0: 616c 5f72 6573 756c 742e 7061 7261 6d73  al_result.params
+0000fae0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000faf0: 2020 7061 7261 6d73 2e75 7064 6174 6528    params.update(
+0000fb00: 6669 6e61 6c5f 7265 7375 6c74 2e70 6172  final_result.par
+0000fb10: 616d 7329 0a20 2020 2020 2020 2020 2020  ams).           
+0000fb20: 2020 2020 2072 6573 756c 743d 6669 6e61       result=fina
+0000fb30: 6c5f 7265 7375 6c74 0a0a 0a0a 0a0a 0a0a  l_result........
+0000fb40: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+0000fb50: 6974 5f70 6561 6b73 3d3d 333a 0a20 2020  it_peaks==3:.   
+0000fb60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000fb70: 626c 6f63 6b5f 7072 696e 7420 6973 2046  block_print is F
+0000fb80: 616c 7365 3a0a 2020 2020 2020 2020 2020  alse:.          
+0000fb90: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000fba0: 2754 7279 696e 6720 746f 2069 7465 7261  'Trying to itera
+0000fbb0: 7469 7665 6c79 2066 6974 2033 2070 6561  tively fit 3 pea
+0000fbc0: 6b73 2729 0a0a 2020 2020 2020 2020 2020  ks')..          
+0000fbd0: 2020 2020 2020 7065 616b 5f70 6f73 5f6c        peak_pos_l
+0000fbe0: 6566 743d 6e70 2e61 7272 6179 285b 4842  eft=np.array([HB
+0000fbf0: 5f69 6e69 7469 616c 5f67 7565 7373 2c20  _initial_guess, 
+0000fc00: 4331 335f 696e 6974 6961 6c5f 6775 6573  C13_initial_gues
+0000fc10: 735d 290a 0a20 2020 2020 2020 2020 2020  s])..           
+0000fc20: 2020 2020 2066 6f72 2069 2c20 6365 6e20       for i, cen 
+0000fc30: 696e 2065 6e75 6d65 7261 7465 2870 6561  in enumerate(pea
+0000fc40: 6b5f 706f 735f 6c65 6674 293a 0a0a 2020  k_pos_left):..  
+0000fc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc60: 2020 6966 2069 3d3d 303a 2023 2054 6869    if i==0: # Thi
+0000fc70: 7320 6973 2074 6865 2068 6f74 6261 6e64  s is the hotband
+0000fc80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fc90: 2020 2020 2020 2020 2070 6561 6b2c 2070           peak, p
+0000fca0: 6172 7320 3d20 6164 645f 7065 616b 2870  ars = add_peak(p
+0000fcb0: 7265 6669 783d 276c 7a25 645f 2720 2520  refix='lz%d_' % 
+0000fcc0: 2869 2b32 292c 2063 656e 7465 723d 6365  (i+2), center=ce
+0000fcd0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+0000fce0: 2020 2020 2020 2020 2020 206d 696e 5f63             min_c
+0000fcf0: 656e 743d 6365 6e2d 332a 7370 6563 5f72  ent=cen-3*spec_r
+0000fd00: 6573 2c20 6d61 785f 6365 6e74 3d63 656e  es, max_cent=cen
+0000fd10: 2b33 2a73 7065 635f 7265 732c 2073 6967  +3*spec_res, sig
+0000fd20: 6d61 3d73 6967 6d61 5f69 6e69 2c0a 2020  ma=sigma_ini,.  
+0000fd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd40: 2020 2020 2020 6d69 6e5f 7369 676d 613d        min_sigma=
+0000fd50: 7369 676d 615f 696e 692a 636f 6e66 6967  sigma_ini*config
+0000fd60: 312e 4842 5f73 6967 6d61 5f6d 696e 5f61  1.HB_sigma_min_a
+0000fd70: 6c6c 6f77 616e 6365 2c0a 2020 2020 2020  llowance,.      
+0000fd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd90: 2020 6d61 785f 7369 676d 613d 7369 676d    max_sigma=sigm
+0000fda0: 615f 696e 692a 636f 6e66 6967 312e 4842  a_ini*config1.HB
+0000fdb0: 5f73 6967 6d61 5f6d 6178 5f61 6c6c 6f77  _sigma_max_allow
+0000fdc0: 616e 6365 2c0a 2020 2020 2020 2020 2020  ance,.          
+0000fdd0: 2020 2020 2020 2020 2020 2020 2020 616d                am
+0000fde0: 706c 6974 7564 653d 6361 6c63 5f48 425f  plitude=calc_HB_
+0000fdf0: 616d 706c 6974 7564 652c 0a20 2020 2020  amplitude,.     
+0000fe00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe10: 2020 206d 696e 5f61 6d70 6c69 7475 6465     min_amplitude
+0000fe20: 3d41 6d70 6c69 7475 6465 5f69 6e69 2a63  =Amplitude_ini*c
+0000fe30: 6f6e 6669 6731 2e48 425f 616d 705f 6d69  onfig1.HB_amp_mi
+0000fe40: 6e5f 616c 6c6f 7761 6e63 652c 0a20 2020  n_allowance,.   
+0000fe50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe60: 2020 2020 206d 6178 5f61 6d70 6c69 7475       max_amplitu
+0000fe70: 6465 3d41 6d70 6c69 7475 6465 5f69 6e69  de=Amplitude_ini
+0000fe80: 2a63 6f6e 6669 6731 2e48 425f 616d 705f  *config1.HB_amp_
+0000fe90: 6d61 785f 616c 6c6f 7761 6e63 652c 0a20  max_allowance,. 
+0000fea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000feb0: 2020 2020 2020 206d 6f64 656c 5f6e 616d         model_nam
+0000fec0: 653d 636f 6e66 6967 312e 6d6f 6465 6c5f  e=config1.model_
+0000fed0: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+0000fee0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0000fef0: 6465 6c20 3d20 7065 616b 2b6d 6f64 656c  del = peak+model
+0000ff00: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+0000ff10: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+0000ff20: 2e75 7064 6174 6528 7061 7273 290a 2020  .update(pars).  
+0000ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff40: 2020 6966 2069 3d3d 313a 2023 2054 6869    if i==1: # Thi
+0000ff50: 7320 6973 2063 3133 0a20 2020 2020 2020  s is c13.       
+0000ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff70: 2070 6561 6b2c 2070 6172 7320 3d20 6164   peak, pars = ad
+0000ff80: 645f 7065 616b 2870 7265 6669 783d 276c  d_peak(prefix='l
+0000ff90: 7a25 645f 2720 2520 2869 2b32 292c 2063  z%d_' % (i+2), c
+0000ffa0: 656e 7465 723d 6365 6e2c 0a20 2020 2020  enter=cen,.     
+0000ffb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffc0: 2020 206d 696e 5f63 656e 743d 6365 6e2d     min_cent=cen-
+0000ffd0: 332a 7370 6563 5f72 6573 2c20 6d61 785f  3*spec_res, max_
+0000ffe0: 6365 6e74 3d63 656e 2b33 2a73 7065 635f  cent=cen+3*spec_
+0000fff0: 7265 732c 0a20 2020 2020 2020 2020 2020  res,.           
+00010000: 2020 2020 2020 2020 2020 2020 2073 6967               sig
+00010010: 6d61 3d73 6967 6d61 5f69 6e69 2f35 2c0a  ma=sigma_ini/5,.
+00010020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010030: 2020 2020 2020 2020 6d69 6e5f 7369 676d          min_sigm
+00010040: 613d 7369 676d 615f 696e 692f 3230 2c0a  a=sigma_ini/20,.
+00010050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010060: 2020 2020 2020 2020 6d61 785f 7369 676d          max_sigm
+00010070: 613d 7369 676d 615f 696e 692f 322c 0a20  a=sigma_ini/2,. 
+00010080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010090: 2020 2020 2020 2061 6d70 6c69 7475 6465         amplitude
+000100a0: 3d63 616c 635f 4331 335f 616d 706c 6974  =calc_C13_amplit
+000100b0: 7564 652c 0a20 2020 2020 2020 2020 2020  ude,.           
+000100c0: 2020 2020 2020 2020 2020 2020 206d 696e               min
+000100d0: 5f61 6d70 6c69 7475 6465 3d63 616c 635f  _amplitude=calc_
+000100e0: 4331 335f 616d 706c 6974 7564 652a 2830  C13_amplitude*(0
+000100f0: 2e35 2a63 6f6e 6669 6731 2e48 425f 616d  .5*config1.HB_am
+00010100: 705f 6d69 6e5f 616c 6c6f 7761 6e63 6529  p_min_allowance)
+00010110: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010120: 2020 2020 2020 2020 2020 6d61 785f 616d            max_am
+00010130: 706c 6974 7564 653d 6361 6c63 5f43 3133  plitude=calc_C13
+00010140: 5f61 6d70 6c69 7475 6465 2a32 2a28 636f  _amplitude*2*(co
+00010150: 6e66 6967 312e 4842 5f61 6d70 5f6d 6178  nfig1.HB_amp_max
+00010160: 5f61 6c6c 6f77 616e 6365 292c 0a20 2020  _allowance),.   
 00010170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010180: 7265 7375 6c74 2e70 6172 616d 735b 276c  result.params['l
-00010190: 7a33 5f63 656e 7465 7227 5d2e 7661 7279  z3_center'].vary
-000101a0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-000101b0: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-000101c0: 7061 7261 6d73 5b27 6c7a 335f 616d 706c  params['lz3_ampl
-000101d0: 6974 7564 6527 5d2e 7661 7279 203d 2046  itude'].vary = F
-000101e0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-000101f0: 2020 2020 2072 6573 756c 742e 7061 7261       result.para
-00010200: 6d73 5b27 6c7a 335f 7369 676d 6127 5d2e  ms['lz3_sigma'].
-00010210: 7661 7279 203d 2046 616c 7365 0a20 2020  vary = False.   
-00010220: 2020 2020 2020 2020 2020 2020 2066 696e               fin
-00010230: 616c 5f72 6573 756c 7420 3d20 6d6f 6465  al_result = mode
-00010240: 6c5f 462e 6669 7428 7964 6174 2c20 7265  l_F.fit(ydat, re
-00010250: 7375 6c74 2e70 6172 616d 732c 2078 3d78  sult.params, x=x
-00010260: 6461 7429 0a20 2020 2020 2020 2020 2020  dat).           
-00010270: 2020 2020 2070 6172 616d 732e 7570 6461       params.upda
-00010280: 7465 2866 696e 616c 5f72 6573 756c 742e  te(final_result.
-00010290: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
-000102a0: 2020 2020 2020 2020 7061 7261 6d73 2e75          params.u
-000102b0: 7064 6174 6528 6669 6e61 6c5f 7265 7375  pdate(final_resu
-000102c0: 6c74 2e70 6172 616d 7329 0a20 2020 2020  lt.params).     
-000102d0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-000102e0: 743d 6669 6e61 6c5f 7265 7375 6c74 0a0a  t=final_result..
-000102f0: 0a0a 0a20 2020 2023 2053 616d 652c 2062  ...    # Same, b
-00010300: 7574 2061 6c73 6f20 7769 7468 2061 2047  ut also with a G
-00010310: 6175 7373 6961 6e20 4261 636b 6772 6f75  aussian Backgrou
-00010320: 6e64 0a20 2020 2069 6620 636f 6e66 6967  nd.    if config
-00010330: 312e 6669 745f 6761 7573 7320 6973 206e  1.fit_gauss is n
-00010340: 6f74 2046 616c 7365 3a0a 0a0a 2020 2020  ot False:...    
-00010350: 2020 2020 2320 6d61 6b69 6e67 2074 6865      # making the
-00010360: 2067 6175 7373 6961 6e20 6d6f 6465 6c0a   gaussian model.
-00010370: 2020 2020 2020 2020 6d6f 6465 6c31 203d          model1 =
-00010380: 2047 6175 7373 6961 6e4d 6f64 656c 2870   GaussianModel(p
-00010390: 7265 6669 783d 2762 6b67 5f27 290a 2020  refix='bkg_').  
-000103a0: 2020 2020 2020 7061 7261 6d73 203d 206d        params = m
-000103b0: 6f64 656c 312e 6d61 6b65 5f70 6172 616d  odel1.make_param
-000103c0: 7328 290a 2020 2020 2020 2020 7061 7261  s().        para
-000103d0: 6d73 5b27 626b 675f 272b 2761 6d70 6c69  ms['bkg_'+'ampli
-000103e0: 7475 6465 275d 2e73 6574 2863 6f6e 6669  tude'].set(confi
-000103f0: 6731 2e67 6175 7373 5f61 6d70 2c20 6d69  g1.gauss_amp, mi
-00010400: 6e3d 636f 6e66 6967 312e 6761 7573 735f  n=config1.gauss_
-00010410: 616d 702f 3130 302c 206d 6178 3d63 6f6e  amp/100, max=con
-00010420: 6669 6731 2e67 6175 7373 5f61 6d70 2a31  fig1.gauss_amp*1
-00010430: 3029 0a20 2020 2020 2020 2070 6172 616d  0).        param
-00010440: 735b 2762 6b67 5f27 2b27 7369 676d 6127  s['bkg_'+'sigma'
-00010450: 5d2e 7365 7428 7369 676d 615f 696e 692a  ].set(sigma_ini*
-00010460: 3135 2c20 6d69 6e3d 7369 676d 615f 696e  15, min=sigma_in
-00010470: 692a 3130 2c20 6d61 783d 7369 676d 615f  i*10, max=sigma_
-00010480: 696e 692a 3235 290a 2020 2020 2020 2020  ini*25).        
-00010490: 7061 7261 6d73 5b27 626b 675f 272b 2763  params['bkg_'+'c
-000104a0: 656e 7465 7227 5d2e 7365 7428 696e 6974  enter'].set(init
-000104b0: 6961 6c5f 6775 6573 732c 206d 696e 3d69  ial_guess, min=i
-000104c0: 6e69 7469 616c 5f67 7565 7373 2d37 2c20  nitial_guess-7, 
-000104d0: 6d61 783d 696e 6974 6961 6c5f 6775 6573  max=initial_gues
-000104e0: 732b 3729 0a0a 0a0a 2020 2020 2020 2020  s+7)....        
-000104f0: 6966 2066 6974 5f70 6561 6b73 3d3d 323a  if fit_peaks==2:
-00010500: 0a20 2020 2020 2020 2020 2020 2070 6561  .            pea
-00010510: 6b5f 706f 735f 766f 6967 743d 6e70 2e61  k_pos_voigt=np.a
-00010520: 7272 6179 285b 696e 6974 6961 6c5f 6775  rray([initial_gu
-00010530: 6573 732c 2048 425f 696e 6974 6961 6c5f  ess, HB_initial_
-00010540: 6775 6573 735d 290a 0a20 2020 2020 2020  guess])..       
-00010550: 2020 2020 2066 6f72 2069 2c20 6365 6e20       for i, cen 
-00010560: 696e 2065 6e75 6d65 7261 7465 2870 6561  in enumerate(pea
-00010570: 6b5f 706f 735f 766f 6967 7429 3a0a 2020  k_pos_voigt):.  
-00010580: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00010590: 2069 3d3d 303a 2023 2054 6869 7320 6973   i==0: # This is
-000105a0: 2074 6865 2044 6961 640a 2020 2020 2020   the Diad.      
-000105b0: 2020 2020 2020 2020 2020 2020 2020 7065                pe
-000105c0: 616b 2c20 7061 7273 203d 2061 6464 5f70  ak, pars = add_p
-000105d0: 6561 6b28 7072 6566 6978 3d27 6c7a 2564  eak(prefix='lz%d
-000105e0: 5f27 2025 2028 692b 3129 2c0a 2020 2020  _' % (i+1),.    
-000105f0: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
-00010600: 6572 3d43 656e 7465 725f 696e 692c 206d  er=Center_ini, m
-00010610: 696e 5f63 656e 743d 6365 6e2d 332a 7370  in_cent=cen-3*sp
-00010620: 6563 5f72 6573 2c20 6d61 785f 6365 6e74  ec_res, max_cent
-00010630: 3d63 656e 2b33 2a73 7065 635f 7265 732c  =cen+3*spec_res,
-00010640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010650: 2073 6967 6d61 3d63 6f6e 6669 6731 2e64   sigma=config1.d
-00010660: 6961 645f 7369 676d 612c 0a20 2020 2020  iad_sigma,.     
-00010670: 2020 2020 2020 2020 2020 206d 6178 5f73             max_s
-00010680: 6967 6d61 3d63 6f6e 6669 6731 2e64 6961  igma=config1.dia
-00010690: 645f 7369 676d 612a 636f 6e66 6967 312e  d_sigma*config1.
-000106a0: 6469 6164 5f73 6967 6d61 5f6d 6178 5f61  diad_sigma_max_a
-000106b0: 6c6c 6f77 616e 6365 2c0a 2020 2020 2020  llowance,.      
-000106c0: 2020 2020 2020 2020 2020 6d69 6e5f 7369            min_si
-000106d0: 676d 613d 636f 6e66 6967 312e 6469 6164  gma=config1.diad
-000106e0: 5f73 6967 6d61 2a63 6f6e 6669 6731 2e64  _sigma*config1.d
-000106f0: 6961 645f 7369 676d 615f 6d69 6e5f 616c  iad_sigma_min_al
-00010700: 6c6f 7761 6e63 652c 0a20 2020 2020 2020  lowance,.       
-00010710: 2020 2020 2020 2020 2061 6d70 6c69 7475           amplitu
-00010720: 6465 3d63 616c 635f 6469 6164 5f61 6d70  de=calc_diad_amp
-00010730: 6c69 7475 6465 2c20 6d69 6e5f 616d 706c  litude, min_ampl
-00010740: 6974 7564 653d 302c 206d 6178 5f61 6d70  itude=0, max_amp
-00010750: 6c69 7475 6465 3d31 302a 6361 6c63 5f64  litude=10*calc_d
-00010760: 6961 645f 616d 706c 6974 7564 652c 0a20  iad_amplitude,. 
-00010770: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00010780: 6f64 656c 5f6e 616d 653d 636f 6e66 6967  odel_name=config
-00010790: 312e 6d6f 6465 6c5f 6e61 6d65 290a 2020  1.model_name).  
-000107a0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-000107b0: 6465 6c20 3d20 7065 616b 2b6d 6f64 656c  del = peak+model
-000107c0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-000107d0: 2020 7061 7261 6d73 2e75 7064 6174 6528    params.update(
-000107e0: 7061 7273 290a 0a20 2020 2020 2020 2020  pars)..         
-000107f0: 2020 2020 2020 2069 6620 693d 3d31 3a20         if i==1: 
-00010800: 2320 5468 6973 2069 7320 7468 6520 686f  # This is the ho
-00010810: 7462 616e 640a 2020 2020 2020 2020 2020  tband.          
-00010820: 2020 2020 2020 2020 2020 7065 616b 2c20            peak, 
-00010830: 7061 7273 203d 2061 6464 5f70 6561 6b28  pars = add_peak(
-00010840: 7072 6566 6978 3d27 6c7a 2564 5f27 2025  prefix='lz%d_' %
-00010850: 2028 692b 3129 2c20 6365 6e74 6572 3d63   (i+1), center=c
-00010860: 656e 2c0a 2020 2020 2020 2020 2020 2020  en,.            
-00010870: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
-00010880: 6365 6e74 3d63 656e 2d33 2a73 7065 635f  cent=cen-3*spec_
-00010890: 7265 732c 206d 6178 5f63 656e 743d 6365  res, max_cent=ce
-000108a0: 6e2b 332a 7370 6563 5f72 6573 2c20 7369  n+3*spec_res, si
-000108b0: 676d 613d 7369 676d 615f 696e 692c 0a20  gma=sigma_ini,. 
-000108c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000108d0: 2020 2020 2020 206d 696e 5f73 6967 6d61         min_sigma
-000108e0: 3d73 6967 6d61 5f69 6e69 2a63 6f6e 6669  =sigma_ini*confi
-000108f0: 6731 2e48 425f 7369 676d 615f 6d69 6e5f  g1.HB_sigma_min_
-00010900: 616c 6c6f 7761 6e63 652c 0a20 2020 2020  allowance,.     
-00010910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010920: 2020 206d 6178 5f73 6967 6d61 3d73 6967     max_sigma=sig
-00010930: 6d61 5f69 6e69 2a63 6f6e 6669 6731 2e48  ma_ini*config1.H
-00010940: 425f 7369 676d 615f 6d61 785f 616c 6c6f  B_sigma_max_allo
-00010950: 7761 6e63 652c 0a20 2020 2020 2020 2020  wance,.         
-00010960: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00010970: 6d70 6c69 7475 6465 3d63 616c 635f 4842  mplitude=calc_HB
-00010980: 5f61 6d70 6c69 7475 6465 2c0a 2020 2020  _amplitude,.    
-00010990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109a0: 2020 2020 6d69 6e5f 616d 706c 6974 7564      min_amplitud
-000109b0: 653d 416d 706c 6974 7564 655f 696e 692a  e=Amplitude_ini*
-000109c0: 636f 6e66 6967 312e 4842 5f61 6d70 5f6d  config1.HB_amp_m
-000109d0: 696e 5f61 6c6c 6f77 616e 6365 2c0a 2020  in_allowance,.  
+00010180: 2020 2020 206d 6f64 656c 5f6e 616d 653d       model_name=
+00010190: 636f 6e66 6967 312e 6d6f 6465 6c5f 6e61  config1.model_na
+000101a0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+000101b0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+000101c0: 6c20 3d20 7065 616b 2b6d 6f64 656c 0a20  l = peak+model. 
+000101d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101e0: 2020 2020 2020 2070 6172 616d 732e 7570         params.up
+000101f0: 6461 7465 2870 6172 7329 0a0a 0a0a 0a20  date(pars)..... 
+00010200: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00010210: 6f64 656c 5f46 3d6d 6f64 656c 0a0a 0a0a  odel_F=model....
+00010220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010230: 2320 4174 7465 6d70 7420 6174 2073 7461  # Attempt at sta
+00010240: 6269 6c69 7a69 6e67 2070 6561 6b20 6669  bilizing peak fi
+00010250: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00010260: 2020 7265 7375 6c74 203d 206d 6f64 656c    result = model
+00010270: 5f46 2e66 6974 2879 6461 742c 2070 6172  _F.fit(ydat, par
+00010280: 7331 2c20 783d 7864 6174 290a 2020 2020  s1, x=xdat).    
+00010290: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+000102a0: 6c74 2e70 6172 616d 735b 276c 7a32 5f63  lt.params['lz2_c
+000102b0: 656e 7465 7227 5d2e 7661 7279 203d 2046  enter'].vary = F
+000102c0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+000102d0: 2020 2020 2072 6573 756c 742e 7061 7261       result.para
+000102e0: 6d73 5b27 6c7a 325f 616d 706c 6974 7564  ms['lz2_amplitud
+000102f0: 6527 5d2e 7661 7279 203d 2046 616c 7365  e'].vary = False
+00010300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010310: 2072 6573 756c 742e 7061 7261 6d73 5b27   result.params['
+00010320: 6c7a 325f 7369 676d 6127 5d2e 7661 7279  lz2_sigma'].vary
+00010330: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00010340: 2020 2020 2020 2020 2072 6573 756c 742e           result.
+00010350: 7061 7261 6d73 5b27 6c7a 335f 6365 6e74  params['lz3_cent
+00010360: 6572 275d 2e76 6172 7920 3d20 4661 6c73  er'].vary = Fals
+00010370: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00010380: 2020 7265 7375 6c74 2e70 6172 616d 735b    result.params[
+00010390: 276c 7a33 5f61 6d70 6c69 7475 6465 275d  'lz3_amplitude']
+000103a0: 2e76 6172 7920 3d20 4661 6c73 650a 2020  .vary = False.  
+000103b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000103c0: 7375 6c74 2e70 6172 616d 735b 276c 7a33  sult.params['lz3
+000103d0: 5f73 6967 6d61 275d 2e76 6172 7920 3d20  _sigma'].vary = 
+000103e0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+000103f0: 2020 2020 2020 6669 6e61 6c5f 7265 7375        final_resu
+00010400: 6c74 203d 206d 6f64 656c 5f46 2e66 6974  lt = model_F.fit
+00010410: 2879 6461 742c 2072 6573 756c 742e 7061  (ydat, result.pa
+00010420: 7261 6d73 2c20 783d 7864 6174 290a 2020  rams, x=xdat).  
+00010430: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00010440: 7261 6d73 2e75 7064 6174 6528 6669 6e61  rams.update(fina
+00010450: 6c5f 7265 7375 6c74 2e70 6172 616d 7329  l_result.params)
+00010460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010470: 2070 6172 616d 732e 7570 6461 7465 2866   params.update(f
+00010480: 696e 616c 5f72 6573 756c 742e 7061 7261  inal_result.para
+00010490: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
+000104a0: 2020 2020 7265 7375 6c74 3d66 696e 616c      result=final
+000104b0: 5f72 6573 756c 740a 0a0a 0a0a 2020 2020  _result.....    
+000104c0: 2320 5361 6d65 2c20 6275 7420 616c 736f  # Same, but also
+000104d0: 2077 6974 6820 6120 4761 7573 7369 616e   with a Gaussian
+000104e0: 2042 6163 6b67 726f 756e 640a 2020 2020   Background.    
+000104f0: 6966 2063 6f6e 6669 6731 2e66 6974 5f67  if config1.fit_g
+00010500: 6175 7373 2069 7320 6e6f 7420 4661 6c73  auss is not Fals
+00010510: 653a 0a0a 0a20 2020 2020 2020 2023 206d  e:...        # m
+00010520: 616b 696e 6720 7468 6520 6761 7573 7369  aking the gaussi
+00010530: 616e 206d 6f64 656c 0a20 2020 2020 2020  an model.       
+00010540: 206d 6f64 656c 3120 3d20 4761 7573 7369   model1 = Gaussi
+00010550: 616e 4d6f 6465 6c28 7072 6566 6978 3d27  anModel(prefix='
+00010560: 626b 675f 2729 0a20 2020 2020 2020 2070  bkg_').        p
+00010570: 6172 616d 7320 3d20 6d6f 6465 6c31 2e6d  arams = model1.m
+00010580: 616b 655f 7061 7261 6d73 2829 0a20 2020  ake_params().   
+00010590: 2020 2020 2070 6172 616d 735b 2762 6b67       params['bkg
+000105a0: 5f27 2b27 616d 706c 6974 7564 6527 5d2e  _'+'amplitude'].
+000105b0: 7365 7428 636f 6e66 6967 312e 6761 7573  set(config1.gaus
+000105c0: 735f 616d 702c 206d 696e 3d63 6f6e 6669  s_amp, min=confi
+000105d0: 6731 2e67 6175 7373 5f61 6d70 2f31 3030  g1.gauss_amp/100
+000105e0: 2c20 6d61 783d 636f 6e66 6967 312e 6761  , max=config1.ga
+000105f0: 7573 735f 616d 702a 3130 290a 2020 2020  uss_amp*10).    
+00010600: 2020 2020 7061 7261 6d73 5b27 626b 675f      params['bkg_
+00010610: 272b 2773 6967 6d61 275d 2e73 6574 2873  '+'sigma'].set(s
+00010620: 6967 6d61 5f69 6e69 2a31 352c 206d 696e  igma_ini*15, min
+00010630: 3d73 6967 6d61 5f69 6e69 2a31 302c 206d  =sigma_ini*10, m
+00010640: 6178 3d73 6967 6d61 5f69 6e69 2a32 3529  ax=sigma_ini*25)
+00010650: 0a20 2020 2020 2020 2070 6172 616d 735b  .        params[
+00010660: 2762 6b67 5f27 2b27 6365 6e74 6572 275d  'bkg_'+'center']
+00010670: 2e73 6574 2869 6e69 7469 616c 5f67 7565  .set(initial_gue
+00010680: 7373 2c20 6d69 6e3d 696e 6974 6961 6c5f  ss, min=initial_
+00010690: 6775 6573 732d 372c 206d 6178 3d69 6e69  guess-7, max=ini
+000106a0: 7469 616c 5f67 7565 7373 2b37 290a 0a0a  tial_guess+7)...
+000106b0: 0a20 2020 2020 2020 2069 6620 6669 745f  .        if fit_
+000106c0: 7065 616b 733d 3d32 3a0a 2020 2020 2020  peaks==2:.      
+000106d0: 2020 2020 2020 7065 616b 5f70 6f73 5f76        peak_pos_v
+000106e0: 6f69 6774 3d6e 702e 6172 7261 7928 5b69  oigt=np.array([i
+000106f0: 6e69 7469 616c 5f67 7565 7373 2c20 4842  nitial_guess, HB
+00010700: 5f69 6e69 7469 616c 5f67 7565 7373 5d29  _initial_guess])
+00010710: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00010720: 7220 692c 2063 656e 2069 6e20 656e 756d  r i, cen in enum
+00010730: 6572 6174 6528 7065 616b 5f70 6f73 5f76  erate(peak_pos_v
+00010740: 6f69 6774 293a 0a20 2020 2020 2020 2020  oigt):.         
+00010750: 2020 2020 2020 2069 6620 693d 3d30 3a20         if i==0: 
+00010760: 2320 5468 6973 2069 7320 7468 6520 4469  # This is the Di
+00010770: 6164 0a20 2020 2020 2020 2020 2020 2020  ad.             
+00010780: 2020 2020 2020 2070 6561 6b2c 2070 6172         peak, par
+00010790: 7320 3d20 6164 645f 7065 616b 2870 7265  s = add_peak(pre
+000107a0: 6669 783d 276c 7a25 645f 2720 2520 2869  fix='lz%d_' % (i
+000107b0: 2b31 292c 0a20 2020 2020 2020 2020 2020  +1),.           
+000107c0: 2020 2020 2063 656e 7465 723d 4365 6e74       center=Cent
+000107d0: 6572 5f69 6e69 2c20 6d69 6e5f 6365 6e74  er_ini, min_cent
+000107e0: 3d63 656e 2d33 2a73 7065 635f 7265 732c  =cen-3*spec_res,
+000107f0: 206d 6178 5f63 656e 743d 6365 6e2b 332a   max_cent=cen+3*
+00010800: 7370 6563 5f72 6573 2c0a 2020 2020 2020  spec_res,.      
+00010810: 2020 2020 2020 2020 2020 7369 676d 613d            sigma=
+00010820: 636f 6e66 6967 312e 6469 6164 5f73 6967  config1.diad_sig
+00010830: 6d61 2c0a 2020 2020 2020 2020 2020 2020  ma,.            
+00010840: 2020 2020 6d61 785f 7369 676d 613d 636f      max_sigma=co
+00010850: 6e66 6967 312e 6469 6164 5f73 6967 6d61  nfig1.diad_sigma
+00010860: 2a63 6f6e 6669 6731 2e64 6961 645f 7369  *config1.diad_si
+00010870: 676d 615f 6d61 785f 616c 6c6f 7761 6e63  gma_max_allowanc
+00010880: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00010890: 2020 206d 696e 5f73 6967 6d61 3d63 6f6e     min_sigma=con
+000108a0: 6669 6731 2e64 6961 645f 7369 676d 612a  fig1.diad_sigma*
+000108b0: 636f 6e66 6967 312e 6469 6164 5f73 6967  config1.diad_sig
+000108c0: 6d61 5f6d 696e 5f61 6c6c 6f77 616e 6365  ma_min_allowance
+000108d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000108e0: 2020 616d 706c 6974 7564 653d 6361 6c63    amplitude=calc
+000108f0: 5f64 6961 645f 616d 706c 6974 7564 652c  _diad_amplitude,
+00010900: 206d 696e 5f61 6d70 6c69 7475 6465 3d30   min_amplitude=0
+00010910: 2c20 6d61 785f 616d 706c 6974 7564 653d  , max_amplitude=
+00010920: 3130 2a63 616c 635f 6469 6164 5f61 6d70  10*calc_diad_amp
+00010930: 6c69 7475 6465 2c0a 2020 2020 2020 2020  litude,.        
+00010940: 2020 2020 2020 2020 6d6f 6465 6c5f 6e61          model_na
+00010950: 6d65 3d63 6f6e 6669 6731 2e6d 6f64 656c  me=config1.model
+00010960: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
+00010970: 2020 2020 2020 206d 6f64 656c 203d 2070         model = p
+00010980: 6561 6b2b 6d6f 6465 6c31 0a20 2020 2020  eak+model1.     
+00010990: 2020 2020 2020 2020 2020 2070 6172 616d             param
+000109a0: 732e 7570 6461 7465 2870 6172 7329 0a0a  s.update(pars)..
+000109b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000109c0: 6966 2069 3d3d 313a 2023 2054 6869 7320  if i==1: # This 
+000109d0: 6973 2074 6865 2068 6f74 6261 6e64 0a20  is the hotband. 
 000109e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109f0: 2020 2020 2020 6d61 785f 616d 706c 6974        max_amplit
-00010a00: 7564 653d 416d 706c 6974 7564 655f 696e  ude=Amplitude_in
-00010a10: 692a 636f 6e66 6967 312e 4842 5f61 6d70  i*config1.HB_amp
-00010a20: 5f6d 6178 5f61 6c6c 6f77 616e 6365 2c0a  _max_allowance,.
+000109f0: 2020 2070 6561 6b2c 2070 6172 7320 3d20     peak, pars = 
+00010a00: 6164 645f 7065 616b 2870 7265 6669 783d  add_peak(prefix=
+00010a10: 276c 7a25 645f 2720 2520 2869 2b31 292c  'lz%d_' % (i+1),
+00010a20: 2063 656e 7465 723d 6365 6e2c 0a20 2020   center=cen,.   
 00010a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a40: 2020 2020 2020 2020 6d6f 6465 6c5f 6e61          model_na
-00010a50: 6d65 3d63 6f6e 6669 6731 2e6d 6f64 656c  me=config1.model
-00010a60: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
-00010a70: 2020 2020 2020 2020 2020 206d 6f64 656c             model
-00010a80: 3220 3d20 7065 616b 2b6d 6f64 656c 0a20  2 = peak+model. 
+00010a40: 2020 2020 206d 696e 5f63 656e 743d 6365       min_cent=ce
+00010a50: 6e2d 332a 7370 6563 5f72 6573 2c20 6d61  n-3*spec_res, ma
+00010a60: 785f 6365 6e74 3d63 656e 2b33 2a73 7065  x_cent=cen+3*spe
+00010a70: 635f 7265 732c 2073 6967 6d61 3d73 6967  c_res, sigma=sig
+00010a80: 6d61 5f69 6e69 2c0a 2020 2020 2020 2020  ma_ini,.        
 00010a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010aa0: 2020 2070 6172 616d 732e 7570 6461 7465     params.update
-00010ab0: 2870 6172 7329 0a0a 0a20 2020 2020 2020  (pars)...       
-00010ac0: 2020 2020 2023 2041 7474 656d 7074 2061       # Attempt a
-00010ad0: 7420 7374 6162 696c 697a 696e 6720 7065  t stabilizing pe
-00010ae0: 616b 2066 6974 0a23 2075 7064 6174 696e  ak fit.# updatin
-00010af0: 6720 7061 7273 2031 2077 6974 6820 7661  g pars 1 with va
-00010b00: 6c75 6573 2069 6e20 7061 7273 0a0a 2020  lues in pars..  
-00010b10: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00010b20: 203d 206d 6f64 656c 322e 6669 7428 7964   = model2.fit(yd
-00010b30: 6174 2c20 7061 7261 6d73 2c20 783d 7864  at, params, x=xd
-00010b40: 6174 290a 0a0a 2020 2020 2020 2020 2020  at)...          
-00010b50: 2020 2320 5365 7420 7468 6520 7061 7261    # Set the para
-00010b60: 6d65 7465 7273 206f 6620 276c 7a31 2720  meters of 'lz1' 
-00010b70: 746f 2062 6520 6669 7865 640a 2020 2020  to be fixed.    
-00010b80: 2020 2020 2020 2020 7265 7375 6c74 2e70          result.p
-00010b90: 6172 616d 735b 276c 7a32 5f63 656e 7465  arams['lz2_cente
-00010ba0: 7227 5d2e 7661 7279 203d 2046 616c 7365  r'].vary = False
-00010bb0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00010bc0: 756c 742e 7061 7261 6d73 5b27 6c7a 325f  ult.params['lz2_
-00010bd0: 616d 706c 6974 7564 6527 5d2e 7661 7279  amplitude'].vary
-00010be0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00010bf0: 2020 2020 2072 6573 756c 742e 7061 7261       result.para
-00010c00: 6d73 5b27 6c7a 325f 7369 676d 6127 5d2e  ms['lz2_sigma'].
-00010c10: 7661 7279 203d 2046 616c 7365 0a20 2020  vary = False.   
-00010c20: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-00010c30: 7061 7261 6d73 5b27 626b 675f 6365 6e74  params['bkg_cent
-00010c40: 6572 275d 2e76 6172 7920 3d20 4661 6c73  er'].vary = Fals
-00010c50: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
-00010c60: 7375 6c74 2e70 6172 616d 735b 2762 6b67  sult.params['bkg
-00010c70: 5f61 6d70 6c69 7475 6465 275d 2e76 6172  _amplitude'].var
-00010c80: 7920 3d20 4661 6c73 650a 2020 2020 2020  y = False.      
-00010c90: 2020 2020 2020 7265 7375 6c74 2e70 6172        result.par
-00010ca0: 616d 735b 2762 6b67 5f73 6967 6d61 275d  ams['bkg_sigma']
-00010cb0: 2e76 6172 7920 3d20 4661 6c73 650a 0a20  .vary = False.. 
-00010cc0: 2020 2020 2020 2020 2020 2023 2050 6572             # Per
-00010cd0: 666f 726d 2066 6974 7469 6e67 2075 7369  form fitting usi
-00010ce0: 6e67 2074 6865 2065 6e74 6972 6520 6d6f  ng the entire mo
-00010cf0: 6465 6c20 286d 6f64 656c 3229 2077 6974  del (model2) wit
-00010d00: 6820 7468 6520 7374 6162 696c 697a 6564  h the stabilized
-00010d10: 2027 6c7a 3127 2070 6172 616d 6574 6572   'lz1' parameter
-00010d20: 730a 2020 2020 2020 2020 2020 2020 6669  s.            fi
-00010d30: 6e61 6c5f 7265 7375 6c74 203d 206d 6f64  nal_result = mod
-00010d40: 656c 322e 6669 7428 7964 6174 2c20 7265  el2.fit(ydat, re
-00010d50: 7375 6c74 2e70 6172 616d 732c 2078 3d78  sult.params, x=x
-00010d60: 6461 7429 0a20 2020 2020 2020 2020 2020  dat).           
-00010d70: 2063 656e 7465 725f 6572 726f 7220 3d20   center_error = 
-00010d80: 6669 6e61 6c5f 7265 7375 6c74 2e70 6172  final_result.par
-00010d90: 616d 735b 276c 7a31 5f63 656e 7465 7227  ams['lz1_center'
-00010da0: 5d2e 7374 6465 7272 0a20 2020 2020 2020  ].stderr.       
-00010db0: 2020 2020 2070 6172 616d 732e 7570 6461       params.upda
-00010dc0: 7465 2866 696e 616c 5f72 6573 756c 742e  te(final_result.
-00010dd0: 7061 7261 6d73 290a 0a0a 2020 2020 2020  params)...      
-00010de0: 2020 2020 2020 7265 7375 6c74 3d66 696e        result=fin
-00010df0: 616c 5f72 6573 756c 740a 2020 2020 2020  al_result.      
-00010e00: 2020 2020 2020 6d6f 6465 6c5f 463d 6d6f        model_F=mo
-00010e10: 6465 6c32 0a0a 0a20 2020 2020 2020 2069  del2...        i
-00010e20: 6620 6669 745f 7065 616b 733d 3d33 3a0a  f fit_peaks==3:.
-00010e30: 2020 2020 2020 2020 2020 2020 7065 616b              peak
-00010e40: 5f70 6f73 5f76 6f69 6774 3d6e 702e 6172  _pos_voigt=np.ar
-00010e50: 7261 7928 5b69 6e69 7469 616c 5f67 7565  ray([initial_gue
-00010e60: 7373 2c20 4842 5f69 6e69 7469 616c 5f67  ss, HB_initial_g
-00010e70: 7565 7373 2c20 4331 335f 696e 6974 6961  uess, C13_initia
-00010e80: 6c5f 6775 6573 735d 290a 0a20 2020 2020  l_guess])..     
-00010e90: 2020 2020 2020 2066 6f72 2069 2c20 6365         for i, ce
-00010ea0: 6e20 696e 2065 6e75 6d65 7261 7465 2870  n in enumerate(p
-00010eb0: 6561 6b5f 706f 735f 766f 6967 7429 3a0a  eak_pos_voigt):.
-00010ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010ed0: 2069 6620 693d 3d30 3a20 2320 5468 6973   if i==0: # This
-00010ee0: 2069 7320 7468 6520 4469 6164 0a20 2020   is the Diad.   
-00010ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f00: 2070 6561 6b2c 2070 6172 7320 3d20 6164   peak, pars = ad
-00010f10: 645f 7065 616b 2870 7265 6669 783d 276c  d_peak(prefix='l
-00010f20: 7a25 645f 2720 2520 2869 2b31 292c 0a20  z%d_' % (i+1),. 
-00010f30: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00010f40: 656e 7465 723d 4365 6e74 6572 5f69 6e69  enter=Center_ini
-00010f50: 2c20 6d69 6e5f 6365 6e74 3d63 656e 2d33  , min_cent=cen-3
-00010f60: 2a73 7065 635f 7265 732c 206d 6178 5f63  *spec_res, max_c
-00010f70: 656e 743d 6365 6e2b 332a 7370 6563 5f72  ent=cen+3*spec_r
-00010f80: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-00010f90: 2020 2020 7369 676d 613d 636f 6e66 6967      sigma=config
-00010fa0: 312e 6469 6164 5f73 6967 6d61 2c0a 2020  1.diad_sigma,.  
-00010fb0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-00010fc0: 785f 7369 676d 613d 636f 6e66 6967 312e  x_sigma=config1.
-00010fd0: 6469 6164 5f73 6967 6d61 2a63 6f6e 6669  diad_sigma*confi
-00010fe0: 6731 2e64 6961 645f 7369 676d 615f 6d61  g1.diad_sigma_ma
-00010ff0: 785f 616c 6c6f 7761 6e63 652c 0a20 2020  x_allowance,.   
-00011000: 2020 2020 2020 2020 2020 2020 206d 696e               min
-00011010: 5f73 6967 6d61 3d63 6f6e 6669 6731 2e64  _sigma=config1.d
-00011020: 6961 645f 7369 676d 612a 636f 6e66 6967  iad_sigma*config
-00011030: 312e 6469 6164 5f73 6967 6d61 5f6d 696e  1.diad_sigma_min
-00011040: 5f61 6c6c 6f77 616e 6365 2c0a 2020 2020  _allowance,.    
-00011050: 2020 2020 2020 2020 2020 2020 616d 706c              ampl
-00011060: 6974 7564 653d 6361 6c63 5f64 6961 645f  itude=calc_diad_
-00011070: 616d 706c 6974 7564 652c 206d 696e 5f61  amplitude, min_a
-00011080: 6d70 6c69 7475 6465 3d30 2c20 6d61 785f  mplitude=0, max_
-00011090: 616d 706c 6974 7564 653d 3130 2a63 616c  amplitude=10*cal
-000110a0: 635f 6469 6164 5f61 6d70 6c69 7475 6465  c_diad_amplitude
-000110b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000110c0: 2020 6d6f 6465 6c5f 6e61 6d65 3d63 6f6e    model_name=con
-000110d0: 6669 6731 2e6d 6f64 656c 5f6e 616d 6529  fig1.model_name)
-000110e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000110f0: 206d 6f64 656c 203d 2070 6561 6b2b 6d6f   model = peak+mo
-00011100: 6465 6c31 0a20 2020 2020 2020 2020 2020  del1.           
-00011110: 2020 2020 2070 6172 616d 732e 7570 6461       params.upda
-00011120: 7465 2870 6172 7329 0a0a 2020 2020 2020  te(pars)..      
-00011130: 2020 2020 2020 2020 2020 6966 2069 3d3d            if i==
-00011140: 313a 2023 2054 6869 7320 6973 2074 6865  1: # This is the
-00011150: 2068 6f74 6261 6e64 0a0a 2020 2020 2020   hotband..      
-00011160: 2020 2020 2020 2020 2020 2020 2020 7065                pe
-00011170: 616b 2c20 7061 7273 203d 2061 6464 5f70  ak, pars = add_p
-00011180: 6561 6b28 7072 6566 6978 3d27 6c7a 2564  eak(prefix='lz%d
-00011190: 5f27 2025 2028 692b 3129 2c20 6365 6e74  _' % (i+1), cent
-000111a0: 6572 3d63 656e 2c0a 2020 2020 2020 2020  er=cen,.        
-000111b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000111c0: 6d69 6e5f 6365 6e74 3d63 656e 2d33 2a73  min_cent=cen-3*s
-000111d0: 7065 635f 7265 732c 206d 6178 5f63 656e  pec_res, max_cen
-000111e0: 743d 6365 6e2b 332a 7370 6563 5f72 6573  t=cen+3*spec_res
-000111f0: 2c20 7369 676d 613d 7369 676d 615f 696e  , sigma=sigma_in
-00011200: 692c 0a20 2020 2020 2020 2020 2020 2020  i,.             
-00011210: 2020 2020 2020 2020 2020 206d 696e 5f73             min_s
-00011220: 6967 6d61 3d73 6967 6d61 5f69 6e69 2a63  igma=sigma_ini*c
-00011230: 6f6e 6669 6731 2e48 425f 7369 676d 615f  onfig1.HB_sigma_
-00011240: 6d69 6e5f 616c 6c6f 7761 6e63 652c 0a20  min_allowance,. 
-00011250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011260: 2020 2020 2020 206d 6178 5f73 6967 6d61         max_sigma
-00011270: 3d73 6967 6d61 5f69 6e69 2a63 6f6e 6669  =sigma_ini*confi
-00011280: 6731 2e48 425f 7369 676d 615f 6d61 785f  g1.HB_sigma_max_
-00011290: 616c 6c6f 7761 6e63 652c 0a20 2020 2020  allowance,.     
-000112a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112b0: 2020 2061 6d70 6c69 7475 6465 3d63 616c     amplitude=cal
-000112c0: 635f 4842 5f61 6d70 6c69 7475 6465 2c0a  c_HB_amplitude,.
-000112d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112e0: 2020 2020 2020 2020 6d69 6e5f 616d 706c          min_ampl
-000112f0: 6974 7564 653d 416d 706c 6974 7564 655f  itude=Amplitude_
-00011300: 696e 692a 636f 6e66 6967 312e 4842 5f61  ini*config1.HB_a
-00011310: 6d70 5f6d 696e 5f61 6c6c 6f77 616e 6365  mp_min_allowance
-00011320: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00011330: 2020 2020 2020 2020 2020 6d61 785f 616d            max_am
-00011340: 706c 6974 7564 653d 416d 706c 6974 7564  plitude=Amplitud
-00011350: 655f 696e 692a 636f 6e66 6967 312e 4842  e_ini*config1.HB
-00011360: 5f61 6d70 5f6d 6178 5f61 6c6c 6f77 616e  _amp_max_allowan
-00011370: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-00011380: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-00011390: 6c5f 6e61 6d65 3d63 6f6e 6669 6731 2e6d  l_name=config1.m
-000113a0: 6f64 656c 5f6e 616d 6529 0a20 2020 2020  odel_name).     
-000113b0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000113c0: 6f64 656c 3220 3d20 7065 616b 2b6d 6f64  odel2 = peak+mod
-000113d0: 656c 0a20 2020 2020 2020 2020 2020 2020  el.             
-000113e0: 2020 2020 2020 2070 6172 616d 732e 7570         params.up
-000113f0: 6461 7465 2870 6172 7329 0a0a 2020 2020  date(pars)..    
-00011400: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00011410: 3d3d 323a 2023 2054 6869 7320 6973 2063  ==2: # This is c
-00011420: 3133 0a20 2020 2020 2020 2020 2020 2020  13.             
-00011430: 2020 2020 2020 2070 6561 6b2c 2070 6172         peak, par
-00011440: 7320 3d20 6164 645f 7065 616b 2870 7265  s = add_peak(pre
-00011450: 6669 783d 276c 7a25 645f 2720 2520 2869  fix='lz%d_' % (i
-00011460: 2b31 292c 2063 656e 7465 723d 6365 6e2c  +1), center=cen,
-00011470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011480: 2020 2020 2020 2020 206d 696e 5f63 656e           min_cen
-00011490: 743d 6365 6e2d 332a 7370 6563 5f72 6573  t=cen-3*spec_res
-000114a0: 2c20 6d61 785f 6365 6e74 3d63 656e 2b33  , max_cent=cen+3
-000114b0: 2a73 7065 635f 7265 732c 0a20 2020 2020  *spec_res,.     
-000114c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000114d0: 2020 2073 6967 6d61 3d73 6967 6d61 5f69     sigma=sigma_i
-000114e0: 6e69 2f35 2c0a 2020 2020 2020 2020 2020  ni/5,.          
-000114f0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-00011500: 6e5f 7369 676d 613d 7369 676d 615f 696e  n_sigma=sigma_in
-00011510: 692f 3230 2c0a 2020 2020 2020 2020 2020  i/20,.          
-00011520: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-00011530: 785f 7369 676d 613d 7369 676d 615f 696e  x_sigma=sigma_in
-00011540: 692f 322c 0a20 2020 2020 2020 2020 2020  i/2,.           
-00011550: 2020 2020 2020 2020 2020 2020 2061 6d70               amp
-00011560: 6c69 7475 6465 3d63 616c 635f 4331 335f  litude=calc_C13_
-00011570: 616d 706c 6974 7564 652c 0a20 2020 2020  amplitude,.     
-00011580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011590: 2020 206d 696e 5f61 6d70 6c69 7475 6465     min_amplitude
-000115a0: 3d63 616c 635f 4331 335f 616d 706c 6974  =calc_C13_amplit
-000115b0: 7564 652a 2830 2e35 2a63 6f6e 6669 6731  ude*(0.5*config1
-000115c0: 2e48 425f 616d 705f 6d69 6e5f 616c 6c6f  .HB_amp_min_allo
-000115d0: 7761 6e63 6529 2c0a 2020 2020 2020 2020  wance),.        
-000115e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000115f0: 6d61 785f 616d 706c 6974 7564 653d 6361  max_amplitude=ca
-00011600: 6c63 5f43 3133 5f61 6d70 6c69 7475 6465  lc_C13_amplitude
-00011610: 2a32 2a28 636f 6e66 6967 312e 4842 5f61  *2*(config1.HB_a
-00011620: 6d70 5f6d 6178 5f61 6c6c 6f77 616e 6365  mp_max_allowance
-00011630: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00011640: 2020 2020 2020 2020 2020 206d 6f64 656c             model
-00011650: 5f6e 616d 653d 636f 6e66 6967 312e 6d6f  _name=config1.mo
-00011660: 6465 6c5f 6e61 6d65 290a 2020 2020 2020  del_name).      
-00011670: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-00011680: 6465 6c33 203d 2070 6561 6b2b 6d6f 6465  del3 = peak+mode
-00011690: 6c32 0a20 2020 2020 2020 2020 2020 2020  l2.             
-000116a0: 2020 2020 2020 2070 6172 616d 732e 7570         params.up
-000116b0: 6461 7465 2870 6172 7329 0a0a 2020 2020  date(pars)..    
-000116c0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-000116d0: 206d 6f64 656c 332e 6669 7428 7964 6174   model3.fit(ydat
-000116e0: 2c20 7061 7261 6d73 2c20 783d 7864 6174  , params, x=xdat
-000116f0: 290a 0a0a 2020 2020 2020 2020 2020 2020  )...            
-00011700: 2320 5365 7420 7468 6520 7061 7261 6d65  # Set the parame
-00011710: 7465 7273 206f 6620 276c 7a31 2720 746f  ters of 'lz1' to
-00011720: 2062 6520 6669 7865 640a 2020 2020 2020   be fixed.      
-00011730: 2020 2020 2020 7265 7375 6c74 2e70 6172        result.par
-00011740: 616d 735b 276c 7a32 5f63 656e 7465 7227  ams['lz2_center'
-00011750: 5d2e 7661 7279 203d 2046 616c 7365 0a20  ].vary = False. 
-00011760: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00011770: 742e 7061 7261 6d73 5b27 6c7a 325f 616d  t.params['lz2_am
-00011780: 706c 6974 7564 6527 5d2e 7661 7279 203d  plitude'].vary =
-00011790: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-000117a0: 2020 2072 6573 756c 742e 7061 7261 6d73     result.params
-000117b0: 5b27 6c7a 325f 7369 676d 6127 5d2e 7661  ['lz2_sigma'].va
-000117c0: 7279 203d 2046 616c 7365 0a20 2020 2020  ry = False.     
-000117d0: 2020 2020 2020 2072 6573 756c 742e 7061         result.pa
-000117e0: 7261 6d73 5b27 6c7a 335f 6365 6e74 6572  rams['lz3_center
-000117f0: 275d 2e76 6172 7920 3d20 4661 6c73 650a  '].vary = False.
-00011800: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00011810: 6c74 2e70 6172 616d 735b 276c 7a33 5f61  lt.params['lz3_a
-00011820: 6d70 6c69 7475 6465 275d 2e76 6172 7920  mplitude'].vary 
-00011830: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00011840: 2020 2020 7265 7375 6c74 2e70 6172 616d      result.param
-00011850: 735b 276c 7a33 5f73 6967 6d61 275d 2e76  s['lz3_sigma'].v
-00011860: 6172 7920 3d20 4661 6c73 650a 2020 2020  ary = False.    
-00011870: 2020 2020 2020 2020 7265 7375 6c74 2e70          result.p
-00011880: 6172 616d 735b 2762 6b67 5f63 656e 7465  arams['bkg_cente
-00011890: 7227 5d2e 7661 7279 203d 2046 616c 7365  r'].vary = False
-000118a0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000118b0: 756c 742e 7061 7261 6d73 5b27 626b 675f  ult.params['bkg_
-000118c0: 616d 706c 6974 7564 6527 5d2e 7661 7279  amplitude'].vary
-000118d0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-000118e0: 2020 2020 2072 6573 756c 742e 7061 7261       result.para
-000118f0: 6d73 5b27 626b 675f 7369 676d 6127 5d2e  ms['bkg_sigma'].
-00011900: 7661 7279 203d 2046 616c 7365 0a0a 2020  vary = False..  
-00011910: 2020 2020 2020 2020 2020 2320 5065 7266            # Perf
-00011920: 6f72 6d20 6669 7474 696e 6720 7573 696e  orm fitting usin
-00011930: 6720 7468 6520 656e 7469 7265 206d 6f64  g the entire mod
-00011940: 656c 2028 6d6f 6465 6c32 2920 7769 7468  el (model2) with
-00011950: 2074 6865 2073 7461 6269 6c69 7a65 6420   the stabilized 
-00011960: 276c 7a31 2720 7061 7261 6d65 7465 7273  'lz1' parameters
-00011970: 0a20 2020 2020 2020 2020 2020 2066 696e  .            fin
-00011980: 616c 5f72 6573 756c 7420 3d20 6d6f 6465  al_result = mode
-00011990: 6c33 2e66 6974 2879 6461 742c 2072 6573  l3.fit(ydat, res
-000119a0: 756c 742e 7061 7261 6d73 2c20 783d 7864  ult.params, x=xd
-000119b0: 6174 290a 2020 2020 2020 2020 2020 2020  at).            
-000119c0: 6365 6e74 6572 5f65 7272 6f72 203d 2066  center_error = f
-000119d0: 696e 616c 5f72 6573 756c 742e 7061 7261  inal_result.para
-000119e0: 6d73 5b27 6c7a 315f 6365 6e74 6572 275d  ms['lz1_center']
-000119f0: 2e73 7464 6572 720a 0a20 2020 2020 2020  .stderr..       
-00011a00: 2020 2020 2072 6573 756c 743d 6669 6e61       result=fina
-00011a10: 6c5f 7265 7375 6c74 0a20 2020 2020 2020  l_result.       
-00011a20: 2020 2020 206d 6f64 656c 5f46 3d6d 6f64       model_F=mod
-00011a30: 656c 330a 0a20 2020 2020 2020 2020 2020  el3..           
-00011a40: 2070 6172 616d 732e 7570 6461 7465 2866   params.update(f
-00011a50: 696e 616c 5f72 6573 756c 742e 7061 7261  inal_result.para
-00011a60: 6d73 290a 0a0a 0a0a 0a0a 0a0a 0a20 2020  ms)..........   
-00011a70: 2023 2052 6567 6172 646c 6573 7320 6f66   # Regardless of
-00011a80: 2066 6974 2c20 6576 616c 7561 7465 206d   fit, evaluate m
-00011a90: 6f64 656c 0a20 2020 2069 6e69 7420 3d20  odel.    init = 
-00011aa0: 6d6f 6465 6c5f 462e 6576 616c 2870 6172  model_F.eval(par
-00011ab0: 616d 732c 2078 3d78 6461 7429 0a20 2020  ams, x=xdat).   
-00011ac0: 2072 6573 756c 7420 3d20 6d6f 6465 6c5f   result = model_
-00011ad0: 462e 6669 7428 7964 6174 2c20 7061 7261  F.fit(ydat, para
-00011ae0: 6d73 2c20 783d 7864 6174 290a 2020 2020  ms, x=xdat).    
-00011af0: 636f 6d70 7320 3d20 7265 7375 6c74 2e65  comps = result.e
-00011b00: 7661 6c5f 636f 6d70 6f6e 656e 7473 2829  val_components()
-00011b10: 0a0a 2020 2020 2370 7269 6e74 2872 6573  ..    #print(res
-00011b20: 756c 742e 6369 5f72 6570 6f72 7428 2929  ult.ci_report())
-00011b30: 0a0a 2020 2020 2370 7269 6e74 2872 6573  ..    #print(res
-00011b40: 756c 742e 636f 6e66 5f69 6e74 6572 7661  ult.conf_interva
-00011b50: 6c28 6d65 7468 6f64 3d27 626f 6f74 7374  l(method='bootst
-00011b60: 7261 7027 2929 0a0a 2020 2020 2370 7269  rap'))..    #pri
-00011b70: 6e74 2872 6573 756c 742e 6669 745f 7265  nt(result.fit_re
-00011b80: 706f 7274 286d 696e 5f63 6f72 7265 6c3d  port(min_correl=
-00011b90: 302e 3529 290a 2020 2020 2320 4368 6563  0.5)).    # Chec
-00011ba0: 6b20 6966 2066 756e 6374 696f 6e20 6769  k if function gi
-00011bb0: 7665 7320 6572 726f 7220 6261 7273 0a0a  ves error bars..
-00011bc0: 0a20 2020 2023 7072 696e 7428 7265 7375  .    #print(resu
-00011bd0: 6c74 2e62 6573 745f 7661 6c75 6573 290a  lt.best_values).
-00011be0: 2020 2020 2320 4765 7420 6669 7273 7420      # Get first 
-00011bf0: 7065 616b 2063 656e 7465 720a 2020 2020  peak center.    
-00011c00: 5065 616b 315f 4365 6e74 3d72 6573 756c  Peak1_Cent=resul
-00011c10: 742e 6265 7374 5f76 616c 7565 732e 6765  t.best_values.ge
-00011c20: 7428 276c 7a31 5f63 656e 7465 7227 290a  t('lz1_center').
-00011c30: 2020 2020 5065 616b 315f 496e 743d 7265      Peak1_Int=re
-00011c40: 7375 6c74 2e62 6573 745f 7661 6c75 6573  sult.best_values
-00011c50: 2e67 6574 2827 6c7a 315f 616d 706c 6974  .get('lz1_amplit
-00011c60: 7564 6527 290a 2020 2020 5065 616b 315f  ude').    Peak1_
-00011c70: 5369 676d 613d 7265 7375 6c74 2e62 6573  Sigma=result.bes
-00011c80: 745f 7661 6c75 6573 2e67 6574 2827 6c7a  t_values.get('lz
-00011c90: 315f 7369 676d 6127 290a 2020 2020 5065  1_sigma').    Pe
-00011ca0: 616b 315f 6761 6d6d 613d 7265 7375 6c74  ak1_gamma=result
-00011cb0: 2e62 6573 745f 7661 6c75 6573 2e67 6574  .best_values.get
-00011cc0: 2827 6c7a 315f 6761 6d6d 6127 290a 2020  ('lz1_gamma').  
-00011cd0: 2020 5065 616b 315f 5072 6f70 5f4c 6f72    Peak1_Prop_Lor
-00011ce0: 3d72 6573 756c 742e 6265 7374 5f76 616c  =result.best_val
-00011cf0: 7565 732e 6765 7428 276c 7a31 5f66 7261  ues.get('lz1_fra
-00011d00: 6374 696f 6e27 290a 2020 2020 5065 616b  ction').    Peak
-00011d10: 315f 6677 686d 3d72 6573 756c 742e 7061  1_fwhm=result.pa
-00011d20: 7261 6d73 5b27 6c7a 315f 6677 686d 275d  rams['lz1_fwhm']
-00011d30: 2e76 616c 7565 0a0a 0a20 2020 2065 7272  .value...    err
-00011d40: 6f72 5f70 6b32 203d 2072 6573 756c 742e  or_pk2 = result.
-00011d50: 7061 7261 6d73 5b27 6c7a 315f 6365 6e74  params['lz1_cent
-00011d60: 6572 275d 2e73 7464 6572 720a 0a0a 0a20  er'].stderr.... 
-00011d70: 2020 2078 5f6c 696e 3d6e 702e 6c69 6e73     x_lin=np.lins
-00011d80: 7061 6365 2873 7061 6e5b 305d 2c20 7370  pace(span[0], sp
-00011d90: 616e 5b31 5d2c 2032 3030 3029 0a20 2020  an[1], 2000).   
-00011da0: 2079 5f62 6573 745f 6669 743d 7265 7375   y_best_fit=resu
-00011db0: 6c74 2e65 7661 6c28 783d 785f 6c69 6e29  lt.eval(x=x_lin)
-00011dc0: 0a20 2020 2063 6f6d 706f 6e65 6e74 733d  .    components=
-00011dd0: 7265 7375 6c74 2e65 7661 6c5f 636f 6d70  result.eval_comp
-00011de0: 6f6e 656e 7473 2878 3d78 5f6c 696e 290a  onents(x=x_lin).
-00011df0: 0a0a 0a0a 2020 2020 6966 2063 6f6e 6669  ....    if confi
-00011e00: 6731 2e66 6974 5f67 6175 7373 2069 7320  g1.fit_gauss is 
-00011e10: 6e6f 7420 4661 6c73 653a 0a20 2020 2020  not False:.     
-00011e20: 2020 2047 6175 7373 5f63 656e 743d 7265     Gauss_cent=re
-00011e30: 7375 6c74 2e62 6573 745f 7661 6c75 6573  sult.best_values
-00011e40: 2e67 6574 2827 626b 675f 6365 6e74 6572  .get('bkg_center
-00011e50: 2729 0a20 2020 2020 2020 2047 6175 7373  ').        Gauss
-00011e60: 5f61 6d70 3d72 6573 756c 742e 6265 7374  _amp=result.best
-00011e70: 5f76 616c 7565 732e 6765 7428 2762 6b67  _values.get('bkg
-00011e80: 5f61 6d70 6c69 7475 6465 2729 0a20 2020  _amplitude').   
-00011e90: 2020 2020 2047 6175 7373 5f73 6967 6d61       Gauss_sigma
-00011ea0: 3d72 6573 756c 742e 6265 7374 5f76 616c  =result.best_val
-00011eb0: 7565 732e 6765 7428 2762 6b67 5f73 6967  ues.get('bkg_sig
-00011ec0: 6d61 2729 0a0a 2020 2020 2020 2020 6d61  ma')..        ma
-00011ed0: 785f 4761 7573 733d 6e70 2e6d 6178 2863  x_Gauss=np.max(c
-00011ee0: 6f6d 706f 6e65 6e74 732e 6765 7428 2762  omponents.get('b
-00011ef0: 6b67 5f27 2929 0a20 2020 2020 2020 206d  kg_')).        m
-00011f00: 6178 5f76 6f69 6774 3d6e 702e 6d61 7828  ax_voigt=np.max(
-00011f10: 636f 6d70 6f6e 656e 7473 2e67 6574 2827  components.get('
-00011f20: 6c7a 315f 2729 290a 2020 2020 2020 2020  lz1_')).        
-00011f30: 6966 206d 6178 5f47 6175 7373 3e6d 6178  if max_Gauss>max
-00011f40: 5f76 6f69 6774 2f35 3a0a 2020 2020 2020  _voigt/5:.      
-00011f50: 2020 2020 2020 7265 6669 745f 7061 7261        refit_para
-00011f60: 6d3d 7374 7228 7265 6669 745f 7061 7261  m=str(refit_para
-00011f70: 6d29 2b20 2720 475f 6869 6768 6572 5f74  m)+ ' G_higher_t
-00011f80: 6861 6e5f 6469 6164 270a 2020 2020 2020  han_diad'.      
-00011f90: 2020 2320 6966 2047 6175 7373 5f73 6967    # if Gauss_sig
-00011fa0: 6d61 3e3d 2863 6f6e 6669 6731 2e67 6175  ma>=(config1.gau
-00011fb0: 7373 5f73 6967 6d61 2a31 302d 302e 3129  ss_sigma*10-0.1)
-00011fc0: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
-00011fd0: 7265 6669 743d 5472 7565 0a20 2020 2020  refit=True.     
-00011fe0: 2020 2023 2020 2020 2072 6566 6974 5f70     #     refit_p
-00011ff0: 6172 616d 3d73 7472 2872 6566 6974 5f70  aram=str(refit_p
-00012000: 6172 616d 292b 2720 475f 696e 7075 745f  aram)+' G_input_
-00012010: 546f 6f4c 6f77 5369 676d 6127 0a20 2020  TooLowSigma'.   
-00012020: 2020 2020 2023 2069 6620 4761 7573 735f       # if Gauss_
-00012030: 7369 676d 613c 3d28 636f 6e66 6967 312e  sigma<=(config1.
-00012040: 6761 7573 735f 7369 676d 612f 3130 2b30  gauss_sigma/10+0
-00012050: 2e31 293a 0a20 2020 2020 2020 2023 2020  .1):.        #  
-00012060: 2020 2072 6566 6974 3d54 7275 650a 2020     refit=True.  
-00012070: 2020 2020 2020 2320 2020 2020 7265 6669        #     refi
-00012080: 745f 7061 7261 6d3d 7374 7228 7265 6669  t_param=str(refi
-00012090: 745f 7061 7261 6d29 2b20 2720 475f 696e  t_param)+ ' G_in
-000120a0: 7075 745f 546f 6f48 6967 6853 6967 6d61  put_TooHighSigma
-000120b0: 270a 2020 2020 2020 2020 230a 2020 2020  '.        #.    
-000120c0: 2020 2020 2320 6966 2047 6175 7373 5f61      # if Gauss_a
-000120d0: 6d70 3e3d 2863 6f6e 6669 6731 2e67 6175  mp>=(config1.gau
-000120e0: 7373 5f61 6d70 2a31 302d 302e 3129 3a0a  ss_amp*10-0.1):.
-000120f0: 2020 2020 2020 2020 2320 2020 2020 7265          #     re
-00012100: 6669 743d 5472 7565 0a20 2020 2020 2020  fit=True.       
-00012110: 2023 2020 2020 2072 6566 6974 5f70 6172   #     refit_par
-00012120: 616d 3d73 7472 2872 6566 6974 5f70 6172  am=str(refit_par
-00012130: 616d 292b 2720 475f 696e 7075 745f 546f  am)+' G_input_To
-00012140: 6f4c 6f77 416d 7027 0a20 2020 2020 2020  oLowAmp'.       
-00012150: 2023 2069 6620 4761 7573 735f 616d 703c   # if Gauss_amp<
-00012160: 3d28 636f 6e66 6967 312e 6761 7573 735f  =(config1.gauss_
-00012170: 7369 676d 612b 302e 3129 3a0a 2020 2020  sigma+0.1):.    
-00012180: 2020 2020 2320 2020 2020 7265 6669 743d      #     refit=
-00012190: 5472 7565 0a20 2020 2020 2020 2023 2020  True.        #  
-000121a0: 2020 2072 6566 6974 5f70 6172 616d 3d73     refit_param=s
-000121b0: 7472 2872 6566 6974 5f70 6172 616d 292b  tr(refit_param)+
-000121c0: 2720 475f 416d 705f 746f 6f5f 6869 6768  ' G_Amp_too_high
-000121d0: 270a 2020 2020 2020 2020 6966 2047 6175  '.        if Gau
-000121e0: 7373 5f63 656e 743c 3d28 636f 6e66 6967  ss_cent<=(config
-000121f0: 312e 6669 745f 6761 7573 732d 3330 2b30  1.fit_gauss-30+0
-00012200: 2e35 293a 0a20 2020 2020 2020 2020 2020  .5):.           
-00012210: 2072 6566 6974 3d54 7275 650a 2020 2020   refit=True.    
-00012220: 2020 2020 2020 2020 7265 6669 745f 7061          refit_pa
-00012230: 7261 6d3d 7374 7228 7265 6669 745f 7061  ram=str(refit_pa
-00012240: 7261 6d29 2b27 2047 5f49 6e70 7574 546f  ram)+' G_InputTo
-00012250: 6f4c 6f77 4365 6e74 270a 2020 2020 2020  oLowCent'.      
-00012260: 2020 6966 2047 6175 7373 5f63 656e 743e    if Gauss_cent>
-00012270: 3d28 696e 6974 6961 6c5f 6775 6573 732b  =(initial_guess+
-00012280: 3330 2d30 2e35 293a 0a20 2020 2020 2020  30-0.5):.       
-00012290: 2020 2020 2072 6566 6974 3d54 7275 650a       refit=True.
-000122a0: 2020 2020 2020 2020 2020 2020 7265 6669              refi
-000122b0: 745f 7061 7261 6d3d 7374 7228 7265 6669  t_param=str(refi
-000122c0: 745f 7061 7261 6d29 2b27 2047 5f49 6e70  t_param)+' G_Inp
-000122d0: 7574 546f 6f48 6967 6843 656e 7427 0a0a  utTooHighCent'..
-000122e0: 0a0a 0a0a 2020 2020 2320 7072 696e 7428  ....    # print(
-000122f0: 2766 7768 6d20 6761 7573 7327 290a 2020  'fwhm gauss').  
-00012300: 2020 2320 7072 696e 7428 7265 7375 6c74    # print(result
-00012310: 2e62 6573 745f 7661 6c75 6573 290a 0a0a  .best_values)...
-00012320: 0a0a 2020 2020 230a 0a20 2020 2023 2057  ..    #..    # W
-00012330: 6f72 6b20 6f75 7420 7768 6174 2070 6561  ork out what pea
-00012340: 6b20 6973 2077 6861 740a 2020 2020 6966  k is what.    if
-00012350: 2064 6961 6432 2069 7320 5472 7565 3a0a   diad2 is True:.
-00012360: 0a20 2020 2020 2020 2069 6620 6669 745f  .        if fit_
-00012370: 7065 616b 733d 3d31 3a0a 0a20 2020 2020  peaks==1:..     
-00012380: 2020 2020 2020 2050 6561 6b32 5f43 656e         Peak2_Cen
-00012390: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-000123a0: 2020 2050 6561 6b33 5f43 656e 743d 4e6f     Peak3_Cent=No
-000123b0: 6e65 0a20 2020 2020 2020 2020 2020 2061  ne.            a
-000123c0: 7831 5f78 6c69 6d3d 5b43 656e 7465 725f  x1_xlim=[Center_
-000123d0: 696e 692d 3135 2c20 4365 6e74 6572 5f69  ini-15, Center_i
-000123e0: 6e69 2b31 355d 0a20 2020 2020 2020 2020  ni+15].         
-000123f0: 2020 2061 7832 5f78 6c69 6d3d 5b43 656e     ax2_xlim=[Cen
-00012400: 7465 725f 696e 692d 3135 2c20 4365 6e74  ter_ini-15, Cent
-00012410: 6572 5f69 6e69 2b31 355d 0a0a 2020 2020  er_ini+15]..    
-00012420: 2020 2020 6966 2066 6974 5f70 6561 6b73      if fit_peaks
-00012430: 3d3d 323a 0a0a 2020 2020 2020 2020 2020  ==2:..          
-00012440: 2020 5065 616b 325f 4365 6e74 3d72 6573    Peak2_Cent=res
-00012450: 756c 742e 6265 7374 5f76 616c 7565 732e  ult.best_values.
-00012460: 6765 7428 276c 7a32 5f63 656e 7465 7227  get('lz2_center'
-00012470: 290a 2020 2020 2020 2020 2020 2020 5065  ).            Pe
-00012480: 616b 325f 496e 743d 7265 7375 6c74 2e62  ak2_Int=result.b
-00012490: 6573 745f 7661 6c75 6573 2e67 6574 2827  est_values.get('
-000124a0: 6c7a 325f 616d 706c 6974 7564 6527 290a  lz2_amplitude').
-000124b0: 2020 2020 2020 2020 2020 2020 5065 616b              Peak
-000124c0: 325f 5369 676d 613d 7265 7375 6c74 2e62  2_Sigma=result.b
-000124d0: 6573 745f 7661 6c75 6573 2e67 6574 2827  est_values.get('
-000124e0: 6c7a 325f 7369 676d 6127 290a 2020 2020  lz2_sigma').    
-000124f0: 2020 2020 2020 2020 5065 616b 335f 4365          Peak3_Ce
-00012500: 6e74 3d4e 6f6e 650a 2020 2020 2020 2020  nt=None.        
-00012510: 2020 2020 6178 315f 786c 696d 3d5b 4365      ax1_xlim=[Ce
-00012520: 6e74 6572 5f69 6e69 2d31 352c 2043 656e  nter_ini-15, Cen
-00012530: 7465 725f 696e 692b 3330 5d0a 2020 2020  ter_ini+30].    
-00012540: 2020 2020 2020 2020 6178 325f 786c 696d          ax2_xlim
-00012550: 3d5b 4365 6e74 6572 5f69 6e69 2d31 352c  =[Center_ini-15,
-00012560: 2043 656e 7465 725f 696e 692b 3330 5d0a   Center_ini+30].
-00012570: 0a20 2020 2020 2020 2069 6620 6669 745f  .        if fit_
-00012580: 7065 616b 733d 3d33 3a0a 0a20 2020 2020  peaks==3:..     
-00012590: 2020 2020 2020 2050 6561 6b32 5f43 656e         Peak2_Cen
-000125a0: 743d 7265 7375 6c74 2e62 6573 745f 7661  t=result.best_va
-000125b0: 6c75 6573 2e67 6574 2827 6c7a 325f 6365  lues.get('lz2_ce
-000125c0: 6e74 6572 2729 0a20 2020 2020 2020 2020  nter').         
-000125d0: 2020 2050 6561 6b32 5f49 6e74 3d72 6573     Peak2_Int=res
-000125e0: 756c 742e 6265 7374 5f76 616c 7565 732e  ult.best_values.
-000125f0: 6765 7428 276c 7a32 5f61 6d70 6c69 7475  get('lz2_amplitu
-00012600: 6465 2729 0a20 2020 2020 2020 2020 2020  de').           
-00012610: 2050 6561 6b32 5f53 6967 6d61 3d72 6573   Peak2_Sigma=res
-00012620: 756c 742e 6265 7374 5f76 616c 7565 732e  ult.best_values.
-00012630: 6765 7428 276c 7a32 5f73 6967 6d61 2729  get('lz2_sigma')
-00012640: 0a20 2020 2020 2020 2020 2020 2050 6561  .            Pea
-00012650: 6b33 5f43 656e 743d 7265 7375 6c74 2e62  k3_Cent=result.b
-00012660: 6573 745f 7661 6c75 6573 2e67 6574 2827  est_values.get('
-00012670: 6c7a 335f 6365 6e74 6572 2729 0a20 2020  lz3_center').   
-00012680: 2020 2020 2020 2020 2050 6561 6b33 5f49           Peak3_I
-00012690: 6e74 3d72 6573 756c 742e 6265 7374 5f76  nt=result.best_v
-000126a0: 616c 7565 732e 6765 7428 276c 7a33 5f61  alues.get('lz3_a
-000126b0: 6d70 6c69 7475 6465 2729 0a20 2020 2020  mplitude').     
-000126c0: 2020 2020 2020 2050 6561 6b33 5f53 6967         Peak3_Sig
-000126d0: 6d61 3d72 6573 756c 742e 6265 7374 5f76  ma=result.best_v
-000126e0: 616c 7565 732e 6765 7428 276c 7a33 5f73  alues.get('lz3_s
-000126f0: 6967 6d61 2729 0a0a 2020 2020 2020 2020  igma')..        
-00012700: 2020 2020 6178 315f 786c 696d 3d5b 4365      ax1_xlim=[Ce
-00012710: 6e74 6572 5f69 6e69 2d33 302c 2043 656e  nter_ini-30, Cen
-00012720: 7465 725f 696e 692b 3330 5d0a 2020 2020  ter_ini+30].    
-00012730: 2020 2020 2020 2020 6178 325f 786c 696d          ax2_xlim
-00012740: 3d5b 4365 6e74 6572 5f69 6e69 2d33 302c  =[Center_ini-30,
-00012750: 2043 656e 7465 725f 696e 692b 3330 5d0a   Center_ini+30].
-00012760: 0a20 2020 2020 2020 2069 6620 5065 616b  .        if Peak
-00012770: 325f 4365 6e74 2069 7320 4e6f 6e65 3a0a  2_Cent is None:.
-00012780: 2020 2020 2020 2020 2020 2020 6466 5f6f              df_o
-00012790: 7574 3d70 642e 4461 7461 4672 616d 6528  ut=pd.DataFrame(
-000127a0: 6461 7461 3d7b 2744 6961 6432 5f56 6f69  data={'Diad2_Voi
-000127b0: 6774 5f43 656e 7427 3a20 5065 616b 315f  gt_Cent': Peak1_
-000127c0: 4365 6e74 2c0a 2020 2020 2020 2020 2020  Cent,.          
-000127d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127e0: 2020 2020 2020 2020 2020 2744 6961 6432            'Diad2
-000127f0: 5f63 656e 745f 6572 7227 3a20 6572 726f  _cent_err': erro
-00012800: 725f 706b 322c 0a20 2020 2020 2020 2020  r_pk2,.         
-00012810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012820: 2020 2020 2020 2020 2020 2027 4469 6164             'Diad
-00012830: 325f 566f 6967 745f 4172 6561 273a 2050  2_Voigt_Area': P
-00012840: 6561 6b31 5f49 6e74 2c0a 2020 2020 2020  eak1_Int,.      
-00012850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012860: 2020 2020 2020 2020 2020 2744 6961 6432            'Diad2
-00012870: 5f56 6f69 6774 5f53 6967 6d61 273a 2050  _Voigt_Sigma': P
-00012880: 6561 6b31 5f53 6967 6d61 2c0a 2020 2020  eak1_Sigma,.    
-00012890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000128a0: 2020 2020 2020 2020 2020 2020 2744 6961              'Dia
-000128b0: 6432 5f56 6f69 6774 5f47 616d 6d61 273a  d2_Voigt_Gamma':
-000128c0: 2050 6561 6b31 5f67 616d 6d61 2c0a 0a0a   Peak1_gamma,...
-000128d0: 2020 2020 2020 2020 2020 2020 7d2c 2069              }, i
-000128e0: 6e64 6578 3d5b 305d 290a 0a20 2020 2020  ndex=[0])..     
-000128f0: 2020 2069 6620 5065 616b 325f 4365 6e74     if Peak2_Cent
-00012900: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 0a0a   is not None:...
-00012910: 2020 2020 2020 2020 2020 2020 6966 2050              if P
-00012920: 6561 6b33 5f43 656e 7420 6973 204e 6f6e  eak3_Cent is Non
-00012930: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00012940: 2020 2050 6561 6b73 3d6e 702e 6172 7261     Peaks=np.arra
-00012950: 7928 5b50 6561 6b31 5f43 656e 742c 2050  y([Peak1_Cent, P
-00012960: 6561 6b32 5f43 656e 745d 290a 2020 2020  eak2_Cent]).    
-00012970: 2020 2020 2020 2020 2020 2020 2320 4469              # Di
-00012980: 6164 2069 7320 6c6f 7765 7220 7065 616b  ad is lower peak
-00012990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000129a0: 2044 6961 6432 5f43 656e 743d 6e70 2e6d   Diad2_Cent=np.m
-000129b0: 696e 2850 6561 6b73 290a 2020 2020 2020  in(Peaks).      
-000129c0: 2020 2020 2020 2020 2020 2320 486f 7420            # Hot 
-000129d0: 6261 6e64 2069 7320 7570 7065 7220 7065  band is upper pe
-000129e0: 616b 270a 2020 2020 2020 2020 2020 2020  ak'.            
-000129f0: 2020 2020 4842 325f 4365 6e74 3d6e 702e      HB2_Cent=np.
-00012a00: 6d61 7828 5065 616b 7329 0a20 2020 2020  max(Peaks).     
-00012a10: 2020 2020 2020 2020 2020 2023 2041 6c6c             # All
-00012a20: 6f63 6174 6520 6172 6561 730a 2020 2020  ocate areas.    
-00012a30: 2020 2020 2020 2020 2020 2020 6966 2044              if D
-00012a40: 6961 6432 5f43 656e 743d 3d50 6561 6b32  iad2_Cent==Peak2
-00012a50: 5f43 656e 743a 0a20 2020 2020 2020 2020  _Cent:.         
-00012a60: 2020 2020 2020 2020 2020 2044 6961 6432             Diad2
-00012a70: 5f49 6e74 3d50 6561 6b32 5f49 6e74 0a20  _Int=Peak2_Int. 
-00012a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a90: 2020 2048 4232 5f49 6e74 3d50 6561 6b31     HB2_Int=Peak1
-00012aa0: 5f49 6e74 0a20 2020 2020 2020 2020 2020  _Int.           
-00012ab0: 2020 2020 2020 2020 2048 4232 5f53 6967           HB2_Sig
-00012ac0: 6d61 3d50 6561 6b31 5f53 6967 6d61 0a20  ma=Peak1_Sigma. 
-00012ad0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00012ae0: 6620 4469 6164 325f 4365 6e74 3d3d 5065  f Diad2_Cent==Pe
-00012af0: 616b 315f 4365 6e74 3a0a 2020 2020 2020  ak1_Cent:.      
-00012b00: 2020 2020 2020 2020 2020 2020 2020 4469                Di
-00012b10: 6164 325f 496e 743d 5065 616b 315f 496e  ad2_Int=Peak1_In
-00012b20: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-00012b30: 2020 2020 2020 4842 325f 496e 743d 5065        HB2_Int=Pe
-00012b40: 616b 325f 496e 740a 2020 2020 2020 2020  ak2_Int.        
-00012b50: 2020 2020 2020 2020 2020 2020 4842 325f              HB2_
-00012b60: 5369 676d 613d 5065 616b 325f 5369 676d  Sigma=Peak2_Sigm
-00012b70: 610a 0a0a 0a0a 2020 2020 2020 2020 2020  a.....          
-00012b80: 2020 6966 2050 6561 6b33 5f43 656e 7420    if Peak3_Cent 
-00012b90: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00012ba0: 2020 2020 2020 2020 2020 2020 2050 6561               Pea
-00012bb0: 6b73 3d6e 702e 6172 7261 7928 5b50 6561  ks=np.array([Pea
-00012bc0: 6b31 5f43 656e 742c 2050 6561 6b32 5f43  k1_Cent, Peak2_C
-00012bd0: 656e 742c 2050 6561 6b33 5f43 656e 745d  ent, Peak3_Cent]
-00012be0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00012bf0: 2020 2023 2043 3133 2069 7320 6c6f 7765     # C13 is lowe
-00012c00: 7220 7065 616b 0a20 2020 2020 2020 2020  r peak.         
-00012c10: 2020 2020 2020 2043 3133 5f43 656e 743d         C13_Cent=
-00012c20: 6e70 2e6d 696e 2850 6561 6b73 290a 2020  np.min(Peaks).  
-00012c30: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00012c40: 4469 6164 2069 7320 6d65 6469 756d 2070  Diad is medium p
-00012c50: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-00012c60: 2020 2020 4469 6164 325f 4365 6e74 3d6e      Diad2_Cent=n
-00012c70: 702e 6d65 6469 616e 2850 6561 6b73 290a  p.median(Peaks).
-00012c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c90: 2320 486f 7420 6261 6e64 2069 7320 7570  # Hot band is up
-00012ca0: 7065 7220 7065 616b 270a 2020 2020 2020  per peak'.      
-00012cb0: 2020 2020 2020 2020 2020 4842 325f 4365            HB2_Ce
-00012cc0: 6e74 3d6e 702e 6d61 7828 5065 616b 7329  nt=np.max(Peaks)
-00012cd0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012ce0: 2020 6966 2044 6961 6432 5f43 656e 743d    if Diad2_Cent=
-00012cf0: 3d50 6561 6b32 5f43 656e 743a 0a20 2020  =Peak2_Cent:.   
-00012d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d10: 2044 6961 6432 5f49 6e74 3d50 6561 6b32   Diad2_Int=Peak2
-00012d20: 5f49 6e74 0a20 2020 2020 2020 2020 2020  _Int.           
-00012d30: 2020 2020 2069 6620 4469 6164 325f 4365       if Diad2_Ce
-00012d40: 6e74 3d3d 5065 616b 315f 4365 6e74 3a0a  nt==Peak1_Cent:.
-00012d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d60: 2020 2020 4469 6164 325f 496e 743d 5065      Diad2_Int=Pe
-00012d70: 616b 315f 496e 740a 2020 2020 2020 2020  ak1_Int.        
-00012d80: 2020 2020 2020 2020 6966 2044 6961 6432          if Diad2
-00012d90: 5f43 656e 743d 3d50 6561 6b33 5f43 656e  _Cent==Peak3_Cen
-00012da0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00012db0: 2020 2020 2020 2044 6961 6432 5f49 6e74         Diad2_Int
-00012dc0: 3d50 6561 6b33 5f49 6e74 0a20 2020 2020  =Peak3_Int.     
-00012dd0: 2020 2020 2020 2020 2020 2023 2053 616d             # Sam
-00012de0: 6520 666f 7220 686f 7462 616e 640a 2020  e for hotband.  
-00012df0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00012e00: 2048 4232 5f43 656e 743d 3d50 6561 6b32   HB2_Cent==Peak2
-00012e10: 5f43 656e 743a 0a20 2020 2020 2020 2020  _Cent:.         
-00012e20: 2020 2020 2020 2020 2020 2048 4232 5f49             HB2_I
-00012e30: 6e74 3d50 6561 6b32 5f49 6e74 0a20 2020  nt=Peak2_Int.   
-00012e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e50: 2048 4232 5f53 6967 6d61 3d50 6561 6b32   HB2_Sigma=Peak2
-00012e60: 5f53 6967 6d61 0a20 2020 2020 2020 2020  _Sigma.         
-00012e70: 2020 2020 2020 2069 6620 4842 325f 4365         if HB2_Ce
-00012e80: 6e74 3d3d 5065 616b 315f 4365 6e74 3a0a  nt==Peak1_Cent:.
-00012e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ea0: 2020 2020 4842 325f 496e 743d 5065 616b      HB2_Int=Peak
-00012eb0: 315f 496e 740a 2020 2020 2020 2020 2020  1_Int.          
-00012ec0: 2020 2020 2020 2020 2020 4842 325f 5369            HB2_Si
-00012ed0: 676d 613d 5065 616b 315f 5369 676d 610a  gma=Peak1_Sigma.
-00012ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ef0: 6966 2048 4232 5f43 656e 743d 3d50 6561  if HB2_Cent==Pea
-00012f00: 6b33 5f43 656e 743a 0a20 2020 2020 2020  k3_Cent:.       
-00012f10: 2020 2020 2020 2020 2020 2020 2048 4232               HB2
-00012f20: 5f49 6e74 3d50 6561 6b33 5f49 6e74 0a20  _Int=Peak3_Int. 
-00012f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f40: 2020 2048 4232 5f53 6967 6d61 3d50 6561     HB2_Sigma=Pea
-00012f50: 6b32 5f53 6967 6d61 0a0a 0a20 2020 2020  k2_Sigma...     
-00012f60: 2020 2020 2020 2020 2020 2023 2053 616d             # Sam
-00012f70: 6520 666f 7220 4331 330a 2020 2020 2020  e for C13.      
-00012f80: 2020 2020 2020 2020 2020 6966 2043 3133            if C13
-00012f90: 5f43 656e 743d 3d50 6561 6b32 5f43 656e  _Cent==Peak2_Cen
-00012fa0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00012fb0: 2020 2020 2020 2043 3133 5f49 6e74 3d50         C13_Int=P
-00012fc0: 6561 6b32 5f49 6e74 0a20 2020 2020 2020  eak2_Int.       
-00012fd0: 2020 2020 2020 2020 2020 2020 2043 3133               C13
-00012fe0: 5f53 6967 6d61 3d50 6561 6b32 5f53 6967  _Sigma=Peak2_Sig
-00012ff0: 6d61 0a20 2020 2020 2020 2020 2020 2020  ma.             
-00013000: 2020 2069 6620 4331 335f 4365 6e74 3d3d     if C13_Cent==
-00013010: 5065 616b 315f 4365 6e74 3a0a 2020 2020  Peak1_Cent:.    
-00013020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013030: 4331 335f 496e 743d 5065 616b 315f 496e  C13_Int=Peak1_In
-00013040: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-00013050: 2020 2020 2020 4331 335f 5369 676d 613d        C13_Sigma=
-00013060: 5065 616b 315f 5369 676d 610a 2020 2020  Peak1_Sigma.    
-00013070: 2020 2020 2020 2020 2020 2020 6966 2043              if C
-00013080: 3133 5f43 656e 743d 3d50 6561 6b33 5f43  13_Cent==Peak3_C
-00013090: 656e 743a 0a20 2020 2020 2020 2020 2020  ent:.           
-000130a0: 2020 2020 2020 2020 2043 3133 5f49 6e74           C13_Int
-000130b0: 3d50 6561 6b33 5f49 6e74 0a20 2020 2020  =Peak3_Int.     
-000130c0: 2020 2020 2020 2020 2020 2020 2020 2043                 C
-000130d0: 3133 5f53 6967 6d61 3d50 6561 6b33 5f53  13_Sigma=Peak3_S
-000130e0: 6967 6d61 0a0a 2020 2020 2020 2020 2020  igma..          
-000130f0: 2020 6466 5f6f 7574 3d70 642e 4461 7461    df_out=pd.Data
-00013100: 4672 616d 6528 6461 7461 3d7b 2744 6961  Frame(data={'Dia
-00013110: 6432 5f56 6f69 6774 5f43 656e 7427 3a20  d2_Voigt_Cent': 
-00013120: 4469 6164 325f 4365 6e74 2c0a 2020 2020  Diad2_Cent,.    
-00013130: 2020 2020 2020 2020 2744 6961 6432 5f63          'Diad2_c
-00013140: 656e 745f 6572 7227 3a20 6572 726f 725f  ent_err': error_
-00013150: 706b 322c 0a20 2020 2020 2020 2020 2020  pk2,.           
-00013160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013170: 2020 2020 2020 2020 2027 4469 6164 325f           'Diad2_
-00013180: 566f 6967 745f 4172 6561 273a 2044 6961  Voigt_Area': Dia
-00013190: 6432 5f49 6e74 2c0a 2020 2020 2020 2020  d2_Int,.        
-000131a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131b0: 2020 2020 2020 2020 2020 2020 2744 6961              'Dia
-000131c0: 6432 5f56 6f69 6774 5f53 6967 6d61 273a  d2_Voigt_Sigma':
-000131d0: 2050 6561 6b31 5f53 6967 6d61 2c0a 2020   Peak1_Sigma,.  
-000131e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013200: 2020 2744 6961 6432 5f56 6f69 6774 5f47    'Diad2_Voigt_G
-00013210: 616d 6d61 273a 2050 6561 6b31 5f67 616d  amma': Peak1_gam
-00013220: 6d61 2c0a 2020 2020 2020 2020 2020 2020  ma,.            
-00013230: 7d2c 2069 6e64 6578 3d5b 305d 290a 0a20  }, index=[0]).. 
-00013240: 2020 2020 2020 2020 2020 2064 665f 6f75             df_ou
-00013250: 745b 2748 4232 5f43 656e 7427 5d3d 4842  t['HB2_Cent']=HB
-00013260: 325f 4365 6e74 0a20 2020 2020 2020 2020  2_Cent.         
-00013270: 2020 2064 665f 6f75 745b 2748 4232 5f41     df_out['HB2_A
-00013280: 7265 6127 5d3d 4842 325f 496e 740a 2020  rea']=HB2_Int.  
-00013290: 2020 2020 2020 2020 2020 6466 5f6f 7574            df_out
-000132a0: 5b27 4842 325f 5369 676d 6127 5d3d 4842  ['HB2_Sigma']=HB
-000132b0: 325f 5369 676d 610a 2020 2020 2020 2020  2_Sigma.        
-000132c0: 2020 2020 6966 2020 5065 616b 335f 4365      if  Peak3_Ce
-000132d0: 6e74 2069 7320 6e6f 7420 4e6f 6e65 3a0a  nt is not None:.
-000132e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132f0: 6466 5f6f 7574 5b27 4331 335f 4365 6e74  df_out['C13_Cent
-00013300: 275d 3d43 3133 5f43 656e 740a 2020 2020  ']=C13_Cent.    
-00013310: 2020 2020 2020 2020 2020 2020 6466 5f6f              df_o
-00013320: 7574 5b27 4331 335f 4172 6561 275d 3d43  ut['C13_Area']=C
-00013330: 3133 5f49 6e74 0a20 2020 2020 2020 2020  13_Int.         
-00013340: 2020 2020 2020 2064 665f 6f75 745b 2743         df_out['C
-00013350: 3133 5f53 6967 6d61 275d 3d43 3133 5f53  13_Sigma']=C13_S
-00013360: 6967 6d61 0a0a 2020 2020 2020 2020 7265  igma..        re
-00013370: 7375 6c74 5f64 6961 6432 5f6f 7269 6778  sult_diad2_origx
-00013380: 5f61 6c6c 3d72 6573 756c 742e 6576 616c  _all=result.eval
-00013390: 2878 3d78 6461 7429 0a20 2020 2020 2020  (x=xdat).       
-000133a0: 2023 2054 7269 6d20 746f 2062 6520 696e   # Trim to be in
-000133b0: 2072 616e 6765 0a20 2020 2020 2020 2023   range.        #
-000133c0: 7072 696e 7428 7265 7375 6c74 5f64 6961  print(result_dia
-000133d0: 6432 5f6f 7269 6778 5f61 6c6c 290a 2020  d2_origx_all).  
-000133e0: 2020 2020 2020 7265 7375 6c74 5f64 6961        result_dia
-000133f0: 6432 5f6f 7269 6778 3d72 6573 756c 745f  d2_origx=result_
-00013400: 6469 6164 325f 6f72 6967 785f 616c 6c5b  diad2_origx_all[
-00013410: 2878 6461 743e 7370 616e 5b30 5d29 2026  (xdat>span[0]) &
-00013420: 2028 7864 6174 3c73 7061 6e5b 315d 295d   (xdat<span[1])]
-00013430: 0a20 2020 2020 2020 2079 6461 745f 696e  .        ydat_in
-00013440: 7261 6e67 653d 7964 6174 5b28 7864 6174  range=ydat[(xdat
-00013450: 3e73 7061 6e5b 305d 2920 2620 2878 6461  >span[0]) & (xda
-00013460: 743c 7370 616e 5b31 5d29 5d0a 2020 2020  t<span[1])].    
-00013470: 2020 2020 7864 6174 5f69 6e72 616e 6765      xdat_inrange
-00013480: 3d78 6461 745b 2878 6461 743e 7370 616e  =xdat[(xdat>span
-00013490: 5b30 5d29 2026 2028 7864 6174 3c73 7061  [0]) & (xdat<spa
-000134a0: 6e5b 315d 295d 0a20 2020 2020 2020 2072  n[1])].        r
-000134b0: 6573 6964 7561 6c5f 6469 6164 5f63 6f6f  esidual_diad_coo
-000134c0: 7264 733d 7964 6174 5f69 6e72 616e 6765  rds=ydat_inrange
-000134d0: 2d72 6573 756c 745f 6469 6164 325f 6f72  -result_diad2_or
-000134e0: 6967 780a 0a0a 2020 2020 2020 2020 785f  igx...        x_
-000134f0: 6365 6e74 5f6c 696e 3d6e 702e 6c69 6e73  cent_lin=np.lins
-00013500: 7061 6365 2864 665f 6f75 745b 2744 6961  pace(df_out['Dia
-00013510: 6432 5f56 6f69 6774 5f43 656e 7427 5d2d  d2_Voigt_Cent']-
-00013520: 312c 2064 665f 6f75 745b 2744 6961 6432  1, df_out['Diad2
-00013530: 5f56 6f69 6774 5f43 656e 7427 5d2b 312c  _Voigt_Cent']+1,
-00013540: 2032 3030 3030 290a 2020 2020 2020 2020   20000).        
-00013550: 795f 6365 6e74 5f62 6573 745f 6669 743d  y_cent_best_fit=
-00013560: 7265 7375 6c74 2e65 7661 6c28 783d 785f  result.eval(x=x_
-00013570: 6365 6e74 5f6c 696e 290a 2020 2020 2020  cent_lin).      
-00013580: 2020 6469 6164 5f68 6569 6768 7420 3d20    diad_height = 
-00013590: 6e70 2e6d 6178 2879 5f63 656e 745f 6265  np.max(y_cent_be
-000135a0: 7374 5f66 6974 290a 2020 2020 2020 2020  st_fit).        
-000135b0: 6466 5f6f 7574 5b27 4469 6164 325f 436f  df_out['Diad2_Co
-000135c0: 6d62 6f66 6974 5f48 6569 6768 7427 5d3d  mbofit_Height']=
-000135d0: 2064 6961 645f 6865 6967 6874 0a20 2020   diad_height.   
-000135e0: 2020 2020 2064 665f 6f75 742e 696e 7365       df_out.inse
-000135f0: 7274 2830 2c20 2744 6961 6432 5f43 6f6d  rt(0, 'Diad2_Com
-00013600: 626f 6669 745f 4365 6e74 272c 206e 702e  bofit_Cent', np.
-00013610: 6e61 6e6d 6561 6e28 785f 6365 6e74 5f6c  nanmean(x_cent_l
-00013620: 696e 5b79 5f63 656e 745f 6265 7374 5f66  in[y_cent_best_f
-00013630: 6974 3d3d 6469 6164 5f68 6569 6768 745d  it==diad_height]
-00013640: 2929 0a0a 0a20 2020 2020 2020 2072 6573  ))...        res
-00013650: 6964 7561 6c5f 6469 6164 323d 6e70 2e73  idual_diad2=np.s
-00013660: 756d 2828 2879 6461 745f 696e 7261 6e67  um(((ydat_inrang
-00013670: 652d 7265 7375 6c74 5f64 6961 6432 5f6f  e-result_diad2_o
-00013680: 7269 6778 292a 2a32 292a 2a30 2e35 292f  rigx)**2)**0.5)/
-00013690: 286c 656e 2879 6461 745f 696e 7261 6e67  (len(ydat_inrang
-000136a0: 6529 290a 2020 2020 2020 2020 6466 5f6f  e)).        df_o
-000136b0: 7574 5b27 4469 6164 325f 5265 7369 6475  ut['Diad2_Residu
-000136c0: 616c 275d 3d72 6573 6964 7561 6c5f 6469  al']=residual_di
-000136d0: 6164 320a 2020 2020 2020 2020 6466 5f6f  ad2.        df_o
-000136e0: 7574 5b27 4469 6164 325f 5072 6f70 5f4c  ut['Diad2_Prop_L
-000136f0: 6f72 275d 3d20 5065 616b 315f 5072 6f70  or']= Peak1_Prop
-00013700: 5f4c 6f72 0a20 2020 2020 2020 2064 665f  _Lor.        df_
-00013710: 6f75 745b 2744 6961 6432 5f66 7768 6d27  out['Diad2_fwhm'
-00013720: 5d3d 5065 616b 315f 6677 686d 0a0a 2020  ]=Peak1_fwhm..  
-00013730: 2020 2020 2020 6966 2063 6f6e 6669 6731        if config1
-00013740: 2e66 6974 5f67 6175 7373 2069 7320 6e6f  .fit_gauss is no
-00013750: 7420 4661 6c73 653a 0a20 2020 2020 2020  t False:.       
-00013760: 2020 2020 2064 665f 6f75 745b 2744 6961       df_out['Dia
-00013770: 6432 5f47 6175 7373 5f43 656e 7427 5d3d  d2_Gauss_Cent']=
-00013780: 4761 7573 735f 6365 6e74 0a20 2020 2020  Gauss_cent.     
-00013790: 2020 2020 2020 2064 665f 6f75 745b 2744         df_out['D
-000137a0: 6961 6432 5f47 6175 7373 5f41 7265 6127  iad2_Gauss_Area'
-000137b0: 5d3d 4761 7573 735f 616d 700a 2020 2020  ]=Gauss_amp.    
-000137c0: 2020 2020 2020 2020 6466 5f6f 7574 5b27          df_out['
-000137d0: 4469 6164 325f 4761 7573 735f 5369 676d  Diad2_Gauss_Sigm
-000137e0: 6127 5d3d 4761 7573 735f 7369 676d 610a  a']=Gauss_sigma.
-000137f0: 0a0a 2020 2020 2020 2020 2343 6865 636b  ..        #Check
-00013800: 696e 6720 7768 6574 6865 7220 796f 7520  ing whether you 
-00013810: 6e65 6564 2061 6e79 2066 6c61 6773 2e0a  need any flags..
-00013820: 2020 2020 2020 2020 6966 2065 7272 6f72          if error
-00013830: 5f70 6b32 2069 7320 4e6f 6e65 3a0a 2020  _pk2 is None:.  
-00013840: 2020 2020 2020 2020 2020 7265 6669 743d            refit=
-00013850: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00013860: 2072 6566 6974 5f70 6172 616d 3d73 7472   refit_param=str
-00013870: 2872 6566 6974 5f70 6172 616d 292b 2720  (refit_param)+' 
-00013880: 4e6f 2045 7272 6f72 270a 0a0a 2020 2020  No Error'...    
-00013890: 2020 2020 6966 2050 6561 6b31 5f49 6e74      if Peak1_Int
-000138a0: 3e3d 2863 616c 635f 6469 6164 5f61 6d70  >=(calc_diad_amp
-000138b0: 6c69 7475 6465 2a31 302d 302e 3129 3a0a  litude*10-0.1):.
-000138c0: 2020 2020 2020 2020 2020 2020 7265 6669              refi
-000138d0: 743d 5472 7565 0a20 2020 2020 2020 2020  t=True.         
-000138e0: 2020 2072 6566 6974 5f70 6172 616d 3d73     refit_param=s
-000138f0: 7472 2872 6566 6974 5f70 6172 616d 292b  tr(refit_param)+
-00013900: 2720 565f 4c6f 7741 6d70 270a 2020 2020  ' V_LowAmp'.    
-00013910: 2020 2020 6966 2050 6561 6b31 5f53 6967      if Peak1_Sig
-00013920: 6d61 3e3d 2863 616c 635f 6469 6164 5f61  ma>=(calc_diad_a
-00013930: 6d70 6c69 7475 6465 2a31 302d 302e 3129  mplitude*10-0.1)
-00013940: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00013950: 6669 743d 5472 7565 0a20 2020 2020 2020  fit=True.       
-00013960: 2020 2020 2072 6566 6974 5f70 6172 616d       refit_param
-00013970: 3d73 7472 2872 6566 6974 5f70 6172 616d  =str(refit_param
-00013980: 292b 2720 565f 4869 6768 416d 7027 0a20  )+' V_HighAmp'. 
-00013990: 2020 2020 2020 2069 6620 5065 616b 315f         if Peak1_
-000139a0: 5369 676d 613e 3d28 636f 6e66 6967 312e  Sigma>=(config1.
-000139b0: 6469 6164 5f73 6967 6d61 2a63 6f6e 6669  diad_sigma*confi
-000139c0: 6731 2e64 6961 645f 7369 676d 615f 6d61  g1.diad_sigma_ma
-000139d0: 785f 616c 6c6f 7761 6e63 652d 302e 3030  x_allowance-0.00
-000139e0: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
-000139f0: 7265 6669 743d 5472 7565 0a20 2020 2020  refit=True.     
-00013a00: 2020 2020 2020 2072 6566 6974 5f70 6172         refit_par
-00013a10: 616d 3d73 7472 2872 6566 6974 5f70 6172  am=str(refit_par
-00013a20: 616d 292b 2720 565f 5369 676d 615f 746f  am)+' V_Sigma_to
-00013a30: 6f5f 4c6f 7727 0a20 2020 2020 2020 2069  o_Low'.        i
-00013a40: 6620 2064 6961 645f 6865 6967 6874 3e28  f  diad_height>(
-00013a50: 332a 636f 6e66 6967 312e 6469 6164 5f70  3*config1.diad_p
-00013a60: 726f 6d29 3a0a 2020 2020 2020 2020 2020  rom):.          
-00013a70: 2020 7265 6669 745f 7061 7261 6d3d 7374    refit_param=st
-00013a80: 7228 7265 6669 745f 7061 7261 6d29 2b27  r(refit_param)+'
-00013a90: 2056 5f53 6967 6d61 5f74 6f6f 5f4c 6f77   V_Sigma_too_Low
-00013aa0: 270a 2020 2020 2020 2020 6966 2020 6469  '.        if  di
-00013ab0: 6164 5f68 6569 6768 743c 2830 2e35 2a63  ad_height<(0.5*c
-00013ac0: 6f6e 6669 6731 2e64 6961 645f 7072 6f6d  onfig1.diad_prom
-00013ad0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00013ae0: 6566 6974 5f70 6172 616d 3d73 7472 2872  efit_param=str(r
-00013af0: 6566 6974 5f70 6172 616d 292b 2720 565f  efit_param)+' V_
-00013b00: 5369 676d 615f 746f 6f5f 4869 6768 270a  Sigma_too_High'.
-00013b10: 2020 2020 2020 2020 6966 2050 6561 6b31          if Peak1
-00013b20: 5f53 6967 6d61 3c3d 2863 6f6e 6669 6731  _Sigma<=(config1
-00013b30: 2e64 6961 645f 7369 676d 612a 636f 6e66  .diad_sigma*conf
-00013b40: 6967 312e 6469 6164 5f73 6967 6d61 5f6d  ig1.diad_sigma_m
-00013b50: 696e 5f61 6c6c 6f77 616e 6365 2b30 2e30  in_allowance+0.0
-00013b60: 3031 293a 0a20 2020 2020 2020 2020 2020  01):.           
-00013b70: 2072 6566 6974 3d54 7275 650a 2020 2020   refit=True.    
-00013b80: 2020 2020 2020 2020 7265 6669 745f 7061          refit_pa
-00013b90: 7261 6d3d 7374 7228 7265 6669 745f 7061  ram=str(refit_pa
-00013ba0: 7261 6d29 2b27 2056 5f53 6967 6d61 5f74  ram)+' V_Sigma_t
-00013bb0: 6f6f 5f48 6967 6827 0a20 2020 2020 2020  oo_High'.       
-00013bc0: 2069 6620 6469 6164 5f68 6569 6768 743c   if diad_height<
-00013bd0: 636f 6e66 6967 312e 7468 7265 7368 6f6c  config1.threshol
-00013be0: 645f 696e 7465 6e73 6974 793a 0a20 2020  d_intensity:.   
-00013bf0: 2020 2020 2020 2020 2072 6566 6974 5f70           refit_p
-00013c00: 6172 616d 3d73 7472 2872 6566 6974 5f70  aram=str(refit_p
-00013c10: 6172 616d 292b 2720 4265 6c6f 7720 7468  aram)+' Below th
-00013c20: 7265 7368 6f6c 6420 696e 7465 6e73 6974  reshold intensit
-00013c30: 7927 0a0a 2020 2020 2369 6620 6669 6e64  y'..    #if find
-00013c40: 6d65 0a0a 0a20 2020 2020 2020 2069 6620  me...        if 
-00013c50: 706c 6f74 5f66 6967 7572 6520 6973 2054  plot_figure is T
-00013c60: 7275 653a 0a0a 2020 2020 2020 2020 2020  rue:..          
-00013c70: 2020 6669 672c 2028 6178 312c 2061 7832    fig, (ax1, ax2
-00013c80: 2920 3d20 706c 742e 7375 6270 6c6f 7473  ) = plt.subplots
-00013c90: 2831 2c20 322c 2066 6967 7369 7a65 3d28  (1, 2, figsize=(
-00013ca0: 3132 2c34 2929 0a20 2020 2020 2020 2020  12,4)).         
-00013cb0: 2020 2061 7831 2e70 6c6f 7428 785f 6c69     ax1.plot(x_li
-00013cc0: 6e2c 2079 5f62 6573 745f 6669 742c 2027  n, y_best_fit, '
-00013cd0: 2d67 272c 206c 696e 6577 6964 7468 3d32  -g', linewidth=2
-00013ce0: 2c20 6c61 6265 6c3d 2762 6573 7420 6669  , label='best fi
-00013cf0: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
-00013d00: 6178 312e 706c 6f74 2878 6461 742c 2079  ax1.plot(xdat, y
-00013d10: 6461 742c 2020 272e 6b27 2c20 6c61 6265  dat,  '.k', labe
-00013d20: 6c3d 2764 6174 6127 290a 2020 2020 2020  l='data').      
-00013d30: 2020 2020 2020 6178 312e 6c65 6765 6e64        ax1.legend
-00013d40: 2829 0a20 2020 2020 2020 2020 2020 2061  ().            a
-00013d50: 7831 2e73 6574 5f78 6c69 6d28 6178 315f  x1.set_xlim(ax1_
-00013d60: 786c 696d 290a 2020 2020 2020 2020 2020  xlim).          
-00013d70: 2020 6178 322e 7365 745f 786c 696d 2861    ax2.set_xlim(a
-00013d80: 7832 5f78 6c69 6d29 0a0a 0a0a 0a0a 0a20  x2_xlim)....... 
-00013d90: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-00013da0: 6e66 6967 312e 6669 745f 6761 7573 7320  nfig1.fit_gauss 
-00013db0: 6973 206e 6f74 2046 616c 7365 3a0a 2020  is not False:.  
-00013dc0: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-00013dd0: 322e 706c 6f74 2878 5f6c 696e 2c20 636f  2.plot(x_lin, co
-00013de0: 6d70 6f6e 656e 7473 2e67 6574 2827 626b  mponents.get('bk
-00013df0: 675f 2729 2c20 272e 6327 2c6c 696e 6577  g_'), '.c',linew
-00013e00: 6964 7468 3d32 2c20 206c 6162 656c 3d27  idth=2,  label='
-00013e10: 4761 7573 7369 616e 2062 636b 2729 0a20  Gaussian bck'). 
-00013e20: 2020 2020 2020 2020 2020 2061 7832 2e70             ax2.p
-00013e30: 6c6f 7428 785f 6c69 6e2c 2063 6f6d 706f  lot(x_lin, compo
-00013e40: 6e65 6e74 732e 6765 7428 276c 7a31 5f27  nents.get('lz1_'
-00013e50: 292c 2027 2d62 272c 206c 696e 6577 6964  ), '-b', linewid
-00013e60: 7468 3d32 2c20 6c61 6265 6c3d 2750 6561  th=2, label='Pea
-00013e70: 6b31 2729 0a20 2020 2020 2020 2020 2020  k1').           
-00013e80: 2061 7832 2e70 6c6f 7428 7864 6174 2c20   ax2.plot(xdat, 
-00013e90: 7964 6174 2c20 272e 6b27 290a 0a0a 2020  ydat, '.k')...  
-00013ea0: 2020 2020 2020 2361 7832 2e70 6c6f 7428        #ax2.plot(
-00013eb0: 7864 6174 2c20 7265 7375 6c74 2e62 6573  xdat, result.bes
-00013ec0: 745f 6669 742c 2027 2d67 272c 206c 6162  t_fit, '-g', lab
-00013ed0: 656c 3d27 6265 7374 2066 6974 2729 0a0a  el='best fit')..
-00013ee0: 2020 2020 2020 2020 2020 2020 6669 7473              fits
-00013ef0: 7061 6e3d 6d61 7828 795f 6265 7374 5f66  pan=max(y_best_f
-00013f00: 6974 292d 6d69 6e28 795f 6265 7374 5f66  it)-min(y_best_f
-00013f10: 6974 290a 2020 2020 2020 2020 2020 2020  it).            
-00013f20: 6178 322e 7365 745f 796c 696d 285b 6d69  ax2.set_ylim([mi
-00013f30: 6e28 795f 6265 7374 5f66 6974 292d 6669  n(y_best_fit)-fi
-00013f40: 7473 7061 6e2f 352c 206d 6178 2879 5f62  tspan/5, max(y_b
-00013f50: 6573 745f 6669 7429 2b66 6974 7370 616e  est_fit)+fitspan
-00013f60: 2f35 5d29 0a0a 0a20 2020 2020 2020 2020  /5])...         
-00013f70: 2020 2061 7831 2e73 6574 5f79 6c61 6265     ax1.set_ylabe
-00013f80: 6c28 2749 6e74 656e 7369 7479 2729 0a20  l('Intensity'). 
-00013f90: 2020 2020 2020 2020 2020 2061 7831 2e73             ax1.s
-00013fa0: 6574 5f78 6c61 6265 6c28 2757 6176 656e  et_xlabel('Waven
-00013fb0: 756d 6265 7227 290a 2020 2020 2020 2020  umber').        
-00013fc0: 2020 2020 6178 322e 7365 745f 796c 6162      ax2.set_ylab
-00013fd0: 656c 2827 496e 7465 6e73 6974 7927 290a  el('Intensity').
-00013fe0: 2020 2020 2020 2020 2020 2020 6178 322e              ax2.
-00013ff0: 7365 745f 786c 6162 656c 2827 5761 7665  set_xlabel('Wave
-00014000: 6e75 6d62 6572 2729 0a0a 0a20 2020 2020  number')...     
-00014010: 2020 2020 2020 2069 6620 6669 745f 7065         if fit_pe
-00014020: 616b 733e 313a 0a20 2020 2020 2020 2020  aks>1:.         
-00014030: 2020 2020 2020 2061 7832 2e70 6c6f 7428         ax2.plot(
-00014040: 785f 6c69 6e2c 2063 6f6d 706f 6e65 6e74  x_lin, component
-00014050: 732e 6765 7428 276c 7a32 5f27 292c 2027  s.get('lz2_'), '
-00014060: 2d72 272c 206c 696e 6577 6964 7468 3d32  -r', linewidth=2
-00014070: 2c20 6c61 6265 6c3d 2750 6561 6b32 2729  , label='Peak2')
-00014080: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00014090: 2066 6974 5f70 6561 6b73 3e32 3a0a 2020   fit_peaks>2:.  
-000140a0: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-000140b0: 322e 706c 6f74 2878 5f6c 696e 2c20 636f  2.plot(x_lin, co
-000140c0: 6d70 6f6e 656e 7473 2e67 6574 2827 6c7a  mponents.get('lz
-000140d0: 335f 2729 2c20 272d 6d27 2c20 6c69 6e65  3_'), '-m', line
-000140e0: 7769 6474 683d 322c 206c 6162 656c 3d27  width=2, label='
-000140f0: 5065 616b 3327 290a 0a0a 2020 2020 2020  Peak3')...      
-00014100: 2020 2020 2020 6178 322e 6c65 6765 6e64        ax2.legend
-00014110: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-00014120: 7061 7468 333d 7061 7468 2b27 2f27 2b27  path3=path+'/'+'
-00014130: 6469 6164 5f66 6974 5f69 6d61 6765 7327  diad_fit_images'
-00014140: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00014150: 6f73 2e70 6174 682e 6578 6973 7473 2870  os.path.exists(p
-00014160: 6174 6833 293a 0a20 2020 2020 2020 2020  ath3):.         
-00014170: 2020 2020 2020 206f 7574 3d27 7061 7468         out='path
-00014180: 2065 7869 7374 7327 0a20 2020 2020 2020   exists'.       
-00014190: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000141a0: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
-000141b0: 6b65 6469 7273 2870 6174 682b 272f 272b  kedirs(path+'/'+
-000141c0: 2027 6469 6164 5f66 6974 5f69 6d61 6765   'diad_fit_image
-000141d0: 7327 2c20 6578 6973 745f 6f6b 3d46 616c  s', exist_ok=Fal
-000141e0: 7365 290a 0a0a 2020 2020 2020 2020 2020  se)...          
-000141f0: 2020 6669 6c65 3d66 696c 656e 616d 652e    file=filename.
-00014200: 7273 706c 6974 2827 2e74 7874 272c 2031  rsplit('.txt', 1
-00014210: 295b 305d 0a20 2020 2020 2020 2020 2020  )[0].           
-00014220: 2066 6967 2e73 6176 6566 6967 2870 6174   fig.savefig(pat
-00014230: 6833 2b27 2f27 2b27 4469 6164 325f 4669  h3+'/'+'Diad2_Fi
-00014240: 745f 7b7d 2e70 6e67 272e 666f 726d 6174  t_{}.png'.format
-00014250: 2866 696c 6529 2c20 6470 693d 6470 6929  (file), dpi=dpi)
-00014260: 0a0a 0a0a 0a20 2020 2020 2020 2062 6573  .....        bes
-00014270: 745f 6669 743d 7265 7375 6c74 2e62 6573  t_fit=result.bes
-00014280: 745f 6669 740a 0a20 2020 2020 2020 2064  t_fit..        d
-00014290: 665f 6f75 745b 2744 6961 6432 5f72 6566  f_out['Diad2_ref
-000142a0: 6974 275d 3d72 6566 6974 5f70 6172 616d  it']=refit_param
-000142b0: 0a0a 2020 2020 6966 2064 6961 6431 2069  ..    if diad1 i
-000142c0: 7320 5472 7565 3a0a 0a0a 0a20 2020 2020  s True:....     
-000142d0: 2020 2069 6620 6669 745f 7065 616b 733d     if fit_peaks=
-000142e0: 3d31 3a0a 2020 2020 2020 2020 2020 2020  =1:.            
-000142f0: 5065 616b 325f 4365 6e74 3d4e 6f6e 650a  Peak2_Cent=None.
-00014300: 2020 2020 2020 2020 2020 2020 5065 616b              Peak
-00014310: 335f 4365 6e74 3d4e 6f6e 650a 2020 2020  3_Cent=None.    
-00014320: 2020 2020 2020 2020 6178 315f 786c 696d          ax1_xlim
-00014330: 3d5b 4365 6e74 6572 5f69 6e69 2d31 352c  =[Center_ini-15,
-00014340: 2043 656e 7465 725f 696e 692b 3135 5d0a   Center_ini+15].
-00014350: 2020 2020 2020 2020 2020 2020 6178 325f              ax2_
-00014360: 786c 696d 3d5b 4365 6e74 6572 5f69 6e69  xlim=[Center_ini
-00014370: 2d31 352c 2043 656e 7465 725f 696e 692b  -15, Center_ini+
-00014380: 3135 5d0a 2020 2020 2020 2020 6966 2066  15].        if f
-00014390: 6974 5f70 6561 6b73 3d3d 323a 0a20 2020  it_peaks==2:.   
-000143a0: 2020 2020 2020 2020 2050 6561 6b32 5f43           Peak2_C
-000143b0: 656e 743d 7265 7375 6c74 2e62 6573 745f  ent=result.best_
-000143c0: 7661 6c75 6573 2e67 6574 2827 6c7a 325f  values.get('lz2_
-000143d0: 6365 6e74 6572 2729 0a20 2020 2020 2020  center').       
-000143e0: 2020 2020 2050 6561 6b32 5f49 6e74 3d72       Peak2_Int=r
-000143f0: 6573 756c 742e 6265 7374 5f76 616c 7565  esult.best_value
-00014400: 732e 6765 7428 276c 7a32 5f61 6d70 6c69  s.get('lz2_ampli
-00014410: 7475 6465 2729 0a20 2020 2020 2020 2020  tude').         
-00014420: 2020 2050 6561 6b32 5f53 6967 6d61 3d72     Peak2_Sigma=r
-00014430: 6573 756c 742e 6265 7374 5f76 616c 7565  esult.best_value
-00014440: 732e 6765 7428 276c 7a32 5f73 6967 6d61  s.get('lz2_sigma
-00014450: 2729 0a20 2020 2020 2020 2020 2020 2023  ').            #
-00014460: 2023 2043 6865 636b 696e 6720 7061 7261   # Checking para
-00014470: 6d65 7465 7273 2066 6f72 2068 6f74 2062  meters for hot b
-00014480: 616e 6473 0a20 2020 2020 2020 2020 2020  ands.           
-00014490: 2023 2069 6620 5065 616b 325f 5369 676d   # if Peak2_Sigm
-000144a0: 613e 2873 6967 6d61 5f69 6e69 2a35 2d30  a>(sigma_ini*5-0
-000144b0: 2e31 293a 0a20 2020 2020 2020 2020 2020  .1):.           
-000144c0: 2023 2020 2020 2072 6566 6974 5f70 6172   #     refit_par
-000144d0: 616d 3d73 7472 2872 6566 6974 5f70 6172  am=str(refit_par
-000144e0: 616d 292b 2720 4842 315f 4869 6768 5369  am)+' HB1_HighSi
-000144f0: 676d 6127 0a20 2020 2020 2020 2020 2020  gma'.           
-00014500: 2023 2069 6620 5065 616b 325f 5369 676d   # if Peak2_Sigm
-00014510: 613c 3d28 7369 676d 615f 696e 692f 3230  a<=(sigma_ini/20
-00014520: 2b30 2e31 293a 0a20 2020 2020 2020 2020  +0.1):.         
-00014530: 2020 2023 2020 2020 2072 6566 6974 5f70     #     refit_p
-00014540: 6172 616d 3d73 7472 2872 6566 6974 5f70  aram=str(refit_p
-00014550: 6172 616d 292b 2720 4842 315f 4c6f 7753  aram)+' HB1_LowS
-00014560: 6967 6d61 270a 2020 2020 2020 2020 2020  igma'.          
-00014570: 2020 230a 2020 2020 2020 2020 2020 2020    #.            
-00014580: 2320 6966 2050 6561 6b32 5f49 6e74 3e28  # if Peak2_Int>(
-00014590: 416d 706c 6974 7564 655f 696e 692f 352d  Amplitude_ini/5-
-000145a0: 302e 3030 3129 3a0a 2020 2020 2020 2020  0.001):.        
-000145b0: 2020 2020 2320 2020 2020 7265 6669 745f      #     refit_
-000145c0: 7061 7261 6d3d 7374 7228 7265 6669 745f  param=str(refit_
-000145d0: 7061 7261 6d29 2b27 2048 4231 5f48 6967  param)+' HB1_Hig
-000145e0: 6841 6d70 270a 2020 2020 2020 2020 2020  hAmp'.          
-000145f0: 2020 2320 6966 2050 6561 6b32 5f49 6e74    # if Peak2_Int
-00014600: 3c3d 2841 6d70 6c69 7475 6465 5f69 6e69  <=(Amplitude_ini
-00014610: 2f31 3030 2b30 2e30 3031 293a 0a20 2020  /100+0.001):.   
-00014620: 2020 2020 2020 2020 2023 2020 2020 2072           #     r
-00014630: 6566 6974 5f70 6172 616d 3d73 7472 2872  efit_param=str(r
-00014640: 6566 6974 5f70 6172 616d 292b 2720 4842  efit_param)+' HB
-00014650: 315f 4c6f 7741 6d70 270a 0a0a 2020 2020  1_LowAmp'...    
-00014660: 2020 2020 2020 2020 5065 616b 335f 4365          Peak3_Ce
-00014670: 6e74 3d4e 6f6e 650a 2020 2020 2020 2020  nt=None.        
-00014680: 2020 2020 6178 315f 786c 696d 3d5b 4365      ax1_xlim=[Ce
-00014690: 6e74 6572 5f69 6e69 2d33 302c 2043 656e  nter_ini-30, Cen
-000146a0: 7465 725f 696e 692b 3135 5d0a 2020 2020  ter_ini+15].    
-000146b0: 2020 2020 2020 2020 6178 325f 786c 696d          ax2_xlim
-000146c0: 3d5b 4365 6e74 6572 5f69 6e69 2d33 302c  =[Center_ini-30,
-000146d0: 2043 656e 7465 725f 696e 692b 3135 5d0a   Center_ini+15].
-000146e0: 0a0a 0a20 2020 2020 2020 2069 6620 5065  ...        if Pe
-000146f0: 616b 325f 4365 6e74 2069 7320 4e6f 6e65  ak2_Cent is None
-00014700: 3a0a 2020 2020 2020 2020 2020 2020 6466  :.            df
-00014710: 5f6f 7574 3d70 642e 4461 7461 4672 616d  _out=pd.DataFram
-00014720: 6528 6461 7461 3d7b 2744 6961 6431 5f56  e(data={'Diad1_V
-00014730: 6f69 6774 5f43 656e 7427 3a20 5065 616b  oigt_Cent': Peak
-00014740: 315f 4365 6e74 2c0a 2020 2020 2020 2020  1_Cent,.        
-00014750: 2020 2020 2744 6961 6431 5f63 656e 745f      'Diad1_cent_
-00014760: 6572 7227 3a20 6572 726f 725f 706b 322c  err': error_pk2,
-00014770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014790: 2020 2020 2027 4469 6164 315f 566f 6967       'Diad1_Voig
-000147a0: 745f 4172 6561 273a 2050 6561 6b31 5f49  t_Area': Peak1_I
-000147b0: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-000147c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147d0: 2020 2020 2744 6961 6431 5f56 6f69 6774      'Diad1_Voigt
-000147e0: 5f53 6967 6d61 273a 2050 6561 6b31 5f53  _Sigma': Peak1_S
-000147f0: 6967 6d61 2c0a 2020 2020 2020 2020 2020  igma,.          
-00014800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014810: 2020 2020 2020 2744 6961 6431 5f56 6f69        'Diad1_Voi
-00014820: 6774 5f47 616d 6d61 273a 2050 6561 6b31  gt_Gamma': Peak1
-00014830: 5f67 616d 6d61 2c0a 0a0a 2020 2020 2020  _gamma,...      
-00014840: 2020 2020 2020 7d2c 2069 6e64 6578 3d5b        }, index=[
-00014850: 305d 290a 2020 2020 2020 2020 6966 2050  0]).        if P
-00014860: 6561 6b32 5f43 656e 7420 6973 206e 6f74  eak2_Cent is not
-00014870: 204e 6f6e 653a 0a0a 0a0a 0a0a 2020 2020   None:......    
-00014880: 2020 2020 2020 2020 6466 5f6f 7574 3d70          df_out=p
-00014890: 642e 4461 7461 4672 616d 6528 6461 7461  d.DataFrame(data
-000148a0: 3d7b 2744 6961 6431 5f56 6f69 6774 5f43  ={'Diad1_Voigt_C
-000148b0: 656e 7427 3a20 5065 616b 315f 4365 6e74  ent': Peak1_Cent
-000148c0: 2c0a 2020 2020 2020 2020 2020 2020 2744  ,.            'D
-000148d0: 6961 6431 5f63 656e 745f 6572 7227 3a20  iad1_cent_err': 
-000148e0: 6572 726f 725f 706b 322c 0a20 2020 2020  error_pk2,.     
-000148f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014900: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00014910: 4469 6164 315f 566f 6967 745f 4172 6561  Diad1_Voigt_Area
-00014920: 273a 2050 6561 6b31 5f49 6e74 2c0a 2020  ': Peak1_Int,.  
-00014930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010aa0: 6d69 6e5f 7369 676d 613d 7369 676d 615f  min_sigma=sigma_
+00010ab0: 696e 692a 636f 6e66 6967 312e 4842 5f73  ini*config1.HB_s
+00010ac0: 6967 6d61 5f6d 696e 5f61 6c6c 6f77 616e  igma_min_allowan
+00010ad0: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
+00010ae0: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
+00010af0: 7369 676d 613d 7369 676d 615f 696e 692a  sigma=sigma_ini*
+00010b00: 636f 6e66 6967 312e 4842 5f73 6967 6d61  config1.HB_sigma
+00010b10: 5f6d 6178 5f61 6c6c 6f77 616e 6365 2c0a  _max_allowance,.
+00010b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b30: 2020 2020 2020 2020 616d 706c 6974 7564          amplitud
+00010b40: 653d 6361 6c63 5f48 425f 616d 706c 6974  e=calc_HB_amplit
+00010b50: 7564 652c 0a20 2020 2020 2020 2020 2020  ude,.           
+00010b60: 2020 2020 2020 2020 2020 2020 206d 696e               min
+00010b70: 5f61 6d70 6c69 7475 6465 3d41 6d70 6c69  _amplitude=Ampli
+00010b80: 7475 6465 5f69 6e69 2a63 6f6e 6669 6731  tude_ini*config1
+00010b90: 2e48 425f 616d 705f 6d69 6e5f 616c 6c6f  .HB_amp_min_allo
+00010ba0: 7761 6e63 652c 0a20 2020 2020 2020 2020  wance,.         
+00010bb0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00010bc0: 6178 5f61 6d70 6c69 7475 6465 3d41 6d70  ax_amplitude=Amp
+00010bd0: 6c69 7475 6465 5f69 6e69 2a63 6f6e 6669  litude_ini*confi
+00010be0: 6731 2e48 425f 616d 705f 6d61 785f 616c  g1.HB_amp_max_al
+00010bf0: 6c6f 7761 6e63 652c 0a20 2020 2020 2020  lowance,.       
+00010c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c10: 206d 6f64 656c 5f6e 616d 653d 636f 6e66   model_name=conf
+00010c20: 6967 312e 6d6f 6465 6c5f 6e61 6d65 290a  ig1.model_name).
+00010c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c40: 2020 2020 6d6f 6465 6c32 203d 2070 6561      model2 = pea
+00010c50: 6b2b 6d6f 6465 6c0a 2020 2020 2020 2020  k+model.        
+00010c60: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00010c70: 6d73 2e75 7064 6174 6528 7061 7273 290a  ms.update(pars).
+00010c80: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00010c90: 4174 7465 6d70 7420 6174 2073 7461 6269  Attempt at stabi
+00010ca0: 6c69 7a69 6e67 2070 6561 6b20 6669 740a  lizing peak fit.
+00010cb0: 2320 7570 6461 7469 6e67 2070 6172 7320  # updating pars 
+00010cc0: 3120 7769 7468 2076 616c 7565 7320 696e  1 with values in
+00010cd0: 2070 6172 730a 0a20 2020 2020 2020 2020   pars..         
+00010ce0: 2020 2072 6573 756c 7420 3d20 6d6f 6465     result = mode
+00010cf0: 6c32 2e66 6974 2879 6461 742c 2070 6172  l2.fit(ydat, par
+00010d00: 616d 732c 2078 3d78 6461 7429 0a0a 0a20  ams, x=xdat)... 
+00010d10: 2020 2020 2020 2020 2020 2023 2053 6574             # Set
+00010d20: 2074 6865 2070 6172 616d 6574 6572 7320   the parameters 
+00010d30: 6f66 2027 6c7a 3127 2074 6f20 6265 2066  of 'lz1' to be f
+00010d40: 6978 6564 0a20 2020 2020 2020 2020 2020  ixed.           
+00010d50: 2072 6573 756c 742e 7061 7261 6d73 5b27   result.params['
+00010d60: 6c7a 325f 6365 6e74 6572 275d 2e76 6172  lz2_center'].var
+00010d70: 7920 3d20 4661 6c73 650a 2020 2020 2020  y = False.      
+00010d80: 2020 2020 2020 7265 7375 6c74 2e70 6172        result.par
+00010d90: 616d 735b 276c 7a32 5f61 6d70 6c69 7475  ams['lz2_amplitu
+00010da0: 6465 275d 2e76 6172 7920 3d20 4661 6c73  de'].vary = Fals
+00010db0: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
+00010dc0: 7375 6c74 2e70 6172 616d 735b 276c 7a32  sult.params['lz2
+00010dd0: 5f73 6967 6d61 275d 2e76 6172 7920 3d20  _sigma'].vary = 
+00010de0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00010df0: 2020 7265 7375 6c74 2e70 6172 616d 735b    result.params[
+00010e00: 2762 6b67 5f63 656e 7465 7227 5d2e 7661  'bkg_center'].va
+00010e10: 7279 203d 2046 616c 7365 0a20 2020 2020  ry = False.     
+00010e20: 2020 2020 2020 2072 6573 756c 742e 7061         result.pa
+00010e30: 7261 6d73 5b27 626b 675f 616d 706c 6974  rams['bkg_amplit
+00010e40: 7564 6527 5d2e 7661 7279 203d 2046 616c  ude'].vary = Fal
+00010e50: 7365 0a20 2020 2020 2020 2020 2020 2072  se.            r
+00010e60: 6573 756c 742e 7061 7261 6d73 5b27 626b  esult.params['bk
+00010e70: 675f 7369 676d 6127 5d2e 7661 7279 203d  g_sigma'].vary =
+00010e80: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
+00010e90: 2020 2020 2320 5065 7266 6f72 6d20 6669      # Perform fi
+00010ea0: 7474 696e 6720 7573 696e 6720 7468 6520  tting using the 
+00010eb0: 656e 7469 7265 206d 6f64 656c 2028 6d6f  entire model (mo
+00010ec0: 6465 6c32 2920 7769 7468 2074 6865 2073  del2) with the s
+00010ed0: 7461 6269 6c69 7a65 6420 276c 7a31 2720  tabilized 'lz1' 
+00010ee0: 7061 7261 6d65 7465 7273 0a20 2020 2020  parameters.     
+00010ef0: 2020 2020 2020 2066 696e 616c 5f72 6573         final_res
+00010f00: 756c 7420 3d20 6d6f 6465 6c32 2e66 6974  ult = model2.fit
+00010f10: 2879 6461 742c 2072 6573 756c 742e 7061  (ydat, result.pa
+00010f20: 7261 6d73 2c20 783d 7864 6174 290a 2020  rams, x=xdat).  
+00010f30: 2020 2020 2020 2020 2020 6365 6e74 6572            center
+00010f40: 5f65 7272 6f72 203d 2066 696e 616c 5f72  _error = final_r
+00010f50: 6573 756c 742e 7061 7261 6d73 5b27 6c7a  esult.params['lz
+00010f60: 315f 6365 6e74 6572 275d 2e73 7464 6572  1_center'].stder
+00010f70: 720a 2020 2020 2020 2020 2020 2020 7061  r.            pa
+00010f80: 7261 6d73 2e75 7064 6174 6528 6669 6e61  rams.update(fina
+00010f90: 6c5f 7265 7375 6c74 2e70 6172 616d 7329  l_result.params)
+00010fa0: 0a0a 0a20 2020 2020 2020 2020 2020 2072  ...            r
+00010fb0: 6573 756c 743d 6669 6e61 6c5f 7265 7375  esult=final_resu
+00010fc0: 6c74 0a20 2020 2020 2020 2020 2020 206d  lt.            m
+00010fd0: 6f64 656c 5f46 3d6d 6f64 656c 320a 0a0a  odel_F=model2...
+00010fe0: 2020 2020 2020 2020 6966 2066 6974 5f70          if fit_p
+00010ff0: 6561 6b73 3d3d 333a 0a20 2020 2020 2020  eaks==3:.       
+00011000: 2020 2020 2070 6561 6b5f 706f 735f 766f       peak_pos_vo
+00011010: 6967 743d 6e70 2e61 7272 6179 285b 696e  igt=np.array([in
+00011020: 6974 6961 6c5f 6775 6573 732c 2048 425f  itial_guess, HB_
+00011030: 696e 6974 6961 6c5f 6775 6573 732c 2043  initial_guess, C
+00011040: 3133 5f69 6e69 7469 616c 5f67 7565 7373  13_initial_guess
+00011050: 5d29 0a0a 2020 2020 2020 2020 2020 2020  ])..            
+00011060: 666f 7220 692c 2063 656e 2069 6e20 656e  for i, cen in en
+00011070: 756d 6572 6174 6528 7065 616b 5f70 6f73  umerate(peak_pos
+00011080: 5f76 6f69 6774 293a 0a0a 2020 2020 2020  _voigt):..      
+00011090: 2020 2020 2020 2020 2020 6966 2069 3d3d            if i==
+000110a0: 303a 2023 2054 6869 7320 6973 2074 6865  0: # This is the
+000110b0: 2044 6961 640a 2020 2020 2020 2020 2020   Diad.          
+000110c0: 2020 2020 2020 2020 2020 7065 616b 2c20            peak, 
+000110d0: 7061 7273 203d 2061 6464 5f70 6561 6b28  pars = add_peak(
+000110e0: 7072 6566 6978 3d27 6c7a 2564 5f27 2025  prefix='lz%d_' %
+000110f0: 2028 692b 3129 2c0a 2020 2020 2020 2020   (i+1),.        
+00011100: 2020 2020 2020 2020 6365 6e74 6572 3d43          center=C
+00011110: 656e 7465 725f 696e 692c 206d 696e 5f63  enter_ini, min_c
+00011120: 656e 743d 6365 6e2d 332a 7370 6563 5f72  ent=cen-3*spec_r
+00011130: 6573 2c20 6d61 785f 6365 6e74 3d63 656e  es, max_cent=cen
+00011140: 2b33 2a73 7065 635f 7265 732c 0a20 2020  +3*spec_res,.   
+00011150: 2020 2020 2020 2020 2020 2020 2073 6967               sig
+00011160: 6d61 3d63 6f6e 6669 6731 2e64 6961 645f  ma=config1.diad_
+00011170: 7369 676d 612c 0a20 2020 2020 2020 2020  sigma,.         
+00011180: 2020 2020 2020 206d 6178 5f73 6967 6d61         max_sigma
+00011190: 3d63 6f6e 6669 6731 2e64 6961 645f 7369  =config1.diad_si
+000111a0: 676d 612a 636f 6e66 6967 312e 6469 6164  gma*config1.diad
+000111b0: 5f73 6967 6d61 5f6d 6178 5f61 6c6c 6f77  _sigma_max_allow
+000111c0: 616e 6365 2c0a 2020 2020 2020 2020 2020  ance,.          
+000111d0: 2020 2020 2020 6d69 6e5f 7369 676d 613d        min_sigma=
+000111e0: 636f 6e66 6967 312e 6469 6164 5f73 6967  config1.diad_sig
+000111f0: 6d61 2a63 6f6e 6669 6731 2e64 6961 645f  ma*config1.diad_
+00011200: 7369 676d 615f 6d69 6e5f 616c 6c6f 7761  sigma_min_allowa
+00011210: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
+00011220: 2020 2020 2061 6d70 6c69 7475 6465 3d63       amplitude=c
+00011230: 616c 635f 6469 6164 5f61 6d70 6c69 7475  alc_diad_amplitu
+00011240: 6465 2c20 6d69 6e5f 616d 706c 6974 7564  de, min_amplitud
+00011250: 653d 302c 206d 6178 5f61 6d70 6c69 7475  e=0, max_amplitu
+00011260: 6465 3d31 302a 6361 6c63 5f64 6961 645f  de=10*calc_diad_
+00011270: 616d 706c 6974 7564 652c 0a20 2020 2020  amplitude,.     
+00011280: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+00011290: 5f6e 616d 653d 636f 6e66 6967 312e 6d6f  _name=config1.mo
+000112a0: 6465 6c5f 6e61 6d65 290a 2020 2020 2020  del_name).      
+000112b0: 2020 2020 2020 2020 2020 6d6f 6465 6c20            model 
+000112c0: 3d20 7065 616b 2b6d 6f64 656c 310a 2020  = peak+model1.  
+000112d0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000112e0: 7261 6d73 2e75 7064 6174 6528 7061 7273  rams.update(pars
+000112f0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00011300: 2020 2069 6620 693d 3d31 3a20 2320 5468     if i==1: # Th
+00011310: 6973 2069 7320 7468 6520 686f 7462 616e  is is the hotban
+00011320: 640a 0a20 2020 2020 2020 2020 2020 2020  d..             
+00011330: 2020 2020 2020 2070 6561 6b2c 2070 6172         peak, par
+00011340: 7320 3d20 6164 645f 7065 616b 2870 7265  s = add_peak(pre
+00011350: 6669 783d 276c 7a25 645f 2720 2520 2869  fix='lz%d_' % (i
+00011360: 2b31 292c 2063 656e 7465 723d 6365 6e2c  +1), center=cen,
+00011370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011380: 2020 2020 2020 2020 206d 696e 5f63 656e           min_cen
+00011390: 743d 6365 6e2d 332a 7370 6563 5f72 6573  t=cen-3*spec_res
+000113a0: 2c20 6d61 785f 6365 6e74 3d63 656e 2b33  , max_cent=cen+3
+000113b0: 2a73 7065 635f 7265 732c 2073 6967 6d61  *spec_res, sigma
+000113c0: 3d73 6967 6d61 5f69 6e69 2c0a 2020 2020  =sigma_ini,.    
+000113d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000113e0: 2020 2020 6d69 6e5f 7369 676d 613d 7369      min_sigma=si
+000113f0: 676d 615f 696e 692a 636f 6e66 6967 312e  gma_ini*config1.
+00011400: 4842 5f73 6967 6d61 5f6d 696e 5f61 6c6c  HB_sigma_min_all
+00011410: 6f77 616e 6365 2c0a 2020 2020 2020 2020  owance,.        
+00011420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011430: 6d61 785f 7369 676d 613d 7369 676d 615f  max_sigma=sigma_
+00011440: 696e 692a 636f 6e66 6967 312e 4842 5f73  ini*config1.HB_s
+00011450: 6967 6d61 5f6d 6178 5f61 6c6c 6f77 616e  igma_max_allowan
+00011460: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
+00011470: 2020 2020 2020 2020 2020 2020 616d 706c              ampl
+00011480: 6974 7564 653d 6361 6c63 5f48 425f 616d  itude=calc_HB_am
+00011490: 706c 6974 7564 652c 0a20 2020 2020 2020  plitude,.       
+000114a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114b0: 206d 696e 5f61 6d70 6c69 7475 6465 3d41   min_amplitude=A
+000114c0: 6d70 6c69 7475 6465 5f69 6e69 2a63 6f6e  mplitude_ini*con
+000114d0: 6669 6731 2e48 425f 616d 705f 6d69 6e5f  fig1.HB_amp_min_
+000114e0: 616c 6c6f 7761 6e63 652c 0a20 2020 2020  allowance,.     
+000114f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011500: 2020 206d 6178 5f61 6d70 6c69 7475 6465     max_amplitude
+00011510: 3d41 6d70 6c69 7475 6465 5f69 6e69 2a63  =Amplitude_ini*c
+00011520: 6f6e 6669 6731 2e48 425f 616d 705f 6d61  onfig1.HB_amp_ma
+00011530: 785f 616c 6c6f 7761 6e63 652c 0a20 2020  x_allowance,.   
+00011540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011550: 2020 2020 206d 6f64 656c 5f6e 616d 653d       model_name=
+00011560: 636f 6e66 6967 312e 6d6f 6465 6c5f 6e61  config1.model_na
+00011570: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+00011580: 2020 2020 2020 2020 6d6f 6465 6c32 203d          model2 =
+00011590: 2070 6561 6b2b 6d6f 6465 6c0a 2020 2020   peak+model.    
+000115a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115b0: 7061 7261 6d73 2e75 7064 6174 6528 7061  params.update(pa
+000115c0: 7273 290a 0a20 2020 2020 2020 2020 2020  rs)..           
+000115d0: 2020 2020 2069 6620 693d 3d32 3a20 2320       if i==2: # 
+000115e0: 5468 6973 2069 7320 6331 330a 2020 2020  This is c13.    
+000115f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011600: 7065 616b 2c20 7061 7273 203d 2061 6464  peak, pars = add
+00011610: 5f70 6561 6b28 7072 6566 6978 3d27 6c7a  _peak(prefix='lz
+00011620: 2564 5f27 2025 2028 692b 3129 2c20 6365  %d_' % (i+1), ce
+00011630: 6e74 6572 3d63 656e 2c0a 2020 2020 2020  nter=cen,.      
+00011640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011650: 2020 6d69 6e5f 6365 6e74 3d63 656e 2d33    min_cent=cen-3
+00011660: 2a73 7065 635f 7265 732c 206d 6178 5f63  *spec_res, max_c
+00011670: 656e 743d 6365 6e2b 332a 7370 6563 5f72  ent=cen+3*spec_r
+00011680: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+00011690: 2020 2020 2020 2020 2020 2020 7369 676d              sigm
+000116a0: 613d 7369 676d 615f 696e 692f 352c 0a20  a=sigma_ini/5,. 
+000116b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000116c0: 2020 2020 2020 206d 696e 5f73 6967 6d61         min_sigma
+000116d0: 3d73 6967 6d61 5f69 6e69 2f32 302c 0a20  =sigma_ini/20,. 
+000116e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000116f0: 2020 2020 2020 206d 6178 5f73 6967 6d61         max_sigma
+00011700: 3d73 6967 6d61 5f69 6e69 2f32 2c0a 2020  =sigma_ini/2,.  
+00011710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011720: 2020 2020 2020 616d 706c 6974 7564 653d        amplitude=
+00011730: 6361 6c63 5f43 3133 5f61 6d70 6c69 7475  calc_C13_amplitu
+00011740: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
+00011750: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
+00011760: 616d 706c 6974 7564 653d 6361 6c63 5f43  amplitude=calc_C
+00011770: 3133 5f61 6d70 6c69 7475 6465 2a28 302e  13_amplitude*(0.
+00011780: 352a 636f 6e66 6967 312e 4842 5f61 6d70  5*config1.HB_amp
+00011790: 5f6d 696e 5f61 6c6c 6f77 616e 6365 292c  _min_allowance),
+000117a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000117b0: 2020 2020 2020 2020 206d 6178 5f61 6d70           max_amp
+000117c0: 6c69 7475 6465 3d63 616c 635f 4331 335f  litude=calc_C13_
+000117d0: 616d 706c 6974 7564 652a 322a 2863 6f6e  amplitude*2*(con
+000117e0: 6669 6731 2e48 425f 616d 705f 6d61 785f  fig1.HB_amp_max_
+000117f0: 616c 6c6f 7761 6e63 6529 2c0a 2020 2020  allowance),.    
+00011800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011810: 2020 2020 6d6f 6465 6c5f 6e61 6d65 3d63      model_name=c
+00011820: 6f6e 6669 6731 2e6d 6f64 656c 5f6e 616d  onfig1.model_nam
+00011830: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00011840: 2020 2020 2020 206d 6f64 656c 3320 3d20         model3 = 
+00011850: 7065 616b 2b6d 6f64 656c 320a 2020 2020  peak+model2.    
+00011860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011870: 7061 7261 6d73 2e75 7064 6174 6528 7061  params.update(pa
+00011880: 7273 290a 0a20 2020 2020 2020 2020 2020  rs)..           
+00011890: 2072 6573 756c 7420 3d20 6d6f 6465 6c33   result = model3
+000118a0: 2e66 6974 2879 6461 742c 2070 6172 616d  .fit(ydat, param
+000118b0: 732c 2078 3d78 6461 7429 0a0a 0a20 2020  s, x=xdat)...   
+000118c0: 2020 2020 2020 2020 2023 2053 6574 2074           # Set t
+000118d0: 6865 2070 6172 616d 6574 6572 7320 6f66  he parameters of
+000118e0: 2027 6c7a 3127 2074 6f20 6265 2066 6978   'lz1' to be fix
+000118f0: 6564 0a20 2020 2020 2020 2020 2020 2072  ed.            r
+00011900: 6573 756c 742e 7061 7261 6d73 5b27 6c7a  esult.params['lz
+00011910: 325f 6365 6e74 6572 275d 2e76 6172 7920  2_center'].vary 
+00011920: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00011930: 2020 2020 7265 7375 6c74 2e70 6172 616d      result.param
+00011940: 735b 276c 7a32 5f61 6d70 6c69 7475 6465  s['lz2_amplitude
+00011950: 275d 2e76 6172 7920 3d20 4661 6c73 650a  '].vary = False.
+00011960: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00011970: 6c74 2e70 6172 616d 735b 276c 7a32 5f73  lt.params['lz2_s
+00011980: 6967 6d61 275d 2e76 6172 7920 3d20 4661  igma'].vary = Fa
+00011990: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+000119a0: 7265 7375 6c74 2e70 6172 616d 735b 276c  result.params['l
+000119b0: 7a33 5f63 656e 7465 7227 5d2e 7661 7279  z3_center'].vary
+000119c0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+000119d0: 2020 2020 2072 6573 756c 742e 7061 7261       result.para
+000119e0: 6d73 5b27 6c7a 335f 616d 706c 6974 7564  ms['lz3_amplitud
+000119f0: 6527 5d2e 7661 7279 203d 2046 616c 7365  e'].vary = False
+00011a00: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00011a10: 756c 742e 7061 7261 6d73 5b27 6c7a 335f  ult.params['lz3_
+00011a20: 7369 676d 6127 5d2e 7661 7279 203d 2046  sigma'].vary = F
+00011a30: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00011a40: 2072 6573 756c 742e 7061 7261 6d73 5b27   result.params['
+00011a50: 626b 675f 6365 6e74 6572 275d 2e76 6172  bkg_center'].var
+00011a60: 7920 3d20 4661 6c73 650a 2020 2020 2020  y = False.      
+00011a70: 2020 2020 2020 7265 7375 6c74 2e70 6172        result.par
+00011a80: 616d 735b 2762 6b67 5f61 6d70 6c69 7475  ams['bkg_amplitu
+00011a90: 6465 275d 2e76 6172 7920 3d20 4661 6c73  de'].vary = Fals
+00011aa0: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
+00011ab0: 7375 6c74 2e70 6172 616d 735b 2762 6b67  sult.params['bkg
+00011ac0: 5f73 6967 6d61 275d 2e76 6172 7920 3d20  _sigma'].vary = 
+00011ad0: 4661 6c73 650a 0a20 2020 2020 2020 2020  False..         
+00011ae0: 2020 2023 2050 6572 666f 726d 2066 6974     # Perform fit
+00011af0: 7469 6e67 2075 7369 6e67 2074 6865 2065  ting using the e
+00011b00: 6e74 6972 6520 6d6f 6465 6c20 286d 6f64  ntire model (mod
+00011b10: 656c 3229 2077 6974 6820 7468 6520 7374  el2) with the st
+00011b20: 6162 696c 697a 6564 2027 6c7a 3127 2070  abilized 'lz1' p
+00011b30: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+00011b40: 2020 2020 2020 6669 6e61 6c5f 7265 7375        final_resu
+00011b50: 6c74 203d 206d 6f64 656c 332e 6669 7428  lt = model3.fit(
+00011b60: 7964 6174 2c20 7265 7375 6c74 2e70 6172  ydat, result.par
+00011b70: 616d 732c 2078 3d78 6461 7429 0a20 2020  ams, x=xdat).   
+00011b80: 2020 2020 2020 2020 2063 656e 7465 725f           center_
+00011b90: 6572 726f 7220 3d20 6669 6e61 6c5f 7265  error = final_re
+00011ba0: 7375 6c74 2e70 6172 616d 735b 276c 7a31  sult.params['lz1
+00011bb0: 5f63 656e 7465 7227 5d2e 7374 6465 7272  _center'].stderr
+00011bc0: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00011bd0: 7375 6c74 3d66 696e 616c 5f72 6573 756c  sult=final_resul
+00011be0: 740a 2020 2020 2020 2020 2020 2020 6d6f  t.            mo
+00011bf0: 6465 6c5f 463d 6d6f 6465 6c33 0a0a 2020  del_F=model3..  
+00011c00: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+00011c10: 2e75 7064 6174 6528 6669 6e61 6c5f 7265  .update(final_re
+00011c20: 7375 6c74 2e70 6172 616d 7329 0a0a 0a0a  sult.params)....
+00011c30: 0a0a 0a0a 0a0a 2020 2020 2320 5265 6761  ......    # Rega
+00011c40: 7264 6c65 7373 206f 6620 6669 742c 2065  rdless of fit, e
+00011c50: 7661 6c75 6174 6520 6d6f 6465 6c0a 2020  valuate model.  
+00011c60: 2020 696e 6974 203d 206d 6f64 656c 5f46    init = model_F
+00011c70: 2e65 7661 6c28 7061 7261 6d73 2c20 783d  .eval(params, x=
+00011c80: 7864 6174 290a 2020 2020 7265 7375 6c74  xdat).    result
+00011c90: 203d 206d 6f64 656c 5f46 2e66 6974 2879   = model_F.fit(y
+00011ca0: 6461 742c 2070 6172 616d 732c 2078 3d78  dat, params, x=x
+00011cb0: 6461 7429 0a20 2020 2063 6f6d 7073 203d  dat).    comps =
+00011cc0: 2072 6573 756c 742e 6576 616c 5f63 6f6d   result.eval_com
+00011cd0: 706f 6e65 6e74 7328 290a 0a20 2020 2023  ponents()..    #
+00011ce0: 7072 696e 7428 7265 7375 6c74 2e63 695f  print(result.ci_
+00011cf0: 7265 706f 7274 2829 290a 0a20 2020 2023  report())..    #
+00011d00: 7072 696e 7428 7265 7375 6c74 2e63 6f6e  print(result.con
+00011d10: 665f 696e 7465 7276 616c 286d 6574 686f  f_interval(metho
+00011d20: 643d 2762 6f6f 7473 7472 6170 2729 290a  d='bootstrap')).
+00011d30: 0a20 2020 2023 7072 696e 7428 7265 7375  .    #print(resu
+00011d40: 6c74 2e66 6974 5f72 6570 6f72 7428 6d69  lt.fit_report(mi
+00011d50: 6e5f 636f 7272 656c 3d30 2e35 2929 0a20  n_correl=0.5)). 
+00011d60: 2020 2023 2043 6865 636b 2069 6620 6675     # Check if fu
+00011d70: 6e63 7469 6f6e 2067 6976 6573 2065 7272  nction gives err
+00011d80: 6f72 2062 6172 730a 0a0a 2020 2020 2370  or bars...    #p
+00011d90: 7269 6e74 2872 6573 756c 742e 6265 7374  rint(result.best
+00011da0: 5f76 616c 7565 7329 0a20 2020 2023 2047  _values).    # G
+00011db0: 6574 2066 6972 7374 2070 6561 6b20 6365  et first peak ce
+00011dc0: 6e74 6572 0a20 2020 2050 6561 6b31 5f43  nter.    Peak1_C
+00011dd0: 656e 743d 7265 7375 6c74 2e62 6573 745f  ent=result.best_
+00011de0: 7661 6c75 6573 2e67 6574 2827 6c7a 315f  values.get('lz1_
+00011df0: 6365 6e74 6572 2729 0a20 2020 2050 6561  center').    Pea
+00011e00: 6b31 5f49 6e74 3d72 6573 756c 742e 6265  k1_Int=result.be
+00011e10: 7374 5f76 616c 7565 732e 6765 7428 276c  st_values.get('l
+00011e20: 7a31 5f61 6d70 6c69 7475 6465 2729 0a20  z1_amplitude'). 
+00011e30: 2020 2050 6561 6b31 5f53 6967 6d61 3d72     Peak1_Sigma=r
+00011e40: 6573 756c 742e 6265 7374 5f76 616c 7565  esult.best_value
+00011e50: 732e 6765 7428 276c 7a31 5f73 6967 6d61  s.get('lz1_sigma
+00011e60: 2729 0a20 2020 2050 6561 6b31 5f67 616d  ').    Peak1_gam
+00011e70: 6d61 3d72 6573 756c 742e 6265 7374 5f76  ma=result.best_v
+00011e80: 616c 7565 732e 6765 7428 276c 7a31 5f67  alues.get('lz1_g
+00011e90: 616d 6d61 2729 0a20 2020 2050 6561 6b31  amma').    Peak1
+00011ea0: 5f50 726f 705f 4c6f 723d 7265 7375 6c74  _Prop_Lor=result
+00011eb0: 2e62 6573 745f 7661 6c75 6573 2e67 6574  .best_values.get
+00011ec0: 2827 6c7a 315f 6672 6163 7469 6f6e 2729  ('lz1_fraction')
+00011ed0: 0a20 2020 2050 6561 6b31 5f66 7768 6d3d  .    Peak1_fwhm=
+00011ee0: 7265 7375 6c74 2e70 6172 616d 735b 276c  result.params['l
+00011ef0: 7a31 5f66 7768 6d27 5d2e 7661 6c75 650a  z1_fwhm'].value.
+00011f00: 0a0a 2020 2020 6572 726f 725f 706b 3220  ..    error_pk2 
+00011f10: 3d20 7265 7375 6c74 2e70 6172 616d 735b  = result.params[
+00011f20: 276c 7a31 5f63 656e 7465 7227 5d2e 7374  'lz1_center'].st
+00011f30: 6465 7272 0a0a 0a0a 2020 2020 785f 6c69  derr....    x_li
+00011f40: 6e3d 6e70 2e6c 696e 7370 6163 6528 7370  n=np.linspace(sp
+00011f50: 616e 5b30 5d2c 2073 7061 6e5b 315d 2c20  an[0], span[1], 
+00011f60: 3230 3030 290a 2020 2020 795f 6265 7374  2000).    y_best
+00011f70: 5f66 6974 3d72 6573 756c 742e 6576 616c  _fit=result.eval
+00011f80: 2878 3d78 5f6c 696e 290a 2020 2020 636f  (x=x_lin).    co
+00011f90: 6d70 6f6e 656e 7473 3d72 6573 756c 742e  mponents=result.
+00011fa0: 6576 616c 5f63 6f6d 706f 6e65 6e74 7328  eval_components(
+00011fb0: 783d 785f 6c69 6e29 0a0a 0a0a 0a20 2020  x=x_lin).....   
+00011fc0: 2069 6620 636f 6e66 6967 312e 6669 745f   if config1.fit_
+00011fd0: 6761 7573 7320 6973 206e 6f74 2046 616c  gauss is not Fal
+00011fe0: 7365 3a0a 2020 2020 2020 2020 4761 7573  se:.        Gaus
+00011ff0: 735f 6365 6e74 3d72 6573 756c 742e 6265  s_cent=result.be
+00012000: 7374 5f76 616c 7565 732e 6765 7428 2762  st_values.get('b
+00012010: 6b67 5f63 656e 7465 7227 290a 2020 2020  kg_center').    
+00012020: 2020 2020 4761 7573 735f 616d 703d 7265      Gauss_amp=re
+00012030: 7375 6c74 2e62 6573 745f 7661 6c75 6573  sult.best_values
+00012040: 2e67 6574 2827 626b 675f 616d 706c 6974  .get('bkg_amplit
+00012050: 7564 6527 290a 2020 2020 2020 2020 4761  ude').        Ga
+00012060: 7573 735f 7369 676d 613d 7265 7375 6c74  uss_sigma=result
+00012070: 2e62 6573 745f 7661 6c75 6573 2e67 6574  .best_values.get
+00012080: 2827 626b 675f 7369 676d 6127 290a 0a20  ('bkg_sigma').. 
+00012090: 2020 2020 2020 206d 6178 5f47 6175 7373         max_Gauss
+000120a0: 3d6e 702e 6d61 7828 636f 6d70 6f6e 656e  =np.max(componen
+000120b0: 7473 2e67 6574 2827 626b 675f 2729 290a  ts.get('bkg_')).
+000120c0: 2020 2020 2020 2020 6d61 785f 766f 6967          max_voig
+000120d0: 743d 6e70 2e6d 6178 2863 6f6d 706f 6e65  t=np.max(compone
+000120e0: 6e74 732e 6765 7428 276c 7a31 5f27 2929  nts.get('lz1_'))
+000120f0: 0a20 2020 2020 2020 2069 6620 6d61 785f  .        if max_
+00012100: 4761 7573 733e 6d61 785f 766f 6967 742f  Gauss>max_voigt/
+00012110: 353a 0a20 2020 2020 2020 2020 2020 2072  5:.            r
+00012120: 6566 6974 5f70 6172 616d 3d73 7472 2872  efit_param=str(r
+00012130: 6566 6974 5f70 6172 616d 292b 2027 2047  efit_param)+ ' G
+00012140: 5f68 6967 6865 725f 7468 616e 5f64 6961  _higher_than_dia
+00012150: 6427 0a20 2020 2020 2020 2023 2069 6620  d'.        # if 
+00012160: 4761 7573 735f 7369 676d 613e 3d28 636f  Gauss_sigma>=(co
+00012170: 6e66 6967 312e 6761 7573 735f 7369 676d  nfig1.gauss_sigm
+00012180: 612a 3130 2d30 2e31 293a 0a20 2020 2020  a*10-0.1):.     
+00012190: 2020 2023 2020 2020 2072 6566 6974 3d54     #     refit=T
+000121a0: 7275 650a 2020 2020 2020 2020 2320 2020  rue.        #   
+000121b0: 2020 7265 6669 745f 7061 7261 6d3d 7374    refit_param=st
+000121c0: 7228 7265 6669 745f 7061 7261 6d29 2b27  r(refit_param)+'
+000121d0: 2047 5f69 6e70 7574 5f54 6f6f 4c6f 7753   G_input_TooLowS
+000121e0: 6967 6d61 270a 2020 2020 2020 2020 2320  igma'.        # 
+000121f0: 6966 2047 6175 7373 5f73 6967 6d61 3c3d  if Gauss_sigma<=
+00012200: 2863 6f6e 6669 6731 2e67 6175 7373 5f73  (config1.gauss_s
+00012210: 6967 6d61 2f31 302b 302e 3129 3a0a 2020  igma/10+0.1):.  
+00012220: 2020 2020 2020 2320 2020 2020 7265 6669        #     refi
+00012230: 743d 5472 7565 0a20 2020 2020 2020 2023  t=True.        #
+00012240: 2020 2020 2072 6566 6974 5f70 6172 616d       refit_param
+00012250: 3d73 7472 2872 6566 6974 5f70 6172 616d  =str(refit_param
+00012260: 292b 2027 2047 5f69 6e70 7574 5f54 6f6f  )+ ' G_input_Too
+00012270: 4869 6768 5369 676d 6127 0a20 2020 2020  HighSigma'.     
+00012280: 2020 2023 0a20 2020 2020 2020 2023 2069     #.        # i
+00012290: 6620 4761 7573 735f 616d 703e 3d28 636f  f Gauss_amp>=(co
+000122a0: 6e66 6967 312e 6761 7573 735f 616d 702a  nfig1.gauss_amp*
+000122b0: 3130 2d30 2e31 293a 0a20 2020 2020 2020  10-0.1):.       
+000122c0: 2023 2020 2020 2072 6566 6974 3d54 7275   #     refit=Tru
+000122d0: 650a 2020 2020 2020 2020 2320 2020 2020  e.        #     
+000122e0: 7265 6669 745f 7061 7261 6d3d 7374 7228  refit_param=str(
+000122f0: 7265 6669 745f 7061 7261 6d29 2b27 2047  refit_param)+' G
+00012300: 5f69 6e70 7574 5f54 6f6f 4c6f 7741 6d70  _input_TooLowAmp
+00012310: 270a 2020 2020 2020 2020 2320 6966 2047  '.        # if G
+00012320: 6175 7373 5f61 6d70 3c3d 2863 6f6e 6669  auss_amp<=(confi
+00012330: 6731 2e67 6175 7373 5f73 6967 6d61 2b30  g1.gauss_sigma+0
+00012340: 2e31 293a 0a20 2020 2020 2020 2023 2020  .1):.        #  
+00012350: 2020 2072 6566 6974 3d54 7275 650a 2020     refit=True.  
+00012360: 2020 2020 2020 2320 2020 2020 7265 6669        #     refi
+00012370: 745f 7061 7261 6d3d 7374 7228 7265 6669  t_param=str(refi
+00012380: 745f 7061 7261 6d29 2b27 2047 5f41 6d70  t_param)+' G_Amp
+00012390: 5f74 6f6f 5f68 6967 6827 0a20 2020 2020  _too_high'.     
+000123a0: 2020 2069 6620 4761 7573 735f 6365 6e74     if Gauss_cent
+000123b0: 3c3d 2863 6f6e 6669 6731 2e66 6974 5f67  <=(config1.fit_g
+000123c0: 6175 7373 2d33 302b 302e 3529 3a0a 2020  auss-30+0.5):.  
+000123d0: 2020 2020 2020 2020 2020 7265 6669 743d            refit=
+000123e0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+000123f0: 2072 6566 6974 5f70 6172 616d 3d73 7472   refit_param=str
+00012400: 2872 6566 6974 5f70 6172 616d 292b 2720  (refit_param)+' 
+00012410: 475f 496e 7075 7454 6f6f 4c6f 7743 656e  G_InputTooLowCen
+00012420: 7427 0a20 2020 2020 2020 2069 6620 4761  t'.        if Ga
+00012430: 7573 735f 6365 6e74 3e3d 2869 6e69 7469  uss_cent>=(initi
+00012440: 616c 5f67 7565 7373 2b33 302d 302e 3529  al_guess+30-0.5)
+00012450: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00012460: 6669 743d 5472 7565 0a20 2020 2020 2020  fit=True.       
+00012470: 2020 2020 2072 6566 6974 5f70 6172 616d       refit_param
+00012480: 3d73 7472 2872 6566 6974 5f70 6172 616d  =str(refit_param
+00012490: 292b 2720 475f 496e 7075 7454 6f6f 4869  )+' G_InputTooHi
+000124a0: 6768 4365 6e74 270a 0a0a 0a0a 0a20 2020  ghCent'......   
+000124b0: 2023 2070 7269 6e74 2827 6677 686d 2067   # print('fwhm g
+000124c0: 6175 7373 2729 0a20 2020 2023 2070 7269  auss').    # pri
+000124d0: 6e74 2872 6573 756c 742e 6265 7374 5f76  nt(result.best_v
+000124e0: 616c 7565 7329 0a0a 0a0a 0a20 2020 2023  alues).....    #
+000124f0: 0a0a 2020 2020 2320 576f 726b 206f 7574  ..    # Work out
+00012500: 2077 6861 7420 7065 616b 2069 7320 7768   what peak is wh
+00012510: 6174 0a20 2020 2069 6620 6469 6164 3220  at.    if diad2 
+00012520: 6973 2054 7275 653a 0a0a 2020 2020 2020  is True:..      
+00012530: 2020 6966 2066 6974 5f70 6561 6b73 3d3d    if fit_peaks==
+00012540: 313a 0a0a 2020 2020 2020 2020 2020 2020  1:..            
+00012550: 5065 616b 325f 4365 6e74 3d4e 6f6e 650a  Peak2_Cent=None.
+00012560: 2020 2020 2020 2020 2020 2020 5065 616b              Peak
+00012570: 335f 4365 6e74 3d4e 6f6e 650a 2020 2020  3_Cent=None.    
+00012580: 2020 2020 2020 2020 6178 315f 786c 696d          ax1_xlim
+00012590: 3d5b 4365 6e74 6572 5f69 6e69 2d31 352c  =[Center_ini-15,
+000125a0: 2043 656e 7465 725f 696e 692b 3135 5d0a   Center_ini+15].
+000125b0: 2020 2020 2020 2020 2020 2020 6178 325f              ax2_
+000125c0: 786c 696d 3d5b 4365 6e74 6572 5f69 6e69  xlim=[Center_ini
+000125d0: 2d31 352c 2043 656e 7465 725f 696e 692b  -15, Center_ini+
+000125e0: 3135 5d0a 0a20 2020 2020 2020 2069 6620  15]..        if 
+000125f0: 6669 745f 7065 616b 733d 3d32 3a0a 0a20  fit_peaks==2:.. 
+00012600: 2020 2020 2020 2020 2020 2050 6561 6b32             Peak2
+00012610: 5f43 656e 743d 7265 7375 6c74 2e62 6573  _Cent=result.bes
+00012620: 745f 7661 6c75 6573 2e67 6574 2827 6c7a  t_values.get('lz
+00012630: 325f 6365 6e74 6572 2729 0a20 2020 2020  2_center').     
+00012640: 2020 2020 2020 2050 6561 6b32 5f49 6e74         Peak2_Int
+00012650: 3d72 6573 756c 742e 6265 7374 5f76 616c  =result.best_val
+00012660: 7565 732e 6765 7428 276c 7a32 5f61 6d70  ues.get('lz2_amp
+00012670: 6c69 7475 6465 2729 0a20 2020 2020 2020  litude').       
+00012680: 2020 2020 2050 6561 6b32 5f53 6967 6d61       Peak2_Sigma
+00012690: 3d72 6573 756c 742e 6265 7374 5f76 616c  =result.best_val
+000126a0: 7565 732e 6765 7428 276c 7a32 5f73 6967  ues.get('lz2_sig
+000126b0: 6d61 2729 0a20 2020 2020 2020 2020 2020  ma').           
+000126c0: 2050 6561 6b33 5f43 656e 743d 4e6f 6e65   Peak3_Cent=None
+000126d0: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
+000126e0: 5f78 6c69 6d3d 5b43 656e 7465 725f 696e  _xlim=[Center_in
+000126f0: 692d 3135 2c20 4365 6e74 6572 5f69 6e69  i-15, Center_ini
+00012700: 2b33 305d 0a20 2020 2020 2020 2020 2020  +30].           
+00012710: 2061 7832 5f78 6c69 6d3d 5b43 656e 7465   ax2_xlim=[Cente
+00012720: 725f 696e 692d 3135 2c20 4365 6e74 6572  r_ini-15, Center
+00012730: 5f69 6e69 2b33 305d 0a0a 2020 2020 2020  _ini+30]..      
+00012740: 2020 6966 2066 6974 5f70 6561 6b73 3d3d    if fit_peaks==
+00012750: 333a 0a0a 2020 2020 2020 2020 2020 2020  3:..            
+00012760: 5065 616b 325f 4365 6e74 3d72 6573 756c  Peak2_Cent=resul
+00012770: 742e 6265 7374 5f76 616c 7565 732e 6765  t.best_values.ge
+00012780: 7428 276c 7a32 5f63 656e 7465 7227 290a  t('lz2_center').
+00012790: 2020 2020 2020 2020 2020 2020 5065 616b              Peak
+000127a0: 325f 496e 743d 7265 7375 6c74 2e62 6573  2_Int=result.bes
+000127b0: 745f 7661 6c75 6573 2e67 6574 2827 6c7a  t_values.get('lz
+000127c0: 325f 616d 706c 6974 7564 6527 290a 2020  2_amplitude').  
+000127d0: 2020 2020 2020 2020 2020 5065 616b 325f            Peak2_
+000127e0: 5369 676d 613d 7265 7375 6c74 2e62 6573  Sigma=result.bes
+000127f0: 745f 7661 6c75 6573 2e67 6574 2827 6c7a  t_values.get('lz
+00012800: 325f 7369 676d 6127 290a 2020 2020 2020  2_sigma').      
+00012810: 2020 2020 2020 5065 616b 335f 4365 6e74        Peak3_Cent
+00012820: 3d72 6573 756c 742e 6265 7374 5f76 616c  =result.best_val
+00012830: 7565 732e 6765 7428 276c 7a33 5f63 656e  ues.get('lz3_cen
+00012840: 7465 7227 290a 2020 2020 2020 2020 2020  ter').          
+00012850: 2020 5065 616b 335f 496e 743d 7265 7375    Peak3_Int=resu
+00012860: 6c74 2e62 6573 745f 7661 6c75 6573 2e67  lt.best_values.g
+00012870: 6574 2827 6c7a 335f 616d 706c 6974 7564  et('lz3_amplitud
+00012880: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
+00012890: 5065 616b 335f 5369 676d 613d 7265 7375  Peak3_Sigma=resu
+000128a0: 6c74 2e62 6573 745f 7661 6c75 6573 2e67  lt.best_values.g
+000128b0: 6574 2827 6c7a 335f 7369 676d 6127 290a  et('lz3_sigma').
+000128c0: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
+000128d0: 5f78 6c69 6d3d 5b43 656e 7465 725f 696e  _xlim=[Center_in
+000128e0: 692d 3330 2c20 4365 6e74 6572 5f69 6e69  i-30, Center_ini
+000128f0: 2b33 305d 0a20 2020 2020 2020 2020 2020  +30].           
+00012900: 2061 7832 5f78 6c69 6d3d 5b43 656e 7465   ax2_xlim=[Cente
+00012910: 725f 696e 692d 3330 2c20 4365 6e74 6572  r_ini-30, Center
+00012920: 5f69 6e69 2b33 305d 0a0a 2020 2020 2020  _ini+30]..      
+00012930: 2020 6966 2050 6561 6b32 5f43 656e 7420    if Peak2_Cent 
+00012940: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00012950: 2020 2020 2064 665f 6f75 743d 7064 2e44       df_out=pd.D
+00012960: 6174 6146 7261 6d65 2864 6174 613d 7b27  ataFrame(data={'
+00012970: 4469 6164 325f 566f 6967 745f 4365 6e74  Diad2_Voigt_Cent
+00012980: 273a 2050 6561 6b31 5f43 656e 742c 0a20  ': Peak1_Cent,. 
+00012990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129b0: 2020 2027 4469 6164 325f 6365 6e74 5f65     'Diad2_cent_e
+000129c0: 7272 273a 2065 7272 6f72 5f70 6b32 2c0a  rr': error_pk2,.
+000129d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129f0: 2020 2020 2744 6961 6432 5f56 6f69 6774      'Diad2_Voigt
+00012a00: 5f41 7265 6127 3a20 5065 616b 315f 496e  _Area': Peak1_In
+00012a10: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+00012a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a30: 2020 2027 4469 6164 325f 566f 6967 745f     'Diad2_Voigt_
+00012a40: 5369 676d 6127 3a20 5065 616b 315f 5369  Sigma': Peak1_Si
+00012a50: 676d 612c 0a20 2020 2020 2020 2020 2020  gma,.           
+00012a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a70: 2020 2020 2027 4469 6164 325f 566f 6967       'Diad2_Voig
+00012a80: 745f 4761 6d6d 6127 3a20 5065 616b 315f  t_Gamma': Peak1_
+00012a90: 6761 6d6d 612c 0a0a 0a20 2020 2020 2020  gamma,...       
+00012aa0: 2020 2020 207d 2c20 696e 6465 783d 5b30       }, index=[0
+00012ab0: 5d29 0a0a 2020 2020 2020 2020 6966 2050  ])..        if P
+00012ac0: 6561 6b32 5f43 656e 7420 6973 206e 6f74  eak2_Cent is not
+00012ad0: 204e 6f6e 653a 0a0a 0a20 2020 2020 2020   None:...       
+00012ae0: 2020 2020 2069 6620 5065 616b 335f 4365       if Peak3_Ce
+00012af0: 6e74 2069 7320 4e6f 6e65 3a0a 2020 2020  nt is None:.    
+00012b00: 2020 2020 2020 2020 2020 2020 5065 616b              Peak
+00012b10: 733d 6e70 2e61 7272 6179 285b 5065 616b  s=np.array([Peak
+00012b20: 315f 4365 6e74 2c20 5065 616b 325f 4365  1_Cent, Peak2_Ce
+00012b30: 6e74 5d29 0a20 2020 2020 2020 2020 2020  nt]).           
+00012b40: 2020 2020 2023 2044 6961 6420 6973 206c       # Diad is l
+00012b50: 6f77 6572 2070 6561 6b0a 2020 2020 2020  ower peak.      
+00012b60: 2020 2020 2020 2020 2020 4469 6164 325f            Diad2_
+00012b70: 4365 6e74 3d6e 702e 6d69 6e28 5065 616b  Cent=np.min(Peak
+00012b80: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00012b90: 2020 2023 2048 6f74 2062 616e 6420 6973     # Hot band is
+00012ba0: 2075 7070 6572 2070 6561 6b27 0a20 2020   upper peak'.   
+00012bb0: 2020 2020 2020 2020 2020 2020 2048 4232               HB2
+00012bc0: 5f43 656e 743d 6e70 2e6d 6178 2850 6561  _Cent=np.max(Pea
+00012bd0: 6b73 290a 2020 2020 2020 2020 2020 2020  ks).            
+00012be0: 2020 2020 2320 416c 6c6f 6361 7465 2061      # Allocate a
+00012bf0: 7265 6173 0a20 2020 2020 2020 2020 2020  reas.           
+00012c00: 2020 2020 2069 6620 4469 6164 325f 4365       if Diad2_Ce
+00012c10: 6e74 3d3d 5065 616b 325f 4365 6e74 3a0a  nt==Peak2_Cent:.
+00012c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c30: 2020 2020 4469 6164 325f 496e 743d 5065      Diad2_Int=Pe
+00012c40: 616b 325f 496e 740a 2020 2020 2020 2020  ak2_Int.        
+00012c50: 2020 2020 2020 2020 2020 2020 4842 325f              HB2_
+00012c60: 496e 743d 5065 616b 315f 496e 740a 2020  Int=Peak1_Int.  
+00012c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c80: 2020 4842 325f 5369 676d 613d 5065 616b    HB2_Sigma=Peak
+00012c90: 315f 5369 676d 610a 2020 2020 2020 2020  1_Sigma.        
+00012ca0: 2020 2020 2020 2020 6966 2044 6961 6432          if Diad2
+00012cb0: 5f43 656e 743d 3d50 6561 6b31 5f43 656e  _Cent==Peak1_Cen
+00012cc0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00012cd0: 2020 2020 2020 2044 6961 6432 5f49 6e74         Diad2_Int
+00012ce0: 3d50 6561 6b31 5f49 6e74 0a20 2020 2020  =Peak1_Int.     
+00012cf0: 2020 2020 2020 2020 2020 2020 2020 2048                 H
+00012d00: 4232 5f49 6e74 3d50 6561 6b32 5f49 6e74  B2_Int=Peak2_Int
+00012d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012d20: 2020 2020 2048 4232 5f53 6967 6d61 3d50       HB2_Sigma=P
+00012d30: 6561 6b32 5f53 6967 6d61 0a0a 0a0a 0a20  eak2_Sigma..... 
+00012d40: 2020 2020 2020 2020 2020 2069 6620 5065             if Pe
+00012d50: 616b 335f 4365 6e74 2069 7320 6e6f 7420  ak3_Cent is not 
+00012d60: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00012d70: 2020 2020 2020 5065 616b 733d 6e70 2e61        Peaks=np.a
+00012d80: 7272 6179 285b 5065 616b 315f 4365 6e74  rray([Peak1_Cent
+00012d90: 2c20 5065 616b 325f 4365 6e74 2c20 5065  , Peak2_Cent, Pe
+00012da0: 616b 335f 4365 6e74 5d29 0a0a 2020 2020  ak3_Cent])..    
+00012db0: 2020 2020 2020 2020 2020 2020 2320 4331              # C1
+00012dc0: 3320 6973 206c 6f77 6572 2070 6561 6b0a  3 is lower peak.
+00012dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012de0: 4331 335f 4365 6e74 3d6e 702e 6d69 6e28  C13_Cent=np.min(
+00012df0: 5065 616b 7329 0a20 2020 2020 2020 2020  Peaks).         
+00012e00: 2020 2020 2020 2023 2044 6961 6420 6973         # Diad is
+00012e10: 206d 6564 6975 6d20 7065 616b 0a20 2020   medium peak.   
+00012e20: 2020 2020 2020 2020 2020 2020 2044 6961               Dia
+00012e30: 6432 5f43 656e 743d 6e70 2e6d 6564 6961  d2_Cent=np.media
+00012e40: 6e28 5065 616b 7329 0a20 2020 2020 2020  n(Peaks).       
+00012e50: 2020 2020 2020 2020 2023 2048 6f74 2062           # Hot b
+00012e60: 616e 6420 6973 2075 7070 6572 2070 6561  and is upper pea
+00012e70: 6b27 0a20 2020 2020 2020 2020 2020 2020  k'.             
+00012e80: 2020 2048 4232 5f43 656e 743d 6e70 2e6d     HB2_Cent=np.m
+00012e90: 6178 2850 6561 6b73 290a 0a20 2020 2020  ax(Peaks)..     
+00012ea0: 2020 2020 2020 2020 2020 2069 6620 4469             if Di
+00012eb0: 6164 325f 4365 6e74 3d3d 5065 616b 325f  ad2_Cent==Peak2_
+00012ec0: 4365 6e74 3a0a 2020 2020 2020 2020 2020  Cent:.          
+00012ed0: 2020 2020 2020 2020 2020 4469 6164 325f            Diad2_
+00012ee0: 496e 743d 5065 616b 325f 496e 740a 2020  Int=Peak2_Int.  
+00012ef0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00012f00: 2044 6961 6432 5f43 656e 743d 3d50 6561   Diad2_Cent==Pea
+00012f10: 6b31 5f43 656e 743a 0a20 2020 2020 2020  k1_Cent:.       
+00012f20: 2020 2020 2020 2020 2020 2020 2044 6961               Dia
+00012f30: 6432 5f49 6e74 3d50 6561 6b31 5f49 6e74  d2_Int=Peak1_Int
+00012f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012f50: 2069 6620 4469 6164 325f 4365 6e74 3d3d   if Diad2_Cent==
+00012f60: 5065 616b 335f 4365 6e74 3a0a 2020 2020  Peak3_Cent:.    
+00012f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f80: 4469 6164 325f 496e 743d 5065 616b 335f  Diad2_Int=Peak3_
+00012f90: 496e 740a 2020 2020 2020 2020 2020 2020  Int.            
+00012fa0: 2020 2020 2320 5361 6d65 2066 6f72 2068      # Same for h
+00012fb0: 6f74 6261 6e64 0a20 2020 2020 2020 2020  otband.         
+00012fc0: 2020 2020 2020 2069 6620 4842 325f 4365         if HB2_Ce
+00012fd0: 6e74 3d3d 5065 616b 325f 4365 6e74 3a0a  nt==Peak2_Cent:.
+00012fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ff0: 2020 2020 4842 325f 496e 743d 5065 616b      HB2_Int=Peak
+00013000: 325f 496e 740a 2020 2020 2020 2020 2020  2_Int.          
+00013010: 2020 2020 2020 2020 2020 4842 325f 5369            HB2_Si
+00013020: 676d 613d 5065 616b 325f 5369 676d 610a  gma=Peak2_Sigma.
+00013030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013040: 6966 2048 4232 5f43 656e 743d 3d50 6561  if HB2_Cent==Pea
+00013050: 6b31 5f43 656e 743a 0a20 2020 2020 2020  k1_Cent:.       
+00013060: 2020 2020 2020 2020 2020 2020 2048 4232               HB2
+00013070: 5f49 6e74 3d50 6561 6b31 5f49 6e74 0a20  _Int=Peak1_Int. 
+00013080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013090: 2020 2048 4232 5f53 6967 6d61 3d50 6561     HB2_Sigma=Pea
+000130a0: 6b31 5f53 6967 6d61 0a20 2020 2020 2020  k1_Sigma.       
+000130b0: 2020 2020 2020 2020 2069 6620 4842 325f           if HB2_
+000130c0: 4365 6e74 3d3d 5065 616b 335f 4365 6e74  Cent==Peak3_Cent
+000130d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000130e0: 2020 2020 2020 4842 325f 496e 743d 5065        HB2_Int=Pe
+000130f0: 616b 335f 496e 740a 2020 2020 2020 2020  ak3_Int.        
+00013100: 2020 2020 2020 2020 2020 2020 4842 325f              HB2_
+00013110: 5369 676d 613d 5065 616b 325f 5369 676d  Sigma=Peak2_Sigm
+00013120: 610a 0a0a 2020 2020 2020 2020 2020 2020  a...            
+00013130: 2020 2020 2320 5361 6d65 2066 6f72 2043      # Same for C
+00013140: 3133 0a20 2020 2020 2020 2020 2020 2020  13.             
+00013150: 2020 2069 6620 4331 335f 4365 6e74 3d3d     if C13_Cent==
+00013160: 5065 616b 325f 4365 6e74 3a0a 2020 2020  Peak2_Cent:.    
+00013170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013180: 4331 335f 496e 743d 5065 616b 325f 496e  C13_Int=Peak2_In
+00013190: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+000131a0: 2020 2020 2020 4331 335f 5369 676d 613d        C13_Sigma=
+000131b0: 5065 616b 325f 5369 676d 610a 2020 2020  Peak2_Sigma.    
+000131c0: 2020 2020 2020 2020 2020 2020 6966 2043              if C
+000131d0: 3133 5f43 656e 743d 3d50 6561 6b31 5f43  13_Cent==Peak1_C
+000131e0: 656e 743a 0a20 2020 2020 2020 2020 2020  ent:.           
+000131f0: 2020 2020 2020 2020 2043 3133 5f49 6e74           C13_Int
+00013200: 3d50 6561 6b31 5f49 6e74 0a20 2020 2020  =Peak1_Int.     
+00013210: 2020 2020 2020 2020 2020 2020 2020 2043                 C
+00013220: 3133 5f53 6967 6d61 3d50 6561 6b31 5f53  13_Sigma=Peak1_S
+00013230: 6967 6d61 0a20 2020 2020 2020 2020 2020  igma.           
+00013240: 2020 2020 2069 6620 4331 335f 4365 6e74       if C13_Cent
+00013250: 3d3d 5065 616b 335f 4365 6e74 3a0a 2020  ==Peak3_Cent:.  
+00013260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013270: 2020 4331 335f 496e 743d 5065 616b 335f    C13_Int=Peak3_
+00013280: 496e 740a 2020 2020 2020 2020 2020 2020  Int.            
+00013290: 2020 2020 2020 2020 4331 335f 5369 676d          C13_Sigm
+000132a0: 613d 5065 616b 335f 5369 676d 610a 0a20  a=Peak3_Sigma.. 
+000132b0: 2020 2020 2020 2020 2020 2064 665f 6f75             df_ou
+000132c0: 743d 7064 2e44 6174 6146 7261 6d65 2864  t=pd.DataFrame(d
+000132d0: 6174 613d 7b27 4469 6164 325f 566f 6967  ata={'Diad2_Voig
+000132e0: 745f 4365 6e74 273a 2044 6961 6432 5f43  t_Cent': Diad2_C
+000132f0: 656e 742c 0a20 2020 2020 2020 2020 2020  ent,.           
+00013300: 2027 4469 6164 325f 6365 6e74 5f65 7272   'Diad2_cent_err
+00013310: 273a 2065 7272 6f72 5f70 6b32 2c0a 2020  ': error_pk2,.  
+00013320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013340: 2020 2744 6961 6432 5f56 6f69 6774 5f41    'Diad2_Voigt_A
+00013350: 7265 6127 3a20 4469 6164 325f 496e 742c  rea': Diad2_Int,
+00013360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013380: 2020 2020 2027 4469 6164 325f 566f 6967       'Diad2_Voig
+00013390: 745f 5369 676d 6127 3a20 5065 616b 315f  t_Sigma': Peak1_
+000133a0: 5369 676d 612c 0a20 2020 2020 2020 2020  Sigma,.         
+000133b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133c0: 2020 2020 2020 2020 2020 2027 4469 6164             'Diad
+000133d0: 325f 566f 6967 745f 4761 6d6d 6127 3a20  2_Voigt_Gamma': 
+000133e0: 5065 616b 315f 6761 6d6d 612c 0a20 2020  Peak1_gamma,.   
+000133f0: 2020 2020 2020 2020 207d 2c20 696e 6465           }, inde
+00013400: 783d 5b30 5d29 0a0a 2020 2020 2020 2020  x=[0])..        
+00013410: 2020 2020 6466 5f6f 7574 5b27 4842 325f      df_out['HB2_
+00013420: 4365 6e74 275d 3d48 4232 5f43 656e 740a  Cent']=HB2_Cent.
+00013430: 2020 2020 2020 2020 2020 2020 6466 5f6f              df_o
+00013440: 7574 5b27 4842 325f 4172 6561 275d 3d48  ut['HB2_Area']=H
+00013450: 4232 5f49 6e74 0a20 2020 2020 2020 2020  B2_Int.         
+00013460: 2020 2064 665f 6f75 745b 2748 4232 5f53     df_out['HB2_S
+00013470: 6967 6d61 275d 3d48 4232 5f53 6967 6d61  igma']=HB2_Sigma
+00013480: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00013490: 2050 6561 6b33 5f43 656e 7420 6973 206e   Peak3_Cent is n
+000134a0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000134b0: 2020 2020 2020 2020 2064 665f 6f75 745b           df_out[
+000134c0: 2743 3133 5f43 656e 7427 5d3d 4331 335f  'C13_Cent']=C13_
+000134d0: 4365 6e74 0a20 2020 2020 2020 2020 2020  Cent.           
+000134e0: 2020 2020 2064 665f 6f75 745b 2743 3133       df_out['C13
+000134f0: 5f41 7265 6127 5d3d 4331 335f 496e 740a  _Area']=C13_Int.
+00013500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013510: 6466 5f6f 7574 5b27 4331 335f 5369 676d  df_out['C13_Sigm
+00013520: 6127 5d3d 4331 335f 5369 676d 610a 0a20  a']=C13_Sigma.. 
+00013530: 2020 2020 2020 2072 6573 756c 745f 6469         result_di
+00013540: 6164 325f 6f72 6967 785f 616c 6c3d 7265  ad2_origx_all=re
+00013550: 7375 6c74 2e65 7661 6c28 783d 7864 6174  sult.eval(x=xdat
+00013560: 290a 2020 2020 2020 2020 2320 5472 696d  ).        # Trim
+00013570: 2074 6f20 6265 2069 6e20 7261 6e67 650a   to be in range.
+00013580: 2020 2020 2020 2020 2370 7269 6e74 2872          #print(r
+00013590: 6573 756c 745f 6469 6164 325f 6f72 6967  esult_diad2_orig
+000135a0: 785f 616c 6c29 0a20 2020 2020 2020 2072  x_all).        r
+000135b0: 6573 756c 745f 6469 6164 325f 6f72 6967  esult_diad2_orig
+000135c0: 783d 7265 7375 6c74 5f64 6961 6432 5f6f  x=result_diad2_o
+000135d0: 7269 6778 5f61 6c6c 5b28 7864 6174 3e73  rigx_all[(xdat>s
+000135e0: 7061 6e5b 305d 2920 2620 2878 6461 743c  pan[0]) & (xdat<
+000135f0: 7370 616e 5b31 5d29 5d0a 2020 2020 2020  span[1])].      
+00013600: 2020 7964 6174 5f69 6e72 616e 6765 3d79    ydat_inrange=y
+00013610: 6461 745b 2878 6461 743e 7370 616e 5b30  dat[(xdat>span[0
+00013620: 5d29 2026 2028 7864 6174 3c73 7061 6e5b  ]) & (xdat<span[
+00013630: 315d 295d 0a20 2020 2020 2020 2078 6461  1])].        xda
+00013640: 745f 696e 7261 6e67 653d 7864 6174 5b28  t_inrange=xdat[(
+00013650: 7864 6174 3e73 7061 6e5b 305d 2920 2620  xdat>span[0]) & 
+00013660: 2878 6461 743c 7370 616e 5b31 5d29 5d0a  (xdat<span[1])].
+00013670: 2020 2020 2020 2020 7265 7369 6475 616c          residual
+00013680: 5f64 6961 645f 636f 6f72 6473 3d79 6461  _diad_coords=yda
+00013690: 745f 696e 7261 6e67 652d 7265 7375 6c74  t_inrange-result
+000136a0: 5f64 6961 6432 5f6f 7269 6778 0a0a 0a20  _diad2_origx... 
+000136b0: 2020 2020 2020 2078 5f63 656e 745f 6c69         x_cent_li
+000136c0: 6e3d 6e70 2e6c 696e 7370 6163 6528 6466  n=np.linspace(df
+000136d0: 5f6f 7574 5b27 4469 6164 325f 566f 6967  _out['Diad2_Voig
+000136e0: 745f 4365 6e74 275d 2d31 2c20 6466 5f6f  t_Cent']-1, df_o
+000136f0: 7574 5b27 4469 6164 325f 566f 6967 745f  ut['Diad2_Voigt_
+00013700: 4365 6e74 275d 2b31 2c20 3230 3030 3029  Cent']+1, 20000)
+00013710: 0a20 2020 2020 2020 2079 5f63 656e 745f  .        y_cent_
+00013720: 6265 7374 5f66 6974 3d72 6573 756c 742e  best_fit=result.
+00013730: 6576 616c 2878 3d78 5f63 656e 745f 6c69  eval(x=x_cent_li
+00013740: 6e29 0a20 2020 2020 2020 2064 6961 645f  n).        diad_
+00013750: 6865 6967 6874 203d 206e 702e 6d61 7828  height = np.max(
+00013760: 795f 6365 6e74 5f62 6573 745f 6669 7429  y_cent_best_fit)
+00013770: 0a20 2020 2020 2020 2064 665f 6f75 745b  .        df_out[
+00013780: 2744 6961 6432 5f43 6f6d 626f 6669 745f  'Diad2_Combofit_
+00013790: 4865 6967 6874 275d 3d20 6469 6164 5f68  Height']= diad_h
+000137a0: 6569 6768 740a 2020 2020 2020 2020 6466  eight.        df
+000137b0: 5f6f 7574 2e69 6e73 6572 7428 302c 2027  _out.insert(0, '
+000137c0: 4469 6164 325f 436f 6d62 6f66 6974 5f43  Diad2_Combofit_C
+000137d0: 656e 7427 2c20 6e70 2e6e 616e 6d65 616e  ent', np.nanmean
+000137e0: 2878 5f63 656e 745f 6c69 6e5b 795f 6365  (x_cent_lin[y_ce
+000137f0: 6e74 5f62 6573 745f 6669 743d 3d64 6961  nt_best_fit==dia
+00013800: 645f 6865 6967 6874 5d29 290a 0a0a 2020  d_height]))...  
+00013810: 2020 2020 2020 7265 7369 6475 616c 5f64        residual_d
+00013820: 6961 6432 3d6e 702e 7375 6d28 2828 7964  iad2=np.sum(((yd
+00013830: 6174 5f69 6e72 616e 6765 2d72 6573 756c  at_inrange-resul
+00013840: 745f 6469 6164 325f 6f72 6967 7829 2a2a  t_diad2_origx)**
+00013850: 3229 2a2a 302e 3529 2f28 6c65 6e28 7964  2)**0.5)/(len(yd
+00013860: 6174 5f69 6e72 616e 6765 2929 0a20 2020  at_inrange)).   
+00013870: 2020 2020 2064 665f 6f75 745b 2744 6961       df_out['Dia
+00013880: 6432 5f52 6573 6964 7561 6c27 5d3d 7265  d2_Residual']=re
+00013890: 7369 6475 616c 5f64 6961 6432 0a20 2020  sidual_diad2.   
+000138a0: 2020 2020 2064 665f 6f75 745b 2744 6961       df_out['Dia
+000138b0: 6432 5f50 726f 705f 4c6f 7227 5d3d 2050  d2_Prop_Lor']= P
+000138c0: 6561 6b31 5f50 726f 705f 4c6f 720a 2020  eak1_Prop_Lor.  
+000138d0: 2020 2020 2020 6466 5f6f 7574 5b27 4469        df_out['Di
+000138e0: 6164 325f 6677 686d 275d 3d50 6561 6b31  ad2_fwhm']=Peak1
+000138f0: 5f66 7768 6d0a 0a20 2020 2020 2020 2069  _fwhm..        i
+00013900: 6620 636f 6e66 6967 312e 6669 745f 6761  f config1.fit_ga
+00013910: 7573 7320 6973 206e 6f74 2046 616c 7365  uss is not False
+00013920: 3a0a 2020 2020 2020 2020 2020 2020 6466  :.            df
+00013930: 5f6f 7574 5b27 4469 6164 325f 4761 7573  _out['Diad2_Gaus
+00013940: 735f 4365 6e74 275d 3d47 6175 7373 5f63  s_Cent']=Gauss_c
+00013950: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
+00013960: 6466 5f6f 7574 5b27 4469 6164 325f 4761  df_out['Diad2_Ga
+00013970: 7573 735f 4172 6561 275d 3d47 6175 7373  uss_Area']=Gauss
+00013980: 5f61 6d70 0a20 2020 2020 2020 2020 2020  _amp.           
+00013990: 2064 665f 6f75 745b 2744 6961 6432 5f47   df_out['Diad2_G
+000139a0: 6175 7373 5f53 6967 6d61 275d 3d47 6175  auss_Sigma']=Gau
+000139b0: 7373 5f73 6967 6d61 0a0a 0a20 2020 2020  ss_sigma...     
+000139c0: 2020 2023 4368 6563 6b69 6e67 2077 6865     #Checking whe
+000139d0: 7468 6572 2079 6f75 206e 6565 6420 616e  ther you need an
+000139e0: 7920 666c 6167 732e 0a20 2020 2020 2020  y flags..       
+000139f0: 2069 6620 6572 726f 725f 706b 3220 6973   if error_pk2 is
+00013a00: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00013a10: 2020 2072 6566 6974 3d54 7275 650a 2020     refit=True.  
+00013a20: 2020 2020 2020 2020 2020 7265 6669 745f            refit_
+00013a30: 7061 7261 6d3d 7374 7228 7265 6669 745f  param=str(refit_
+00013a40: 7061 7261 6d29 2b27 204e 6f20 4572 726f  param)+' No Erro
+00013a50: 7227 0a0a 0a20 2020 2020 2020 2069 6620  r'...        if 
+00013a60: 5065 616b 315f 496e 743e 3d28 6361 6c63  Peak1_Int>=(calc
+00013a70: 5f64 6961 645f 616d 706c 6974 7564 652a  _diad_amplitude*
+00013a80: 3130 2d30 2e31 293a 0a20 2020 2020 2020  10-0.1):.       
+00013a90: 2020 2020 2072 6566 6974 3d54 7275 650a       refit=True.
+00013aa0: 2020 2020 2020 2020 2020 2020 7265 6669              refi
+00013ab0: 745f 7061 7261 6d3d 7374 7228 7265 6669  t_param=str(refi
+00013ac0: 745f 7061 7261 6d29 2b27 2056 5f4c 6f77  t_param)+' V_Low
+00013ad0: 416d 7027 0a20 2020 2020 2020 2069 6620  Amp'.        if 
+00013ae0: 5065 616b 315f 5369 676d 613e 3d28 6361  Peak1_Sigma>=(ca
+00013af0: 6c63 5f64 6961 645f 616d 706c 6974 7564  lc_diad_amplitud
+00013b00: 652a 3130 2d30 2e31 293a 0a20 2020 2020  e*10-0.1):.     
+00013b10: 2020 2020 2020 2072 6566 6974 3d54 7275         refit=Tru
+00013b20: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
+00013b30: 6669 745f 7061 7261 6d3d 7374 7228 7265  fit_param=str(re
+00013b40: 6669 745f 7061 7261 6d29 2b27 2056 5f48  fit_param)+' V_H
+00013b50: 6967 6841 6d70 270a 2020 2020 2020 2020  ighAmp'.        
+00013b60: 6966 2050 6561 6b31 5f53 6967 6d61 3e3d  if Peak1_Sigma>=
+00013b70: 2863 6f6e 6669 6731 2e64 6961 645f 7369  (config1.diad_si
+00013b80: 676d 612a 636f 6e66 6967 312e 6469 6164  gma*config1.diad
+00013b90: 5f73 6967 6d61 5f6d 6178 5f61 6c6c 6f77  _sigma_max_allow
+00013ba0: 616e 6365 2d30 2e30 3031 293a 0a20 2020  ance-0.001):.   
+00013bb0: 2020 2020 2020 2020 2072 6566 6974 3d54           refit=T
+00013bc0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00013bd0: 7265 6669 745f 7061 7261 6d3d 7374 7228  refit_param=str(
+00013be0: 7265 6669 745f 7061 7261 6d29 2b27 2056  refit_param)+' V
+00013bf0: 5f53 6967 6d61 5f74 6f6f 5f4c 6f77 270a  _Sigma_too_Low'.
+00013c00: 2020 2020 2020 2020 6966 2020 6469 6164          if  diad
+00013c10: 5f68 6569 6768 743e 2833 2a63 6f6e 6669  _height>(3*confi
+00013c20: 6731 2e64 6961 645f 7072 6f6d 293a 0a20  g1.diad_prom):. 
+00013c30: 2020 2020 2020 2020 2020 2072 6566 6974             refit
+00013c40: 5f70 6172 616d 3d73 7472 2872 6566 6974  _param=str(refit
+00013c50: 5f70 6172 616d 292b 2720 565f 5369 676d  _param)+' V_Sigm
+00013c60: 615f 746f 6f5f 4c6f 7727 0a20 2020 2020  a_too_Low'.     
+00013c70: 2020 2069 6620 2064 6961 645f 6865 6967     if  diad_heig
+00013c80: 6874 3c28 302e 352a 636f 6e66 6967 312e  ht<(0.5*config1.
+00013c90: 6469 6164 5f70 726f 6d29 3a0a 2020 2020  diad_prom):.    
+00013ca0: 2020 2020 2020 2020 7265 6669 745f 7061          refit_pa
+00013cb0: 7261 6d3d 7374 7228 7265 6669 745f 7061  ram=str(refit_pa
+00013cc0: 7261 6d29 2b27 2056 5f53 6967 6d61 5f74  ram)+' V_Sigma_t
+00013cd0: 6f6f 5f48 6967 6827 0a20 2020 2020 2020  oo_High'.       
+00013ce0: 2069 6620 5065 616b 315f 5369 676d 613c   if Peak1_Sigma<
+00013cf0: 3d28 636f 6e66 6967 312e 6469 6164 5f73  =(config1.diad_s
+00013d00: 6967 6d61 2a63 6f6e 6669 6731 2e64 6961  igma*config1.dia
+00013d10: 645f 7369 676d 615f 6d69 6e5f 616c 6c6f  d_sigma_min_allo
+00013d20: 7761 6e63 652b 302e 3030 3129 3a0a 2020  wance+0.001):.  
+00013d30: 2020 2020 2020 2020 2020 7265 6669 743d            refit=
+00013d40: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00013d50: 2072 6566 6974 5f70 6172 616d 3d73 7472   refit_param=str
+00013d60: 2872 6566 6974 5f70 6172 616d 292b 2720  (refit_param)+' 
+00013d70: 565f 5369 676d 615f 746f 6f5f 4869 6768  V_Sigma_too_High
+00013d80: 270a 2020 2020 2020 2020 6966 2064 6961  '.        if dia
+00013d90: 645f 6865 6967 6874 3c63 6f6e 6669 6731  d_height<config1
+00013da0: 2e74 6872 6573 686f 6c64 5f69 6e74 656e  .threshold_inten
+00013db0: 7369 7479 3a0a 2020 2020 2020 2020 2020  sity:.          
+00013dc0: 2020 7265 6669 745f 7061 7261 6d3d 7374    refit_param=st
+00013dd0: 7228 7265 6669 745f 7061 7261 6d29 2b27  r(refit_param)+'
+00013de0: 2042 656c 6f77 2074 6872 6573 686f 6c64   Below threshold
+00013df0: 2069 6e74 656e 7369 7479 270a 0a20 2020   intensity'..   
+00013e00: 2023 6966 2066 696e 646d 650a 0a0a 2020   #if findme...  
+00013e10: 2020 2020 2020 6966 2070 6c6f 745f 6669        if plot_fi
+00013e20: 6775 7265 2069 7320 5472 7565 3a0a 0a20  gure is True:.. 
+00013e30: 2020 2020 2020 2020 2020 2066 6967 2c20             fig, 
+00013e40: 2861 7831 2c20 6178 3229 203d 2070 6c74  (ax1, ax2) = plt
+00013e50: 2e73 7562 706c 6f74 7328 312c 2032 2c20  .subplots(1, 2, 
+00013e60: 6669 6773 697a 653d 2831 322c 3429 290a  figsize=(12,4)).
+00013e70: 2020 2020 2020 2020 2020 2020 6178 312e              ax1.
+00013e80: 706c 6f74 2878 5f6c 696e 2c20 795f 6265  plot(x_lin, y_be
+00013e90: 7374 5f66 6974 2c20 272d 6727 2c20 6c69  st_fit, '-g', li
+00013ea0: 6e65 7769 6474 683d 322c 206c 6162 656c  newidth=2, label
+00013eb0: 3d27 6265 7374 2066 6974 2729 0a20 2020  ='best fit').   
+00013ec0: 2020 2020 2020 2020 2061 7831 2e70 6c6f           ax1.plo
+00013ed0: 7428 7864 6174 2c20 7964 6174 2c20 2027  t(xdat, ydat,  '
+00013ee0: 2e6b 272c 206c 6162 656c 3d27 6461 7461  .k', label='data
+00013ef0: 2729 0a20 2020 2020 2020 2020 2020 2061  ').            a
+00013f00: 7831 2e6c 6567 656e 6428 290a 2020 2020  x1.legend().    
+00013f10: 2020 2020 2020 2020 6178 312e 7365 745f          ax1.set_
+00013f20: 786c 696d 2861 7831 5f78 6c69 6d29 0a20  xlim(ax1_xlim). 
+00013f30: 2020 2020 2020 2020 2020 2061 7832 2e73             ax2.s
+00013f40: 6574 5f78 6c69 6d28 6178 325f 786c 696d  et_xlim(ax2_xlim
+00013f50: 290a 0a0a 0a0a 0a0a 2020 2020 2020 2020  ).......        
+00013f60: 2020 2020 6966 2063 6f6e 6669 6731 2e66      if config1.f
+00013f70: 6974 5f67 6175 7373 2069 7320 6e6f 7420  it_gauss is not 
+00013f80: 4661 6c73 653a 0a20 2020 2020 2020 2020  False:.         
+00013f90: 2020 2020 2020 2061 7832 2e70 6c6f 7428         ax2.plot(
+00013fa0: 785f 6c69 6e2c 2063 6f6d 706f 6e65 6e74  x_lin, component
+00013fb0: 732e 6765 7428 2762 6b67 5f27 292c 2027  s.get('bkg_'), '
+00013fc0: 2e63 272c 6c69 6e65 7769 6474 683d 322c  .c',linewidth=2,
+00013fd0: 2020 6c61 6265 6c3d 2747 6175 7373 6961    label='Gaussia
+00013fe0: 6e20 6263 6b27 290a 2020 2020 2020 2020  n bck').        
+00013ff0: 2020 2020 6178 322e 706c 6f74 2878 5f6c      ax2.plot(x_l
+00014000: 696e 2c20 636f 6d70 6f6e 656e 7473 2e67  in, components.g
+00014010: 6574 2827 6c7a 315f 2729 2c20 272d 6227  et('lz1_'), '-b'
+00014020: 2c20 6c69 6e65 7769 6474 683d 322c 206c  , linewidth=2, l
+00014030: 6162 656c 3d27 5065 616b 3127 290a 2020  abel='Peak1').  
+00014040: 2020 2020 2020 2020 2020 6178 322e 706c            ax2.pl
+00014050: 6f74 2878 6461 742c 2079 6461 742c 2027  ot(xdat, ydat, '
+00014060: 2e6b 2729 0a0a 0a20 2020 2020 2020 2023  .k')...        #
+00014070: 6178 322e 706c 6f74 2878 6461 742c 2072  ax2.plot(xdat, r
+00014080: 6573 756c 742e 6265 7374 5f66 6974 2c20  esult.best_fit, 
+00014090: 272d 6727 2c20 6c61 6265 6c3d 2762 6573  '-g', label='bes
+000140a0: 7420 6669 7427 290a 0a20 2020 2020 2020  t fit')..       
+000140b0: 2020 2020 2066 6974 7370 616e 3d6d 6178       fitspan=max
+000140c0: 2879 5f62 6573 745f 6669 7429 2d6d 696e  (y_best_fit)-min
+000140d0: 2879 5f62 6573 745f 6669 7429 0a20 2020  (y_best_fit).   
+000140e0: 2020 2020 2020 2020 2061 7832 2e73 6574           ax2.set
+000140f0: 5f79 6c69 6d28 5b6d 696e 2879 5f62 6573  _ylim([min(y_bes
+00014100: 745f 6669 7429 2d66 6974 7370 616e 2f35  t_fit)-fitspan/5
+00014110: 2c20 6d61 7828 795f 6265 7374 5f66 6974  , max(y_best_fit
+00014120: 292b 6669 7473 7061 6e2f 355d 290a 0a0a  )+fitspan/5])...
+00014130: 2020 2020 2020 2020 2020 2020 6178 312e              ax1.
+00014140: 7365 745f 796c 6162 656c 2827 496e 7465  set_ylabel('Inte
+00014150: 6e73 6974 7927 290a 2020 2020 2020 2020  nsity').        
+00014160: 2020 2020 6178 312e 7365 745f 786c 6162      ax1.set_xlab
+00014170: 656c 2827 5761 7665 6e75 6d62 6572 2729  el('Wavenumber')
+00014180: 0a20 2020 2020 2020 2020 2020 2061 7832  .            ax2
+00014190: 2e73 6574 5f79 6c61 6265 6c28 2749 6e74  .set_ylabel('Int
+000141a0: 656e 7369 7479 2729 0a20 2020 2020 2020  ensity').       
+000141b0: 2020 2020 2061 7832 2e73 6574 5f78 6c61       ax2.set_xla
+000141c0: 6265 6c28 2757 6176 656e 756d 6265 7227  bel('Wavenumber'
+000141d0: 290a 0a0a 2020 2020 2020 2020 2020 2020  )...            
+000141e0: 6966 2066 6974 5f70 6561 6b73 3e31 3a0a  if fit_peaks>1:.
+000141f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014200: 6178 322e 706c 6f74 2878 5f6c 696e 2c20  ax2.plot(x_lin, 
+00014210: 636f 6d70 6f6e 656e 7473 2e67 6574 2827  components.get('
+00014220: 6c7a 325f 2729 2c20 272d 7227 2c20 6c69  lz2_'), '-r', li
+00014230: 6e65 7769 6474 683d 322c 206c 6162 656c  newidth=2, label
+00014240: 3d27 5065 616b 3227 290a 0a20 2020 2020  ='Peak2')..     
+00014250: 2020 2020 2020 2069 6620 6669 745f 7065         if fit_pe
+00014260: 616b 733e 323a 0a20 2020 2020 2020 2020  aks>2:.         
+00014270: 2020 2020 2020 2061 7832 2e70 6c6f 7428         ax2.plot(
+00014280: 785f 6c69 6e2c 2063 6f6d 706f 6e65 6e74  x_lin, component
+00014290: 732e 6765 7428 276c 7a33 5f27 292c 2027  s.get('lz3_'), '
+000142a0: 2d6d 272c 206c 696e 6577 6964 7468 3d32  -m', linewidth=2
+000142b0: 2c20 6c61 6265 6c3d 2750 6561 6b33 2729  , label='Peak3')
+000142c0: 0a0a 0a20 2020 2020 2020 2020 2020 2061  ...            a
+000142d0: 7832 2e6c 6567 656e 6428 290a 0a20 2020  x2.legend()..   
+000142e0: 2020 2020 2020 2020 2070 6174 6833 3d70           path3=p
+000142f0: 6174 682b 272f 272b 2764 6961 645f 6669  ath+'/'+'diad_fi
+00014300: 745f 696d 6167 6573 270a 2020 2020 2020  t_images'.      
+00014310: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+00014320: 2e65 7869 7374 7328 7061 7468 3329 3a0a  .exists(path3):.
+00014330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014340: 6f75 743d 2770 6174 6820 6578 6973 7473  out='path exists
+00014350: 270a 2020 2020 2020 2020 2020 2020 656c  '.            el
+00014360: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00014370: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
+00014380: 7061 7468 2b27 2f27 2b20 2764 6961 645f  path+'/'+ 'diad_
+00014390: 6669 745f 696d 6167 6573 272c 2065 7869  fit_images', exi
+000143a0: 7374 5f6f 6b3d 4661 6c73 6529 0a0a 0a20  st_ok=False)... 
+000143b0: 2020 2020 2020 2020 2020 2066 696c 653d             file=
+000143c0: 6669 6c65 6e61 6d65 2e72 7370 6c69 7428  filename.rsplit(
+000143d0: 272e 7478 7427 2c20 3129 5b30 5d0a 2020  '.txt', 1)[0].  
+000143e0: 2020 2020 2020 2020 2020 6669 672e 7361            fig.sa
+000143f0: 7665 6669 6728 7061 7468 332b 272f 272b  vefig(path3+'/'+
+00014400: 2744 6961 6432 5f46 6974 5f7b 7d2e 706e  'Diad2_Fit_{}.pn
+00014410: 6727 2e66 6f72 6d61 7428 6669 6c65 292c  g'.format(file),
+00014420: 2064 7069 3d64 7069 290a 0a0a 0a0a 2020   dpi=dpi).....  
+00014430: 2020 2020 2020 6265 7374 5f66 6974 3d72        best_fit=r
+00014440: 6573 756c 742e 6265 7374 5f66 6974 0a0a  esult.best_fit..
+00014450: 2020 2020 2020 2020 6466 5f6f 7574 5b27          df_out['
+00014460: 4469 6164 325f 7265 6669 7427 5d3d 7265  Diad2_refit']=re
+00014470: 6669 745f 7061 7261 6d0a 0a20 2020 2069  fit_param..    i
+00014480: 6620 6469 6164 3120 6973 2054 7275 653a  f diad1 is True:
+00014490: 0a0a 0a0a 2020 2020 2020 2020 6966 2066  ....        if f
+000144a0: 6974 5f70 6561 6b73 3d3d 313a 0a20 2020  it_peaks==1:.   
+000144b0: 2020 2020 2020 2020 2050 6561 6b32 5f43           Peak2_C
+000144c0: 656e 743d 4e6f 6e65 0a20 2020 2020 2020  ent=None.       
+000144d0: 2020 2020 2050 6561 6b33 5f43 656e 743d       Peak3_Cent=
+000144e0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+000144f0: 2061 7831 5f78 6c69 6d3d 5b43 656e 7465   ax1_xlim=[Cente
+00014500: 725f 696e 692d 3135 2c20 4365 6e74 6572  r_ini-15, Center
+00014510: 5f69 6e69 2b31 355d 0a20 2020 2020 2020  _ini+15].       
+00014520: 2020 2020 2061 7832 5f78 6c69 6d3d 5b43       ax2_xlim=[C
+00014530: 656e 7465 725f 696e 692d 3135 2c20 4365  enter_ini-15, Ce
+00014540: 6e74 6572 5f69 6e69 2b31 355d 0a20 2020  nter_ini+15].   
+00014550: 2020 2020 2069 6620 6669 745f 7065 616b       if fit_peak
+00014560: 733d 3d32 3a0a 2020 2020 2020 2020 2020  s==2:.          
+00014570: 2020 5065 616b 325f 4365 6e74 3d72 6573    Peak2_Cent=res
+00014580: 756c 742e 6265 7374 5f76 616c 7565 732e  ult.best_values.
+00014590: 6765 7428 276c 7a32 5f63 656e 7465 7227  get('lz2_center'
+000145a0: 290a 2020 2020 2020 2020 2020 2020 5065  ).            Pe
+000145b0: 616b 325f 496e 743d 7265 7375 6c74 2e62  ak2_Int=result.b
+000145c0: 6573 745f 7661 6c75 6573 2e67 6574 2827  est_values.get('
+000145d0: 6c7a 325f 616d 706c 6974 7564 6527 290a  lz2_amplitude').
+000145e0: 2020 2020 2020 2020 2020 2020 5065 616b              Peak
+000145f0: 325f 5369 676d 613d 7265 7375 6c74 2e62  2_Sigma=result.b
+00014600: 6573 745f 7661 6c75 6573 2e67 6574 2827  est_values.get('
+00014610: 6c7a 325f 7369 676d 6127 290a 2020 2020  lz2_sigma').    
+00014620: 2020 2020 2020 2020 2320 2320 4368 6563          # # Chec
+00014630: 6b69 6e67 2070 6172 616d 6574 6572 7320  king parameters 
+00014640: 666f 7220 686f 7420 6261 6e64 730a 2020  for hot bands.  
+00014650: 2020 2020 2020 2020 2020 2320 6966 2050            # if P
+00014660: 6561 6b32 5f53 6967 6d61 3e28 7369 676d  eak2_Sigma>(sigm
+00014670: 615f 696e 692a 352d 302e 3129 3a0a 2020  a_ini*5-0.1):.  
+00014680: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+00014690: 7265 6669 745f 7061 7261 6d3d 7374 7228  refit_param=str(
+000146a0: 7265 6669 745f 7061 7261 6d29 2b27 2048  refit_param)+' H
+000146b0: 4231 5f48 6967 6853 6967 6d61 270a 2020  B1_HighSigma'.  
+000146c0: 2020 2020 2020 2020 2020 2320 6966 2050            # if P
+000146d0: 6561 6b32 5f53 6967 6d61 3c3d 2873 6967  eak2_Sigma<=(sig
+000146e0: 6d61 5f69 6e69 2f32 302b 302e 3129 3a0a  ma_ini/20+0.1):.
+000146f0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00014700: 2020 7265 6669 745f 7061 7261 6d3d 7374    refit_param=st
+00014710: 7228 7265 6669 745f 7061 7261 6d29 2b27  r(refit_param)+'
+00014720: 2048 4231 5f4c 6f77 5369 676d 6127 0a20   HB1_LowSigma'. 
+00014730: 2020 2020 2020 2020 2020 2023 0a20 2020             #.   
+00014740: 2020 2020 2020 2020 2023 2069 6620 5065           # if Pe
+00014750: 616b 325f 496e 743e 2841 6d70 6c69 7475  ak2_Int>(Amplitu
+00014760: 6465 5f69 6e69 2f35 2d30 2e30 3031 293a  de_ini/5-0.001):
+00014770: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+00014780: 2020 2072 6566 6974 5f70 6172 616d 3d73     refit_param=s
+00014790: 7472 2872 6566 6974 5f70 6172 616d 292b  tr(refit_param)+
+000147a0: 2720 4842 315f 4869 6768 416d 7027 0a20  ' HB1_HighAmp'. 
+000147b0: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
+000147c0: 5065 616b 325f 496e 743c 3d28 416d 706c  Peak2_Int<=(Ampl
+000147d0: 6974 7564 655f 696e 692f 3130 302b 302e  itude_ini/100+0.
+000147e0: 3030 3129 3a0a 2020 2020 2020 2020 2020  001):.          
+000147f0: 2020 2320 2020 2020 7265 6669 745f 7061    #     refit_pa
+00014800: 7261 6d3d 7374 7228 7265 6669 745f 7061  ram=str(refit_pa
+00014810: 7261 6d29 2b27 2048 4231 5f4c 6f77 416d  ram)+' HB1_LowAm
+00014820: 7027 0a0a 0a20 2020 2020 2020 2020 2020  p'...           
+00014830: 2050 6561 6b33 5f43 656e 743d 4e6f 6e65   Peak3_Cent=None
+00014840: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
+00014850: 5f78 6c69 6d3d 5b43 656e 7465 725f 696e  _xlim=[Center_in
+00014860: 692d 3330 2c20 4365 6e74 6572 5f69 6e69  i-30, Center_ini
+00014870: 2b31 355d 0a20 2020 2020 2020 2020 2020  +15].           
+00014880: 2061 7832 5f78 6c69 6d3d 5b43 656e 7465   ax2_xlim=[Cente
+00014890: 725f 696e 692d 3330 2c20 4365 6e74 6572  r_ini-30, Center
+000148a0: 5f69 6e69 2b31 355d 0a0a 0a0a 2020 2020  _ini+15]....    
+000148b0: 2020 2020 6966 2050 6561 6b32 5f43 656e      if Peak2_Cen
+000148c0: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
+000148d0: 2020 2020 2020 2064 665f 6f75 743d 7064         df_out=pd
+000148e0: 2e44 6174 6146 7261 6d65 2864 6174 613d  .DataFrame(data=
+000148f0: 7b27 4469 6164 315f 566f 6967 745f 4365  {'Diad1_Voigt_Ce
+00014900: 6e74 273a 2050 6561 6b31 5f43 656e 742c  nt': Peak1_Cent,
+00014910: 0a20 2020 2020 2020 2020 2020 2027 4469  .            'Di
+00014920: 6164 315f 6365 6e74 5f65 7272 273a 2065  ad1_cent_err': e
+00014930: 7272 6f72 5f70 6b32 2c0a 2020 2020 2020  rror_pk2,.      
 00014940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014950: 2020 2744 6961 6431 5f56 6f69 6774 5f53    'Diad1_Voigt_S
-00014960: 6967 6d61 273a 2050 6561 6b31 5f53 6967  igma': Peak1_Sig
-00014970: 6d61 2c0a 2020 2020 2020 2020 2020 2020  ma,.            
+00014950: 2020 2020 2020 2020 2020 2020 2020 2744                'D
+00014960: 6961 6431 5f56 6f69 6774 5f41 7265 6127  iad1_Voigt_Area'
+00014970: 3a20 5065 616b 315f 496e 742c 0a20 2020  : Peak1_Int,.   
 00014980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014990: 2020 2020 2020 2020 2744 6961 6431 5f56          'Diad1_V
-000149a0: 6f69 6774 5f47 616d 6d61 273a 2050 6561  oigt_Gamma': Pea
-000149b0: 6b31 5f67 616d 6d61 2c0a 2020 2020 2020  k1_gamma,.      
-000149c0: 2020 2020 2020 7d2c 2069 6e64 6578 3d5b        }, index=[
-000149d0: 305d 290a 0a20 2020 2020 2020 2020 2020  0])..           
-000149e0: 2064 665f 6f75 745b 2748 4231 5f43 656e   df_out['HB1_Cen
-000149f0: 7427 5d3d 5065 616b 325f 4365 6e74 0a20  t']=Peak2_Cent. 
-00014a00: 2020 2020 2020 2020 2020 2064 665f 6f75             df_ou
-00014a10: 745b 2748 4231 5f41 7265 6127 5d3d 5065  t['HB1_Area']=Pe
-00014a20: 616b 325f 496e 740a 2020 2020 2020 2020  ak2_Int.        
-00014a30: 2020 2020 6466 5f6f 7574 5b27 4842 315f      df_out['HB1_
-00014a40: 5369 676d 6127 5d3d 5065 616b 325f 5369  Sigma']=Peak2_Si
-00014a50: 676d 610a 0a0a 2020 2020 2020 2020 7265  gma...        re
-00014a60: 7375 6c74 5f64 6961 6431 5f6f 7269 6778  sult_diad1_origx
-00014a70: 5f61 6c6c 3d72 6573 756c 742e 6576 616c  _all=result.eval
-00014a80: 2878 3d78 6461 7429 0a20 2020 2020 2020  (x=xdat).       
-00014a90: 2023 2054 7269 6d20 746f 2062 6520 696e   # Trim to be in
-00014aa0: 2072 616e 6765 0a20 2020 2020 2020 2023   range.        #
-00014ab0: 7072 696e 7428 7265 7375 6c74 5f64 6961  print(result_dia
-00014ac0: 6432 5f6f 7269 6778 5f61 6c6c 290a 2020  d2_origx_all).  
-00014ad0: 2020 2020 2020 7265 7375 6c74 5f64 6961        result_dia
-00014ae0: 6431 5f6f 7269 6778 3d72 6573 756c 745f  d1_origx=result_
-00014af0: 6469 6164 315f 6f72 6967 785f 616c 6c5b  diad1_origx_all[
-00014b00: 2878 6461 743e 7370 616e 5b30 5d29 2026  (xdat>span[0]) &
-00014b10: 2028 7864 6174 3c73 7061 6e5b 315d 295d   (xdat<span[1])]
-00014b20: 0a20 2020 2020 2020 2079 6461 745f 696e  .        ydat_in
-00014b30: 7261 6e67 653d 7964 6174 5b28 7864 6174  range=ydat[(xdat
-00014b40: 3e73 7061 6e5b 305d 2920 2620 2878 6461  >span[0]) & (xda
-00014b50: 743c 7370 616e 5b31 5d29 5d0a 2020 2020  t<span[1])].    
-00014b60: 2020 2020 7864 6174 5f69 6e72 616e 6765      xdat_inrange
-00014b70: 3d78 6461 745b 2878 6461 743e 7370 616e  =xdat[(xdat>span
-00014b80: 5b30 5d29 2026 2028 7864 6174 3c73 7061  [0]) & (xdat<spa
-00014b90: 6e5b 315d 295d 0a20 2020 2020 2020 2072  n[1])].        r
-00014ba0: 6573 6964 7561 6c5f 6469 6164 5f63 6f6f  esidual_diad_coo
-00014bb0: 7264 733d 7964 6174 5f69 6e72 616e 6765  rds=ydat_inrange
-00014bc0: 2d72 6573 756c 745f 6469 6164 315f 6f72  -result_diad1_or
-00014bd0: 6967 780a 0a0a 2020 2020 2020 2020 785f  igx...        x_
-00014be0: 6365 6e74 5f6c 696e 3d6e 702e 6c69 6e73  cent_lin=np.lins
-00014bf0: 7061 6365 2864 665f 6f75 745b 2744 6961  pace(df_out['Dia
-00014c00: 6431 5f56 6f69 6774 5f43 656e 7427 5d2d  d1_Voigt_Cent']-
-00014c10: 312c 2064 665f 6f75 745b 2744 6961 6431  1, df_out['Diad1
-00014c20: 5f56 6f69 6774 5f43 656e 7427 5d2b 312c  _Voigt_Cent']+1,
-00014c30: 2032 3030 3030 290a 2020 2020 2020 2020   20000).        
-00014c40: 795f 6365 6e74 5f62 6573 745f 6669 743d  y_cent_best_fit=
-00014c50: 7265 7375 6c74 2e65 7661 6c28 783d 785f  result.eval(x=x_
-00014c60: 6365 6e74 5f6c 696e 290a 2020 2020 2020  cent_lin).      
-00014c70: 2020 6469 6164 5f68 6569 6768 7420 3d20    diad_height = 
-00014c80: 6e70 2e6d 6178 2879 5f63 656e 745f 6265  np.max(y_cent_be
-00014c90: 7374 5f66 6974 290a 2020 2020 2020 2020  st_fit).        
-00014ca0: 6466 5f6f 7574 5b27 4469 6164 315f 436f  df_out['Diad1_Co
-00014cb0: 6d62 6f66 6974 5f48 6569 6768 7427 5d3d  mbofit_Height']=
-00014cc0: 2064 6961 645f 6865 6967 6874 0a20 2020   diad_height.   
-00014cd0: 2020 2020 2064 665f 6f75 742e 696e 7365       df_out.inse
-00014ce0: 7274 2830 2c20 2744 6961 6431 5f43 6f6d  rt(0, 'Diad1_Com
-00014cf0: 626f 6669 745f 4365 6e74 272c 206e 702e  bofit_Cent', np.
-00014d00: 6e61 6e6d 6561 6e28 785f 6365 6e74 5f6c  nanmean(x_cent_l
-00014d10: 696e 5b79 5f63 656e 745f 6265 7374 5f66  in[y_cent_best_f
-00014d20: 6974 3d3d 6469 6164 5f68 6569 6768 745d  it==diad_height]
-00014d30: 2929 0a0a 0a20 2020 2020 2020 2072 6573  ))...        res
-00014d40: 6964 7561 6c5f 6469 6164 313d 6e70 2e73  idual_diad1=np.s
-00014d50: 756d 2828 2879 6461 745f 696e 7261 6e67  um(((ydat_inrang
-00014d60: 652d 7265 7375 6c74 5f64 6961 6431 5f6f  e-result_diad1_o
-00014d70: 7269 6778 292a 2a32 292a 2a30 2e35 292f  rigx)**2)**0.5)/
-00014d80: 286c 656e 2879 6461 745f 696e 7261 6e67  (len(ydat_inrang
-00014d90: 6529 290a 2020 2020 2020 2020 6466 5f6f  e)).        df_o
-00014da0: 7574 5b27 4469 6164 315f 5265 7369 6475  ut['Diad1_Residu
-00014db0: 616c 275d 3d72 6573 6964 7561 6c5f 6469  al']=residual_di
-00014dc0: 6164 310a 2020 2020 2020 2020 6466 5f6f  ad1.        df_o
-00014dd0: 7574 5b27 4469 6164 315f 5072 6f70 5f4c  ut['Diad1_Prop_L
-00014de0: 6f72 275d 3d20 5065 616b 315f 5072 6f70  or']= Peak1_Prop
-00014df0: 5f4c 6f72 0a20 2020 2020 2020 2064 665f  _Lor.        df_
-00014e00: 6f75 745b 2744 6961 6431 5f66 7768 6d27  out['Diad1_fwhm'
-00014e10: 5d3d 5065 616b 315f 6677 686d 0a0a 2020  ]=Peak1_fwhm..  
-00014e20: 2020 2020 2020 6966 2063 6f6e 6669 6731        if config1
-00014e30: 2e66 6974 5f67 6175 7373 2069 7320 6e6f  .fit_gauss is no
-00014e40: 7420 4661 6c73 653a 0a20 2020 2020 2020  t False:.       
-00014e50: 2020 2020 2064 665f 6f75 745b 2744 6961       df_out['Dia
-00014e60: 6431 5f47 6175 7373 5f43 656e 7427 5d3d  d1_Gauss_Cent']=
-00014e70: 4761 7573 735f 6365 6e74 0a20 2020 2020  Gauss_cent.     
-00014e80: 2020 2020 2020 2064 665f 6f75 745b 2744         df_out['D
-00014e90: 6961 6431 5f47 6175 7373 5f41 7265 6127  iad1_Gauss_Area'
-00014ea0: 5d3d 4761 7573 735f 616d 700a 2020 2020  ]=Gauss_amp.    
-00014eb0: 2020 2020 2020 2020 6466 5f6f 7574 5b27          df_out['
-00014ec0: 4469 6164 315f 4761 7573 735f 5369 676d  Diad1_Gauss_Sigm
-00014ed0: 6127 5d3d 4761 7573 735f 7369 676d 610a  a']=Gauss_sigma.
-00014ee0: 0a0a 0a20 2020 2020 2020 2069 6620 706c  ...        if pl
-00014ef0: 6f74 5f66 6967 7572 6520 6973 2054 7275  ot_figure is Tru
-00014f00: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
-00014f10: 6669 672c 2028 6178 312c 2061 7832 2920  fig, (ax1, ax2) 
-00014f20: 3d20 706c 742e 7375 6270 6c6f 7473 2831  = plt.subplots(1
-00014f30: 2c20 322c 2066 6967 7369 7a65 3d28 3132  , 2, figsize=(12
-00014f40: 2c34 2929 0a20 2020 2020 2020 2020 2020  ,4)).           
-00014f50: 2061 7831 2e70 6c6f 7428 785f 6c69 6e2c   ax1.plot(x_lin,
-00014f60: 2079 5f62 6573 745f 6669 742c 2027 2d67   y_best_fit, '-g
-00014f70: 272c 206c 696e 6577 6964 7468 3d32 2c20  ', linewidth=2, 
-00014f80: 6c61 6265 6c3d 2762 6573 7420 6669 7427  label='best fit'
-00014f90: 290a 2020 2020 2020 2020 2020 2020 6178  ).            ax
-00014fa0: 312e 706c 6f74 2878 6461 742c 2079 6461  1.plot(xdat, yda
-00014fb0: 742c 2020 272e 6b27 2c20 6c61 6265 6c3d  t,  '.k', label=
-00014fc0: 2764 6174 6127 290a 2020 2020 2020 2020  'data').        
-00014fd0: 2020 2020 6178 312e 6c65 6765 6e64 2829      ax1.legend()
-00014fe0: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
-00014ff0: 2e73 6574 5f78 6c69 6d28 6178 315f 786c  .set_xlim(ax1_xl
-00015000: 696d 290a 2020 2020 2020 2020 2020 2020  im).            
-00015010: 6178 322e 7365 745f 786c 696d 2861 7832  ax2.set_xlim(ax2
-00015020: 5f78 6c69 6d29 0a0a 0a0a 0a0a 0a20 2020  _xlim).......   
-00015030: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
-00015040: 6967 312e 6669 745f 6761 7573 7320 6973  ig1.fit_gauss is
-00015050: 206e 6f74 2046 616c 7365 3a0a 2020 2020   not False:.    
-00015060: 2020 2020 2020 2020 2020 2020 6178 322e              ax2.
-00015070: 706c 6f74 2878 5f6c 696e 2c20 636f 6d70  plot(x_lin, comp
-00015080: 6f6e 656e 7473 2e67 6574 2827 626b 675f  onents.get('bkg_
-00015090: 2729 2c20 272e 6327 2c6c 696e 6577 6964  '), '.c',linewid
-000150a0: 7468 3d32 2c20 206c 6162 656c 3d27 4761  th=2,  label='Ga
-000150b0: 7573 7369 616e 2062 636b 2729 0a20 2020  ussian bck').   
-000150c0: 2020 2020 2020 2020 2061 7832 2e70 6c6f           ax2.plo
-000150d0: 7428 785f 6c69 6e2c 2063 6f6d 706f 6e65  t(x_lin, compone
-000150e0: 6e74 732e 6765 7428 276c 7a31 5f27 292c  nts.get('lz1_'),
-000150f0: 2027 2d62 272c 206c 696e 6577 6964 7468   '-b', linewidth
-00015100: 3d32 2c20 6c61 6265 6c3d 2750 6561 6b31  =2, label='Peak1
-00015110: 2729 0a20 2020 2020 2020 2020 2020 2061  ').            a
-00015120: 7832 2e70 6c6f 7428 7864 6174 2c20 7964  x2.plot(xdat, yd
-00015130: 6174 2c20 272e 6b27 290a 0a0a 2020 2020  at, '.k')...    
-00015140: 2020 2020 2361 7832 2e70 6c6f 7428 7864      #ax2.plot(xd
-00015150: 6174 2c20 7265 7375 6c74 2e62 6573 745f  at, result.best_
-00015160: 6669 742c 2027 2d67 272c 206c 6162 656c  fit, '-g', label
-00015170: 3d27 6265 7374 2066 6974 2729 0a0a 2020  ='best fit')..  
-00015180: 2020 2020 2020 2020 2020 6669 7473 7061            fitspa
-00015190: 6e3d 6d61 7828 795f 6265 7374 5f66 6974  n=max(y_best_fit
-000151a0: 292d 6d69 6e28 795f 6265 7374 5f66 6974  )-min(y_best_fit
-000151b0: 290a 2020 2020 2020 2020 2020 2020 6178  ).            ax
-000151c0: 322e 7365 745f 796c 696d 285b 6d69 6e28  2.set_ylim([min(
-000151d0: 795f 6265 7374 5f66 6974 292d 6669 7473  y_best_fit)-fits
-000151e0: 7061 6e2f 352c 206d 6178 2879 5f62 6573  pan/5, max(y_bes
-000151f0: 745f 6669 7429 2b66 6974 7370 616e 2f35  t_fit)+fitspan/5
-00015200: 5d29 0a0a 0a20 2020 2020 2020 2020 2020  ])...           
-00015210: 2061 7831 2e73 6574 5f79 6c61 6265 6c28   ax1.set_ylabel(
-00015220: 2749 6e74 656e 7369 7479 2729 0a20 2020  'Intensity').   
-00015230: 2020 2020 2020 2020 2061 7831 2e73 6574           ax1.set
-00015240: 5f78 6c61 6265 6c28 2757 6176 656e 756d  _xlabel('Wavenum
-00015250: 6265 7227 290a 2020 2020 2020 2020 2020  ber').          
-00015260: 2020 6178 322e 7365 745f 796c 6162 656c    ax2.set_ylabel
-00015270: 2827 496e 7465 6e73 6974 7927 290a 2020  ('Intensity').  
-00015280: 2020 2020 2020 2020 2020 6178 322e 7365            ax2.se
-00015290: 745f 786c 6162 656c 2827 5761 7665 6e75  t_xlabel('Wavenu
-000152a0: 6d62 6572 2729 0a0a 0a20 2020 2020 2020  mber')...       
-000152b0: 2020 2020 2069 6620 6669 745f 7065 616b       if fit_peak
-000152c0: 733e 313a 0a20 2020 2020 2020 2020 2020  s>1:.           
-000152d0: 2020 2020 2061 7832 2e70 6c6f 7428 785f       ax2.plot(x_
-000152e0: 6c69 6e2c 2063 6f6d 706f 6e65 6e74 732e  lin, components.
-000152f0: 6765 7428 276c 7a32 5f27 292c 2027 2d72  get('lz2_'), '-r
-00015300: 272c 206c 696e 6577 6964 7468 3d32 2c20  ', linewidth=2, 
-00015310: 6c61 6265 6c3d 2750 6561 6b32 2729 0a0a  label='Peak2')..
-00015320: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-00015330: 6974 5f70 6561 6b73 3e32 3a0a 2020 2020  it_peaks>2:.    
-00015340: 2020 2020 2020 2020 2020 2020 6178 322e              ax2.
-00015350: 706c 6f74 2878 5f6c 696e 2c20 636f 6d70  plot(x_lin, comp
-00015360: 6f6e 656e 7473 2e67 6574 2827 6c7a 335f  onents.get('lz3_
-00015370: 2729 2c20 272d 6d27 2c20 6c69 6e65 7769  '), '-m', linewi
-00015380: 6474 683d 322c 206c 6162 656c 3d27 5065  dth=2, label='Pe
-00015390: 616b 3327 290a 2020 2020 2020 2020 2020  ak3').          
-000153a0: 2020 2320 6966 206c 656e 2870 6561 6b5f    # if len(peak_
-000153b0: 706f 735f 766f 6967 7429 3e31 3a0a 2020  pos_voigt)>1:.  
-000153c0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-000153d0: 6c6f 7765 7270 6561 6b3d 6e70 2e6d 696e  lowerpeak=np.min
-000153e0: 285b 5065 616b 315f 4365 6e74 2c20 5065  ([Peak1_Cent, Pe
-000153f0: 616b 325f 4365 6e74 5d29 0a20 2020 2020  ak2_Cent]).     
-00015400: 2020 2020 2020 2023 2020 2020 2075 7070         #     upp
-00015410: 6572 7065 616b 3d6e 702e 6d61 7828 5b50  erpeak=np.max([P
-00015420: 6561 6b31 5f43 656e 742c 2050 6561 6b32  eak1_Cent, Peak2
-00015430: 5f43 656e 745d 290a 2020 2020 2020 2020  _Cent]).        
-00015440: 2020 2020 2320 2020 2020 6178 312e 7365      #     ax1.se
-00015450: 745f 786c 696d 285b 6c6f 7765 7270 6561  t_xlim([lowerpea
-00015460: 6b2d 3135 2c20 7570 7065 7270 6561 6b2b  k-15, upperpeak+
-00015470: 3135 5d29 0a20 2020 2020 2020 2020 2020  15]).           
-00015480: 2023 2069 6620 6c65 6e28 7065 616b 5f70   # if len(peak_p
-00015490: 6f73 5f76 6f69 6774 293e 313a 0a20 2020  os_voigt)>1:.   
-000154a0: 2020 2020 2020 2020 2023 2020 2020 2061           #     a
-000154b0: 7832 2e73 6574 5f78 6c69 6d28 5b6c 6f77  x2.set_xlim([low
-000154c0: 6572 7065 616b 2d32 302c 2075 7070 6572  erpeak-20, upper
-000154d0: 7065 616b 2b32 305d 290a 0a20 2020 2020  peak+20])..     
-000154e0: 2020 2020 2020 2061 7832 2e6c 6567 656e         ax2.legen
-000154f0: 6428 290a 0a20 2020 2020 2020 2020 2020  d()..           
-00015500: 2070 6174 6833 3d70 6174 682b 272f 272b   path3=path+'/'+
-00015510: 2764 6961 645f 6669 745f 696d 6167 6573  'diad_fit_images
-00015520: 270a 2020 2020 2020 2020 2020 2020 6966  '.            if
-00015530: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00015540: 7061 7468 3329 3a0a 2020 2020 2020 2020  path3):.        
-00015550: 2020 2020 2020 2020 6f75 743d 2770 6174          out='pat
-00015560: 6820 6578 6973 7473 270a 2020 2020 2020  h exists'.      
-00015570: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00015580: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
-00015590: 616b 6564 6972 7328 7061 7468 2b27 2f27  akedirs(path+'/'
-000155a0: 2b20 2764 6961 645f 6669 745f 696d 6167  + 'diad_fit_imag
-000155b0: 6573 272c 2065 7869 7374 5f6f 6b3d 4661  es', exist_ok=Fa
-000155c0: 6c73 6529 0a0a 0a20 2020 2020 2020 2020  lse)...         
-000155d0: 2020 2066 696c 653d 6669 6c65 6e61 6d65     file=filename
-000155e0: 2e72 7370 6c69 7428 272e 7478 7427 2c20  .rsplit('.txt', 
-000155f0: 3129 5b30 5d0a 2020 2020 2020 2020 2020  1)[0].          
-00015600: 2020 6669 672e 7361 7665 6669 6728 7061    fig.savefig(pa
-00015610: 7468 332b 272f 272b 2744 6961 6431 5f46  th3+'/'+'Diad1_F
-00015620: 6974 5f7b 7d2e 706e 6727 2e66 6f72 6d61  it_{}.png'.forma
-00015630: 7428 6669 6c65 292c 2064 7069 3d64 7069  t(file), dpi=dpi
-00015640: 290a 0a0a 0a0a 2020 2020 2020 2020 6265  ).....        be
-00015650: 7374 5f66 6974 3d72 6573 756c 742e 6265  st_fit=result.be
-00015660: 7374 5f66 6974 0a0a 2020 2020 2020 2020  st_fit..        
-00015670: 6466 5f6f 7574 5b27 4469 6164 315f 7265  df_out['Diad1_re
-00015680: 6669 7427 5d3d 7265 6669 745f 7061 7261  fit']=refit_para
-00015690: 6d0a 0a20 2020 2020 2020 2023 2046 696e  m..        # Fin
-000156a0: 616c 2063 6865 636b 202d 2074 6861 7420  al check - that 
-000156b0: 4761 7573 7369 616e 2069 736e 7420 616e  Gaussian isnt an
-000156c0: 7977 6865 7265 206e 6561 7220 7468 6520  ywhere near the 
-000156d0: 6865 6967 6874 206f 6620 7468 6520 6469  height of the di
-000156e0: 6164 0a0a 0a20 2020 2064 665f 6f75 743d  ad...    df_out=
-000156f0: 6466 5f6f 7574 2e66 696c 6c6e 6128 3029  df_out.fillna(0)
-00015700: 0a0a 2020 2020 7265 7475 726e 2072 6573  ..    return res
-00015710: 756c 742c 2064 665f 6f75 742c 2079 5f62  ult, df_out, y_b
-00015720: 6573 745f 6669 742c 2078 5f6c 696e 2c20  est_fit, x_lin, 
-00015730: 636f 6d70 6f6e 656e 7473 2c20 7864 6174  components, xdat
-00015740: 2c20 7964 6174 2c20 6178 315f 786c 696d  , ydat, ax1_xlim
-00015750: 2c20 6178 325f 786c 696d 2c20 7265 7369  , ax2_xlim, resi
-00015760: 6475 616c 5f64 6961 645f 636f 6f72 6473  dual_diad_coords
-00015770: 2c20 7964 6174 5f69 6e72 616e 6765 2c20  , ydat_inrange, 
-00015780: 2078 6461 745f 696e 7261 6e67 650a 0a0a   xdat_inrange...
-00015790: 0a64 6566 2066 6974 5f64 6961 645f 325f  .def fit_diad_2_
-000157a0: 775f 6263 6b28 2a2c 2063 6f6e 6669 6731  w_bck(*, config1
-000157b0: 3a20 6469 6164 325f 6669 745f 636f 6e66  : diad2_fit_conf
-000157c0: 6967 3d64 6961 6432 5f66 6974 5f63 6f6e  ig=diad2_fit_con
-000157d0: 6669 6728 292c 2063 6f6e 6669 6732 3a20  fig(), config2: 
-000157e0: 6469 6164 5f69 645f 636f 6e66 6967 3d64  diad_id_config=d
-000157f0: 6961 645f 6964 5f63 6f6e 6669 6728 292c  iad_id_config(),
-00015800: 0a20 2020 2070 6174 683d 4e6f 6e65 2c20  .    path=None, 
-00015810: 6669 6c65 6e61 6d65 3d4e 6f6e 652c 2070  filename=None, p
-00015820: 6561 6b5f 706f 735f 766f 6967 743d 4e6f  eak_pos_voigt=No
-00015830: 6e65 2c66 696c 6574 7970 653d 4e6f 6e65  ne,filetype=None
-00015840: 2c20 6469 6164 5f61 7272 6179 3d4e 6f6e  , diad_array=Non
-00015850: 652c 0a20 2020 2070 6c6f 745f 6669 6775  e,.    plot_figu
-00015860: 7265 3d54 7275 652c 2063 6c6f 7365 5f66  re=True, close_f
-00015870: 6967 7572 653d 4661 6c73 652c 2044 6961  igure=False, Dia
-00015880: 645f 706f 733d 4e6f 6e65 2c20 4842 5f70  d_pos=None, HB_p
-00015890: 6f73 3d4e 6f6e 652c 2043 3133 5f70 6f73  os=None, C13_pos
-000158a0: 3d4e 6f6e 6529 3a0a 2020 2020 2222 2220  =None):.    """ 
-000158b0: 5468 6973 2066 756e 6374 696f 6e20 6669  This function fi
-000158c0: 7473 2074 6865 2062 6163 6b67 726f 756e  ts the backgroun
-000158d0: 6420 2875 7369 6e67 2074 6865 2066 756e  d (using the fun
-000158e0: 6374 696f 6e20 7265 6d6f 7665 5f64 6961  ction remove_dia
-000158f0: 645f 6261 7365 6c69 6e65 2920 616e 6420  d_baseline) and 
-00015900: 7468 656e 0a20 2020 2066 6974 7320 7468  then.    fits th
-00015910: 6520 7065 616b 7320 7573 696e 6720 6669  e peaks using fi
-00015920: 745f 6761 7573 7369 616e 5f76 6f69 6774  t_gaussian_voigt
-00015930: 5f67 656e 6572 6963 5f64 6961 6428 290a  _generic_diad().
-00015940: 2020 2020 4974 2074 6865 6e20 6368 6563      It then chec
-00015950: 6b73 2069 6620 616e 7920 7061 7261 6d65  ks if any parame
-00015960: 7465 7273 2061 7265 2072 6967 6874 2061  ters are right a
-00015970: 7420 7468 6520 7065 726d 6974 7465 6420  t the permitted 
-00015980: 6564 6765 2028 6d65 616e 696e 6720 6669  edge (meaning fi
-00015990: 7474 696e 6720 6469 646e 7420 636f 6e76  tting didnt conv
-000159a0: 6572 6765 292c 0a20 2020 2061 6e64 2074  erge),.    and t
-000159b0: 7269 6573 2066 6974 7469 6e67 2069 6620  ries fitting if 
-000159c0: 736f 2e20 5468 656e 2069 7420 6d61 6b65  so. Then it make
-000159d0: 7320 6120 706c 6f74 0a20 2020 206f 6620  s a plot.    of 
-000159e0: 7468 6520 7661 7269 6f75 7320 7061 7274  the various part
-000159f0: 7320 6f66 2074 6865 2066 6974 7469 6e67  s of the fitting
-00015a00: 2070 726f 6365 6475 7265 2c20 616e 6420   procedure, and 
-00015a10: 7265 7475 726e 7320 6120 6461 7461 6672  returns a datafr
-00015a20: 616d 6520 6f66 2074 6865 2066 6974 2070  ame of the fit p
-00015a30: 6172 616d 6574 6572 732e 0a0a 0a20 2020  arameters....   
-00015a40: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00015a50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00015a60: 2d2d 0a0a 2020 2020 6469 6164 5f69 645f  --..    diad_id_
-00015a70: 636f 6e66 6967 2829 0a20 2020 2020 2020  config().       
-00015a80: 2044 6174 6163 6c61 7373 206f 6620 7061   Dataclass of pa
-00015a90: 7261 6d65 7465 7273 2075 7365 6420 746f  rameters used to
-00015aa0: 206c 6f6f 6b20 666f 7220 7065 616b 732e   look for peaks.
-00015ab0: 2055 7365 7320 616e 7920 6578 636c 7564   Uses any exclud
-00015ac0: 6564 2072 616e 6765 7320 6672 6f6d 2074  ed ranges from t
-00015ad0: 6869 732e 0a0a 2020 2020 6469 6164 325f  his...    diad2_
-00015ae0: 6669 745f 636f 6e66 6967 2829 0a20 2020  fit_config().   
-00015af0: 2020 2020 2044 6174 6163 6c61 7373 206f       Dataclass o
-00015b00: 6620 7061 7261 6d65 7465 7273 2075 7365  f parameters use
-00015b10: 6420 746f 2066 696e 6420 7065 616b 732e  d to find peaks.
-00015b20: 2055 7365 2068 656c 7020 6f6e 2074 6869   Use help on thi
-00015b30: 7320 6461 7461 636c 6173 7320 746f 2067  s dataclass to g
-00015b40: 6574 206f 7074 696f 6e73 2e0a 0a20 2020  et options...   
-00015b50: 2070 6174 683a 2073 7472 0a20 2020 2020   path: str.     
-00015b60: 2020 2046 6f6c 6465 7220 7573 6572 2077     Folder user w
-00015b70: 6973 6865 7320 746f 2072 6561 6420 6461  ishes to read da
-00015b80: 7461 2066 726f 6d0a 0a20 2020 2066 696c  ta from..    fil
-00015b90: 656e 616d 653a 2073 7472 0a20 2020 2020  ename: str.     
-00015ba0: 2020 2053 7065 6369 6669 6320 6e61 6d65     Specific name
-00015bb0: 206f 6620 6669 6c65 2062 6569 6e67 2075   of file being u
-00015bc0: 7365 642e 0a0a 2020 2020 6669 6c65 7479  sed...    filety
-00015bd0: 7065 3a20 7374 720a 2020 2020 2020 2020  pe: str.        
-00015be0: 4964 656e 7469 6669 6573 2074 7970 6520  Identifies type 
-00015bf0: 6f66 2066 696c 652e 2063 686f 6f73 6520  of file. choose 
-00015c00: 6672 6f6d 2027 5769 7465 635f 4153 4349  from 'Witec_ASCI
-00015c10: 4927 2c20 2768 6561 646c 6573 735f 7478  I', 'headless_tx
-00015c20: 7427 2c20 2768 6561 646c 6573 735f 6373  t', 'headless_cs
-00015c30: 7627 2c20 2768 6561 645f 6373 7627 2c20  v', 'head_csv', 
-00015c40: 2757 6974 6563 5f41 5343 4949 272c 0a20  'Witec_ASCII',. 
-00015c50: 2020 2020 2020 2027 484f 5249 4241 5f74         'HORIBA_t
-00015c60: 7874 272c 2027 5265 6e69 7368 6177 5f74  xt', 'Renishaw_t
-00015c70: 7874 270a 0a20 2020 2070 6c6f 745f 6669  xt'..    plot_fi
-00015c80: 6775 7265 3a20 626f 6f6c 0a20 2020 2020  gure: bool.     
-00015c90: 2020 2069 6620 5472 7565 2c20 7361 7665     if True, save
-00015ca0: 7320 6669 6775 7265 0a0a 2020 2020 636c  s figure..    cl
-00015cb0: 6f73 655f 6669 673a 2062 6f6f 6c0a 2020  ose_fig: bool.  
-00015cc0: 2020 2020 2020 6966 2054 7275 652c 2064        if True, d
-00015cd0: 6973 706c 6179 7320 6669 6775 7265 2069  isplays figure i
-00015ce0: 6e20 4e6f 7465 626f 6f6b 2e20 4966 2046  n Notebook. If F
-00015cf0: 616c 7365 2c20 636c 6f73 6573 2069 7420  alse, closes it 
-00015d00: 2879 6f75 2063 616e 2073 7469 6c6c 2066  (you can still f
-00015d10: 696e 6420 6974 2073 6176 6564 290a 0a20  ind it saved).. 
-00015d20: 2020 2044 6961 645f 706f 733a 2066 6c6f     Diad_pos: flo
-00015d30: 6174 0a20 2020 2020 2020 2045 7374 696d  at.        Estim
-00015d40: 6174 6520 6f66 2064 6961 6420 7065 616b  ate of diad peak
-00015d50: 2070 6f73 6974 696f 6e0a 0a20 2020 2048   position..    H
-00015d60: 425f 706f 733a 2066 6c6f 6174 0a20 2020  B_pos: float.   
-00015d70: 2020 2020 2045 7374 696d 6174 6520 6f66       Estimate of
-00015d80: 2048 4220 7065 616b 2070 6f73 6974 696f   HB peak positio
-00015d90: 6e0a 0a20 2020 2043 3133 5f70 6f73 3a20  n..    C13_pos: 
-00015da0: 666c 6f61 740a 2020 2020 2020 2020 4573  float.        Es
-00015db0: 7469 6d61 7465 206f 6620 4331 3320 7065  timate of C13 pe
-00015dc0: 616b 2070 6f73 6974 696f 6e0a 0a0a 2020  ak position...  
-00015dd0: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
-00015de0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2069  ----------.    i
-00015df0: 6620 7265 7475 726e 5f6f 7468 6572 5f70  f return_other_p
-00015e00: 6172 616d 7320 6973 2046 616c 7365 2028  arams is False (
-00015e10: 6465 6661 756c 7429 0a20 2020 2020 2020  default).       
-00015e20: 2072 6574 7572 6e73 2061 2064 6174 6166   returns a dataf
-00015e30: 7261 6d65 206f 6620 7065 616b 2070 6172  rame of peak par
-00015e40: 616d 6574 6572 730a 2020 2020 6966 2054  ameters.    if T
-00015e50: 7275 652c 2061 6c73 6f20 7265 7475 726e  rue, also return
-00015e60: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-00015e70: 6573 756c 743a 2066 6974 2070 6172 616d  esult: fit param
-00015e80: 6574 6572 730a 2020 2020 2020 2020 2020  eters.          
-00015e90: 2020 795f 6265 7374 5f66 6974 3a20 6265    y_best_fit: be
-00015ea0: 7374 2066 6974 2074 6f20 616c 6c20 6375  st fit to all cu
-00015eb0: 7276 6573 2069 6e20 790a 2020 2020 2020  rves in y.      
-00015ec0: 2020 2020 2020 785f 6c69 6e3a 206c 696e        x_lin: lin
-00015ed0: 7370 6163 6520 6f66 2062 6573 7420 6669  space of best fi
-00015ee0: 7420 636f 6f72 6469 6e61 7465 7320 696e  t coordinates in
-00015ef0: 2078 2e0a 0a0a 0a0a 0a20 2020 2022 2222   x.......    """
-00015f00: 0a20 2020 2069 6620 2743 5252 2720 696e  .    if 'CRR' in
-00015f10: 2066 696c 656e 616d 653a 0a20 2020 2020   filename:.     
-00015f20: 2020 2066 696c 6574 7970 653d 2768 6561     filetype='hea
-00015f30: 646c 6573 735f 7478 7427 0a0a 2020 2020  dless_txt'..    
-00015f40: 6d6f 6465 6c3d 636f 6e66 6967 312e 6d6f  model=config1.mo
-00015f50: 6465 6c5f 6e61 6d65 0a0a 2020 2020 6966  del_name..    if
-00015f60: 206d 6f64 656c 206e 6f74 2069 6e20 616c   model not in al
-00015f70: 6c6f 7765 645f 6d6f 6465 6c73 3a0a 2020  lowed_models:.  
-00015f80: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00015f90: 6545 7272 6f72 2866 2255 6e73 7570 706f  eError(f"Unsuppo
-00015fa0: 7274 6564 206d 6f64 656c 3a20 7b6d 6f64  rted model: {mod
-00015fb0: 656c 7d2e 2053 7570 706f 7274 6564 206d  el}. Supported m
-00015fc0: 6f64 656c 7320 6172 653a 207b 272c 2027  odels are: {', '
-00015fd0: 2e6a 6f69 6e28 616c 6c6f 7765 645f 6d6f  .join(allowed_mo
-00015fe0: 6465 6c73 297d 2229 0a0a 0a0a 2020 2020  dels)}")....    
-00015ff0: 2320 4368 6563 6b20 6e75 6d62 6572 206f  # Check number o
-00016000: 6620 7065 616b 7320 6d61 6b65 7320 7365  f peaks makes se
-00016010: 6e73 650a 2020 2020 6669 745f 7065 616b  nse.    fit_peak
-00016020: 733d 636f 6e66 6967 312e 6669 745f 7065  s=config1.fit_pe
-00016030: 616b 730a 2020 2020 6966 2064 6961 645f  aks.    if diad_
-00016040: 6172 7261 7920 6973 204e 6f6e 653a 0a20  array is None:. 
-00016050: 2020 2020 2020 2044 6961 645f 6466 3d67         Diad_df=g
-00016060: 6574 5f64 6174 6128 7061 7468 3d70 6174  et_data(path=pat
-00016070: 682c 2066 696c 656e 616d 653d 6669 6c65  h, filename=file
-00016080: 6e61 6d65 2c20 6669 6c65 7479 7065 3d66  name, filetype=f
-00016090: 696c 6574 7970 6529 0a20 2020 2020 2020  iletype).       
-000160a0: 2044 6961 643d 6e70 2e61 7272 6179 2844   Diad=np.array(D
-000160b0: 6961 645f 6466 290a 2020 2020 656c 7365  iad_df).    else
-000160c0: 3a0a 2020 2020 2020 2020 4469 6164 3d64  :.        Diad=d
-000160d0: 6961 645f 6172 7261 790a 0a0a 2020 2020  iad_array...    
-000160e0: 6966 2066 6974 5f70 6561 6b73 3d3d 323a  if fit_peaks==2:
-000160f0: 0a20 2020 2020 2020 2069 6620 6e70 2e69  .        if np.i
-00016100: 736e 616e 2848 425f 706f 7329 3d3d 5472  snan(HB_pos)==Tr
-00016110: 7565 206f 7220 636f 6e66 6967 312e 4842  ue or config1.HB
-00016120: 5f70 726f 6d3c 303a 0a20 2020 2020 2020  _prom<0:.       
-00016130: 2020 2020 2066 6974 5f70 6561 6b73 3d31       fit_peaks=1
-00016140: 0a20 2020 2020 2020 2020 2020 2066 6974  .            fit
-00016150: 5f67 6175 7373 3d46 616c 7365 0a0a 0a0a  _gauss=False....
-00016160: 2020 2020 6966 2066 6974 5f70 6561 6b73      if fit_peaks
-00016170: 3d3d 333a 0a20 2020 2020 2020 2023 2054  ==3:.        # T
-00016180: 6869 7320 7465 7374 7320 6966 2048 4220  his tests if HB 
-00016190: 6973 204e 616e 2061 6e64 2043 3133 2069  is Nan and C13 i
-000161a0: 7320 4e61 6e0a 2020 2020 2020 2020 6966  s Nan.        if
-000161b0: 206e 702e 6973 6e61 6e28 4842 5f70 6f73   np.isnan(HB_pos
-000161c0: 293d 3d54 7275 6520 616e 6420 6e70 2e69  )==True and np.i
-000161d0: 736e 616e 2843 3133 5f70 6f73 293d 3d54  snan(C13_pos)==T
-000161e0: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
-000161f0: 2066 6974 5f70 6561 6b73 3d31 0a20 2020   fit_peaks=1.   
-00016200: 2020 2020 2020 2020 2066 6974 5f67 6175           fit_gau
-00016210: 7373 3d46 616c 7365 0a20 2020 2020 2020  ss=False.       
-00016220: 2023 2049 6620 6f6e 6c79 2048 4220 6973   # If only HB is
-00016230: 204e 616e 2c20 6c65 7473 2069 6e73 7465   Nan, lets inste
-00016240: 6164 2061 6c6c 6f63 6174 6520 6120 4842  ad allocate a HB
-00016250: 2070 6f73 6974 6f69 6e2e 0a20 2020 2020   positoin..     
-00016260: 2020 2065 6c69 6620 6e70 2e69 736e 616e     elif np.isnan
-00016270: 2848 425f 706f 7329 3a0a 2020 2020 2020  (HB_pos):.      
-00016280: 2020 2020 2020 4842 5f72 6567 696f 6e3d        HB_region=
-00016290: 5b44 6961 645f 706f 732b 3139 2c20 4469  [Diad_pos+19, Di
-000162a0: 6164 5f70 6f73 2b32 335d 0a20 2020 2020  ad_pos+23].     
-000162b0: 2020 2020 2020 2066 696c 7465 723d 2844         filter=(D
-000162c0: 6961 645b 3a2c 2030 5d3e 3d48 425f 7265  iad[:, 0]>=HB_re
-000162d0: 6769 6f6e 5b30 5d29 2620 2844 6961 645b  gion[0])& (Diad[
-000162e0: 3a2c 305d 3c3d 4842 5f72 6567 696f 6e5b  :,0]<=HB_region[
-000162f0: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
-00016300: 5472 696d 4469 6164 3d44 6961 645b 6669  TrimDiad=Diad[fi
-00016310: 6c74 6572 5d0a 2020 2020 2020 2020 2020  lter].          
-00016320: 2020 6669 6c74 6572 323d 2844 6961 645b    filter2=(Diad[
-00016330: 3a2c 2030 5d3e 3d28 4842 5f72 6567 696f  :, 0]>=(HB_regio
-00016340: 6e5b 305d 2d35 2929 2620 2844 6961 645b  n[0]-5))& (Diad[
-00016350: 3a2c 305d 3c3d 2848 425f 7265 6769 6f6e  :,0]<=(HB_region
-00016360: 5b31 5d2b 3529 290a 2020 2020 2020 2020  [1]+5)).        
-00016370: 2020 2020 5472 696d 4469 6164 323d 4469      TrimDiad2=Di
-00016380: 6164 5b66 696c 7465 7232 5d0a 2020 2020  ad[filter2].    
-00016390: 2020 2020 2020 2020 6d61 7879 3d6e 702e          maxy=np.
-000163a0: 6d61 7828 5472 696d 4469 6164 5b3a 2c20  max(TrimDiad[:, 
-000163b0: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
-000163c0: 6d61 7878 3d54 7269 6d44 6961 645b 5472  maxx=TrimDiad[Tr
-000163d0: 696d 4469 6164 5b3a 2c20 315d 3d3d 6d61  imDiad[:, 1]==ma
-000163e0: 7879 5d0a 2020 2020 2020 2020 2020 2020  xy].            
-000163f0: 4842 5f70 6f73 3d66 6c6f 6174 286d 6178  HB_pos=float(max
-00016400: 785b 3a2c 2030 5d5b 305d 290a 2020 2020  x[:, 0][0]).    
-00016410: 2020 2020 2020 2020 6d69 6e79 3d6e 702e          miny=np.
-00016420: 6d69 6e28 5472 696d 4469 6164 325b 3a2c  min(TrimDiad2[:,
-00016430: 2031 5d29 0a20 2020 2020 2020 2020 2020   1]).           
-00016440: 2063 6f6e 6669 6731 2e48 425f 7072 6f6d   config1.HB_prom
-00016450: 3d6d 6178 792d 6d69 6e79 0a20 2020 2020  =maxy-miny.     
-00016460: 2020 2020 2020 2063 6f6e 6669 6731 2e67         config1.g
-00016470: 6175 7373 5f61 6d70 3d32 2a28 6d61 7879  auss_amp=2*(maxy
-00016480: 2d6d 696e 7929 0a0a 0a0a 0a20 2020 2020  -miny).....     
-00016490: 2020 2023 2049 6620 6e6f 2043 3133 2c20     # If no C13, 
-000164a0: 7265 6475 6365 2066 6974 2070 6561 6b73  reduce fit peaks
-000164b0: 2074 6f20 322e 0a20 2020 2020 2020 2065   to 2..        e
-000164c0: 6c69 6620 6e70 2e69 736e 616e 2843 3133  lif np.isnan(C13
-000164d0: 5f70 6f73 293d 3d54 7275 6520 6f72 2063  _pos)==True or c
-000164e0: 6f6e 6669 6731 2e43 3133 5f70 726f 6d3c  onfig1.C13_prom<
-000164f0: 3130 3a0a 2020 2020 2020 2020 2020 2020  10:.            
-00016500: 6669 745f 7065 616b 733d 320a 0a0a 0a20  fit_peaks=2.... 
-00016510: 2020 2023 2046 6972 7374 2c20 7765 2066     # First, we f
-00016520: 6565 6420 6461 7461 2069 6e74 6f20 7468  eed data into th
-00016530: 6520 7265 6d6f 7665 2062 6173 656c 696e  e remove baselin
-00016540: 6520 6675 6e63 7469 6f6e 2c20 7768 6963  e function, whic
-00016550: 6820 7265 7475 726e 7320 636f 7272 6563  h returns correc
-00016560: 7465 6420 6461 7461 0a0a 2020 2020 795f  ted data..    y_
-00016570: 636f 7272 5f64 6961 6432 2c20 5079 5f62  corr_diad2, Py_b
-00016580: 6173 655f 6469 6164 322c 2078 5f64 6961  ase_diad2, x_dia
-00016590: 6432 2c20 2044 6961 645f 7368 6f72 745f  d2,  Diad_short_
-000165a0: 6469 6164 322c 2050 795f 6261 7365 5f64  diad2, Py_base_d
-000165b0: 6961 6432 2c20 5066 5f62 6173 656c 696e  iad2, Pf_baselin
-000165c0: 655f 6469 6164 322c 2020 4261 7365 6c69  e_diad2,  Baseli
-000165d0: 6e65 5f79 7375 625f 6469 6164 322c 2042  ne_ysub_diad2, B
-000165e0: 6173 656c 696e 655f 785f 6469 6164 322c  aseline_x_diad2,
-000165f0: 2042 6173 656c 696e 655f 6469 6164 322c   Baseline_diad2,
-00016600: 2073 7061 6e5f 6469 6164 323d 7265 6d6f   span_diad2=remo
-00016610: 7665 5f64 6961 645f 6261 7365 6c69 6e65  ve_diad_baseline
-00016620: 280a 2020 2070 6174 683d 7061 7468 2c20  (.   path=path, 
-00016630: 6669 6c65 6e61 6d65 3d66 696c 656e 616d  filename=filenam
-00016640: 652c 2066 696c 6574 7970 653d 6669 6c65  e, filetype=file
-00016650: 7479 7065 2c20 6578 636c 7564 655f 7261  type, exclude_ra
-00016660: 6e67 6531 3d63 6f6e 6669 6732 2e65 7863  nge1=config2.exc
-00016670: 6c75 6465 5f72 616e 6765 312c 2065 7863  lude_range1, exc
-00016680: 6c75 6465 5f72 616e 6765 323d 636f 6e66  lude_range2=conf
-00016690: 6967 322e 6578 636c 7564 655f 7261 6e67  ig2.exclude_rang
-000166a0: 6532 2c20 4e5f 706f 6c79 3d63 6f6e 6669  e2, N_poly=confi
-000166b0: 6731 2e4e 5f70 6f6c 795f 6263 6b5f 6469  g1.N_poly_bck_di
-000166c0: 6164 322c 0a20 2020 206c 6f77 6572 5f62  ad2,.    lower_b
-000166d0: 636b 3d63 6f6e 6669 6731 2e6c 6f77 6572  ck=config1.lower
-000166e0: 5f62 636b 5f64 6961 6432 2c20 7570 7065  _bck_diad2, uppe
-000166f0: 725f 6263 6b3d 636f 6e66 6967 312e 7570  r_bck=config1.up
-00016700: 7065 725f 6263 6b5f 6469 6164 322c 2070  per_bck_diad2, p
-00016710: 6c6f 745f 6669 6775 7265 3d46 616c 7365  lot_figure=False
-00016720: 2c20 6469 6164 5f61 7272 6179 3d64 6961  , diad_array=dia
-00016730: 645f 6172 7261 7929 0a0a 0a0a 0a0a 2020  d_array)......  
-00016740: 2020 2320 5468 656e 2c20 7765 2066 6565    # Then, we fee
-00016750: 6420 7468 6973 2062 6173 656c 696e 652d  d this baseline-
-00016760: 636f 7272 6563 7465 6420 6461 7461 2069  corrected data i
-00016770: 6e74 6f20 7468 6520 636f 6d62 696e 6564  nto the combined
-00016780: 2067 6175 7373 6961 6e2d 766f 6967 7420   gaussian-voigt 
-00016790: 7065 616b 2066 6974 7469 6e67 2066 756e  peak fitting fun
-000167a0: 6374 696f 6e0a 2020 2020 7265 7375 6c74  ction.    result
-000167b0: 2c20 6466 5f6f 7574 2c20 795f 6265 7374  , df_out, y_best
-000167c0: 5f66 6974 2c20 785f 6c69 6e2c 2063 6f6d  _fit, x_lin, com
-000167d0: 706f 6e65 6e74 732c 2078 6461 742c 2079  ponents, xdat, y
-000167e0: 6461 742c 2061 7831 5f78 6c69 6d2c 2061  dat, ax1_xlim, a
-000167f0: 7832 5f78 6c69 6d2c 7265 7369 6475 616c  x2_xlim,residual
-00016800: 5f64 6961 645f 636f 6f72 6473 2c20 7964  _diad_coords, yd
-00016810: 6174 5f69 6e72 616e 6765 2c20 2078 6461  at_inrange,  xda
-00016820: 745f 696e 7261 6e67 653d 6669 745f 6761  t_inrange=fit_ga
-00016830: 7573 7369 616e 5f76 6f69 6774 5f67 656e  ussian_voigt_gen
-00016840: 6572 6963 5f64 6961 6428 636f 6e66 6967  eric_diad(config
-00016850: 312c 2064 6961 6432 3d54 7275 652c 2070  1, diad2=True, p
-00016860: 6174 683d 7061 7468 2c20 6669 6c65 6e61  ath=path, filena
-00016870: 6d65 3d66 696c 656e 616d 652c 0a20 2020  me=filename,.   
-00016880: 2078 6461 743d 785f 6469 6164 322c 2079   xdat=x_diad2, y
-00016890: 6461 743d 795f 636f 7272 5f64 6961 6432  dat=y_corr_diad2
-000168a0: 2c0a 2020 2020 7370 616e 3d73 7061 6e5f  ,.    span=span_
-000168b0: 6469 6164 322c 2070 6c6f 745f 6669 6775  diad2, plot_figu
-000168c0: 7265 3d46 616c 7365 2c20 4469 6164 5f70  re=False, Diad_p
-000168d0: 6f73 3d44 6961 645f 706f 732c 2048 425f  os=Diad_pos, HB_
-000168e0: 706f 733d 4842 5f70 6f73 2c20 4331 335f  pos=HB_pos, C13_
-000168f0: 706f 733d 4331 335f 706f 732c 2066 6974  pos=C13_pos, fit
-00016900: 5f70 6561 6b73 3d66 6974 5f70 6561 6b73  _peaks=fit_peaks
-00016910: 290a 0a20 2020 2069 6620 616e 7928 6466  )..    if any(df
-00016920: 5f6f 7574 5b27 4469 6164 325f 7265 6669  _out['Diad2_refi
-00016930: 7427 5d2e 7374 722e 636f 6e74 6169 6e73  t'].str.contains
-00016940: 2827 4265 6c6f 7720 7468 7265 7368 6f6c  ('Below threshol
-00016950: 6420 696e 7465 6e73 6974 7927 2929 3a0a  d intensity')):.
-00016960: 2020 2020 2020 2020 7072 696e 7428 2762          print('b
-00016970: 656c 6f77 2079 6f75 7220 7468 7265 7368  elow your thresh
-00016980: 6f6c 6420 696e 7465 6e73 6974 792c 2077  old intensity, w
-00016990: 6520 6861 7665 2066 696c 6c65 6420 7769  e have filled wi
-000169a0: 7468 206e 616e 7327 290a 0a0a 2020 2020  th nans')...    
-000169b0: 656c 7365 3a0a 0a20 2020 2020 2020 2023  else:..        #
-000169c0: 2054 7279 2052 6566 6974 7469 6e67 206f   Try Refitting o
-000169d0: 6e63 650a 2020 2020 2020 2020 6966 2073  nce.        if s
-000169e0: 7472 2864 665f 6f75 745b 2744 6961 6432  tr(df_out['Diad2
-000169f0: 5f72 6566 6974 275d 2e69 6c6f 635b 305d  _refit'].iloc[0]
-00016a00: 2921 3d27 466c 6167 6765 6420 5761 726e  )!='Flagged Warn
-00016a10: 696e 6773 3a27 3a0a 2020 2020 2020 2020  ings:':.        
-00016a20: 2020 2020 7072 696e 7428 2772 6566 6974      print('refit
-00016a30: 2061 7474 656d 7074 2031 2729 0a20 2020   attempt 1').   
-00016a40: 2020 2020 2020 2020 2066 6163 746f 723d           factor=
-00016a50: 320a 0a20 2020 2020 2020 2020 2020 2069  2..            i
-00016a60: 6d70 6f72 7420 636f 7079 0a20 2020 2020  mport copy.     
-00016a70: 2020 2020 2020 2063 6f6e 6669 675f 7477         config_tw
-00016a80: 6561 6b65 643d 636f 6e66 6967 310a 2020  eaked=config1.  
-00016a90: 2020 2020 2020 2020 2020 636f 6e66 6967            config
-00016aa0: 5f74 7765 616b 6564 3d63 6f70 792e 636f  _tweaked=copy.co
-00016ab0: 7079 2863 6f6e 6669 6731 290a 0a20 2020  py(config1)..   
-00016ac0: 2020 2020 2020 2020 2069 6620 616e 7928           if any(
-00016ad0: 6466 5f6f 7574 5b27 4469 6164 325f 7265  df_out['Diad2_re
-00016ae0: 6669 7427 5d2e 7374 722e 636f 6e74 6169  fit'].str.contai
-00016af0: 6e73 2827 204e 6f20 4572 726f 7227 2929  ns(' No Error'))
-00016b00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016b10: 2020 6966 2066 6974 5f70 6561 6b73 3e31    if fit_peaks>1
-00016b20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016b30: 2020 2020 2020 6669 745f 7065 616b 733d        fit_peaks=
-00016b40: 6669 745f 7065 616b 732d 310a 0a0a 0a0a  fit_peaks-1.....
-00016b50: 2020 2020 2020 2020 2020 2020 2320 6966              # if
-00016b60: 2061 6e79 2864 665f 6f75 745b 2744 6961   any(df_out['Dia
-00016b70: 6432 5f72 6566 6974 275d 2e73 7472 2e63  d2_refit'].str.c
-00016b80: 6f6e 7461 696e 7328 2756 5f48 6967 6841  ontains('V_HighA
-00016b90: 6d70 2729 293a 0a20 2020 2020 2020 2020  mp')):.         
-00016ba0: 2020 2023 2020 2020 2063 6f6e 6669 675f     #     config_
-00016bb0: 7477 6561 6b65 642e 6469 6164 5f61 6d70  tweaked.diad_amp
-00016bc0: 6c69 7475 6465 3d63 616c 635f 6469 6164  litude=calc_diad
-00016bd0: 5f61 6d70 6c69 7475 6465 2f31 300a 2020  _amplitude/10.  
-00016be0: 2020 2020 2020 2020 2020 6966 2061 6e79            if any
-00016bf0: 2864 665f 6f75 745b 2744 6961 6432 5f72  (df_out['Diad2_r
-00016c00: 6566 6974 275d 2e73 7472 2e63 6f6e 7461  efit'].str.conta
-00016c10: 696e 7328 2756 5f53 6967 6d61 5f74 6f6f  ins('V_Sigma_too
-00016c20: 5f4c 6f77 2729 293a 0a20 2020 2020 2020  _Low')):.       
-00016c30: 2020 2020 2020 2020 2063 6f6e 6669 675f           config_
-00016c40: 7477 6561 6b65 642e 6469 6164 5f73 6967  tweaked.diad_sig
-00016c50: 6d61 3d63 6f6e 6669 6731 2e64 6961 645f  ma=config1.diad_
-00016c60: 7369 676d 612a 6661 6374 6f72 0a20 2020  sigma*factor.   
-00016c70: 2020 2020 2020 2020 2069 6620 616e 7928           if any(
-00016c80: 6466 5f6f 7574 5b27 4469 6164 325f 7265  df_out['Diad2_re
-00016c90: 6669 7427 5d2e 7374 722e 636f 6e74 6169  fit'].str.contai
-00016ca0: 6e73 2827 565f 5369 676d 615f 746f 6f5f  ns('V_Sigma_too_
-00016cb0: 4869 6768 2729 293a 0a20 2020 2020 2020  High')):.       
-00016cc0: 2020 2020 2020 2020 2063 6f6e 6669 675f           config_
-00016cd0: 7477 6561 6b65 642e 6469 6164 5f73 6967  tweaked.diad_sig
-00016ce0: 6d61 3d63 6f6e 6669 6731 2e64 6961 645f  ma=config1.diad_
-00016cf0: 7369 676d 612f 6661 6374 6f72 0a20 2020  sigma/factor.   
-00016d00: 2020 2020 2020 2020 2023 2047 6175 7373           # Gauss
-00016d10: 6961 6e20 6669 7420 6269 7473 0a20 2020  ian fit bits.   
-00016d20: 2020 2020 2020 2020 2069 6620 616e 7928           if any(
-00016d30: 6466 5f6f 7574 5b27 4469 6164 325f 7265  df_out['Diad2_re
-00016d40: 6669 7427 5d2e 7374 722e 636f 6e74 6169  fit'].str.contai
-00016d50: 6e73 2827 475f 696e 7075 745f 546f 6f48  ns('G_input_TooH
-00016d60: 6967 6853 6967 6d61 2729 293a 0a20 2020  ighSigma')):.   
-00016d70: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00016d80: 6669 675f 7477 6561 6b65 642e 6761 7573  fig_tweaked.gaus
-00016d90: 735f 7369 676d 613d 636f 6e66 6967 312e  s_sigma=config1.
-00016da0: 6761 7573 735f 7369 676d 612f 6661 6374  gauss_sigma/fact
-00016db0: 6f72 0a20 2020 2020 2020 2020 2020 2069  or.            i
-00016dc0: 6620 616e 7928 6466 5f6f 7574 5b27 4469  f any(df_out['Di
-00016dd0: 6164 325f 7265 6669 7427 5d2e 7374 722e  ad2_refit'].str.
-00016de0: 636f 6e74 6169 6e73 2827 475f 696e 7075  contains('G_inpu
-00016df0: 745f 546f 6f4c 6f77 5369 676d 6127 2929  t_TooLowSigma'))
-00016e00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016e10: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
-00016e20: 2e67 6175 7373 5f73 6967 6d61 3d63 6f6e  .gauss_sigma=con
-00016e30: 6669 6731 2e67 6175 7373 5f73 6967 6d61  fig1.gauss_sigma
-00016e40: 2a66 6163 746f 720a 2020 2020 2020 2020  *factor.        
-00016e50: 2020 2020 6966 2061 6e79 2864 665f 6f75      if any(df_ou
-00016e60: 745b 2744 6961 6432 5f72 6566 6974 275d  t['Diad2_refit']
-00016e70: 2e73 7472 2e63 6f6e 7461 696e 7328 2747  .str.contains('G
-00016e80: 5f69 6e70 7574 5f54 6f6f 4c6f 7741 6d70  _input_TooLowAmp
-00016e90: 2729 293a 0a20 2020 2020 2020 2020 2020  ')):.           
-00016ea0: 2020 2020 2063 6f6e 6669 675f 7477 6561       config_twea
-00016eb0: 6b65 642e 6761 7573 735f 616d 706c 6974  ked.gauss_amplit
-00016ec0: 7564 653d 636f 6e66 6967 312e 6761 7573  ude=config1.gaus
-00016ed0: 735f 616d 702a 6661 6374 6f72 0a20 2020  s_amp*factor.   
-00016ee0: 2020 2020 2020 2020 2069 6620 616e 7928           if any(
-00016ef0: 6466 5f6f 7574 5b27 4469 6164 325f 7265  df_out['Diad2_re
-00016f00: 6669 7427 5d2e 7374 722e 636f 6e74 6169  fit'].str.contai
-00016f10: 6e73 2827 475f 416d 705f 746f 6f5f 6869  ns('G_Amp_too_hi
-00016f20: 6768 2729 293a 0a20 2020 2020 2020 2020  gh')):.         
-00016f30: 2020 2020 2020 2063 6f6e 6669 675f 7477         config_tw
-00016f40: 6561 6b65 642e 6761 7573 735f 616d 706c  eaked.gauss_ampl
-00016f50: 6974 7564 653d 636f 6e66 6967 312e 6761  itude=config1.ga
-00016f60: 7573 735f 616d 702f 6661 6374 6f72 0a20  uss_amp/factor. 
-00016f70: 2020 2020 2020 2020 2020 2069 6620 616e             if an
-00016f80: 7928 6466 5f6f 7574 5b27 4469 6164 325f  y(df_out['Diad2_
-00016f90: 7265 6669 7427 5d2e 7374 722e 636f 6e74  refit'].str.cont
-00016fa0: 6169 6e73 2827 475f 6869 6768 6572 5f74  ains('G_higher_t
-00016fb0: 6861 6e5f 6469 6164 2729 293a 0a20 2020  han_diad')):.   
-00016fc0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00016fd0: 6669 675f 7477 6561 6b65 642e 6761 7573  fig_tweaked.gaus
-00016fe0: 735f 616d 706c 6974 7564 653d 636f 6e66  s_amplitude=conf
-00016ff0: 6967 312e 6761 7573 735f 616d 702f 6661  ig1.gauss_amp/fa
-00017000: 6374 6f72 0a20 2020 2020 2020 2020 2020  ctor.           
-00017010: 2020 2020 2023 636f 6e66 6967 5f74 7765       #config_twe
-00017020: 616b 6564 2e67 6175 7373 5f73 6967 6d61  aked.gauss_sigma
-00017030: 3d63 6f6e 6669 6731 2e67 6175 7373 5f73  =config1.gauss_s
-00017040: 6967 6d61 2a66 6163 746f 720a 2020 2020  igma*factor.    
-00017050: 2020 2020 2020 2020 2320 486f 7420 6261          # Hot ba
-00017060: 6e64 2066 6974 2062 6974 730a 2020 2020  nd fit bits.    
-00017070: 2020 2020 2020 2020 2320 6966 2061 6e79          # if any
-00017080: 2864 665f 6f75 745b 2744 6961 6432 5f72  (df_out['Diad2_r
-00017090: 6566 6974 275d 2e73 7472 2e63 6f6e 7461  efit'].str.conta
-000170a0: 696e 7328 2748 4232 5f4c 6f77 416d 7027  ins('HB2_LowAmp'
-000170b0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-000170c0: 2320 2020 2020 636f 6e66 6967 5f74 7765  #     config_twe
-000170d0: 616b 6564 2e48 425f 616d 706c 6974 7564  aked.HB_amplitud
-000170e0: 653d 6361 6c63 5f48 425f 616d 706c 6974  e=calc_HB_amplit
-000170f0: 7564 652f 320a 2020 2020 2020 2020 2020  ude/2.          
-00017100: 2020 2320 6966 2061 6e79 2864 665f 6f75    # if any(df_ou
-00017110: 745b 2744 6961 6432 5f72 6566 6974 275d  t['Diad2_refit']
-00017120: 2e73 7472 2e63 6f6e 7461 696e 7328 2748  .str.contains('H
-00017130: 4232 5f48 6967 6841 6d70 2729 293a 0a20  B2_HighAmp')):. 
-00017140: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00017150: 2063 6f6e 6669 675f 7477 6561 6b65 642e   config_tweaked.
-00017160: 4842 5f61 6d70 6c69 7475 6465 3d63 616c  HB_amplitude=cal
-00017170: 635f 4842 5f61 6d70 6c69 7475 6465 2a32  c_HB_amplitude*2
-00017180: 0a0a 0a20 2020 2020 2020 2020 2020 2072  ...            r
-00017190: 6573 756c 742c 2064 665f 6f75 742c 2079  esult, df_out, y
-000171a0: 5f62 6573 745f 6669 742c 2078 5f6c 696e  _best_fit, x_lin
-000171b0: 2c20 636f 6d70 6f6e 656e 7473 2c20 7864  , components, xd
-000171c0: 6174 2c20 7964 6174 2c20 6178 315f 786c  at, ydat, ax1_xl
-000171d0: 696d 2c20 6178 325f 786c 696d 2c72 6573  im, ax2_xlim,res
-000171e0: 6964 7561 6c5f 6469 6164 5f63 6f6f 7264  idual_diad_coord
-000171f0: 732c 2079 6461 745f 696e 7261 6e67 652c  s, ydat_inrange,
-00017200: 2020 7864 6174 5f69 6e72 616e 6765 3d66    xdat_inrange=f
-00017210: 6974 5f67 6175 7373 6961 6e5f 766f 6967  it_gaussian_voig
-00017220: 745f 6765 6e65 7269 635f 6469 6164 2863  t_generic_diad(c
-00017230: 6f6e 6669 675f 7477 6561 6b65 642c 2064  onfig_tweaked, d
-00017240: 6961 6432 3d54 7275 652c 2070 6174 683d  iad2=True, path=
-00017250: 7061 7468 2c20 6669 6c65 6e61 6d65 3d66  path, filename=f
-00017260: 696c 656e 616d 652c 0a20 2020 2020 2020  ilename,.       
-00017270: 2020 2020 2078 6461 743d 785f 6469 6164       xdat=x_diad
-00017280: 322c 2079 6461 743d 795f 636f 7272 5f64  2, ydat=y_corr_d
-00017290: 6961 6432 2c0a 2020 2020 2020 2020 7370  iad2,.        sp
-000172a0: 616e 3d73 7061 6e5f 6469 6164 322c 2070  an=span_diad2, p
-000172b0: 6c6f 745f 6669 6775 7265 3d46 616c 7365  lot_figure=False
-000172c0: 2c20 4469 6164 5f70 6f73 3d44 6961 645f  , Diad_pos=Diad_
-000172d0: 706f 732c 2048 425f 706f 733d 4842 5f70  pos, HB_pos=HB_p
-000172e0: 6f73 2c20 4331 335f 706f 733d 4331 335f  os, C13_pos=C13_
-000172f0: 706f 732c 2066 6974 5f70 6561 6b73 3d66  pos, fit_peaks=f
-00017300: 6974 5f70 6561 6b73 290a 2020 2020 2020  it_peaks).      
-00017310: 2020 2020 2020 693d 320a 2020 2020 2020        i=2.      
-00017320: 2020 2020 2020 7768 696c 6520 7374 7228        while str(
-00017330: 6466 5f6f 7574 5b27 4469 6164 325f 7265  df_out['Diad2_re
-00017340: 6669 7427 5d2e 696c 6f63 5b30 5d29 213d  fit'].iloc[0])!=
-00017350: 2746 6c61 6767 6564 2057 6172 6e69 6e67  'Flagged Warning
-00017360: 733a 273a 0a0a 2020 2020 2020 2020 2020  s:':..          
-00017370: 2020 2020 2020 7072 696e 7428 2772 6566        print('ref
-00017380: 6974 2061 7474 656d 7074 2020 3d27 2b73  it attempt  ='+s
-00017390: 7472 2869 2920 2b20 272c 2027 2b73 7472  tr(i) + ', '+str
-000173a0: 2864 665f 6f75 745b 2744 6961 6432 5f72  (df_out['Diad2_r
-000173b0: 6566 6974 275d 2e69 6c6f 635b 305d 2929  efit'].iloc[0]))
-000173c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000173d0: 2070 7269 6e74 2864 665f 6f75 745b 2744   print(df_out['D
-000173e0: 6961 6432 5f72 6566 6974 275d 2e69 6c6f  iad2_refit'].ilo
-000173f0: 635b 305d 290a 0a0a 2020 2020 2020 2020  c[0])...        
-00017400: 2020 2020 2020 2020 636f 6e66 6967 5f74          config_t
-00017410: 7765 616b 6564 323d 636f 7079 2e63 6f70  weaked2=copy.cop
-00017420: 7928 636f 6e66 6967 5f74 7765 616b 6564  y(config_tweaked
-00017430: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00017440: 2020 6661 6374 6f72 323d 6661 6374 6f72    factor2=factor
-00017450: 2a32 0a0a 2020 2020 2020 2020 2020 2020  *2..            
-00017460: 2020 2020 230a 2020 2020 2020 2020 2020      #.          
-00017470: 2020 2020 2020 2320 6966 2061 6e79 2864        # if any(d
-00017480: 665f 6f75 745b 2744 6961 6432 5f72 6566  f_out['Diad2_ref
-00017490: 6974 275d 2e73 7472 2e63 6f6e 7461 696e  it'].str.contain
-000174a0: 7328 2756 5f4c 6f77 416d 7027 2929 3a0a  s('V_LowAmp')):.
-000174b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174c0: 2320 2020 2020 636f 6e66 6967 5f74 7765  #     config_twe
-000174d0: 616b 6564 322e 6469 6164 5f61 6d70 6c69  aked2.diad_ampli
-000174e0: 7475 6465 3d63 6f6e 6669 675f 7477 6561  tude=config_twea
-000174f0: 6b65 642e 6469 6164 5f61 6d70 6c69 7475  ked.diad_amplitu
-00017500: 6465 2a31 300a 2020 2020 2020 2020 2020  de*10.          
-00017510: 2020 2020 2020 2320 6966 2061 6e79 2864        # if any(d
-00017520: 665f 6f75 745b 2744 6961 6432 5f72 6566  f_out['Diad2_ref
-00017530: 6974 275d 2e73 7472 2e63 6f6e 7461 696e  it'].str.contain
-00017540: 7328 2756 5f48 6967 6841 6d70 2729 293a  s('V_HighAmp')):
-00017550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017560: 2023 2020 2020 2063 6f6e 6669 675f 7477   #     config_tw
-00017570: 6561 6b65 6432 2e64 6961 645f 616d 706c  eaked2.diad_ampl
-00017580: 6974 7564 653d 636f 6e66 6967 5f74 7765  itude=config_twe
-00017590: 616b 6564 2e64 6961 645f 616d 706c 6974  aked.diad_amplit
-000175a0: 7564 652f 3130 0a20 2020 2020 2020 2020  ude/10.         
-000175b0: 2020 2020 2020 2069 6620 616e 7928 6466         if any(df
-000175c0: 5f6f 7574 5b27 4469 6164 325f 7265 6669  _out['Diad2_refi
-000175d0: 7427 5d2e 7374 722e 636f 6e74 6169 6e73  t'].str.contains
-000175e0: 2827 565f 5369 676d 615f 746f 6f5f 4c6f  ('V_Sigma_too_Lo
-000175f0: 7727 2929 3a0a 2020 2020 2020 2020 2020  w')):.          
-00017600: 2020 2020 2020 2020 2020 636f 6e66 6967            config
-00017610: 5f74 7765 616b 6564 322e 6469 6164 5f73  _tweaked2.diad_s
-00017620: 6967 6d61 3d63 6f6e 6669 675f 7477 6561  igma=config_twea
-00017630: 6b65 642e 6469 6164 5f73 6967 6d61 2a66  ked.diad_sigma*f
-00017640: 6163 746f 7232 0a20 2020 2020 2020 2020  actor2.         
-00017650: 2020 2020 2020 2069 6620 616e 7928 6466         if any(df
-00017660: 5f6f 7574 5b27 4469 6164 325f 7265 6669  _out['Diad2_refi
-00017670: 7427 5d2e 7374 722e 636f 6e74 6169 6e73  t'].str.contains
-00017680: 2827 565f 5369 676d 615f 746f 6f5f 4869  ('V_Sigma_too_Hi
-00017690: 6768 2729 293a 0a20 2020 2020 2020 2020  gh')):.         
-000176a0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-000176b0: 675f 7477 6561 6b65 6432 2e64 6961 645f  g_tweaked2.diad_
-000176c0: 7369 676d 613d 636f 6e66 6967 5f74 7765  sigma=config_twe
-000176d0: 616b 6564 2e64 6961 645f 7369 676d 612f  aked.diad_sigma/
-000176e0: 6661 6374 6f72 320a 2020 2020 2020 2020  factor2.        
-000176f0: 2020 2020 2020 2020 2320 4761 7573 7369          # Gaussi
-00017700: 616e 2066 6974 2062 6974 730a 2020 2020  an fit bits.    
-00017710: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00017720: 6e79 2864 665f 6f75 745b 2744 6961 6432  ny(df_out['Diad2
-00017730: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
-00017740: 7461 696e 7328 2747 5f69 6e70 7574 5f54  tains('G_input_T
-00017750: 6f6f 4869 6768 5369 676d 6127 2929 3a0a  ooHighSigma')):.
-00017760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017770: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
-00017780: 6564 322e 6761 7573 735f 7369 676d 613d  ed2.gauss_sigma=
-00017790: 636f 6e66 6967 5f74 7765 616b 6564 2e67  config_tweaked.g
-000177a0: 6175 7373 5f73 6967 6d61 2f66 6163 746f  auss_sigma/facto
-000177b0: 7232 0a20 2020 2020 2020 2020 2020 2020  r2.             
-000177c0: 2020 2069 6620 616e 7928 6466 5f6f 7574     if any(df_out
-000177d0: 5b27 4469 6164 325f 7265 6669 7427 5d2e  ['Diad2_refit'].
-000177e0: 7374 722e 636f 6e74 6169 6e73 2827 475f  str.contains('G_
-000177f0: 696e 7075 745f 546f 6f4c 6f77 5369 676d  input_TooLowSigm
-00017800: 6127 2929 3a0a 2020 2020 2020 2020 2020  a')):.          
-00017810: 2020 2020 2020 2020 2020 636f 6e66 6967            config
-00017820: 5f74 7765 616b 6564 322e 6761 7573 735f  _tweaked2.gauss_
-00017830: 7369 676d 613d 636f 6e66 6967 5f74 7765  sigma=config_twe
-00017840: 616b 6564 2e67 6175 7373 5f73 6967 6d61  aked.gauss_sigma
-00017850: 2a66 6163 746f 7232 0a20 2020 2020 2020  *factor2.       
-00017860: 2020 2020 2020 2020 2069 6620 616e 7928           if any(
-00017870: 6466 5f6f 7574 5b27 4469 6164 325f 7265  df_out['Diad2_re
-00017880: 6669 7427 5d2e 7374 722e 636f 6e74 6169  fit'].str.contai
-00017890: 6e73 2827 475f 696e 7075 745f 546f 6f4c  ns('G_input_TooL
-000178a0: 6f77 416d 7027 2929 3a0a 2020 2020 2020  owAmp')):.      
-000178b0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000178c0: 6e66 6967 5f74 7765 616b 6564 322e 6761  nfig_tweaked2.ga
-000178d0: 7573 735f 616d 706c 6974 7564 653d 636f  uss_amplitude=co
-000178e0: 6e66 6967 5f74 7765 616b 6564 2e67 6175  nfig_tweaked.gau
-000178f0: 7373 5f61 6d70 2a66 6163 746f 7232 0a20  ss_amp*factor2. 
-00017900: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017910: 6620 616e 7928 6466 5f6f 7574 5b27 4469  f any(df_out['Di
-00017920: 6164 325f 7265 6669 7427 5d2e 7374 722e  ad2_refit'].str.
-00017930: 636f 6e74 6169 6e73 2827 475f 416d 705f  contains('G_Amp_
-00017940: 746f 6f5f 6869 6768 2729 293a 0a20 2020  too_high')):.   
-00017950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017960: 2063 6f6e 6669 675f 7477 6561 6b65 6432   config_tweaked2
-00017970: 2e67 6175 7373 5f61 6d70 6c69 7475 6465  .gauss_amplitude
-00017980: 3d63 6f6e 6669 675f 7477 6561 6b65 642e  =config_tweaked.
-00017990: 6761 7573 735f 616d 702f 6661 6374 6f72  gauss_amp/factor
-000179a0: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
-000179b0: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
-000179c0: 2744 6961 6432 5f72 6566 6974 275d 2e73  'Diad2_refit'].s
-000179d0: 7472 2e63 6f6e 7461 696e 7328 2747 5f68  tr.contains('G_h
-000179e0: 6967 6865 725f 7468 616e 5f64 6961 6427  igher_than_diad'
-000179f0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-00017a00: 2020 2020 2020 2020 636f 6e66 6967 5f74          config_t
-00017a10: 7765 616b 6564 322e 6761 7573 735f 616d  weaked2.gauss_am
-00017a20: 706c 6974 7564 653d 636f 6e66 6967 5f74  plitude=config_t
-00017a30: 7765 616b 6564 2e67 6175 7373 5f61 6d70  weaked.gauss_amp
-00017a40: 2f66 6163 746f 7232 0a20 2020 2020 2020  /factor2.       
-00017a50: 2020 2020 2020 2020 2020 2020 2023 636f               #co
-00017a60: 6e66 6967 5f74 7765 616b 6564 322e 6761  nfig_tweaked2.ga
-00017a70: 7573 735f 7369 676d 613d 636f 6e66 6967  uss_sigma=config
-00017a80: 5f74 7765 616b 6564 2e67 6175 7373 5f73  _tweaked.gauss_s
-00017a90: 6967 6d61 2a66 6163 746f 7232 0a20 2020  igma*factor2.   
-00017aa0: 2020 2020 2020 2020 2023 2023 2048 6f74           # # Hot
-00017ab0: 2062 616e 6473 2062 6974 730a 2020 2020   bands bits.    
-00017ac0: 2020 2020 2020 2020 2320 2020 2020 6966          #     if
-00017ad0: 2061 6e79 2864 665f 6f75 745b 2744 6961   any(df_out['Dia
-00017ae0: 6432 5f72 6566 6974 275d 2e73 7472 2e63  d2_refit'].str.c
-00017af0: 6f6e 7461 696e 7328 2748 4232 5f4c 6f77  ontains('HB2_Low
-00017b00: 416d 7027 2929 3a0a 2020 2020 2020 2020  Amp')):.        
-00017b10: 2020 2020 2320 2020 2020 2020 2020 636f      #         co
-00017b20: 6e66 6967 5f74 7765 616b 6564 322e 4842  nfig_tweaked2.HB
-00017b30: 5f61 6d70 6c69 7475 6465 3d63 6f6e 6669  _amplitude=confi
-00017b40: 675f 7477 6561 6b65 642e 4842 5f61 6d70  g_tweaked.HB_amp
-00017b50: 6c69 7475 6465 2f32 0a20 2020 2020 2020  litude/2.       
-00017b60: 2020 2020 2023 2020 2020 2069 6620 616e       #     if an
-00017b70: 7928 6466 5f6f 7574 5b27 4469 6164 325f  y(df_out['Diad2_
-00017b80: 7265 6669 7427 5d2e 7374 722e 636f 6e74  refit'].str.cont
-00017b90: 6169 6e73 2827 4842 325f 4869 6768 416d  ains('HB2_HighAm
-00017ba0: 7027 2929 3a0a 2020 2020 2020 2020 2020  p')):.          
-00017bb0: 2020 2320 2020 2020 2020 2020 636f 6e66    #         conf
-00017bc0: 6967 5f74 7765 616b 6564 322e 4842 5f61  ig_tweaked2.HB_a
-00017bd0: 6d70 6c69 7475 6465 3d63 6f6e 6669 675f  mplitude=config_
-00017be0: 7477 6561 6b65 642e 4842 5f61 6d70 6c69  tweaked.HB_ampli
-00017bf0: 7475 6465 2a32 0a0a 0a20 2020 2020 2020  tude*2...       
-00017c00: 2020 2020 2020 2020 2072 6573 756c 742c           result,
-00017c10: 2064 665f 6f75 742c 2079 5f62 6573 745f   df_out, y_best_
-00017c20: 6669 742c 2078 5f6c 696e 2c20 636f 6d70  fit, x_lin, comp
-00017c30: 6f6e 656e 7473 2c20 7864 6174 2c20 7964  onents, xdat, yd
-00017c40: 6174 2c20 6178 315f 786c 696d 2c20 6178  at, ax1_xlim, ax
-00017c50: 325f 786c 696d 2c72 6573 6964 7561 6c5f  2_xlim,residual_
-00017c60: 6469 6164 5f63 6f6f 7264 732c 2079 6461  diad_coords, yda
-00017c70: 745f 696e 7261 6e67 652c 2020 7864 6174  t_inrange,  xdat
-00017c80: 5f69 6e72 616e 6765 3d66 6974 5f67 6175  _inrange=fit_gau
-00017c90: 7373 6961 6e5f 766f 6967 745f 6765 6e65  ssian_voigt_gene
-00017ca0: 7269 635f 6469 6164 2863 6f6e 6669 675f  ric_diad(config_
-00017cb0: 7477 6561 6b65 6432 2c20 6469 6164 323d  tweaked2, diad2=
-00017cc0: 5472 7565 2c20 7061 7468 3d70 6174 682c  True, path=path,
-00017cd0: 2066 696c 656e 616d 653d 6669 6c65 6e61   filename=filena
-00017ce0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-00017cf0: 7864 6174 3d78 5f64 6961 6432 2c20 7964  xdat=x_diad2, yd
-00017d00: 6174 3d79 5f63 6f72 725f 6469 6164 322c  at=y_corr_diad2,
-00017d10: 2073 7061 6e3d 7370 616e 5f64 6961 6432   span=span_diad2
-00017d20: 2c20 706c 6f74 5f66 6967 7572 653d 4661  , plot_figure=Fa
-00017d30: 6c73 652c 2044 6961 645f 706f 733d 4469  lse, Diad_pos=Di
-00017d40: 6164 5f70 6f73 2c20 4842 5f70 6f73 3d48  ad_pos, HB_pos=H
-00017d50: 425f 706f 732c 2043 3133 5f70 6f73 3d43  B_pos, C13_pos=C
-00017d60: 3133 5f70 6f73 2c20 6669 745f 7065 616b  13_pos, fit_peak
-00017d70: 733d 6669 745f 7065 616b 7329 0a20 2020  s=fit_peaks).   
-00017d80: 2020 2020 2020 2020 2020 2020 2069 3d69               i=i
-00017d90: 2b31 0a20 2020 2020 2020 2020 2020 2020  +1.             
-00017da0: 2020 2069 6620 693e 353a 0a20 2020 2020     if i>5:.     
-00017db0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00017dc0: 7269 6e74 2827 476f 7420 746f 2035 2069  rint('Got to 5 i
-00017dd0: 7465 7261 746f 696e 7320 616e 6420 7374  teratoins and st
-00017de0: 696c 6c20 636f 756c 646e 7420 6164 6a75  ill couldnt adju
-00017df0: 7374 2074 6865 2066 6974 2070 6172 616d  st the fit param
-00017e00: 6574 6572 7327 290a 2020 2020 2020 2020  eters').        
-00017e10: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00017e20: 6b0a 0a0a 2020 2020 2320 6765 7420 6120  k...    # get a 
-00017e30: 6265 7374 2066 6974 2074 6f20 7468 6520  best fit to the 
-00017e40: 6261 7365 6c69 6e65 2075 7369 6e67 2061  baseline using a
-00017e50: 206c 696e 7370 6163 6520 6672 6f6d 2074   linspace from t
-00017e60: 6865 2070 6561 6b20 6669 7474 696e 670a  he peak fitting.
-00017e70: 2020 2020 7962 6173 655f 786c 696e 3d50      ybase_xlin=P
-00017e80: 665f 6261 7365 6c69 6e65 5f64 6961 6432  f_baseline_diad2
-00017e90: 2878 5f6c 696e 290a 0a20 2020 2023 2057  (x_lin)..    # W
-00017ea0: 6520 6578 7472 6163 7420 7468 6520 6675  e extract the fu
-00017eb0: 6c6c 2073 7065 6374 7261 2074 6f20 706c  ll spectra to pl
-00017ec0: 6f74 2061 7420 7468 6520 656e 642c 2061  ot at the end, a
-00017ed0: 6e64 2063 6f6e 7665 7274 2074 6f20 6120  nd convert to a 
-00017ee0: 6461 7461 6672 616d 650a 2020 2020 2353  dataframe.    #S
-00017ef0: 7065 6374 7261 5f64 663d 6765 745f 6461  pectra_df=get_da
-00017f00: 7461 2870 6174 683d 7061 7468 2c20 6669  ta(path=path, fi
-00017f10: 6c65 6e61 6d65 3d66 696c 656e 616d 652c  lename=filename,
-00017f20: 2066 696c 6574 7970 653d 6669 6c65 7479   filetype=filety
-00017f30: 7065 290a 2020 2020 5370 6563 7472 613d  pe).    Spectra=
-00017f40: 4469 6164 0a0a 0a0a 2020 2020 2320 4d61  Diad....    # Ma
-00017f50: 6b65 206e 6963 6520 6669 6775 7265 0a20  ke nice figure. 
-00017f60: 2020 2069 6620 706c 6f74 5f66 6967 7572     if plot_figur
-00017f70: 6520 6973 2054 7275 653a 0a0a 2020 2020  e is True:..    
-00017f80: 2020 2020 6669 6775 7265 5f6d 6f73 6169      figure_mosai
-00017f90: 633d 2222 220a 2020 2020 2020 2020 5859  c=""".        XY
-00017fa0: 0a20 2020 2020 2020 2041 420a 2020 2020  .        AB.    
-00017fb0: 2020 2020 4344 0a20 2020 2020 2020 2045      CD.        E
-00017fc0: 450a 2020 2020 2020 2020 2222 220a 0a20  E.        """.. 
-00017fd0: 2020 2020 2020 2066 6967 2c61 7865 733d         fig,axes=
-00017fe0: 706c 742e 7375 6270 6c6f 745f 6d6f 7361  plt.subplot_mosa
-00017ff0: 6963 286d 6f73 6169 633d 6669 6775 7265  ic(mosaic=figure
-00018000: 5f6d 6f73 6169 632c 2066 6967 7369 7a65  _mosaic, figsize
-00018010: 3d28 3132 2c20 3136 2929 0a20 2020 2020  =(12, 16)).     
-00018020: 2020 2069 6620 6466 5f6f 7574 5b27 4469     if df_out['Di
-00018030: 6164 325f 7265 6669 7427 5d20 6973 206e  ad2_refit'] is n
-00018040: 6f74 2046 616c 7365 3a0a 2020 2020 2020  ot False:.      
-00018050: 2020 2020 2020 6669 672e 7375 7074 6974        fig.suptit
-00018060: 6c65 2827 4469 6164 2032 2c20 6669 6c65  le('Diad 2, file
-00018070: 3d20 272b 2073 7472 2866 696c 656e 616d  = '+ str(filenam
-00018080: 6529 202b 2027 205c 6e27 202b 2073 7472  e) + ' \n' + str
-00018090: 2864 665f 6f75 745b 2744 6961 6432 5f72  (df_out['Diad2_r
-000180a0: 6566 6974 275d 2e69 6c6f 635b 305d 292c  efit'].iloc[0]),
-000180b0: 2066 6f6e 7473 697a 653d 3136 2c20 783d   fontsize=16, x=
-000180c0: 302e 352c 2079 3d31 2e30 290a 2020 2020  0.5, y=1.0).    
-000180d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000180e0: 2020 2020 2020 6669 672e 7375 7074 6974        fig.suptit
-000180f0: 6c65 2827 4469 6164 2032 2c20 6669 6c65  le('Diad 2, file
-00018100: 3d20 272b 2073 7472 2866 696c 656e 616d  = '+ str(filenam
-00018110: 6529 2c20 666f 6e74 7369 7a65 3d31 362c  e), fontsize=16,
-00018120: 2078 3d30 2e35 2c20 793d 312e 3029 0a20   x=0.5, y=1.0). 
-00018130: 2020 2020 2020 2023 2042 6163 6b67 726f         # Backgro
-00018140: 756e 6420 706c 6f74 2066 6f72 2072 6561  und plot for rea
-00018150: 6c0a 0a20 2020 2020 2020 2023 2050 6c6f  l..        # Plo
-00018160: 7420 6265 7374 2066 6974 206f 6e20 7468  t best fit on th
-00018170: 6520 4c48 532c 2061 6e64 2069 6e64 6976  e LHS, and indiv
-00018180: 6964 7561 6c20 6669 7473 206f 6e20 7468  idual fits on th
-00018190: 6520 5248 5320 6174 2074 6865 2074 6f70  e RHS at the top
-000181a0: 0a0a 2020 2020 2020 2020 6178 6573 5b27  ..        axes['
-000181b0: 5827 5d2e 7365 745f 7469 746c 6528 2761  X'].set_title('a
-000181c0: 2920 4261 636b 6772 6f75 6e64 2066 6974  ) Background fit
-000181d0: 2729 0a20 2020 2020 2020 2061 7865 735b  ').        axes[
-000181e0: 2758 275d 2e70 6c6f 7428 4469 6164 5b3a  'X'].plot(Diad[:
-000181f0: 2c20 305d 2c20 4469 6164 5b3a 2c20 315d  , 0], Diad[:, 1]
-00018200: 2c20 272d 272c 2063 6f6c 6f72 3d27 6772  , '-', color='gr
-00018210: 6579 2729 0a20 2020 2020 2020 2061 7865  ey').        axe
-00018220: 735b 2758 275d 2e70 6c6f 7428 4469 6164  s['X'].plot(Diad
-00018230: 5f73 686f 7274 5f64 6961 6432 5b3a 2c20  _short_diad2[:, 
-00018240: 305d 2c20 4469 6164 5f73 686f 7274 5f64  0], Diad_short_d
-00018250: 6961 6432 5b3a 2c20 315d 2c20 272d 7227  iad2[:, 1], '-r'
-00018260: 2c20 6c61 6265 6c3d 2753 7065 6374 7261  , label='Spectra
-00018270: 2729 0a0a 2020 2020 2020 2020 2361 7865  ')..        #axe
-00018280: 735b 2758 275d 2e70 6c6f 7428 4261 7365  s['X'].plot(Base
-00018290: 6c69 6e65 5b3a 2c20 305d 2c20 4261 7365  line[:, 0], Base
-000182a0: 6c69 6e65 5b3a 2c20 315d 2c20 272d 6227  line[:, 1], '-b'
-000182b0: 2c20 6c61 6265 6c3d 2742 636b 2070 6f69  , label='Bck poi
-000182c0: 6e74 7327 290a 2020 2020 2020 2020 6178  nts').        ax
-000182d0: 6573 5b27 5827 5d2e 706c 6f74 2842 6173  es['X'].plot(Bas
-000182e0: 656c 696e 655f 6469 6164 325b 3a2c 2030  eline_diad2[:, 0
-000182f0: 5d2c 2042 6173 656c 696e 655f 6469 6164  ], Baseline_diad
-00018300: 325b 3a2c 2031 5d2c 2027 2e62 272c 206c  2[:, 1], '.b', l
-00018310: 6162 656c 3d27 6265 6c2e 2042 636b 2e20  abel='bel. Bck. 
-00018320: 7074 7327 290a 2020 2020 2020 2020 6178  pts').        ax
-00018330: 6573 5b27 5827 5d2e 706c 6f74 2844 6961  es['X'].plot(Dia
-00018340: 645f 7368 6f72 745f 6469 6164 325b 3a2c  d_short_diad2[:,
-00018350: 2030 5d2c 2050 795f 6261 7365 5f64 6961   0], Py_base_dia
-00018360: 6432 2c20 272d 6b27 2c20 6c61 6265 6c3d  d2, '-k', label=
-00018370: 2762 636b 2e20 706f 6c79 2066 6974 2729  'bck. poly fit')
-00018380: 0a0a 0a0a 2020 2020 2020 2020 6178 315f  ....        ax1_
-00018390: 796d 696e 3d6e 702e 6d69 6e28 4261 7365  ymin=np.min(Base
-000183a0: 6c69 6e65 5f64 6961 6432 5b3a 2c20 315d  line_diad2[:, 1]
-000183b0: 292d 3130 2a6e 702e 7374 6428 4261 7365  )-10*np.std(Base
-000183c0: 6c69 6e65 5f64 6961 6432 5b3a 2c20 315d  line_diad2[:, 1]
-000183d0: 290a 2020 2020 2020 2020 6178 315f 796d  ).        ax1_ym
-000183e0: 6178 3d6e 702e 6d61 7828 4261 7365 6c69  ax=np.max(Baseli
-000183f0: 6e65 5f64 6961 6432 5b3a 2c20 315d 292b  ne_diad2[:, 1])+
-00018400: 3130 2a6e 702e 7374 6428 4261 7365 6c69  10*np.std(Baseli
-00018410: 6e65 5f64 6961 6432 5b3a 2c20 315d 290a  ne_diad2[:, 1]).
-00018420: 2020 2020 2020 2020 6178 315f 786d 696e          ax1_xmin
-00018430: 3d63 6f6e 6669 6731 2e6c 6f77 6572 5f62  =config1.lower_b
-00018440: 636b 5f64 6961 6432 5b30 5d2d 3330 0a20  ck_diad2[0]-30. 
-00018450: 2020 2020 2020 2061 7831 5f78 6d61 783d         ax1_xmax=
-00018460: 636f 6e66 6967 312e 7570 7065 725f 6263  config1.upper_bc
-00018470: 6b5f 6469 6164 325b 315d 2b33 300a 2020  k_diad2[1]+30.  
-00018480: 2020 2020 2020 2320 4164 6469 6e67 2070        # Adding p
-00018490: 6174 6368 6573 0a0a 0a20 2020 2020 2020  atches...       
-000184a0: 2072 6563 745f 6469 6164 325f 6231 3d70   rect_diad2_b1=p
-000184b0: 6174 6368 6573 2e52 6563 7461 6e67 6c65  atches.Rectangle
-000184c0: 2828 636f 6e66 6967 312e 6c6f 7765 725f  ((config1.lower_
-000184d0: 6263 6b5f 6469 6164 325b 305d 2c20 6178  bck_diad2[0], ax
-000184e0: 315f 796d 696e 292c 636f 6e66 6967 312e  1_ymin),config1.
-000184f0: 6c6f 7765 725f 6263 6b5f 6469 6164 325b  lower_bck_diad2[
-00018500: 315d 2d63 6f6e 6669 6731 2e6c 6f77 6572  1]-config1.lower
-00018510: 5f62 636b 5f64 6961 6432 5b30 5d2c 6178  _bck_diad2[0],ax
-00018520: 315f 796d 6178 2d61 7831 5f79 6d69 6e2c  1_ymax-ax1_ymin,
-00018530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018550: 206c 696e 6577 6964 7468 3d31 2c65 6467   linewidth=1,edg
-00018560: 6563 6f6c 6f72 3d27 6e6f 6e65 272c 6661  ecolor='none',fa
-00018570: 6365 636f 6c6f 723d 2763 7961 6e27 2c20  cecolor='cyan', 
-00018580: 6c61 6265 6c3d 2773 656c 2e20 6263 6b2e  label='sel. bck.
-00018590: 2072 6567 696f 6e27 2c20 616c 7068 613d   region', alpha=
-000185a0: 302e 332c 207a 6f72 6465 723d 3029 0a20  0.3, zorder=0). 
-000185b0: 2020 2020 2020 2061 7865 735b 2758 275d         axes['X']
-000185c0: 2e61 6464 5f70 6174 6368 2872 6563 745f  .add_patch(rect_
-000185d0: 6469 6164 325f 6231 290a 2020 2020 2020  diad2_b1).      
-000185e0: 2020 7265 6374 5f64 6961 6432 5f62 323d    rect_diad2_b2=
-000185f0: 7061 7463 6865 732e 5265 6374 616e 676c  patches.Rectangl
-00018600: 6528 2863 6f6e 6669 6731 2e75 7070 6572  e((config1.upper
-00018610: 5f62 636b 5f64 6961 6432 5b30 5d2c 2061  _bck_diad2[0], a
-00018620: 7831 5f79 6d69 6e29 2c63 6f6e 6669 6731  x1_ymin),config1
+00014990: 2020 2020 2020 2020 2020 2020 2027 4469               'Di
+000149a0: 6164 315f 566f 6967 745f 5369 676d 6127  ad1_Voigt_Sigma'
+000149b0: 3a20 5065 616b 315f 5369 676d 612c 0a20  : Peak1_Sigma,. 
+000149c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000149d0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+000149e0: 4469 6164 315f 566f 6967 745f 4761 6d6d  Diad1_Voigt_Gamm
+000149f0: 6127 3a20 5065 616b 315f 6761 6d6d 612c  a': Peak1_gamma,
+00014a00: 0a0a 0a20 2020 2020 2020 2020 2020 207d  ...            }
+00014a10: 2c20 696e 6465 783d 5b30 5d29 0a20 2020  , index=[0]).   
+00014a20: 2020 2020 2069 6620 5065 616b 325f 4365       if Peak2_Ce
+00014a30: 6e74 2069 7320 6e6f 7420 4e6f 6e65 3a0a  nt is not None:.
+00014a40: 0a0a 0a0a 0a20 2020 2020 2020 2020 2020  .....           
+00014a50: 2064 665f 6f75 743d 7064 2e44 6174 6146   df_out=pd.DataF
+00014a60: 7261 6d65 2864 6174 613d 7b27 4469 6164  rame(data={'Diad
+00014a70: 315f 566f 6967 745f 4365 6e74 273a 2050  1_Voigt_Cent': P
+00014a80: 6561 6b31 5f43 656e 742c 0a20 2020 2020  eak1_Cent,.     
+00014a90: 2020 2020 2020 2027 4469 6164 315f 6365         'Diad1_ce
+00014aa0: 6e74 5f65 7272 273a 2065 7272 6f72 5f70  nt_err': error_p
+00014ab0: 6b32 2c0a 2020 2020 2020 2020 2020 2020  k2,.            
+00014ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ad0: 2020 2020 2020 2020 2744 6961 6431 5f56          'Diad1_V
+00014ae0: 6f69 6774 5f41 7265 6127 3a20 5065 616b  oigt_Area': Peak
+00014af0: 315f 496e 742c 0a20 2020 2020 2020 2020  1_Int,.         
+00014b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b10: 2020 2020 2020 2020 2020 2027 4469 6164             'Diad
+00014b20: 315f 566f 6967 745f 5369 676d 6127 3a20  1_Voigt_Sigma': 
+00014b30: 5065 616b 315f 5369 676d 612c 0a20 2020  Peak1_Sigma,.   
+00014b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b60: 2027 4469 6164 315f 566f 6967 745f 4761   'Diad1_Voigt_Ga
+00014b70: 6d6d 6127 3a20 5065 616b 315f 6761 6d6d  mma': Peak1_gamm
+00014b80: 612c 0a20 2020 2020 2020 2020 2020 207d  a,.            }
+00014b90: 2c20 696e 6465 783d 5b30 5d29 0a0a 2020  , index=[0])..  
+00014ba0: 2020 2020 2020 2020 2020 6466 5f6f 7574            df_out
+00014bb0: 5b27 4842 315f 4365 6e74 275d 3d50 6561  ['HB1_Cent']=Pea
+00014bc0: 6b32 5f43 656e 740a 2020 2020 2020 2020  k2_Cent.        
+00014bd0: 2020 2020 6466 5f6f 7574 5b27 4842 315f      df_out['HB1_
+00014be0: 4172 6561 275d 3d50 6561 6b32 5f49 6e74  Area']=Peak2_Int
+00014bf0: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
+00014c00: 6f75 745b 2748 4231 5f53 6967 6d61 275d  out['HB1_Sigma']
+00014c10: 3d50 6561 6b32 5f53 6967 6d61 0a0a 0a20  =Peak2_Sigma... 
+00014c20: 2020 2020 2020 2072 6573 756c 745f 6469         result_di
+00014c30: 6164 315f 6f72 6967 785f 616c 6c3d 7265  ad1_origx_all=re
+00014c40: 7375 6c74 2e65 7661 6c28 783d 7864 6174  sult.eval(x=xdat
+00014c50: 290a 2020 2020 2020 2020 2320 5472 696d  ).        # Trim
+00014c60: 2074 6f20 6265 2069 6e20 7261 6e67 650a   to be in range.
+00014c70: 2020 2020 2020 2020 2370 7269 6e74 2872          #print(r
+00014c80: 6573 756c 745f 6469 6164 325f 6f72 6967  esult_diad2_orig
+00014c90: 785f 616c 6c29 0a20 2020 2020 2020 2072  x_all).        r
+00014ca0: 6573 756c 745f 6469 6164 315f 6f72 6967  esult_diad1_orig
+00014cb0: 783d 7265 7375 6c74 5f64 6961 6431 5f6f  x=result_diad1_o
+00014cc0: 7269 6778 5f61 6c6c 5b28 7864 6174 3e73  rigx_all[(xdat>s
+00014cd0: 7061 6e5b 305d 2920 2620 2878 6461 743c  pan[0]) & (xdat<
+00014ce0: 7370 616e 5b31 5d29 5d0a 2020 2020 2020  span[1])].      
+00014cf0: 2020 7964 6174 5f69 6e72 616e 6765 3d79    ydat_inrange=y
+00014d00: 6461 745b 2878 6461 743e 7370 616e 5b30  dat[(xdat>span[0
+00014d10: 5d29 2026 2028 7864 6174 3c73 7061 6e5b  ]) & (xdat<span[
+00014d20: 315d 295d 0a20 2020 2020 2020 2078 6461  1])].        xda
+00014d30: 745f 696e 7261 6e67 653d 7864 6174 5b28  t_inrange=xdat[(
+00014d40: 7864 6174 3e73 7061 6e5b 305d 2920 2620  xdat>span[0]) & 
+00014d50: 2878 6461 743c 7370 616e 5b31 5d29 5d0a  (xdat<span[1])].
+00014d60: 2020 2020 2020 2020 7265 7369 6475 616c          residual
+00014d70: 5f64 6961 645f 636f 6f72 6473 3d79 6461  _diad_coords=yda
+00014d80: 745f 696e 7261 6e67 652d 7265 7375 6c74  t_inrange-result
+00014d90: 5f64 6961 6431 5f6f 7269 6778 0a0a 0a20  _diad1_origx... 
+00014da0: 2020 2020 2020 2078 5f63 656e 745f 6c69         x_cent_li
+00014db0: 6e3d 6e70 2e6c 696e 7370 6163 6528 6466  n=np.linspace(df
+00014dc0: 5f6f 7574 5b27 4469 6164 315f 566f 6967  _out['Diad1_Voig
+00014dd0: 745f 4365 6e74 275d 2d31 2c20 6466 5f6f  t_Cent']-1, df_o
+00014de0: 7574 5b27 4469 6164 315f 566f 6967 745f  ut['Diad1_Voigt_
+00014df0: 4365 6e74 275d 2b31 2c20 3230 3030 3029  Cent']+1, 20000)
+00014e00: 0a20 2020 2020 2020 2079 5f63 656e 745f  .        y_cent_
+00014e10: 6265 7374 5f66 6974 3d72 6573 756c 742e  best_fit=result.
+00014e20: 6576 616c 2878 3d78 5f63 656e 745f 6c69  eval(x=x_cent_li
+00014e30: 6e29 0a20 2020 2020 2020 2064 6961 645f  n).        diad_
+00014e40: 6865 6967 6874 203d 206e 702e 6d61 7828  height = np.max(
+00014e50: 795f 6365 6e74 5f62 6573 745f 6669 7429  y_cent_best_fit)
+00014e60: 0a20 2020 2020 2020 2064 665f 6f75 745b  .        df_out[
+00014e70: 2744 6961 6431 5f43 6f6d 626f 6669 745f  'Diad1_Combofit_
+00014e80: 4865 6967 6874 275d 3d20 6469 6164 5f68  Height']= diad_h
+00014e90: 6569 6768 740a 2020 2020 2020 2020 6466  eight.        df
+00014ea0: 5f6f 7574 2e69 6e73 6572 7428 302c 2027  _out.insert(0, '
+00014eb0: 4469 6164 315f 436f 6d62 6f66 6974 5f43  Diad1_Combofit_C
+00014ec0: 656e 7427 2c20 6e70 2e6e 616e 6d65 616e  ent', np.nanmean
+00014ed0: 2878 5f63 656e 745f 6c69 6e5b 795f 6365  (x_cent_lin[y_ce
+00014ee0: 6e74 5f62 6573 745f 6669 743d 3d64 6961  nt_best_fit==dia
+00014ef0: 645f 6865 6967 6874 5d29 290a 0a0a 2020  d_height]))...  
+00014f00: 2020 2020 2020 7265 7369 6475 616c 5f64        residual_d
+00014f10: 6961 6431 3d6e 702e 7375 6d28 2828 7964  iad1=np.sum(((yd
+00014f20: 6174 5f69 6e72 616e 6765 2d72 6573 756c  at_inrange-resul
+00014f30: 745f 6469 6164 315f 6f72 6967 7829 2a2a  t_diad1_origx)**
+00014f40: 3229 2a2a 302e 3529 2f28 6c65 6e28 7964  2)**0.5)/(len(yd
+00014f50: 6174 5f69 6e72 616e 6765 2929 0a20 2020  at_inrange)).   
+00014f60: 2020 2020 2064 665f 6f75 745b 2744 6961       df_out['Dia
+00014f70: 6431 5f52 6573 6964 7561 6c27 5d3d 7265  d1_Residual']=re
+00014f80: 7369 6475 616c 5f64 6961 6431 0a20 2020  sidual_diad1.   
+00014f90: 2020 2020 2064 665f 6f75 745b 2744 6961       df_out['Dia
+00014fa0: 6431 5f50 726f 705f 4c6f 7227 5d3d 2050  d1_Prop_Lor']= P
+00014fb0: 6561 6b31 5f50 726f 705f 4c6f 720a 2020  eak1_Prop_Lor.  
+00014fc0: 2020 2020 2020 6466 5f6f 7574 5b27 4469        df_out['Di
+00014fd0: 6164 315f 6677 686d 275d 3d50 6561 6b31  ad1_fwhm']=Peak1
+00014fe0: 5f66 7768 6d0a 0a20 2020 2020 2020 2069  _fwhm..        i
+00014ff0: 6620 636f 6e66 6967 312e 6669 745f 6761  f config1.fit_ga
+00015000: 7573 7320 6973 206e 6f74 2046 616c 7365  uss is not False
+00015010: 3a0a 2020 2020 2020 2020 2020 2020 6466  :.            df
+00015020: 5f6f 7574 5b27 4469 6164 315f 4761 7573  _out['Diad1_Gaus
+00015030: 735f 4365 6e74 275d 3d47 6175 7373 5f63  s_Cent']=Gauss_c
+00015040: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
+00015050: 6466 5f6f 7574 5b27 4469 6164 315f 4761  df_out['Diad1_Ga
+00015060: 7573 735f 4172 6561 275d 3d47 6175 7373  uss_Area']=Gauss
+00015070: 5f61 6d70 0a20 2020 2020 2020 2020 2020  _amp.           
+00015080: 2064 665f 6f75 745b 2744 6961 6431 5f47   df_out['Diad1_G
+00015090: 6175 7373 5f53 6967 6d61 275d 3d47 6175  auss_Sigma']=Gau
+000150a0: 7373 5f73 6967 6d61 0a0a 0a0a 2020 2020  ss_sigma....    
+000150b0: 2020 2020 6966 2070 6c6f 745f 6669 6775      if plot_figu
+000150c0: 7265 2069 7320 5472 7565 3a0a 0a20 2020  re is True:..   
+000150d0: 2020 2020 2020 2020 2066 6967 2c20 2861           fig, (a
+000150e0: 7831 2c20 6178 3229 203d 2070 6c74 2e73  x1, ax2) = plt.s
+000150f0: 7562 706c 6f74 7328 312c 2032 2c20 6669  ubplots(1, 2, fi
+00015100: 6773 697a 653d 2831 322c 3429 290a 2020  gsize=(12,4)).  
+00015110: 2020 2020 2020 2020 2020 6178 312e 706c            ax1.pl
+00015120: 6f74 2878 5f6c 696e 2c20 795f 6265 7374  ot(x_lin, y_best
+00015130: 5f66 6974 2c20 272d 6727 2c20 6c69 6e65  _fit, '-g', line
+00015140: 7769 6474 683d 322c 206c 6162 656c 3d27  width=2, label='
+00015150: 6265 7374 2066 6974 2729 0a20 2020 2020  best fit').     
+00015160: 2020 2020 2020 2061 7831 2e70 6c6f 7428         ax1.plot(
+00015170: 7864 6174 2c20 7964 6174 2c20 2027 2e6b  xdat, ydat,  '.k
+00015180: 272c 206c 6162 656c 3d27 6461 7461 2729  ', label='data')
+00015190: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
+000151a0: 2e6c 6567 656e 6428 290a 2020 2020 2020  .legend().      
+000151b0: 2020 2020 2020 6178 312e 7365 745f 786c        ax1.set_xl
+000151c0: 696d 2861 7831 5f78 6c69 6d29 0a20 2020  im(ax1_xlim).   
+000151d0: 2020 2020 2020 2020 2061 7832 2e73 6574           ax2.set
+000151e0: 5f78 6c69 6d28 6178 325f 786c 696d 290a  _xlim(ax2_xlim).
+000151f0: 0a0a 0a0a 0a0a 2020 2020 2020 2020 2020  ......          
+00015200: 2020 6966 2063 6f6e 6669 6731 2e66 6974    if config1.fit
+00015210: 5f67 6175 7373 2069 7320 6e6f 7420 4661  _gauss is not Fa
+00015220: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00015230: 2020 2020 2061 7832 2e70 6c6f 7428 785f       ax2.plot(x_
+00015240: 6c69 6e2c 2063 6f6d 706f 6e65 6e74 732e  lin, components.
+00015250: 6765 7428 2762 6b67 5f27 292c 2027 2e63  get('bkg_'), '.c
+00015260: 272c 6c69 6e65 7769 6474 683d 322c 2020  ',linewidth=2,  
+00015270: 6c61 6265 6c3d 2747 6175 7373 6961 6e20  label='Gaussian 
+00015280: 6263 6b27 290a 2020 2020 2020 2020 2020  bck').          
+00015290: 2020 6178 322e 706c 6f74 2878 5f6c 696e    ax2.plot(x_lin
+000152a0: 2c20 636f 6d70 6f6e 656e 7473 2e67 6574  , components.get
+000152b0: 2827 6c7a 315f 2729 2c20 272d 6227 2c20  ('lz1_'), '-b', 
+000152c0: 6c69 6e65 7769 6474 683d 322c 206c 6162  linewidth=2, lab
+000152d0: 656c 3d27 5065 616b 3127 290a 2020 2020  el='Peak1').    
+000152e0: 2020 2020 2020 2020 6178 322e 706c 6f74          ax2.plot
+000152f0: 2878 6461 742c 2079 6461 742c 2027 2e6b  (xdat, ydat, '.k
+00015300: 2729 0a0a 0a20 2020 2020 2020 2023 6178  ')...        #ax
+00015310: 322e 706c 6f74 2878 6461 742c 2072 6573  2.plot(xdat, res
+00015320: 756c 742e 6265 7374 5f66 6974 2c20 272d  ult.best_fit, '-
+00015330: 6727 2c20 6c61 6265 6c3d 2762 6573 7420  g', label='best 
+00015340: 6669 7427 290a 0a20 2020 2020 2020 2020  fit')..         
+00015350: 2020 2066 6974 7370 616e 3d6d 6178 2879     fitspan=max(y
+00015360: 5f62 6573 745f 6669 7429 2d6d 696e 2879  _best_fit)-min(y
+00015370: 5f62 6573 745f 6669 7429 0a20 2020 2020  _best_fit).     
+00015380: 2020 2020 2020 2061 7832 2e73 6574 5f79         ax2.set_y
+00015390: 6c69 6d28 5b6d 696e 2879 5f62 6573 745f  lim([min(y_best_
+000153a0: 6669 7429 2d66 6974 7370 616e 2f35 2c20  fit)-fitspan/5, 
+000153b0: 6d61 7828 795f 6265 7374 5f66 6974 292b  max(y_best_fit)+
+000153c0: 6669 7473 7061 6e2f 355d 290a 0a0a 2020  fitspan/5])...  
+000153d0: 2020 2020 2020 2020 2020 6178 312e 7365            ax1.se
+000153e0: 745f 796c 6162 656c 2827 496e 7465 6e73  t_ylabel('Intens
+000153f0: 6974 7927 290a 2020 2020 2020 2020 2020  ity').          
+00015400: 2020 6178 312e 7365 745f 786c 6162 656c    ax1.set_xlabel
+00015410: 2827 5761 7665 6e75 6d62 6572 2729 0a20  ('Wavenumber'). 
+00015420: 2020 2020 2020 2020 2020 2061 7832 2e73             ax2.s
+00015430: 6574 5f79 6c61 6265 6c28 2749 6e74 656e  et_ylabel('Inten
+00015440: 7369 7479 2729 0a20 2020 2020 2020 2020  sity').         
+00015450: 2020 2061 7832 2e73 6574 5f78 6c61 6265     ax2.set_xlabe
+00015460: 6c28 2757 6176 656e 756d 6265 7227 290a  l('Wavenumber').
+00015470: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00015480: 2066 6974 5f70 6561 6b73 3e31 3a0a 2020   fit_peaks>1:.  
+00015490: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+000154a0: 322e 706c 6f74 2878 5f6c 696e 2c20 636f  2.plot(x_lin, co
+000154b0: 6d70 6f6e 656e 7473 2e67 6574 2827 6c7a  mponents.get('lz
+000154c0: 325f 2729 2c20 272d 7227 2c20 6c69 6e65  2_'), '-r', line
+000154d0: 7769 6474 683d 322c 206c 6162 656c 3d27  width=2, label='
+000154e0: 5065 616b 3227 290a 0a20 2020 2020 2020  Peak2')..       
+000154f0: 2020 2020 2069 6620 6669 745f 7065 616b       if fit_peak
+00015500: 733e 323a 0a20 2020 2020 2020 2020 2020  s>2:.           
+00015510: 2020 2020 2061 7832 2e70 6c6f 7428 785f       ax2.plot(x_
+00015520: 6c69 6e2c 2063 6f6d 706f 6e65 6e74 732e  lin, components.
+00015530: 6765 7428 276c 7a33 5f27 292c 2027 2d6d  get('lz3_'), '-m
+00015540: 272c 206c 696e 6577 6964 7468 3d32 2c20  ', linewidth=2, 
+00015550: 6c61 6265 6c3d 2750 6561 6b33 2729 0a20  label='Peak3'). 
+00015560: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
+00015570: 6c65 6e28 7065 616b 5f70 6f73 5f76 6f69  len(peak_pos_voi
+00015580: 6774 293e 313a 0a20 2020 2020 2020 2020  gt)>1:.         
+00015590: 2020 2023 2020 2020 206c 6f77 6572 7065     #     lowerpe
+000155a0: 616b 3d6e 702e 6d69 6e28 5b50 6561 6b31  ak=np.min([Peak1
+000155b0: 5f43 656e 742c 2050 6561 6b32 5f43 656e  _Cent, Peak2_Cen
+000155c0: 745d 290a 2020 2020 2020 2020 2020 2020  t]).            
+000155d0: 2320 2020 2020 7570 7065 7270 6561 6b3d  #     upperpeak=
+000155e0: 6e70 2e6d 6178 285b 5065 616b 315f 4365  np.max([Peak1_Ce
+000155f0: 6e74 2c20 5065 616b 325f 4365 6e74 5d29  nt, Peak2_Cent])
+00015600: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+00015610: 2020 2061 7831 2e73 6574 5f78 6c69 6d28     ax1.set_xlim(
+00015620: 5b6c 6f77 6572 7065 616b 2d31 352c 2075  [lowerpeak-15, u
+00015630: 7070 6572 7065 616b 2b31 355d 290a 2020  pperpeak+15]).  
+00015640: 2020 2020 2020 2020 2020 2320 6966 206c            # if l
+00015650: 656e 2870 6561 6b5f 706f 735f 766f 6967  en(peak_pos_voig
+00015660: 7429 3e31 3a0a 2020 2020 2020 2020 2020  t)>1:.          
+00015670: 2020 2320 2020 2020 6178 322e 7365 745f    #     ax2.set_
+00015680: 786c 696d 285b 6c6f 7765 7270 6561 6b2d  xlim([lowerpeak-
+00015690: 3230 2c20 7570 7065 7270 6561 6b2b 3230  20, upperpeak+20
+000156a0: 5d29 0a0a 2020 2020 2020 2020 2020 2020  ])..            
+000156b0: 6178 322e 6c65 6765 6e64 2829 0a0a 2020  ax2.legend()..  
+000156c0: 2020 2020 2020 2020 2020 7061 7468 333d            path3=
+000156d0: 7061 7468 2b27 2f27 2b27 6469 6164 5f66  path+'/'+'diad_f
+000156e0: 6974 5f69 6d61 6765 7327 0a20 2020 2020  it_images'.     
+000156f0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+00015700: 682e 6578 6973 7473 2870 6174 6833 293a  h.exists(path3):
+00015710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015720: 206f 7574 3d27 7061 7468 2065 7869 7374   out='path exist
+00015730: 7327 0a20 2020 2020 2020 2020 2020 2065  s'.            e
+00015740: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00015750: 2020 2020 206f 732e 6d61 6b65 6469 7273       os.makedirs
+00015760: 2870 6174 682b 272f 272b 2027 6469 6164  (path+'/'+ 'diad
+00015770: 5f66 6974 5f69 6d61 6765 7327 2c20 6578  _fit_images', ex
+00015780: 6973 745f 6f6b 3d46 616c 7365 290a 0a0a  ist_ok=False)...
+00015790: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+000157a0: 3d66 696c 656e 616d 652e 7273 706c 6974  =filename.rsplit
+000157b0: 2827 2e74 7874 272c 2031 295b 305d 0a20  ('.txt', 1)[0]. 
+000157c0: 2020 2020 2020 2020 2020 2066 6967 2e73             fig.s
+000157d0: 6176 6566 6967 2870 6174 6833 2b27 2f27  avefig(path3+'/'
+000157e0: 2b27 4469 6164 315f 4669 745f 7b7d 2e70  +'Diad1_Fit_{}.p
+000157f0: 6e67 272e 666f 726d 6174 2866 696c 6529  ng'.format(file)
+00015800: 2c20 6470 693d 6470 6929 0a0a 0a0a 0a20  , dpi=dpi)..... 
+00015810: 2020 2020 2020 2062 6573 745f 6669 743d         best_fit=
+00015820: 7265 7375 6c74 2e62 6573 745f 6669 740a  result.best_fit.
+00015830: 0a20 2020 2020 2020 2064 665f 6f75 745b  .        df_out[
+00015840: 2744 6961 6431 5f72 6566 6974 275d 3d72  'Diad1_refit']=r
+00015850: 6566 6974 5f70 6172 616d 0a0a 2020 2020  efit_param..    
+00015860: 2020 2020 2320 4669 6e61 6c20 6368 6563      # Final chec
+00015870: 6b20 2d20 7468 6174 2047 6175 7373 6961  k - that Gaussia
+00015880: 6e20 6973 6e74 2061 6e79 7768 6572 6520  n isnt anywhere 
+00015890: 6e65 6172 2074 6865 2068 6569 6768 7420  near the height 
+000158a0: 6f66 2074 6865 2064 6961 640a 0a0a 2020  of the diad...  
+000158b0: 2020 6466 5f6f 7574 3d64 665f 6f75 742e    df_out=df_out.
+000158c0: 6669 6c6c 6e61 2830 290a 0a20 2020 2072  fillna(0)..    r
+000158d0: 6574 7572 6e20 7265 7375 6c74 2c20 6466  eturn result, df
+000158e0: 5f6f 7574 2c20 795f 6265 7374 5f66 6974  _out, y_best_fit
+000158f0: 2c20 785f 6c69 6e2c 2063 6f6d 706f 6e65  , x_lin, compone
+00015900: 6e74 732c 2078 6461 742c 2079 6461 742c  nts, xdat, ydat,
+00015910: 2061 7831 5f78 6c69 6d2c 2061 7832 5f78   ax1_xlim, ax2_x
+00015920: 6c69 6d2c 2072 6573 6964 7561 6c5f 6469  lim, residual_di
+00015930: 6164 5f63 6f6f 7264 732c 2079 6461 745f  ad_coords, ydat_
+00015940: 696e 7261 6e67 652c 2020 7864 6174 5f69  inrange,  xdat_i
+00015950: 6e72 616e 6765 0a0a 0a0a 6465 6620 6669  nrange....def fi
+00015960: 745f 6469 6164 5f32 5f77 5f62 636b 282a  t_diad_2_w_bck(*
+00015970: 2c20 636f 6e66 6967 313a 2064 6961 6432  , config1: diad2
+00015980: 5f66 6974 5f63 6f6e 6669 673d 6469 6164  _fit_config=diad
+00015990: 325f 6669 745f 636f 6e66 6967 2829 2c20  2_fit_config(), 
+000159a0: 636f 6e66 6967 323a 2064 6961 645f 6964  config2: diad_id
+000159b0: 5f63 6f6e 6669 673d 6469 6164 5f69 645f  _config=diad_id_
+000159c0: 636f 6e66 6967 2829 2c0a 2020 2020 7061  config(),.    pa
+000159d0: 7468 3d4e 6f6e 652c 2066 696c 656e 616d  th=None, filenam
+000159e0: 653d 4e6f 6e65 2c20 7065 616b 5f70 6f73  e=None, peak_pos
+000159f0: 5f76 6f69 6774 3d4e 6f6e 652c 6669 6c65  _voigt=None,file
+00015a00: 7479 7065 3d4e 6f6e 652c 2064 6961 645f  type=None, diad_
+00015a10: 6172 7261 793d 4e6f 6e65 2c0a 2020 2020  array=None,.    
+00015a20: 706c 6f74 5f66 6967 7572 653d 5472 7565  plot_figure=True
+00015a30: 2c20 636c 6f73 655f 6669 6775 7265 3d46  , close_figure=F
+00015a40: 616c 7365 2c20 4469 6164 5f70 6f73 3d4e  alse, Diad_pos=N
+00015a50: 6f6e 652c 2048 425f 706f 733d 4e6f 6e65  one, HB_pos=None
+00015a60: 2c20 4331 335f 706f 733d 4e6f 6e65 293a  , C13_pos=None):
+00015a70: 0a20 2020 2022 2222 2054 6869 7320 6675  .    """ This fu
+00015a80: 6e63 7469 6f6e 2066 6974 7320 7468 6520  nction fits the 
+00015a90: 6261 636b 6772 6f75 6e64 2028 7573 696e  background (usin
+00015aa0: 6720 7468 6520 6675 6e63 7469 6f6e 2072  g the function r
+00015ab0: 656d 6f76 655f 6469 6164 5f62 6173 656c  emove_diad_basel
+00015ac0: 696e 6529 2061 6e64 2074 6865 6e0a 2020  ine) and then.  
+00015ad0: 2020 6669 7473 2074 6865 2070 6561 6b73    fits the peaks
+00015ae0: 2075 7369 6e67 2066 6974 5f67 6175 7373   using fit_gauss
+00015af0: 6961 6e5f 766f 6967 745f 6765 6e65 7269  ian_voigt_generi
+00015b00: 635f 6469 6164 2829 0a20 2020 2049 7420  c_diad().    It 
+00015b10: 7468 656e 2063 6865 636b 7320 6966 2061  then checks if a
+00015b20: 6e79 2070 6172 616d 6574 6572 7320 6172  ny parameters ar
+00015b30: 6520 7269 6768 7420 6174 2074 6865 2070  e right at the p
+00015b40: 6572 6d69 7474 6564 2065 6467 6520 286d  ermitted edge (m
+00015b50: 6561 6e69 6e67 2066 6974 7469 6e67 2064  eaning fitting d
+00015b60: 6964 6e74 2063 6f6e 7665 7267 6529 2c0a  idnt converge),.
+00015b70: 2020 2020 616e 6420 7472 6965 7320 6669      and tries fi
+00015b80: 7474 696e 6720 6966 2073 6f2e 2054 6865  tting if so. The
+00015b90: 6e20 6974 206d 616b 6573 2061 2070 6c6f  n it makes a plo
+00015ba0: 740a 2020 2020 6f66 2074 6865 2076 6172  t.    of the var
+00015bb0: 696f 7573 2070 6172 7473 206f 6620 7468  ious parts of th
+00015bc0: 6520 6669 7474 696e 6720 7072 6f63 6564  e fitting proced
+00015bd0: 7572 652c 2061 6e64 2072 6574 7572 6e73  ure, and returns
+00015be0: 2061 2064 6174 6166 7261 6d65 206f 6620   a dataframe of 
+00015bf0: 7468 6520 6669 7420 7061 7261 6d65 7465  the fit paramete
+00015c00: 7273 2e0a 0a0a 2020 2020 5061 7261 6d65  rs....    Parame
+00015c10: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+00015c20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 0a20 2020  -----------..   
+00015c30: 2064 6961 645f 6964 5f63 6f6e 6669 6728   diad_id_config(
+00015c40: 290a 2020 2020 2020 2020 4461 7461 636c  ).        Datacl
+00015c50: 6173 7320 6f66 2070 6172 616d 6574 6572  ass of parameter
+00015c60: 7320 7573 6564 2074 6f20 6c6f 6f6b 2066  s used to look f
+00015c70: 6f72 2070 6561 6b73 2e20 5573 6573 2061  or peaks. Uses a
+00015c80: 6e79 2065 7863 6c75 6465 6420 7261 6e67  ny excluded rang
+00015c90: 6573 2066 726f 6d20 7468 6973 2e0a 0a20  es from this... 
+00015ca0: 2020 2064 6961 6432 5f66 6974 5f63 6f6e     diad2_fit_con
+00015cb0: 6669 6728 290a 2020 2020 2020 2020 4461  fig().        Da
+00015cc0: 7461 636c 6173 7320 6f66 2070 6172 616d  taclass of param
+00015cd0: 6574 6572 7320 7573 6564 2074 6f20 6669  eters used to fi
+00015ce0: 6e64 2070 6561 6b73 2e20 5573 6520 6865  nd peaks. Use he
+00015cf0: 6c70 206f 6e20 7468 6973 2064 6174 6163  lp on this datac
+00015d00: 6c61 7373 2074 6f20 6765 7420 6f70 7469  lass to get opti
+00015d10: 6f6e 732e 0a0a 2020 2020 7061 7468 3a20  ons...    path: 
+00015d20: 7374 720a 2020 2020 2020 2020 466f 6c64  str.        Fold
+00015d30: 6572 2075 7365 7220 7769 7368 6573 2074  er user wishes t
+00015d40: 6f20 7265 6164 2064 6174 6120 6672 6f6d  o read data from
+00015d50: 0a0a 2020 2020 6669 6c65 6e61 6d65 3a20  ..    filename: 
+00015d60: 7374 720a 2020 2020 2020 2020 5370 6563  str.        Spec
+00015d70: 6966 6963 206e 616d 6520 6f66 2066 696c  ific name of fil
+00015d80: 6520 6265 696e 6720 7573 6564 2e0a 0a20  e being used... 
+00015d90: 2020 2066 696c 6574 7970 653a 2073 7472     filetype: str
+00015da0: 0a20 2020 2020 2020 2049 6465 6e74 6966  .        Identif
+00015db0: 6965 7320 7479 7065 206f 6620 6669 6c65  ies type of file
+00015dc0: 2e20 6368 6f6f 7365 2066 726f 6d20 2757  . choose from 'W
+00015dd0: 6974 6563 5f41 5343 4949 272c 2027 6865  itec_ASCII', 'he
+00015de0: 6164 6c65 7373 5f74 7874 272c 2027 6865  adless_txt', 'he
+00015df0: 6164 6c65 7373 5f63 7376 272c 2027 6865  adless_csv', 'he
+00015e00: 6164 5f63 7376 272c 2027 5769 7465 635f  ad_csv', 'Witec_
+00015e10: 4153 4349 4927 2c0a 2020 2020 2020 2020  ASCII',.        
+00015e20: 2748 4f52 4942 415f 7478 7427 2c20 2752  'HORIBA_txt', 'R
+00015e30: 656e 6973 6861 775f 7478 7427 0a0a 2020  enishaw_txt'..  
+00015e40: 2020 706c 6f74 5f66 6967 7572 653a 2062    plot_figure: b
+00015e50: 6f6f 6c0a 2020 2020 2020 2020 6966 2054  ool.        if T
+00015e60: 7275 652c 2073 6176 6573 2066 6967 7572  rue, saves figur
+00015e70: 650a 0a20 2020 2063 6c6f 7365 5f66 6967  e..    close_fig
+00015e80: 3a20 626f 6f6c 0a20 2020 2020 2020 2069  : bool.        i
+00015e90: 6620 5472 7565 2c20 6469 7370 6c61 7973  f True, displays
+00015ea0: 2066 6967 7572 6520 696e 204e 6f74 6562   figure in Noteb
+00015eb0: 6f6f 6b2e 2049 6620 4661 6c73 652c 2063  ook. If False, c
+00015ec0: 6c6f 7365 7320 6974 2028 796f 7520 6361  loses it (you ca
+00015ed0: 6e20 7374 696c 6c20 6669 6e64 2069 7420  n still find it 
+00015ee0: 7361 7665 6429 0a0a 2020 2020 4469 6164  saved)..    Diad
+00015ef0: 5f70 6f73 3a20 666c 6f61 740a 2020 2020  _pos: float.    
+00015f00: 2020 2020 4573 7469 6d61 7465 206f 6620      Estimate of 
+00015f10: 6469 6164 2070 6561 6b20 706f 7369 7469  diad peak positi
+00015f20: 6f6e 0a0a 2020 2020 4842 5f70 6f73 3a20  on..    HB_pos: 
+00015f30: 666c 6f61 740a 2020 2020 2020 2020 4573  float.        Es
+00015f40: 7469 6d61 7465 206f 6620 4842 2070 6561  timate of HB pea
+00015f50: 6b20 706f 7369 7469 6f6e 0a0a 2020 2020  k position..    
+00015f60: 4331 335f 706f 733a 2066 6c6f 6174 0a20  C13_pos: float. 
+00015f70: 2020 2020 2020 2045 7374 696d 6174 6520         Estimate 
+00015f80: 6f66 2043 3133 2070 6561 6b20 706f 7369  of C13 peak posi
+00015f90: 7469 6f6e 0a0a 0a20 2020 2052 6574 7572  tion...    Retur
+00015fa0: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  ns.    ---------
+00015fb0: 2d2d 2d0a 2020 2020 6966 2072 6574 7572  ---.    if retur
+00015fc0: 6e5f 6f74 6865 725f 7061 7261 6d73 2069  n_other_params i
+00015fd0: 7320 4661 6c73 6520 2864 6566 6175 6c74  s False (default
+00015fe0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00015ff0: 7320 6120 6461 7461 6672 616d 6520 6f66  s a dataframe of
+00016000: 2070 6561 6b20 7061 7261 6d65 7465 7273   peak parameters
+00016010: 0a20 2020 2069 6620 5472 7565 2c20 616c  .    if True, al
+00016020: 736f 2072 6574 7572 6e73 3a0a 2020 2020  so returns:.    
+00016030: 2020 2020 2020 2020 7265 7375 6c74 3a20          result: 
+00016040: 6669 7420 7061 7261 6d65 7465 7273 0a20  fit parameters. 
+00016050: 2020 2020 2020 2020 2020 2079 5f62 6573             y_bes
+00016060: 745f 6669 743a 2062 6573 7420 6669 7420  t_fit: best fit 
+00016070: 746f 2061 6c6c 2063 7572 7665 7320 696e  to all curves in
+00016080: 2079 0a20 2020 2020 2020 2020 2020 2078   y.            x
+00016090: 5f6c 696e 3a20 6c69 6e73 7061 6365 206f  _lin: linspace o
+000160a0: 6620 6265 7374 2066 6974 2063 6f6f 7264  f best fit coord
+000160b0: 696e 6174 6573 2069 6e20 782e 0a0a 0a0a  inates in x.....
+000160c0: 0a0a 2020 2020 2222 220a 2020 2020 6966  ..    """.    if
+000160d0: 2027 4352 5227 2069 6e20 6669 6c65 6e61   'CRR' in filena
+000160e0: 6d65 3a0a 2020 2020 2020 2020 6669 6c65  me:.        file
+000160f0: 7479 7065 3d27 6865 6164 6c65 7373 5f74  type='headless_t
+00016100: 7874 270a 0a20 2020 206d 6f64 656c 3d63  xt'..    model=c
+00016110: 6f6e 6669 6731 2e6d 6f64 656c 5f6e 616d  onfig1.model_nam
+00016120: 650a 0a20 2020 2069 6620 6d6f 6465 6c20  e..    if model 
+00016130: 6e6f 7420 696e 2061 6c6c 6f77 6564 5f6d  not in allowed_m
+00016140: 6f64 656c 733a 0a20 2020 2020 2020 2072  odels:.        r
+00016150: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00016160: 6622 556e 7375 7070 6f72 7465 6420 6d6f  f"Unsupported mo
+00016170: 6465 6c3a 207b 6d6f 6465 6c7d 2e20 5375  del: {model}. Su
+00016180: 7070 6f72 7465 6420 6d6f 6465 6c73 2061  pported models a
+00016190: 7265 3a20 7b27 2c20 272e 6a6f 696e 2861  re: {', '.join(a
+000161a0: 6c6c 6f77 6564 5f6d 6f64 656c 7329 7d22  llowed_models)}"
+000161b0: 290a 0a0a 0a20 2020 2023 2043 6865 636b  )....    # Check
+000161c0: 206e 756d 6265 7220 6f66 2070 6561 6b73   number of peaks
+000161d0: 206d 616b 6573 2073 656e 7365 0a20 2020   makes sense.   
+000161e0: 2066 6974 5f70 6561 6b73 3d63 6f6e 6669   fit_peaks=confi
+000161f0: 6731 2e66 6974 5f70 6561 6b73 0a20 2020  g1.fit_peaks.   
+00016200: 2069 6620 6469 6164 5f61 7272 6179 2069   if diad_array i
+00016210: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00016220: 4469 6164 5f64 663d 6765 745f 6461 7461  Diad_df=get_data
+00016230: 2870 6174 683d 7061 7468 2c20 6669 6c65  (path=path, file
+00016240: 6e61 6d65 3d66 696c 656e 616d 652c 2066  name=filename, f
+00016250: 696c 6574 7970 653d 6669 6c65 7479 7065  iletype=filetype
+00016260: 290a 2020 2020 2020 2020 4469 6164 3d6e  ).        Diad=n
+00016270: 702e 6172 7261 7928 4469 6164 5f64 6629  p.array(Diad_df)
+00016280: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00016290: 2020 2044 6961 643d 6469 6164 5f61 7272     Diad=diad_arr
+000162a0: 6179 0a0a 0a20 2020 2069 6620 6669 745f  ay...    if fit_
+000162b0: 7065 616b 733d 3d32 3a0a 2020 2020 2020  peaks==2:.      
+000162c0: 2020 6966 206e 702e 6973 6e61 6e28 4842    if np.isnan(HB
+000162d0: 5f70 6f73 293d 3d54 7275 6520 6f72 2063  _pos)==True or c
+000162e0: 6f6e 6669 6731 2e48 425f 7072 6f6d 3c30  onfig1.HB_prom<0
+000162f0: 3a0a 2020 2020 2020 2020 2020 2020 6669  :.            fi
+00016300: 745f 7065 616b 733d 310a 2020 2020 2020  t_peaks=1.      
+00016310: 2020 2020 2020 6669 745f 6761 7573 733d        fit_gauss=
+00016320: 4661 6c73 650a 0a0a 0a20 2020 2069 6620  False....    if 
+00016330: 6669 745f 7065 616b 733d 3d33 3a0a 2020  fit_peaks==3:.  
+00016340: 2020 2020 2020 2320 5468 6973 2074 6573        # This tes
+00016350: 7473 2069 6620 4842 2069 7320 4e61 6e20  ts if HB is Nan 
+00016360: 616e 6420 4331 3320 6973 204e 616e 0a20  and C13 is Nan. 
+00016370: 2020 2020 2020 2069 6620 6e70 2e69 736e         if np.isn
+00016380: 616e 2848 425f 706f 7329 3d3d 5472 7565  an(HB_pos)==True
+00016390: 2061 6e64 206e 702e 6973 6e61 6e28 4331   and np.isnan(C1
+000163a0: 335f 706f 7329 3d3d 5472 7565 3a0a 2020  3_pos)==True:.  
+000163b0: 2020 2020 2020 2020 2020 6669 745f 7065            fit_pe
+000163c0: 616b 733d 310a 2020 2020 2020 2020 2020  aks=1.          
+000163d0: 2020 6669 745f 6761 7573 733d 4661 6c73    fit_gauss=Fals
+000163e0: 650a 2020 2020 2020 2020 2320 4966 206f  e.        # If o
+000163f0: 6e6c 7920 4842 2069 7320 4e61 6e2c 206c  nly HB is Nan, l
+00016400: 6574 7320 696e 7374 6561 6420 616c 6c6f  ets instead allo
+00016410: 6361 7465 2061 2048 4220 706f 7369 746f  cate a HB posito
+00016420: 696e 2e0a 2020 2020 2020 2020 656c 6966  in..        elif
+00016430: 206e 702e 6973 6e61 6e28 4842 5f70 6f73   np.isnan(HB_pos
+00016440: 293a 0a20 2020 2020 2020 2020 2020 2048  ):.            H
+00016450: 425f 7265 6769 6f6e 3d5b 4469 6164 5f70  B_region=[Diad_p
+00016460: 6f73 2b31 392c 2044 6961 645f 706f 732b  os+19, Diad_pos+
+00016470: 3233 5d0a 2020 2020 2020 2020 2020 2020  23].            
+00016480: 6669 6c74 6572 3d28 4469 6164 5b3a 2c20  filter=(Diad[:, 
+00016490: 305d 3e3d 4842 5f72 6567 696f 6e5b 305d  0]>=HB_region[0]
+000164a0: 2926 2028 4469 6164 5b3a 2c30 5d3c 3d48  )& (Diad[:,0]<=H
+000164b0: 425f 7265 6769 6f6e 5b31 5d29 0a20 2020  B_region[1]).   
+000164c0: 2020 2020 2020 2020 2054 7269 6d44 6961           TrimDia
+000164d0: 643d 4469 6164 5b66 696c 7465 725d 0a20  d=Diad[filter]. 
+000164e0: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+000164f0: 7232 3d28 4469 6164 5b3a 2c20 305d 3e3d  r2=(Diad[:, 0]>=
+00016500: 2848 425f 7265 6769 6f6e 5b30 5d2d 3529  (HB_region[0]-5)
+00016510: 2926 2028 4469 6164 5b3a 2c30 5d3c 3d28  )& (Diad[:,0]<=(
+00016520: 4842 5f72 6567 696f 6e5b 315d 2b35 2929  HB_region[1]+5))
+00016530: 0a20 2020 2020 2020 2020 2020 2054 7269  .            Tri
+00016540: 6d44 6961 6432 3d44 6961 645b 6669 6c74  mDiad2=Diad[filt
+00016550: 6572 325d 0a20 2020 2020 2020 2020 2020  er2].           
+00016560: 206d 6178 793d 6e70 2e6d 6178 2854 7269   maxy=np.max(Tri
+00016570: 6d44 6961 645b 3a2c 2031 5d29 0a20 2020  mDiad[:, 1]).   
+00016580: 2020 2020 2020 2020 206d 6178 783d 5472           maxx=Tr
+00016590: 696d 4469 6164 5b54 7269 6d44 6961 645b  imDiad[TrimDiad[
+000165a0: 3a2c 2031 5d3d 3d6d 6178 795d 0a20 2020  :, 1]==maxy].   
+000165b0: 2020 2020 2020 2020 2048 425f 706f 733d           HB_pos=
+000165c0: 666c 6f61 7428 6d61 7878 5b3a 2c20 305d  float(maxx[:, 0]
+000165d0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+000165e0: 206d 696e 793d 6e70 2e6d 696e 2854 7269   miny=np.min(Tri
+000165f0: 6d44 6961 6432 5b3a 2c20 315d 290a 2020  mDiad2[:, 1]).  
+00016600: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+00016610: 312e 4842 5f70 726f 6d3d 6d61 7879 2d6d  1.HB_prom=maxy-m
+00016620: 696e 790a 2020 2020 2020 2020 2020 2020  iny.            
+00016630: 636f 6e66 6967 312e 6761 7573 735f 616d  config1.gauss_am
+00016640: 703d 322a 286d 6178 792d 6d69 6e79 290a  p=2*(maxy-miny).
+00016650: 0a0a 0a0a 2020 2020 2020 2020 2320 4966  ....        # If
+00016660: 206e 6f20 4331 332c 2072 6564 7563 6520   no C13, reduce 
+00016670: 6669 7420 7065 616b 7320 746f 2032 2e0a  fit peaks to 2..
+00016680: 2020 2020 2020 2020 656c 6966 206e 702e          elif np.
+00016690: 6973 6e61 6e28 4331 335f 706f 7329 3d3d  isnan(C13_pos)==
+000166a0: 5472 7565 206f 7220 636f 6e66 6967 312e  True or config1.
+000166b0: 4331 335f 7072 6f6d 3c31 303a 0a20 2020  C13_prom<10:.   
+000166c0: 2020 2020 2020 2020 2066 6974 5f70 6561           fit_pea
+000166d0: 6b73 3d32 0a0a 0a0a 2020 2020 2320 4669  ks=2....    # Fi
+000166e0: 7273 742c 2077 6520 6665 6564 2064 6174  rst, we feed dat
+000166f0: 6120 696e 746f 2074 6865 2072 656d 6f76  a into the remov
+00016700: 6520 6261 7365 6c69 6e65 2066 756e 6374  e baseline funct
+00016710: 696f 6e2c 2077 6869 6368 2072 6574 7572  ion, which retur
+00016720: 6e73 2063 6f72 7265 6374 6564 2064 6174  ns corrected dat
+00016730: 610a 0a20 2020 2079 5f63 6f72 725f 6469  a..    y_corr_di
+00016740: 6164 322c 2050 795f 6261 7365 5f64 6961  ad2, Py_base_dia
+00016750: 6432 2c20 785f 6469 6164 322c 2020 4469  d2, x_diad2,  Di
+00016760: 6164 5f73 686f 7274 5f64 6961 6432 2c20  ad_short_diad2, 
+00016770: 5079 5f62 6173 655f 6469 6164 322c 2050  Py_base_diad2, P
+00016780: 665f 6261 7365 6c69 6e65 5f64 6961 6432  f_baseline_diad2
+00016790: 2c20 2042 6173 656c 696e 655f 7973 7562  ,  Baseline_ysub
+000167a0: 5f64 6961 6432 2c20 4261 7365 6c69 6e65  _diad2, Baseline
+000167b0: 5f78 5f64 6961 6432 2c20 4261 7365 6c69  _x_diad2, Baseli
+000167c0: 6e65 5f64 6961 6432 2c20 7370 616e 5f64  ne_diad2, span_d
+000167d0: 6961 6432 3d72 656d 6f76 655f 6469 6164  iad2=remove_diad
+000167e0: 5f62 6173 656c 696e 6528 0a20 2020 7061  _baseline(.   pa
+000167f0: 7468 3d70 6174 682c 2066 696c 656e 616d  th=path, filenam
+00016800: 653d 6669 6c65 6e61 6d65 2c20 6669 6c65  e=filename, file
+00016810: 7479 7065 3d66 696c 6574 7970 652c 2065  type=filetype, e
+00016820: 7863 6c75 6465 5f72 616e 6765 313d 636f  xclude_range1=co
+00016830: 6e66 6967 322e 6578 636c 7564 655f 7261  nfig2.exclude_ra
+00016840: 6e67 6531 2c20 6578 636c 7564 655f 7261  nge1, exclude_ra
+00016850: 6e67 6532 3d63 6f6e 6669 6732 2e65 7863  nge2=config2.exc
+00016860: 6c75 6465 5f72 616e 6765 322c 204e 5f70  lude_range2, N_p
+00016870: 6f6c 793d 636f 6e66 6967 312e 4e5f 706f  oly=config1.N_po
+00016880: 6c79 5f62 636b 5f64 6961 6432 2c0a 2020  ly_bck_diad2,.  
+00016890: 2020 6c6f 7765 725f 6263 6b3d 636f 6e66    lower_bck=conf
+000168a0: 6967 312e 6c6f 7765 725f 6263 6b5f 6469  ig1.lower_bck_di
+000168b0: 6164 322c 2075 7070 6572 5f62 636b 3d63  ad2, upper_bck=c
+000168c0: 6f6e 6669 6731 2e75 7070 6572 5f62 636b  onfig1.upper_bck
+000168d0: 5f64 6961 6432 2c20 706c 6f74 5f66 6967  _diad2, plot_fig
+000168e0: 7572 653d 4661 6c73 652c 2064 6961 645f  ure=False, diad_
+000168f0: 6172 7261 793d 6469 6164 5f61 7272 6179  array=diad_array
+00016900: 290a 0a0a 0a0a 0a20 2020 2023 2054 6865  )......    # The
+00016910: 6e2c 2077 6520 6665 6564 2074 6869 7320  n, we feed this 
+00016920: 6261 7365 6c69 6e65 2d63 6f72 7265 6374  baseline-correct
+00016930: 6564 2064 6174 6120 696e 746f 2074 6865  ed data into the
+00016940: 2063 6f6d 6269 6e65 6420 6761 7573 7369   combined gaussi
+00016950: 616e 2d76 6f69 6774 2070 6561 6b20 6669  an-voigt peak fi
+00016960: 7474 696e 6720 6675 6e63 7469 6f6e 0a20  tting function. 
+00016970: 2020 2072 6573 756c 742c 2064 665f 6f75     result, df_ou
+00016980: 742c 2079 5f62 6573 745f 6669 742c 2078  t, y_best_fit, x
+00016990: 5f6c 696e 2c20 636f 6d70 6f6e 656e 7473  _lin, components
+000169a0: 2c20 7864 6174 2c20 7964 6174 2c20 6178  , xdat, ydat, ax
+000169b0: 315f 786c 696d 2c20 6178 325f 786c 696d  1_xlim, ax2_xlim
+000169c0: 2c72 6573 6964 7561 6c5f 6469 6164 5f63  ,residual_diad_c
+000169d0: 6f6f 7264 732c 2079 6461 745f 696e 7261  oords, ydat_inra
+000169e0: 6e67 652c 2020 7864 6174 5f69 6e72 616e  nge,  xdat_inran
+000169f0: 6765 3d66 6974 5f67 6175 7373 6961 6e5f  ge=fit_gaussian_
+00016a00: 766f 6967 745f 6765 6e65 7269 635f 6469  voigt_generic_di
+00016a10: 6164 2863 6f6e 6669 6731 2c20 6469 6164  ad(config1, diad
+00016a20: 323d 5472 7565 2c20 7061 7468 3d70 6174  2=True, path=pat
+00016a30: 682c 2066 696c 656e 616d 653d 6669 6c65  h, filename=file
+00016a40: 6e61 6d65 2c0a 2020 2020 7864 6174 3d78  name,.    xdat=x
+00016a50: 5f64 6961 6432 2c20 7964 6174 3d79 5f63  _diad2, ydat=y_c
+00016a60: 6f72 725f 6469 6164 322c 0a20 2020 2073  orr_diad2,.    s
+00016a70: 7061 6e3d 7370 616e 5f64 6961 6432 2c20  pan=span_diad2, 
+00016a80: 706c 6f74 5f66 6967 7572 653d 4661 6c73  plot_figure=Fals
+00016a90: 652c 2044 6961 645f 706f 733d 4469 6164  e, Diad_pos=Diad
+00016aa0: 5f70 6f73 2c20 4842 5f70 6f73 3d48 425f  _pos, HB_pos=HB_
+00016ab0: 706f 732c 2043 3133 5f70 6f73 3d43 3133  pos, C13_pos=C13
+00016ac0: 5f70 6f73 2c20 6669 745f 7065 616b 733d  _pos, fit_peaks=
+00016ad0: 6669 745f 7065 616b 7329 0a0a 2020 2020  fit_peaks)..    
+00016ae0: 6966 2061 6e79 2864 665f 6f75 745b 2744  if any(df_out['D
+00016af0: 6961 6432 5f72 6566 6974 275d 2e73 7472  iad2_refit'].str
+00016b00: 2e63 6f6e 7461 696e 7328 2742 656c 6f77  .contains('Below
+00016b10: 2074 6872 6573 686f 6c64 2069 6e74 656e   threshold inten
+00016b20: 7369 7479 2729 293a 0a20 2020 2020 2020  sity')):.       
+00016b30: 2070 7269 6e74 2827 6265 6c6f 7720 796f   print('below yo
+00016b40: 7572 2074 6872 6573 686f 6c64 2069 6e74  ur threshold int
+00016b50: 656e 7369 7479 2c20 7765 2068 6176 6520  ensity, we have 
+00016b60: 6669 6c6c 6564 2077 6974 6820 6e61 6e73  filled with nans
+00016b70: 2729 0a0a 0a20 2020 2065 6c73 653a 0a0a  ')...    else:..
+00016b80: 2020 2020 2020 2020 2320 5472 7920 5265          # Try Re
+00016b90: 6669 7474 696e 6720 6f6e 6365 0a20 2020  fitting once.   
+00016ba0: 2020 2020 2069 6620 7374 7228 6466 5f6f       if str(df_o
+00016bb0: 7574 5b27 4469 6164 325f 7265 6669 7427  ut['Diad2_refit'
+00016bc0: 5d2e 696c 6f63 5b30 5d29 213d 2746 6c61  ].iloc[0])!='Fla
+00016bd0: 6767 6564 2057 6172 6e69 6e67 733a 273a  gged Warnings:':
+00016be0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00016bf0: 6e74 2827 7265 6669 7420 6174 7465 6d70  nt('refit attemp
+00016c00: 7420 3127 290a 2020 2020 2020 2020 2020  t 1').          
+00016c10: 2020 6661 6374 6f72 3d32 0a0a 2020 2020    factor=2..    
+00016c20: 2020 2020 2020 2020 696d 706f 7274 2063          import c
+00016c30: 6f70 790a 2020 2020 2020 2020 2020 2020  opy.            
+00016c40: 636f 6e66 6967 5f74 7765 616b 6564 3d63  config_tweaked=c
+00016c50: 6f6e 6669 6731 0a20 2020 2020 2020 2020  onfig1.         
+00016c60: 2020 2063 6f6e 6669 675f 7477 6561 6b65     config_tweake
+00016c70: 643d 636f 7079 2e63 6f70 7928 636f 6e66  d=copy.copy(conf
+00016c80: 6967 3129 0a0a 2020 2020 2020 2020 2020  ig1)..          
+00016c90: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
+00016ca0: 2744 6961 6432 5f72 6566 6974 275d 2e73  'Diad2_refit'].s
+00016cb0: 7472 2e63 6f6e 7461 696e 7328 2720 4e6f  tr.contains(' No
+00016cc0: 2045 7272 6f72 2729 293a 0a20 2020 2020   Error')):.     
+00016cd0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+00016ce0: 745f 7065 616b 733e 313a 0a20 2020 2020  t_peaks>1:.     
+00016cf0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00016d00: 6974 5f70 6561 6b73 3d66 6974 5f70 6561  it_peaks=fit_pea
+00016d10: 6b73 2d31 0a0a 0a0a 0a20 2020 2020 2020  ks-1.....       
+00016d20: 2020 2020 2023 2069 6620 616e 7928 6466       # if any(df
+00016d30: 5f6f 7574 5b27 4469 6164 325f 7265 6669  _out['Diad2_refi
+00016d40: 7427 5d2e 7374 722e 636f 6e74 6169 6e73  t'].str.contains
+00016d50: 2827 565f 4869 6768 416d 7027 2929 3a0a  ('V_HighAmp')):.
+00016d60: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00016d70: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
+00016d80: 2e64 6961 645f 616d 706c 6974 7564 653d  .diad_amplitude=
+00016d90: 6361 6c63 5f64 6961 645f 616d 706c 6974  calc_diad_amplit
+00016da0: 7564 652f 3130 0a20 2020 2020 2020 2020  ude/10.         
+00016db0: 2020 2069 6620 616e 7928 6466 5f6f 7574     if any(df_out
+00016dc0: 5b27 4469 6164 325f 7265 6669 7427 5d2e  ['Diad2_refit'].
+00016dd0: 7374 722e 636f 6e74 6169 6e73 2827 565f  str.contains('V_
+00016de0: 5369 676d 615f 746f 6f5f 4c6f 7727 2929  Sigma_too_Low'))
+00016df0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016e00: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
+00016e10: 2e64 6961 645f 7369 676d 613d 636f 6e66  .diad_sigma=conf
+00016e20: 6967 312e 6469 6164 5f73 6967 6d61 2a66  ig1.diad_sigma*f
+00016e30: 6163 746f 720a 2020 2020 2020 2020 2020  actor.          
+00016e40: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
+00016e50: 2744 6961 6432 5f72 6566 6974 275d 2e73  'Diad2_refit'].s
+00016e60: 7472 2e63 6f6e 7461 696e 7328 2756 5f53  tr.contains('V_S
+00016e70: 6967 6d61 5f74 6f6f 5f48 6967 6827 2929  igma_too_High'))
+00016e80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016e90: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
+00016ea0: 2e64 6961 645f 7369 676d 613d 636f 6e66  .diad_sigma=conf
+00016eb0: 6967 312e 6469 6164 5f73 6967 6d61 2f66  ig1.diad_sigma/f
+00016ec0: 6163 746f 720a 2020 2020 2020 2020 2020  actor.          
+00016ed0: 2020 2320 4761 7573 7369 616e 2066 6974    # Gaussian fit
+00016ee0: 2062 6974 730a 2020 2020 2020 2020 2020   bits.          
+00016ef0: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
+00016f00: 2744 6961 6432 5f72 6566 6974 275d 2e73  'Diad2_refit'].s
+00016f10: 7472 2e63 6f6e 7461 696e 7328 2747 5f69  tr.contains('G_i
+00016f20: 6e70 7574 5f54 6f6f 4869 6768 5369 676d  nput_TooHighSigm
+00016f30: 6127 2929 3a0a 2020 2020 2020 2020 2020  a')):.          
+00016f40: 2020 2020 2020 636f 6e66 6967 5f74 7765        config_twe
+00016f50: 616b 6564 2e67 6175 7373 5f73 6967 6d61  aked.gauss_sigma
+00016f60: 3d63 6f6e 6669 6731 2e67 6175 7373 5f73  =config1.gauss_s
+00016f70: 6967 6d61 2f66 6163 746f 720a 2020 2020  igma/factor.    
+00016f80: 2020 2020 2020 2020 6966 2061 6e79 2864          if any(d
+00016f90: 665f 6f75 745b 2744 6961 6432 5f72 6566  f_out['Diad2_ref
+00016fa0: 6974 275d 2e73 7472 2e63 6f6e 7461 696e  it'].str.contain
+00016fb0: 7328 2747 5f69 6e70 7574 5f54 6f6f 4c6f  s('G_input_TooLo
+00016fc0: 7753 6967 6d61 2729 293a 0a20 2020 2020  wSigma')):.     
+00016fd0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00016fe0: 675f 7477 6561 6b65 642e 6761 7573 735f  g_tweaked.gauss_
+00016ff0: 7369 676d 613d 636f 6e66 6967 312e 6761  sigma=config1.ga
+00017000: 7573 735f 7369 676d 612a 6661 6374 6f72  uss_sigma*factor
+00017010: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00017020: 616e 7928 6466 5f6f 7574 5b27 4469 6164  any(df_out['Diad
+00017030: 325f 7265 6669 7427 5d2e 7374 722e 636f  2_refit'].str.co
+00017040: 6e74 6169 6e73 2827 475f 696e 7075 745f  ntains('G_input_
+00017050: 546f 6f4c 6f77 416d 7027 2929 3a0a 2020  TooLowAmp')):.  
+00017060: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00017070: 6e66 6967 5f74 7765 616b 6564 2e67 6175  nfig_tweaked.gau
+00017080: 7373 5f61 6d70 6c69 7475 6465 3d63 6f6e  ss_amplitude=con
+00017090: 6669 6731 2e67 6175 7373 5f61 6d70 2a66  fig1.gauss_amp*f
+000170a0: 6163 746f 720a 2020 2020 2020 2020 2020  actor.          
+000170b0: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
+000170c0: 2744 6961 6432 5f72 6566 6974 275d 2e73  'Diad2_refit'].s
+000170d0: 7472 2e63 6f6e 7461 696e 7328 2747 5f41  tr.contains('G_A
+000170e0: 6d70 5f74 6f6f 5f68 6967 6827 2929 3a0a  mp_too_high')):.
+000170f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017100: 636f 6e66 6967 5f74 7765 616b 6564 2e67  config_tweaked.g
+00017110: 6175 7373 5f61 6d70 6c69 7475 6465 3d63  auss_amplitude=c
+00017120: 6f6e 6669 6731 2e67 6175 7373 5f61 6d70  onfig1.gauss_amp
+00017130: 2f66 6163 746f 720a 2020 2020 2020 2020  /factor.        
+00017140: 2020 2020 6966 2061 6e79 2864 665f 6f75      if any(df_ou
+00017150: 745b 2744 6961 6432 5f72 6566 6974 275d  t['Diad2_refit']
+00017160: 2e73 7472 2e63 6f6e 7461 696e 7328 2747  .str.contains('G
+00017170: 5f68 6967 6865 725f 7468 616e 5f64 6961  _higher_than_dia
+00017180: 6427 2929 3a0a 2020 2020 2020 2020 2020  d')):.          
+00017190: 2020 2020 2020 636f 6e66 6967 5f74 7765        config_twe
+000171a0: 616b 6564 2e67 6175 7373 5f61 6d70 6c69  aked.gauss_ampli
+000171b0: 7475 6465 3d63 6f6e 6669 6731 2e67 6175  tude=config1.gau
+000171c0: 7373 5f61 6d70 2f66 6163 746f 720a 2020  ss_amp/factor.  
+000171d0: 2020 2020 2020 2020 2020 2020 2020 2363                #c
+000171e0: 6f6e 6669 675f 7477 6561 6b65 642e 6761  onfig_tweaked.ga
+000171f0: 7573 735f 7369 676d 613d 636f 6e66 6967  uss_sigma=config
+00017200: 312e 6761 7573 735f 7369 676d 612a 6661  1.gauss_sigma*fa
+00017210: 6374 6f72 0a20 2020 2020 2020 2020 2020  ctor.           
+00017220: 2023 2048 6f74 2062 616e 6420 6669 7420   # Hot band fit 
+00017230: 6269 7473 0a20 2020 2020 2020 2020 2020  bits.           
+00017240: 2023 2069 6620 616e 7928 6466 5f6f 7574   # if any(df_out
+00017250: 5b27 4469 6164 325f 7265 6669 7427 5d2e  ['Diad2_refit'].
+00017260: 7374 722e 636f 6e74 6169 6e73 2827 4842  str.contains('HB
+00017270: 325f 4c6f 7741 6d70 2729 293a 0a20 2020  2_LowAmp')):.   
+00017280: 2020 2020 2020 2020 2023 2020 2020 2063           #     c
+00017290: 6f6e 6669 675f 7477 6561 6b65 642e 4842  onfig_tweaked.HB
+000172a0: 5f61 6d70 6c69 7475 6465 3d63 616c 635f  _amplitude=calc_
+000172b0: 4842 5f61 6d70 6c69 7475 6465 2f32 0a20  HB_amplitude/2. 
+000172c0: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
+000172d0: 616e 7928 6466 5f6f 7574 5b27 4469 6164  any(df_out['Diad
+000172e0: 325f 7265 6669 7427 5d2e 7374 722e 636f  2_refit'].str.co
+000172f0: 6e74 6169 6e73 2827 4842 325f 4869 6768  ntains('HB2_High
+00017300: 416d 7027 2929 3a0a 2020 2020 2020 2020  Amp')):.        
+00017310: 2020 2020 2320 2020 2020 636f 6e66 6967      #     config
+00017320: 5f74 7765 616b 6564 2e48 425f 616d 706c  _tweaked.HB_ampl
+00017330: 6974 7564 653d 6361 6c63 5f48 425f 616d  itude=calc_HB_am
+00017340: 706c 6974 7564 652a 320a 0a0a 2020 2020  plitude*2...    
+00017350: 2020 2020 2020 2020 7265 7375 6c74 2c20          result, 
+00017360: 6466 5f6f 7574 2c20 795f 6265 7374 5f66  df_out, y_best_f
+00017370: 6974 2c20 785f 6c69 6e2c 2063 6f6d 706f  it, x_lin, compo
+00017380: 6e65 6e74 732c 2078 6461 742c 2079 6461  nents, xdat, yda
+00017390: 742c 2061 7831 5f78 6c69 6d2c 2061 7832  t, ax1_xlim, ax2
+000173a0: 5f78 6c69 6d2c 7265 7369 6475 616c 5f64  _xlim,residual_d
+000173b0: 6961 645f 636f 6f72 6473 2c20 7964 6174  iad_coords, ydat
+000173c0: 5f69 6e72 616e 6765 2c20 2078 6461 745f  _inrange,  xdat_
+000173d0: 696e 7261 6e67 653d 6669 745f 6761 7573  inrange=fit_gaus
+000173e0: 7369 616e 5f76 6f69 6774 5f67 656e 6572  sian_voigt_gener
+000173f0: 6963 5f64 6961 6428 636f 6e66 6967 5f74  ic_diad(config_t
+00017400: 7765 616b 6564 2c20 6469 6164 323d 5472  weaked, diad2=Tr
+00017410: 7565 2c20 7061 7468 3d70 6174 682c 2066  ue, path=path, f
+00017420: 696c 656e 616d 653d 6669 6c65 6e61 6d65  ilename=filename
+00017430: 2c0a 2020 2020 2020 2020 2020 2020 7864  ,.            xd
+00017440: 6174 3d78 5f64 6961 6432 2c20 7964 6174  at=x_diad2, ydat
+00017450: 3d79 5f63 6f72 725f 6469 6164 322c 0a20  =y_corr_diad2,. 
+00017460: 2020 2020 2020 2073 7061 6e3d 7370 616e         span=span
+00017470: 5f64 6961 6432 2c20 706c 6f74 5f66 6967  _diad2, plot_fig
+00017480: 7572 653d 4661 6c73 652c 2044 6961 645f  ure=False, Diad_
+00017490: 706f 733d 4469 6164 5f70 6f73 2c20 4842  pos=Diad_pos, HB
+000174a0: 5f70 6f73 3d48 425f 706f 732c 2043 3133  _pos=HB_pos, C13
+000174b0: 5f70 6f73 3d43 3133 5f70 6f73 2c20 6669  _pos=C13_pos, fi
+000174c0: 745f 7065 616b 733d 6669 745f 7065 616b  t_peaks=fit_peak
+000174d0: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
+000174e0: 3d32 0a20 2020 2020 2020 2020 2020 2077  =2.            w
+000174f0: 6869 6c65 2073 7472 2864 665f 6f75 745b  hile str(df_out[
+00017500: 2744 6961 6432 5f72 6566 6974 275d 2e69  'Diad2_refit'].i
+00017510: 6c6f 635b 305d 2921 3d27 466c 6167 6765  loc[0])!='Flagge
+00017520: 6420 5761 726e 696e 6773 3a27 3a0a 0a20  d Warnings:':.. 
+00017530: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00017540: 7269 6e74 2827 7265 6669 7420 6174 7465  rint('refit atte
+00017550: 6d70 7420 203d 272b 7374 7228 6929 202b  mpt  ='+str(i) +
+00017560: 2027 2c20 272b 7374 7228 6466 5f6f 7574   ', '+str(df_out
+00017570: 5b27 4469 6164 325f 7265 6669 7427 5d2e  ['Diad2_refit'].
+00017580: 696c 6f63 5b30 5d29 290a 2020 2020 2020  iloc[0])).      
+00017590: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000175a0: 6466 5f6f 7574 5b27 4469 6164 325f 7265  df_out['Diad2_re
+000175b0: 6669 7427 5d2e 696c 6f63 5b30 5d29 0a0a  fit'].iloc[0])..
+000175c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000175d0: 2063 6f6e 6669 675f 7477 6561 6b65 6432   config_tweaked2
+000175e0: 3d63 6f70 792e 636f 7079 2863 6f6e 6669  =copy.copy(confi
+000175f0: 675f 7477 6561 6b65 6429 0a20 2020 2020  g_tweaked).     
+00017600: 2020 2020 2020 2020 2020 2066 6163 746f             facto
+00017610: 7232 3d66 6163 746f 722a 320a 0a20 2020  r2=factor*2..   
+00017620: 2020 2020 2020 2020 2020 2020 2023 0a20               #. 
+00017630: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00017640: 2069 6620 616e 7928 6466 5f6f 7574 5b27   if any(df_out['
+00017650: 4469 6164 325f 7265 6669 7427 5d2e 7374  Diad2_refit'].st
+00017660: 722e 636f 6e74 6169 6e73 2827 565f 4c6f  r.contains('V_Lo
+00017670: 7741 6d70 2729 293a 0a20 2020 2020 2020  wAmp')):.       
+00017680: 2020 2020 2020 2020 2023 2020 2020 2063           #     c
+00017690: 6f6e 6669 675f 7477 6561 6b65 6432 2e64  onfig_tweaked2.d
+000176a0: 6961 645f 616d 706c 6974 7564 653d 636f  iad_amplitude=co
+000176b0: 6e66 6967 5f74 7765 616b 6564 2e64 6961  nfig_tweaked.dia
+000176c0: 645f 616d 706c 6974 7564 652a 3130 0a20  d_amplitude*10. 
+000176d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000176e0: 2069 6620 616e 7928 6466 5f6f 7574 5b27   if any(df_out['
+000176f0: 4469 6164 325f 7265 6669 7427 5d2e 7374  Diad2_refit'].st
+00017700: 722e 636f 6e74 6169 6e73 2827 565f 4869  r.contains('V_Hi
+00017710: 6768 416d 7027 2929 3a0a 2020 2020 2020  ghAmp')):.      
+00017720: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+00017730: 636f 6e66 6967 5f74 7765 616b 6564 322e  config_tweaked2.
+00017740: 6469 6164 5f61 6d70 6c69 7475 6465 3d63  diad_amplitude=c
+00017750: 6f6e 6669 675f 7477 6561 6b65 642e 6469  onfig_tweaked.di
+00017760: 6164 5f61 6d70 6c69 7475 6465 2f31 300a  ad_amplitude/10.
+00017770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017780: 6966 2061 6e79 2864 665f 6f75 745b 2744  if any(df_out['D
+00017790: 6961 6432 5f72 6566 6974 275d 2e73 7472  iad2_refit'].str
+000177a0: 2e63 6f6e 7461 696e 7328 2756 5f53 6967  .contains('V_Sig
+000177b0: 6d61 5f74 6f6f 5f4c 6f77 2729 293a 0a20  ma_too_Low')):. 
+000177c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177d0: 2020 2063 6f6e 6669 675f 7477 6561 6b65     config_tweake
+000177e0: 6432 2e64 6961 645f 7369 676d 613d 636f  d2.diad_sigma=co
+000177f0: 6e66 6967 5f74 7765 616b 6564 2e64 6961  nfig_tweaked.dia
+00017800: 645f 7369 676d 612a 6661 6374 6f72 320a  d_sigma*factor2.
+00017810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017820: 6966 2061 6e79 2864 665f 6f75 745b 2744  if any(df_out['D
+00017830: 6961 6432 5f72 6566 6974 275d 2e73 7472  iad2_refit'].str
+00017840: 2e63 6f6e 7461 696e 7328 2756 5f53 6967  .contains('V_Sig
+00017850: 6d61 5f74 6f6f 5f48 6967 6827 2929 3a0a  ma_too_High')):.
+00017860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017870: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
+00017880: 6564 322e 6469 6164 5f73 6967 6d61 3d63  ed2.diad_sigma=c
+00017890: 6f6e 6669 675f 7477 6561 6b65 642e 6469  onfig_tweaked.di
+000178a0: 6164 5f73 6967 6d61 2f66 6163 746f 7232  ad_sigma/factor2
+000178b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000178c0: 2023 2047 6175 7373 6961 6e20 6669 7420   # Gaussian fit 
+000178d0: 6269 7473 0a20 2020 2020 2020 2020 2020  bits.           
+000178e0: 2020 2020 2069 6620 616e 7928 6466 5f6f       if any(df_o
+000178f0: 7574 5b27 4469 6164 325f 7265 6669 7427  ut['Diad2_refit'
+00017900: 5d2e 7374 722e 636f 6e74 6169 6e73 2827  ].str.contains('
+00017910: 475f 696e 7075 745f 546f 6f48 6967 6853  G_input_TooHighS
+00017920: 6967 6d61 2729 293a 0a20 2020 2020 2020  igma')):.       
+00017930: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00017940: 6669 675f 7477 6561 6b65 6432 2e67 6175  fig_tweaked2.gau
+00017950: 7373 5f73 6967 6d61 3d63 6f6e 6669 675f  ss_sigma=config_
+00017960: 7477 6561 6b65 642e 6761 7573 735f 7369  tweaked.gauss_si
+00017970: 676d 612f 6661 6374 6f72 320a 2020 2020  gma/factor2.    
+00017980: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00017990: 6e79 2864 665f 6f75 745b 2744 6961 6432  ny(df_out['Diad2
+000179a0: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
+000179b0: 7461 696e 7328 2747 5f69 6e70 7574 5f54  tains('G_input_T
+000179c0: 6f6f 4c6f 7753 6967 6d61 2729 293a 0a20  ooLowSigma')):. 
+000179d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000179e0: 2020 2063 6f6e 6669 675f 7477 6561 6b65     config_tweake
+000179f0: 6432 2e67 6175 7373 5f73 6967 6d61 3d63  d2.gauss_sigma=c
+00017a00: 6f6e 6669 675f 7477 6561 6b65 642e 6761  onfig_tweaked.ga
+00017a10: 7573 735f 7369 676d 612a 6661 6374 6f72  uss_sigma*factor
+00017a20: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
+00017a30: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
+00017a40: 2744 6961 6432 5f72 6566 6974 275d 2e73  'Diad2_refit'].s
+00017a50: 7472 2e63 6f6e 7461 696e 7328 2747 5f69  tr.contains('G_i
+00017a60: 6e70 7574 5f54 6f6f 4c6f 7741 6d70 2729  nput_TooLowAmp')
+00017a70: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00017a80: 2020 2020 2020 2063 6f6e 6669 675f 7477         config_tw
+00017a90: 6561 6b65 6432 2e67 6175 7373 5f61 6d70  eaked2.gauss_amp
+00017aa0: 6c69 7475 6465 3d63 6f6e 6669 675f 7477  litude=config_tw
+00017ab0: 6561 6b65 642e 6761 7573 735f 616d 702a  eaked.gauss_amp*
+00017ac0: 6661 6374 6f72 320a 2020 2020 2020 2020  factor2.        
+00017ad0: 2020 2020 2020 2020 6966 2061 6e79 2864          if any(d
+00017ae0: 665f 6f75 745b 2744 6961 6432 5f72 6566  f_out['Diad2_ref
+00017af0: 6974 275d 2e73 7472 2e63 6f6e 7461 696e  it'].str.contain
+00017b00: 7328 2747 5f41 6d70 5f74 6f6f 5f68 6967  s('G_Amp_too_hig
+00017b10: 6827 2929 3a0a 2020 2020 2020 2020 2020  h')):.          
+00017b20: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+00017b30: 5f74 7765 616b 6564 322e 6761 7573 735f  _tweaked2.gauss_
+00017b40: 616d 706c 6974 7564 653d 636f 6e66 6967  amplitude=config
+00017b50: 5f74 7765 616b 6564 2e67 6175 7373 5f61  _tweaked.gauss_a
+00017b60: 6d70 2f66 6163 746f 7232 0a20 2020 2020  mp/factor2.     
+00017b70: 2020 2020 2020 2020 2020 2069 6620 616e             if an
+00017b80: 7928 6466 5f6f 7574 5b27 4469 6164 325f  y(df_out['Diad2_
+00017b90: 7265 6669 7427 5d2e 7374 722e 636f 6e74  refit'].str.cont
+00017ba0: 6169 6e73 2827 475f 6869 6768 6572 5f74  ains('G_higher_t
+00017bb0: 6861 6e5f 6469 6164 2729 293a 0a20 2020  han_diad')):.   
+00017bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017bd0: 2063 6f6e 6669 675f 7477 6561 6b65 6432   config_tweaked2
+00017be0: 2e67 6175 7373 5f61 6d70 6c69 7475 6465  .gauss_amplitude
+00017bf0: 3d63 6f6e 6669 675f 7477 6561 6b65 642e  =config_tweaked.
+00017c00: 6761 7573 735f 616d 702f 6661 6374 6f72  gauss_amp/factor
+00017c10: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
+00017c20: 2020 2020 2020 2363 6f6e 6669 675f 7477        #config_tw
+00017c30: 6561 6b65 6432 2e67 6175 7373 5f73 6967  eaked2.gauss_sig
+00017c40: 6d61 3d63 6f6e 6669 675f 7477 6561 6b65  ma=config_tweake
+00017c50: 642e 6761 7573 735f 7369 676d 612a 6661  d.gauss_sigma*fa
+00017c60: 6374 6f72 320a 2020 2020 2020 2020 2020  ctor2.          
+00017c70: 2020 2320 2320 486f 7420 6261 6e64 7320    # # Hot bands 
+00017c80: 6269 7473 0a20 2020 2020 2020 2020 2020  bits.           
+00017c90: 2023 2020 2020 2069 6620 616e 7928 6466   #     if any(df
+00017ca0: 5f6f 7574 5b27 4469 6164 325f 7265 6669  _out['Diad2_refi
+00017cb0: 7427 5d2e 7374 722e 636f 6e74 6169 6e73  t'].str.contains
+00017cc0: 2827 4842 325f 4c6f 7741 6d70 2729 293a  ('HB2_LowAmp')):
+00017cd0: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+00017ce0: 2020 2020 2020 2063 6f6e 6669 675f 7477         config_tw
+00017cf0: 6561 6b65 6432 2e48 425f 616d 706c 6974  eaked2.HB_amplit
+00017d00: 7564 653d 636f 6e66 6967 5f74 7765 616b  ude=config_tweak
+00017d10: 6564 2e48 425f 616d 706c 6974 7564 652f  ed.HB_amplitude/
+00017d20: 320a 2020 2020 2020 2020 2020 2020 2320  2.            # 
+00017d30: 2020 2020 6966 2061 6e79 2864 665f 6f75      if any(df_ou
+00017d40: 745b 2744 6961 6432 5f72 6566 6974 275d  t['Diad2_refit']
+00017d50: 2e73 7472 2e63 6f6e 7461 696e 7328 2748  .str.contains('H
+00017d60: 4232 5f48 6967 6841 6d70 2729 293a 0a20  B2_HighAmp')):. 
+00017d70: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00017d80: 2020 2020 2063 6f6e 6669 675f 7477 6561       config_twea
+00017d90: 6b65 6432 2e48 425f 616d 706c 6974 7564  ked2.HB_amplitud
+00017da0: 653d 636f 6e66 6967 5f74 7765 616b 6564  e=config_tweaked
+00017db0: 2e48 425f 616d 706c 6974 7564 652a 320a  .HB_amplitude*2.
+00017dc0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017dd0: 2020 7265 7375 6c74 2c20 6466 5f6f 7574    result, df_out
+00017de0: 2c20 795f 6265 7374 5f66 6974 2c20 785f  , y_best_fit, x_
+00017df0: 6c69 6e2c 2063 6f6d 706f 6e65 6e74 732c  lin, components,
+00017e00: 2078 6461 742c 2079 6461 742c 2061 7831   xdat, ydat, ax1
+00017e10: 5f78 6c69 6d2c 2061 7832 5f78 6c69 6d2c  _xlim, ax2_xlim,
+00017e20: 7265 7369 6475 616c 5f64 6961 645f 636f  residual_diad_co
+00017e30: 6f72 6473 2c20 7964 6174 5f69 6e72 616e  ords, ydat_inran
+00017e40: 6765 2c20 2078 6461 745f 696e 7261 6e67  ge,  xdat_inrang
+00017e50: 653d 6669 745f 6761 7573 7369 616e 5f76  e=fit_gaussian_v
+00017e60: 6f69 6774 5f67 656e 6572 6963 5f64 6961  oigt_generic_dia
+00017e70: 6428 636f 6e66 6967 5f74 7765 616b 6564  d(config_tweaked
+00017e80: 322c 2064 6961 6432 3d54 7275 652c 2070  2, diad2=True, p
+00017e90: 6174 683d 7061 7468 2c20 6669 6c65 6e61  ath=path, filena
+00017ea0: 6d65 3d66 696c 656e 616d 652c 0a20 2020  me=filename,.   
+00017eb0: 2020 2020 2020 2020 2078 6461 743d 785f           xdat=x_
+00017ec0: 6469 6164 322c 2079 6461 743d 795f 636f  diad2, ydat=y_co
+00017ed0: 7272 5f64 6961 6432 2c20 7370 616e 3d73  rr_diad2, span=s
+00017ee0: 7061 6e5f 6469 6164 322c 2070 6c6f 745f  pan_diad2, plot_
+00017ef0: 6669 6775 7265 3d46 616c 7365 2c20 4469  figure=False, Di
+00017f00: 6164 5f70 6f73 3d44 6961 645f 706f 732c  ad_pos=Diad_pos,
+00017f10: 2048 425f 706f 733d 4842 5f70 6f73 2c20   HB_pos=HB_pos, 
+00017f20: 4331 335f 706f 733d 4331 335f 706f 732c  C13_pos=C13_pos,
+00017f30: 2066 6974 5f70 6561 6b73 3d66 6974 5f70   fit_peaks=fit_p
+00017f40: 6561 6b73 290a 2020 2020 2020 2020 2020  eaks).          
+00017f50: 2020 2020 2020 693d 692b 310a 2020 2020        i=i+1.    
+00017f60: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00017f70: 3e35 3a0a 2020 2020 2020 2020 2020 2020  >5:.            
+00017f80: 2020 2020 2020 2020 7072 696e 7428 2747          print('G
+00017f90: 6f74 2074 6f20 3520 6974 6572 6174 6f69  ot to 5 iteratoi
+00017fa0: 6e73 2061 6e64 2073 7469 6c6c 2063 6f75  ns and still cou
+00017fb0: 6c64 6e74 2061 646a 7573 7420 7468 6520  ldnt adjust the 
+00017fc0: 6669 7420 7061 7261 6d65 7465 7273 2729  fit parameters')
+00017fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017fe0: 2020 2020 2062 7265 616b 0a0a 0a20 2020       break...   
+00017ff0: 2023 2067 6574 2061 2062 6573 7420 6669   # get a best fi
+00018000: 7420 746f 2074 6865 2062 6173 656c 696e  t to the baselin
+00018010: 6520 7573 696e 6720 6120 6c69 6e73 7061  e using a linspa
+00018020: 6365 2066 726f 6d20 7468 6520 7065 616b  ce from the peak
+00018030: 2066 6974 7469 6e67 0a20 2020 2079 6261   fitting.    yba
+00018040: 7365 5f78 6c69 6e3d 5066 5f62 6173 656c  se_xlin=Pf_basel
+00018050: 696e 655f 6469 6164 3228 785f 6c69 6e29  ine_diad2(x_lin)
+00018060: 0a0a 2020 2020 2320 5765 2065 7874 7261  ..    # We extra
+00018070: 6374 2074 6865 2066 756c 6c20 7370 6563  ct the full spec
+00018080: 7472 6120 746f 2070 6c6f 7420 6174 2074  tra to plot at t
+00018090: 6865 2065 6e64 2c20 616e 6420 636f 6e76  he end, and conv
+000180a0: 6572 7420 746f 2061 2064 6174 6166 7261  ert to a datafra
+000180b0: 6d65 0a20 2020 2023 5370 6563 7472 615f  me.    #Spectra_
+000180c0: 6466 3d67 6574 5f64 6174 6128 7061 7468  df=get_data(path
+000180d0: 3d70 6174 682c 2066 696c 656e 616d 653d  =path, filename=
+000180e0: 6669 6c65 6e61 6d65 2c20 6669 6c65 7479  filename, filety
+000180f0: 7065 3d66 696c 6574 7970 6529 0a20 2020  pe=filetype).   
+00018100: 2053 7065 6374 7261 3d44 6961 640a 0a0a   Spectra=Diad...
+00018110: 0a20 2020 2023 204d 616b 6520 6e69 6365  .    # Make nice
+00018120: 2066 6967 7572 650a 2020 2020 6966 2070   figure.    if p
+00018130: 6c6f 745f 6669 6775 7265 2069 7320 5472  lot_figure is Tr
+00018140: 7565 3a0a 0a20 2020 2020 2020 2066 6967  ue:..        fig
+00018150: 7572 655f 6d6f 7361 6963 3d22 2222 0a20  ure_mosaic=""". 
+00018160: 2020 2020 2020 2058 590a 2020 2020 2020         XY.      
+00018170: 2020 4142 0a20 2020 2020 2020 2043 440a    AB.        CD.
+00018180: 2020 2020 2020 2020 4545 0a20 2020 2020          EE.     
+00018190: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+000181a0: 6669 672c 6178 6573 3d70 6c74 2e73 7562  fig,axes=plt.sub
+000181b0: 706c 6f74 5f6d 6f73 6169 6328 6d6f 7361  plot_mosaic(mosa
+000181c0: 6963 3d66 6967 7572 655f 6d6f 7361 6963  ic=figure_mosaic
+000181d0: 2c20 6669 6773 697a 653d 2831 322c 2031  , figsize=(12, 1
+000181e0: 3629 290a 2020 2020 2020 2020 6966 2064  6)).        if d
+000181f0: 665f 6f75 745b 2744 6961 6432 5f72 6566  f_out['Diad2_ref
+00018200: 6974 275d 2069 7320 6e6f 7420 4661 6c73  it'] is not Fals
+00018210: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
+00018220: 6967 2e73 7570 7469 746c 6528 2744 6961  ig.suptitle('Dia
+00018230: 6420 322c 2066 696c 653d 2027 2b20 7374  d 2, file= '+ st
+00018240: 7228 6669 6c65 6e61 6d65 2920 2b20 2720  r(filename) + ' 
+00018250: 5c6e 2720 2b20 7374 7228 6466 5f6f 7574  \n' + str(df_out
+00018260: 5b27 4469 6164 325f 7265 6669 7427 5d2e  ['Diad2_refit'].
+00018270: 696c 6f63 5b30 5d29 2c20 666f 6e74 7369  iloc[0]), fontsi
+00018280: 7a65 3d31 362c 2078 3d30 2e35 2c20 793d  ze=16, x=0.5, y=
+00018290: 312e 3029 0a20 2020 2020 2020 2065 6c73  1.0).        els
+000182a0: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
+000182b0: 6967 2e73 7570 7469 746c 6528 2744 6961  ig.suptitle('Dia
+000182c0: 6420 322c 2066 696c 653d 2027 2b20 7374  d 2, file= '+ st
+000182d0: 7228 6669 6c65 6e61 6d65 292c 2066 6f6e  r(filename), fon
+000182e0: 7473 697a 653d 3136 2c20 783d 302e 352c  tsize=16, x=0.5,
+000182f0: 2079 3d31 2e30 290a 2020 2020 2020 2020   y=1.0).        
+00018300: 2320 4261 636b 6772 6f75 6e64 2070 6c6f  # Background plo
+00018310: 7420 666f 7220 7265 616c 0a0a 2020 2020  t for real..    
+00018320: 2020 2020 2320 506c 6f74 2062 6573 7420      # Plot best 
+00018330: 6669 7420 6f6e 2074 6865 204c 4853 2c20  fit on the LHS, 
+00018340: 616e 6420 696e 6469 7669 6475 616c 2066  and individual f
+00018350: 6974 7320 6f6e 2074 6865 2052 4853 2061  its on the RHS a
+00018360: 7420 7468 6520 746f 700a 0a20 2020 2020  t the top..     
+00018370: 2020 2061 7865 735b 2758 275d 2e73 6574     axes['X'].set
+00018380: 5f74 6974 6c65 2827 6129 2042 6163 6b67  _title('a) Backg
+00018390: 726f 756e 6420 6669 7427 290a 2020 2020  round fit').    
+000183a0: 2020 2020 6178 6573 5b27 5827 5d2e 706c      axes['X'].pl
+000183b0: 6f74 2844 6961 645b 3a2c 2030 5d2c 2044  ot(Diad[:, 0], D
+000183c0: 6961 645b 3a2c 2031 5d2c 2027 2d27 2c20  iad[:, 1], '-', 
+000183d0: 636f 6c6f 723d 2767 7265 7927 290a 2020  color='grey').  
+000183e0: 2020 2020 2020 6178 6573 5b27 5827 5d2e        axes['X'].
+000183f0: 706c 6f74 2844 6961 645f 7368 6f72 745f  plot(Diad_short_
+00018400: 6469 6164 325b 3a2c 2030 5d2c 2044 6961  diad2[:, 0], Dia
+00018410: 645f 7368 6f72 745f 6469 6164 325b 3a2c  d_short_diad2[:,
+00018420: 2031 5d2c 2027 2d72 272c 206c 6162 656c   1], '-r', label
+00018430: 3d27 5370 6563 7472 6127 290a 0a20 2020  ='Spectra')..   
+00018440: 2020 2020 2023 6178 6573 5b27 5827 5d2e       #axes['X'].
+00018450: 706c 6f74 2842 6173 656c 696e 655b 3a2c  plot(Baseline[:,
+00018460: 2030 5d2c 2042 6173 656c 696e 655b 3a2c   0], Baseline[:,
+00018470: 2031 5d2c 2027 2d62 272c 206c 6162 656c   1], '-b', label
+00018480: 3d27 4263 6b20 706f 696e 7473 2729 0a20  ='Bck points'). 
+00018490: 2020 2020 2020 2061 7865 735b 2758 275d         axes['X']
+000184a0: 2e70 6c6f 7428 4261 7365 6c69 6e65 5f64  .plot(Baseline_d
+000184b0: 6961 6432 5b3a 2c20 305d 2c20 4261 7365  iad2[:, 0], Base
+000184c0: 6c69 6e65 5f64 6961 6432 5b3a 2c20 315d  line_diad2[:, 1]
+000184d0: 2c20 272e 6227 2c20 6c61 6265 6c3d 2762  , '.b', label='b
+000184e0: 656c 2e20 4263 6b2e 2070 7473 2729 0a20  el. Bck. pts'). 
+000184f0: 2020 2020 2020 2061 7865 735b 2758 275d         axes['X']
+00018500: 2e70 6c6f 7428 4469 6164 5f73 686f 7274  .plot(Diad_short
+00018510: 5f64 6961 6432 5b3a 2c20 305d 2c20 5079  _diad2[:, 0], Py
+00018520: 5f62 6173 655f 6469 6164 322c 2027 2d6b  _base_diad2, '-k
+00018530: 272c 206c 6162 656c 3d27 6263 6b2e 2070  ', label='bck. p
+00018540: 6f6c 7920 6669 7427 290a 0a0a 0a20 2020  oly fit')....   
+00018550: 2020 2020 2061 7831 5f79 6d69 6e3d 6e70       ax1_ymin=np
+00018560: 2e6d 696e 2842 6173 656c 696e 655f 6469  .min(Baseline_di
+00018570: 6164 325b 3a2c 2031 5d29 2d31 302a 6e70  ad2[:, 1])-10*np
+00018580: 2e73 7464 2842 6173 656c 696e 655f 6469  .std(Baseline_di
+00018590: 6164 325b 3a2c 2031 5d29 0a20 2020 2020  ad2[:, 1]).     
+000185a0: 2020 2061 7831 5f79 6d61 783d 6e70 2e6d     ax1_ymax=np.m
+000185b0: 6178 2842 6173 656c 696e 655f 6469 6164  ax(Baseline_diad
+000185c0: 325b 3a2c 2031 5d29 2b31 302a 6e70 2e73  2[:, 1])+10*np.s
+000185d0: 7464 2842 6173 656c 696e 655f 6469 6164  td(Baseline_diad
+000185e0: 325b 3a2c 2031 5d29 0a20 2020 2020 2020  2[:, 1]).       
+000185f0: 2061 7831 5f78 6d69 6e3d 636f 6e66 6967   ax1_xmin=config
+00018600: 312e 6c6f 7765 725f 6263 6b5f 6469 6164  1.lower_bck_diad
+00018610: 325b 305d 2d33 300a 2020 2020 2020 2020  2[0]-30.        
+00018620: 6178 315f 786d 6178 3d63 6f6e 6669 6731  ax1_xmax=config1
 00018630: 2e75 7070 6572 5f62 636b 5f64 6961 6432  .upper_bck_diad2
-00018640: 5b31 5d2d 636f 6e66 6967 312e 7570 7065  [1]-config1.uppe
-00018650: 725f 6263 6b5f 6469 6164 325b 305d 2c61  r_bck_diad2[0],a
-00018660: 7831 5f79 6d61 782d 6178 315f 796d 696e  x1_ymax-ax1_ymin
-00018670: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00018680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018690: 2020 6c69 6e65 7769 6474 683d 312c 6564    linewidth=1,ed
-000186a0: 6765 636f 6c6f 723d 276e 6f6e 6527 2c66  gecolor='none',f
-000186b0: 6163 6563 6f6c 6f72 3d27 6379 616e 272c  acecolor='cyan',
-000186c0: 2061 6c70 6861 3d30 2e33 2c20 7a6f 7264   alpha=0.3, zord
-000186d0: 6572 3d30 290a 2020 2020 2020 2020 6178  er=0).        ax
-000186e0: 6573 5b27 5827 5d2e 6164 645f 7061 7463  es['X'].add_patc
-000186f0: 6828 7265 6374 5f64 6961 6432 5f62 3229  h(rect_diad2_b2)
-00018700: 0a20 2020 2020 2020 2061 7865 735b 2758  .        axes['X
-00018710: 275d 2e73 6574 5f78 6c69 6d28 5b61 7831  '].set_xlim([ax1
-00018720: 5f78 6d69 6e2c 2061 7831 5f78 6d61 785d  _xmin, ax1_xmax]
-00018730: 290a 2020 2020 2020 2020 6178 6573 5b27  ).        axes['
-00018740: 5827 5d2e 7365 745f 796c 696d 285b 6178  X'].set_ylim([ax
-00018750: 315f 796d 696e 2c20 6178 315f 796d 6178  1_ymin, ax1_ymax
-00018760: 5d29 0a0a 2020 2020 2020 2020 6178 6573  ])..        axes
-00018770: 5b27 5827 5d2e 7365 745f 796c 6162 656c  ['X'].set_ylabel
-00018780: 2827 496e 7465 6e73 6974 7927 290a 2020  ('Intensity').  
-00018790: 2020 2020 2020 6178 6573 5b27 5927 5d2e        axes['Y'].
-000187a0: 7365 745f 796c 6162 656c 2827 496e 7465  set_ylabel('Inte
-000187b0: 6e73 6974 7927 290a 2020 2020 2020 2020  nsity').        
-000187c0: 6178 6573 5b27 5927 5d2e 7365 745f 786c  axes['Y'].set_xl
-000187d0: 6162 656c 2827 5761 7665 6e75 6d62 6572  abel('Wavenumber
-000187e0: 2729 0a20 2020 2020 2020 2061 7865 735b  ').        axes[
-000187f0: 2758 275d 2e6c 6567 656e 6428 290a 0a0a  'X'].legend()...
-00018800: 0a20 2020 2020 2020 2061 7865 735b 2759  .        axes['Y
-00018810: 275d 2e73 6574 5f74 6974 6c65 2827 6229  '].set_title('b)
-00018820: 2042 6163 6b67 726f 756e 6420 7375 6274   Background subt
-00018830: 7261 6374 6564 2073 7065 6374 7261 2729  racted spectra')
-00018840: 0a20 2020 2020 2020 2061 7865 735b 2759  .        axes['Y
-00018850: 275d 2e70 6c6f 7428 785f 6469 6164 322c  '].plot(x_diad2,
-00018860: 2079 5f63 6f72 725f 6469 6164 322c 2027   y_corr_diad2, '
-00018870: 2d72 2729 0a20 2020 2020 2020 2068 6569  -r').        hei
-00018880: 6768 745f 703d 6e70 2e6d 6178 2844 6961  ght_p=np.max(Dia
-00018890: 645f 7368 6f72 745f 6469 6164 325b 3a2c  d_short_diad2[:,
-000188a0: 2031 5d29 2d6e 702e 6d69 6e28 4469 6164   1])-np.min(Diad
-000188b0: 5f73 686f 7274 5f64 6961 6432 5b3a 2c20  _short_diad2[:, 
-000188c0: 315d 290a 2020 2020 2020 2020 6178 6573  1]).        axes
-000188d0: 5b27 5927 5d2e 7365 745f 796c 696d 285b  ['Y'].set_ylim([
-000188e0: 6e70 2e6d 696e 2879 5f63 6f72 725f 6469  np.min(y_corr_di
-000188f0: 6164 3229 2c20 312e 322a 6865 6967 6874  ad2), 1.2*height
-00018900: 5f70 205d 290a 2020 2020 2020 2020 6178  _p ]).        ax
-00018910: 6573 5b27 5827 5d2e 7365 745f 786c 6162  es['X'].set_xlab
-00018920: 656c 2827 5761 7665 6e75 6d62 6572 2729  el('Wavenumber')
-00018930: 0a0a 0a0a 2020 2020 2020 2020 6178 6573  ....        axes
-00018940: 5b27 4127 5d2e 706c 6f74 2878 6461 742c  ['A'].plot(xdat,
-00018950: 2079 6461 742c 2020 272e 6b27 2c20 6c61   ydat,  '.k', la
-00018960: 6265 6c3d 2762 636b 2e20 7375 622e 2064  bel='bck. sub. d
-00018970: 6174 6127 290a 2020 2020 2020 2020 6178  ata').        ax
-00018980: 6573 5b27 4127 5d2e 706c 6f74 2820 785f  es['A'].plot( x_
-00018990: 6c69 6e20 2c79 5f62 6573 745f 6669 742c  lin ,y_best_fit,
-000189a0: 2027 2d67 272c 206c 696e 6577 6964 7468   '-g', linewidth
-000189b0: 3d31 2c20 6c61 6265 6c3d 2762 6573 7420  =1, label='best 
-000189c0: 6669 7427 290a 2020 2020 2020 2020 6178  fit').        ax
-000189d0: 6573 5b27 4127 5d2e 6c65 6765 6e64 2829  es['A'].legend()
-000189e0: 0a20 2020 2020 2020 2061 7865 735b 2741  .        axes['A
-000189f0: 275d 2e73 6574 5f79 6c61 6265 6c28 2749  '].set_ylabel('I
-00018a00: 6e74 656e 7369 7479 2729 0a20 2020 2020  ntensity').     
-00018a10: 2020 2061 7865 735b 2741 275d 2e73 6574     axes['A'].set
-00018a20: 5f78 6c61 6265 6c28 2757 6176 656e 756d  _xlabel('Wavenum
-00018a30: 6265 7227 290a 2020 2020 2020 2020 6178  ber').        ax
-00018a40: 6573 5b27 4127 5d2e 7365 745f 786c 696d  es['A'].set_xlim
-00018a50: 2861 7831 5f78 6c69 6d29 0a20 2020 2020  (ax1_xlim).     
-00018a60: 2020 2061 7865 735b 2741 275d 2e73 6574     axes['A'].set
-00018a70: 5f74 6974 6c65 2827 6329 204f 7665 7261  _title('c) Overa
-00018a80: 6c6c 2042 6573 7420 4669 7427 290a 0a20  ll Best Fit').. 
-00018a90: 2020 2023 2069 6e64 6976 6964 7561 6c20     # individual 
-00018aa0: 6669 7473 0a20 2020 2020 2020 2061 7865  fits.        axe
-00018ab0: 735b 2742 275d 2e70 6c6f 7428 7864 6174  s['B'].plot(xdat
-00018ac0: 2c20 7964 6174 2c20 272e 6b27 290a 0a20  , ydat, '.k').. 
-00018ad0: 2020 2020 2020 2023 2054 6869 7320 6973         # This is
-00018ae0: 2066 6f72 2069 6620 7468 6572 6520 6973   for if there is
-00018af0: 206d 6f72 6520 7468 616e 2031 2070 6561   more than 1 pea
-00018b00: 6b2c 2074 6869 7320 6973 2077 6865 6e20  k, this is when 
-00018b10: 7765 2077 616e 7420 746f 2070 6c6f 7420  we want to plot 
-00018b20: 7468 6520 6265 7374 2066 6974 0a0a 2020  the best fit..  
-00018b30: 2020 2020 2020 6966 2066 6974 5f70 6561        if fit_pea
-00018b40: 6b73 3e31 3a0a 0a0a 2020 2020 2020 2020  ks>1:...        
-00018b50: 2020 2020 6178 6573 5b27 4227 5d2e 706c      axes['B'].pl
-00018b60: 6f74 2878 5f6c 696e 2c20 636f 6d70 6f6e  ot(x_lin, compon
-00018b70: 656e 7473 2e67 6574 2827 6c7a 325f 2729  ents.get('lz2_')
-00018b80: 2c20 272d 7227 2c20 6c69 6e65 7769 6474  , '-r', linewidt
-00018b90: 683d 322c 206c 6162 656c 3d27 4842 3227  h=2, label='HB2'
-00018ba0: 290a 0a20 2020 2020 2020 2061 7865 735b  )..        axes[
-00018bb0: 2742 275d 2e70 6c6f 7428 785f 6c69 6e2c  'B'].plot(x_lin,
-00018bc0: 2063 6f6d 706f 6e65 6e74 732e 6765 7428   components.get(
-00018bd0: 276c 7a31 5f27 292c 2027 2d62 272c 206c  'lz1_'), '-b', l
-00018be0: 696e 6577 6964 7468 3d32 2c20 6c61 6265  inewidth=2, labe
-00018bf0: 6c3d 2744 6961 6432 2729 0a20 2020 2020  l='Diad2').     
-00018c00: 2020 2069 6620 636f 6e66 6967 312e 6669     if config1.fi
-00018c10: 745f 6761 7573 7320 6973 206e 6f74 2046  t_gauss is not F
-00018c20: 616c 7365 3a0a 2020 2020 2020 2020 2020  alse:.          
-00018c30: 2020 6178 6573 5b27 4227 5d2e 706c 6f74    axes['B'].plot
-00018c40: 2878 5f6c 696e 2c20 636f 6d70 6f6e 656e  (x_lin, componen
-00018c50: 7473 2e67 6574 2827 626b 675f 2729 2c20  ts.get('bkg_'), 
-00018c60: 272d 6d27 2c20 6c61 6265 6c3d 2747 6175  '-m', label='Gau
-00018c70: 7373 6961 6e20 6263 6b27 2c20 6c69 6e65  ssian bck', line
-00018c80: 7769 6474 683d 3229 0a20 2020 2020 2020  width=2).       
-00018c90: 2023 6178 322e 706c 6f74 2878 6461 742c   #ax2.plot(xdat,
-00018ca0: 2072 6573 756c 742e 6265 7374 5f66 6974   result.best_fit
-00018cb0: 2c20 272d 6727 2c20 6c61 6265 6c3d 2762  , '-g', label='b
-00018cc0: 6573 7420 6669 7427 290a 2020 2020 2020  est fit').      
-00018cd0: 2020 6178 6573 5b27 4227 5d2e 6c65 6765    axes['B'].lege
-00018ce0: 6e64 2829 0a0a 2020 2020 2020 2020 6669  nd()..        fi
-00018cf0: 7473 7061 6e3d 6d61 7828 795f 6265 7374  tspan=max(y_best
-00018d00: 5f66 6974 292d 6d69 6e28 795f 6265 7374  _fit)-min(y_best
-00018d10: 5f66 6974 290a 2020 2020 2020 2020 6178  _fit).        ax
-00018d20: 6573 5b27 4227 5d2e 7365 745f 796c 696d  es['B'].set_ylim
-00018d30: 285b 6d69 6e28 795f 6265 7374 5f66 6974  ([min(y_best_fit
-00018d40: 292d 6669 7473 7061 6e2f 352c 206d 6178  )-fitspan/5, max
-00018d50: 2879 5f62 6573 745f 6669 7429 2b66 6974  (y_best_fit)+fit
-00018d60: 7370 616e 2f35 5d29 0a0a 2020 2020 2020  span/5])..      
-00018d70: 2020 6178 6573 5b27 4227 5d2e 7365 745f    axes['B'].set_
-00018d80: 796c 6162 656c 2827 496e 7465 6e73 6974  ylabel('Intensit
-00018d90: 7927 290a 2020 2020 2020 2020 6178 6573  y').        axes
-00018da0: 5b27 4227 5d2e 7365 745f 786c 6162 656c  ['B'].set_xlabel
-00018db0: 2827 5761 7665 6e75 6d62 6572 2729 0a0a  ('Wavenumber')..
-00018dc0: 0a20 2020 2020 2020 2061 7865 735b 2742  .        axes['B
-00018dd0: 275d 2e73 6574 5f78 6c69 6d28 6178 325f  '].set_xlim(ax2_
-00018de0: 786c 696d 290a 0a20 2020 2020 2020 2023  xlim)..        #
-00018df0: 2044 6173 6865 6420 6c69 6e65 7320 736f   Dashed lines so
-00018e00: 206d 6174 6368 6573 2070 6172 7420 440a   matches part D.
-00018e10: 0a20 2020 2020 2020 2061 7865 735b 2742  .        axes['B
-00018e20: 275d 2e70 6c6f 7428 5b64 665f 6f75 745b  '].plot([df_out[
-00018e30: 2744 6961 6432 5f56 6f69 6774 5f43 656e  'Diad2_Voigt_Cen
-00018e40: 7427 5d2c 2064 665f 6f75 745b 2744 6961  t'], df_out['Dia
-00018e50: 6432 5f56 6f69 6774 5f43 656e 7427 5d5d  d2_Voigt_Cent']]
-00018e60: 2c20 5b6e 702e 6d69 6e28 7964 6174 292c  , [np.min(ydat),
-00018e70: 206e 702e 6d61 7828 7964 6174 295d 2c20   np.max(ydat)], 
-00018e80: 273a 6227 290a 0a0a 2020 2020 2020 2020  ':b')...        
-00018e90: 6966 2066 6974 5f70 6561 6b73 3e3d 323a  if fit_peaks>=2:
-00018ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018eb0: 2061 7865 735b 2742 275d 2e70 6c6f 7428   axes['B'].plot(
-00018ec0: 5b64 665f 6f75 745b 2748 4232 5f43 656e  [df_out['HB2_Cen
-00018ed0: 7427 5d2c 2064 665f 6f75 745b 2748 4232  t'], df_out['HB2
-00018ee0: 5f43 656e 7427 5d5d 2c20 5b6e 702e 6d69  _Cent']], [np.mi
-00018ef0: 6e28 7964 6174 292c 206e 702e 6d61 7828  n(ydat), np.max(
-00018f00: 7964 6174 295d 2c20 273a 7227 290a 0a20  ydat)], ':r').. 
-00018f10: 2020 2020 2020 2061 7865 735b 2742 275d         axes['B']
-00018f20: 2e73 6574 5f74 6974 6c65 2827 6329 2046  .set_title('c) F
-00018f30: 6974 2043 6f6d 706f 6e65 6e74 7327 290a  it Components').
-00018f40: 0a20 2020 2020 2020 2023 2042 6163 6b67  .        # Backg
-00018f50: 726f 756e 6420 6669 740a 0a20 2020 2020  round fit..     
-00018f60: 2020 2023 2046 6972 7374 2c20 7365 7420     # First, set 
-00018f70: 7570 2078 2061 6e64 2079 206c 696d 6974  up x and y limit
-00018f80: 7320 6f6e 2061 7869 730a 0a20 2020 2020  s on axis..     
-00018f90: 2020 2069 6620 636f 6e66 6967 312e 785f     if config1.x_
-00018fa0: 7261 6e67 655f 6261 7365 6c69 6e65 2069  range_baseline i
-00018fb0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00018fc0: 2020 2020 2020 2020 6178 635f 786d 696e          axc_xmin
-00018fd0: 3d64 665f 6f75 745b 2744 6961 6432 5f56  =df_out['Diad2_V
-00018fe0: 6f69 6774 5f43 656e 7427 5d5b 305d 2d63  oigt_Cent'][0]-c
-00018ff0: 6f6e 6669 6731 2e78 5f72 616e 6765 5f62  onfig1.x_range_b
-00019000: 6173 656c 696e 650a 2020 2020 2020 2020  aseline.        
-00019010: 2020 2020 6178 635f 786d 6178 3d64 665f      axc_xmax=df_
-00019020: 6f75 745b 2744 6961 6432 5f56 6f69 6774  out['Diad2_Voigt
-00019030: 5f43 656e 7427 5d5b 305d 2b63 6f6e 6669  _Cent'][0]+confi
-00019040: 6731 2e78 5f72 616e 6765 5f62 6173 656c  g1.x_range_basel
-00019050: 696e 650a 2020 2020 2020 2020 656c 7365  ine.        else
-00019060: 3a0a 2020 2020 2020 2020 2020 2020 6178  :.            ax
-00019070: 635f 786d 696e 3d63 6f6e 6669 6731 2e6c  c_xmin=config1.l
-00019080: 6f77 6572 5f62 636b 5f64 6961 6432 5b30  ower_bck_diad2[0
-00019090: 5d0a 2020 2020 2020 2020 2020 2020 6178  ].            ax
-000190a0: 635f 786d 6178 3d63 6f6e 6669 6731 2e75  c_xmax=config1.u
-000190b0: 7070 6572 5f62 636b 5f64 6961 6432 5b31  pper_bck_diad2[1
-000190c0: 5d0a 2020 2020 2020 2020 6178 635f 796d  ].        axc_ym
-000190d0: 696e 3d6e 702e 6d69 6e28 4261 7365 6c69  in=np.min(Baseli
-000190e0: 6e65 5f64 6961 6432 5b3a 2c20 315d 292d  ne_diad2[:, 1])-
-000190f0: 636f 6e66 6967 312e 795f 7261 6e67 655f  config1.y_range_
-00019100: 6261 7365 6c69 6e65 2f33 0a20 2020 2020  baseline/3.     
-00019110: 2020 2061 7863 5f79 6d61 783d 6e70 2e6d     axc_ymax=np.m
-00019120: 6178 2842 6173 656c 696e 655f 6469 6164  ax(Baseline_diad
-00019130: 325b 3a2c 2031 5d29 2b63 6f6e 6669 6731  2[:, 1])+config1
-00019140: 2e79 5f72 616e 6765 5f62 6173 656c 696e  .y_range_baselin
-00019150: 650a 0a20 2020 2020 2020 2072 6563 745f  e..        rect_
-00019160: 6469 6164 325f 6231 3d70 6174 6368 6573  diad2_b1=patches
-00019170: 2e52 6563 7461 6e67 6c65 2828 636f 6e66  .Rectangle((conf
-00019180: 6967 312e 6c6f 7765 725f 6263 6b5f 6469  ig1.lower_bck_di
-00019190: 6164 325b 305d 2c61 7863 5f79 6d69 6e29  ad2[0],axc_ymin)
-000191a0: 2c63 6f6e 6669 6731 2e6c 6f77 6572 5f62  ,config1.lower_b
-000191b0: 636b 5f64 6961 6432 5b31 5d2d 636f 6e66  ck_diad2[1]-conf
-000191c0: 6967 312e 6c6f 7765 725f 6263 6b5f 6469  ig1.lower_bck_di
-000191d0: 6164 325b 305d 2c61 7863 5f79 6d61 782d  ad2[0],axc_ymax-
-000191e0: 6178 635f 796d 696e 2c0a 2020 2020 2020  axc_ymin,.      
-000191f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019200: 2020 2020 2020 2020 2020 6c69 6e65 7769            linewi
-00019210: 6474 683d 312c 6564 6765 636f 6c6f 723d  dth=1,edgecolor=
-00019220: 276e 6f6e 6527 2c66 6163 6563 6f6c 6f72  'none',facecolor
-00019230: 3d27 6379 616e 272c 206c 6162 656c 3d27  ='cyan', label='
-00019240: 6263 6b27 2c20 616c 7068 613d 302e 332c  bck', alpha=0.3,
-00019250: 207a 6f72 6465 723d 3029 0a0a 0a0a 2020   zorder=0)....  
-00019260: 2020 2020 2020 6178 6573 5b27 4327 5d2e        axes['C'].
-00019270: 7365 745f 7469 746c 6528 2764 2920 5065  set_title('d) Pe
-00019280: 616b 7320 6f76 6572 6c61 696e 206f 6e20  aks overlain on 
-00019290: 6461 7461 2062 6566 6f72 6520 7375 6274  data before subt
-000192a0: 7261 6374 696f 6e27 290a 2020 2020 2020  raction').      
-000192b0: 2020 6178 6573 5b27 4327 5d2e 706c 6f74    axes['C'].plot
-000192c0: 2844 6961 645f 7368 6f72 745f 6469 6164  (Diad_short_diad
-000192d0: 325b 3a2c 2030 5d2c 2044 6961 645f 7368  2[:, 0], Diad_sh
-000192e0: 6f72 745f 6469 6164 325b 3a2c 2031 5d2c  ort_diad2[:, 1],
-000192f0: 2027 2e72 272c 206c 6162 656c 3d27 6461   '.r', label='da
-00019300: 7461 2729 0a20 2020 2020 2020 2061 7865  ta').        axe
-00019310: 735b 2743 275d 2e70 6c6f 7428 4261 7365  s['C'].plot(Base
-00019320: 6c69 6e65 5f64 6961 6432 5b3a 2c20 305d  line_diad2[:, 0]
-00019330: 2c20 4261 7365 6c69 6e65 5f64 6961 6432  , Baseline_diad2
-00019340: 5b3a 2c20 315d 2c20 272e 6227 2c20 6c61  [:, 1], '.b', la
-00019350: 6265 6c3d 2762 636b 2729 0a20 2020 2020  bel='bck').     
-00019360: 2020 2061 7865 735b 2743 275d 2e70 6c6f     axes['C'].plo
-00019370: 7428 4469 6164 5f73 686f 7274 5f64 6961  t(Diad_short_dia
-00019380: 6432 5b3a 2c20 305d 2c20 5079 5f62 6173  d2[:, 0], Py_bas
-00019390: 655f 6469 6164 322c 2027 2d6b 272c 206c  e_diad2, '-k', l
-000193a0: 6162 656c 3d27 506f 6c79 2062 636b 2066  abel='Poly bck f
-000193b0: 6974 2729 0a0a 0a20 2020 2020 2020 2061  it')...        a
-000193c0: 7865 735b 2743 275d 2e73 6574 5f79 6c61  xes['C'].set_yla
-000193d0: 6265 6c28 2749 6e74 656e 7369 7479 2729  bel('Intensity')
-000193e0: 0a20 2020 2020 2020 2061 7865 735b 2743  .        axes['C
-000193f0: 275d 2e73 6574 5f78 6c61 6265 6c28 2757  '].set_xlabel('W
-00019400: 6176 656e 756d 6265 7227 290a 0a0a 2020  avenumber')...  
-00019410: 2020 2020 2020 6966 2063 6f6e 6669 6731        if config1
-00019420: 2e66 6974 5f67 6175 7373 2069 7320 6e6f  .fit_gauss is no
-00019430: 7420 4661 6c73 653a 0a0a 2020 2020 2020  t False:..      
-00019440: 2020 2020 2020 6178 6573 5b27 4327 5d2e        axes['C'].
-00019450: 706c 6f74 2878 5f6c 696e 2c20 636f 6d70  plot(x_lin, comp
-00019460: 6f6e 656e 7473 2e67 6574 2827 626b 675f  onents.get('bkg_
-00019470: 2729 2b79 6261 7365 5f78 6c69 6e2c 2027  ')+ybase_xlin, '
-00019480: 2d6d 272c 206c 6162 656c 3d27 4761 7573  -m', label='Gaus
-00019490: 7369 616e 2062 636b 272c 206c 696e 6577  sian bck', linew
-000194a0: 6964 7468 3d32 290a 0a20 2020 2020 2020  idth=2)..       
-000194b0: 2061 7865 735b 2743 275d 2e70 6c6f 7428   axes['C'].plot(
-000194c0: 2078 5f6c 696e 202c 795f 6265 7374 5f66   x_lin ,y_best_f
-000194d0: 6974 2b79 6261 7365 5f78 6c69 6e2c 2027  it+ybase_xlin, '
-000194e0: 2d67 272c 206c 696e 6577 6964 7468 3d32  -g', linewidth=2
-000194f0: 2c20 6c61 6265 6c3d 2742 6573 7420 4669  , label='Best Fi
-00019500: 7427 290a 2020 2020 2020 2020 6178 6573  t').        axes
-00019510: 5b27 4327 5d2e 706c 6f74 2878 5f6c 696e  ['C'].plot(x_lin
-00019520: 2c20 636f 6d70 6f6e 656e 7473 2e67 6574  , components.get
-00019530: 2827 6c7a 315f 2729 2b79 6261 7365 5f78  ('lz1_')+ybase_x
-00019540: 6c69 6e2c 2027 2d62 272c 206c 6162 656c  lin, '-b', label
-00019550: 3d27 4469 6164 3227 2c20 6c69 6e65 7769  ='Diad2', linewi
-00019560: 6474 683d 3129 0a20 2020 2020 2020 2069  dth=1).        i
-00019570: 6620 6669 745f 7065 616b 733e 313a 0a20  f fit_peaks>1:. 
-00019580: 2020 2020 2020 2020 2020 2061 7865 735b             axes[
-00019590: 2743 275d 2e70 6c6f 7428 785f 6c69 6e2c  'C'].plot(x_lin,
-000195a0: 2063 6f6d 706f 6e65 6e74 732e 6765 7428   components.get(
-000195b0: 276c 7a32 5f27 292b 7962 6173 655f 786c  'lz2_')+ybase_xl
-000195c0: 696e 2c20 272d 7227 2c20 6c61 6265 6c3d  in, '-r', label=
-000195d0: 2748 4232 272c 206c 696e 6577 6964 7468  'HB2', linewidth
-000195e0: 3d31 290a 2020 2020 2020 2020 6966 2066  =1).        if f
-000195f0: 6974 5f70 6561 6b73 3e32 3a0a 2020 2020  it_peaks>2:.    
-00019600: 2020 2020 2020 2020 6178 6573 5b27 4327          axes['C'
-00019610: 5d2e 706c 6f74 2878 5f6c 696e 2c20 636f  ].plot(x_lin, co
-00019620: 6d70 6f6e 656e 7473 2e67 6574 2827 6c7a  mponents.get('lz
-00019630: 335f 2729 2b79 6261 7365 5f78 6c69 6e2c  3_')+ybase_xlin,
-00019640: 2027 2d63 272c 206c 6162 656c 3d27 4331   '-c', label='C1
-00019650: 3327 2c20 6c69 6e65 7769 6474 683d 3129  3', linewidth=1)
-00019660: 0a0a 2020 2020 2020 2020 6178 6573 5b27  ..        axes['
-00019670: 4327 5d2e 6c65 6765 6e64 286e 636f 6c3d  C'].legend(ncol=
-00019680: 332c 206c 6f63 3d27 6c6f 7765 7220 6365  3, loc='lower ce
-00019690: 6e74 6572 2729 0a0a 0a0a 2020 2020 2020  nter')....      
-000196a0: 2020 6178 6573 5b27 4327 5d2e 7365 745f    axes['C'].set_
-000196b0: 786c 696d 285b 6178 635f 786d 696e 2c20  xlim([axc_xmin, 
-000196c0: 6178 635f 786d 6178 5d29 0a20 2020 2020  axc_xmax]).     
-000196d0: 2020 2061 7865 735b 2743 275d 2e73 6574     axes['C'].set
-000196e0: 5f79 6c69 6d28 5b61 7863 5f79 6d69 6e2c  _ylim([axc_ymin,
-000196f0: 2061 7863 5f79 6d61 785d 290a 2020 2020   axc_ymax]).    
-00019700: 2020 2020 2361 7865 735b 2743 275d 2e70      #axes['C'].p
-00019710: 6c6f 7428 4469 6164 5f73 686f 7274 5b3a  lot(Diad_short[:
-00019720: 2c20 305d 2c20 4469 6164 5f73 686f 7274  , 0], Diad_short
-00019730: 5b3a 2c20 315d 2c20 2722 7227 2c20 6c61  [:, 1], '"r', la
-00019740: 6265 6c3d 2744 6174 6127 290a 0a0a 2020  bel='Data')...  
-00019750: 2020 2020 2020 2320 5265 7369 6475 616c        # Residual
-00019760: 206f 6e20 706c 6f74 2044 0a20 2020 2020   on plot D.     
-00019770: 2020 2061 7865 735b 2744 275d 2e73 6574     axes['D'].set
-00019780: 5f74 6974 6c65 2827 6629 2052 6573 6964  _title('f) Resid
-00019790: 7561 6c73 2729 0a20 2020 2020 2020 2061  uals').        a
-000197a0: 7865 735b 2744 275d 2e70 6c6f 7428 5b64  xes['D'].plot([d
-000197b0: 665f 6f75 745b 2744 6961 6432 5f56 6f69  f_out['Diad2_Voi
-000197c0: 6774 5f43 656e 7427 5d2c 2064 665f 6f75  gt_Cent'], df_ou
-000197d0: 745b 2744 6961 6432 5f56 6f69 6774 5f43  t['Diad2_Voigt_C
-000197e0: 656e 7427 5d5d 2c20 5b6e 702e 6d69 6e28  ent']], [np.min(
-000197f0: 7265 7369 6475 616c 5f64 6961 645f 636f  residual_diad_co
-00019800: 6f72 6473 292c 206e 702e 6d61 7828 7265  ords), np.max(re
-00019810: 7369 6475 616c 5f64 6961 645f 636f 6f72  sidual_diad_coor
-00019820: 6473 295d 2c20 273a 6227 290a 2020 2020  ds)], ':b').    
-00019830: 2020 2020 6966 2066 6974 5f70 6561 6b73      if fit_peaks
-00019840: 3e31 3a0a 2020 2020 2020 2020 2020 2020  >1:.            
-00019850: 2020 2020 6178 6573 5b27 4427 5d2e 706c      axes['D'].pl
-00019860: 6f74 285b 6466 5f6f 7574 5b27 4842 325f  ot([df_out['HB2_
-00019870: 4365 6e74 275d 2c20 6466 5f6f 7574 5b27  Cent'], df_out['
-00019880: 4842 325f 4365 6e74 275d 5d2c 205b 6e70  HB2_Cent']], [np
-00019890: 2e6d 696e 2872 6573 6964 7561 6c5f 6469  .min(residual_di
-000198a0: 6164 5f63 6f6f 7264 7329 2c20 6e70 2e6d  ad_coords), np.m
-000198b0: 6178 2872 6573 6964 7561 6c5f 6469 6164  ax(residual_diad
-000198c0: 5f63 6f6f 7264 7329 5d2c 2027 3a72 2729  _coords)], ':r')
-000198d0: 0a0a 2020 2020 2020 2020 6178 6573 5b27  ..        axes['
-000198e0: 4427 5d2e 706c 6f74 2878 6461 745f 696e  D'].plot(xdat_in
-000198f0: 7261 6e67 652c 2072 6573 6964 7561 6c5f  range, residual_
-00019900: 6469 6164 5f63 6f6f 7264 732c 2027 6f6b  diad_coords, 'ok
-00019910: 272c 206d 6663 3d27 6327 2029 0a20 2020  ', mfc='c' ).   
-00019920: 2020 2020 2061 7865 735b 2744 275d 2e70       axes['D'].p
-00019930: 6c6f 7428 7864 6174 5f69 6e72 616e 6765  lot(xdat_inrange
-00019940: 2c20 7265 7369 6475 616c 5f64 6961 645f  , residual_diad_
-00019950: 636f 6f72 6473 2c20 272d 6327 2029 0a20  coords, '-c' ). 
-00019960: 2020 2020 2020 2061 7865 735b 2744 275d         axes['D']
-00019970: 2e73 6574 5f79 6c61 6265 6c28 2752 6573  .set_ylabel('Res
-00019980: 6964 7561 6c27 290a 2020 2020 2020 2020  idual').        
-00019990: 6178 6573 5b27 4427 5d2e 7365 745f 786c  axes['D'].set_xl
-000199a0: 6162 656c 2827 5761 7665 6e75 6d62 6572  abel('Wavenumber
-000199b0: 2729 0a20 2020 2020 2020 2023 2061 7865  ').        # axe
-000199c0: 735b 2744 275d 2e73 6574 5f78 6c69 6d28  s['D'].set_xlim(
-000199d0: 6178 315f 786c 696d 290a 2020 2020 2020  ax1_xlim).      
-000199e0: 2020 2320 6178 6573 5b27 4427 5d2e 7365    # axes['D'].se
-000199f0: 745f 786c 696d 2861 7832 5f78 6c69 6d29  t_xlim(ax2_xlim)
-00019a00: 0a20 2020 2020 2020 204c 6f63 616c 5f52  .        Local_R
-00019a10: 6573 6964 7561 6c5f 6469 6164 323d 7265  esidual_diad2=re
-00019a20: 7369 6475 616c 5f64 6961 645f 636f 6f72  sidual_diad_coor
-00019a30: 6473 5b28 2878 6461 745f 696e 7261 6e67  ds[((xdat_inrang
-00019a40: 653e 2864 665f 6f75 745b 2744 6961 6432  e>(df_out['Diad2
-00019a50: 5f56 6f69 6774 5f43 656e 7427 5d5b 305d  _Voigt_Cent'][0]
-00019a60: 2d63 6f6e 6669 6731 2e78 5f72 616e 6765  -config1.x_range
-00019a70: 5f72 6573 6964 7561 6c29 290a 2020 2020  _residual)).    
-00019a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019aa0: 2020 2020 2020 2020 2020 2020 2628 7864              &(xd
-00019ab0: 6174 5f69 6e72 616e 6765 3c64 665f 6f75  at_inrange<df_ou
-00019ac0: 745b 2744 6961 6432 5f56 6f69 6774 5f43  t['Diad2_Voigt_C
-00019ad0: 656e 7427 5d5b 305d 2b63 6f6e 6669 6731  ent'][0]+config1
-00019ae0: 2e78 5f72 616e 6765 5f72 6573 6964 7561  .x_range_residua
-00019af0: 6c29 295d 0a20 2020 2020 2020 2061 7865  l))].        axe
-00019b00: 735b 2744 275d 2e73 6574 5f78 6c69 6d28  s['D'].set_xlim(
-00019b10: 5b64 665f 6f75 745b 2744 6961 6432 5f56  [df_out['Diad2_V
-00019b20: 6f69 6774 5f43 656e 7427 5d5b 305d 2d63  oigt_Cent'][0]-c
-00019b30: 6f6e 6669 6731 2e78 5f72 616e 6765 5f72  onfig1.x_range_r
-00019b40: 6573 6964 7561 6c2c 0a20 2020 2020 2020  esidual,.       
-00019b50: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-00019b60: 6f75 745b 2744 6961 6432 5f56 6f69 6774  out['Diad2_Voigt
-00019b70: 5f43 656e 7427 5d5b 305d 2b63 6f6e 6669  _Cent'][0]+confi
-00019b80: 6731 2e78 5f72 616e 6765 5f72 6573 6964  g1.x_range_resid
-00019b90: 7561 6c5d 290a 2020 2020 2020 2020 2361  ual]).        #a
-00019ba0: 7835 2e70 6c6f 7428 5b63 656e 745f 3131  x5.plot([cent_11
-00019bb0: 3137 2c20 6365 6e74 5f31 3131 3720 5d2c  17, cent_1117 ],
-00019bc0: 205b 6e70 2e6d 696e 284c 6f63 616c 5f52   [np.min(Local_R
-00019bd0: 6573 6964 7561 6c5f 3131 3137 292d 3130  esidual_1117)-10
-00019be0: 2c20 6e70 2e6d 6178 284c 6f63 616c 5f52  , np.max(Local_R
-00019bf0: 6573 6964 7561 6c5f 3131 3137 292b 3130  esidual_1117)+10
-00019c00: 5d2c 2027 3a6b 2729 0a20 2020 2020 2020  ], ':k').       
-00019c10: 2061 7865 735b 2744 275d 2e73 6574 5f79   axes['D'].set_y
-00019c20: 6c69 6d28 5b6e 702e 6d69 6e28 4c6f 6361  lim([np.min(Loca
-00019c30: 6c5f 5265 7369 6475 616c 5f64 6961 6432  l_Residual_diad2
-00019c40: 292d 3130 2c20 6e70 2e6d 6178 284c 6f63  )-10, np.max(Loc
-00019c50: 616c 5f52 6573 6964 7561 6c5f 6469 6164  al_Residual_diad
-00019c60: 3229 2b31 305d 290a 0a0a 0a0a 0a20 2020  2)+10])......   
-00019c70: 2020 2020 2023 204f 7665 7261 6c20 7370       # Overal sp
-00019c80: 6563 7472 610a 2020 2020 2020 2020 6178  ectra.        ax
-00019c90: 6573 5b27 4527 5d2e 7365 745f 7469 746c  es['E'].set_titl
-00019ca0: 6528 2767 2920 5375 6d6d 6172 7920 706c  e('g) Summary pl
-00019cb0: 6f74 206f 6620 7261 7720 7370 6563 7472  ot of raw spectr
-00019cc0: 6120 666f 7220 6669 6c65 203d 2027 202b  a for file = ' +
-00019cd0: 2066 696c 656e 616d 6529 0a20 2020 2020   filename).     
-00019ce0: 2020 2061 7865 735b 2745 275d 2e70 6c6f     axes['E'].plo
-00019cf0: 7428 5370 6563 7472 615b 3a2c 2030 5d2c  t(Spectra[:, 0],
-00019d00: 2053 7065 6374 7261 5b3a 2c20 315d 2c20   Spectra[:, 1], 
-00019d10: 272d 7227 290a 2020 2020 2020 2020 6178  '-r').        ax
-00019d20: 6573 5b27 4527 5d2e 7365 745f 796c 6162  es['E'].set_ylab
-00019d30: 656c 2827 496e 7465 6e73 6974 7927 290a  el('Intensity').
-00019d40: 2020 2020 2020 2020 6178 6573 5b27 4527          axes['E'
-00019d50: 5d2e 7365 745f 786c 6162 656c 2827 5761  ].set_xlabel('Wa
-00019d60: 7665 6e75 6d62 6572 2729 0a0a 0a0a 0a20  venumber')..... 
-00019d70: 2020 2020 2020 2070 6174 6833 3d70 6174         path3=pat
-00019d80: 682b 272f 272b 2764 6961 645f 6669 745f  h+'/'+'diad_fit_
-00019d90: 696d 6167 6573 270a 2020 2020 2020 2020  images'.        
-00019da0: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
-00019db0: 7328 7061 7468 3329 3a0a 2020 2020 2020  s(path3):.      
-00019dc0: 2020 2020 2020 6f75 743d 2770 6174 6820        out='path 
-00019dd0: 6578 6973 7473 270a 2020 2020 2020 2020  exists'.        
-00019de0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00019df0: 2020 6f73 2e6d 616b 6564 6972 7328 7061    os.makedirs(pa
-00019e00: 7468 2b27 2f27 2b20 2764 6961 645f 6669  th+'/'+ 'diad_fi
-00019e10: 745f 696d 6167 6573 272c 2065 7869 7374  t_images', exist
-00019e20: 5f6f 6b3d 4661 6c73 6529 0a0a 2020 2020  _ok=False)..    
-00019e30: 2020 2020 6669 672e 7469 6768 745f 6c61      fig.tight_la
-00019e40: 796f 7574 2829 0a0a 2020 2020 2020 2020  yout()..        
-00019e50: 6669 6c65 3d66 696c 656e 616d 652e 7273  file=filename.rs
-00019e60: 706c 6974 2827 2e74 7874 272c 2031 295b  plit('.txt', 1)[
-00019e70: 305d 0a20 2020 2020 2020 2066 6967 2e73  0].        fig.s
-00019e80: 6176 6566 6967 2870 6174 6833 2b27 2f27  avefig(path3+'/'
-00019e90: 2b27 6469 6164 325f 4669 745f 7b7d 2e70  +'diad2_Fit_{}.p
-00019ea0: 6e67 272e 666f 726d 6174 2866 696c 6529  ng'.format(file)
-00019eb0: 2c20 6470 693d 636f 6e66 6967 312e 6470  , dpi=config1.dp
-00019ec0: 6929 0a0a 0a20 2020 2069 6620 636c 6f73  i)...    if clos
-00019ed0: 655f 6669 6775 7265 2069 7320 5472 7565  e_figure is True
-00019ee0: 3a0a 2020 2020 2020 2020 706c 742e 636c  :.        plt.cl
-00019ef0: 6f73 6528 6669 6729 0a0a 2020 2020 2320  ose(fig)..    # 
-00019f00: 4c65 7473 2063 616c 6375 6c61 7465 2070  Lets calculate p
-00019f10: 6561 6b20 736b 6577 6e65 7373 2068 6572  eak skewness her
-00019f20: 652e 0a20 2020 2053 6b65 7735 303d 6173  e..    Skew50=as
-00019f30: 7365 7373 5f64 6961 6432 5f73 6b65 776e  sess_diad2_skewn
-00019f40: 6573 7328 636f 6e66 6967 313d 6469 6164  ess(config1=diad
-00019f50: 325f 6669 745f 636f 6e66 6967 2829 2c20  2_fit_config(), 
-00019f60: 696e 745f 6375 745f 6f66 663d 302e 352c  int_cut_off=0.5,
-00019f70: 2070 6174 683d 7061 7468 2c20 6669 6c65   path=path, file
-00019f80: 6e61 6d65 3d66 696c 656e 616d 652c 2066  name=filename, f
-00019f90: 696c 6574 7970 653d 6669 6c65 7479 7065  iletype=filetype
-00019fa0: 2c0a 2020 2020 736b 6577 6e65 7373 3d27  ,.    skewness='
-00019fb0: 6162 7327 2c20 6865 6967 6874 3d31 2c20  abs', height=1, 
-00019fc0: 7072 6f6d 696e 656e 6365 3d35 2c20 7769  prominence=5, wi
-00019fd0: 6474 683d 302e 352c 2070 6c6f 745f 6669  dth=0.5, plot_fi
-00019fe0: 6775 7265 3d46 616c 7365 2c20 6469 6164  gure=False, diad
-00019ff0: 5f61 7272 6179 3d64 6961 645f 6172 7261  _array=diad_arra
-0001a000: 7929 0a20 2020 2053 6b65 7738 303d 6173  y).    Skew80=as
-0001a010: 7365 7373 5f64 6961 6432 5f73 6b65 776e  sess_diad2_skewn
-0001a020: 6573 7328 636f 6e66 6967 313d 6469 6164  ess(config1=diad
-0001a030: 325f 6669 745f 636f 6e66 6967 2829 2c20  2_fit_config(), 
-0001a040: 696e 745f 6375 745f 6f66 663d 302e 332c  int_cut_off=0.3,
-0001a050: 2070 6174 683d 7061 7468 2c20 6669 6c65   path=path, file
-0001a060: 6e61 6d65 3d66 696c 656e 616d 652c 2066  name=filename, f
-0001a070: 696c 6574 7970 653d 6669 6c65 7479 7065  iletype=filetype
-0001a080: 2c0a 2020 2020 736b 6577 6e65 7373 3d27  ,.    skewness='
-0001a090: 6162 7327 2c20 6865 6967 6874 3d31 2c20  abs', height=1, 
-0001a0a0: 7072 6f6d 696e 656e 6365 3d35 2c20 7769  prominence=5, wi
-0001a0b0: 6474 683d 302e 352c 2070 6c6f 745f 6669  dth=0.5, plot_fi
-0001a0c0: 6775 7265 3d46 616c 7365 2c20 6469 6164  gure=False, diad
-0001a0d0: 5f61 7272 6179 3d64 6961 645f 6172 7261  _array=diad_arra
-0001a0e0: 7929 0a20 2020 2064 665f 6f75 745b 2744  y).    df_out['D
-0001a0f0: 6961 6432 5f41 7379 6d35 3027 5d3d 536b  iad2_Asym50']=Sk
-0001a100: 6577 3530 5b27 536b 6577 6e65 7373 5f64  ew50['Skewness_d
-0001a110: 6961 6432 275d 0a20 2020 2064 665f 6f75  iad2'].    df_ou
-0001a120: 745b 2744 6961 6432 5f41 7379 6d37 3027  t['Diad2_Asym70'
-0001a130: 5d3d 536b 6577 3830 5b27 536b 6577 6e65  ]=Skew80['Skewne
-0001a140: 7373 5f64 6961 6432 275d 0a20 2020 2064  ss_diad2'].    d
-0001a150: 665f 6f75 745b 2744 6961 6432 5f59 7561  f_out['Diad2_Yua
-0001a160: 6e32 3031 375f 7379 6d5f 6661 6374 6f72  n2017_sym_factor
-0001a170: 275d 3d28 6466 5f6f 7574 5b27 4469 6164  ']=(df_out['Diad
-0001a180: 325f 6677 686d 275d 292a 2864 665f 6f75  2_fwhm'])*(df_ou
-0001a190: 745b 2744 6961 6432 5f41 7379 6d35 3027  t['Diad2_Asym50'
-0001a1a0: 5d2d 3129 0a20 2020 2064 665f 6f75 745b  ]-1).    df_out[
-0001a1b0: 2744 6961 6432 5f52 656d 6967 6932 3032  'Diad2_Remigi202
-0001a1c0: 315f 4253 4627 5d3d 6466 5f6f 7574 5b27  1_BSF']=df_out['
-0001a1d0: 4469 6164 325f 6677 686d 275d 2f64 665f  Diad2_fwhm']/df_
-0001a1e0: 6f75 745b 2744 6961 6432 5f43 6f6d 626f  out['Diad2_Combo
-0001a1f0: 6669 745f 4865 6967 6874 275d 0a20 2020  fit_Height'].   
-0001a200: 2064 665f 6f75 745b 2744 6961 6432 5f50   df_out['Diad2_P
-0001a210: 4446 5f4d 6f64 656c 275d 3d6d 6f64 656c  DF_Model']=model
-0001a220: 0a0a 0a20 2020 2069 6620 2063 6f6e 6669  ...    if  confi
-0001a230: 6731 2e72 6574 7572 6e5f 6f74 6865 725f  g1.return_other_
-0001a240: 7061 7261 6d73 2069 7320 4661 6c73 653a  params is False:
-0001a250: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001a260: 6466 5f6f 7574 0a20 2020 2065 6c73 653a  df_out.    else:
-0001a270: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001a280: 6466 5f6f 7574 2c20 7265 7375 6c74 2c20  df_out, result, 
-0001a290: 795f 6265 7374 5f66 6974 2c20 785f 6c69  y_best_fit, x_li
-0001a2a0: 6e0a 0a0a 0a0a 6465 6620 6669 745f 6469  n.....def fit_di
-0001a2b0: 6164 5f31 5f77 5f62 636b 282a 2c20 636f  ad_1_w_bck(*, co
-0001a2c0: 6e66 6967 313a 2064 6961 6431 5f66 6974  nfig1: diad1_fit
-0001a2d0: 5f63 6f6e 6669 673d 6469 6164 315f 6669  _config=diad1_fi
-0001a2e0: 745f 636f 6e66 6967 2829 2c20 636f 6e66  t_config(), conf
-0001a2f0: 6967 323a 2064 6961 645f 6964 5f63 6f6e  ig2: diad_id_con
-0001a300: 6669 673d 6469 6164 5f69 645f 636f 6e66  fig=diad_id_conf
-0001a310: 6967 2829 2c0a 2020 2020 7061 7468 3d4e  ig(),.    path=N
-0001a320: 6f6e 652c 2066 696c 656e 616d 653d 4e6f  one, filename=No
-0001a330: 6e65 2c20 6669 6c65 7479 7065 3d4e 6f6e  ne, filetype=Non
-0001a340: 652c 2020 706c 6f74 5f66 6967 7572 653d  e,  plot_figure=
-0001a350: 5472 7565 2c20 636c 6f73 655f 6669 6775  True, close_figu
-0001a360: 7265 3d54 7275 652c 2044 6961 645f 706f  re=True, Diad_po
-0001a370: 733d 4e6f 6e65 2c20 4842 5f70 6f73 3d4e  s=None, HB_pos=N
-0001a380: 6f6e 652c 2064 6961 645f 6172 7261 793d  one, diad_array=
-0001a390: 4e6f 6e65 293a 0a20 2020 2022 2222 2054  None):.    """ T
-0001a3a0: 6869 7320 6675 6e63 7469 6f6e 2066 6974  his function fit
-0001a3b0: 7320 7468 6520 6261 636b 6772 6f75 6e64  s the background
-0001a3c0: 2028 7573 696e 6720 7468 6520 6675 6e63   (using the func
-0001a3d0: 7469 6f6e 2072 656d 6f76 655f 6469 6164  tion remove_diad
-0001a3e0: 5f62 6173 656c 696e 6529 2061 6e64 2074  _baseline) and t
-0001a3f0: 6865 6e20 6669 7473 2074 6865 2070 6561  hen fits the pea
-0001a400: 6b73 0a20 2020 2075 7369 6e67 2066 6974  ks.    using fit
-0001a410: 5f67 6175 7373 6961 6e5f 766f 6967 745f  _gaussian_voigt_
-0001a420: 6765 6e65 7269 635f 6469 6164 2829 0a20  generic_diad(). 
-0001a430: 2020 2049 7420 7468 656e 2063 6865 636b     It then check
-0001a440: 7320 6966 2061 6e79 2070 6172 616d 6574  s if any paramet
-0001a450: 6572 7320 6172 6520 7269 6768 7420 6174  ers are right at
-0001a460: 2074 6865 2070 6572 6d69 7474 6564 2065   the permitted e
-0001a470: 6467 6520 286d 6561 6e69 6e67 2066 6974  dge (meaning fit
-0001a480: 7469 6e67 2064 6964 6e74 2063 6f6e 7665  ting didnt conve
-0001a490: 7267 6529 2c0a 2020 2020 616e 6420 7472  rge),.    and tr
-0001a4a0: 6965 7320 6669 7474 696e 6720 6966 2073  ies fitting if s
-0001a4b0: 6f2e 2054 6865 6e20 6974 206d 616b 6573  o. Then it makes
-0001a4c0: 2061 2070 6c6f 740a 2020 2020 6f66 2074   a plot.    of t
-0001a4d0: 6865 2076 6172 696f 7573 2070 6172 7473  he various parts
-0001a4e0: 206f 6620 7468 6520 6669 7474 696e 6720   of the fitting 
-0001a4f0: 7072 6f63 6564 7572 652c 2061 6e64 2072  procedure, and r
-0001a500: 6574 7572 6e73 2061 2064 6174 6166 7261  eturns a datafra
-0001a510: 6d65 206f 6620 7468 6520 6669 7420 7061  me of the fit pa
-0001a520: 7261 6d65 7465 7273 2e0a 0a0a 2020 2020  rameters....    
-0001a530: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-0001a540: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064  ----------.    d
-0001a550: 6961 645f 6964 5f63 6f6e 6669 6728 290a  iad_id_config().
-0001a560: 2020 2020 2020 2020 4461 7461 636c 6173          Dataclas
-0001a570: 7320 6f66 2070 6172 616d 6574 6572 7320  s of parameters 
-0001a580: 7573 6564 2074 6f20 6c6f 6f6b 2066 6f72  used to look for
-0001a590: 2070 6561 6b73 2e20 5573 6573 2061 6e79   peaks. Uses any
-0001a5a0: 2065 7863 6c75 6465 6420 7261 6e67 6573   excluded ranges
-0001a5b0: 2066 726f 6d20 7468 6973 2e0a 0a20 2020   from this...   
-0001a5c0: 2064 6961 6431 5f66 6974 5f63 6f6e 6669   diad1_fit_confi
-0001a5d0: 6728 290a 2020 2020 2020 2020 4461 7461  g().        Data
-0001a5e0: 636c 6173 7320 6f66 2070 6172 616d 6574  class of paramet
-0001a5f0: 6572 7320 7573 6564 2074 6f20 6669 6e64  ers used to find
-0001a600: 2070 6561 6b73 2e20 5573 6520 6865 6c70   peaks. Use help
-0001a610: 206f 6e20 7468 6973 2064 6174 6163 6c61   on this datacla
-0001a620: 7373 2074 6f20 6765 7420 6f70 7469 6f6e  ss to get option
-0001a630: 730a 0a0a 2020 2020 7061 7468 3a20 7374  s...    path: st
-0001a640: 720a 2020 2020 2020 2020 466f 6c64 6572  r.        Folder
-0001a650: 2075 7365 7220 7769 7368 6573 2074 6f20   user wishes to 
-0001a660: 7265 6164 2064 6174 6120 6672 6f6d 0a0a  read data from..
-0001a670: 2020 2020 6669 6c65 6e61 6d65 3a20 7374      filename: st
-0001a680: 720a 2020 2020 2020 2020 5370 6563 6966  r.        Specif
-0001a690: 6963 206e 616d 6520 6f66 2066 696c 6520  ic name of file 
-0001a6a0: 6265 696e 6720 7573 6564 2e0a 0a20 2020  being used...   
-0001a6b0: 2066 696c 6574 7970 653a 2073 7472 0a20   filetype: str. 
-0001a6c0: 2020 2020 2020 2049 6465 6e74 6966 6965         Identifie
-0001a6d0: 7320 7479 7065 206f 6620 6669 6c65 2e20  s type of file. 
-0001a6e0: 6368 6f6f 7365 2066 726f 6d20 2757 6974  choose from 'Wit
-0001a6f0: 6563 5f41 5343 4949 272c 2027 6865 6164  ec_ASCII', 'head
-0001a700: 6c65 7373 5f74 7874 272c 2027 6865 6164  less_txt', 'head
-0001a710: 6c65 7373 5f63 7376 272c 2027 6865 6164  less_csv', 'head
-0001a720: 5f63 7376 272c 2027 5769 7465 635f 4153  _csv', 'Witec_AS
-0001a730: 4349 4927 2c0a 2020 2020 2020 2020 2748  CII',.        'H
-0001a740: 4f52 4942 415f 7478 7427 2c20 2752 656e  ORIBA_txt', 'Ren
-0001a750: 6973 6861 775f 7478 7427 0a0a 2020 2020  ishaw_txt'..    
-0001a760: 706c 6f74 5f66 6967 7572 653a 2062 6f6f  plot_figure: boo
-0001a770: 6c0a 2020 2020 2020 2020 6966 2054 7275  l.        if Tru
-0001a780: 652c 2073 6176 6573 2066 6967 7572 650a  e, saves figure.
-0001a790: 0a20 2020 2044 6961 645f 706f 733a 2066  .    Diad_pos: f
-0001a7a0: 6c6f 6174 0a20 2020 2020 2020 2045 7374  loat.        Est
-0001a7b0: 696d 6174 6520 6f66 2064 6961 6420 706f  imate of diad po
-0001a7c0: 7369 7469 6f6e 0a0a 2020 2020 4842 5f70  sition..    HB_p
-0001a7d0: 6f73 3a20 666c 6f61 740a 2020 2020 2020  os: float.      
-0001a7e0: 2020 4573 7469 6d61 7465 206f 6620 4842    Estimate of HB
-0001a7f0: 2070 6f73 6974 696f 6e0a 0a0a 2020 2020   position...    
-0001a800: 636c 6f73 655f 6669 673a 2062 6f6f 6c0a  close_fig: bool.
-0001a810: 2020 2020 2020 2020 6966 2054 7275 652c          if True,
-0001a820: 2064 6973 706c 6179 7320 6669 6775 7265   displays figure
-0001a830: 2069 6e20 4e6f 7465 626f 6f6b 2e20 4966   in Notebook. If
-0001a840: 2046 616c 7365 2c20 636c 6f73 6573 2069   False, closes i
-0001a850: 7420 2879 6f75 2063 616e 2073 7469 6c6c  t (you can still
-0001a860: 2066 696e 6420 6974 2073 6176 6564 290a   find it saved).
-0001a870: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
-0001a880: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020   ------------.  
-0001a890: 2020 6966 2072 6574 7572 6e5f 6f74 6865    if return_othe
-0001a8a0: 725f 7061 7261 6d73 2069 7320 4661 6c73  r_params is Fals
-0001a8b0: 6520 2864 6566 6175 6c74 290a 2020 2020  e (default).    
-0001a8c0: 2020 2020 7265 7475 726e 7320 6120 6461      returns a da
-0001a8d0: 7461 6672 616d 6520 6f66 2070 6561 6b20  taframe of peak 
-0001a8e0: 7061 7261 6d65 7465 7273 0a20 2020 2069  parameters.    i
-0001a8f0: 6620 5472 7565 2c20 616c 736f 2072 6574  f True, also ret
-0001a900: 7572 6e73 3a0a 2020 2020 2020 2020 2020  urns:.          
-0001a910: 2020 7265 7375 6c74 3a20 6669 7420 7061    result: fit pa
-0001a920: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-0001a930: 2020 2020 2079 5f62 6573 745f 6669 743a       y_best_fit:
-0001a940: 2062 6573 7420 6669 7420 746f 2061 6c6c   best fit to all
-0001a950: 2063 7572 7665 7320 696e 2079 0a20 2020   curves in y.   
-0001a960: 2020 2020 2020 2020 2078 5f6c 696e 3a20           x_lin: 
-0001a970: 6c69 6e73 7061 6365 206f 6620 6265 7374  linspace of best
-0001a980: 2066 6974 2063 6f6f 7264 696e 6174 6573   fit coordinates
-0001a990: 2069 6e20 782e 0a0a 0a22 2222 0a0a 2020   in x...."""..  
-0001a9a0: 2020 6966 2027 4352 5227 2069 6e20 6669    if 'CRR' in fi
-0001a9b0: 6c65 6e61 6d65 3a0a 2020 2020 2020 2020  lename:.        
-0001a9c0: 6669 6c65 7479 7065 3d27 6865 6164 6c65  filetype='headle
-0001a9d0: 7373 5f74 7874 270a 0a20 2020 206d 6f64  ss_txt'..    mod
-0001a9e0: 656c 3d63 6f6e 6669 6731 2e6d 6f64 656c  el=config1.model
-0001a9f0: 5f6e 616d 650a 0a20 2020 2069 6620 6d6f  _name..    if mo
-0001aa00: 6465 6c20 6e6f 7420 696e 2061 6c6c 6f77  del not in allow
-0001aa10: 6564 5f6d 6f64 656c 733a 0a20 2020 2020  ed_models:.     
-0001aa20: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0001aa30: 726f 7228 6622 556e 7375 7070 6f72 7465  ror(f"Unsupporte
-0001aa40: 6420 6d6f 6465 6c3a 207b 6d6f 6465 6c7d  d model: {model}
-0001aa50: 2e20 5375 7070 6f72 7465 6420 6d6f 6465  . Supported mode
-0001aa60: 6c73 2061 7265 3a20 7b27 2c20 272e 6a6f  ls are: {', '.jo
-0001aa70: 696e 2861 6c6c 6f77 6564 5f6d 6f64 656c  in(allowed_model
-0001aa80: 7329 7d22 290a 0a20 2020 2066 6974 5f70  s)}")..    fit_p
-0001aa90: 6561 6b73 3d63 6f6e 6669 6731 2e66 6974  eaks=config1.fit
-0001aaa0: 5f70 6561 6b73 0a0a 2020 2020 6966 2066  _peaks..    if f
-0001aab0: 6974 5f70 6561 6b73 3d3d 323a 0a20 2020  it_peaks==2:.   
-0001aac0: 2020 2020 2069 6620 6e70 2e69 736e 616e       if np.isnan
-0001aad0: 2848 425f 706f 7329 3d3d 5472 7565 206f  (HB_pos)==True o
-0001aae0: 7220 636f 6e66 6967 312e 4842 5f70 726f  r config1.HB_pro
-0001aaf0: 6d3c 2d35 303a 0a20 2020 2020 2020 2020  m<-50:.         
-0001ab00: 2020 2066 6974 5f70 6561 6b73 3d31 0a20     fit_peaks=1. 
-0001ab10: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-0001ab20: 6731 2e66 6974 5f67 6175 7373 3d46 616c  g1.fit_gauss=Fal
-0001ab30: 7365 0a20 2020 2020 2020 2020 2020 2023  se.            #
-0001ab40: 7072 696e 7428 2745 6974 6865 7220 6e6f  print('Either no
-0001ab50: 2068 6220 706f 7369 7469 6f6e 2c20 6f72   hb position, or
-0001ab60: 2070 726f 6d69 6e65 6e63 653c 2d35 302c   prominence<-50,
-0001ab70: 2075 7369 6e67 2031 2066 6974 2729 0a0a   using 1 fit')..
-0001ab80: 2020 2020 6966 2064 6961 645f 6172 7261      if diad_arra
-0001ab90: 7920 6973 204e 6f6e 653a 0a20 2020 2020  y is None:.     
-0001aba0: 2020 2044 6961 645f 6466 3d67 6574 5f64     Diad_df=get_d
-0001abb0: 6174 6128 7061 7468 3d70 6174 682c 2066  ata(path=path, f
-0001abc0: 696c 656e 616d 653d 6669 6c65 6e61 6d65  ilename=filename
-0001abd0: 2c20 6669 6c65 7479 7065 3d66 696c 6574  , filetype=filet
-0001abe0: 7970 6529 0a20 2020 2020 2020 2044 6961  ype).        Dia
-0001abf0: 643d 6e70 2e61 7272 6179 2844 6961 645f  d=np.array(Diad_
-0001ac00: 6466 290a 2020 2020 656c 7365 3a0a 2020  df).    else:.  
-0001ac10: 2020 2020 2020 4469 6164 3d64 6961 645f        Diad=diad_
-0001ac20: 6172 7261 790a 2020 2020 2320 4669 7273  array.    # Firs
-0001ac30: 742c 2077 6520 6665 6564 2064 6174 6120  t, we feed data 
-0001ac40: 696e 746f 2074 6865 2072 656d 6f76 6520  into the remove 
-0001ac50: 6261 7365 6c69 6e65 2066 756e 6374 696f  baseline functio
-0001ac60: 6e2c 2077 6869 6368 2072 6574 7572 6e73  n, which returns
-0001ac70: 2063 6f72 7265 6374 6564 2064 6174 610a   corrected data.
-0001ac80: 0a20 2020 2079 5f63 6f72 725f 6469 6164  .    y_corr_diad
-0001ac90: 312c 2050 795f 6261 7365 5f64 6961 6431  1, Py_base_diad1
-0001aca0: 2c20 785f 6469 6164 312c 2020 4469 6164  , x_diad1,  Diad
-0001acb0: 5f73 686f 7274 5f64 6961 6431 2c20 5079  _short_diad1, Py
-0001acc0: 5f62 6173 655f 6469 6164 312c 2050 665f  _base_diad1, Pf_
-0001acd0: 6261 7365 6c69 6e65 5f64 6961 6431 2c20  baseline_diad1, 
-0001ace0: 2042 6173 656c 696e 655f 7973 7562 5f64   Baseline_ysub_d
-0001acf0: 6961 6431 2c20 4261 7365 6c69 6e65 5f78  iad1, Baseline_x
-0001ad00: 5f64 6961 6431 2c20 4261 7365 6c69 6e65  _diad1, Baseline
-0001ad10: 5f64 6961 6431 2c20 7370 616e 5f64 6961  _diad1, span_dia
-0001ad20: 6431 3d72 656d 6f76 655f 6469 6164 5f62  d1=remove_diad_b
-0001ad30: 6173 656c 696e 6528 0a20 2020 7061 7468  aseline(.   path
-0001ad40: 3d70 6174 682c 2066 696c 656e 616d 653d  =path, filename=
-0001ad50: 6669 6c65 6e61 6d65 2c20 6669 6c65 7479  filename, filety
-0001ad60: 7065 3d66 696c 6574 7970 652c 2065 7863  pe=filetype, exc
-0001ad70: 6c75 6465 5f72 616e 6765 313d 636f 6e66  lude_range1=conf
-0001ad80: 6967 322e 6578 636c 7564 655f 7261 6e67  ig2.exclude_rang
-0001ad90: 6531 2c20 6578 636c 7564 655f 7261 6e67  e1, exclude_rang
-0001ada0: 6532 3d63 6f6e 6669 6732 2e65 7863 6c75  e2=config2.exclu
-0001adb0: 6465 5f72 616e 6765 322c 204e 5f70 6f6c  de_range2, N_pol
-0001adc0: 793d 636f 6e66 6967 312e 4e5f 706f 6c79  y=config1.N_poly
-0001add0: 5f62 636b 5f64 6961 6431 2c0a 2020 2020  _bck_diad1,.    
-0001ade0: 6c6f 7765 725f 6263 6b3d 636f 6e66 6967  lower_bck=config
-0001adf0: 312e 6c6f 7765 725f 6263 6b5f 6469 6164  1.lower_bck_diad
-0001ae00: 312c 2075 7070 6572 5f62 636b 3d63 6f6e  1, upper_bck=con
-0001ae10: 6669 6731 2e75 7070 6572 5f62 636b 5f64  fig1.upper_bck_d
-0001ae20: 6961 6431 2c20 706c 6f74 5f66 6967 7572  iad1, plot_figur
-0001ae30: 653d 4661 6c73 652c 2064 6961 645f 6172  e=False, diad_ar
-0001ae40: 7261 793d 6469 6164 5f61 7272 6179 290a  ray=diad_array).
-0001ae50: 0a0a 0a0a 0a20 2020 2023 2054 6865 6e2c  .....    # Then,
-0001ae60: 2077 6520 6665 6564 2074 6869 7320 6261   we feed this ba
-0001ae70: 7365 6c69 6e65 2d63 6f72 7265 6374 6564  seline-corrected
-0001ae80: 2064 6174 6120 696e 746f 2074 6865 2063   data into the c
-0001ae90: 6f6d 6269 6e65 6420 6761 7573 7369 616e  ombined gaussian
-0001aea0: 2d76 6f69 6774 2070 6561 6b20 6669 7474  -voigt peak fitt
-0001aeb0: 696e 6720 6675 6e63 7469 6f6e 0a0a 2020  ing function..  
-0001aec0: 2020 7265 7375 6c74 2c20 6466 5f6f 7574    result, df_out
-0001aed0: 2c20 795f 6265 7374 5f66 6974 2c20 785f  , y_best_fit, x_
-0001aee0: 6c69 6e2c 2063 6f6d 706f 6e65 6e74 732c  lin, components,
-0001aef0: 2078 6461 742c 2079 6461 742c 2061 7831   xdat, ydat, ax1
-0001af00: 5f78 6c69 6d2c 2061 7832 5f78 6c69 6d2c  _xlim, ax2_xlim,
-0001af10: 7265 7369 6475 616c 5f64 6961 645f 636f  residual_diad_co
-0001af20: 6f72 6473 2c20 7964 6174 5f69 6e72 616e  ords, ydat_inran
-0001af30: 6765 2c20 2078 6461 745f 696e 7261 6e67  ge,  xdat_inrang
-0001af40: 653d 6669 745f 6761 7573 7369 616e 5f76  e=fit_gaussian_v
-0001af50: 6f69 6774 5f67 656e 6572 6963 5f64 6961  oigt_generic_dia
-0001af60: 6428 636f 6e66 6967 312c 6469 6164 313d  d(config1,diad1=
-0001af70: 5472 7565 2c20 7061 7468 3d70 6174 682c  True, path=path,
-0001af80: 2066 696c 656e 616d 653d 6669 6c65 6e61   filename=filena
-0001af90: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-0001afa0: 2020 2020 2020 2020 7864 6174 3d78 5f64          xdat=x_d
-0001afb0: 6961 6431 2c20 7964 6174 3d79 5f63 6f72  iad1, ydat=y_cor
-0001afc0: 725f 6469 6164 312c 0a20 2020 2020 2020  r_diad1,.       
-0001afd0: 2020 2020 2020 2020 2020 2020 2073 7061               spa
-0001afe0: 6e3d 7370 616e 5f64 6961 6431 2c20 706c  n=span_diad1, pl
-0001aff0: 6f74 5f66 6967 7572 653d 4661 6c73 652c  ot_figure=False,
-0001b000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b010: 2020 2020 2044 6961 645f 706f 733d 4469       Diad_pos=Di
-0001b020: 6164 5f70 6f73 2c20 4842 5f70 6f73 3d48  ad_pos, HB_pos=H
-0001b030: 425f 706f 732c 6669 745f 7065 616b 733d  B_pos,fit_peaks=
-0001b040: 6669 745f 7065 616b 7329 0a0a 0a0a 2020  fit_peaks)....  
-0001b050: 2020 2320 6966 2064 665f 6f75 745b 2744    # if df_out['D
-0001b060: 6961 6431 5f63 656e 745f 6572 7227 5d2e  iad1_cent_err'].
-0001b070: 696c 6f63 5b30 5d3d 3d30 3a0a 2020 2020  iloc[0]==0:.    
-0001b080: 2320 2020 2020 6966 2063 6f6e 6669 6731  #     if config1
-0001b090: 2e66 6974 5f70 6561 6b73 3e31 3a0a 2020  .fit_peaks>1:.  
-0001b0a0: 2020 2320 2020 2020 2020 2020 636f 6e66    #         conf
-0001b0b0: 6967 5f74 7765 616b 6564 2e66 6974 5f70  ig_tweaked.fit_p
-0001b0c0: 6561 6b73 3d63 6f6e 6669 6731 2e66 6974  eaks=config1.fit
-0001b0d0: 5f70 6561 6b73 2d31 0a20 2020 2023 2020  _peaks-1.    #  
-0001b0e0: 2020 2020 2020 2070 7269 6e74 2827 7265         print('re
-0001b0f0: 6475 6369 6e67 2070 6561 6b73 2062 7920  ducing peaks by 
-0001b100: 3120 746f 2074 7279 2074 6f20 6765 7420  1 to try to get 
-0001b110: 616e 2065 7272 6f72 2729 0a0a 0a20 2020  an error')...   
-0001b120: 2023 2054 7279 2052 6566 6974 7469 6e67   # Try Refitting
-0001b130: 206f 6e63 650a 2020 2020 6966 2073 7472   once.    if str
-0001b140: 2864 665f 6f75 745b 2744 6961 6431 5f72  (df_out['Diad1_r
-0001b150: 6566 6974 275d 2e69 6c6f 635b 305d 2921  efit'].iloc[0])!
-0001b160: 3d27 466c 6167 6765 6420 5761 726e 696e  ='Flagged Warnin
-0001b170: 6773 3a27 3a0a 2020 2020 2020 2020 7072  gs:':.        pr
-0001b180: 696e 7428 2772 6566 6974 2061 7474 656d  int('refit attem
-0001b190: 7074 2031 2729 0a20 2020 2020 2020 2066  pt 1').        f
-0001b1a0: 6163 746f 723d 320a 2020 2020 2020 2020  actor=2.        
-0001b1b0: 696d 706f 7274 2063 6f70 790a 2020 2020  import copy.    
-0001b1c0: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
-0001b1d0: 6564 3d63 6f6e 6669 6731 0a20 2020 2020  ed=config1.     
-0001b1e0: 2020 2063 6f6e 6669 675f 7477 6561 6b65     config_tweake
-0001b1f0: 643d 636f 7079 2e63 6f70 7928 636f 6e66  d=copy.copy(conf
-0001b200: 6967 3129 0a0a 2020 2020 2020 2020 6966  ig1)..        if
-0001b210: 2061 6e79 2864 665f 6f75 745b 2744 6961   any(df_out['Dia
-0001b220: 6431 5f72 6566 6974 275d 2e73 7472 2e63  d1_refit'].str.c
-0001b230: 6f6e 7461 696e 7328 2720 4e6f 2045 7272  ontains(' No Err
-0001b240: 6f72 2729 293a 0a20 2020 2020 2020 2020  or')):.         
-0001b250: 2020 2069 6620 636f 6e66 6967 312e 6669     if config1.fi
-0001b260: 745f 7065 616b 733e 323a 0a20 2020 2020  t_peaks>2:.     
-0001b270: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-0001b280: 675f 7477 6561 6b65 642e 6669 745f 7065  g_tweaked.fit_pe
-0001b290: 616b 733d 636f 6e66 6967 312e 6669 745f  aks=config1.fit_
-0001b2a0: 7065 616b 732d 310a 2020 2020 2020 2020  peaks-1.        
-0001b2b0: 2020 2020 2020 2020 6669 745f 7065 616b          fit_peak
-0001b2c0: 733d 636f 6e66 6967 5f74 7765 616b 6564  s=config_tweaked
-0001b2d0: 2e66 6974 5f70 6561 6b73 0a0a 0a20 2020  .fit_peaks...   
-0001b2e0: 2020 2020 2069 6620 616e 7928 6466 5f6f       if any(df_o
-0001b2f0: 7574 5b27 4469 6164 315f 7265 6669 7427  ut['Diad1_refit'
-0001b300: 5d2e 7374 722e 636f 6e74 6169 6e73 2827  ].str.contains('
-0001b310: 565f 5369 676d 615f 746f 6f5f 4c6f 7727  V_Sigma_too_Low'
-0001b320: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0001b330: 636f 6e66 6967 5f74 7765 616b 6564 2e64  config_tweaked.d
-0001b340: 6961 645f 7369 676d 613d 636f 6e66 6967  iad_sigma=config
-0001b350: 312e 6469 6164 5f73 6967 6d61 2a66 6163  1.diad_sigma*fac
-0001b360: 746f 720a 2020 2020 2020 2020 6966 2061  tor.        if a
-0001b370: 6e79 2864 665f 6f75 745b 2744 6961 6431  ny(df_out['Diad1
-0001b380: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
-0001b390: 7461 696e 7328 2756 5f53 6967 6d61 5f74  tains('V_Sigma_t
-0001b3a0: 6f6f 5f48 6967 6827 2929 3a0a 2020 2020  oo_High')):.    
-0001b3b0: 2020 2020 2020 2020 636f 6e66 6967 5f74          config_t
-0001b3c0: 7765 616b 6564 2e64 6961 645f 7369 676d  weaked.diad_sigm
-0001b3d0: 613d 636f 6e66 6967 312e 6469 6164 5f73  a=config1.diad_s
-0001b3e0: 6967 6d61 2f66 6163 746f 720a 2020 2020  igma/factor.    
-0001b3f0: 2020 2020 2320 4761 7573 7369 616e 2066      # Gaussian f
-0001b400: 6974 2062 6974 730a 2020 2020 2020 2020  it bits.        
-0001b410: 6966 2061 6e79 2864 665f 6f75 745b 2744  if any(df_out['D
-0001b420: 6961 6431 5f72 6566 6974 275d 2e73 7472  iad1_refit'].str
-0001b430: 2e63 6f6e 7461 696e 7328 2747 5f69 6e70  .contains('G_inp
-0001b440: 7574 5f54 6f6f 4869 6768 5369 676d 6127  ut_TooHighSigma'
-0001b450: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0001b460: 636f 6e66 6967 5f74 7765 616b 6564 2e67  config_tweaked.g
-0001b470: 6175 7373 5f73 6967 6d61 3d63 6f6e 6669  auss_sigma=confi
-0001b480: 6731 2e67 6175 7373 5f73 6967 6d61 2f66  g1.gauss_sigma/f
-0001b490: 6163 746f 720a 2020 2020 2020 2020 6966  actor.        if
-0001b4a0: 2061 6e79 2864 665f 6f75 745b 2744 6961   any(df_out['Dia
-0001b4b0: 6431 5f72 6566 6974 275d 2e73 7472 2e63  d1_refit'].str.c
-0001b4c0: 6f6e 7461 696e 7328 2747 5f69 6e70 7574  ontains('G_input
-0001b4d0: 5f54 6f6f 4c6f 7753 6967 6d61 2729 293a  _TooLowSigma')):
-0001b4e0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-0001b4f0: 6669 675f 7477 6561 6b65 642e 6761 7573  fig_tweaked.gaus
-0001b500: 735f 7369 676d 613d 636f 6e66 6967 312e  s_sigma=config1.
-0001b510: 6761 7573 735f 7369 676d 612a 6661 6374  gauss_sigma*fact
-0001b520: 6f72 0a20 2020 2020 2020 2069 6620 616e  or.        if an
-0001b530: 7928 6466 5f6f 7574 5b27 4469 6164 315f  y(df_out['Diad1_
-0001b540: 7265 6669 7427 5d2e 7374 722e 636f 6e74  refit'].str.cont
-0001b550: 6169 6e73 2827 475f 696e 7075 745f 546f  ains('G_input_To
-0001b560: 6f4c 6f77 416d 7027 2929 3a0a 2020 2020  oLowAmp')):.    
-0001b570: 2020 2020 2020 2020 636f 6e66 6967 5f74          config_t
-0001b580: 7765 616b 6564 2e67 6175 7373 5f61 6d70  weaked.gauss_amp
-0001b590: 6c69 7475 6465 3d63 6f6e 6669 6731 2e67  litude=config1.g
-0001b5a0: 6175 7373 5f61 6d70 2a66 6163 746f 720a  auss_amp*factor.
-0001b5b0: 2020 2020 2020 2020 6966 2061 6e79 2864          if any(d
-0001b5c0: 665f 6f75 745b 2744 6961 6431 5f72 6566  f_out['Diad1_ref
-0001b5d0: 6974 275d 2e73 7472 2e63 6f6e 7461 696e  it'].str.contain
-0001b5e0: 7328 2747 5f41 6d70 5f74 6f6f 5f68 6967  s('G_Amp_too_hig
-0001b5f0: 6827 2929 3a0a 2020 2020 2020 2020 2020  h')):.          
-0001b600: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
-0001b610: 2e67 6175 7373 5f61 6d70 6c69 7475 6465  .gauss_amplitude
-0001b620: 3d63 6f6e 6669 6731 2e67 6175 7373 5f61  =config1.gauss_a
-0001b630: 6d70 2f66 6163 746f 720a 2020 2020 2020  mp/factor.      
-0001b640: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
-0001b650: 2744 6961 6431 5f72 6566 6974 275d 2e73  'Diad1_refit'].s
-0001b660: 7472 2e63 6f6e 7461 696e 7328 2747 5f68  tr.contains('G_h
-0001b670: 6967 6865 725f 7468 616e 5f64 6961 6427  igher_than_diad'
-0001b680: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0001b690: 636f 6e66 6967 5f74 7765 616b 6564 2e67  config_tweaked.g
-0001b6a0: 6175 7373 5f61 6d70 6c69 7475 6465 3d63  auss_amplitude=c
-0001b6b0: 6f6e 6669 6731 2e67 6175 7373 5f61 6d70  onfig1.gauss_amp
-0001b6c0: 2f66 6163 746f 720a 2020 2020 2020 2020  /factor.        
-0001b6d0: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
-0001b6e0: 6564 2e67 6175 7373 5f73 6967 6d61 3d63  ed.gauss_sigma=c
-0001b6f0: 6f6e 6669 6731 2e67 6175 7373 5f73 6967  onfig1.gauss_sig
-0001b700: 6d61 2a66 6163 746f 720a 2020 2020 2020  ma*factor.      
-0001b710: 2020 2320 2320 486f 7420 6261 6e64 2066    # # Hot band f
-0001b720: 6974 2062 6974 730a 2020 2020 2020 2020  it bits.        
-0001b730: 2320 6966 2061 6e79 2864 665f 6f75 745b  # if any(df_out[
-0001b740: 2744 6961 6431 5f72 6566 6974 275d 2e73  'Diad1_refit'].s
-0001b750: 7472 2e63 6f6e 7461 696e 7328 2748 4231  tr.contains('HB1
-0001b760: 5f4c 6f77 416d 7027 2929 3a0a 2020 2020  _LowAmp')):.    
-0001b770: 2020 2020 2320 2020 2020 636f 6e66 6967      #     config
-0001b780: 5f74 7765 616b 6564 2e48 425f 616d 706c  _tweaked.HB_ampl
-0001b790: 6974 7564 653d 6361 6c63 5f48 425f 616d  itude=calc_HB_am
-0001b7a0: 706c 6974 7564 652f 320a 2020 2020 2020  plitude/2.      
-0001b7b0: 2020 2320 6966 2061 6e79 2864 665f 6f75    # if any(df_ou
-0001b7c0: 745b 2744 6961 6431 5f72 6566 6974 275d  t['Diad1_refit']
-0001b7d0: 2e73 7472 2e63 6f6e 7461 696e 7328 2748  .str.contains('H
-0001b7e0: 4231 5f48 6967 6841 6d70 2729 293a 0a20  B1_HighAmp')):. 
-0001b7f0: 2020 2020 2020 2023 2020 2020 2063 6f6e         #     con
-0001b800: 6669 675f 7477 6561 6b65 642e 4842 5f61  fig_tweaked.HB_a
-0001b810: 6d70 6c69 7475 6465 3d63 616c 635f 4842  mplitude=calc_HB
-0001b820: 5f61 6d70 6c69 7475 6465 2a32 0a0a 2020  _amplitude*2..  
-0001b830: 2020 2020 2020 7265 7375 6c74 2c20 6466        result, df
-0001b840: 5f6f 7574 2c20 795f 6265 7374 5f66 6974  _out, y_best_fit
-0001b850: 2c20 785f 6c69 6e2c 2063 6f6d 706f 6e65  , x_lin, compone
-0001b860: 6e74 732c 2078 6461 742c 2079 6461 742c  nts, xdat, ydat,
-0001b870: 2061 7831 5f78 6c69 6d2c 2061 7832 5f78   ax1_xlim, ax2_x
-0001b880: 6c69 6d2c 7265 7369 6475 616c 5f64 6961  lim,residual_dia
-0001b890: 645f 636f 6f72 6473 2c20 7964 6174 5f69  d_coords, ydat_i
-0001b8a0: 6e72 616e 6765 2c20 2078 6461 745f 696e  nrange,  xdat_in
-0001b8b0: 7261 6e67 653d 6669 745f 6761 7573 7369  range=fit_gaussi
-0001b8c0: 616e 5f76 6f69 6774 5f67 656e 6572 6963  an_voigt_generic
-0001b8d0: 5f64 6961 6428 636f 6e66 6967 5f74 7765  _diad(config_twe
-0001b8e0: 616b 6564 2c20 6469 6164 313d 5472 7565  aked, diad1=True
-0001b8f0: 2c20 7061 7468 3d70 6174 682c 2066 696c  , path=path, fil
-0001b900: 656e 616d 653d 6669 6c65 6e61 6d65 2c0a  ename=filename,.
-0001b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b920: 2020 2020 7864 6174 3d78 5f64 6961 6431      xdat=x_diad1
-0001b930: 2c20 7964 6174 3d79 5f63 6f72 725f 6469  , ydat=y_corr_di
-0001b940: 6164 312c 0a20 2020 2020 2020 2020 2020  ad1,.           
-0001b950: 2020 2020 2020 2020 2073 7061 6e3d 7370           span=sp
-0001b960: 616e 5f64 6961 6431 2c20 706c 6f74 5f66  an_diad1, plot_f
-0001b970: 6967 7572 653d 4661 6c73 652c 2044 6961  igure=False, Dia
-0001b980: 645f 706f 733d 4469 6164 5f70 6f73 2c20  d_pos=Diad_pos, 
-0001b990: 4842 5f70 6f73 3d48 425f 706f 732c 2066  HB_pos=HB_pos, f
-0001b9a0: 6974 5f70 6561 6b73 3d63 6f6e 6669 675f  it_peaks=config_
-0001b9b0: 7477 6561 6b65 642e 6669 745f 7065 616b  tweaked.fit_peak
-0001b9c0: 7329 0a20 2020 2020 2020 2069 3d32 0a20  s).        i=2. 
-0001b9d0: 2020 2020 2020 2077 6869 6c65 2073 7472         while str
-0001b9e0: 2864 665f 6f75 745b 2744 6961 6431 5f72  (df_out['Diad1_r
-0001b9f0: 6566 6974 275d 2e69 6c6f 635b 305d 2921  efit'].iloc[0])!
-0001ba00: 3d27 466c 6167 6765 6420 5761 726e 696e  ='Flagged Warnin
-0001ba10: 6773 3a27 3a0a 0a20 2020 2020 2020 2020  gs:':..         
-0001ba20: 2020 2070 7269 6e74 2827 7265 6669 7420     print('refit 
-0001ba30: 6174 7465 6d70 7420 203d 272b 7374 7228  attempt  ='+str(
-0001ba40: 6929 202b 2027 2c20 272b 7374 7228 6466  i) + ', '+str(df
-0001ba50: 5f6f 7574 5b27 4469 6164 315f 7265 6669  _out['Diad1_refi
-0001ba60: 7427 5d2e 696c 6f63 5b30 5d29 290a 2020  t'].iloc[0])).  
-0001ba70: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001ba80: 6466 5f6f 7574 5b27 4469 6164 315f 7265  df_out['Diad1_re
-0001ba90: 6669 7427 5d2e 696c 6f63 5b30 5d29 0a0a  fit'].iloc[0])..
-0001baa0: 2020 2020 2020 2020 2020 2020 696d 706f              impo
-0001bab0: 7274 2063 6f70 790a 2020 2020 2020 2020  rt copy.        
-0001bac0: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
-0001bad0: 6564 323d 636f 7079 2e63 6f70 7928 636f  ed2=copy.copy(co
-0001bae0: 6e66 6967 5f74 7765 616b 6564 290a 2020  nfig_tweaked).  
-0001baf0: 2020 2020 2020 2020 2020 6661 6374 6f72            factor
-0001bb00: 323d 6661 6374 6f72 2a32 0a0a 0a20 2020  2=factor*2...   
-0001bb10: 2020 2020 2020 2020 2023 2069 6620 616e           # if an
-0001bb20: 7928 6466 5f6f 7574 5b27 4469 6164 315f  y(df_out['Diad1_
-0001bb30: 7265 6669 7427 5d2e 7374 722e 636f 6e74  refit'].str.cont
-0001bb40: 6169 6e73 2827 565f 4c6f 7741 6d70 2729  ains('V_LowAmp')
-0001bb50: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-0001bb60: 2020 2020 2063 6f6e 6669 675f 7477 6561       config_twea
-0001bb70: 6b65 6432 2e64 6961 645f 616d 706c 6974  ked2.diad_amplit
-0001bb80: 7564 653d 636f 6e66 6967 5f74 7765 616b  ude=config_tweak
-0001bb90: 6564 2e64 6961 645f 616d 706c 6974 7564  ed.diad_amplitud
-0001bba0: 652a 3130 0a20 2020 2020 2020 2020 2020  e*10.           
-0001bbb0: 2023 2069 6620 616e 7928 6466 5f6f 7574   # if any(df_out
-0001bbc0: 5b27 4469 6164 315f 7265 6669 7427 5d2e  ['Diad1_refit'].
-0001bbd0: 7374 722e 636f 6e74 6169 6e73 2827 565f  str.contains('V_
-0001bbe0: 4869 6768 416d 7027 2929 3a0a 2020 2020  HighAmp')):.    
-0001bbf0: 2020 2020 2020 2020 2320 2020 2020 636f          #     co
-0001bc00: 6e66 6967 5f74 7765 616b 6564 322e 6469  nfig_tweaked2.di
-0001bc10: 6164 5f61 6d70 6c69 7475 6465 3d63 6f6e  ad_amplitude=con
-0001bc20: 6669 675f 7477 6561 6b65 642e 6469 6164  fig_tweaked.diad
-0001bc30: 5f61 6d70 6c69 7475 6465 2f31 300a 2020  _amplitude/10.  
-0001bc40: 2020 2020 2020 2020 2020 6966 2061 6e79            if any
-0001bc50: 2864 665f 6f75 745b 2744 6961 6431 5f72  (df_out['Diad1_r
-0001bc60: 6566 6974 275d 2e73 7472 2e63 6f6e 7461  efit'].str.conta
-0001bc70: 696e 7328 2756 5f53 6967 6d61 5f74 6f6f  ins('V_Sigma_too
-0001bc80: 5f4c 6f77 2729 293a 0a20 2020 2020 2020  _Low')):.       
-0001bc90: 2020 2020 2020 2020 2063 6f6e 6669 675f           config_
-0001bca0: 7477 6561 6b65 6432 2e64 6961 645f 7369  tweaked2.diad_si
-0001bcb0: 676d 613d 636f 6e66 6967 5f74 7765 616b  gma=config_tweak
-0001bcc0: 6564 2e64 6961 645f 7369 676d 612a 6661  ed.diad_sigma*fa
-0001bcd0: 6374 6f72 320a 2020 2020 2020 2020 2020  ctor2.          
-0001bce0: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
-0001bcf0: 2744 6961 6431 5f72 6566 6974 275d 2e73  'Diad1_refit'].s
-0001bd00: 7472 2e63 6f6e 7461 696e 7328 2756 5f53  tr.contains('V_S
-0001bd10: 6967 6d61 5f74 6f6f 5f48 6967 6827 2929  igma_too_High'))
-0001bd20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001bd30: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
-0001bd40: 322e 6469 6164 5f73 6967 6d61 3d63 6f6e  2.diad_sigma=con
+00018640: 5b31 5d2b 3330 0a20 2020 2020 2020 2023  [1]+30.        #
+00018650: 2041 6464 696e 6720 7061 7463 6865 730a   Adding patches.
+00018660: 0a0a 2020 2020 2020 2020 7265 6374 5f64  ..        rect_d
+00018670: 6961 6432 5f62 313d 7061 7463 6865 732e  iad2_b1=patches.
+00018680: 5265 6374 616e 676c 6528 2863 6f6e 6669  Rectangle((confi
+00018690: 6731 2e6c 6f77 6572 5f62 636b 5f64 6961  g1.lower_bck_dia
+000186a0: 6432 5b30 5d2c 2061 7831 5f79 6d69 6e29  d2[0], ax1_ymin)
+000186b0: 2c63 6f6e 6669 6731 2e6c 6f77 6572 5f62  ,config1.lower_b
+000186c0: 636b 5f64 6961 6432 5b31 5d2d 636f 6e66  ck_diad2[1]-conf
+000186d0: 6967 312e 6c6f 7765 725f 6263 6b5f 6469  ig1.lower_bck_di
+000186e0: 6164 325b 305d 2c61 7831 5f79 6d61 782d  ad2[0],ax1_ymax-
+000186f0: 6178 315f 796d 696e 2c0a 2020 2020 2020  ax1_ymin,.      
+00018700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018710: 2020 2020 2020 2020 2020 6c69 6e65 7769            linewi
+00018720: 6474 683d 312c 6564 6765 636f 6c6f 723d  dth=1,edgecolor=
+00018730: 276e 6f6e 6527 2c66 6163 6563 6f6c 6f72  'none',facecolor
+00018740: 3d27 6379 616e 272c 206c 6162 656c 3d27  ='cyan', label='
+00018750: 7365 6c2e 2062 636b 2e20 7265 6769 6f6e  sel. bck. region
+00018760: 272c 2061 6c70 6861 3d30 2e33 2c20 7a6f  ', alpha=0.3, zo
+00018770: 7264 6572 3d30 290a 2020 2020 2020 2020  rder=0).        
+00018780: 6178 6573 5b27 5827 5d2e 6164 645f 7061  axes['X'].add_pa
+00018790: 7463 6828 7265 6374 5f64 6961 6432 5f62  tch(rect_diad2_b
+000187a0: 3129 0a20 2020 2020 2020 2072 6563 745f  1).        rect_
+000187b0: 6469 6164 325f 6232 3d70 6174 6368 6573  diad2_b2=patches
+000187c0: 2e52 6563 7461 6e67 6c65 2828 636f 6e66  .Rectangle((conf
+000187d0: 6967 312e 7570 7065 725f 6263 6b5f 6469  ig1.upper_bck_di
+000187e0: 6164 325b 305d 2c20 6178 315f 796d 696e  ad2[0], ax1_ymin
+000187f0: 292c 636f 6e66 6967 312e 7570 7065 725f  ),config1.upper_
+00018800: 6263 6b5f 6469 6164 325b 315d 2d63 6f6e  bck_diad2[1]-con
+00018810: 6669 6731 2e75 7070 6572 5f62 636b 5f64  fig1.upper_bck_d
+00018820: 6961 6432 5b30 5d2c 6178 315f 796d 6178  iad2[0],ax1_ymax
+00018830: 2d61 7831 5f79 6d69 6e2c 0a20 2020 2020  -ax1_ymin,.     
+00018840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018850: 2020 2020 2020 2020 2020 206c 696e 6577             linew
+00018860: 6964 7468 3d31 2c65 6467 6563 6f6c 6f72  idth=1,edgecolor
+00018870: 3d27 6e6f 6e65 272c 6661 6365 636f 6c6f  ='none',facecolo
+00018880: 723d 2763 7961 6e27 2c20 616c 7068 613d  r='cyan', alpha=
+00018890: 302e 332c 207a 6f72 6465 723d 3029 0a20  0.3, zorder=0). 
+000188a0: 2020 2020 2020 2061 7865 735b 2758 275d         axes['X']
+000188b0: 2e61 6464 5f70 6174 6368 2872 6563 745f  .add_patch(rect_
+000188c0: 6469 6164 325f 6232 290a 2020 2020 2020  diad2_b2).      
+000188d0: 2020 6178 6573 5b27 5827 5d2e 7365 745f    axes['X'].set_
+000188e0: 786c 696d 285b 6178 315f 786d 696e 2c20  xlim([ax1_xmin, 
+000188f0: 6178 315f 786d 6178 5d29 0a20 2020 2020  ax1_xmax]).     
+00018900: 2020 2061 7865 735b 2758 275d 2e73 6574     axes['X'].set
+00018910: 5f79 6c69 6d28 5b61 7831 5f79 6d69 6e2c  _ylim([ax1_ymin,
+00018920: 2061 7831 5f79 6d61 785d 290a 0a20 2020   ax1_ymax])..   
+00018930: 2020 2020 2061 7865 735b 2758 275d 2e73       axes['X'].s
+00018940: 6574 5f79 6c61 6265 6c28 2749 6e74 656e  et_ylabel('Inten
+00018950: 7369 7479 2729 0a20 2020 2020 2020 2061  sity').        a
+00018960: 7865 735b 2759 275d 2e73 6574 5f79 6c61  xes['Y'].set_yla
+00018970: 6265 6c28 2749 6e74 656e 7369 7479 2729  bel('Intensity')
+00018980: 0a20 2020 2020 2020 2061 7865 735b 2759  .        axes['Y
+00018990: 275d 2e73 6574 5f78 6c61 6265 6c28 2757  '].set_xlabel('W
+000189a0: 6176 656e 756d 6265 7227 290a 2020 2020  avenumber').    
+000189b0: 2020 2020 6178 6573 5b27 5827 5d2e 6c65      axes['X'].le
+000189c0: 6765 6e64 2829 0a0a 0a0a 2020 2020 2020  gend()....      
+000189d0: 2020 6178 6573 5b27 5927 5d2e 7365 745f    axes['Y'].set_
+000189e0: 7469 746c 6528 2762 2920 4261 636b 6772  title('b) Backgr
+000189f0: 6f75 6e64 2073 7562 7472 6163 7465 6420  ound subtracted 
+00018a00: 7370 6563 7472 6127 290a 2020 2020 2020  spectra').      
+00018a10: 2020 6178 6573 5b27 5927 5d2e 706c 6f74    axes['Y'].plot
+00018a20: 2878 5f64 6961 6432 2c20 795f 636f 7272  (x_diad2, y_corr
+00018a30: 5f64 6961 6432 2c20 272d 7227 290a 2020  _diad2, '-r').  
+00018a40: 2020 2020 2020 6865 6967 6874 5f70 3d6e        height_p=n
+00018a50: 702e 6d61 7828 4469 6164 5f73 686f 7274  p.max(Diad_short
+00018a60: 5f64 6961 6432 5b3a 2c20 315d 292d 6e70  _diad2[:, 1])-np
+00018a70: 2e6d 696e 2844 6961 645f 7368 6f72 745f  .min(Diad_short_
+00018a80: 6469 6164 325b 3a2c 2031 5d29 0a20 2020  diad2[:, 1]).   
+00018a90: 2020 2020 2061 7865 735b 2759 275d 2e73       axes['Y'].s
+00018aa0: 6574 5f79 6c69 6d28 5b6e 702e 6d69 6e28  et_ylim([np.min(
+00018ab0: 795f 636f 7272 5f64 6961 6432 292c 2031  y_corr_diad2), 1
+00018ac0: 2e32 2a68 6569 6768 745f 7020 5d29 0a20  .2*height_p ]). 
+00018ad0: 2020 2020 2020 2061 7865 735b 2758 275d         axes['X']
+00018ae0: 2e73 6574 5f78 6c61 6265 6c28 2757 6176  .set_xlabel('Wav
+00018af0: 656e 756d 6265 7227 290a 0a0a 0a20 2020  enumber')....   
+00018b00: 2020 2020 2061 7865 735b 2741 275d 2e70       axes['A'].p
+00018b10: 6c6f 7428 7864 6174 2c20 7964 6174 2c20  lot(xdat, ydat, 
+00018b20: 2027 2e6b 272c 206c 6162 656c 3d27 6263   '.k', label='bc
+00018b30: 6b2e 2073 7562 2e20 6461 7461 2729 0a20  k. sub. data'). 
+00018b40: 2020 2020 2020 2061 7865 735b 2741 275d         axes['A']
+00018b50: 2e70 6c6f 7428 2078 5f6c 696e 202c 795f  .plot( x_lin ,y_
+00018b60: 6265 7374 5f66 6974 2c20 272d 6727 2c20  best_fit, '-g', 
+00018b70: 6c69 6e65 7769 6474 683d 312c 206c 6162  linewidth=1, lab
+00018b80: 656c 3d27 6265 7374 2066 6974 2729 0a20  el='best fit'). 
+00018b90: 2020 2020 2020 2061 7865 735b 2741 275d         axes['A']
+00018ba0: 2e6c 6567 656e 6428 290a 2020 2020 2020  .legend().      
+00018bb0: 2020 6178 6573 5b27 4127 5d2e 7365 745f    axes['A'].set_
+00018bc0: 796c 6162 656c 2827 496e 7465 6e73 6974  ylabel('Intensit
+00018bd0: 7927 290a 2020 2020 2020 2020 6178 6573  y').        axes
+00018be0: 5b27 4127 5d2e 7365 745f 786c 6162 656c  ['A'].set_xlabel
+00018bf0: 2827 5761 7665 6e75 6d62 6572 2729 0a20  ('Wavenumber'). 
+00018c00: 2020 2020 2020 2061 7865 735b 2741 275d         axes['A']
+00018c10: 2e73 6574 5f78 6c69 6d28 6178 315f 786c  .set_xlim(ax1_xl
+00018c20: 696d 290a 2020 2020 2020 2020 6178 6573  im).        axes
+00018c30: 5b27 4127 5d2e 7365 745f 7469 746c 6528  ['A'].set_title(
+00018c40: 2763 2920 4f76 6572 616c 6c20 4265 7374  'c) Overall Best
+00018c50: 2046 6974 2729 0a0a 2020 2020 2320 696e   Fit')..    # in
+00018c60: 6469 7669 6475 616c 2066 6974 730a 2020  dividual fits.  
+00018c70: 2020 2020 2020 6178 6573 5b27 4227 5d2e        axes['B'].
+00018c80: 706c 6f74 2878 6461 742c 2079 6461 742c  plot(xdat, ydat,
+00018c90: 2027 2e6b 2729 0a0a 2020 2020 2020 2020   '.k')..        
+00018ca0: 2320 5468 6973 2069 7320 666f 7220 6966  # This is for if
+00018cb0: 2074 6865 7265 2069 7320 6d6f 7265 2074   there is more t
+00018cc0: 6861 6e20 3120 7065 616b 2c20 7468 6973  han 1 peak, this
+00018cd0: 2069 7320 7768 656e 2077 6520 7761 6e74   is when we want
+00018ce0: 2074 6f20 706c 6f74 2074 6865 2062 6573   to plot the bes
+00018cf0: 7420 6669 740a 0a20 2020 2020 2020 2069  t fit..        i
+00018d00: 6620 6669 745f 7065 616b 733e 313a 0a0a  f fit_peaks>1:..
+00018d10: 0a20 2020 2020 2020 2020 2020 2061 7865  .            axe
+00018d20: 735b 2742 275d 2e70 6c6f 7428 785f 6c69  s['B'].plot(x_li
+00018d30: 6e2c 2063 6f6d 706f 6e65 6e74 732e 6765  n, components.ge
+00018d40: 7428 276c 7a32 5f27 292c 2027 2d72 272c  t('lz2_'), '-r',
+00018d50: 206c 696e 6577 6964 7468 3d32 2c20 6c61   linewidth=2, la
+00018d60: 6265 6c3d 2748 4232 2729 0a0a 2020 2020  bel='HB2')..    
+00018d70: 2020 2020 6178 6573 5b27 4227 5d2e 706c      axes['B'].pl
+00018d80: 6f74 2878 5f6c 696e 2c20 636f 6d70 6f6e  ot(x_lin, compon
+00018d90: 656e 7473 2e67 6574 2827 6c7a 315f 2729  ents.get('lz1_')
+00018da0: 2c20 272d 6227 2c20 6c69 6e65 7769 6474  , '-b', linewidt
+00018db0: 683d 322c 206c 6162 656c 3d27 4469 6164  h=2, label='Diad
+00018dc0: 3227 290a 2020 2020 2020 2020 6966 2063  2').        if c
+00018dd0: 6f6e 6669 6731 2e66 6974 5f67 6175 7373  onfig1.fit_gauss
+00018de0: 2069 7320 6e6f 7420 4661 6c73 653a 0a20   is not False:. 
+00018df0: 2020 2020 2020 2020 2020 2061 7865 735b             axes[
+00018e00: 2742 275d 2e70 6c6f 7428 785f 6c69 6e2c  'B'].plot(x_lin,
+00018e10: 2063 6f6d 706f 6e65 6e74 732e 6765 7428   components.get(
+00018e20: 2762 6b67 5f27 292c 2027 2d6d 272c 206c  'bkg_'), '-m', l
+00018e30: 6162 656c 3d27 4761 7573 7369 616e 2062  abel='Gaussian b
+00018e40: 636b 272c 206c 696e 6577 6964 7468 3d32  ck', linewidth=2
+00018e50: 290a 2020 2020 2020 2020 2361 7832 2e70  ).        #ax2.p
+00018e60: 6c6f 7428 7864 6174 2c20 7265 7375 6c74  lot(xdat, result
+00018e70: 2e62 6573 745f 6669 742c 2027 2d67 272c  .best_fit, '-g',
+00018e80: 206c 6162 656c 3d27 6265 7374 2066 6974   label='best fit
+00018e90: 2729 0a20 2020 2020 2020 2061 7865 735b  ').        axes[
+00018ea0: 2742 275d 2e6c 6567 656e 6428 290a 0a20  'B'].legend().. 
+00018eb0: 2020 2020 2020 2066 6974 7370 616e 3d6d         fitspan=m
+00018ec0: 6178 2879 5f62 6573 745f 6669 7429 2d6d  ax(y_best_fit)-m
+00018ed0: 696e 2879 5f62 6573 745f 6669 7429 0a20  in(y_best_fit). 
+00018ee0: 2020 2020 2020 2061 7865 735b 2742 275d         axes['B']
+00018ef0: 2e73 6574 5f79 6c69 6d28 5b6d 696e 2879  .set_ylim([min(y
+00018f00: 5f62 6573 745f 6669 7429 2d66 6974 7370  _best_fit)-fitsp
+00018f10: 616e 2f35 2c20 6d61 7828 795f 6265 7374  an/5, max(y_best
+00018f20: 5f66 6974 292b 6669 7473 7061 6e2f 355d  _fit)+fitspan/5]
+00018f30: 290a 0a20 2020 2020 2020 2061 7865 735b  )..        axes[
+00018f40: 2742 275d 2e73 6574 5f79 6c61 6265 6c28  'B'].set_ylabel(
+00018f50: 2749 6e74 656e 7369 7479 2729 0a20 2020  'Intensity').   
+00018f60: 2020 2020 2061 7865 735b 2742 275d 2e73       axes['B'].s
+00018f70: 6574 5f78 6c61 6265 6c28 2757 6176 656e  et_xlabel('Waven
+00018f80: 756d 6265 7227 290a 0a0a 2020 2020 2020  umber')...      
+00018f90: 2020 6178 6573 5b27 4227 5d2e 7365 745f    axes['B'].set_
+00018fa0: 786c 696d 2861 7832 5f78 6c69 6d29 0a0a  xlim(ax2_xlim)..
+00018fb0: 2020 2020 2020 2020 2320 4461 7368 6564          # Dashed
+00018fc0: 206c 696e 6573 2073 6f20 6d61 7463 6865   lines so matche
+00018fd0: 7320 7061 7274 2044 0a0a 2020 2020 2020  s part D..      
+00018fe0: 2020 6178 6573 5b27 4227 5d2e 706c 6f74    axes['B'].plot
+00018ff0: 285b 6466 5f6f 7574 5b27 4469 6164 325f  ([df_out['Diad2_
+00019000: 566f 6967 745f 4365 6e74 275d 2c20 6466  Voigt_Cent'], df
+00019010: 5f6f 7574 5b27 4469 6164 325f 566f 6967  _out['Diad2_Voig
+00019020: 745f 4365 6e74 275d 5d2c 205b 6e70 2e6d  t_Cent']], [np.m
+00019030: 696e 2879 6461 7429 2c20 6e70 2e6d 6178  in(ydat), np.max
+00019040: 2879 6461 7429 5d2c 2027 3a62 2729 0a0a  (ydat)], ':b')..
+00019050: 0a20 2020 2020 2020 2069 6620 6669 745f  .        if fit_
+00019060: 7065 616b 733e 3d32 3a0a 2020 2020 2020  peaks>=2:.      
+00019070: 2020 2020 2020 2020 2020 6178 6573 5b27            axes['
+00019080: 4227 5d2e 706c 6f74 285b 6466 5f6f 7574  B'].plot([df_out
+00019090: 5b27 4842 325f 4365 6e74 275d 2c20 6466  ['HB2_Cent'], df
+000190a0: 5f6f 7574 5b27 4842 325f 4365 6e74 275d  _out['HB2_Cent']
+000190b0: 5d2c 205b 6e70 2e6d 696e 2879 6461 7429  ], [np.min(ydat)
+000190c0: 2c20 6e70 2e6d 6178 2879 6461 7429 5d2c  , np.max(ydat)],
+000190d0: 2027 3a72 2729 0a0a 2020 2020 2020 2020   ':r')..        
+000190e0: 6178 6573 5b27 4227 5d2e 7365 745f 7469  axes['B'].set_ti
+000190f0: 746c 6528 2763 2920 4669 7420 436f 6d70  tle('c) Fit Comp
+00019100: 6f6e 656e 7473 2729 0a0a 2020 2020 2020  onents')..      
+00019110: 2020 2320 4261 636b 6772 6f75 6e64 2066    # Background f
+00019120: 6974 0a0a 2020 2020 2020 2020 2320 4669  it..        # Fi
+00019130: 7273 742c 2073 6574 2075 7020 7820 616e  rst, set up x an
+00019140: 6420 7920 6c69 6d69 7473 206f 6e20 6178  d y limits on ax
+00019150: 6973 0a0a 2020 2020 2020 2020 6966 2063  is..        if c
+00019160: 6f6e 6669 6731 2e78 5f72 616e 6765 5f62  onfig1.x_range_b
+00019170: 6173 656c 696e 6520 6973 206e 6f74 204e  aseline is not N
+00019180: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00019190: 2061 7863 5f78 6d69 6e3d 6466 5f6f 7574   axc_xmin=df_out
+000191a0: 5b27 4469 6164 325f 566f 6967 745f 4365  ['Diad2_Voigt_Ce
+000191b0: 6e74 275d 5b30 5d2d 636f 6e66 6967 312e  nt'][0]-config1.
+000191c0: 785f 7261 6e67 655f 6261 7365 6c69 6e65  x_range_baseline
+000191d0: 0a20 2020 2020 2020 2020 2020 2061 7863  .            axc
+000191e0: 5f78 6d61 783d 6466 5f6f 7574 5b27 4469  _xmax=df_out['Di
+000191f0: 6164 325f 566f 6967 745f 4365 6e74 275d  ad2_Voigt_Cent']
+00019200: 5b30 5d2b 636f 6e66 6967 312e 785f 7261  [0]+config1.x_ra
+00019210: 6e67 655f 6261 7365 6c69 6e65 0a20 2020  nge_baseline.   
+00019220: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00019230: 2020 2020 2020 2061 7863 5f78 6d69 6e3d         axc_xmin=
+00019240: 636f 6e66 6967 312e 6c6f 7765 725f 6263  config1.lower_bc
+00019250: 6b5f 6469 6164 325b 305d 0a20 2020 2020  k_diad2[0].     
+00019260: 2020 2020 2020 2061 7863 5f78 6d61 783d         axc_xmax=
+00019270: 636f 6e66 6967 312e 7570 7065 725f 6263  config1.upper_bc
+00019280: 6b5f 6469 6164 325b 315d 0a20 2020 2020  k_diad2[1].     
+00019290: 2020 2061 7863 5f79 6d69 6e3d 6e70 2e6d     axc_ymin=np.m
+000192a0: 696e 2842 6173 656c 696e 655f 6469 6164  in(Baseline_diad
+000192b0: 325b 3a2c 2031 5d29 2d63 6f6e 6669 6731  2[:, 1])-config1
+000192c0: 2e79 5f72 616e 6765 5f62 6173 656c 696e  .y_range_baselin
+000192d0: 652f 330a 2020 2020 2020 2020 6178 635f  e/3.        axc_
+000192e0: 796d 6178 3d6e 702e 6d61 7828 4261 7365  ymax=np.max(Base
+000192f0: 6c69 6e65 5f64 6961 6432 5b3a 2c20 315d  line_diad2[:, 1]
+00019300: 292b 636f 6e66 6967 312e 795f 7261 6e67  )+config1.y_rang
+00019310: 655f 6261 7365 6c69 6e65 0a0a 2020 2020  e_baseline..    
+00019320: 2020 2020 7265 6374 5f64 6961 6432 5f62      rect_diad2_b
+00019330: 313d 7061 7463 6865 732e 5265 6374 616e  1=patches.Rectan
+00019340: 676c 6528 2863 6f6e 6669 6731 2e6c 6f77  gle((config1.low
+00019350: 6572 5f62 636b 5f64 6961 6432 5b30 5d2c  er_bck_diad2[0],
+00019360: 6178 635f 796d 696e 292c 636f 6e66 6967  axc_ymin),config
+00019370: 312e 6c6f 7765 725f 6263 6b5f 6469 6164  1.lower_bck_diad
+00019380: 325b 315d 2d63 6f6e 6669 6731 2e6c 6f77  2[1]-config1.low
+00019390: 6572 5f62 636b 5f64 6961 6432 5b30 5d2c  er_bck_diad2[0],
+000193a0: 6178 635f 796d 6178 2d61 7863 5f79 6d69  axc_ymax-axc_ymi
+000193b0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+000193c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193d0: 2020 206c 696e 6577 6964 7468 3d31 2c65     linewidth=1,e
+000193e0: 6467 6563 6f6c 6f72 3d27 6e6f 6e65 272c  dgecolor='none',
+000193f0: 6661 6365 636f 6c6f 723d 2763 7961 6e27  facecolor='cyan'
+00019400: 2c20 6c61 6265 6c3d 2762 636b 272c 2061  , label='bck', a
+00019410: 6c70 6861 3d30 2e33 2c20 7a6f 7264 6572  lpha=0.3, zorder
+00019420: 3d30 290a 0a0a 0a20 2020 2020 2020 2061  =0)....        a
+00019430: 7865 735b 2743 275d 2e73 6574 5f74 6974  xes['C'].set_tit
+00019440: 6c65 2827 6429 2050 6561 6b73 206f 7665  le('d) Peaks ove
+00019450: 726c 6169 6e20 6f6e 2064 6174 6120 6265  rlain on data be
+00019460: 666f 7265 2073 7562 7472 6163 7469 6f6e  fore subtraction
+00019470: 2729 0a20 2020 2020 2020 2061 7865 735b  ').        axes[
+00019480: 2743 275d 2e70 6c6f 7428 4469 6164 5f73  'C'].plot(Diad_s
+00019490: 686f 7274 5f64 6961 6432 5b3a 2c20 305d  hort_diad2[:, 0]
+000194a0: 2c20 4469 6164 5f73 686f 7274 5f64 6961  , Diad_short_dia
+000194b0: 6432 5b3a 2c20 315d 2c20 272e 7227 2c20  d2[:, 1], '.r', 
+000194c0: 6c61 6265 6c3d 2764 6174 6127 290a 2020  label='data').  
+000194d0: 2020 2020 2020 6178 6573 5b27 4327 5d2e        axes['C'].
+000194e0: 706c 6f74 2842 6173 656c 696e 655f 6469  plot(Baseline_di
+000194f0: 6164 325b 3a2c 2030 5d2c 2042 6173 656c  ad2[:, 0], Basel
+00019500: 696e 655f 6469 6164 325b 3a2c 2031 5d2c  ine_diad2[:, 1],
+00019510: 2027 2e62 272c 206c 6162 656c 3d27 6263   '.b', label='bc
+00019520: 6b27 290a 2020 2020 2020 2020 6178 6573  k').        axes
+00019530: 5b27 4327 5d2e 706c 6f74 2844 6961 645f  ['C'].plot(Diad_
+00019540: 7368 6f72 745f 6469 6164 325b 3a2c 2030  short_diad2[:, 0
+00019550: 5d2c 2050 795f 6261 7365 5f64 6961 6432  ], Py_base_diad2
+00019560: 2c20 272d 6b27 2c20 6c61 6265 6c3d 2750  , '-k', label='P
+00019570: 6f6c 7920 6263 6b20 6669 7427 290a 0a0a  oly bck fit')...
+00019580: 2020 2020 2020 2020 6178 6573 5b27 4327          axes['C'
+00019590: 5d2e 7365 745f 796c 6162 656c 2827 496e  ].set_ylabel('In
+000195a0: 7465 6e73 6974 7927 290a 2020 2020 2020  tensity').      
+000195b0: 2020 6178 6573 5b27 4327 5d2e 7365 745f    axes['C'].set_
+000195c0: 786c 6162 656c 2827 5761 7665 6e75 6d62  xlabel('Wavenumb
+000195d0: 6572 2729 0a0a 0a20 2020 2020 2020 2069  er')...        i
+000195e0: 6620 636f 6e66 6967 312e 6669 745f 6761  f config1.fit_ga
+000195f0: 7573 7320 6973 206e 6f74 2046 616c 7365  uss is not False
+00019600: 3a0a 0a20 2020 2020 2020 2020 2020 2061  :..            a
+00019610: 7865 735b 2743 275d 2e70 6c6f 7428 785f  xes['C'].plot(x_
+00019620: 6c69 6e2c 2063 6f6d 706f 6e65 6e74 732e  lin, components.
+00019630: 6765 7428 2762 6b67 5f27 292b 7962 6173  get('bkg_')+ybas
+00019640: 655f 786c 696e 2c20 272d 6d27 2c20 6c61  e_xlin, '-m', la
+00019650: 6265 6c3d 2747 6175 7373 6961 6e20 6263  bel='Gaussian bc
+00019660: 6b27 2c20 6c69 6e65 7769 6474 683d 3229  k', linewidth=2)
+00019670: 0a0a 2020 2020 2020 2020 6178 6573 5b27  ..        axes['
+00019680: 4327 5d2e 706c 6f74 2820 785f 6c69 6e20  C'].plot( x_lin 
+00019690: 2c79 5f62 6573 745f 6669 742b 7962 6173  ,y_best_fit+ybas
+000196a0: 655f 786c 696e 2c20 272d 6727 2c20 6c69  e_xlin, '-g', li
+000196b0: 6e65 7769 6474 683d 322c 206c 6162 656c  newidth=2, label
+000196c0: 3d27 4265 7374 2046 6974 2729 0a20 2020  ='Best Fit').   
+000196d0: 2020 2020 2061 7865 735b 2743 275d 2e70       axes['C'].p
+000196e0: 6c6f 7428 785f 6c69 6e2c 2063 6f6d 706f  lot(x_lin, compo
+000196f0: 6e65 6e74 732e 6765 7428 276c 7a31 5f27  nents.get('lz1_'
+00019700: 292b 7962 6173 655f 786c 696e 2c20 272d  )+ybase_xlin, '-
+00019710: 6227 2c20 6c61 6265 6c3d 2744 6961 6432  b', label='Diad2
+00019720: 272c 206c 696e 6577 6964 7468 3d31 290a  ', linewidth=1).
+00019730: 2020 2020 2020 2020 6966 2066 6974 5f70          if fit_p
+00019740: 6561 6b73 3e31 3a0a 2020 2020 2020 2020  eaks>1:.        
+00019750: 2020 2020 6178 6573 5b27 4327 5d2e 706c      axes['C'].pl
+00019760: 6f74 2878 5f6c 696e 2c20 636f 6d70 6f6e  ot(x_lin, compon
+00019770: 656e 7473 2e67 6574 2827 6c7a 325f 2729  ents.get('lz2_')
+00019780: 2b79 6261 7365 5f78 6c69 6e2c 2027 2d72  +ybase_xlin, '-r
+00019790: 272c 206c 6162 656c 3d27 4842 3227 2c20  ', label='HB2', 
+000197a0: 6c69 6e65 7769 6474 683d 3129 0a20 2020  linewidth=1).   
+000197b0: 2020 2020 2069 6620 6669 745f 7065 616b       if fit_peak
+000197c0: 733e 323a 0a20 2020 2020 2020 2020 2020  s>2:.           
+000197d0: 2061 7865 735b 2743 275d 2e70 6c6f 7428   axes['C'].plot(
+000197e0: 785f 6c69 6e2c 2063 6f6d 706f 6e65 6e74  x_lin, component
+000197f0: 732e 6765 7428 276c 7a33 5f27 292b 7962  s.get('lz3_')+yb
+00019800: 6173 655f 786c 696e 2c20 272d 6327 2c20  ase_xlin, '-c', 
+00019810: 6c61 6265 6c3d 2743 3133 272c 206c 696e  label='C13', lin
+00019820: 6577 6964 7468 3d31 290a 0a20 2020 2020  ewidth=1)..     
+00019830: 2020 2061 7865 735b 2743 275d 2e6c 6567     axes['C'].leg
+00019840: 656e 6428 6e63 6f6c 3d33 2c20 6c6f 633d  end(ncol=3, loc=
+00019850: 276c 6f77 6572 2063 656e 7465 7227 290a  'lower center').
+00019860: 0a0a 0a20 2020 2020 2020 2061 7865 735b  ...        axes[
+00019870: 2743 275d 2e73 6574 5f78 6c69 6d28 5b61  'C'].set_xlim([a
+00019880: 7863 5f78 6d69 6e2c 2061 7863 5f78 6d61  xc_xmin, axc_xma
+00019890: 785d 290a 2020 2020 2020 2020 6178 6573  x]).        axes
+000198a0: 5b27 4327 5d2e 7365 745f 796c 696d 285b  ['C'].set_ylim([
+000198b0: 6178 635f 796d 696e 2c20 6178 635f 796d  axc_ymin, axc_ym
+000198c0: 6178 5d29 0a20 2020 2020 2020 2023 6178  ax]).        #ax
+000198d0: 6573 5b27 4327 5d2e 706c 6f74 2844 6961  es['C'].plot(Dia
+000198e0: 645f 7368 6f72 745b 3a2c 2030 5d2c 2044  d_short[:, 0], D
+000198f0: 6961 645f 7368 6f72 745b 3a2c 2031 5d2c  iad_short[:, 1],
+00019900: 2027 2272 272c 206c 6162 656c 3d27 4461   '"r', label='Da
+00019910: 7461 2729 0a0a 0a20 2020 2020 2020 2023  ta')...        #
+00019920: 2052 6573 6964 7561 6c20 6f6e 2070 6c6f   Residual on plo
+00019930: 7420 440a 2020 2020 2020 2020 6178 6573  t D.        axes
+00019940: 5b27 4427 5d2e 7365 745f 7469 746c 6528  ['D'].set_title(
+00019950: 2766 2920 5265 7369 6475 616c 7327 290a  'f) Residuals').
+00019960: 2020 2020 2020 2020 6178 6573 5b27 4427          axes['D'
+00019970: 5d2e 706c 6f74 285b 6466 5f6f 7574 5b27  ].plot([df_out['
+00019980: 4469 6164 325f 566f 6967 745f 4365 6e74  Diad2_Voigt_Cent
+00019990: 275d 2c20 6466 5f6f 7574 5b27 4469 6164  '], df_out['Diad
+000199a0: 325f 566f 6967 745f 4365 6e74 275d 5d2c  2_Voigt_Cent']],
+000199b0: 205b 6e70 2e6d 696e 2872 6573 6964 7561   [np.min(residua
+000199c0: 6c5f 6469 6164 5f63 6f6f 7264 7329 2c20  l_diad_coords), 
+000199d0: 6e70 2e6d 6178 2872 6573 6964 7561 6c5f  np.max(residual_
+000199e0: 6469 6164 5f63 6f6f 7264 7329 5d2c 2027  diad_coords)], '
+000199f0: 3a62 2729 0a20 2020 2020 2020 2069 6620  :b').        if 
+00019a00: 6669 745f 7065 616b 733e 313a 0a20 2020  fit_peaks>1:.   
+00019a10: 2020 2020 2020 2020 2020 2020 2061 7865               axe
+00019a20: 735b 2744 275d 2e70 6c6f 7428 5b64 665f  s['D'].plot([df_
+00019a30: 6f75 745b 2748 4232 5f43 656e 7427 5d2c  out['HB2_Cent'],
+00019a40: 2064 665f 6f75 745b 2748 4232 5f43 656e   df_out['HB2_Cen
+00019a50: 7427 5d5d 2c20 5b6e 702e 6d69 6e28 7265  t']], [np.min(re
+00019a60: 7369 6475 616c 5f64 6961 645f 636f 6f72  sidual_diad_coor
+00019a70: 6473 292c 206e 702e 6d61 7828 7265 7369  ds), np.max(resi
+00019a80: 6475 616c 5f64 6961 645f 636f 6f72 6473  dual_diad_coords
+00019a90: 295d 2c20 273a 7227 290a 0a20 2020 2020  )], ':r')..     
+00019aa0: 2020 2061 7865 735b 2744 275d 2e70 6c6f     axes['D'].plo
+00019ab0: 7428 7864 6174 5f69 6e72 616e 6765 2c20  t(xdat_inrange, 
+00019ac0: 7265 7369 6475 616c 5f64 6961 645f 636f  residual_diad_co
+00019ad0: 6f72 6473 2c20 276f 6b27 2c20 6d66 633d  ords, 'ok', mfc=
+00019ae0: 2763 2720 290a 2020 2020 2020 2020 6178  'c' ).        ax
+00019af0: 6573 5b27 4427 5d2e 706c 6f74 2878 6461  es['D'].plot(xda
+00019b00: 745f 696e 7261 6e67 652c 2072 6573 6964  t_inrange, resid
+00019b10: 7561 6c5f 6469 6164 5f63 6f6f 7264 732c  ual_diad_coords,
+00019b20: 2027 2d63 2720 290a 2020 2020 2020 2020   '-c' ).        
+00019b30: 6178 6573 5b27 4427 5d2e 7365 745f 796c  axes['D'].set_yl
+00019b40: 6162 656c 2827 5265 7369 6475 616c 2729  abel('Residual')
+00019b50: 0a20 2020 2020 2020 2061 7865 735b 2744  .        axes['D
+00019b60: 275d 2e73 6574 5f78 6c61 6265 6c28 2757  '].set_xlabel('W
+00019b70: 6176 656e 756d 6265 7227 290a 2020 2020  avenumber').    
+00019b80: 2020 2020 2320 6178 6573 5b27 4427 5d2e      # axes['D'].
+00019b90: 7365 745f 786c 696d 2861 7831 5f78 6c69  set_xlim(ax1_xli
+00019ba0: 6d29 0a20 2020 2020 2020 2023 2061 7865  m).        # axe
+00019bb0: 735b 2744 275d 2e73 6574 5f78 6c69 6d28  s['D'].set_xlim(
+00019bc0: 6178 325f 786c 696d 290a 2020 2020 2020  ax2_xlim).      
+00019bd0: 2020 4c6f 6361 6c5f 5265 7369 6475 616c    Local_Residual
+00019be0: 5f64 6961 6432 3d72 6573 6964 7561 6c5f  _diad2=residual_
+00019bf0: 6469 6164 5f63 6f6f 7264 735b 2828 7864  diad_coords[((xd
+00019c00: 6174 5f69 6e72 616e 6765 3e28 6466 5f6f  at_inrange>(df_o
+00019c10: 7574 5b27 4469 6164 325f 566f 6967 745f  ut['Diad2_Voigt_
+00019c20: 4365 6e74 275d 5b30 5d2d 636f 6e66 6967  Cent'][0]-config
+00019c30: 312e 785f 7261 6e67 655f 7265 7369 6475  1.x_range_residu
+00019c40: 616c 2929 0a20 2020 2020 2020 2020 2020  al)).           
+00019c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c70: 2020 2020 2026 2878 6461 745f 696e 7261       &(xdat_inra
+00019c80: 6e67 653c 6466 5f6f 7574 5b27 4469 6164  nge<df_out['Diad
+00019c90: 325f 566f 6967 745f 4365 6e74 275d 5b30  2_Voigt_Cent'][0
+00019ca0: 5d2b 636f 6e66 6967 312e 785f 7261 6e67  ]+config1.x_rang
+00019cb0: 655f 7265 7369 6475 616c 2929 5d0a 2020  e_residual))].  
+00019cc0: 2020 2020 2020 6178 6573 5b27 4427 5d2e        axes['D'].
+00019cd0: 7365 745f 786c 696d 285b 6466 5f6f 7574  set_xlim([df_out
+00019ce0: 5b27 4469 6164 325f 566f 6967 745f 4365  ['Diad2_Voigt_Ce
+00019cf0: 6e74 275d 5b30 5d2d 636f 6e66 6967 312e  nt'][0]-config1.
+00019d00: 785f 7261 6e67 655f 7265 7369 6475 616c  x_range_residual
+00019d10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00019d20: 2020 2020 2020 6466 5f6f 7574 5b27 4469        df_out['Di
+00019d30: 6164 325f 566f 6967 745f 4365 6e74 275d  ad2_Voigt_Cent']
+00019d40: 5b30 5d2b 636f 6e66 6967 312e 785f 7261  [0]+config1.x_ra
+00019d50: 6e67 655f 7265 7369 6475 616c 5d29 0a20  nge_residual]). 
+00019d60: 2020 2020 2020 2023 6178 352e 706c 6f74         #ax5.plot
+00019d70: 285b 6365 6e74 5f31 3131 372c 2063 656e  ([cent_1117, cen
+00019d80: 745f 3131 3137 205d 2c20 5b6e 702e 6d69  t_1117 ], [np.mi
+00019d90: 6e28 4c6f 6361 6c5f 5265 7369 6475 616c  n(Local_Residual
+00019da0: 5f31 3131 3729 2d31 302c 206e 702e 6d61  _1117)-10, np.ma
+00019db0: 7828 4c6f 6361 6c5f 5265 7369 6475 616c  x(Local_Residual
+00019dc0: 5f31 3131 3729 2b31 305d 2c20 273a 6b27  _1117)+10], ':k'
+00019dd0: 290a 2020 2020 2020 2020 6178 6573 5b27  ).        axes['
+00019de0: 4427 5d2e 7365 745f 796c 696d 285b 6e70  D'].set_ylim([np
+00019df0: 2e6d 696e 284c 6f63 616c 5f52 6573 6964  .min(Local_Resid
+00019e00: 7561 6c5f 6469 6164 3229 2d31 302c 206e  ual_diad2)-10, n
+00019e10: 702e 6d61 7828 4c6f 6361 6c5f 5265 7369  p.max(Local_Resi
+00019e20: 6475 616c 5f64 6961 6432 292b 3130 5d29  dual_diad2)+10])
+00019e30: 0a0a 0a0a 0a0a 2020 2020 2020 2020 2320  ......        # 
+00019e40: 4f76 6572 616c 2073 7065 6374 7261 0a20  Overal spectra. 
+00019e50: 2020 2020 2020 2061 7865 735b 2745 275d         axes['E']
+00019e60: 2e73 6574 5f74 6974 6c65 2827 6729 2053  .set_title('g) S
+00019e70: 756d 6d61 7279 2070 6c6f 7420 6f66 2072  ummary plot of r
+00019e80: 6177 2073 7065 6374 7261 2066 6f72 2066  aw spectra for f
+00019e90: 696c 6520 3d20 2720 2b20 6669 6c65 6e61  ile = ' + filena
+00019ea0: 6d65 290a 2020 2020 2020 2020 6178 6573  me).        axes
+00019eb0: 5b27 4527 5d2e 706c 6f74 2853 7065 6374  ['E'].plot(Spect
+00019ec0: 7261 5b3a 2c20 305d 2c20 5370 6563 7472  ra[:, 0], Spectr
+00019ed0: 615b 3a2c 2031 5d2c 2027 2d72 2729 0a20  a[:, 1], '-r'). 
+00019ee0: 2020 2020 2020 2061 7865 735b 2745 275d         axes['E']
+00019ef0: 2e73 6574 5f79 6c61 6265 6c28 2749 6e74  .set_ylabel('Int
+00019f00: 656e 7369 7479 2729 0a20 2020 2020 2020  ensity').       
+00019f10: 2061 7865 735b 2745 275d 2e73 6574 5f78   axes['E'].set_x
+00019f20: 6c61 6265 6c28 2757 6176 656e 756d 6265  label('Wavenumbe
+00019f30: 7227 290a 0a0a 0a0a 2020 2020 2020 2020  r').....        
+00019f40: 7061 7468 333d 7061 7468 2b27 2f27 2b27  path3=path+'/'+'
+00019f50: 6469 6164 5f66 6974 5f69 6d61 6765 7327  diad_fit_images'
+00019f60: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
+00019f70: 6174 682e 6578 6973 7473 2870 6174 6833  ath.exists(path3
+00019f80: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
+00019f90: 7574 3d27 7061 7468 2065 7869 7374 7327  ut='path exists'
+00019fa0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00019fb0: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
+00019fc0: 6b65 6469 7273 2870 6174 682b 272f 272b  kedirs(path+'/'+
+00019fd0: 2027 6469 6164 5f66 6974 5f69 6d61 6765   'diad_fit_image
+00019fe0: 7327 2c20 6578 6973 745f 6f6b 3d46 616c  s', exist_ok=Fal
+00019ff0: 7365 290a 0a20 2020 2020 2020 2066 6967  se)..        fig
+0001a000: 2e74 6967 6874 5f6c 6179 6f75 7428 290a  .tight_layout().
+0001a010: 0a20 2020 2020 2020 2066 696c 653d 6669  .        file=fi
+0001a020: 6c65 6e61 6d65 2e72 7370 6c69 7428 272e  lename.rsplit('.
+0001a030: 7478 7427 2c20 3129 5b30 5d0a 2020 2020  txt', 1)[0].    
+0001a040: 2020 2020 6669 672e 7361 7665 6669 6728      fig.savefig(
+0001a050: 7061 7468 332b 272f 272b 2764 6961 6432  path3+'/'+'diad2
+0001a060: 5f46 6974 5f7b 7d2e 706e 6727 2e66 6f72  _Fit_{}.png'.for
+0001a070: 6d61 7428 6669 6c65 292c 2064 7069 3d63  mat(file), dpi=c
+0001a080: 6f6e 6669 6731 2e64 7069 290a 0a0a 2020  onfig1.dpi)...  
+0001a090: 2020 6966 2063 6c6f 7365 5f66 6967 7572    if close_figur
+0001a0a0: 6520 6973 2054 7275 653a 0a20 2020 2020  e is True:.     
+0001a0b0: 2020 2070 6c74 2e63 6c6f 7365 2866 6967     plt.close(fig
+0001a0c0: 290a 0a20 2020 2023 204c 6574 7320 6361  )..    # Lets ca
+0001a0d0: 6c63 756c 6174 6520 7065 616b 2073 6b65  lculate peak ske
+0001a0e0: 776e 6573 7320 6865 7265 2e0a 2020 2020  wness here..    
+0001a0f0: 536b 6577 3530 3d61 7373 6573 735f 6469  Skew50=assess_di
+0001a100: 6164 325f 736b 6577 6e65 7373 2863 6f6e  ad2_skewness(con
+0001a110: 6669 6731 3d64 6961 6432 5f66 6974 5f63  fig1=diad2_fit_c
+0001a120: 6f6e 6669 6728 292c 2069 6e74 5f63 7574  onfig(), int_cut
+0001a130: 5f6f 6666 3d30 2e35 2c20 7061 7468 3d70  _off=0.5, path=p
+0001a140: 6174 682c 2066 696c 656e 616d 653d 6669  ath, filename=fi
+0001a150: 6c65 6e61 6d65 2c20 6669 6c65 7479 7065  lename, filetype
+0001a160: 3d66 696c 6574 7970 652c 0a20 2020 2073  =filetype,.    s
+0001a170: 6b65 776e 6573 733d 2761 6273 272c 2068  kewness='abs', h
+0001a180: 6569 6768 743d 312c 2070 726f 6d69 6e65  eight=1, promine
+0001a190: 6e63 653d 352c 2077 6964 7468 3d30 2e35  nce=5, width=0.5
+0001a1a0: 2c20 706c 6f74 5f66 6967 7572 653d 4661  , plot_figure=Fa
+0001a1b0: 6c73 652c 2064 6961 645f 6172 7261 793d  lse, diad_array=
+0001a1c0: 6469 6164 5f61 7272 6179 290a 2020 2020  diad_array).    
+0001a1d0: 536b 6577 3830 3d61 7373 6573 735f 6469  Skew80=assess_di
+0001a1e0: 6164 325f 736b 6577 6e65 7373 2863 6f6e  ad2_skewness(con
+0001a1f0: 6669 6731 3d64 6961 6432 5f66 6974 5f63  fig1=diad2_fit_c
+0001a200: 6f6e 6669 6728 292c 2069 6e74 5f63 7574  onfig(), int_cut
+0001a210: 5f6f 6666 3d30 2e33 2c20 7061 7468 3d70  _off=0.3, path=p
+0001a220: 6174 682c 2066 696c 656e 616d 653d 6669  ath, filename=fi
+0001a230: 6c65 6e61 6d65 2c20 6669 6c65 7479 7065  lename, filetype
+0001a240: 3d66 696c 6574 7970 652c 0a20 2020 2073  =filetype,.    s
+0001a250: 6b65 776e 6573 733d 2761 6273 272c 2068  kewness='abs', h
+0001a260: 6569 6768 743d 312c 2070 726f 6d69 6e65  eight=1, promine
+0001a270: 6e63 653d 352c 2077 6964 7468 3d30 2e35  nce=5, width=0.5
+0001a280: 2c20 706c 6f74 5f66 6967 7572 653d 4661  , plot_figure=Fa
+0001a290: 6c73 652c 2064 6961 645f 6172 7261 793d  lse, diad_array=
+0001a2a0: 6469 6164 5f61 7272 6179 290a 2020 2020  diad_array).    
+0001a2b0: 6466 5f6f 7574 5b27 4469 6164 325f 4173  df_out['Diad2_As
+0001a2c0: 796d 3530 275d 3d53 6b65 7735 305b 2753  ym50']=Skew50['S
+0001a2d0: 6b65 776e 6573 735f 6469 6164 3227 5d0a  kewness_diad2'].
+0001a2e0: 2020 2020 6466 5f6f 7574 5b27 4469 6164      df_out['Diad
+0001a2f0: 325f 4173 796d 3730 275d 3d53 6b65 7738  2_Asym70']=Skew8
+0001a300: 305b 2753 6b65 776e 6573 735f 6469 6164  0['Skewness_diad
+0001a310: 3227 5d0a 2020 2020 6466 5f6f 7574 5b27  2'].    df_out['
+0001a320: 4469 6164 325f 5975 616e 3230 3137 5f73  Diad2_Yuan2017_s
+0001a330: 796d 5f66 6163 746f 7227 5d3d 2864 665f  ym_factor']=(df_
+0001a340: 6f75 745b 2744 6961 6432 5f66 7768 6d27  out['Diad2_fwhm'
+0001a350: 5d29 2a28 6466 5f6f 7574 5b27 4469 6164  ])*(df_out['Diad
+0001a360: 325f 4173 796d 3530 275d 2d31 290a 2020  2_Asym50']-1).  
+0001a370: 2020 6466 5f6f 7574 5b27 4469 6164 325f    df_out['Diad2_
+0001a380: 5265 6d69 6769 3230 3231 5f42 5346 275d  Remigi2021_BSF']
+0001a390: 3d64 665f 6f75 745b 2744 6961 6432 5f66  =df_out['Diad2_f
+0001a3a0: 7768 6d27 5d2f 6466 5f6f 7574 5b27 4469  whm']/df_out['Di
+0001a3b0: 6164 325f 436f 6d62 6f66 6974 5f48 6569  ad2_Combofit_Hei
+0001a3c0: 6768 7427 5d0a 2020 2020 6466 5f6f 7574  ght'].    df_out
+0001a3d0: 5b27 4469 6164 325f 5044 465f 4d6f 6465  ['Diad2_PDF_Mode
+0001a3e0: 6c27 5d3d 6d6f 6465 6c0a 0a0a 2020 2020  l']=model...    
+0001a3f0: 6966 2020 636f 6e66 6967 312e 7265 7475  if  config1.retu
+0001a400: 726e 5f6f 7468 6572 5f70 6172 616d 7320  rn_other_params 
+0001a410: 6973 2046 616c 7365 3a0a 2020 2020 2020  is False:.      
+0001a420: 2020 7265 7475 726e 2064 665f 6f75 740a    return df_out.
+0001a430: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001a440: 2020 7265 7475 726e 2064 665f 6f75 742c    return df_out,
+0001a450: 2072 6573 756c 742c 2079 5f62 6573 745f   result, y_best_
+0001a460: 6669 742c 2078 5f6c 696e 0a0a 0a0a 0a64  fit, x_lin.....d
+0001a470: 6566 2066 6974 5f64 6961 645f 315f 775f  ef fit_diad_1_w_
+0001a480: 6263 6b28 2a2c 2063 6f6e 6669 6731 3a20  bck(*, config1: 
+0001a490: 6469 6164 315f 6669 745f 636f 6e66 6967  diad1_fit_config
+0001a4a0: 3d64 6961 6431 5f66 6974 5f63 6f6e 6669  =diad1_fit_confi
+0001a4b0: 6728 292c 2063 6f6e 6669 6732 3a20 6469  g(), config2: di
+0001a4c0: 6164 5f69 645f 636f 6e66 6967 3d64 6961  ad_id_config=dia
+0001a4d0: 645f 6964 5f63 6f6e 6669 6728 292c 0a20  d_id_config(),. 
+0001a4e0: 2020 2070 6174 683d 4e6f 6e65 2c20 6669     path=None, fi
+0001a4f0: 6c65 6e61 6d65 3d4e 6f6e 652c 2066 696c  lename=None, fil
+0001a500: 6574 7970 653d 4e6f 6e65 2c20 2070 6c6f  etype=None,  plo
+0001a510: 745f 6669 6775 7265 3d54 7275 652c 2063  t_figure=True, c
+0001a520: 6c6f 7365 5f66 6967 7572 653d 5472 7565  lose_figure=True
+0001a530: 2c20 4469 6164 5f70 6f73 3d4e 6f6e 652c  , Diad_pos=None,
+0001a540: 2048 425f 706f 733d 4e6f 6e65 2c20 6469   HB_pos=None, di
+0001a550: 6164 5f61 7272 6179 3d4e 6f6e 6529 3a0a  ad_array=None):.
+0001a560: 2020 2020 2222 2220 5468 6973 2066 756e      """ This fun
+0001a570: 6374 696f 6e20 6669 7473 2074 6865 2062  ction fits the b
+0001a580: 6163 6b67 726f 756e 6420 2875 7369 6e67  ackground (using
+0001a590: 2074 6865 2066 756e 6374 696f 6e20 7265   the function re
+0001a5a0: 6d6f 7665 5f64 6961 645f 6261 7365 6c69  move_diad_baseli
+0001a5b0: 6e65 2920 616e 6420 7468 656e 2066 6974  ne) and then fit
+0001a5c0: 7320 7468 6520 7065 616b 730a 2020 2020  s the peaks.    
+0001a5d0: 7573 696e 6720 6669 745f 6761 7573 7369  using fit_gaussi
+0001a5e0: 616e 5f76 6f69 6774 5f67 656e 6572 6963  an_voigt_generic
+0001a5f0: 5f64 6961 6428 290a 2020 2020 4974 2074  _diad().    It t
+0001a600: 6865 6e20 6368 6563 6b73 2069 6620 616e  hen checks if an
+0001a610: 7920 7061 7261 6d65 7465 7273 2061 7265  y parameters are
+0001a620: 2072 6967 6874 2061 7420 7468 6520 7065   right at the pe
+0001a630: 726d 6974 7465 6420 6564 6765 2028 6d65  rmitted edge (me
+0001a640: 616e 696e 6720 6669 7474 696e 6720 6469  aning fitting di
+0001a650: 646e 7420 636f 6e76 6572 6765 292c 0a20  dnt converge),. 
+0001a660: 2020 2061 6e64 2074 7269 6573 2066 6974     and tries fit
+0001a670: 7469 6e67 2069 6620 736f 2e20 5468 656e  ting if so. Then
+0001a680: 2069 7420 6d61 6b65 7320 6120 706c 6f74   it makes a plot
+0001a690: 0a20 2020 206f 6620 7468 6520 7661 7269  .    of the vari
+0001a6a0: 6f75 7320 7061 7274 7320 6f66 2074 6865  ous parts of the
+0001a6b0: 2066 6974 7469 6e67 2070 726f 6365 6475   fitting procedu
+0001a6c0: 7265 2c20 616e 6420 7265 7475 726e 7320  re, and returns 
+0001a6d0: 6120 6461 7461 6672 616d 6520 6f66 2074  a dataframe of t
+0001a6e0: 6865 2066 6974 2070 6172 616d 6574 6572  he fit parameter
+0001a6f0: 732e 0a0a 0a20 2020 2050 6172 616d 6574  s....    Paramet
+0001a700: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+0001a710: 2d2d 2d0a 2020 2020 6469 6164 5f69 645f  ---.    diad_id_
+0001a720: 636f 6e66 6967 2829 0a20 2020 2020 2020  config().       
+0001a730: 2044 6174 6163 6c61 7373 206f 6620 7061   Dataclass of pa
+0001a740: 7261 6d65 7465 7273 2075 7365 6420 746f  rameters used to
+0001a750: 206c 6f6f 6b20 666f 7220 7065 616b 732e   look for peaks.
+0001a760: 2055 7365 7320 616e 7920 6578 636c 7564   Uses any exclud
+0001a770: 6564 2072 616e 6765 7320 6672 6f6d 2074  ed ranges from t
+0001a780: 6869 732e 0a0a 2020 2020 6469 6164 315f  his...    diad1_
+0001a790: 6669 745f 636f 6e66 6967 2829 0a20 2020  fit_config().   
+0001a7a0: 2020 2020 2044 6174 6163 6c61 7373 206f       Dataclass o
+0001a7b0: 6620 7061 7261 6d65 7465 7273 2075 7365  f parameters use
+0001a7c0: 6420 746f 2066 696e 6420 7065 616b 732e  d to find peaks.
+0001a7d0: 2055 7365 2068 656c 7020 6f6e 2074 6869   Use help on thi
+0001a7e0: 7320 6461 7461 636c 6173 7320 746f 2067  s dataclass to g
+0001a7f0: 6574 206f 7074 696f 6e73 0a0a 0a20 2020  et options...   
+0001a800: 2070 6174 683a 2073 7472 0a20 2020 2020   path: str.     
+0001a810: 2020 2046 6f6c 6465 7220 7573 6572 2077     Folder user w
+0001a820: 6973 6865 7320 746f 2072 6561 6420 6461  ishes to read da
+0001a830: 7461 2066 726f 6d0a 0a20 2020 2066 696c  ta from..    fil
+0001a840: 656e 616d 653a 2073 7472 0a20 2020 2020  ename: str.     
+0001a850: 2020 2053 7065 6369 6669 6320 6e61 6d65     Specific name
+0001a860: 206f 6620 6669 6c65 2062 6569 6e67 2075   of file being u
+0001a870: 7365 642e 0a0a 2020 2020 6669 6c65 7479  sed...    filety
+0001a880: 7065 3a20 7374 720a 2020 2020 2020 2020  pe: str.        
+0001a890: 4964 656e 7469 6669 6573 2074 7970 6520  Identifies type 
+0001a8a0: 6f66 2066 696c 652e 2063 686f 6f73 6520  of file. choose 
+0001a8b0: 6672 6f6d 2027 5769 7465 635f 4153 4349  from 'Witec_ASCI
+0001a8c0: 4927 2c20 2768 6561 646c 6573 735f 7478  I', 'headless_tx
+0001a8d0: 7427 2c20 2768 6561 646c 6573 735f 6373  t', 'headless_cs
+0001a8e0: 7627 2c20 2768 6561 645f 6373 7627 2c20  v', 'head_csv', 
+0001a8f0: 2757 6974 6563 5f41 5343 4949 272c 0a20  'Witec_ASCII',. 
+0001a900: 2020 2020 2020 2027 484f 5249 4241 5f74         'HORIBA_t
+0001a910: 7874 272c 2027 5265 6e69 7368 6177 5f74  xt', 'Renishaw_t
+0001a920: 7874 270a 0a20 2020 2070 6c6f 745f 6669  xt'..    plot_fi
+0001a930: 6775 7265 3a20 626f 6f6c 0a20 2020 2020  gure: bool.     
+0001a940: 2020 2069 6620 5472 7565 2c20 7361 7665     if True, save
+0001a950: 7320 6669 6775 7265 0a0a 2020 2020 4469  s figure..    Di
+0001a960: 6164 5f70 6f73 3a20 666c 6f61 740a 2020  ad_pos: float.  
+0001a970: 2020 2020 2020 4573 7469 6d61 7465 206f        Estimate o
+0001a980: 6620 6469 6164 2070 6f73 6974 696f 6e0a  f diad position.
+0001a990: 0a20 2020 2048 425f 706f 733a 2066 6c6f  .    HB_pos: flo
+0001a9a0: 6174 0a20 2020 2020 2020 2045 7374 696d  at.        Estim
+0001a9b0: 6174 6520 6f66 2048 4220 706f 7369 7469  ate of HB positi
+0001a9c0: 6f6e 0a0a 0a20 2020 2063 6c6f 7365 5f66  on...    close_f
+0001a9d0: 6967 3a20 626f 6f6c 0a20 2020 2020 2020  ig: bool.       
+0001a9e0: 2069 6620 5472 7565 2c20 6469 7370 6c61   if True, displa
+0001a9f0: 7973 2066 6967 7572 6520 696e 204e 6f74  ys figure in Not
+0001aa00: 6562 6f6f 6b2e 2049 6620 4661 6c73 652c  ebook. If False,
+0001aa10: 2063 6c6f 7365 7320 6974 2028 796f 7520   closes it (you 
+0001aa20: 6361 6e20 7374 696c 6c20 6669 6e64 2069  can still find i
+0001aa30: 7420 7361 7665 6429 0a0a 2020 2020 5265  t saved)..    Re
+0001aa40: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+0001aa50: 2d2d 2d2d 2d2d 0a20 2020 2069 6620 7265  ------.    if re
+0001aa60: 7475 726e 5f6f 7468 6572 5f70 6172 616d  turn_other_param
+0001aa70: 7320 6973 2046 616c 7365 2028 6465 6661  s is False (defa
+0001aa80: 756c 7429 0a20 2020 2020 2020 2072 6574  ult).        ret
+0001aa90: 7572 6e73 2061 2064 6174 6166 7261 6d65  urns a dataframe
+0001aaa0: 206f 6620 7065 616b 2070 6172 616d 6574   of peak paramet
+0001aab0: 6572 730a 2020 2020 6966 2054 7275 652c  ers.    if True,
+0001aac0: 2061 6c73 6f20 7265 7475 726e 733a 0a20   also returns:. 
+0001aad0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+0001aae0: 743a 2066 6974 2070 6172 616d 6574 6572  t: fit parameter
+0001aaf0: 730a 2020 2020 2020 2020 2020 2020 795f  s.            y_
+0001ab00: 6265 7374 5f66 6974 3a20 6265 7374 2066  best_fit: best f
+0001ab10: 6974 2074 6f20 616c 6c20 6375 7276 6573  it to all curves
+0001ab20: 2069 6e20 790a 2020 2020 2020 2020 2020   in y.          
+0001ab30: 2020 785f 6c69 6e3a 206c 696e 7370 6163    x_lin: linspac
+0001ab40: 6520 6f66 2062 6573 7420 6669 7420 636f  e of best fit co
+0001ab50: 6f72 6469 6e61 7465 7320 696e 2078 2e0a  ordinates in x..
+0001ab60: 0a0a 2222 220a 0a20 2020 2069 6620 2743  .."""..    if 'C
+0001ab70: 5252 2720 696e 2066 696c 656e 616d 653a  RR' in filename:
+0001ab80: 0a20 2020 2020 2020 2066 696c 6574 7970  .        filetyp
+0001ab90: 653d 2768 6561 646c 6573 735f 7478 7427  e='headless_txt'
+0001aba0: 0a0a 2020 2020 6d6f 6465 6c3d 636f 6e66  ..    model=conf
+0001abb0: 6967 312e 6d6f 6465 6c5f 6e61 6d65 0a0a  ig1.model_name..
+0001abc0: 2020 2020 6966 206d 6f64 656c 206e 6f74      if model not
+0001abd0: 2069 6e20 616c 6c6f 7765 645f 6d6f 6465   in allowed_mode
+0001abe0: 6c73 3a0a 2020 2020 2020 2020 7261 6973  ls:.        rais
+0001abf0: 6520 5661 6c75 6545 7272 6f72 2866 2255  e ValueError(f"U
+0001ac00: 6e73 7570 706f 7274 6564 206d 6f64 656c  nsupported model
+0001ac10: 3a20 7b6d 6f64 656c 7d2e 2053 7570 706f  : {model}. Suppo
+0001ac20: 7274 6564 206d 6f64 656c 7320 6172 653a  rted models are:
+0001ac30: 207b 272c 2027 2e6a 6f69 6e28 616c 6c6f   {', '.join(allo
+0001ac40: 7765 645f 6d6f 6465 6c73 297d 2229 0a0a  wed_models)}")..
+0001ac50: 2020 2020 6669 745f 7065 616b 733d 636f      fit_peaks=co
+0001ac60: 6e66 6967 312e 6669 745f 7065 616b 730a  nfig1.fit_peaks.
+0001ac70: 0a20 2020 2069 6620 6669 745f 7065 616b  .    if fit_peak
+0001ac80: 733d 3d32 3a0a 2020 2020 2020 2020 6966  s==2:.        if
+0001ac90: 206e 702e 6973 6e61 6e28 4842 5f70 6f73   np.isnan(HB_pos
+0001aca0: 293d 3d54 7275 6520 6f72 2063 6f6e 6669  )==True or confi
+0001acb0: 6731 2e48 425f 7072 6f6d 3c2d 3530 3a0a  g1.HB_prom<-50:.
+0001acc0: 2020 2020 2020 2020 2020 2020 6669 745f              fit_
+0001acd0: 7065 616b 733d 310a 2020 2020 2020 2020  peaks=1.        
+0001ace0: 2020 2020 636f 6e66 6967 312e 6669 745f      config1.fit_
+0001acf0: 6761 7573 733d 4661 6c73 650a 2020 2020  gauss=False.    
+0001ad00: 2020 2020 2020 2020 2370 7269 6e74 2827          #print('
+0001ad10: 4569 7468 6572 206e 6f20 6862 2070 6f73  Either no hb pos
+0001ad20: 6974 696f 6e2c 206f 7220 7072 6f6d 696e  ition, or promin
+0001ad30: 656e 6365 3c2d 3530 2c20 7573 696e 6720  ence<-50, using 
+0001ad40: 3120 6669 7427 290a 0a20 2020 2069 6620  1 fit')..    if 
+0001ad50: 6469 6164 5f61 7272 6179 2069 7320 4e6f  diad_array is No
+0001ad60: 6e65 3a0a 2020 2020 2020 2020 4469 6164  ne:.        Diad
+0001ad70: 5f64 663d 6765 745f 6461 7461 2870 6174  _df=get_data(pat
+0001ad80: 683d 7061 7468 2c20 6669 6c65 6e61 6d65  h=path, filename
+0001ad90: 3d66 696c 656e 616d 652c 2066 696c 6574  =filename, filet
+0001ada0: 7970 653d 6669 6c65 7479 7065 290a 2020  ype=filetype).  
+0001adb0: 2020 2020 2020 4469 6164 3d6e 702e 6172        Diad=np.ar
+0001adc0: 7261 7928 4469 6164 5f64 6629 0a20 2020  ray(Diad_df).   
+0001add0: 2065 6c73 653a 0a20 2020 2020 2020 2044   else:.        D
+0001ade0: 6961 643d 6469 6164 5f61 7272 6179 0a20  iad=diad_array. 
+0001adf0: 2020 2023 2046 6972 7374 2c20 7765 2066     # First, we f
+0001ae00: 6565 6420 6461 7461 2069 6e74 6f20 7468  eed data into th
+0001ae10: 6520 7265 6d6f 7665 2062 6173 656c 696e  e remove baselin
+0001ae20: 6520 6675 6e63 7469 6f6e 2c20 7768 6963  e function, whic
+0001ae30: 6820 7265 7475 726e 7320 636f 7272 6563  h returns correc
+0001ae40: 7465 6420 6461 7461 0a0a 2020 2020 795f  ted data..    y_
+0001ae50: 636f 7272 5f64 6961 6431 2c20 5079 5f62  corr_diad1, Py_b
+0001ae60: 6173 655f 6469 6164 312c 2078 5f64 6961  ase_diad1, x_dia
+0001ae70: 6431 2c20 2044 6961 645f 7368 6f72 745f  d1,  Diad_short_
+0001ae80: 6469 6164 312c 2050 795f 6261 7365 5f64  diad1, Py_base_d
+0001ae90: 6961 6431 2c20 5066 5f62 6173 656c 696e  iad1, Pf_baselin
+0001aea0: 655f 6469 6164 312c 2020 4261 7365 6c69  e_diad1,  Baseli
+0001aeb0: 6e65 5f79 7375 625f 6469 6164 312c 2042  ne_ysub_diad1, B
+0001aec0: 6173 656c 696e 655f 785f 6469 6164 312c  aseline_x_diad1,
+0001aed0: 2042 6173 656c 696e 655f 6469 6164 312c   Baseline_diad1,
+0001aee0: 2073 7061 6e5f 6469 6164 313d 7265 6d6f   span_diad1=remo
+0001aef0: 7665 5f64 6961 645f 6261 7365 6c69 6e65  ve_diad_baseline
+0001af00: 280a 2020 2070 6174 683d 7061 7468 2c20  (.   path=path, 
+0001af10: 6669 6c65 6e61 6d65 3d66 696c 656e 616d  filename=filenam
+0001af20: 652c 2066 696c 6574 7970 653d 6669 6c65  e, filetype=file
+0001af30: 7479 7065 2c20 6578 636c 7564 655f 7261  type, exclude_ra
+0001af40: 6e67 6531 3d63 6f6e 6669 6732 2e65 7863  nge1=config2.exc
+0001af50: 6c75 6465 5f72 616e 6765 312c 2065 7863  lude_range1, exc
+0001af60: 6c75 6465 5f72 616e 6765 323d 636f 6e66  lude_range2=conf
+0001af70: 6967 322e 6578 636c 7564 655f 7261 6e67  ig2.exclude_rang
+0001af80: 6532 2c20 4e5f 706f 6c79 3d63 6f6e 6669  e2, N_poly=confi
+0001af90: 6731 2e4e 5f70 6f6c 795f 6263 6b5f 6469  g1.N_poly_bck_di
+0001afa0: 6164 312c 0a20 2020 206c 6f77 6572 5f62  ad1,.    lower_b
+0001afb0: 636b 3d63 6f6e 6669 6731 2e6c 6f77 6572  ck=config1.lower
+0001afc0: 5f62 636b 5f64 6961 6431 2c20 7570 7065  _bck_diad1, uppe
+0001afd0: 725f 6263 6b3d 636f 6e66 6967 312e 7570  r_bck=config1.up
+0001afe0: 7065 725f 6263 6b5f 6469 6164 312c 2070  per_bck_diad1, p
+0001aff0: 6c6f 745f 6669 6775 7265 3d46 616c 7365  lot_figure=False
+0001b000: 2c20 6469 6164 5f61 7272 6179 3d64 6961  , diad_array=dia
+0001b010: 645f 6172 7261 7929 0a0a 0a0a 0a0a 2020  d_array)......  
+0001b020: 2020 2320 5468 656e 2c20 7765 2066 6565    # Then, we fee
+0001b030: 6420 7468 6973 2062 6173 656c 696e 652d  d this baseline-
+0001b040: 636f 7272 6563 7465 6420 6461 7461 2069  corrected data i
+0001b050: 6e74 6f20 7468 6520 636f 6d62 696e 6564  nto the combined
+0001b060: 2067 6175 7373 6961 6e2d 766f 6967 7420   gaussian-voigt 
+0001b070: 7065 616b 2066 6974 7469 6e67 2066 756e  peak fitting fun
+0001b080: 6374 696f 6e0a 0a20 2020 2072 6573 756c  ction..    resul
+0001b090: 742c 2064 665f 6f75 742c 2079 5f62 6573  t, df_out, y_bes
+0001b0a0: 745f 6669 742c 2078 5f6c 696e 2c20 636f  t_fit, x_lin, co
+0001b0b0: 6d70 6f6e 656e 7473 2c20 7864 6174 2c20  mponents, xdat, 
+0001b0c0: 7964 6174 2c20 6178 315f 786c 696d 2c20  ydat, ax1_xlim, 
+0001b0d0: 6178 325f 786c 696d 2c72 6573 6964 7561  ax2_xlim,residua
+0001b0e0: 6c5f 6469 6164 5f63 6f6f 7264 732c 2079  l_diad_coords, y
+0001b0f0: 6461 745f 696e 7261 6e67 652c 2020 7864  dat_inrange,  xd
+0001b100: 6174 5f69 6e72 616e 6765 3d66 6974 5f67  at_inrange=fit_g
+0001b110: 6175 7373 6961 6e5f 766f 6967 745f 6765  aussian_voigt_ge
+0001b120: 6e65 7269 635f 6469 6164 2863 6f6e 6669  neric_diad(confi
+0001b130: 6731 2c64 6961 6431 3d54 7275 652c 2070  g1,diad1=True, p
+0001b140: 6174 683d 7061 7468 2c20 6669 6c65 6e61  ath=path, filena
+0001b150: 6d65 3d66 696c 656e 616d 652c 0a20 2020  me=filename,.   
+0001b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b170: 2078 6461 743d 785f 6469 6164 312c 2079   xdat=x_diad1, y
+0001b180: 6461 743d 795f 636f 7272 5f64 6961 6431  dat=y_corr_diad1
+0001b190: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001b1a0: 2020 2020 2020 7370 616e 3d73 7061 6e5f        span=span_
+0001b1b0: 6469 6164 312c 2070 6c6f 745f 6669 6775  diad1, plot_figu
+0001b1c0: 7265 3d46 616c 7365 2c0a 2020 2020 2020  re=False,.      
+0001b1d0: 2020 2020 2020 2020 2020 2020 2020 4469                Di
+0001b1e0: 6164 5f70 6f73 3d44 6961 645f 706f 732c  ad_pos=Diad_pos,
+0001b1f0: 2048 425f 706f 733d 4842 5f70 6f73 2c66   HB_pos=HB_pos,f
+0001b200: 6974 5f70 6561 6b73 3d66 6974 5f70 6561  it_peaks=fit_pea
+0001b210: 6b73 290a 0a0a 0a20 2020 2023 2069 6620  ks)....    # if 
+0001b220: 6466 5f6f 7574 5b27 4469 6164 315f 6365  df_out['Diad1_ce
+0001b230: 6e74 5f65 7272 275d 2e69 6c6f 635b 305d  nt_err'].iloc[0]
+0001b240: 3d3d 303a 0a20 2020 2023 2020 2020 2069  ==0:.    #     i
+0001b250: 6620 636f 6e66 6967 312e 6669 745f 7065  f config1.fit_pe
+0001b260: 616b 733e 313a 0a20 2020 2023 2020 2020  aks>1:.    #    
+0001b270: 2020 2020 2063 6f6e 6669 675f 7477 6561       config_twea
+0001b280: 6b65 642e 6669 745f 7065 616b 733d 636f  ked.fit_peaks=co
+0001b290: 6e66 6967 312e 6669 745f 7065 616b 732d  nfig1.fit_peaks-
+0001b2a0: 310a 2020 2020 2320 2020 2020 2020 2020  1.    #         
+0001b2b0: 7072 696e 7428 2772 6564 7563 696e 6720  print('reducing 
+0001b2c0: 7065 616b 7320 6279 2031 2074 6f20 7472  peaks by 1 to tr
+0001b2d0: 7920 746f 2067 6574 2061 6e20 6572 726f  y to get an erro
+0001b2e0: 7227 290a 0a0a 2020 2020 2320 5472 7920  r')...    # Try 
+0001b2f0: 5265 6669 7474 696e 6720 6f6e 6365 0a20  Refitting once. 
+0001b300: 2020 2069 6620 7374 7228 6466 5f6f 7574     if str(df_out
+0001b310: 5b27 4469 6164 315f 7265 6669 7427 5d2e  ['Diad1_refit'].
+0001b320: 696c 6f63 5b30 5d29 213d 2746 6c61 6767  iloc[0])!='Flagg
+0001b330: 6564 2057 6172 6e69 6e67 733a 273a 0a20  ed Warnings:':. 
+0001b340: 2020 2020 2020 2070 7269 6e74 2827 7265         print('re
+0001b350: 6669 7420 6174 7465 6d70 7420 3127 290a  fit attempt 1').
+0001b360: 2020 2020 2020 2020 6661 6374 6f72 3d32          factor=2
+0001b370: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+0001b380: 636f 7079 0a20 2020 2020 2020 2063 6f6e  copy.        con
+0001b390: 6669 675f 7477 6561 6b65 643d 636f 6e66  fig_tweaked=conf
+0001b3a0: 6967 310a 2020 2020 2020 2020 636f 6e66  ig1.        conf
+0001b3b0: 6967 5f74 7765 616b 6564 3d63 6f70 792e  ig_tweaked=copy.
+0001b3c0: 636f 7079 2863 6f6e 6669 6731 290a 0a20  copy(config1).. 
+0001b3d0: 2020 2020 2020 2069 6620 616e 7928 6466         if any(df
+0001b3e0: 5f6f 7574 5b27 4469 6164 315f 7265 6669  _out['Diad1_refi
+0001b3f0: 7427 5d2e 7374 722e 636f 6e74 6169 6e73  t'].str.contains
+0001b400: 2827 204e 6f20 4572 726f 7227 2929 3a0a  (' No Error')):.
+0001b410: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0001b420: 6f6e 6669 6731 2e66 6974 5f70 6561 6b73  onfig1.fit_peaks
+0001b430: 3e32 3a0a 2020 2020 2020 2020 2020 2020  >2:.            
+0001b440: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
+0001b450: 6564 2e66 6974 5f70 6561 6b73 3d63 6f6e  ed.fit_peaks=con
+0001b460: 6669 6731 2e66 6974 5f70 6561 6b73 2d31  fig1.fit_peaks-1
+0001b470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b480: 2066 6974 5f70 6561 6b73 3d63 6f6e 6669   fit_peaks=confi
+0001b490: 675f 7477 6561 6b65 642e 6669 745f 7065  g_tweaked.fit_pe
+0001b4a0: 616b 730a 0a0a 2020 2020 2020 2020 6966  aks...        if
+0001b4b0: 2061 6e79 2864 665f 6f75 745b 2744 6961   any(df_out['Dia
+0001b4c0: 6431 5f72 6566 6974 275d 2e73 7472 2e63  d1_refit'].str.c
+0001b4d0: 6f6e 7461 696e 7328 2756 5f53 6967 6d61  ontains('V_Sigma
+0001b4e0: 5f74 6f6f 5f4c 6f77 2729 293a 0a20 2020  _too_Low')):.   
+0001b4f0: 2020 2020 2020 2020 2063 6f6e 6669 675f           config_
+0001b500: 7477 6561 6b65 642e 6469 6164 5f73 6967  tweaked.diad_sig
+0001b510: 6d61 3d63 6f6e 6669 6731 2e64 6961 645f  ma=config1.diad_
+0001b520: 7369 676d 612a 6661 6374 6f72 0a20 2020  sigma*factor.   
+0001b530: 2020 2020 2069 6620 616e 7928 6466 5f6f       if any(df_o
+0001b540: 7574 5b27 4469 6164 315f 7265 6669 7427  ut['Diad1_refit'
+0001b550: 5d2e 7374 722e 636f 6e74 6169 6e73 2827  ].str.contains('
+0001b560: 565f 5369 676d 615f 746f 6f5f 4869 6768  V_Sigma_too_High
+0001b570: 2729 293a 0a20 2020 2020 2020 2020 2020  ')):.           
+0001b580: 2063 6f6e 6669 675f 7477 6561 6b65 642e   config_tweaked.
+0001b590: 6469 6164 5f73 6967 6d61 3d63 6f6e 6669  diad_sigma=confi
+0001b5a0: 6731 2e64 6961 645f 7369 676d 612f 6661  g1.diad_sigma/fa
+0001b5b0: 6374 6f72 0a20 2020 2020 2020 2023 2047  ctor.        # G
+0001b5c0: 6175 7373 6961 6e20 6669 7420 6269 7473  aussian fit bits
+0001b5d0: 0a20 2020 2020 2020 2069 6620 616e 7928  .        if any(
+0001b5e0: 6466 5f6f 7574 5b27 4469 6164 315f 7265  df_out['Diad1_re
+0001b5f0: 6669 7427 5d2e 7374 722e 636f 6e74 6169  fit'].str.contai
+0001b600: 6e73 2827 475f 696e 7075 745f 546f 6f48  ns('G_input_TooH
+0001b610: 6967 6853 6967 6d61 2729 293a 0a20 2020  ighSigma')):.   
+0001b620: 2020 2020 2020 2020 2063 6f6e 6669 675f           config_
+0001b630: 7477 6561 6b65 642e 6761 7573 735f 7369  tweaked.gauss_si
+0001b640: 676d 613d 636f 6e66 6967 312e 6761 7573  gma=config1.gaus
+0001b650: 735f 7369 676d 612f 6661 6374 6f72 0a20  s_sigma/factor. 
+0001b660: 2020 2020 2020 2069 6620 616e 7928 6466         if any(df
+0001b670: 5f6f 7574 5b27 4469 6164 315f 7265 6669  _out['Diad1_refi
+0001b680: 7427 5d2e 7374 722e 636f 6e74 6169 6e73  t'].str.contains
+0001b690: 2827 475f 696e 7075 745f 546f 6f4c 6f77  ('G_input_TooLow
+0001b6a0: 5369 676d 6127 2929 3a0a 2020 2020 2020  Sigma')):.      
+0001b6b0: 2020 2020 2020 636f 6e66 6967 5f74 7765        config_twe
+0001b6c0: 616b 6564 2e67 6175 7373 5f73 6967 6d61  aked.gauss_sigma
+0001b6d0: 3d63 6f6e 6669 6731 2e67 6175 7373 5f73  =config1.gauss_s
+0001b6e0: 6967 6d61 2a66 6163 746f 720a 2020 2020  igma*factor.    
+0001b6f0: 2020 2020 6966 2061 6e79 2864 665f 6f75      if any(df_ou
+0001b700: 745b 2744 6961 6431 5f72 6566 6974 275d  t['Diad1_refit']
+0001b710: 2e73 7472 2e63 6f6e 7461 696e 7328 2747  .str.contains('G
+0001b720: 5f69 6e70 7574 5f54 6f6f 4c6f 7741 6d70  _input_TooLowAmp
+0001b730: 2729 293a 0a20 2020 2020 2020 2020 2020  ')):.           
+0001b740: 2063 6f6e 6669 675f 7477 6561 6b65 642e   config_tweaked.
+0001b750: 6761 7573 735f 616d 706c 6974 7564 653d  gauss_amplitude=
+0001b760: 636f 6e66 6967 312e 6761 7573 735f 616d  config1.gauss_am
+0001b770: 702a 6661 6374 6f72 0a20 2020 2020 2020  p*factor.       
+0001b780: 2069 6620 616e 7928 6466 5f6f 7574 5b27   if any(df_out['
+0001b790: 4469 6164 315f 7265 6669 7427 5d2e 7374  Diad1_refit'].st
+0001b7a0: 722e 636f 6e74 6169 6e73 2827 475f 416d  r.contains('G_Am
+0001b7b0: 705f 746f 6f5f 6869 6768 2729 293a 0a20  p_too_high')):. 
+0001b7c0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+0001b7d0: 675f 7477 6561 6b65 642e 6761 7573 735f  g_tweaked.gauss_
+0001b7e0: 616d 706c 6974 7564 653d 636f 6e66 6967  amplitude=config
+0001b7f0: 312e 6761 7573 735f 616d 702f 6661 6374  1.gauss_amp/fact
+0001b800: 6f72 0a20 2020 2020 2020 2069 6620 616e  or.        if an
+0001b810: 7928 6466 5f6f 7574 5b27 4469 6164 315f  y(df_out['Diad1_
+0001b820: 7265 6669 7427 5d2e 7374 722e 636f 6e74  refit'].str.cont
+0001b830: 6169 6e73 2827 475f 6869 6768 6572 5f74  ains('G_higher_t
+0001b840: 6861 6e5f 6469 6164 2729 293a 0a20 2020  han_diad')):.   
+0001b850: 2020 2020 2020 2020 2063 6f6e 6669 675f           config_
+0001b860: 7477 6561 6b65 642e 6761 7573 735f 616d  tweaked.gauss_am
+0001b870: 706c 6974 7564 653d 636f 6e66 6967 312e  plitude=config1.
+0001b880: 6761 7573 735f 616d 702f 6661 6374 6f72  gauss_amp/factor
+0001b890: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+0001b8a0: 6669 675f 7477 6561 6b65 642e 6761 7573  fig_tweaked.gaus
+0001b8b0: 735f 7369 676d 613d 636f 6e66 6967 312e  s_sigma=config1.
+0001b8c0: 6761 7573 735f 7369 676d 612a 6661 6374  gauss_sigma*fact
+0001b8d0: 6f72 0a20 2020 2020 2020 2023 2023 2048  or.        # # H
+0001b8e0: 6f74 2062 616e 6420 6669 7420 6269 7473  ot band fit bits
+0001b8f0: 0a20 2020 2020 2020 2023 2069 6620 616e  .        # if an
+0001b900: 7928 6466 5f6f 7574 5b27 4469 6164 315f  y(df_out['Diad1_
+0001b910: 7265 6669 7427 5d2e 7374 722e 636f 6e74  refit'].str.cont
+0001b920: 6169 6e73 2827 4842 315f 4c6f 7741 6d70  ains('HB1_LowAmp
+0001b930: 2729 293a 0a20 2020 2020 2020 2023 2020  ')):.        #  
+0001b940: 2020 2063 6f6e 6669 675f 7477 6561 6b65     config_tweake
+0001b950: 642e 4842 5f61 6d70 6c69 7475 6465 3d63  d.HB_amplitude=c
+0001b960: 616c 635f 4842 5f61 6d70 6c69 7475 6465  alc_HB_amplitude
+0001b970: 2f32 0a20 2020 2020 2020 2023 2069 6620  /2.        # if 
+0001b980: 616e 7928 6466 5f6f 7574 5b27 4469 6164  any(df_out['Diad
+0001b990: 315f 7265 6669 7427 5d2e 7374 722e 636f  1_refit'].str.co
+0001b9a0: 6e74 6169 6e73 2827 4842 315f 4869 6768  ntains('HB1_High
+0001b9b0: 416d 7027 2929 3a0a 2020 2020 2020 2020  Amp')):.        
+0001b9c0: 2320 2020 2020 636f 6e66 6967 5f74 7765  #     config_twe
+0001b9d0: 616b 6564 2e48 425f 616d 706c 6974 7564  aked.HB_amplitud
+0001b9e0: 653d 6361 6c63 5f48 425f 616d 706c 6974  e=calc_HB_amplit
+0001b9f0: 7564 652a 320a 0a20 2020 2020 2020 2072  ude*2..        r
+0001ba00: 6573 756c 742c 2064 665f 6f75 742c 2079  esult, df_out, y
+0001ba10: 5f62 6573 745f 6669 742c 2078 5f6c 696e  _best_fit, x_lin
+0001ba20: 2c20 636f 6d70 6f6e 656e 7473 2c20 7864  , components, xd
+0001ba30: 6174 2c20 7964 6174 2c20 6178 315f 786c  at, ydat, ax1_xl
+0001ba40: 696d 2c20 6178 325f 786c 696d 2c72 6573  im, ax2_xlim,res
+0001ba50: 6964 7561 6c5f 6469 6164 5f63 6f6f 7264  idual_diad_coord
+0001ba60: 732c 2079 6461 745f 696e 7261 6e67 652c  s, ydat_inrange,
+0001ba70: 2020 7864 6174 5f69 6e72 616e 6765 3d66    xdat_inrange=f
+0001ba80: 6974 5f67 6175 7373 6961 6e5f 766f 6967  it_gaussian_voig
+0001ba90: 745f 6765 6e65 7269 635f 6469 6164 2863  t_generic_diad(c
+0001baa0: 6f6e 6669 675f 7477 6561 6b65 642c 2064  onfig_tweaked, d
+0001bab0: 6961 6431 3d54 7275 652c 2070 6174 683d  iad1=True, path=
+0001bac0: 7061 7468 2c20 6669 6c65 6e61 6d65 3d66  path, filename=f
+0001bad0: 696c 656e 616d 652c 0a20 2020 2020 2020  ilename,.       
+0001bae0: 2020 2020 2020 2020 2020 2020 2078 6461               xda
+0001baf0: 743d 785f 6469 6164 312c 2079 6461 743d  t=x_diad1, ydat=
+0001bb00: 795f 636f 7272 5f64 6961 6431 2c0a 2020  y_corr_diad1,.  
+0001bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb20: 2020 7370 616e 3d73 7061 6e5f 6469 6164    span=span_diad
+0001bb30: 312c 2070 6c6f 745f 6669 6775 7265 3d46  1, plot_figure=F
+0001bb40: 616c 7365 2c20 4469 6164 5f70 6f73 3d44  alse, Diad_pos=D
+0001bb50: 6961 645f 706f 732c 2048 425f 706f 733d  iad_pos, HB_pos=
+0001bb60: 4842 5f70 6f73 2c20 6669 745f 7065 616b  HB_pos, fit_peak
+0001bb70: 733d 636f 6e66 6967 5f74 7765 616b 6564  s=config_tweaked
+0001bb80: 2e66 6974 5f70 6561 6b73 290a 2020 2020  .fit_peaks).    
+0001bb90: 2020 2020 693d 320a 2020 2020 2020 2020      i=2.        
+0001bba0: 7768 696c 6520 7374 7228 6466 5f6f 7574  while str(df_out
+0001bbb0: 5b27 4469 6164 315f 7265 6669 7427 5d2e  ['Diad1_refit'].
+0001bbc0: 696c 6f63 5b30 5d29 213d 2746 6c61 6767  iloc[0])!='Flagg
+0001bbd0: 6564 2057 6172 6e69 6e67 733a 273a 0a0a  ed Warnings:':..
+0001bbe0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0001bbf0: 7428 2772 6566 6974 2061 7474 656d 7074  t('refit attempt
+0001bc00: 2020 3d27 2b73 7472 2869 2920 2b20 272c    ='+str(i) + ',
+0001bc10: 2027 2b73 7472 2864 665f 6f75 745b 2744   '+str(df_out['D
+0001bc20: 6961 6431 5f72 6566 6974 275d 2e69 6c6f  iad1_refit'].ilo
+0001bc30: 635b 305d 2929 0a20 2020 2020 2020 2020  c[0])).         
+0001bc40: 2020 2070 7269 6e74 2864 665f 6f75 745b     print(df_out[
+0001bc50: 2744 6961 6431 5f72 6566 6974 275d 2e69  'Diad1_refit'].i
+0001bc60: 6c6f 635b 305d 290a 0a20 2020 2020 2020  loc[0])..       
+0001bc70: 2020 2020 2069 6d70 6f72 7420 636f 7079       import copy
+0001bc80: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+0001bc90: 6669 675f 7477 6561 6b65 6432 3d63 6f70  fig_tweaked2=cop
+0001bca0: 792e 636f 7079 2863 6f6e 6669 675f 7477  y.copy(config_tw
+0001bcb0: 6561 6b65 6429 0a20 2020 2020 2020 2020  eaked).         
+0001bcc0: 2020 2066 6163 746f 7232 3d66 6163 746f     factor2=facto
+0001bcd0: 722a 320a 0a0a 2020 2020 2020 2020 2020  r*2...          
+0001bce0: 2020 2320 6966 2061 6e79 2864 665f 6f75    # if any(df_ou
+0001bcf0: 745b 2744 6961 6431 5f72 6566 6974 275d  t['Diad1_refit']
+0001bd00: 2e73 7472 2e63 6f6e 7461 696e 7328 2756  .str.contains('V
+0001bd10: 5f4c 6f77 416d 7027 2929 3a0a 2020 2020  _LowAmp')):.    
+0001bd20: 2020 2020 2020 2020 2320 2020 2020 636f          #     co
+0001bd30: 6e66 6967 5f74 7765 616b 6564 322e 6469  nfig_tweaked2.di
+0001bd40: 6164 5f61 6d70 6c69 7475 6465 3d63 6f6e  ad_amplitude=con
 0001bd50: 6669 675f 7477 6561 6b65 642e 6469 6164  fig_tweaked.diad
-0001bd60: 5f73 6967 6d61 2f66 6163 746f 7232 0a20  _sigma/factor2. 
-0001bd70: 2020 2020 2020 2020 2020 2023 2047 6175             # Gau
-0001bd80: 7373 6961 6e20 6669 7420 6269 7473 0a20  ssian fit bits. 
-0001bd90: 2020 2020 2020 2020 2020 2069 6620 616e             if an
-0001bda0: 7928 6466 5f6f 7574 5b27 4469 6164 315f  y(df_out['Diad1_
-0001bdb0: 7265 6669 7427 5d2e 7374 722e 636f 6e74  refit'].str.cont
-0001bdc0: 6169 6e73 2827 475f 696e 7075 745f 546f  ains('G_input_To
-0001bdd0: 6f48 6967 6853 6967 6d61 2729 293a 0a20  oHighSigma')):. 
-0001bde0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001bdf0: 6f6e 6669 675f 7477 6561 6b65 6432 2e67  onfig_tweaked2.g
-0001be00: 6175 7373 5f73 6967 6d61 3d63 6f6e 6669  auss_sigma=confi
-0001be10: 675f 7477 6561 6b65 642e 6761 7573 735f  g_tweaked.gauss_
-0001be20: 7369 676d 612f 6661 6374 6f72 320a 2020  sigma/factor2.  
-0001be30: 2020 2020 2020 2020 2020 6966 2061 6e79            if any
-0001be40: 2864 665f 6f75 745b 2744 6961 6431 5f72  (df_out['Diad1_r
-0001be50: 6566 6974 275d 2e73 7472 2e63 6f6e 7461  efit'].str.conta
-0001be60: 696e 7328 2747 5f69 6e70 7574 5f54 6f6f  ins('G_input_Too
-0001be70: 4c6f 7753 6967 6d61 2729 293a 0a20 2020  LowSigma')):.   
-0001be80: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0001be90: 6669 675f 7477 6561 6b65 6432 2e67 6175  fig_tweaked2.gau
-0001bea0: 7373 5f73 6967 6d61 3d63 6f6e 6669 675f  ss_sigma=config_
-0001beb0: 7477 6561 6b65 642e 6761 7573 735f 7369  tweaked.gauss_si
-0001bec0: 676d 612a 6661 6374 6f72 320a 2020 2020  gma*factor2.    
-0001bed0: 2020 2020 2020 2020 6966 2061 6e79 2864          if any(d
-0001bee0: 665f 6f75 745b 2744 6961 6431 5f72 6566  f_out['Diad1_ref
-0001bef0: 6974 275d 2e73 7472 2e63 6f6e 7461 696e  it'].str.contain
-0001bf00: 7328 2747 5f69 6e70 7574 5f54 6f6f 4c6f  s('G_input_TooLo
-0001bf10: 7741 6d70 2729 293a 0a20 2020 2020 2020  wAmp')):.       
-0001bf20: 2020 2020 2020 2020 2063 6f6e 6669 675f           config_
-0001bf30: 7477 6561 6b65 6432 2e67 6175 7373 5f61  tweaked2.gauss_a
-0001bf40: 6d70 6c69 7475 6465 3d63 6f6e 6669 675f  mplitude=config_
-0001bf50: 7477 6561 6b65 642e 6761 7573 735f 616d  tweaked.gauss_am
-0001bf60: 702a 6661 6374 6f72 320a 2020 2020 2020  p*factor2.      
-0001bf70: 2020 2020 2020 6966 2061 6e79 2864 665f        if any(df_
-0001bf80: 6f75 745b 2744 6961 6431 5f72 6566 6974  out['Diad1_refit
-0001bf90: 275d 2e73 7472 2e63 6f6e 7461 696e 7328  '].str.contains(
-0001bfa0: 2747 5f41 6d70 5f74 6f6f 5f68 6967 6827  'G_Amp_too_high'
-0001bfb0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0001bfc0: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
-0001bfd0: 6564 322e 6761 7573 735f 616d 706c 6974  ed2.gauss_amplit
-0001bfe0: 7564 653d 636f 6e66 6967 5f74 7765 616b  ude=config_tweak
-0001bff0: 6564 2e67 6175 7373 5f61 6d70 2f66 6163  ed.gauss_amp/fac
-0001c000: 746f 7232 0a20 2020 2020 2020 2020 2020  tor2.           
-0001c010: 2069 6620 616e 7928 6466 5f6f 7574 5b27   if any(df_out['
-0001c020: 4469 6164 315f 7265 6669 7427 5d2e 7374  Diad1_refit'].st
-0001c030: 722e 636f 6e74 6169 6e73 2827 475f 6869  r.contains('G_hi
-0001c040: 6768 6572 5f74 6861 6e5f 6469 6164 2729  gher_than_diad')
-0001c050: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001c060: 2020 2063 6f6e 6669 675f 7477 6561 6b65     config_tweake
-0001c070: 6432 2e67 6175 7373 5f61 6d70 6c69 7475  d2.gauss_amplitu
-0001c080: 6465 3d63 6f6e 6669 675f 7477 6561 6b65  de=config_tweake
-0001c090: 642e 6761 7573 735f 616d 702f 6661 6374  d.gauss_amp/fact
-0001c0a0: 6f72 320a 2020 2020 2020 2020 2020 2020  or2.            
-0001c0b0: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
-0001c0c0: 6564 322e 6761 7573 735f 7369 676d 613d  ed2.gauss_sigma=
-0001c0d0: 636f 6e66 6967 5f74 7765 616b 6564 2e67  config_tweaked.g
-0001c0e0: 6175 7373 5f73 6967 6d61 2a66 6163 746f  auss_sigma*facto
-0001c0f0: 7232 0a20 2020 2020 2020 2020 2020 2023  r2.            #
-0001c100: 2048 6f74 2062 616e 6473 2062 6974 730a   Hot bands bits.
-0001c110: 2020 2020 2020 2020 2020 2020 2320 6966              # if
-0001c120: 2061 6e79 2864 665f 6f75 745b 2744 6961   any(df_out['Dia
-0001c130: 6431 5f72 6566 6974 275d 2e73 7472 2e63  d1_refit'].str.c
-0001c140: 6f6e 7461 696e 7328 2748 4231 5f4c 6f77  ontains('HB1_Low
-0001c150: 416d 7027 2929 3a0a 2020 2020 2020 2020  Amp')):.        
-0001c160: 2020 2020 2320 2020 2020 636f 6e66 6967      #     config
-0001c170: 5f74 7765 616b 6564 322e 4842 5f61 6d70  _tweaked2.HB_amp
-0001c180: 6c69 7475 6465 3d63 6f6e 6669 675f 7477  litude=config_tw
-0001c190: 6561 6b65 642e 4842 5f61 6d70 6c69 7475  eaked.HB_amplitu
-0001c1a0: 6465 2f32 0a20 2020 2020 2020 2020 2020  de/2.           
-0001c1b0: 2023 2069 6620 616e 7928 6466 5f6f 7574   # if any(df_out
-0001c1c0: 5b27 4469 6164 315f 7265 6669 7427 5d2e  ['Diad1_refit'].
-0001c1d0: 7374 722e 636f 6e74 6169 6e73 2827 4842  str.contains('HB
-0001c1e0: 315f 4869 6768 416d 7027 2929 3a0a 2020  1_HighAmp')):.  
-0001c1f0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-0001c200: 636f 6e66 6967 5f74 7765 616b 6564 322e  config_tweaked2.
-0001c210: 4842 5f61 6d70 6c69 7475 6465 3d63 6f6e  HB_amplitude=con
-0001c220: 6669 675f 7477 6561 6b65 642e 4842 5f61  fig_tweaked.HB_a
-0001c230: 6d70 6c69 7475 6465 2a32 0a0a 0a20 2020  mplitude*2...   
-0001c240: 2020 2020 2020 2020 2072 6573 756c 742c           result,
-0001c250: 2064 665f 6f75 742c 2079 5f62 6573 745f   df_out, y_best_
-0001c260: 6669 742c 2078 5f6c 696e 2c20 636f 6d70  fit, x_lin, comp
-0001c270: 6f6e 656e 7473 2c20 7864 6174 2c20 7964  onents, xdat, yd
-0001c280: 6174 2c20 6178 315f 786c 696d 2c20 6178  at, ax1_xlim, ax
-0001c290: 325f 786c 696d 2c72 6573 6964 7561 6c5f  2_xlim,residual_
-0001c2a0: 6469 6164 5f63 6f6f 7264 732c 2079 6461  diad_coords, yda
-0001c2b0: 745f 696e 7261 6e67 652c 2020 7864 6174  t_inrange,  xdat
-0001c2c0: 5f69 6e72 616e 6765 3d66 6974 5f67 6175  _inrange=fit_gau
-0001c2d0: 7373 6961 6e5f 766f 6967 745f 6765 6e65  ssian_voigt_gene
-0001c2e0: 7269 635f 6469 6164 2863 6f6e 6669 675f  ric_diad(config_
-0001c2f0: 7477 6561 6b65 6432 2c64 6961 6431 3d54  tweaked2,diad1=T
-0001c300: 7275 652c 2070 6174 683d 7061 7468 2c20  rue, path=path, 
-0001c310: 6669 6c65 6e61 6d65 3d66 696c 656e 616d  filename=filenam
-0001c320: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0001c330: 2020 2020 2020 2078 6461 743d 785f 6469         xdat=x_di
-0001c340: 6164 312c 2079 6461 743d 795f 636f 7272  ad1, ydat=y_corr
-0001c350: 5f64 6961 6431 2c0a 2020 2020 2020 2020  _diad1,.        
-0001c360: 2020 2020 2020 2020 2020 2020 7370 616e              span
-0001c370: 3d73 7061 6e5f 6469 6164 312c 2070 6c6f  =span_diad1, plo
-0001c380: 745f 6669 6775 7265 3d46 616c 7365 2c20  t_figure=False, 
-0001c390: 4469 6164 5f70 6f73 3d44 6961 645f 706f  Diad_pos=Diad_po
-0001c3a0: 732c 2048 425f 706f 733d 4842 5f70 6f73  s, HB_pos=HB_pos
-0001c3b0: 2c20 6669 745f 7065 616b 733d 636f 6e66  , fit_peaks=conf
-0001c3c0: 6967 5f74 7765 616b 6564 2e66 6974 5f70  ig_tweaked.fit_p
-0001c3d0: 6561 6b73 290a 2020 2020 2020 2020 2020  eaks).          
-0001c3e0: 2020 693d 692b 310a 2020 2020 2020 2020    i=i+1.        
-0001c3f0: 2020 2020 6966 2069 3e35 3a0a 2020 2020      if i>5:.    
-0001c400: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0001c410: 7428 2747 6f74 2074 6f20 3520 6974 6572  t('Got to 5 iter
-0001c420: 6174 6f69 6e73 2061 6e64 2073 7469 6c6c  atoins and still
-0001c430: 2063 6f75 6c64 6e74 2061 646a 7573 7420   couldnt adjust 
-0001c440: 7468 6520 6669 7420 7061 7261 6d65 7465  the fit paramete
-0001c450: 7273 2729 0a20 2020 2020 2020 2020 2020  rs').           
-0001c460: 2020 2020 2062 7265 616b 0a0a 0a0a 0a0a       break......
-0001c470: 0a20 2020 2023 2067 6574 2061 2062 6573  .    # get a bes
-0001c480: 7420 6669 7420 746f 2074 6865 2062 6173  t fit to the bas
-0001c490: 656c 696e 6520 7573 696e 6720 6120 6c69  eline using a li
-0001c4a0: 6e73 7061 6365 2066 726f 6d20 7468 6520  nspace from the 
-0001c4b0: 7065 616b 2066 6974 7469 6e67 0a20 2020  peak fitting.   
-0001c4c0: 2079 6261 7365 5f78 6c69 6e3d 5066 5f62   ybase_xlin=Pf_b
-0001c4d0: 6173 656c 696e 655f 6469 6164 3128 785f  aseline_diad1(x_
-0001c4e0: 6c69 6e29 0a0a 2020 2020 2320 5765 2065  lin)..    # We e
-0001c4f0: 7874 7261 6374 2074 6865 2066 756c 6c20  xtract the full 
-0001c500: 7370 6563 7472 6120 746f 2070 6c6f 7420  spectra to plot 
-0001c510: 6174 2074 6865 2065 6e64 2c20 616e 6420  at the end, and 
-0001c520: 636f 6e76 6572 7420 746f 2061 2064 6174  convert to a dat
-0001c530: 6166 7261 6d65 0a0a 0a20 2020 2053 7065  aframe...    Spe
-0001c540: 6374 7261 3d44 6961 640a 0a0a 0a20 2020  ctra=Diad....   
-0001c550: 2023 204d 616b 6520 6e69 6365 2066 6967   # Make nice fig
-0001c560: 7572 650a 2020 2020 6966 2070 6c6f 745f  ure.    if plot_
-0001c570: 6669 6775 7265 2069 7320 5472 7565 3a0a  figure is True:.
-0001c580: 0a20 2020 2020 2020 2066 6967 7572 655f  .        figure_
-0001c590: 6d6f 7361 6963 3d22 2222 0a20 2020 2020  mosaic=""".     
-0001c5a0: 2020 2058 590a 2020 2020 2020 2020 4142     XY.        AB
-0001c5b0: 0a20 2020 2020 2020 2043 440a 2020 2020  .        CD.    
-0001c5c0: 2020 2020 4545 0a20 2020 2020 2020 2022      EE.        "
-0001c5d0: 2222 0a0a 2020 2020 2020 2020 6669 672c  ""..        fig,
-0001c5e0: 6178 6573 3d70 6c74 2e73 7562 706c 6f74  axes=plt.subplot
-0001c5f0: 5f6d 6f73 6169 6328 6d6f 7361 6963 3d66  _mosaic(mosaic=f
-0001c600: 6967 7572 655f 6d6f 7361 6963 2c20 6669  igure_mosaic, fi
-0001c610: 6773 697a 653d 2831 322c 2031 3629 290a  gsize=(12, 16)).
-0001c620: 2020 2020 2020 2020 6669 672e 7375 7074          fig.supt
-0001c630: 6974 6c65 2827 4469 6164 2031 2c20 6669  itle('Diad 1, fi
-0001c640: 6c65 3d20 272b 2073 7472 2866 696c 656e  le= '+ str(filen
-0001c650: 616d 6529 202b 2027 205c 6e27 202b 2073  ame) + ' \n' + s
-0001c660: 7472 2864 665f 6f75 745b 2744 6961 6431  tr(df_out['Diad1
-0001c670: 5f72 6566 6974 275d 2e69 6c6f 635b 305d  _refit'].iloc[0]
-0001c680: 292c 2066 6f6e 7473 697a 653d 3136 2c20  ), fontsize=16, 
-0001c690: 783d 302e 352c 2079 3d31 2e30 290a 0a20  x=0.5, y=1.0).. 
-0001c6a0: 2020 2020 2020 2023 2042 6163 6b67 726f         # Backgro
-0001c6b0: 756e 6420 706c 6f74 2066 6f72 2072 6561  und plot for rea
-0001c6c0: 0a0a 2020 2020 2020 2020 2320 506c 6f74  ..        # Plot
-0001c6d0: 2062 6573 7420 6669 7420 6f6e 2074 6865   best fit on the
-0001c6e0: 204c 4853 2c20 616e 6420 696e 6469 7669   LHS, and indivi
-0001c6f0: 6475 616c 2066 6974 7320 6f6e 2074 6865  dual fits on the
-0001c700: 2052 4853 2061 7420 7468 6520 746f 700a   RHS at the top.
-0001c710: 0a20 2020 2020 2020 2061 7865 735b 2758  .        axes['X
-0001c720: 275d 2e73 6574 5f74 6974 6c65 2827 6129  '].set_title('a)
-0001c730: 2042 6163 6b67 726f 756e 6420 6669 7427   Background fit'
-0001c740: 290a 2020 2020 2020 2020 6178 6573 5b27  ).        axes['
-0001c750: 5827 5d2e 706c 6f74 2844 6961 645b 3a2c  X'].plot(Diad[:,
-0001c760: 2030 5d2c 2044 6961 645b 3a2c 2031 5d2c   0], Diad[:, 1],
-0001c770: 2027 2d27 2c20 636f 6c6f 723d 2767 7265   '-', color='gre
-0001c780: 7927 290a 2020 2020 2020 2020 6178 6573  y').        axes
-0001c790: 5b27 5827 5d2e 706c 6f74 2844 6961 645f  ['X'].plot(Diad_
-0001c7a0: 7368 6f72 745f 6469 6164 315b 3a2c 2030  short_diad1[:, 0
-0001c7b0: 5d2c 2044 6961 645f 7368 6f72 745f 6469  ], Diad_short_di
-0001c7c0: 6164 315b 3a2c 2031 5d2c 2027 2d72 272c  ad1[:, 1], '-r',
-0001c7d0: 206c 6162 656c 3d27 5370 6563 7472 6127   label='Spectra'
-0001c7e0: 290a 0a20 2020 2020 2020 2023 6178 6573  )..        #axes
-0001c7f0: 5b27 5827 5d2e 706c 6f74 2842 6173 656c  ['X'].plot(Basel
-0001c800: 696e 655b 3a2c 2030 5d2c 2042 6173 656c  ine[:, 0], Basel
-0001c810: 696e 655b 3a2c 2031 5d2c 2027 2d62 272c  ine[:, 1], '-b',
-0001c820: 206c 6162 656c 3d27 4263 6b20 706f 696e   label='Bck poin
-0001c830: 7473 2729 0a20 2020 2020 2020 2061 7865  ts').        axe
-0001c840: 735b 2758 275d 2e70 6c6f 7428 4261 7365  s['X'].plot(Base
-0001c850: 6c69 6e65 5f64 6961 6431 5b3a 2c20 305d  line_diad1[:, 0]
-0001c860: 2c20 4261 7365 6c69 6e65 5f64 6961 6431  , Baseline_diad1
-0001c870: 5b3a 2c20 315d 2c20 272e 6227 2c20 6c61  [:, 1], '.b', la
-0001c880: 6265 6c3d 2753 656c 2e20 6263 6b2e 2070  bel='Sel. bck. p
-0001c890: 7473 2729 0a20 2020 2020 2020 2061 7865  ts').        axe
-0001c8a0: 735b 2758 275d 2e70 6c6f 7428 4469 6164  s['X'].plot(Diad
-0001c8b0: 5f73 686f 7274 5f64 6961 6431 5b3a 2c20  _short_diad1[:, 
-0001c8c0: 305d 2c20 5079 5f62 6173 655f 6469 6164  0], Py_base_diad
-0001c8d0: 312c 2027 2d6b 272c 206c 6162 656c 3d27  1, '-k', label='
-0001c8e0: 6263 6b2e 2070 6f6c 7920 6669 7427 290a  bck. poly fit').
-0001c8f0: 0a0a 0a20 2020 2020 2020 2061 7831 5f79  ...        ax1_y
-0001c900: 6d69 6e3d 6e70 2e6d 696e 2842 6173 656c  min=np.min(Basel
-0001c910: 696e 655f 6469 6164 315b 3a2c 2031 5d29  ine_diad1[:, 1])
-0001c920: 2d31 302a 6e70 2e73 7464 2842 6173 656c  -10*np.std(Basel
-0001c930: 696e 655f 6469 6164 315b 3a2c 2031 5d29  ine_diad1[:, 1])
-0001c940: 0a20 2020 2020 2020 2061 7831 5f79 6d61  .        ax1_yma
-0001c950: 783d 6e70 2e6d 6178 2842 6173 656c 696e  x=np.max(Baselin
-0001c960: 655f 6469 6164 315b 3a2c 2031 5d29 2b31  e_diad1[:, 1])+1
-0001c970: 302a 6e70 2e73 7464 2842 6173 656c 696e  0*np.std(Baselin
-0001c980: 655f 6469 6164 315b 3a2c 2031 5d29 0a20  e_diad1[:, 1]). 
-0001c990: 2020 2020 2020 2061 7831 5f78 6d69 6e3d         ax1_xmin=
-0001c9a0: 636f 6e66 6967 312e 6c6f 7765 725f 6263  config1.lower_bc
-0001c9b0: 6b5f 6469 6164 315b 305d 2d33 300a 2020  k_diad1[0]-30.  
-0001c9c0: 2020 2020 2020 6178 315f 786d 6178 3d63        ax1_xmax=c
-0001c9d0: 6f6e 6669 6731 2e75 7070 6572 5f62 636b  onfig1.upper_bck
-0001c9e0: 5f64 6961 6431 5b31 5d2b 3330 0a20 2020  _diad1[1]+30.   
-0001c9f0: 2020 2020 2023 2041 6464 696e 6720 7061       # Adding pa
-0001ca00: 7463 6865 730a 0a0a 2020 2020 2020 2020  tches...        
-0001ca10: 7265 6374 5f64 6961 6431 5f62 313d 7061  rect_diad1_b1=pa
-0001ca20: 7463 6865 732e 5265 6374 616e 676c 6528  tches.Rectangle(
-0001ca30: 2863 6f6e 6669 6731 2e6c 6f77 6572 5f62  (config1.lower_b
-0001ca40: 636b 5f64 6961 6431 5b30 5d2c 2061 7831  ck_diad1[0], ax1
-0001ca50: 5f79 6d69 6e29 2c63 6f6e 6669 6731 2e6c  _ymin),config1.l
-0001ca60: 6f77 6572 5f62 636b 5f64 6961 6431 5b31  ower_bck_diad1[1
-0001ca70: 5d2d 636f 6e66 6967 312e 6c6f 7765 725f  ]-config1.lower_
-0001ca80: 6263 6b5f 6469 6164 315b 305d 2c61 7831  bck_diad1[0],ax1
-0001ca90: 5f79 6d61 782d 6178 315f 796d 696e 2c0a  _ymax-ax1_ymin,.
-0001caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cac0: 6c69 6e65 7769 6474 683d 312c 6564 6765  linewidth=1,edge
-0001cad0: 636f 6c6f 723d 276e 6f6e 6527 2c66 6163  color='none',fac
-0001cae0: 6563 6f6c 6f72 3d27 6379 616e 272c 206c  ecolor='cyan', l
-0001caf0: 6162 656c 3d27 7365 6c2e 2062 636b 2e20  abel='sel. bck. 
-0001cb00: 7265 6769 6f6e 272c 2061 6c70 6861 3d30  region', alpha=0
-0001cb10: 2e33 2c20 7a6f 7264 6572 3d30 290a 2020  .3, zorder=0).  
-0001cb20: 2020 2020 2020 6178 6573 5b27 5827 5d2e        axes['X'].
-0001cb30: 6164 645f 7061 7463 6828 7265 6374 5f64  add_patch(rect_d
-0001cb40: 6961 6431 5f62 3129 0a20 2020 2020 2020  iad1_b1).       
-0001cb50: 2072 6563 745f 6469 6164 315f 6232 3d70   rect_diad1_b2=p
-0001cb60: 6174 6368 6573 2e52 6563 7461 6e67 6c65  atches.Rectangle
-0001cb70: 2828 636f 6e66 6967 312e 7570 7065 725f  ((config1.upper_
-0001cb80: 6263 6b5f 6469 6164 315b 305d 2c20 6178  bck_diad1[0], ax
-0001cb90: 315f 796d 696e 292c 636f 6e66 6967 312e  1_ymin),config1.
+0001bd60: 5f61 6d70 6c69 7475 6465 2a31 300a 2020  _amplitude*10.  
+0001bd70: 2020 2020 2020 2020 2020 2320 6966 2061            # if a
+0001bd80: 6e79 2864 665f 6f75 745b 2744 6961 6431  ny(df_out['Diad1
+0001bd90: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
+0001bda0: 7461 696e 7328 2756 5f48 6967 6841 6d70  tains('V_HighAmp
+0001bdb0: 2729 293a 0a20 2020 2020 2020 2020 2020  ')):.           
+0001bdc0: 2023 2020 2020 2063 6f6e 6669 675f 7477   #     config_tw
+0001bdd0: 6561 6b65 6432 2e64 6961 645f 616d 706c  eaked2.diad_ampl
+0001bde0: 6974 7564 653d 636f 6e66 6967 5f74 7765  itude=config_twe
+0001bdf0: 616b 6564 2e64 6961 645f 616d 706c 6974  aked.diad_amplit
+0001be00: 7564 652f 3130 0a20 2020 2020 2020 2020  ude/10.         
+0001be10: 2020 2069 6620 616e 7928 6466 5f6f 7574     if any(df_out
+0001be20: 5b27 4469 6164 315f 7265 6669 7427 5d2e  ['Diad1_refit'].
+0001be30: 7374 722e 636f 6e74 6169 6e73 2827 565f  str.contains('V_
+0001be40: 5369 676d 615f 746f 6f5f 4c6f 7727 2929  Sigma_too_Low'))
+0001be50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001be60: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
+0001be70: 322e 6469 6164 5f73 6967 6d61 3d63 6f6e  2.diad_sigma=con
+0001be80: 6669 675f 7477 6561 6b65 642e 6469 6164  fig_tweaked.diad
+0001be90: 5f73 6967 6d61 2a66 6163 746f 7232 0a20  _sigma*factor2. 
+0001bea0: 2020 2020 2020 2020 2020 2069 6620 616e             if an
+0001beb0: 7928 6466 5f6f 7574 5b27 4469 6164 315f  y(df_out['Diad1_
+0001bec0: 7265 6669 7427 5d2e 7374 722e 636f 6e74  refit'].str.cont
+0001bed0: 6169 6e73 2827 565f 5369 676d 615f 746f  ains('V_Sigma_to
+0001bee0: 6f5f 4869 6768 2729 293a 0a20 2020 2020  o_High')):.     
+0001bef0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+0001bf00: 675f 7477 6561 6b65 6432 2e64 6961 645f  g_tweaked2.diad_
+0001bf10: 7369 676d 613d 636f 6e66 6967 5f74 7765  sigma=config_twe
+0001bf20: 616b 6564 2e64 6961 645f 7369 676d 612f  aked.diad_sigma/
+0001bf30: 6661 6374 6f72 320a 2020 2020 2020 2020  factor2.        
+0001bf40: 2020 2020 2320 4761 7573 7369 616e 2066      # Gaussian f
+0001bf50: 6974 2062 6974 730a 2020 2020 2020 2020  it bits.        
+0001bf60: 2020 2020 6966 2061 6e79 2864 665f 6f75      if any(df_ou
+0001bf70: 745b 2744 6961 6431 5f72 6566 6974 275d  t['Diad1_refit']
+0001bf80: 2e73 7472 2e63 6f6e 7461 696e 7328 2747  .str.contains('G
+0001bf90: 5f69 6e70 7574 5f54 6f6f 4869 6768 5369  _input_TooHighSi
+0001bfa0: 676d 6127 2929 3a0a 2020 2020 2020 2020  gma')):.        
+0001bfb0: 2020 2020 2020 2020 636f 6e66 6967 5f74          config_t
+0001bfc0: 7765 616b 6564 322e 6761 7573 735f 7369  weaked2.gauss_si
+0001bfd0: 676d 613d 636f 6e66 6967 5f74 7765 616b  gma=config_tweak
+0001bfe0: 6564 2e67 6175 7373 5f73 6967 6d61 2f66  ed.gauss_sigma/f
+0001bff0: 6163 746f 7232 0a20 2020 2020 2020 2020  actor2.         
+0001c000: 2020 2069 6620 616e 7928 6466 5f6f 7574     if any(df_out
+0001c010: 5b27 4469 6164 315f 7265 6669 7427 5d2e  ['Diad1_refit'].
+0001c020: 7374 722e 636f 6e74 6169 6e73 2827 475f  str.contains('G_
+0001c030: 696e 7075 745f 546f 6f4c 6f77 5369 676d  input_TooLowSigm
+0001c040: 6127 2929 3a0a 2020 2020 2020 2020 2020  a')):.          
+0001c050: 2020 2020 2020 636f 6e66 6967 5f74 7765        config_twe
+0001c060: 616b 6564 322e 6761 7573 735f 7369 676d  aked2.gauss_sigm
+0001c070: 613d 636f 6e66 6967 5f74 7765 616b 6564  a=config_tweaked
+0001c080: 2e67 6175 7373 5f73 6967 6d61 2a66 6163  .gauss_sigma*fac
+0001c090: 746f 7232 0a20 2020 2020 2020 2020 2020  tor2.           
+0001c0a0: 2069 6620 616e 7928 6466 5f6f 7574 5b27   if any(df_out['
+0001c0b0: 4469 6164 315f 7265 6669 7427 5d2e 7374  Diad1_refit'].st
+0001c0c0: 722e 636f 6e74 6169 6e73 2827 475f 696e  r.contains('G_in
+0001c0d0: 7075 745f 546f 6f4c 6f77 416d 7027 2929  put_TooLowAmp'))
+0001c0e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c0f0: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
+0001c100: 322e 6761 7573 735f 616d 706c 6974 7564  2.gauss_amplitud
+0001c110: 653d 636f 6e66 6967 5f74 7765 616b 6564  e=config_tweaked
+0001c120: 2e67 6175 7373 5f61 6d70 2a66 6163 746f  .gauss_amp*facto
+0001c130: 7232 0a20 2020 2020 2020 2020 2020 2069  r2.            i
+0001c140: 6620 616e 7928 6466 5f6f 7574 5b27 4469  f any(df_out['Di
+0001c150: 6164 315f 7265 6669 7427 5d2e 7374 722e  ad1_refit'].str.
+0001c160: 636f 6e74 6169 6e73 2827 475f 416d 705f  contains('G_Amp_
+0001c170: 746f 6f5f 6869 6768 2729 293a 0a20 2020  too_high')):.   
+0001c180: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001c190: 6669 675f 7477 6561 6b65 6432 2e67 6175  fig_tweaked2.gau
+0001c1a0: 7373 5f61 6d70 6c69 7475 6465 3d63 6f6e  ss_amplitude=con
+0001c1b0: 6669 675f 7477 6561 6b65 642e 6761 7573  fig_tweaked.gaus
+0001c1c0: 735f 616d 702f 6661 6374 6f72 320a 2020  s_amp/factor2.  
+0001c1d0: 2020 2020 2020 2020 2020 6966 2061 6e79            if any
+0001c1e0: 2864 665f 6f75 745b 2744 6961 6431 5f72  (df_out['Diad1_r
+0001c1f0: 6566 6974 275d 2e73 7472 2e63 6f6e 7461  efit'].str.conta
+0001c200: 696e 7328 2747 5f68 6967 6865 725f 7468  ins('G_higher_th
+0001c210: 616e 5f64 6961 6427 2929 3a0a 2020 2020  an_diad')):.    
+0001c220: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+0001c230: 6967 5f74 7765 616b 6564 322e 6761 7573  ig_tweaked2.gaus
+0001c240: 735f 616d 706c 6974 7564 653d 636f 6e66  s_amplitude=conf
+0001c250: 6967 5f74 7765 616b 6564 2e67 6175 7373  ig_tweaked.gauss
+0001c260: 5f61 6d70 2f66 6163 746f 7232 0a20 2020  _amp/factor2.   
+0001c270: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001c280: 6669 675f 7477 6561 6b65 6432 2e67 6175  fig_tweaked2.gau
+0001c290: 7373 5f73 6967 6d61 3d63 6f6e 6669 675f  ss_sigma=config_
+0001c2a0: 7477 6561 6b65 642e 6761 7573 735f 7369  tweaked.gauss_si
+0001c2b0: 676d 612a 6661 6374 6f72 320a 2020 2020  gma*factor2.    
+0001c2c0: 2020 2020 2020 2020 2320 486f 7420 6261          # Hot ba
+0001c2d0: 6e64 7320 6269 7473 0a20 2020 2020 2020  nds bits.       
+0001c2e0: 2020 2020 2023 2069 6620 616e 7928 6466       # if any(df
+0001c2f0: 5f6f 7574 5b27 4469 6164 315f 7265 6669  _out['Diad1_refi
+0001c300: 7427 5d2e 7374 722e 636f 6e74 6169 6e73  t'].str.contains
+0001c310: 2827 4842 315f 4c6f 7741 6d70 2729 293a  ('HB1_LowAmp')):
+0001c320: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+0001c330: 2020 2063 6f6e 6669 675f 7477 6561 6b65     config_tweake
+0001c340: 6432 2e48 425f 616d 706c 6974 7564 653d  d2.HB_amplitude=
+0001c350: 636f 6e66 6967 5f74 7765 616b 6564 2e48  config_tweaked.H
+0001c360: 425f 616d 706c 6974 7564 652f 320a 2020  B_amplitude/2.  
+0001c370: 2020 2020 2020 2020 2020 2320 6966 2061            # if a
+0001c380: 6e79 2864 665f 6f75 745b 2744 6961 6431  ny(df_out['Diad1
+0001c390: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
+0001c3a0: 7461 696e 7328 2748 4231 5f48 6967 6841  tains('HB1_HighA
+0001c3b0: 6d70 2729 293a 0a20 2020 2020 2020 2020  mp')):.         
+0001c3c0: 2020 2023 2020 2020 2063 6f6e 6669 675f     #     config_
+0001c3d0: 7477 6561 6b65 6432 2e48 425f 616d 706c  tweaked2.HB_ampl
+0001c3e0: 6974 7564 653d 636f 6e66 6967 5f74 7765  itude=config_twe
+0001c3f0: 616b 6564 2e48 425f 616d 706c 6974 7564  aked.HB_amplitud
+0001c400: 652a 320a 0a0a 2020 2020 2020 2020 2020  e*2...          
+0001c410: 2020 7265 7375 6c74 2c20 6466 5f6f 7574    result, df_out
+0001c420: 2c20 795f 6265 7374 5f66 6974 2c20 785f  , y_best_fit, x_
+0001c430: 6c69 6e2c 2063 6f6d 706f 6e65 6e74 732c  lin, components,
+0001c440: 2078 6461 742c 2079 6461 742c 2061 7831   xdat, ydat, ax1
+0001c450: 5f78 6c69 6d2c 2061 7832 5f78 6c69 6d2c  _xlim, ax2_xlim,
+0001c460: 7265 7369 6475 616c 5f64 6961 645f 636f  residual_diad_co
+0001c470: 6f72 6473 2c20 7964 6174 5f69 6e72 616e  ords, ydat_inran
+0001c480: 6765 2c20 2078 6461 745f 696e 7261 6e67  ge,  xdat_inrang
+0001c490: 653d 6669 745f 6761 7573 7369 616e 5f76  e=fit_gaussian_v
+0001c4a0: 6f69 6774 5f67 656e 6572 6963 5f64 6961  oigt_generic_dia
+0001c4b0: 6428 636f 6e66 6967 5f74 7765 616b 6564  d(config_tweaked
+0001c4c0: 322c 6469 6164 313d 5472 7565 2c20 7061  2,diad1=True, pa
+0001c4d0: 7468 3d70 6174 682c 2066 696c 656e 616d  th=path, filenam
+0001c4e0: 653d 6669 6c65 6e61 6d65 2c0a 2020 2020  e=filename,.    
+0001c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c500: 7864 6174 3d78 5f64 6961 6431 2c20 7964  xdat=x_diad1, yd
+0001c510: 6174 3d79 5f63 6f72 725f 6469 6164 312c  at=y_corr_diad1,
+0001c520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c530: 2020 2020 2073 7061 6e3d 7370 616e 5f64       span=span_d
+0001c540: 6961 6431 2c20 706c 6f74 5f66 6967 7572  iad1, plot_figur
+0001c550: 653d 4661 6c73 652c 2044 6961 645f 706f  e=False, Diad_po
+0001c560: 733d 4469 6164 5f70 6f73 2c20 4842 5f70  s=Diad_pos, HB_p
+0001c570: 6f73 3d48 425f 706f 732c 2066 6974 5f70  os=HB_pos, fit_p
+0001c580: 6561 6b73 3d63 6f6e 6669 675f 7477 6561  eaks=config_twea
+0001c590: 6b65 642e 6669 745f 7065 616b 7329 0a20  ked.fit_peaks). 
+0001c5a0: 2020 2020 2020 2020 2020 2069 3d69 2b31             i=i+1
+0001c5b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001c5c0: 693e 353a 0a20 2020 2020 2020 2020 2020  i>5:.           
+0001c5d0: 2020 2020 2070 7269 6e74 2827 476f 7420       print('Got 
+0001c5e0: 746f 2035 2069 7465 7261 746f 696e 7320  to 5 iteratoins 
+0001c5f0: 616e 6420 7374 696c 6c20 636f 756c 646e  and still couldn
+0001c600: 7420 6164 6a75 7374 2074 6865 2066 6974  t adjust the fit
+0001c610: 2070 6172 616d 6574 6572 7327 290a 2020   parameters').  
+0001c620: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0001c630: 6561 6b0a 0a0a 0a0a 0a0a 2020 2020 2320  eak.......    # 
+0001c640: 6765 7420 6120 6265 7374 2066 6974 2074  get a best fit t
+0001c650: 6f20 7468 6520 6261 7365 6c69 6e65 2075  o the baseline u
+0001c660: 7369 6e67 2061 206c 696e 7370 6163 6520  sing a linspace 
+0001c670: 6672 6f6d 2074 6865 2070 6561 6b20 6669  from the peak fi
+0001c680: 7474 696e 670a 2020 2020 7962 6173 655f  tting.    ybase_
+0001c690: 786c 696e 3d50 665f 6261 7365 6c69 6e65  xlin=Pf_baseline
+0001c6a0: 5f64 6961 6431 2878 5f6c 696e 290a 0a20  _diad1(x_lin).. 
+0001c6b0: 2020 2023 2057 6520 6578 7472 6163 7420     # We extract 
+0001c6c0: 7468 6520 6675 6c6c 2073 7065 6374 7261  the full spectra
+0001c6d0: 2074 6f20 706c 6f74 2061 7420 7468 6520   to plot at the 
+0001c6e0: 656e 642c 2061 6e64 2063 6f6e 7665 7274  end, and convert
+0001c6f0: 2074 6f20 6120 6461 7461 6672 616d 650a   to a dataframe.
+0001c700: 0a0a 2020 2020 5370 6563 7472 613d 4469  ..    Spectra=Di
+0001c710: 6164 0a0a 0a0a 2020 2020 2320 4d61 6b65  ad....    # Make
+0001c720: 206e 6963 6520 6669 6775 7265 0a20 2020   nice figure.   
+0001c730: 2069 6620 706c 6f74 5f66 6967 7572 6520   if plot_figure 
+0001c740: 6973 2054 7275 653a 0a0a 2020 2020 2020  is True:..      
+0001c750: 2020 6669 6775 7265 5f6d 6f73 6169 633d    figure_mosaic=
+0001c760: 2222 220a 2020 2020 2020 2020 5859 0a20  """.        XY. 
+0001c770: 2020 2020 2020 2041 420a 2020 2020 2020         AB.      
+0001c780: 2020 4344 0a20 2020 2020 2020 2045 450a    CD.        EE.
+0001c790: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0001c7a0: 2020 2020 2066 6967 2c61 7865 733d 706c       fig,axes=pl
+0001c7b0: 742e 7375 6270 6c6f 745f 6d6f 7361 6963  t.subplot_mosaic
+0001c7c0: 286d 6f73 6169 633d 6669 6775 7265 5f6d  (mosaic=figure_m
+0001c7d0: 6f73 6169 632c 2066 6967 7369 7a65 3d28  osaic, figsize=(
+0001c7e0: 3132 2c20 3136 2929 0a20 2020 2020 2020  12, 16)).       
+0001c7f0: 2066 6967 2e73 7570 7469 746c 6528 2744   fig.suptitle('D
+0001c800: 6961 6420 312c 2066 696c 653d 2027 2b20  iad 1, file= '+ 
+0001c810: 7374 7228 6669 6c65 6e61 6d65 2920 2b20  str(filename) + 
+0001c820: 2720 5c6e 2720 2b20 7374 7228 6466 5f6f  ' \n' + str(df_o
+0001c830: 7574 5b27 4469 6164 315f 7265 6669 7427  ut['Diad1_refit'
+0001c840: 5d2e 696c 6f63 5b30 5d29 2c20 666f 6e74  ].iloc[0]), font
+0001c850: 7369 7a65 3d31 362c 2078 3d30 2e35 2c20  size=16, x=0.5, 
+0001c860: 793d 312e 3029 0a0a 2020 2020 2020 2020  y=1.0)..        
+0001c870: 2320 4261 636b 6772 6f75 6e64 2070 6c6f  # Background plo
+0001c880: 7420 666f 7220 7265 610a 0a20 2020 2020  t for rea..     
+0001c890: 2020 2023 2050 6c6f 7420 6265 7374 2066     # Plot best f
+0001c8a0: 6974 206f 6e20 7468 6520 4c48 532c 2061  it on the LHS, a
+0001c8b0: 6e64 2069 6e64 6976 6964 7561 6c20 6669  nd individual fi
+0001c8c0: 7473 206f 6e20 7468 6520 5248 5320 6174  ts on the RHS at
+0001c8d0: 2074 6865 2074 6f70 0a0a 2020 2020 2020   the top..      
+0001c8e0: 2020 6178 6573 5b27 5827 5d2e 7365 745f    axes['X'].set_
+0001c8f0: 7469 746c 6528 2761 2920 4261 636b 6772  title('a) Backgr
+0001c900: 6f75 6e64 2066 6974 2729 0a20 2020 2020  ound fit').     
+0001c910: 2020 2061 7865 735b 2758 275d 2e70 6c6f     axes['X'].plo
+0001c920: 7428 4469 6164 5b3a 2c20 305d 2c20 4469  t(Diad[:, 0], Di
+0001c930: 6164 5b3a 2c20 315d 2c20 272d 272c 2063  ad[:, 1], '-', c
+0001c940: 6f6c 6f72 3d27 6772 6579 2729 0a20 2020  olor='grey').   
+0001c950: 2020 2020 2061 7865 735b 2758 275d 2e70       axes['X'].p
+0001c960: 6c6f 7428 4469 6164 5f73 686f 7274 5f64  lot(Diad_short_d
+0001c970: 6961 6431 5b3a 2c20 305d 2c20 4469 6164  iad1[:, 0], Diad
+0001c980: 5f73 686f 7274 5f64 6961 6431 5b3a 2c20  _short_diad1[:, 
+0001c990: 315d 2c20 272d 7227 2c20 6c61 6265 6c3d  1], '-r', label=
+0001c9a0: 2753 7065 6374 7261 2729 0a0a 2020 2020  'Spectra')..    
+0001c9b0: 2020 2020 2361 7865 735b 2758 275d 2e70      #axes['X'].p
+0001c9c0: 6c6f 7428 4261 7365 6c69 6e65 5b3a 2c20  lot(Baseline[:, 
+0001c9d0: 305d 2c20 4261 7365 6c69 6e65 5b3a 2c20  0], Baseline[:, 
+0001c9e0: 315d 2c20 272d 6227 2c20 6c61 6265 6c3d  1], '-b', label=
+0001c9f0: 2742 636b 2070 6f69 6e74 7327 290a 2020  'Bck points').  
+0001ca00: 2020 2020 2020 6178 6573 5b27 5827 5d2e        axes['X'].
+0001ca10: 706c 6f74 2842 6173 656c 696e 655f 6469  plot(Baseline_di
+0001ca20: 6164 315b 3a2c 2030 5d2c 2042 6173 656c  ad1[:, 0], Basel
+0001ca30: 696e 655f 6469 6164 315b 3a2c 2031 5d2c  ine_diad1[:, 1],
+0001ca40: 2027 2e62 272c 206c 6162 656c 3d27 5365   '.b', label='Se
+0001ca50: 6c2e 2062 636b 2e20 7074 7327 290a 2020  l. bck. pts').  
+0001ca60: 2020 2020 2020 6178 6573 5b27 5827 5d2e        axes['X'].
+0001ca70: 706c 6f74 2844 6961 645f 7368 6f72 745f  plot(Diad_short_
+0001ca80: 6469 6164 315b 3a2c 2030 5d2c 2050 795f  diad1[:, 0], Py_
+0001ca90: 6261 7365 5f64 6961 6431 2c20 272d 6b27  base_diad1, '-k'
+0001caa0: 2c20 6c61 6265 6c3d 2762 636b 2e20 706f  , label='bck. po
+0001cab0: 6c79 2066 6974 2729 0a0a 0a0a 2020 2020  ly fit')....    
+0001cac0: 2020 2020 6178 315f 796d 696e 3d6e 702e      ax1_ymin=np.
+0001cad0: 6d69 6e28 4261 7365 6c69 6e65 5f64 6961  min(Baseline_dia
+0001cae0: 6431 5b3a 2c20 315d 292d 3130 2a6e 702e  d1[:, 1])-10*np.
+0001caf0: 7374 6428 4261 7365 6c69 6e65 5f64 6961  std(Baseline_dia
+0001cb00: 6431 5b3a 2c20 315d 290a 2020 2020 2020  d1[:, 1]).      
+0001cb10: 2020 6178 315f 796d 6178 3d6e 702e 6d61    ax1_ymax=np.ma
+0001cb20: 7828 4261 7365 6c69 6e65 5f64 6961 6431  x(Baseline_diad1
+0001cb30: 5b3a 2c20 315d 292b 3130 2a6e 702e 7374  [:, 1])+10*np.st
+0001cb40: 6428 4261 7365 6c69 6e65 5f64 6961 6431  d(Baseline_diad1
+0001cb50: 5b3a 2c20 315d 290a 2020 2020 2020 2020  [:, 1]).        
+0001cb60: 6178 315f 786d 696e 3d63 6f6e 6669 6731  ax1_xmin=config1
+0001cb70: 2e6c 6f77 6572 5f62 636b 5f64 6961 6431  .lower_bck_diad1
+0001cb80: 5b30 5d2d 3330 0a20 2020 2020 2020 2061  [0]-30.        a
+0001cb90: 7831 5f78 6d61 783d 636f 6e66 6967 312e  x1_xmax=config1.
 0001cba0: 7570 7065 725f 6263 6b5f 6469 6164 315b  upper_bck_diad1[
-0001cbb0: 315d 2d63 6f6e 6669 6731 2e75 7070 6572  1]-config1.upper
-0001cbc0: 5f62 636b 5f64 6961 6431 5b30 5d2c 6178  _bck_diad1[0],ax
-0001cbd0: 315f 796d 6178 2d61 7831 5f79 6d69 6e2c  1_ymax-ax1_ymin,
-0001cbe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc00: 206c 696e 6577 6964 7468 3d31 2c65 6467   linewidth=1,edg
-0001cc10: 6563 6f6c 6f72 3d27 6e6f 6e65 272c 6661  ecolor='none',fa
-0001cc20: 6365 636f 6c6f 723d 2763 7961 6e27 2c20  cecolor='cyan', 
-0001cc30: 616c 7068 613d 302e 332c 207a 6f72 6465  alpha=0.3, zorde
-0001cc40: 723d 3029 0a20 2020 2020 2020 2061 7865  r=0).        axe
-0001cc50: 735b 2758 275d 2e61 6464 5f70 6174 6368  s['X'].add_patch
-0001cc60: 2872 6563 745f 6469 6164 315f 6232 290a  (rect_diad1_b2).
-0001cc70: 2020 2020 2020 2020 6178 6573 5b27 5827          axes['X'
-0001cc80: 5d2e 7365 745f 786c 696d 285b 6178 315f  ].set_xlim([ax1_
-0001cc90: 786d 696e 2c20 6178 315f 786d 6178 5d29  xmin, ax1_xmax])
-0001cca0: 0a20 2020 2020 2020 2061 7865 735b 2758  .        axes['X
-0001ccb0: 275d 2e73 6574 5f79 6c69 6d28 5b61 7831  '].set_ylim([ax1
-0001ccc0: 5f79 6d69 6e2c 2061 7831 5f79 6d61 785d  _ymin, ax1_ymax]
-0001ccd0: 290a 0a20 2020 2020 2020 2061 7865 735b  )..        axes[
-0001cce0: 2758 275d 2e73 6574 5f79 6c61 6265 6c28  'X'].set_ylabel(
-0001ccf0: 2749 6e74 656e 7369 7479 2729 0a20 2020  'Intensity').   
-0001cd00: 2020 2020 2061 7865 735b 2759 275d 2e73       axes['Y'].s
-0001cd10: 6574 5f79 6c61 6265 6c28 2749 6e74 656e  et_ylabel('Inten
-0001cd20: 7369 7479 2729 0a20 2020 2020 2020 2061  sity').        a
-0001cd30: 7865 735b 2759 275d 2e73 6574 5f78 6c61  xes['Y'].set_xla
-0001cd40: 6265 6c28 2757 6176 656e 756d 6265 7227  bel('Wavenumber'
-0001cd50: 290a 2020 2020 2020 2020 6178 6573 5b27  ).        axes['
-0001cd60: 5827 5d2e 6c65 6765 6e64 2829 0a0a 0a0a  X'].legend()....
-0001cd70: 2020 2020 2020 2020 6178 6573 5b27 5927          axes['Y'
-0001cd80: 5d2e 7365 745f 7469 746c 6528 2762 2920  ].set_title('b) 
-0001cd90: 4261 636b 6772 6f75 6e64 2073 7562 7472  Background subtr
-0001cda0: 6163 7465 6420 7370 6563 7472 6127 290a  acted spectra').
-0001cdb0: 2020 2020 2020 2020 6178 6573 5b27 5927          axes['Y'
-0001cdc0: 5d2e 706c 6f74 2878 5f64 6961 6431 2c20  ].plot(x_diad1, 
-0001cdd0: 795f 636f 7272 5f64 6961 6431 2c20 272d  y_corr_diad1, '-
-0001cde0: 7227 290a 2020 2020 2020 2020 6865 6967  r').        heig
-0001cdf0: 6874 5f70 3d6e 702e 6d61 7828 4469 6164  ht_p=np.max(Diad
-0001ce00: 5f73 686f 7274 5f64 6961 6431 5b3a 2c20  _short_diad1[:, 
-0001ce10: 315d 292d 6e70 2e6d 696e 2844 6961 645f  1])-np.min(Diad_
-0001ce20: 7368 6f72 745f 6469 6164 315b 3a2c 2031  short_diad1[:, 1
-0001ce30: 5d29 0a20 2020 2020 2020 2061 7865 735b  ]).        axes[
-0001ce40: 2759 275d 2e73 6574 5f79 6c69 6d28 5b6e  'Y'].set_ylim([n
-0001ce50: 702e 6d69 6e28 795f 636f 7272 5f64 6961  p.min(y_corr_dia
-0001ce60: 6431 292c 2031 2e32 2a68 6569 6768 745f  d1), 1.2*height_
-0001ce70: 7020 5d29 0a20 2020 2020 2020 2061 7865  p ]).        axe
-0001ce80: 735b 2758 275d 2e73 6574 5f78 6c61 6265  s['X'].set_xlabe
-0001ce90: 6c28 2757 6176 656e 756d 6265 7227 290a  l('Wavenumber').
-0001cea0: 0a0a 0a20 2020 2020 2020 2061 7865 735b  ...        axes[
-0001ceb0: 2741 275d 2e70 6c6f 7428 7864 6174 2c20  'A'].plot(xdat, 
-0001cec0: 7964 6174 2c20 2027 2e6b 272c 206c 6162  ydat,  '.k', lab
-0001ced0: 656c 3d27 6263 6b2e 2073 7562 2e20 6461  el='bck. sub. da
-0001cee0: 7461 2729 0a20 2020 2020 2020 2061 7865  ta').        axe
-0001cef0: 735b 2741 275d 2e70 6c6f 7428 2078 5f6c  s['A'].plot( x_l
-0001cf00: 696e 202c 795f 6265 7374 5f66 6974 2c20  in ,y_best_fit, 
-0001cf10: 272d 6727 2c20 6c69 6e65 7769 6474 683d  '-g', linewidth=
-0001cf20: 312c 206c 6162 656c 3d27 6265 7374 2066  1, label='best f
-0001cf30: 6974 2729 0a20 2020 2020 2020 2061 7865  it').        axe
-0001cf40: 735b 2741 275d 2e6c 6567 656e 6428 290a  s['A'].legend().
-0001cf50: 2020 2020 2020 2020 6178 6573 5b27 4127          axes['A'
-0001cf60: 5d2e 7365 745f 796c 6162 656c 2827 496e  ].set_ylabel('In
-0001cf70: 7465 6e73 6974 7927 290a 2020 2020 2020  tensity').      
-0001cf80: 2020 6178 6573 5b27 4127 5d2e 7365 745f    axes['A'].set_
-0001cf90: 786c 6162 656c 2827 5761 7665 6e75 6d62  xlabel('Wavenumb
-0001cfa0: 6572 2729 0a20 2020 2020 2020 2061 7865  er').        axe
-0001cfb0: 735b 2741 275d 2e73 6574 5f78 6c69 6d28  s['A'].set_xlim(
-0001cfc0: 6178 315f 786c 696d 290a 2020 2020 2020  ax1_xlim).      
-0001cfd0: 2020 6178 6573 5b27 4127 5d2e 7365 745f    axes['A'].set_
-0001cfe0: 7469 746c 6528 2763 2920 4f76 6572 616c  title('c) Overal
-0001cff0: 6c20 4265 7374 2046 6974 2729 0a0a 2020  l Best Fit')..  
-0001d000: 2020 2320 696e 6469 7669 6475 616c 2066    # individual f
-0001d010: 6974 730a 2020 2020 2020 2020 6178 6573  its.        axes
-0001d020: 5b27 4227 5d2e 706c 6f74 2878 6461 742c  ['B'].plot(xdat,
-0001d030: 2079 6461 742c 2027 2e6b 2729 0a0a 2020   ydat, '.k')..  
-0001d040: 2020 2020 2020 2320 5468 6973 2069 7320        # This is 
-0001d050: 666f 7220 6966 2074 6865 7265 2069 7320  for if there is 
-0001d060: 6d6f 7265 2074 6861 6e20 3120 7065 616b  more than 1 peak
-0001d070: 2c20 7468 6973 2069 7320 7768 656e 2077  , this is when w
-0001d080: 6520 7761 6e74 2074 6f20 706c 6f74 2074  e want to plot t
-0001d090: 6865 2062 6573 7420 6669 740a 2020 2020  he best fit.    
-0001d0a0: 2020 2020 6966 2066 6974 5f70 6561 6b73      if fit_peaks
-0001d0b0: 3e31 3a0a 0a20 2020 2020 2020 2020 2020  >1:..           
-0001d0c0: 2061 7865 735b 2742 275d 2e70 6c6f 7428   axes['B'].plot(
-0001d0d0: 785f 6c69 6e2c 2063 6f6d 706f 6e65 6e74  x_lin, component
-0001d0e0: 732e 6765 7428 276c 7a32 5f27 292c 2027  s.get('lz2_'), '
-0001d0f0: 2d72 272c 206c 696e 6577 6964 7468 3d32  -r', linewidth=2
-0001d100: 2c20 6c61 6265 6c3d 2748 4231 2729 0a0a  , label='HB1')..
-0001d110: 2020 2020 2020 2020 6178 6573 5b27 4227          axes['B'
-0001d120: 5d2e 706c 6f74 2878 5f6c 696e 2c20 636f  ].plot(x_lin, co
-0001d130: 6d70 6f6e 656e 7473 2e67 6574 2827 6c7a  mponents.get('lz
-0001d140: 315f 2729 2c20 272d 6227 2c20 6c69 6e65  1_'), '-b', line
-0001d150: 7769 6474 683d 322c 206c 6162 656c 3d27  width=2, label='
-0001d160: 4469 6164 3127 290a 2020 2020 2020 2020  Diad1').        
-0001d170: 6966 2063 6f6e 6669 6731 2e66 6974 5f67  if config1.fit_g
-0001d180: 6175 7373 2069 7320 6e6f 7420 4661 6c73  auss is not Fals
-0001d190: 653a 0a20 2020 2020 2020 2020 2020 2061  e:.            a
-0001d1a0: 7865 735b 2742 275d 2e70 6c6f 7428 785f  xes['B'].plot(x_
-0001d1b0: 6c69 6e2c 2063 6f6d 706f 6e65 6e74 732e  lin, components.
-0001d1c0: 6765 7428 2762 6b67 5f27 292c 2027 2d6d  get('bkg_'), '-m
-0001d1d0: 272c 206c 6162 656c 3d27 4761 7573 7369  ', label='Gaussi
-0001d1e0: 616e 2062 636b 272c 206c 696e 6577 6964  an bck', linewid
-0001d1f0: 7468 3d32 290a 2020 2020 2020 2020 2361  th=2).        #a
-0001d200: 7832 2e70 6c6f 7428 7864 6174 2c20 7265  x2.plot(xdat, re
-0001d210: 7375 6c74 2e62 6573 745f 6669 742c 2027  sult.best_fit, '
-0001d220: 2d67 272c 206c 6162 656c 3d27 6265 7374  -g', label='best
-0001d230: 2066 6974 2729 0a20 2020 2020 2020 2061   fit').        a
-0001d240: 7865 735b 2742 275d 2e6c 6567 656e 6428  xes['B'].legend(
-0001d250: 290a 0a20 2020 2020 2020 2066 6974 7370  )..        fitsp
-0001d260: 616e 3d6d 6178 2879 5f62 6573 745f 6669  an=max(y_best_fi
-0001d270: 7429 2d6d 696e 2879 5f62 6573 745f 6669  t)-min(y_best_fi
-0001d280: 7429 0a20 2020 2020 2020 2061 7865 735b  t).        axes[
-0001d290: 2742 275d 2e73 6574 5f79 6c69 6d28 5b6d  'B'].set_ylim([m
-0001d2a0: 696e 2879 5f62 6573 745f 6669 7429 2d66  in(y_best_fit)-f
-0001d2b0: 6974 7370 616e 2f35 2c20 6d61 7828 795f  itspan/5, max(y_
-0001d2c0: 6265 7374 5f66 6974 292b 6669 7473 7061  best_fit)+fitspa
-0001d2d0: 6e2f 355d 290a 0a20 2020 2020 2020 2061  n/5])..        a
-0001d2e0: 7865 735b 2742 275d 2e73 6574 5f79 6c61  xes['B'].set_yla
-0001d2f0: 6265 6c28 2749 6e74 656e 7369 7479 2729  bel('Intensity')
-0001d300: 0a20 2020 2020 2020 2061 7865 735b 2742  .        axes['B
-0001d310: 275d 2e73 6574 5f78 6c61 6265 6c28 2757  '].set_xlabel('W
-0001d320: 6176 656e 756d 6265 7227 290a 0a0a 2020  avenumber')...  
-0001d330: 2020 2020 2020 6178 6573 5b27 4227 5d2e        axes['B'].
-0001d340: 7365 745f 786c 696d 2861 7832 5f78 6c69  set_xlim(ax2_xli
-0001d350: 6d29 0a0a 2020 2020 2020 2020 2320 4461  m)..        # Da
-0001d360: 7368 6564 206c 696e 6573 2073 6f20 6d61  shed lines so ma
-0001d370: 7463 6865 7320 7061 7274 2044 0a20 2020  tches part D.   
-0001d380: 2020 2020 2061 7865 735b 2742 275d 2e70       axes['B'].p
-0001d390: 6c6f 7428 5b64 665f 6f75 745b 2744 6961  lot([df_out['Dia
-0001d3a0: 6431 5f56 6f69 6774 5f43 656e 7427 5d2c  d1_Voigt_Cent'],
-0001d3b0: 2064 665f 6f75 745b 2744 6961 6431 5f56   df_out['Diad1_V
-0001d3c0: 6f69 6774 5f43 656e 7427 5d5d 2c20 5b6e  oigt_Cent']], [n
-0001d3d0: 702e 6d69 6e28 7964 6174 292c 206e 702e  p.min(ydat), np.
-0001d3e0: 6d61 7828 7964 6174 295d 2c20 273a 6227  max(ydat)], ':b'
-0001d3f0: 290a 0a20 2020 2020 2020 2069 6620 6669  )..        if fi
-0001d400: 745f 7065 616b 733e 323a 0a20 2020 2020  t_peaks>2:.     
-0001d410: 2020 2020 2020 2061 7865 735b 2742 275d         axes['B']
-0001d420: 2e70 6c6f 7428 5b64 665f 6f75 745b 2748  .plot([df_out['H
-0001d430: 4231 5f43 656e 7427 5d2c 2064 665f 6f75  B1_Cent'], df_ou
-0001d440: 745b 2748 4231 5f43 656e 7427 5d5d 2c20  t['HB1_Cent']], 
-0001d450: 5b6e 702e 6d69 6e28 7964 6174 292c 206e  [np.min(ydat), n
-0001d460: 702e 6d61 7828 7964 6174 295d 2c20 273a  p.max(ydat)], ':
-0001d470: 7227 290a 0a20 2020 2020 2020 2061 7865  r')..        axe
-0001d480: 735b 2742 275d 2e73 6574 5f74 6974 6c65  s['B'].set_title
-0001d490: 2827 6329 2046 6974 2043 6f6d 706f 6e65  ('c) Fit Compone
-0001d4a0: 6e74 7327 290a 0a20 2020 2020 2020 2023  nts')..        #
-0001d4b0: 2042 6163 6b67 726f 756e 6420 6669 740a   Background fit.
-0001d4c0: 0a20 2020 2020 2020 2023 2046 6972 7374  .        # First
-0001d4d0: 2c20 7365 7420 7570 2078 2061 6e64 2079  , set up x and y
-0001d4e0: 206c 696d 6974 7320 6f6e 2061 7869 730a   limits on axis.
-0001d4f0: 0a20 2020 2020 2020 2069 6620 636f 6e66  .        if conf
-0001d500: 6967 312e 785f 7261 6e67 655f 6261 7365  ig1.x_range_base
-0001d510: 6c69 6e65 2069 7320 6e6f 7420 4e6f 6e65  line is not None
-0001d520: 3a0a 2020 2020 2020 2020 2020 2020 6178  :.            ax
-0001d530: 635f 786d 696e 3d64 665f 6f75 745b 2744  c_xmin=df_out['D
-0001d540: 6961 6431 5f56 6f69 6774 5f43 656e 7427  iad1_Voigt_Cent'
-0001d550: 5d5b 305d 2d63 6f6e 6669 6731 2e78 5f72  ][0]-config1.x_r
-0001d560: 616e 6765 5f62 6173 656c 696e 650a 2020  ange_baseline.  
-0001d570: 2020 2020 2020 2020 2020 6178 635f 786d            axc_xm
-0001d580: 6178 3d64 665f 6f75 745b 2744 6961 6431  ax=df_out['Diad1
-0001d590: 5f56 6f69 6774 5f43 656e 7427 5d5b 305d  _Voigt_Cent'][0]
-0001d5a0: 2b63 6f6e 6669 6731 2e78 5f72 616e 6765  +config1.x_range
-0001d5b0: 5f62 6173 656c 696e 650a 2020 2020 2020  _baseline.      
-0001d5c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001d5d0: 2020 2020 6178 635f 786d 696e 3d63 6f6e      axc_xmin=con
-0001d5e0: 6669 6731 2e6c 6f77 6572 5f62 636b 5f64  fig1.lower_bck_d
-0001d5f0: 6961 6431 5b30 5d0a 2020 2020 2020 2020  iad1[0].        
-0001d600: 2020 2020 6178 635f 786d 6178 3d63 6f6e      axc_xmax=con
-0001d610: 6669 6731 2e75 7070 6572 5f62 636b 5f64  fig1.upper_bck_d
-0001d620: 6961 6431 5b31 5d0a 0a20 2020 2020 2020  iad1[1]..       
-0001d630: 2061 7863 5f79 6d69 6e3d 6e70 2e6d 696e   axc_ymin=np.min
-0001d640: 2842 6173 656c 696e 655f 6469 6164 315b  (Baseline_diad1[
-0001d650: 3a2c 2031 5d29 2d63 6f6e 6669 6731 2e79  :, 1])-config1.y
-0001d660: 5f72 616e 6765 5f62 6173 656c 696e 650a  _range_baseline.
-0001d670: 2020 2020 2020 2020 6178 635f 796d 6178          axc_ymax
-0001d680: 3d6e 702e 6d61 7828 4261 7365 6c69 6e65  =np.max(Baseline
-0001d690: 5f64 6961 6431 5b3a 2c20 315d 292b 636f  _diad1[:, 1])+co
-0001d6a0: 6e66 6967 312e 795f 7261 6e67 655f 6261  nfig1.y_range_ba
-0001d6b0: 7365 6c69 6e65 0a0a 0a0a 0a20 2020 2020  seline.....     
-0001d6c0: 2020 2061 7865 735b 2743 275d 2e73 6574     axes['C'].set
-0001d6d0: 5f74 6974 6c65 2827 6429 2050 6561 6b73  _title('d) Peaks
-0001d6e0: 206f 7665 726c 6169 6e20 6f6e 2064 6174   overlain on dat
-0001d6f0: 6120 6265 666f 7265 2073 7562 7472 6163  a before subtrac
-0001d700: 7469 6f6e 2729 0a20 2020 2020 2020 2061  tion').        a
-0001d710: 7865 735b 2743 275d 2e70 6c6f 7428 4469  xes['C'].plot(Di
-0001d720: 6164 5f73 686f 7274 5f64 6961 6431 5b3a  ad_short_diad1[:
-0001d730: 2c20 305d 2c20 4469 6164 5f73 686f 7274  , 0], Diad_short
-0001d740: 5f64 6961 6431 5b3a 2c20 315d 2c20 272e  _diad1[:, 1], '.
-0001d750: 7227 2c20 6c61 6265 6c3d 2744 6174 6127  r', label='Data'
-0001d760: 290a 2020 2020 2020 2020 6178 6573 5b27  ).        axes['
-0001d770: 4327 5d2e 706c 6f74 2842 6173 656c 696e  C'].plot(Baselin
-0001d780: 655f 6469 6164 315b 3a2c 2030 5d2c 2042  e_diad1[:, 0], B
-0001d790: 6173 656c 696e 655f 6469 6164 315b 3a2c  aseline_diad1[:,
-0001d7a0: 2031 5d2c 2027 2e62 272c 206c 6162 656c   1], '.b', label
-0001d7b0: 3d27 6263 6b27 290a 2020 2020 2020 2020  ='bck').        
-0001d7c0: 6178 6573 5b27 4327 5d2e 706c 6f74 2844  axes['C'].plot(D
-0001d7d0: 6961 645f 7368 6f72 745f 6469 6164 315b  iad_short_diad1[
-0001d7e0: 3a2c 2030 5d2c 2050 795f 6261 7365 5f64  :, 0], Py_base_d
-0001d7f0: 6961 6431 2c20 272d 6b27 2c20 6c61 6265  iad1, '-k', labe
-0001d800: 6c3d 2750 6f6c 7920 6263 6b20 6669 7427  l='Poly bck fit'
-0001d810: 290a 0a0a 2020 2020 2020 2020 6178 6573  )...        axes
-0001d820: 5b27 4327 5d2e 7365 745f 796c 6162 656c  ['C'].set_ylabel
-0001d830: 2827 496e 7465 6e73 6974 7927 290a 2020  ('Intensity').  
-0001d840: 2020 2020 2020 6178 6573 5b27 4327 5d2e        axes['C'].
-0001d850: 7365 745f 786c 6162 656c 2827 5761 7665  set_xlabel('Wave
-0001d860: 6e75 6d62 6572 2729 0a0a 0a20 2020 2020  number')...     
-0001d870: 2020 2069 6620 636f 6e66 6967 312e 6669     if config1.fi
-0001d880: 745f 6761 7573 7320 6973 206e 6f74 2046  t_gauss is not F
-0001d890: 616c 7365 3a0a 0a20 2020 2020 2020 2020  alse:..         
-0001d8a0: 2020 2061 7865 735b 2743 275d 2e70 6c6f     axes['C'].plo
-0001d8b0: 7428 785f 6c69 6e2c 2063 6f6d 706f 6e65  t(x_lin, compone
-0001d8c0: 6e74 732e 6765 7428 2762 6b67 5f27 292b  nts.get('bkg_')+
-0001d8d0: 7962 6173 655f 786c 696e 2c20 272d 6d27  ybase_xlin, '-m'
-0001d8e0: 2c20 6c61 6265 6c3d 2747 6175 7373 6961  , label='Gaussia
-0001d8f0: 6e20 6263 6b27 2c20 6c69 6e65 7769 6474  n bck', linewidt
-0001d900: 683d 3229 0a0a 2020 2020 2020 2020 6178  h=2)..        ax
-0001d910: 6573 5b27 4327 5d2e 706c 6f74 2820 785f  es['C'].plot( x_
-0001d920: 6c69 6e20 2c79 5f62 6573 745f 6669 742b  lin ,y_best_fit+
-0001d930: 7962 6173 655f 786c 696e 2c20 272d 6727  ybase_xlin, '-g'
-0001d940: 2c20 6c69 6e65 7769 6474 683d 322c 206c  , linewidth=2, l
-0001d950: 6162 656c 3d27 4265 7374 2046 6974 2729  abel='Best Fit')
-0001d960: 0a20 2020 2020 2020 2061 7865 735b 2743  .        axes['C
-0001d970: 275d 2e70 6c6f 7428 785f 6c69 6e2c 2063  '].plot(x_lin, c
-0001d980: 6f6d 706f 6e65 6e74 732e 6765 7428 276c  omponents.get('l
-0001d990: 7a31 5f27 292b 7962 6173 655f 786c 696e  z1_')+ybase_xlin
-0001d9a0: 2c20 272d 6227 2c20 6c61 6265 6c3d 2744  , '-b', label='D
-0001d9b0: 6961 6431 272c 206c 696e 6577 6964 7468  iad1', linewidth
-0001d9c0: 3d31 290a 0a20 2020 2020 2020 2069 6620  =1)..        if 
-0001d9d0: 6669 745f 7065 616b 733e 313a 0a20 2020  fit_peaks>1:.   
-0001d9e0: 2020 2020 2020 2020 2061 7865 735b 2743           axes['C
-0001d9f0: 275d 2e70 6c6f 7428 785f 6c69 6e2c 2063  '].plot(x_lin, c
-0001da00: 6f6d 706f 6e65 6e74 732e 6765 7428 276c  omponents.get('l
-0001da10: 7a32 5f27 292b 7962 6173 655f 786c 696e  z2_')+ybase_xlin
-0001da20: 2c20 272d 7227 2c20 6c61 6265 6c3d 2748  , '-r', label='H
-0001da30: 4231 272c 206c 696e 6577 6964 7468 3d31  B1', linewidth=1
-0001da40: 290a 0a0a 0a0a 2020 2020 2020 2020 6178  ).....        ax
-0001da50: 6573 5b27 4327 5d2e 6c65 6765 6e64 286e  es['C'].legend(n
-0001da60: 636f 6c3d 332c 206c 6f63 3d27 6c6f 7765  col=3, loc='lowe
-0001da70: 7220 6365 6e74 6572 2729 0a20 2020 2020  r center').     
-0001da80: 2020 2061 7865 735b 2743 275d 2e73 6574     axes['C'].set
-0001da90: 5f78 6c69 6d28 5b61 7863 5f78 6d69 6e2c  _xlim([axc_xmin,
-0001daa0: 2061 7863 5f78 6d61 785d 290a 2020 2020   axc_xmax]).    
-0001dab0: 2020 2020 6178 6573 5b27 4327 5d2e 7365      axes['C'].se
-0001dac0: 745f 796c 696d 285b 6178 635f 796d 696e  t_ylim([axc_ymin
-0001dad0: 2c20 6178 635f 796d 6178 5d29 0a20 2020  , axc_ymax]).   
-0001dae0: 2020 2020 2023 6178 6573 5b27 4327 5d2e       #axes['C'].
-0001daf0: 706c 6f74 2844 6961 645f 7368 6f72 745b  plot(Diad_short[
-0001db00: 3a2c 2030 5d2c 2044 6961 645f 7368 6f72  :, 0], Diad_shor
-0001db10: 745b 3a2c 2031 5d2c 2027 2272 272c 206c  t[:, 1], '"r', l
-0001db20: 6162 656c 3d27 4461 7461 2729 0a0a 0a20  abel='Data')... 
-0001db30: 2020 2020 2020 2023 2052 6573 6964 7561         # Residua
-0001db40: 6c20 6f6e 2070 6c6f 7420 440a 2020 2020  l on plot D.    
-0001db50: 2020 2020 6178 6573 5b27 4427 5d2e 7365      axes['D'].se
-0001db60: 745f 7469 746c 6528 2766 2920 5265 7369  t_title('f) Resi
-0001db70: 6475 616c 7327 290a 2020 2020 2020 2020  duals').        
-0001db80: 6178 6573 5b27 4427 5d2e 706c 6f74 285b  axes['D'].plot([
-0001db90: 6466 5f6f 7574 5b27 4469 6164 315f 566f  df_out['Diad1_Vo
-0001dba0: 6967 745f 4365 6e74 275d 2c20 6466 5f6f  igt_Cent'], df_o
-0001dbb0: 7574 5b27 4469 6164 315f 566f 6967 745f  ut['Diad1_Voigt_
-0001dbc0: 4365 6e74 275d 5d2c 205b 6e70 2e6d 696e  Cent']], [np.min
-0001dbd0: 2872 6573 6964 7561 6c5f 6469 6164 5f63  (residual_diad_c
-0001dbe0: 6f6f 7264 7329 2c20 6e70 2e6d 6178 2872  oords), np.max(r
-0001dbf0: 6573 6964 7561 6c5f 6469 6164 5f63 6f6f  esidual_diad_coo
-0001dc00: 7264 7329 5d2c 2027 3a62 2729 0a20 2020  rds)], ':b').   
-0001dc10: 2020 2020 2069 6620 6669 745f 7065 616b       if fit_peak
-0001dc20: 733e 323a 0a20 2020 2020 2020 2020 2020  s>2:.           
-0001dc30: 2061 7865 735b 2744 275d 2e70 6c6f 7428   axes['D'].plot(
-0001dc40: 5b64 665f 6f75 745b 2748 4231 5f43 656e  [df_out['HB1_Cen
-0001dc50: 7427 5d2c 2064 665f 6f75 745b 2748 4231  t'], df_out['HB1
-0001dc60: 5f43 656e 7427 5d5d 2c20 5b6e 702e 6d69  _Cent']], [np.mi
-0001dc70: 6e28 7265 7369 6475 616c 5f64 6961 645f  n(residual_diad_
-0001dc80: 636f 6f72 6473 292c 206e 702e 6d61 7828  coords), np.max(
-0001dc90: 7265 7369 6475 616c 5f64 6961 645f 636f  residual_diad_co
-0001dca0: 6f72 6473 295d 2c20 273a 7227 290a 0a20  ords)], ':r').. 
-0001dcb0: 2020 2020 2020 2061 7865 735b 2744 275d         axes['D']
-0001dcc0: 2e70 6c6f 7428 7864 6174 5f69 6e72 616e  .plot(xdat_inran
-0001dcd0: 6765 2c20 7265 7369 6475 616c 5f64 6961  ge, residual_dia
-0001dce0: 645f 636f 6f72 6473 2c20 276f 6b27 2c20  d_coords, 'ok', 
-0001dcf0: 6d66 633d 2763 2720 290a 2020 2020 2020  mfc='c' ).      
-0001dd00: 2020 6178 6573 5b27 4427 5d2e 706c 6f74    axes['D'].plot
-0001dd10: 2878 6461 745f 696e 7261 6e67 652c 2072  (xdat_inrange, r
-0001dd20: 6573 6964 7561 6c5f 6469 6164 5f63 6f6f  esidual_diad_coo
-0001dd30: 7264 732c 2027 2d63 2720 290a 2020 2020  rds, '-c' ).    
-0001dd40: 2020 2020 6178 6573 5b27 4427 5d2e 7365      axes['D'].se
-0001dd50: 745f 796c 6162 656c 2827 5265 7369 6475  t_ylabel('Residu
-0001dd60: 616c 2729 0a20 2020 2020 2020 2061 7865  al').        axe
-0001dd70: 735b 2744 275d 2e73 6574 5f78 6c61 6265  s['D'].set_xlabe
-0001dd80: 6c28 2757 6176 656e 756d 6265 7227 290a  l('Wavenumber').
-0001dd90: 2020 2020 2020 2020 2320 6178 6573 5b27          # axes['
-0001dda0: 4427 5d2e 7365 745f 786c 696d 2861 7831  D'].set_xlim(ax1
-0001ddb0: 5f78 6c69 6d29 0a20 2020 2020 2020 2023  _xlim).        #
-0001ddc0: 2061 7865 735b 2744 275d 2e73 6574 5f78   axes['D'].set_x
-0001ddd0: 6c69 6d28 6178 325f 786c 696d 290a 2020  lim(ax2_xlim).  
-0001dde0: 2020 2020 2020 4c6f 6361 6c5f 5265 7369        Local_Resi
-0001ddf0: 6475 616c 5f64 6961 6431 3d72 6573 6964  dual_diad1=resid
-0001de00: 7561 6c5f 6469 6164 5f63 6f6f 7264 735b  ual_diad_coords[
-0001de10: 2828 7864 6174 5f69 6e72 616e 6765 3e28  ((xdat_inrange>(
-0001de20: 6466 5f6f 7574 5b27 4469 6164 315f 566f  df_out['Diad1_Vo
-0001de30: 6967 745f 4365 6e74 275d 5b30 5d2d 636f  igt_Cent'][0]-co
-0001de40: 6e66 6967 312e 785f 7261 6e67 655f 7265  nfig1.x_range_re
-0001de50: 7369 6475 616c 2929 0a20 2020 2020 2020  sidual)).       
-0001de60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de80: 2020 2020 2020 2020 2026 2878 6461 745f           &(xdat_
-0001de90: 696e 7261 6e67 653c 6466 5f6f 7574 5b27  inrange<df_out['
-0001dea0: 4469 6164 315f 566f 6967 745f 4365 6e74  Diad1_Voigt_Cent
-0001deb0: 275d 5b30 5d2b 636f 6e66 6967 312e 785f  '][0]+config1.x_
-0001dec0: 7261 6e67 655f 7265 7369 6475 616c 2929  range_residual))
-0001ded0: 5d0a 2020 2020 2020 2020 6178 6573 5b27  ].        axes['
-0001dee0: 4427 5d2e 7365 745f 786c 696d 285b 6466  D'].set_xlim([df
-0001def0: 5f6f 7574 5b27 4469 6164 315f 566f 6967  _out['Diad1_Voig
-0001df00: 745f 4365 6e74 275d 5b30 5d2d 636f 6e66  t_Cent'][0]-conf
-0001df10: 6967 312e 785f 7261 6e67 655f 7265 7369  ig1.x_range_resi
-0001df20: 6475 616c 2c0a 2020 2020 2020 2020 2020  dual,.          
-0001df30: 2020 2020 2020 2020 2020 6466 5f6f 7574            df_out
-0001df40: 5b27 4469 6164 315f 566f 6967 745f 4365  ['Diad1_Voigt_Ce
-0001df50: 6e74 275d 5b30 5d2b 636f 6e66 6967 312e  nt'][0]+config1.
-0001df60: 785f 7261 6e67 655f 7265 7369 6475 616c  x_range_residual
-0001df70: 5d29 0a20 2020 2020 2020 2023 6178 352e  ]).        #ax5.
-0001df80: 706c 6f74 285b 6365 6e74 5f31 3131 372c  plot([cent_1117,
-0001df90: 2063 656e 745f 3131 3137 205d 2c20 5b6e   cent_1117 ], [n
-0001dfa0: 702e 6d69 6e28 4c6f 6361 6c5f 5265 7369  p.min(Local_Resi
-0001dfb0: 6475 616c 5f31 3131 3729 2d31 302c 206e  dual_1117)-10, n
-0001dfc0: 702e 6d61 7828 4c6f 6361 6c5f 5265 7369  p.max(Local_Resi
-0001dfd0: 6475 616c 5f31 3131 3729 2b31 305d 2c20  dual_1117)+10], 
-0001dfe0: 273a 6b27 290a 0a0a 0a20 2020 2020 2020  ':k')....       
-0001dff0: 2061 7865 735b 2744 275d 2e73 6574 5f79   axes['D'].set_y
-0001e000: 6c69 6d28 5b6e 702e 6d69 6e28 4c6f 6361  lim([np.min(Loca
-0001e010: 6c5f 5265 7369 6475 616c 5f64 6961 6431  l_Residual_diad1
-0001e020: 292d 3130 2c20 6e70 2e6d 6178 284c 6f63  )-10, np.max(Loc
-0001e030: 616c 5f52 6573 6964 7561 6c5f 6469 6164  al_Residual_diad
-0001e040: 3129 2b31 305d 290a 0a0a 0a0a 0a20 2020  1)+10])......   
-0001e050: 2020 2020 2023 204f 7665 7261 6c20 7370       # Overal sp
-0001e060: 6563 7472 610a 2020 2020 2020 2020 6178  ectra.        ax
-0001e070: 6573 5b27 4527 5d2e 7365 745f 7469 746c  es['E'].set_titl
-0001e080: 6528 2767 2920 5375 6d6d 6172 7920 706c  e('g) Summary pl
-0001e090: 6f74 206f 6620 7261 7720 7370 6563 7472  ot of raw spectr
-0001e0a0: 6120 666f 7220 6669 6c65 203d 2027 202b  a for file = ' +
-0001e0b0: 2066 696c 656e 616d 6529 0a20 2020 2020   filename).     
-0001e0c0: 2020 2061 7865 735b 2745 275d 2e70 6c6f     axes['E'].plo
-0001e0d0: 7428 5370 6563 7472 615b 3a2c 2030 5d2c  t(Spectra[:, 0],
-0001e0e0: 2053 7065 6374 7261 5b3a 2c20 315d 2c20   Spectra[:, 1], 
-0001e0f0: 272d 7227 290a 2020 2020 2020 2020 6178  '-r').        ax
-0001e100: 6573 5b27 4527 5d2e 7365 745f 796c 6162  es['E'].set_ylab
-0001e110: 656c 2827 496e 7465 6e73 6974 7927 290a  el('Intensity').
-0001e120: 2020 2020 2020 2020 6178 6573 5b27 4527          axes['E'
-0001e130: 5d2e 7365 745f 786c 6162 656c 2827 5761  ].set_xlabel('Wa
-0001e140: 7665 6e75 6d62 6572 2729 0a0a 0a20 2020  venumber')...   
-0001e150: 2020 2020 2070 6174 6833 3d70 6174 682b       path3=path+
-0001e160: 272f 272b 2764 6961 645f 6669 745f 696d  '/'+'diad_fit_im
-0001e170: 6167 6573 270a 2020 2020 2020 2020 6966  ages'.        if
-0001e180: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-0001e190: 7061 7468 3329 3a0a 2020 2020 2020 2020  path3):.        
-0001e1a0: 2020 2020 6f75 743d 2770 6174 6820 6578      out='path ex
-0001e1b0: 6973 7473 270a 2020 2020 2020 2020 656c  ists'.        el
-0001e1c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001e1d0: 6f73 2e6d 616b 6564 6972 7328 7061 7468  os.makedirs(path
-0001e1e0: 2b27 2f27 2b20 2764 6961 645f 6669 745f  +'/'+ 'diad_fit_
-0001e1f0: 696d 6167 6573 272c 2065 7869 7374 5f6f  images', exist_o
-0001e200: 6b3d 4661 6c73 6529 0a0a 2020 2020 2020  k=False)..      
-0001e210: 2020 6669 672e 7469 6768 745f 6c61 796f    fig.tight_layo
-0001e220: 7574 2829 0a0a 2020 2020 2020 2020 6669  ut()..        fi
-0001e230: 6c65 3d66 696c 656e 616d 652e 7273 706c  le=filename.rspl
-0001e240: 6974 2827 2e74 7874 272c 2031 295b 305d  it('.txt', 1)[0]
-0001e250: 0a20 2020 2020 2020 2066 6967 2e73 6176  .        fig.sav
-0001e260: 6566 6967 2870 6174 6833 2b27 2f27 2b27  efig(path3+'/'+'
-0001e270: 4469 6164 315f 4669 745f 7b7d 2e70 6e67  Diad1_Fit_{}.png
-0001e280: 272e 666f 726d 6174 2866 696c 6529 2c20  '.format(file), 
-0001e290: 6470 693d 636f 6e66 6967 312e 6470 6929  dpi=config1.dpi)
-0001e2a0: 0a0a 2020 2020 2020 2020 6966 2063 6c6f  ..        if clo
-0001e2b0: 7365 5f66 6967 7572 6520 6973 2054 7275  se_figure is Tru
-0001e2c0: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-0001e2d0: 6c74 2e63 6c6f 7365 2866 6967 290a 0a20  lt.close(fig).. 
-0001e2e0: 2020 2023 204c 6574 7320 6361 6c63 756c     # Lets calcul
-0001e2f0: 6174 6520 7065 616b 2073 6b65 776e 6573  ate peak skewnes
-0001e300: 7320 6865 7265 2e0a 2020 2020 536b 6577  s here..    Skew
-0001e310: 3530 3d61 7373 6573 735f 6469 6164 315f  50=assess_diad1_
-0001e320: 736b 6577 6e65 7373 2863 6f6e 6669 6731  skewness(config1
-0001e330: 3d64 6961 6431 5f66 6974 5f63 6f6e 6669  =diad1_fit_confi
-0001e340: 6728 292c 2069 6e74 5f63 7574 5f6f 6666  g(), int_cut_off
-0001e350: 3d30 2e35 2c20 7061 7468 3d70 6174 682c  =0.5, path=path,
-0001e360: 2066 696c 656e 616d 653d 6669 6c65 6e61   filename=filena
-0001e370: 6d65 2c20 6669 6c65 7479 7065 3d66 696c  me, filetype=fil
-0001e380: 6574 7970 652c 0a20 2020 2073 6b65 776e  etype,.    skewn
-0001e390: 6573 733d 2761 6273 272c 2068 6569 6768  ess='abs', heigh
-0001e3a0: 743d 312c 2070 726f 6d69 6e65 6e63 653d  t=1, prominence=
-0001e3b0: 352c 2077 6964 7468 3d30 2e35 2c20 706c  5, width=0.5, pl
-0001e3c0: 6f74 5f66 6967 7572 653d 4661 6c73 652c  ot_figure=False,
-0001e3d0: 2064 6961 645f 6172 7261 793d 6469 6164   diad_array=diad
-0001e3e0: 5f61 7272 6179 290a 2020 2020 536b 6577  _array).    Skew
-0001e3f0: 3830 3d61 7373 6573 735f 6469 6164 315f  80=assess_diad1_
-0001e400: 736b 6577 6e65 7373 2863 6f6e 6669 6731  skewness(config1
-0001e410: 3d64 6961 6431 5f66 6974 5f63 6f6e 6669  =diad1_fit_confi
-0001e420: 6728 292c 2069 6e74 5f63 7574 5f6f 6666  g(), int_cut_off
-0001e430: 3d30 2e33 2c20 7061 7468 3d70 6174 682c  =0.3, path=path,
-0001e440: 2066 696c 656e 616d 653d 6669 6c65 6e61   filename=filena
-0001e450: 6d65 2c20 6669 6c65 7479 7065 3d66 696c  me, filetype=fil
-0001e460: 6574 7970 652c 0a20 2020 2073 6b65 776e  etype,.    skewn
-0001e470: 6573 733d 2761 6273 272c 2068 6569 6768  ess='abs', heigh
-0001e480: 743d 312c 2070 726f 6d69 6e65 6e63 653d  t=1, prominence=
-0001e490: 352c 2077 6964 7468 3d30 2e35 2c20 706c  5, width=0.5, pl
-0001e4a0: 6f74 5f66 6967 7572 653d 4661 6c73 652c  ot_figure=False,
-0001e4b0: 2064 6961 645f 6172 7261 793d 6469 6164   diad_array=diad
-0001e4c0: 5f61 7272 6179 290a 0a20 2020 2064 665f  _array)..    df_
-0001e4d0: 6f75 745b 2744 6961 6431 5f41 7379 6d35  out['Diad1_Asym5
-0001e4e0: 3027 5d3d 536b 6577 3530 5b27 536b 6577  0']=Skew50['Skew
-0001e4f0: 6e65 7373 5f64 6961 6431 275d 0a20 2020  ness_diad1'].   
-0001e500: 2064 665f 6f75 745b 2744 6961 6431 5f41   df_out['Diad1_A
-0001e510: 7379 6d37 3027 5d3d 536b 6577 3830 5b27  sym70']=Skew80['
-0001e520: 536b 6577 6e65 7373 5f64 6961 6431 275d  Skewness_diad1']
-0001e530: 0a20 2020 2064 665f 6f75 745b 2744 6961  .    df_out['Dia
-0001e540: 6431 5f59 7561 6e32 3031 375f 7379 6d5f  d1_Yuan2017_sym_
-0001e550: 6661 6374 6f72 275d 3d28 6466 5f6f 7574  factor']=(df_out
-0001e560: 5b27 4469 6164 315f 6677 686d 275d 292a  ['Diad1_fwhm'])*
-0001e570: 2864 665f 6f75 745b 2744 6961 6431 5f41  (df_out['Diad1_A
-0001e580: 7379 6d35 3027 5d2d 3129 0a20 2020 2064  sym50']-1).    d
-0001e590: 665f 6f75 745b 2744 6961 6431 5f52 656d  f_out['Diad1_Rem
-0001e5a0: 6967 6932 3032 315f 4253 4627 5d3d 6466  igi2021_BSF']=df
-0001e5b0: 5f6f 7574 5b27 4469 6164 315f 6677 686d  _out['Diad1_fwhm
-0001e5c0: 275d 2f64 665f 6f75 745b 2744 6961 6431  ']/df_out['Diad1
-0001e5d0: 5f43 6f6d 626f 6669 745f 4865 6967 6874  _Combofit_Height
-0001e5e0: 275d 0a0a 0a20 2020 2064 665f 6f75 745b  ']...    df_out[
-0001e5f0: 2744 6961 6431 5f50 4446 5f4d 6f64 656c  'Diad1_PDF_Model
-0001e600: 275d 3d6d 6f64 656c 0a0a 2020 2020 6966  ']=model..    if
-0001e610: 2020 636f 6e66 6967 312e 7265 7475 726e    config1.return
-0001e620: 5f6f 7468 6572 5f70 6172 616d 7320 6973  _other_params is
-0001e630: 2046 616c 7365 3a0a 2020 2020 2020 2020   False:.        
-0001e640: 7265 7475 726e 2064 665f 6f75 740a 2020  return df_out.  
-0001e650: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001e660: 7265 7475 726e 2064 665f 6f75 742c 2072  return df_out, r
-0001e670: 6573 756c 742c 2079 5f62 6573 745f 6669  esult, y_best_fi
-0001e680: 742c 2078 5f6c 696e 0a0a 0a64 6566 2063  t, x_lin...def c
-0001e690: 6f6d 6269 6e65 5f64 6961 645f 6f75 7470  ombine_diad_outp
-0001e6a0: 7574 7328 2a2c 2066 696c 656e 616d 653d  uts(*, filename=
-0001e6b0: 4e6f 6e65 2c20 7072 6566 6978 3d54 7275  None, prefix=Tru
-0001e6c0: 652c 0a44 6961 6431 5f66 6974 3d4e 6f6e  e,.Diad1_fit=Non
-0001e6d0: 652c 2044 6961 6432 5f66 6974 3d4e 6f6e  e, Diad2_fit=Non
-0001e6e0: 652c 2074 6f5f 6373 763d 4661 6c73 652c  e, to_csv=False,
-0001e6f0: 0a74 6f5f 636c 6970 626f 6172 643d 4661  .to_clipboard=Fa
-0001e700: 6c73 652c 2070 6174 683d 4e6f 6e65 293a  lse, path=None):
-0001e710: 0a20 2020 2022 2222 2054 6869 7320 6675  .    """ This fu
-0001e720: 6e63 7469 6f6e 2063 6f6d 6269 6e65 7320  nction combines 
-0001e730: 7468 6520 6461 7461 6672 616d 6573 2066  the dataframes f
-0001e740: 726f 6d20 6669 745f 6469 6164 5f32 5f77  rom fit_diad_2_w
-0001e750: 5f62 636b 2061 6e64 2066 6974 5f64 6961  _bck and fit_dia
-0001e760: 645f 315f 775f 6263 6b20 696e 746f 2061  d_1_w_bck into a
-0001e770: 0a20 2020 2073 696e 676c 6520 6461 7461  .    single data
-0001e780: 6672 616d 650a 0a20 2020 2050 6172 616d  frame..    Param
-0001e790: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-0001e7a0: 2d2d 2d2d 2d2d 2d2d 2d0a 0a20 2020 2066  ---------..    f
-0001e7b0: 696c 656e 616d 653a 2073 7472 0a20 2020  ilename: str.   
-0001e7c0: 2020 2020 2066 696c 656e 616d 6520 6461       filename da
-0001e7d0: 7461 2069 7320 666f 720a 0a20 2020 2070  ta is for..    p
-0001e7e0: 7265 6669 783a 2062 6f6f 6c0a 2020 2020  refix: bool.    
-0001e7f0: 2020 2020 6966 2054 7275 652c 2073 706c      if True, spl
-0001e800: 6974 7320 6669 6c65 6e61 6d65 206f 6e20  its filename on 
-0001e810: 2720 272c 2069 6620 4661 6c73 652c 206c  ' ', if False, l
-0001e820: 6561 7665 7320 6173 2069 730a 0a20 2020  eaves as is..   
-0001e830: 2044 6961 6431 5f66 6974 3a20 7064 2e44   Diad1_fit: pd.D
-0001e840: 6174 6146 7261 6d65 0a20 2020 2020 2020  ataFrame.       
-0001e850: 2070 642e 4461 7461 4672 616d 6520 6f66   pd.DataFrame of
-0001e860: 2066 6974 2066 726f 6d20 6669 745f 6469   fit from fit_di
-0001e870: 6164 5f31 5f77 5f62 636b 2066 756e 6374  ad_1_w_bck funct
-0001e880: 696f 6e0a 0a20 2020 2044 6961 6432 5f66  ion..    Diad2_f
-0001e890: 6974 3a20 7064 2e44 6174 6146 7261 6d65  it: pd.DataFrame
-0001e8a0: 0a20 2020 2020 2020 2070 642e 4461 7461  .        pd.Data
-0001e8b0: 4672 616d 6520 6f66 2066 6974 2066 726f  Frame of fit fro
-0001e8c0: 6d20 6669 745f 6469 6164 5f32 5f77 5f62  m fit_diad_2_w_b
-0001e8d0: 636b 2066 756e 6374 696f 6e0a 0a20 2020  ck function..   
-0001e8e0: 2074 6f5f 636c 6970 626f 6172 643a 2062   to_clipboard: b
-0001e8f0: 6f6f 6c0a 2020 2020 2020 2020 4966 2054  ool.        If T
-0001e900: 7275 652c 2063 6f70 6965 7320 6d65 7267  rue, copies merg
-0001e910: 6564 2064 6174 6166 7261 6d65 2074 6f20  ed dataframe to 
-0001e920: 636c 6970 626f 6172 640a 0a20 2020 2074  clipboard..    t
-0001e930: 6f5f 6373 763a 2062 6f6f 6c0a 2020 2020  o_csv: bool.    
-0001e940: 2020 2020 6966 2054 7275 652c 2073 6176      if True, sav
-0001e950: 6573 2066 6974 2074 6f20 4373 762c 2062  es fit to Csv, b
-0001e960: 7920 6d61 6b69 6e67 2061 2073 7562 666f  y making a subfo
-0001e970: 6c64 6572 2027 4469 6164 5f46 6974 7327  lder 'Diad_Fits'
-0001e980: 2069 6e73 6964 6520 7468 6520 666f 6c64   inside the fold
-0001e990: 6572 2027 7061 7468 270a 0a0a 0a0a 2020  er 'path'.....  
-0001e9a0: 2020 2222 220a 0a20 2020 2069 6620 7072    """..    if pr
-0001e9b0: 6566 6978 2069 7320 5472 7565 3a0a 2020  efix is True:.  
-0001e9c0: 2020 2020 2020 6669 6c65 6e61 6d65 203d        filename =
-0001e9d0: 2066 696c 656e 616d 652e 7370 6c69 7428   filename.split(
-0001e9e0: 2720 272c 2031 295b 315d 0a0a 2020 2020  ' ', 1)[1]..    
-0001e9f0: 6966 2044 6961 6431 5f66 6974 2069 7320  if Diad1_fit is 
-0001ea00: 6e6f 7420 4e6f 6e65 2061 6e64 2044 6961  not None and Dia
-0001ea10: 6432 5f66 6974 2069 7320 6e6f 7420 4e6f  d2_fit is not No
-0001ea20: 6e65 3a0a 0a20 2020 2020 2020 2063 6f6d  ne:..        com
-0001ea30: 626f 3d70 642e 636f 6e63 6174 285b 4469  bo=pd.concat([Di
-0001ea40: 6164 315f 6669 742c 2044 6961 6432 5f66  ad1_fit, Diad2_f
-0001ea50: 6974 5d2c 2061 7869 733d 3129 0a20 2020  it], axis=1).   
-0001ea60: 2020 2020 2023 2046 696c 6c20 616e 7920       # Fill any 
-0001ea70: 636f 6c75 6d6e 7320 7768 6963 6820 646f  columns which do
-0001ea80: 6e74 2720 6578 6973 7420 736f 2063 616e  nt' exist so can
-0001ea90: 2072 652d 6f72 6465 7220 7468 6520 7361   re-order the sa
-0001eaa0: 6d65 2065 7665 7279 2074 696d 650a 2020  me every time.  
-0001eab0: 2020 2020 2020 6966 2027 4842 315f 4365        if 'HB1_Ce
-0001eac0: 6e74 2720 6e6f 7420 696e 2063 6f6d 626f  nt' not in combo
-0001ead0: 2e63 6f6c 756d 6e73 3a0a 2020 2020 2020  .columns:.      
-0001eae0: 2020 2020 2020 636f 6d62 6f5b 2748 4231        combo['HB1
-0001eaf0: 5f43 656e 7427 5d3d 6e70 2e6e 616e 0a20  _Cent']=np.nan. 
-0001eb00: 2020 2020 2020 2020 2020 2063 6f6d 626f             combo
-0001eb10: 5b27 4842 315f 4172 6561 275d 3d6e 702e  ['HB1_Area']=np.
-0001eb20: 6e61 6e0a 2020 2020 2020 2020 2020 2020  nan.            
-0001eb30: 636f 6d62 6f5b 2748 4231 5f53 6967 6d61  combo['HB1_Sigma
-0001eb40: 275d 3d6e 702e 6e61 6e0a 2020 2020 2020  ']=np.nan.      
-0001eb50: 2020 6966 2027 4842 325f 4365 6e74 2720    if 'HB2_Cent' 
-0001eb60: 6e6f 7420 696e 2063 6f6d 626f 2e63 6f6c  not in combo.col
-0001eb70: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
-0001eb80: 2020 636f 6d62 6f5b 2748 4232 5f43 656e    combo['HB2_Cen
-0001eb90: 7427 5d3d 6e70 2e6e 616e 0a20 2020 2020  t']=np.nan.     
-0001eba0: 2020 2020 2020 2063 6f6d 626f 5b27 4842         combo['HB
-0001ebb0: 325f 4172 6561 275d 3d6e 702e 6e61 6e0a  2_Area']=np.nan.
-0001ebc0: 2020 2020 2020 2020 2020 2020 636f 6d62              comb
-0001ebd0: 6f5b 2748 4232 5f53 6967 6d61 275d 3d6e  o['HB2_Sigma']=n
-0001ebe0: 702e 6e61 6e0a 2020 2020 2020 2020 6966  p.nan.        if
-0001ebf0: 2027 4331 335f 4365 6e74 2720 6e6f 7420   'C13_Cent' not 
-0001ec00: 696e 2063 6f6d 626f 2e63 6f6c 756d 6e73  in combo.columns
-0001ec10: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-0001ec20: 6d62 6f5b 2743 3133 5f43 656e 7427 5d3d  mbo['C13_Cent']=
-0001ec30: 6e70 2e6e 616e 0a20 2020 2020 2020 2020  np.nan.         
-0001ec40: 2020 2063 6f6d 626f 5b27 4331 335f 4172     combo['C13_Ar
-0001ec50: 6561 275d 3d6e 702e 6e61 6e0a 2020 2020  ea']=np.nan.    
-0001ec60: 2020 2020 2020 2020 636f 6d62 6f5b 2743          combo['C
-0001ec70: 3133 5f53 6967 6d61 275d 3d6e 702e 6e61  13_Sigma']=np.na
-0001ec80: 6e0a 2020 2020 2020 2020 6966 2027 4469  n.        if 'Di
-0001ec90: 6164 315f 4761 7573 735f 4365 6e74 2720  ad1_Gauss_Cent' 
-0001eca0: 6e6f 7420 696e 2063 6f6d 626f 2e63 6f6c  not in combo.col
-0001ecb0: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
-0001ecc0: 2020 636f 6d62 6f5b 2744 6961 6431 5f47    combo['Diad1_G
-0001ecd0: 6175 7373 5f43 656e 7427 5d3d 6e70 2e6e  auss_Cent']=np.n
-0001ece0: 616e 0a20 2020 2020 2020 2020 2020 2063  an.            c
-0001ecf0: 6f6d 626f 5b27 4469 6164 315f 4761 7573  ombo['Diad1_Gaus
-0001ed00: 735f 4172 6561 275d 3d6e 702e 6e61 6e0a  s_Area']=np.nan.
-0001ed10: 2020 2020 2020 2020 2020 2020 636f 6d62              comb
-0001ed20: 6f5b 2744 6961 6431 5f47 6175 7373 5f53  o['Diad1_Gauss_S
-0001ed30: 6967 6d61 275d 3d6e 702e 6e61 6e0a 2020  igma']=np.nan.  
-0001ed40: 2020 2020 2020 6966 2027 4469 6164 325f        if 'Diad2_
-0001ed50: 4761 7573 735f 4365 6e74 2720 6e6f 7420  Gauss_Cent' not 
-0001ed60: 696e 2063 6f6d 626f 2e63 6f6c 756d 6e73  in combo.columns
-0001ed70: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-0001ed80: 6d62 6f5b 2744 6961 6432 5f47 6175 7373  mbo['Diad2_Gauss
-0001ed90: 5f43 656e 7427 5d3d 6e70 2e6e 616e 0a20  _Cent']=np.nan. 
-0001eda0: 2020 2020 2020 2020 2020 2063 6f6d 626f             combo
-0001edb0: 5b27 4469 6164 325f 4761 7573 735f 4172  ['Diad2_Gauss_Ar
-0001edc0: 6561 275d 3d6e 702e 6e61 6e0a 2020 2020  ea']=np.nan.    
-0001edd0: 2020 2020 2020 2020 636f 6d62 6f5b 2744          combo['D
-0001ede0: 6961 6432 5f47 6175 7373 5f53 6967 6d61  iad2_Gauss_Sigma
-0001edf0: 275d 3d6e 702e 6e61 6e0a 0a0a 2020 2020  ']=np.nan...    
-0001ee00: 2020 2020 636f 6d62 6f5b 2753 706c 6974      combo['Split
-0001ee10: 7469 6e67 275d 3d63 6f6d 626f 5b27 4469  ting']=combo['Di
-0001ee20: 6164 325f 566f 6967 745f 4365 6e74 275d  ad2_Voigt_Cent']
-0001ee30: 2d63 6f6d 626f 5b27 4469 6164 315f 566f  -combo['Diad1_Vo
-0001ee40: 6967 745f 4365 6e74 275d 0a20 2020 2020  igt_Cent'].     
-0001ee50: 2020 2023 636f 6d62 6f5b 2753 706c 6974     #combo['Split
-0001ee60: 5f65 7272 5f61 6273 275d 3d63 6f6d 626f  _err_abs']=combo
-0001ee70: 5b27 4469 6164 315f 6365 6e74 5f65 7272  ['Diad1_cent_err
-0001ee80: 275d 2b63 6f6d 626f 5b27 4469 6164 325f  ']+combo['Diad2_
-0001ee90: 6365 6e74 5f65 7272 275d 0a20 2020 2020  cent_err'].     
-0001eea0: 2020 2063 6f6d 626f 5b27 5370 6c69 745f     combo['Split_
-0001eeb0: cf83 275d 3d28 636f 6d62 6f5b 2744 6961  ..']=(combo['Dia
-0001eec0: 6431 5f63 656e 745f 6572 7227 5d2a 2a32  d1_cent_err']**2
-0001eed0: 2b63 6f6d 626f 5b27 4469 6164 325f 6365  +combo['Diad2_ce
-0001eee0: 6e74 5f65 7272 275d 2a2a 3229 2a2a 302e  nt_err']**2)**0.
-0001eef0: 350a 2020 2020 2020 2020 636f 6c73 5f74  5.        cols_t
-0001ef00: 6f5f 6d6f 7665 203d 205b 2753 706c 6974  o_move = ['Split
-0001ef10: 7469 6e67 272c 2027 5370 6c69 745f cf83  ting', 'Split_..
-0001ef20: 272c 2020 2744 6961 6431 5f43 6f6d 626f  ',  'Diad1_Combo
-0001ef30: 6669 745f 4365 6e74 272c 2027 4469 6164  fit_Cent', 'Diad
-0001ef40: 315f 6365 6e74 5f65 7272 272c 2027 4469  1_cent_err', 'Di
-0001ef50: 6164 315f 436f 6d62 6f66 6974 5f48 6569  ad1_Combofit_Hei
-0001ef60: 6768 7427 2c20 2744 6961 6431 5f56 6f69  ght', 'Diad1_Voi
-0001ef70: 6774 5f43 656e 7427 2c20 2744 6961 6431  gt_Cent', 'Diad1
-0001ef80: 5f56 6f69 6774 5f41 7265 6127 2c20 2744  _Voigt_Area', 'D
-0001ef90: 6961 6431 5f56 6f69 6774 5f53 6967 6d61  iad1_Voigt_Sigma
-0001efa0: 272c 2020 2744 6961 6431 5f52 6573 6964  ',  'Diad1_Resid
-0001efb0: 7561 6c27 2c20 2744 6961 6431 5f50 726f  ual', 'Diad1_Pro
-0001efc0: 705f 4c6f 7227 2c20 2744 6961 6431 5f66  p_Lor', 'Diad1_f
-0001efd0: 7768 6d27 2c20 2744 6961 6431 5f72 6566  whm', 'Diad1_ref
-0001efe0: 6974 272c 2744 6961 6432 5f43 6f6d 626f  it','Diad2_Combo
-0001eff0: 6669 745f 4365 6e74 272c 2027 4469 6164  fit_Cent', 'Diad
-0001f000: 325f 6365 6e74 5f65 7272 272c 2020 2744  2_cent_err',  'D
-0001f010: 6961 6432 5f43 6f6d 626f 6669 745f 4865  iad2_Combofit_He
-0001f020: 6967 6874 272c 2027 4469 6164 325f 566f  ight', 'Diad2_Vo
-0001f030: 6967 745f 4365 6e74 272c 2027 4469 6164  igt_Cent', 'Diad
-0001f040: 325f 566f 6967 745f 4172 6561 272c 2027  2_Voigt_Area', '
-0001f050: 4469 6164 325f 566f 6967 745f 5369 676d  Diad2_Voigt_Sigm
-0001f060: 6127 2c20 2744 6961 6432 5f56 6f69 6774  a', 'Diad2_Voigt
-0001f070: 5f47 616d 6d61 272c 2027 4469 6164 325f  _Gamma', 'Diad2_
-0001f080: 5265 7369 6475 616c 272c 2027 4469 6164  Residual', 'Diad
-0001f090: 325f 5072 6f70 5f4c 6f72 272c 2027 4469  2_Prop_Lor', 'Di
-0001f0a0: 6164 325f 6677 686d 272c 2027 4469 6164  ad2_fwhm', 'Diad
-0001f0b0: 325f 7265 6669 7427 2c0a 2020 2020 2020  2_refit',.      
-0001f0c0: 2020 2020 2020 2020 2020 2020 2020 2748                'H
-0001f0d0: 4231 5f43 656e 7427 2c20 2748 4231 5f41  B1_Cent', 'HB1_A
-0001f0e0: 7265 6127 2c20 2748 4231 5f53 6967 6d61  rea', 'HB1_Sigma
-0001f0f0: 272c 2027 4842 325f 4365 6e74 272c 2027  ', 'HB2_Cent', '
-0001f100: 4842 325f 4172 6561 272c 2027 4842 325f  HB2_Area', 'HB2_
-0001f110: 5369 676d 6127 2c20 2743 3133 5f43 656e  Sigma', 'C13_Cen
-0001f120: 7427 2c20 2743 3133 5f41 7265 6127 2c20  t', 'C13_Area', 
-0001f130: 2743 3133 5f53 6967 6d61 272c 0a20 2020  'C13_Sigma',.   
-0001f140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f150: 2027 4469 6164 325f 4761 7573 735f 4365   'Diad2_Gauss_Ce
-0001f160: 6e74 272c 2027 4469 6164 325f 4761 7573  nt', 'Diad2_Gaus
-0001f170: 735f 4172 6561 272c 2744 6961 6432 5f47  s_Area','Diad2_G
-0001f180: 6175 7373 5f53 6967 6d61 272c 2027 4469  auss_Sigma', 'Di
-0001f190: 6164 315f 4761 7573 735f 4365 6e74 272c  ad1_Gauss_Cent',
-0001f1a0: 2027 4469 6164 315f 4761 7573 735f 4172   'Diad1_Gauss_Ar
-0001f1b0: 6561 272c 2744 6961 6431 5f47 6175 7373  ea','Diad1_Gauss
-0001f1c0: 5f53 6967 6d61 272c 2027 4469 6164 315f  _Sigma', 'Diad1_
-0001f1d0: 4173 796d 3530 272c 2027 4469 6164 315f  Asym50', 'Diad1_
-0001f1e0: 4173 796d 3730 272c 2027 4469 6164 315f  Asym70', 'Diad1_
-0001f1f0: 5975 616e 3230 3137 5f73 796d 5f66 6163  Yuan2017_sym_fac
-0001f200: 746f 7227 2c0a 2744 6961 6431 5f52 656d  tor',.'Diad1_Rem
-0001f210: 6967 6932 3032 315f 4253 4627 2c27 4469  igi2021_BSF','Di
-0001f220: 6164 325f 4173 796d 3530 272c 2027 4469  ad2_Asym50', 'Di
-0001f230: 6164 325f 4173 796d 3730 272c 2027 4469  ad2_Asym70', 'Di
-0001f240: 6164 325f 5975 616e 3230 3137 5f73 796d  ad2_Yuan2017_sym
-0001f250: 5f66 6163 746f 7227 2c0a 2744 6961 6432  _factor',.'Diad2
-0001f260: 5f52 656d 6967 6932 3032 315f 4253 4627  _Remigi2021_BSF'
-0001f270: 2c20 2744 6961 6431 5f50 4446 5f4d 6f64  , 'Diad1_PDF_Mod
-0001f280: 656c 272c 2027 4469 6164 325f 5044 465f  el', 'Diad2_PDF_
-0001f290: 4d6f 6465 6c27 5d0a 0a0a 0a0a 2020 2020  Model'].....    
-0001f2a0: 2020 2020 636f 6d62 6f5f 6620 3d20 636f      combo_f = co
-0001f2b0: 6d62 6f5b 636f 6c73 5f74 6f5f 6d6f 7665  mbo[cols_to_move
-0001f2c0: 202b 205b 0a20 2020 2020 2020 2020 2020   + [.           
-0001f2d0: 2020 2020 2063 6f6c 2066 6f72 2063 6f6c       col for col
-0001f2e0: 2069 6e20 636f 6d62 6f2e 636f 6c75 6d6e   in combo.column
-0001f2f0: 7320 6966 2063 6f6c 206e 6f74 2069 6e20  s if col not in 
-0001f300: 636f 6c73 5f74 6f5f 6d6f 7665 5d5d 0a20  cols_to_move]]. 
-0001f310: 2020 2020 2020 2063 6f6d 626f 5f66 3d63         combo_f=c
-0001f320: 6f6d 626f 5f66 2e69 6c6f 635b 3a2c 2030  ombo_f.iloc[:, 0
-0001f330: 3a6c 656e 2863 6f6c 735f 746f 5f6d 6f76  :len(cols_to_mov
-0001f340: 6529 5d0a 2020 2020 2020 2020 6669 6c65  e)].        file
-0001f350: 3d66 696c 656e 616d 652e 7273 706c 6974  =filename.rsplit
-0001f360: 2827 2e74 7874 272c 2031 295b 305d 0a20  ('.txt', 1)[0]. 
-0001f370: 2020 2020 2020 2063 6f6d 626f 5f66 2e69         combo_f.i
-0001f380: 6e73 6572 7428 302c 2027 6669 6c65 6e61  nsert(0, 'filena
-0001f390: 6d65 272c 2066 696c 6529 0a0a 2020 2020  me', file)..    
-0001f3a0: 6966 2044 6961 6431 5f66 6974 2069 7320  if Diad1_fit is 
-0001f3b0: 4e6f 6e65 2061 6e64 2044 6961 6432 5f66  None and Diad2_f
-0001f3c0: 6974 2069 7320 4e6f 6e65 3a0a 2020 2020  it is None:.    
-0001f3d0: 2020 2020 6466 3d70 642e 4461 7461 4672      df=pd.DataFr
-0001f3e0: 616d 6528 6461 7461 3d7b 2766 696c 656e  ame(data={'filen
-0001f3f0: 616d 6527 3a20 6669 6c65 6e61 6d65 2c0a  ame': filename,.
-0001f400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f410: 2020 2020 2020 2020 2020 2020 2753 706c              'Spl
-0001f420: 6974 7469 6e67 273a 206e 702e 6e61 6e2c  itting': np.nan,
-0001f430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f450: 2027 4469 6164 315f 566f 6967 745f 4365   'Diad1_Voigt_Ce
-0001f460: 6e74 273a 6e70 2e6e 616e 2c0a 2020 2020  nt':np.nan,.    
-0001f470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f490: 2744 6961 6431 5f56 6f69 6774 5f41 7265  'Diad1_Voigt_Are
-0001f4a0: 6127 3a6e 702e 6e61 6e2c 0a20 2020 2020  a':np.nan,.     
-0001f4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f4c0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001f4d0: 5265 7369 6475 616c 5f44 6961 6431 273a  Residual_Diad1':
-0001f4e0: 206e 702e 6e61 6e2c 0a20 2020 2020 2020   np.nan,.       
-0001f4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f510: 2027 4469 6164 325f 566f 6967 745f 4365   'Diad2_Voigt_Ce
-0001f520: 6e74 273a 6e70 2e6e 616e 2c0a 2020 2020  nt':np.nan,.    
-0001f530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f550: 2020 2020 2744 6961 6432 5f56 6f69 6774      'Diad2_Voigt
-0001f560: 5f41 7265 6127 3a6e 702e 6e61 6e2c 0a20  _Area':np.nan,. 
-0001f570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f590: 2020 2020 2020 2027 5265 7369 6475 616c         'Residual
-0001f5a0: 5f44 6961 6432 273a 206e 702e 6e61 6e2c  _Diad2': np.nan,
-0001f5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5d0: 2020 2020 2020 2020 2020 2020 2027 4842               'HB
-0001f5e0: 315f 4365 6e74 273a 6e70 2e6e 616e 2c0a  1_Cent':np.nan,.
-0001f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbb0: 315d 2b33 300a 2020 2020 2020 2020 2320  1]+30.        # 
+0001cbc0: 4164 6469 6e67 2070 6174 6368 6573 0a0a  Adding patches..
+0001cbd0: 0a20 2020 2020 2020 2072 6563 745f 6469  .        rect_di
+0001cbe0: 6164 315f 6231 3d70 6174 6368 6573 2e52  ad1_b1=patches.R
+0001cbf0: 6563 7461 6e67 6c65 2828 636f 6e66 6967  ectangle((config
+0001cc00: 312e 6c6f 7765 725f 6263 6b5f 6469 6164  1.lower_bck_diad
+0001cc10: 315b 305d 2c20 6178 315f 796d 696e 292c  1[0], ax1_ymin),
+0001cc20: 636f 6e66 6967 312e 6c6f 7765 725f 6263  config1.lower_bc
+0001cc30: 6b5f 6469 6164 315b 315d 2d63 6f6e 6669  k_diad1[1]-confi
+0001cc40: 6731 2e6c 6f77 6572 5f62 636b 5f64 6961  g1.lower_bck_dia
+0001cc50: 6431 5b30 5d2c 6178 315f 796d 6178 2d61  d1[0],ax1_ymax-a
+0001cc60: 7831 5f79 6d69 6e2c 0a20 2020 2020 2020  x1_ymin,.       
+0001cc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc80: 2020 2020 2020 2020 206c 696e 6577 6964           linewid
+0001cc90: 7468 3d31 2c65 6467 6563 6f6c 6f72 3d27  th=1,edgecolor='
+0001cca0: 6e6f 6e65 272c 6661 6365 636f 6c6f 723d  none',facecolor=
+0001ccb0: 2763 7961 6e27 2c20 6c61 6265 6c3d 2773  'cyan', label='s
+0001ccc0: 656c 2e20 6263 6b2e 2072 6567 696f 6e27  el. bck. region'
+0001ccd0: 2c20 616c 7068 613d 302e 332c 207a 6f72  , alpha=0.3, zor
+0001cce0: 6465 723d 3029 0a20 2020 2020 2020 2061  der=0).        a
+0001ccf0: 7865 735b 2758 275d 2e61 6464 5f70 6174  xes['X'].add_pat
+0001cd00: 6368 2872 6563 745f 6469 6164 315f 6231  ch(rect_diad1_b1
+0001cd10: 290a 2020 2020 2020 2020 7265 6374 5f64  ).        rect_d
+0001cd20: 6961 6431 5f62 323d 7061 7463 6865 732e  iad1_b2=patches.
+0001cd30: 5265 6374 616e 676c 6528 2863 6f6e 6669  Rectangle((confi
+0001cd40: 6731 2e75 7070 6572 5f62 636b 5f64 6961  g1.upper_bck_dia
+0001cd50: 6431 5b30 5d2c 2061 7831 5f79 6d69 6e29  d1[0], ax1_ymin)
+0001cd60: 2c63 6f6e 6669 6731 2e75 7070 6572 5f62  ,config1.upper_b
+0001cd70: 636b 5f64 6961 6431 5b31 5d2d 636f 6e66  ck_diad1[1]-conf
+0001cd80: 6967 312e 7570 7065 725f 6263 6b5f 6469  ig1.upper_bck_di
+0001cd90: 6164 315b 305d 2c61 7831 5f79 6d61 782d  ad1[0],ax1_ymax-
+0001cda0: 6178 315f 796d 696e 2c0a 2020 2020 2020  ax1_ymin,.      
+0001cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cdc0: 2020 2020 2020 2020 2020 6c69 6e65 7769            linewi
+0001cdd0: 6474 683d 312c 6564 6765 636f 6c6f 723d  dth=1,edgecolor=
+0001cde0: 276e 6f6e 6527 2c66 6163 6563 6f6c 6f72  'none',facecolor
+0001cdf0: 3d27 6379 616e 272c 2061 6c70 6861 3d30  ='cyan', alpha=0
+0001ce00: 2e33 2c20 7a6f 7264 6572 3d30 290a 2020  .3, zorder=0).  
+0001ce10: 2020 2020 2020 6178 6573 5b27 5827 5d2e        axes['X'].
+0001ce20: 6164 645f 7061 7463 6828 7265 6374 5f64  add_patch(rect_d
+0001ce30: 6961 6431 5f62 3229 0a20 2020 2020 2020  iad1_b2).       
+0001ce40: 2061 7865 735b 2758 275d 2e73 6574 5f78   axes['X'].set_x
+0001ce50: 6c69 6d28 5b61 7831 5f78 6d69 6e2c 2061  lim([ax1_xmin, a
+0001ce60: 7831 5f78 6d61 785d 290a 2020 2020 2020  x1_xmax]).      
+0001ce70: 2020 6178 6573 5b27 5827 5d2e 7365 745f    axes['X'].set_
+0001ce80: 796c 696d 285b 6178 315f 796d 696e 2c20  ylim([ax1_ymin, 
+0001ce90: 6178 315f 796d 6178 5d29 0a0a 2020 2020  ax1_ymax])..    
+0001cea0: 2020 2020 6178 6573 5b27 5827 5d2e 7365      axes['X'].se
+0001ceb0: 745f 796c 6162 656c 2827 496e 7465 6e73  t_ylabel('Intens
+0001cec0: 6974 7927 290a 2020 2020 2020 2020 6178  ity').        ax
+0001ced0: 6573 5b27 5927 5d2e 7365 745f 796c 6162  es['Y'].set_ylab
+0001cee0: 656c 2827 496e 7465 6e73 6974 7927 290a  el('Intensity').
+0001cef0: 2020 2020 2020 2020 6178 6573 5b27 5927          axes['Y'
+0001cf00: 5d2e 7365 745f 786c 6162 656c 2827 5761  ].set_xlabel('Wa
+0001cf10: 7665 6e75 6d62 6572 2729 0a20 2020 2020  venumber').     
+0001cf20: 2020 2061 7865 735b 2758 275d 2e6c 6567     axes['X'].leg
+0001cf30: 656e 6428 290a 0a0a 0a20 2020 2020 2020  end()....       
+0001cf40: 2061 7865 735b 2759 275d 2e73 6574 5f74   axes['Y'].set_t
+0001cf50: 6974 6c65 2827 6229 2042 6163 6b67 726f  itle('b) Backgro
+0001cf60: 756e 6420 7375 6274 7261 6374 6564 2073  und subtracted s
+0001cf70: 7065 6374 7261 2729 0a20 2020 2020 2020  pectra').       
+0001cf80: 2061 7865 735b 2759 275d 2e70 6c6f 7428   axes['Y'].plot(
+0001cf90: 785f 6469 6164 312c 2079 5f63 6f72 725f  x_diad1, y_corr_
+0001cfa0: 6469 6164 312c 2027 2d72 2729 0a20 2020  diad1, '-r').   
+0001cfb0: 2020 2020 2068 6569 6768 745f 703d 6e70       height_p=np
+0001cfc0: 2e6d 6178 2844 6961 645f 7368 6f72 745f  .max(Diad_short_
+0001cfd0: 6469 6164 315b 3a2c 2031 5d29 2d6e 702e  diad1[:, 1])-np.
+0001cfe0: 6d69 6e28 4469 6164 5f73 686f 7274 5f64  min(Diad_short_d
+0001cff0: 6961 6431 5b3a 2c20 315d 290a 2020 2020  iad1[:, 1]).    
+0001d000: 2020 2020 6178 6573 5b27 5927 5d2e 7365      axes['Y'].se
+0001d010: 745f 796c 696d 285b 6e70 2e6d 696e 2879  t_ylim([np.min(y
+0001d020: 5f63 6f72 725f 6469 6164 3129 2c20 312e  _corr_diad1), 1.
+0001d030: 322a 6865 6967 6874 5f70 205d 290a 2020  2*height_p ]).  
+0001d040: 2020 2020 2020 6178 6573 5b27 5827 5d2e        axes['X'].
+0001d050: 7365 745f 786c 6162 656c 2827 5761 7665  set_xlabel('Wave
+0001d060: 6e75 6d62 6572 2729 0a0a 0a0a 2020 2020  number')....    
+0001d070: 2020 2020 6178 6573 5b27 4127 5d2e 706c      axes['A'].pl
+0001d080: 6f74 2878 6461 742c 2079 6461 742c 2020  ot(xdat, ydat,  
+0001d090: 272e 6b27 2c20 6c61 6265 6c3d 2762 636b  '.k', label='bck
+0001d0a0: 2e20 7375 622e 2064 6174 6127 290a 2020  . sub. data').  
+0001d0b0: 2020 2020 2020 6178 6573 5b27 4127 5d2e        axes['A'].
+0001d0c0: 706c 6f74 2820 785f 6c69 6e20 2c79 5f62  plot( x_lin ,y_b
+0001d0d0: 6573 745f 6669 742c 2027 2d67 272c 206c  est_fit, '-g', l
+0001d0e0: 696e 6577 6964 7468 3d31 2c20 6c61 6265  inewidth=1, labe
+0001d0f0: 6c3d 2762 6573 7420 6669 7427 290a 2020  l='best fit').  
+0001d100: 2020 2020 2020 6178 6573 5b27 4127 5d2e        axes['A'].
+0001d110: 6c65 6765 6e64 2829 0a20 2020 2020 2020  legend().       
+0001d120: 2061 7865 735b 2741 275d 2e73 6574 5f79   axes['A'].set_y
+0001d130: 6c61 6265 6c28 2749 6e74 656e 7369 7479  label('Intensity
+0001d140: 2729 0a20 2020 2020 2020 2061 7865 735b  ').        axes[
+0001d150: 2741 275d 2e73 6574 5f78 6c61 6265 6c28  'A'].set_xlabel(
+0001d160: 2757 6176 656e 756d 6265 7227 290a 2020  'Wavenumber').  
+0001d170: 2020 2020 2020 6178 6573 5b27 4127 5d2e        axes['A'].
+0001d180: 7365 745f 786c 696d 2861 7831 5f78 6c69  set_xlim(ax1_xli
+0001d190: 6d29 0a20 2020 2020 2020 2061 7865 735b  m).        axes[
+0001d1a0: 2741 275d 2e73 6574 5f74 6974 6c65 2827  'A'].set_title('
+0001d1b0: 6329 204f 7665 7261 6c6c 2042 6573 7420  c) Overall Best 
+0001d1c0: 4669 7427 290a 0a20 2020 2023 2069 6e64  Fit')..    # ind
+0001d1d0: 6976 6964 7561 6c20 6669 7473 0a20 2020  ividual fits.   
+0001d1e0: 2020 2020 2061 7865 735b 2742 275d 2e70       axes['B'].p
+0001d1f0: 6c6f 7428 7864 6174 2c20 7964 6174 2c20  lot(xdat, ydat, 
+0001d200: 272e 6b27 290a 0a20 2020 2020 2020 2023  '.k')..        #
+0001d210: 2054 6869 7320 6973 2066 6f72 2069 6620   This is for if 
+0001d220: 7468 6572 6520 6973 206d 6f72 6520 7468  there is more th
+0001d230: 616e 2031 2070 6561 6b2c 2074 6869 7320  an 1 peak, this 
+0001d240: 6973 2077 6865 6e20 7765 2077 616e 7420  is when we want 
+0001d250: 746f 2070 6c6f 7420 7468 6520 6265 7374  to plot the best
+0001d260: 2066 6974 0a20 2020 2020 2020 2069 6620   fit.        if 
+0001d270: 6669 745f 7065 616b 733e 313a 0a0a 2020  fit_peaks>1:..  
+0001d280: 2020 2020 2020 2020 2020 6178 6573 5b27            axes['
+0001d290: 4227 5d2e 706c 6f74 2878 5f6c 696e 2c20  B'].plot(x_lin, 
+0001d2a0: 636f 6d70 6f6e 656e 7473 2e67 6574 2827  components.get('
+0001d2b0: 6c7a 325f 2729 2c20 272d 7227 2c20 6c69  lz2_'), '-r', li
+0001d2c0: 6e65 7769 6474 683d 322c 206c 6162 656c  newidth=2, label
+0001d2d0: 3d27 4842 3127 290a 0a20 2020 2020 2020  ='HB1')..       
+0001d2e0: 2061 7865 735b 2742 275d 2e70 6c6f 7428   axes['B'].plot(
+0001d2f0: 785f 6c69 6e2c 2063 6f6d 706f 6e65 6e74  x_lin, component
+0001d300: 732e 6765 7428 276c 7a31 5f27 292c 2027  s.get('lz1_'), '
+0001d310: 2d62 272c 206c 696e 6577 6964 7468 3d32  -b', linewidth=2
+0001d320: 2c20 6c61 6265 6c3d 2744 6961 6431 2729  , label='Diad1')
+0001d330: 0a20 2020 2020 2020 2069 6620 636f 6e66  .        if conf
+0001d340: 6967 312e 6669 745f 6761 7573 7320 6973  ig1.fit_gauss is
+0001d350: 206e 6f74 2046 616c 7365 3a0a 2020 2020   not False:.    
+0001d360: 2020 2020 2020 2020 6178 6573 5b27 4227          axes['B'
+0001d370: 5d2e 706c 6f74 2878 5f6c 696e 2c20 636f  ].plot(x_lin, co
+0001d380: 6d70 6f6e 656e 7473 2e67 6574 2827 626b  mponents.get('bk
+0001d390: 675f 2729 2c20 272d 6d27 2c20 6c61 6265  g_'), '-m', labe
+0001d3a0: 6c3d 2747 6175 7373 6961 6e20 6263 6b27  l='Gaussian bck'
+0001d3b0: 2c20 6c69 6e65 7769 6474 683d 3229 0a20  , linewidth=2). 
+0001d3c0: 2020 2020 2020 2023 6178 322e 706c 6f74         #ax2.plot
+0001d3d0: 2878 6461 742c 2072 6573 756c 742e 6265  (xdat, result.be
+0001d3e0: 7374 5f66 6974 2c20 272d 6727 2c20 6c61  st_fit, '-g', la
+0001d3f0: 6265 6c3d 2762 6573 7420 6669 7427 290a  bel='best fit').
+0001d400: 2020 2020 2020 2020 6178 6573 5b27 4227          axes['B'
+0001d410: 5d2e 6c65 6765 6e64 2829 0a0a 2020 2020  ].legend()..    
+0001d420: 2020 2020 6669 7473 7061 6e3d 6d61 7828      fitspan=max(
+0001d430: 795f 6265 7374 5f66 6974 292d 6d69 6e28  y_best_fit)-min(
+0001d440: 795f 6265 7374 5f66 6974 290a 2020 2020  y_best_fit).    
+0001d450: 2020 2020 6178 6573 5b27 4227 5d2e 7365      axes['B'].se
+0001d460: 745f 796c 696d 285b 6d69 6e28 795f 6265  t_ylim([min(y_be
+0001d470: 7374 5f66 6974 292d 6669 7473 7061 6e2f  st_fit)-fitspan/
+0001d480: 352c 206d 6178 2879 5f62 6573 745f 6669  5, max(y_best_fi
+0001d490: 7429 2b66 6974 7370 616e 2f35 5d29 0a0a  t)+fitspan/5])..
+0001d4a0: 2020 2020 2020 2020 6178 6573 5b27 4227          axes['B'
+0001d4b0: 5d2e 7365 745f 796c 6162 656c 2827 496e  ].set_ylabel('In
+0001d4c0: 7465 6e73 6974 7927 290a 2020 2020 2020  tensity').      
+0001d4d0: 2020 6178 6573 5b27 4227 5d2e 7365 745f    axes['B'].set_
+0001d4e0: 786c 6162 656c 2827 5761 7665 6e75 6d62  xlabel('Wavenumb
+0001d4f0: 6572 2729 0a0a 0a20 2020 2020 2020 2061  er')...        a
+0001d500: 7865 735b 2742 275d 2e73 6574 5f78 6c69  xes['B'].set_xli
+0001d510: 6d28 6178 325f 786c 696d 290a 0a20 2020  m(ax2_xlim)..   
+0001d520: 2020 2020 2023 2044 6173 6865 6420 6c69       # Dashed li
+0001d530: 6e65 7320 736f 206d 6174 6368 6573 2070  nes so matches p
+0001d540: 6172 7420 440a 2020 2020 2020 2020 6178  art D.        ax
+0001d550: 6573 5b27 4227 5d2e 706c 6f74 285b 6466  es['B'].plot([df
+0001d560: 5f6f 7574 5b27 4469 6164 315f 566f 6967  _out['Diad1_Voig
+0001d570: 745f 4365 6e74 275d 2c20 6466 5f6f 7574  t_Cent'], df_out
+0001d580: 5b27 4469 6164 315f 566f 6967 745f 4365  ['Diad1_Voigt_Ce
+0001d590: 6e74 275d 5d2c 205b 6e70 2e6d 696e 2879  nt']], [np.min(y
+0001d5a0: 6461 7429 2c20 6e70 2e6d 6178 2879 6461  dat), np.max(yda
+0001d5b0: 7429 5d2c 2027 3a62 2729 0a0a 2020 2020  t)], ':b')..    
+0001d5c0: 2020 2020 6966 2066 6974 5f70 6561 6b73      if fit_peaks
+0001d5d0: 3e32 3a0a 2020 2020 2020 2020 2020 2020  >2:.            
+0001d5e0: 6178 6573 5b27 4227 5d2e 706c 6f74 285b  axes['B'].plot([
+0001d5f0: 6466 5f6f 7574 5b27 4842 315f 4365 6e74  df_out['HB1_Cent
+0001d600: 275d 2c20 6466 5f6f 7574 5b27 4842 315f  '], df_out['HB1_
+0001d610: 4365 6e74 275d 5d2c 205b 6e70 2e6d 696e  Cent']], [np.min
+0001d620: 2879 6461 7429 2c20 6e70 2e6d 6178 2879  (ydat), np.max(y
+0001d630: 6461 7429 5d2c 2027 3a72 2729 0a0a 2020  dat)], ':r')..  
+0001d640: 2020 2020 2020 6178 6573 5b27 4227 5d2e        axes['B'].
+0001d650: 7365 745f 7469 746c 6528 2763 2920 4669  set_title('c) Fi
+0001d660: 7420 436f 6d70 6f6e 656e 7473 2729 0a0a  t Components')..
+0001d670: 2020 2020 2020 2020 2320 4261 636b 6772          # Backgr
+0001d680: 6f75 6e64 2066 6974 0a0a 2020 2020 2020  ound fit..      
+0001d690: 2020 2320 4669 7273 742c 2073 6574 2075    # First, set u
+0001d6a0: 7020 7820 616e 6420 7920 6c69 6d69 7473  p x and y limits
+0001d6b0: 206f 6e20 6178 6973 0a0a 2020 2020 2020   on axis..      
+0001d6c0: 2020 6966 2063 6f6e 6669 6731 2e78 5f72    if config1.x_r
+0001d6d0: 616e 6765 5f62 6173 656c 696e 6520 6973  ange_baseline is
+0001d6e0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0001d6f0: 2020 2020 2020 2061 7863 5f78 6d69 6e3d         axc_xmin=
+0001d700: 6466 5f6f 7574 5b27 4469 6164 315f 566f  df_out['Diad1_Vo
+0001d710: 6967 745f 4365 6e74 275d 5b30 5d2d 636f  igt_Cent'][0]-co
+0001d720: 6e66 6967 312e 785f 7261 6e67 655f 6261  nfig1.x_range_ba
+0001d730: 7365 6c69 6e65 0a20 2020 2020 2020 2020  seline.         
+0001d740: 2020 2061 7863 5f78 6d61 783d 6466 5f6f     axc_xmax=df_o
+0001d750: 7574 5b27 4469 6164 315f 566f 6967 745f  ut['Diad1_Voigt_
+0001d760: 4365 6e74 275d 5b30 5d2b 636f 6e66 6967  Cent'][0]+config
+0001d770: 312e 785f 7261 6e67 655f 6261 7365 6c69  1.x_range_baseli
+0001d780: 6e65 0a20 2020 2020 2020 2065 6c73 653a  ne.        else:
+0001d790: 0a20 2020 2020 2020 2020 2020 2061 7863  .            axc
+0001d7a0: 5f78 6d69 6e3d 636f 6e66 6967 312e 6c6f  _xmin=config1.lo
+0001d7b0: 7765 725f 6263 6b5f 6469 6164 315b 305d  wer_bck_diad1[0]
+0001d7c0: 0a20 2020 2020 2020 2020 2020 2061 7863  .            axc
+0001d7d0: 5f78 6d61 783d 636f 6e66 6967 312e 7570  _xmax=config1.up
+0001d7e0: 7065 725f 6263 6b5f 6469 6164 315b 315d  per_bck_diad1[1]
+0001d7f0: 0a0a 2020 2020 2020 2020 6178 635f 796d  ..        axc_ym
+0001d800: 696e 3d6e 702e 6d69 6e28 4261 7365 6c69  in=np.min(Baseli
+0001d810: 6e65 5f64 6961 6431 5b3a 2c20 315d 292d  ne_diad1[:, 1])-
+0001d820: 636f 6e66 6967 312e 795f 7261 6e67 655f  config1.y_range_
+0001d830: 6261 7365 6c69 6e65 0a20 2020 2020 2020  baseline.       
+0001d840: 2061 7863 5f79 6d61 783d 6e70 2e6d 6178   axc_ymax=np.max
+0001d850: 2842 6173 656c 696e 655f 6469 6164 315b  (Baseline_diad1[
+0001d860: 3a2c 2031 5d29 2b63 6f6e 6669 6731 2e79  :, 1])+config1.y
+0001d870: 5f72 616e 6765 5f62 6173 656c 696e 650a  _range_baseline.
+0001d880: 0a0a 0a0a 2020 2020 2020 2020 6178 6573  ....        axes
+0001d890: 5b27 4327 5d2e 7365 745f 7469 746c 6528  ['C'].set_title(
+0001d8a0: 2764 2920 5065 616b 7320 6f76 6572 6c61  'd) Peaks overla
+0001d8b0: 696e 206f 6e20 6461 7461 2062 6566 6f72  in on data befor
+0001d8c0: 6520 7375 6274 7261 6374 696f 6e27 290a  e subtraction').
+0001d8d0: 2020 2020 2020 2020 6178 6573 5b27 4327          axes['C'
+0001d8e0: 5d2e 706c 6f74 2844 6961 645f 7368 6f72  ].plot(Diad_shor
+0001d8f0: 745f 6469 6164 315b 3a2c 2030 5d2c 2044  t_diad1[:, 0], D
+0001d900: 6961 645f 7368 6f72 745f 6469 6164 315b  iad_short_diad1[
+0001d910: 3a2c 2031 5d2c 2027 2e72 272c 206c 6162  :, 1], '.r', lab
+0001d920: 656c 3d27 4461 7461 2729 0a20 2020 2020  el='Data').     
+0001d930: 2020 2061 7865 735b 2743 275d 2e70 6c6f     axes['C'].plo
+0001d940: 7428 4261 7365 6c69 6e65 5f64 6961 6431  t(Baseline_diad1
+0001d950: 5b3a 2c20 305d 2c20 4261 7365 6c69 6e65  [:, 0], Baseline
+0001d960: 5f64 6961 6431 5b3a 2c20 315d 2c20 272e  _diad1[:, 1], '.
+0001d970: 6227 2c20 6c61 6265 6c3d 2762 636b 2729  b', label='bck')
+0001d980: 0a20 2020 2020 2020 2061 7865 735b 2743  .        axes['C
+0001d990: 275d 2e70 6c6f 7428 4469 6164 5f73 686f  '].plot(Diad_sho
+0001d9a0: 7274 5f64 6961 6431 5b3a 2c20 305d 2c20  rt_diad1[:, 0], 
+0001d9b0: 5079 5f62 6173 655f 6469 6164 312c 2027  Py_base_diad1, '
+0001d9c0: 2d6b 272c 206c 6162 656c 3d27 506f 6c79  -k', label='Poly
+0001d9d0: 2062 636b 2066 6974 2729 0a0a 0a20 2020   bck fit')...   
+0001d9e0: 2020 2020 2061 7865 735b 2743 275d 2e73       axes['C'].s
+0001d9f0: 6574 5f79 6c61 6265 6c28 2749 6e74 656e  et_ylabel('Inten
+0001da00: 7369 7479 2729 0a20 2020 2020 2020 2061  sity').        a
+0001da10: 7865 735b 2743 275d 2e73 6574 5f78 6c61  xes['C'].set_xla
+0001da20: 6265 6c28 2757 6176 656e 756d 6265 7227  bel('Wavenumber'
+0001da30: 290a 0a0a 2020 2020 2020 2020 6966 2063  )...        if c
+0001da40: 6f6e 6669 6731 2e66 6974 5f67 6175 7373  onfig1.fit_gauss
+0001da50: 2069 7320 6e6f 7420 4661 6c73 653a 0a0a   is not False:..
+0001da60: 2020 2020 2020 2020 2020 2020 6178 6573              axes
+0001da70: 5b27 4327 5d2e 706c 6f74 2878 5f6c 696e  ['C'].plot(x_lin
+0001da80: 2c20 636f 6d70 6f6e 656e 7473 2e67 6574  , components.get
+0001da90: 2827 626b 675f 2729 2b79 6261 7365 5f78  ('bkg_')+ybase_x
+0001daa0: 6c69 6e2c 2027 2d6d 272c 206c 6162 656c  lin, '-m', label
+0001dab0: 3d27 4761 7573 7369 616e 2062 636b 272c  ='Gaussian bck',
+0001dac0: 206c 696e 6577 6964 7468 3d32 290a 0a20   linewidth=2).. 
+0001dad0: 2020 2020 2020 2061 7865 735b 2743 275d         axes['C']
+0001dae0: 2e70 6c6f 7428 2078 5f6c 696e 202c 795f  .plot( x_lin ,y_
+0001daf0: 6265 7374 5f66 6974 2b79 6261 7365 5f78  best_fit+ybase_x
+0001db00: 6c69 6e2c 2027 2d67 272c 206c 696e 6577  lin, '-g', linew
+0001db10: 6964 7468 3d32 2c20 6c61 6265 6c3d 2742  idth=2, label='B
+0001db20: 6573 7420 4669 7427 290a 2020 2020 2020  est Fit').      
+0001db30: 2020 6178 6573 5b27 4327 5d2e 706c 6f74    axes['C'].plot
+0001db40: 2878 5f6c 696e 2c20 636f 6d70 6f6e 656e  (x_lin, componen
+0001db50: 7473 2e67 6574 2827 6c7a 315f 2729 2b79  ts.get('lz1_')+y
+0001db60: 6261 7365 5f78 6c69 6e2c 2027 2d62 272c  base_xlin, '-b',
+0001db70: 206c 6162 656c 3d27 4469 6164 3127 2c20   label='Diad1', 
+0001db80: 6c69 6e65 7769 6474 683d 3129 0a0a 2020  linewidth=1)..  
+0001db90: 2020 2020 2020 6966 2066 6974 5f70 6561        if fit_pea
+0001dba0: 6b73 3e31 3a0a 2020 2020 2020 2020 2020  ks>1:.          
+0001dbb0: 2020 6178 6573 5b27 4327 5d2e 706c 6f74    axes['C'].plot
+0001dbc0: 2878 5f6c 696e 2c20 636f 6d70 6f6e 656e  (x_lin, componen
+0001dbd0: 7473 2e67 6574 2827 6c7a 325f 2729 2b79  ts.get('lz2_')+y
+0001dbe0: 6261 7365 5f78 6c69 6e2c 2027 2d72 272c  base_xlin, '-r',
+0001dbf0: 206c 6162 656c 3d27 4842 3127 2c20 6c69   label='HB1', li
+0001dc00: 6e65 7769 6474 683d 3129 0a0a 0a0a 0a20  newidth=1)..... 
+0001dc10: 2020 2020 2020 2061 7865 735b 2743 275d         axes['C']
+0001dc20: 2e6c 6567 656e 6428 6e63 6f6c 3d33 2c20  .legend(ncol=3, 
+0001dc30: 6c6f 633d 276c 6f77 6572 2063 656e 7465  loc='lower cente
+0001dc40: 7227 290a 2020 2020 2020 2020 6178 6573  r').        axes
+0001dc50: 5b27 4327 5d2e 7365 745f 786c 696d 285b  ['C'].set_xlim([
+0001dc60: 6178 635f 786d 696e 2c20 6178 635f 786d  axc_xmin, axc_xm
+0001dc70: 6178 5d29 0a20 2020 2020 2020 2061 7865  ax]).        axe
+0001dc80: 735b 2743 275d 2e73 6574 5f79 6c69 6d28  s['C'].set_ylim(
+0001dc90: 5b61 7863 5f79 6d69 6e2c 2061 7863 5f79  [axc_ymin, axc_y
+0001dca0: 6d61 785d 290a 2020 2020 2020 2020 2361  max]).        #a
+0001dcb0: 7865 735b 2743 275d 2e70 6c6f 7428 4469  xes['C'].plot(Di
+0001dcc0: 6164 5f73 686f 7274 5b3a 2c20 305d 2c20  ad_short[:, 0], 
+0001dcd0: 4469 6164 5f73 686f 7274 5b3a 2c20 315d  Diad_short[:, 1]
+0001dce0: 2c20 2722 7227 2c20 6c61 6265 6c3d 2744  , '"r', label='D
+0001dcf0: 6174 6127 290a 0a0a 2020 2020 2020 2020  ata')...        
+0001dd00: 2320 5265 7369 6475 616c 206f 6e20 706c  # Residual on pl
+0001dd10: 6f74 2044 0a20 2020 2020 2020 2061 7865  ot D.        axe
+0001dd20: 735b 2744 275d 2e73 6574 5f74 6974 6c65  s['D'].set_title
+0001dd30: 2827 6629 2052 6573 6964 7561 6c73 2729  ('f) Residuals')
+0001dd40: 0a20 2020 2020 2020 2061 7865 735b 2744  .        axes['D
+0001dd50: 275d 2e70 6c6f 7428 5b64 665f 6f75 745b  '].plot([df_out[
+0001dd60: 2744 6961 6431 5f56 6f69 6774 5f43 656e  'Diad1_Voigt_Cen
+0001dd70: 7427 5d2c 2064 665f 6f75 745b 2744 6961  t'], df_out['Dia
+0001dd80: 6431 5f56 6f69 6774 5f43 656e 7427 5d5d  d1_Voigt_Cent']]
+0001dd90: 2c20 5b6e 702e 6d69 6e28 7265 7369 6475  , [np.min(residu
+0001dda0: 616c 5f64 6961 645f 636f 6f72 6473 292c  al_diad_coords),
+0001ddb0: 206e 702e 6d61 7828 7265 7369 6475 616c   np.max(residual
+0001ddc0: 5f64 6961 645f 636f 6f72 6473 295d 2c20  _diad_coords)], 
+0001ddd0: 273a 6227 290a 2020 2020 2020 2020 6966  ':b').        if
+0001dde0: 2066 6974 5f70 6561 6b73 3e32 3a0a 2020   fit_peaks>2:.  
+0001ddf0: 2020 2020 2020 2020 2020 6178 6573 5b27            axes['
+0001de00: 4427 5d2e 706c 6f74 285b 6466 5f6f 7574  D'].plot([df_out
+0001de10: 5b27 4842 315f 4365 6e74 275d 2c20 6466  ['HB1_Cent'], df
+0001de20: 5f6f 7574 5b27 4842 315f 4365 6e74 275d  _out['HB1_Cent']
+0001de30: 5d2c 205b 6e70 2e6d 696e 2872 6573 6964  ], [np.min(resid
+0001de40: 7561 6c5f 6469 6164 5f63 6f6f 7264 7329  ual_diad_coords)
+0001de50: 2c20 6e70 2e6d 6178 2872 6573 6964 7561  , np.max(residua
+0001de60: 6c5f 6469 6164 5f63 6f6f 7264 7329 5d2c  l_diad_coords)],
+0001de70: 2027 3a72 2729 0a0a 2020 2020 2020 2020   ':r')..        
+0001de80: 6178 6573 5b27 4427 5d2e 706c 6f74 2878  axes['D'].plot(x
+0001de90: 6461 745f 696e 7261 6e67 652c 2072 6573  dat_inrange, res
+0001dea0: 6964 7561 6c5f 6469 6164 5f63 6f6f 7264  idual_diad_coord
+0001deb0: 732c 2027 6f6b 272c 206d 6663 3d27 6327  s, 'ok', mfc='c'
+0001dec0: 2029 0a20 2020 2020 2020 2061 7865 735b   ).        axes[
+0001ded0: 2744 275d 2e70 6c6f 7428 7864 6174 5f69  'D'].plot(xdat_i
+0001dee0: 6e72 616e 6765 2c20 7265 7369 6475 616c  nrange, residual
+0001def0: 5f64 6961 645f 636f 6f72 6473 2c20 272d  _diad_coords, '-
+0001df00: 6327 2029 0a20 2020 2020 2020 2061 7865  c' ).        axe
+0001df10: 735b 2744 275d 2e73 6574 5f79 6c61 6265  s['D'].set_ylabe
+0001df20: 6c28 2752 6573 6964 7561 6c27 290a 2020  l('Residual').  
+0001df30: 2020 2020 2020 6178 6573 5b27 4427 5d2e        axes['D'].
+0001df40: 7365 745f 786c 6162 656c 2827 5761 7665  set_xlabel('Wave
+0001df50: 6e75 6d62 6572 2729 0a20 2020 2020 2020  number').       
+0001df60: 2023 2061 7865 735b 2744 275d 2e73 6574   # axes['D'].set
+0001df70: 5f78 6c69 6d28 6178 315f 786c 696d 290a  _xlim(ax1_xlim).
+0001df80: 2020 2020 2020 2020 2320 6178 6573 5b27          # axes['
+0001df90: 4427 5d2e 7365 745f 786c 696d 2861 7832  D'].set_xlim(ax2
+0001dfa0: 5f78 6c69 6d29 0a20 2020 2020 2020 204c  _xlim).        L
+0001dfb0: 6f63 616c 5f52 6573 6964 7561 6c5f 6469  ocal_Residual_di
+0001dfc0: 6164 313d 7265 7369 6475 616c 5f64 6961  ad1=residual_dia
+0001dfd0: 645f 636f 6f72 6473 5b28 2878 6461 745f  d_coords[((xdat_
+0001dfe0: 696e 7261 6e67 653e 2864 665f 6f75 745b  inrange>(df_out[
+0001dff0: 2744 6961 6431 5f56 6f69 6774 5f43 656e  'Diad1_Voigt_Cen
+0001e000: 7427 5d5b 305d 2d63 6f6e 6669 6731 2e78  t'][0]-config1.x
+0001e010: 5f72 616e 6765 5f72 6573 6964 7561 6c29  _range_residual)
+0001e020: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e050: 2020 2628 7864 6174 5f69 6e72 616e 6765    &(xdat_inrange
+0001e060: 3c64 665f 6f75 745b 2744 6961 6431 5f56  <df_out['Diad1_V
+0001e070: 6f69 6774 5f43 656e 7427 5d5b 305d 2b63  oigt_Cent'][0]+c
+0001e080: 6f6e 6669 6731 2e78 5f72 616e 6765 5f72  onfig1.x_range_r
+0001e090: 6573 6964 7561 6c29 295d 0a20 2020 2020  esidual))].     
+0001e0a0: 2020 2061 7865 735b 2744 275d 2e73 6574     axes['D'].set
+0001e0b0: 5f78 6c69 6d28 5b64 665f 6f75 745b 2744  _xlim([df_out['D
+0001e0c0: 6961 6431 5f56 6f69 6774 5f43 656e 7427  iad1_Voigt_Cent'
+0001e0d0: 5d5b 305d 2d63 6f6e 6669 6731 2e78 5f72  ][0]-config1.x_r
+0001e0e0: 616e 6765 5f72 6573 6964 7561 6c2c 0a20  ange_residual,. 
+0001e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e100: 2020 2064 665f 6f75 745b 2744 6961 6431     df_out['Diad1
+0001e110: 5f56 6f69 6774 5f43 656e 7427 5d5b 305d  _Voigt_Cent'][0]
+0001e120: 2b63 6f6e 6669 6731 2e78 5f72 616e 6765  +config1.x_range
+0001e130: 5f72 6573 6964 7561 6c5d 290a 2020 2020  _residual]).    
+0001e140: 2020 2020 2361 7835 2e70 6c6f 7428 5b63      #ax5.plot([c
+0001e150: 656e 745f 3131 3137 2c20 6365 6e74 5f31  ent_1117, cent_1
+0001e160: 3131 3720 5d2c 205b 6e70 2e6d 696e 284c  117 ], [np.min(L
+0001e170: 6f63 616c 5f52 6573 6964 7561 6c5f 3131  ocal_Residual_11
+0001e180: 3137 292d 3130 2c20 6e70 2e6d 6178 284c  17)-10, np.max(L
+0001e190: 6f63 616c 5f52 6573 6964 7561 6c5f 3131  ocal_Residual_11
+0001e1a0: 3137 292b 3130 5d2c 2027 3a6b 2729 0a0a  17)+10], ':k')..
+0001e1b0: 0a0a 2020 2020 2020 2020 6178 6573 5b27  ..        axes['
+0001e1c0: 4427 5d2e 7365 745f 796c 696d 285b 6e70  D'].set_ylim([np
+0001e1d0: 2e6d 696e 284c 6f63 616c 5f52 6573 6964  .min(Local_Resid
+0001e1e0: 7561 6c5f 6469 6164 3129 2d31 302c 206e  ual_diad1)-10, n
+0001e1f0: 702e 6d61 7828 4c6f 6361 6c5f 5265 7369  p.max(Local_Resi
+0001e200: 6475 616c 5f64 6961 6431 292b 3130 5d29  dual_diad1)+10])
+0001e210: 0a0a 0a0a 0a0a 2020 2020 2020 2020 2320  ......        # 
+0001e220: 4f76 6572 616c 2073 7065 6374 7261 0a20  Overal spectra. 
+0001e230: 2020 2020 2020 2061 7865 735b 2745 275d         axes['E']
+0001e240: 2e73 6574 5f74 6974 6c65 2827 6729 2053  .set_title('g) S
+0001e250: 756d 6d61 7279 2070 6c6f 7420 6f66 2072  ummary plot of r
+0001e260: 6177 2073 7065 6374 7261 2066 6f72 2066  aw spectra for f
+0001e270: 696c 6520 3d20 2720 2b20 6669 6c65 6e61  ile = ' + filena
+0001e280: 6d65 290a 2020 2020 2020 2020 6178 6573  me).        axes
+0001e290: 5b27 4527 5d2e 706c 6f74 2853 7065 6374  ['E'].plot(Spect
+0001e2a0: 7261 5b3a 2c20 305d 2c20 5370 6563 7472  ra[:, 0], Spectr
+0001e2b0: 615b 3a2c 2031 5d2c 2027 2d72 2729 0a20  a[:, 1], '-r'). 
+0001e2c0: 2020 2020 2020 2061 7865 735b 2745 275d         axes['E']
+0001e2d0: 2e73 6574 5f79 6c61 6265 6c28 2749 6e74  .set_ylabel('Int
+0001e2e0: 656e 7369 7479 2729 0a20 2020 2020 2020  ensity').       
+0001e2f0: 2061 7865 735b 2745 275d 2e73 6574 5f78   axes['E'].set_x
+0001e300: 6c61 6265 6c28 2757 6176 656e 756d 6265  label('Wavenumbe
+0001e310: 7227 290a 0a0a 2020 2020 2020 2020 7061  r')...        pa
+0001e320: 7468 333d 7061 7468 2b27 2f27 2b27 6469  th3=path+'/'+'di
+0001e330: 6164 5f66 6974 5f69 6d61 6765 7327 0a20  ad_fit_images'. 
+0001e340: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+0001e350: 682e 6578 6973 7473 2870 6174 6833 293a  h.exists(path3):
+0001e360: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+0001e370: 3d27 7061 7468 2065 7869 7374 7327 0a20  ='path exists'. 
+0001e380: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001e390: 2020 2020 2020 2020 206f 732e 6d61 6b65           os.make
+0001e3a0: 6469 7273 2870 6174 682b 272f 272b 2027  dirs(path+'/'+ '
+0001e3b0: 6469 6164 5f66 6974 5f69 6d61 6765 7327  diad_fit_images'
+0001e3c0: 2c20 6578 6973 745f 6f6b 3d46 616c 7365  , exist_ok=False
+0001e3d0: 290a 0a20 2020 2020 2020 2066 6967 2e74  )..        fig.t
+0001e3e0: 6967 6874 5f6c 6179 6f75 7428 290a 0a20  ight_layout().. 
+0001e3f0: 2020 2020 2020 2066 696c 653d 6669 6c65         file=file
+0001e400: 6e61 6d65 2e72 7370 6c69 7428 272e 7478  name.rsplit('.tx
+0001e410: 7427 2c20 3129 5b30 5d0a 2020 2020 2020  t', 1)[0].      
+0001e420: 2020 6669 672e 7361 7665 6669 6728 7061    fig.savefig(pa
+0001e430: 7468 332b 272f 272b 2744 6961 6431 5f46  th3+'/'+'Diad1_F
+0001e440: 6974 5f7b 7d2e 706e 6727 2e66 6f72 6d61  it_{}.png'.forma
+0001e450: 7428 6669 6c65 292c 2064 7069 3d63 6f6e  t(file), dpi=con
+0001e460: 6669 6731 2e64 7069 290a 0a20 2020 2020  fig1.dpi)..     
+0001e470: 2020 2069 6620 636c 6f73 655f 6669 6775     if close_figu
+0001e480: 7265 2069 7320 5472 7565 3a0a 2020 2020  re is True:.    
+0001e490: 2020 2020 2020 2020 706c 742e 636c 6f73          plt.clos
+0001e4a0: 6528 6669 6729 0a0a 2020 2020 2320 4c65  e(fig)..    # Le
+0001e4b0: 7473 2063 616c 6375 6c61 7465 2070 6561  ts calculate pea
+0001e4c0: 6b20 736b 6577 6e65 7373 2068 6572 652e  k skewness here.
+0001e4d0: 0a20 2020 2053 6b65 7735 303d 6173 7365  .    Skew50=asse
+0001e4e0: 7373 5f64 6961 6431 5f73 6b65 776e 6573  ss_diad1_skewnes
+0001e4f0: 7328 636f 6e66 6967 313d 6469 6164 315f  s(config1=diad1_
+0001e500: 6669 745f 636f 6e66 6967 2829 2c20 696e  fit_config(), in
+0001e510: 745f 6375 745f 6f66 663d 302e 352c 2070  t_cut_off=0.5, p
+0001e520: 6174 683d 7061 7468 2c20 6669 6c65 6e61  ath=path, filena
+0001e530: 6d65 3d66 696c 656e 616d 652c 2066 696c  me=filename, fil
+0001e540: 6574 7970 653d 6669 6c65 7479 7065 2c0a  etype=filetype,.
+0001e550: 2020 2020 736b 6577 6e65 7373 3d27 6162      skewness='ab
+0001e560: 7327 2c20 6865 6967 6874 3d31 2c20 7072  s', height=1, pr
+0001e570: 6f6d 696e 656e 6365 3d35 2c20 7769 6474  ominence=5, widt
+0001e580: 683d 302e 352c 2070 6c6f 745f 6669 6775  h=0.5, plot_figu
+0001e590: 7265 3d46 616c 7365 2c20 6469 6164 5f61  re=False, diad_a
+0001e5a0: 7272 6179 3d64 6961 645f 6172 7261 7929  rray=diad_array)
+0001e5b0: 0a20 2020 2053 6b65 7738 303d 6173 7365  .    Skew80=asse
+0001e5c0: 7373 5f64 6961 6431 5f73 6b65 776e 6573  ss_diad1_skewnes
+0001e5d0: 7328 636f 6e66 6967 313d 6469 6164 315f  s(config1=diad1_
+0001e5e0: 6669 745f 636f 6e66 6967 2829 2c20 696e  fit_config(), in
+0001e5f0: 745f 6375 745f 6f66 663d 302e 332c 2070  t_cut_off=0.3, p
+0001e600: 6174 683d 7061 7468 2c20 6669 6c65 6e61  ath=path, filena
+0001e610: 6d65 3d66 696c 656e 616d 652c 2066 696c  me=filename, fil
+0001e620: 6574 7970 653d 6669 6c65 7479 7065 2c0a  etype=filetype,.
+0001e630: 2020 2020 736b 6577 6e65 7373 3d27 6162      skewness='ab
+0001e640: 7327 2c20 6865 6967 6874 3d31 2c20 7072  s', height=1, pr
+0001e650: 6f6d 696e 656e 6365 3d35 2c20 7769 6474  ominence=5, widt
+0001e660: 683d 302e 352c 2070 6c6f 745f 6669 6775  h=0.5, plot_figu
+0001e670: 7265 3d46 616c 7365 2c20 6469 6164 5f61  re=False, diad_a
+0001e680: 7272 6179 3d64 6961 645f 6172 7261 7929  rray=diad_array)
+0001e690: 0a0a 2020 2020 6466 5f6f 7574 5b27 4469  ..    df_out['Di
+0001e6a0: 6164 315f 4173 796d 3530 275d 3d53 6b65  ad1_Asym50']=Ske
+0001e6b0: 7735 305b 2753 6b65 776e 6573 735f 6469  w50['Skewness_di
+0001e6c0: 6164 3127 5d0a 2020 2020 6466 5f6f 7574  ad1'].    df_out
+0001e6d0: 5b27 4469 6164 315f 4173 796d 3730 275d  ['Diad1_Asym70']
+0001e6e0: 3d53 6b65 7738 305b 2753 6b65 776e 6573  =Skew80['Skewnes
+0001e6f0: 735f 6469 6164 3127 5d0a 2020 2020 6466  s_diad1'].    df
+0001e700: 5f6f 7574 5b27 4469 6164 315f 5975 616e  _out['Diad1_Yuan
+0001e710: 3230 3137 5f73 796d 5f66 6163 746f 7227  2017_sym_factor'
+0001e720: 5d3d 2864 665f 6f75 745b 2744 6961 6431  ]=(df_out['Diad1
+0001e730: 5f66 7768 6d27 5d29 2a28 6466 5f6f 7574  _fwhm'])*(df_out
+0001e740: 5b27 4469 6164 315f 4173 796d 3530 275d  ['Diad1_Asym50']
+0001e750: 2d31 290a 2020 2020 6466 5f6f 7574 5b27  -1).    df_out['
+0001e760: 4469 6164 315f 5265 6d69 6769 3230 3231  Diad1_Remigi2021
+0001e770: 5f42 5346 275d 3d64 665f 6f75 745b 2744  _BSF']=df_out['D
+0001e780: 6961 6431 5f66 7768 6d27 5d2f 6466 5f6f  iad1_fwhm']/df_o
+0001e790: 7574 5b27 4469 6164 315f 436f 6d62 6f66  ut['Diad1_Combof
+0001e7a0: 6974 5f48 6569 6768 7427 5d0a 0a0a 2020  it_Height']...  
+0001e7b0: 2020 6466 5f6f 7574 5b27 4469 6164 315f    df_out['Diad1_
+0001e7c0: 5044 465f 4d6f 6465 6c27 5d3d 6d6f 6465  PDF_Model']=mode
+0001e7d0: 6c0a 0a20 2020 2069 6620 2063 6f6e 6669  l..    if  confi
+0001e7e0: 6731 2e72 6574 7572 6e5f 6f74 6865 725f  g1.return_other_
+0001e7f0: 7061 7261 6d73 2069 7320 4661 6c73 653a  params is False:
+0001e800: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001e810: 6466 5f6f 7574 0a20 2020 2065 6c73 653a  df_out.    else:
+0001e820: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001e830: 6466 5f6f 7574 2c20 7265 7375 6c74 2c20  df_out, result, 
+0001e840: 795f 6265 7374 5f66 6974 2c20 785f 6c69  y_best_fit, x_li
+0001e850: 6e0a 0a0a 6465 6620 636f 6d62 696e 655f  n...def combine_
+0001e860: 6469 6164 5f6f 7574 7075 7473 282a 2c20  diad_outputs(*, 
+0001e870: 6669 6c65 6e61 6d65 3d4e 6f6e 652c 2070  filename=None, p
+0001e880: 7265 6669 783d 5472 7565 2c0a 4469 6164  refix=True,.Diad
+0001e890: 315f 6669 743d 4e6f 6e65 2c20 4469 6164  1_fit=None, Diad
+0001e8a0: 325f 6669 743d 4e6f 6e65 2c20 746f 5f63  2_fit=None, to_c
+0001e8b0: 7376 3d46 616c 7365 2c0a 746f 5f63 6c69  sv=False,.to_cli
+0001e8c0: 7062 6f61 7264 3d46 616c 7365 2c20 7061  pboard=False, pa
+0001e8d0: 7468 3d4e 6f6e 6529 3a0a 2020 2020 2222  th=None):.    ""
+0001e8e0: 2220 5468 6973 2066 756e 6374 696f 6e20  " This function 
+0001e8f0: 636f 6d62 696e 6573 2074 6865 2064 6174  combines the dat
+0001e900: 6166 7261 6d65 7320 6672 6f6d 2066 6974  aframes from fit
+0001e910: 5f64 6961 645f 325f 775f 6263 6b20 616e  _diad_2_w_bck an
+0001e920: 6420 6669 745f 6469 6164 5f31 5f77 5f62  d fit_diad_1_w_b
+0001e930: 636b 2069 6e74 6f20 610a 2020 2020 7369  ck into a.    si
+0001e940: 6e67 6c65 2064 6174 6166 7261 6d65 0a0a  ngle dataframe..
+0001e950: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0001e960: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     -------------
+0001e970: 2d2d 0a0a 2020 2020 6669 6c65 6e61 6d65  --..    filename
+0001e980: 3a20 7374 720a 2020 2020 2020 2020 6669  : str.        fi
+0001e990: 6c65 6e61 6d65 2064 6174 6120 6973 2066  lename data is f
+0001e9a0: 6f72 0a0a 2020 2020 7072 6566 6978 3a20  or..    prefix: 
+0001e9b0: 626f 6f6c 0a20 2020 2020 2020 2069 6620  bool.        if 
+0001e9c0: 5472 7565 2c20 7370 6c69 7473 2066 696c  True, splits fil
+0001e9d0: 656e 616d 6520 6f6e 2027 2027 2c20 6966  ename on ' ', if
+0001e9e0: 2046 616c 7365 2c20 6c65 6176 6573 2061   False, leaves a
+0001e9f0: 7320 6973 0a0a 2020 2020 4469 6164 315f  s is..    Diad1_
+0001ea00: 6669 743a 2070 642e 4461 7461 4672 616d  fit: pd.DataFram
+0001ea10: 650a 2020 2020 2020 2020 7064 2e44 6174  e.        pd.Dat
+0001ea20: 6146 7261 6d65 206f 6620 6669 7420 6672  aFrame of fit fr
+0001ea30: 6f6d 2066 6974 5f64 6961 645f 315f 775f  om fit_diad_1_w_
+0001ea40: 6263 6b20 6675 6e63 7469 6f6e 0a0a 2020  bck function..  
+0001ea50: 2020 4469 6164 325f 6669 743a 2070 642e    Diad2_fit: pd.
+0001ea60: 4461 7461 4672 616d 650a 2020 2020 2020  DataFrame.      
+0001ea70: 2020 7064 2e44 6174 6146 7261 6d65 206f    pd.DataFrame o
+0001ea80: 6620 6669 7420 6672 6f6d 2066 6974 5f64  f fit from fit_d
+0001ea90: 6961 645f 325f 775f 6263 6b20 6675 6e63  iad_2_w_bck func
+0001eaa0: 7469 6f6e 0a0a 2020 2020 746f 5f63 6c69  tion..    to_cli
+0001eab0: 7062 6f61 7264 3a20 626f 6f6c 0a20 2020  pboard: bool.   
+0001eac0: 2020 2020 2049 6620 5472 7565 2c20 636f       If True, co
+0001ead0: 7069 6573 206d 6572 6765 6420 6461 7461  pies merged data
+0001eae0: 6672 616d 6520 746f 2063 6c69 7062 6f61  frame to clipboa
+0001eaf0: 7264 0a0a 2020 2020 746f 5f63 7376 3a20  rd..    to_csv: 
+0001eb00: 626f 6f6c 0a20 2020 2020 2020 2069 6620  bool.        if 
+0001eb10: 5472 7565 2c20 7361 7665 7320 6669 7420  True, saves fit 
+0001eb20: 746f 2043 7376 2c20 6279 206d 616b 696e  to Csv, by makin
+0001eb30: 6720 6120 7375 6266 6f6c 6465 7220 2744  g a subfolder 'D
+0001eb40: 6961 645f 4669 7473 2720 696e 7369 6465  iad_Fits' inside
+0001eb50: 2074 6865 2066 6f6c 6465 7220 2770 6174   the folder 'pat
+0001eb60: 6827 0a0a 0a0a 0a20 2020 2022 2222 0a0a  h'.....    """..
+0001eb70: 2020 2020 6966 2070 7265 6669 7820 6973      if prefix is
+0001eb80: 2054 7275 653a 0a20 2020 2020 2020 2066   True:.        f
+0001eb90: 696c 656e 616d 6520 3d20 6669 6c65 6e61  ilename = filena
+0001eba0: 6d65 2e73 706c 6974 2827 2027 2c20 3129  me.split(' ', 1)
+0001ebb0: 5b31 5d0a 0a20 2020 2069 6620 4469 6164  [1]..    if Diad
+0001ebc0: 315f 6669 7420 6973 206e 6f74 204e 6f6e  1_fit is not Non
+0001ebd0: 6520 616e 6420 4469 6164 325f 6669 7420  e and Diad2_fit 
+0001ebe0: 6973 206e 6f74 204e 6f6e 653a 0a0a 2020  is not None:..  
+0001ebf0: 2020 2020 2020 636f 6d62 6f3d 7064 2e63        combo=pd.c
+0001ec00: 6f6e 6361 7428 5b44 6961 6431 5f66 6974  oncat([Diad1_fit
+0001ec10: 2c20 4469 6164 325f 6669 745d 2c20 6178  , Diad2_fit], ax
+0001ec20: 6973 3d31 290a 2020 2020 2020 2020 2320  is=1).        # 
+0001ec30: 4669 6c6c 2061 6e79 2063 6f6c 756d 6e73  Fill any columns
+0001ec40: 2077 6869 6368 2064 6f6e 7427 2065 7869   which dont' exi
+0001ec50: 7374 2073 6f20 6361 6e20 7265 2d6f 7264  st so can re-ord
+0001ec60: 6572 2074 6865 2073 616d 6520 6576 6572  er the same ever
+0001ec70: 7920 7469 6d65 0a20 2020 2020 2020 2069  y time.        i
+0001ec80: 6620 2748 4231 5f43 656e 7427 206e 6f74  f 'HB1_Cent' not
+0001ec90: 2069 6e20 636f 6d62 6f2e 636f 6c75 6d6e   in combo.column
+0001eca0: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
+0001ecb0: 6f6d 626f 5b27 4842 315f 4365 6e74 275d  ombo['HB1_Cent']
+0001ecc0: 3d6e 702e 6e61 6e0a 2020 2020 2020 2020  =np.nan.        
+0001ecd0: 2020 2020 636f 6d62 6f5b 2748 4231 5f41      combo['HB1_A
+0001ece0: 7265 6127 5d3d 6e70 2e6e 616e 0a20 2020  rea']=np.nan.   
+0001ecf0: 2020 2020 2020 2020 2063 6f6d 626f 5b27           combo['
+0001ed00: 4842 315f 5369 676d 6127 5d3d 6e70 2e6e  HB1_Sigma']=np.n
+0001ed10: 616e 0a20 2020 2020 2020 2069 6620 2748  an.        if 'H
+0001ed20: 4232 5f43 656e 7427 206e 6f74 2069 6e20  B2_Cent' not in 
+0001ed30: 636f 6d62 6f2e 636f 6c75 6d6e 733a 0a20  combo.columns:. 
+0001ed40: 2020 2020 2020 2020 2020 2063 6f6d 626f             combo
+0001ed50: 5b27 4842 325f 4365 6e74 275d 3d6e 702e  ['HB2_Cent']=np.
+0001ed60: 6e61 6e0a 2020 2020 2020 2020 2020 2020  nan.            
+0001ed70: 636f 6d62 6f5b 2748 4232 5f41 7265 6127  combo['HB2_Area'
+0001ed80: 5d3d 6e70 2e6e 616e 0a20 2020 2020 2020  ]=np.nan.       
+0001ed90: 2020 2020 2063 6f6d 626f 5b27 4842 325f       combo['HB2_
+0001eda0: 5369 676d 6127 5d3d 6e70 2e6e 616e 0a20  Sigma']=np.nan. 
+0001edb0: 2020 2020 2020 2069 6620 2743 3133 5f43         if 'C13_C
+0001edc0: 656e 7427 206e 6f74 2069 6e20 636f 6d62  ent' not in comb
+0001edd0: 6f2e 636f 6c75 6d6e 733a 0a20 2020 2020  o.columns:.     
+0001ede0: 2020 2020 2020 2063 6f6d 626f 5b27 4331         combo['C1
+0001edf0: 335f 4365 6e74 275d 3d6e 702e 6e61 6e0a  3_Cent']=np.nan.
+0001ee00: 2020 2020 2020 2020 2020 2020 636f 6d62              comb
+0001ee10: 6f5b 2743 3133 5f41 7265 6127 5d3d 6e70  o['C13_Area']=np
+0001ee20: 2e6e 616e 0a20 2020 2020 2020 2020 2020  .nan.           
+0001ee30: 2063 6f6d 626f 5b27 4331 335f 5369 676d   combo['C13_Sigm
+0001ee40: 6127 5d3d 6e70 2e6e 616e 0a20 2020 2020  a']=np.nan.     
+0001ee50: 2020 2069 6620 2744 6961 6431 5f47 6175     if 'Diad1_Gau
+0001ee60: 7373 5f43 656e 7427 206e 6f74 2069 6e20  ss_Cent' not in 
+0001ee70: 636f 6d62 6f2e 636f 6c75 6d6e 733a 0a20  combo.columns:. 
+0001ee80: 2020 2020 2020 2020 2020 2063 6f6d 626f             combo
+0001ee90: 5b27 4469 6164 315f 4761 7573 735f 4365  ['Diad1_Gauss_Ce
+0001eea0: 6e74 275d 3d6e 702e 6e61 6e0a 2020 2020  nt']=np.nan.    
+0001eeb0: 2020 2020 2020 2020 636f 6d62 6f5b 2744          combo['D
+0001eec0: 6961 6431 5f47 6175 7373 5f41 7265 6127  iad1_Gauss_Area'
+0001eed0: 5d3d 6e70 2e6e 616e 0a20 2020 2020 2020  ]=np.nan.       
+0001eee0: 2020 2020 2063 6f6d 626f 5b27 4469 6164       combo['Diad
+0001eef0: 315f 4761 7573 735f 5369 676d 6127 5d3d  1_Gauss_Sigma']=
+0001ef00: 6e70 2e6e 616e 0a20 2020 2020 2020 2069  np.nan.        i
+0001ef10: 6620 2744 6961 6432 5f47 6175 7373 5f43  f 'Diad2_Gauss_C
+0001ef20: 656e 7427 206e 6f74 2069 6e20 636f 6d62  ent' not in comb
+0001ef30: 6f2e 636f 6c75 6d6e 733a 0a20 2020 2020  o.columns:.     
+0001ef40: 2020 2020 2020 2063 6f6d 626f 5b27 4469         combo['Di
+0001ef50: 6164 325f 4761 7573 735f 4365 6e74 275d  ad2_Gauss_Cent']
+0001ef60: 3d6e 702e 6e61 6e0a 2020 2020 2020 2020  =np.nan.        
+0001ef70: 2020 2020 636f 6d62 6f5b 2744 6961 6432      combo['Diad2
+0001ef80: 5f47 6175 7373 5f41 7265 6127 5d3d 6e70  _Gauss_Area']=np
+0001ef90: 2e6e 616e 0a20 2020 2020 2020 2020 2020  .nan.           
+0001efa0: 2063 6f6d 626f 5b27 4469 6164 325f 4761   combo['Diad2_Ga
+0001efb0: 7573 735f 5369 676d 6127 5d3d 6e70 2e6e  uss_Sigma']=np.n
+0001efc0: 616e 0a0a 0a20 2020 2020 2020 2063 6f6d  an...        com
+0001efd0: 626f 5b27 5370 6c69 7474 696e 6727 5d3d  bo['Splitting']=
+0001efe0: 636f 6d62 6f5b 2744 6961 6432 5f56 6f69  combo['Diad2_Voi
+0001eff0: 6774 5f43 656e 7427 5d2d 636f 6d62 6f5b  gt_Cent']-combo[
+0001f000: 2744 6961 6431 5f56 6f69 6774 5f43 656e  'Diad1_Voigt_Cen
+0001f010: 7427 5d0a 2020 2020 2020 2020 2363 6f6d  t'].        #com
+0001f020: 626f 5b27 5370 6c69 745f 6572 725f 6162  bo['Split_err_ab
+0001f030: 7327 5d3d 636f 6d62 6f5b 2744 6961 6431  s']=combo['Diad1
+0001f040: 5f63 656e 745f 6572 7227 5d2b 636f 6d62  _cent_err']+comb
+0001f050: 6f5b 2744 6961 6432 5f63 656e 745f 6572  o['Diad2_cent_er
+0001f060: 7227 5d0a 2020 2020 2020 2020 636f 6d62  r'].        comb
+0001f070: 6f5b 2753 706c 6974 5fcf 8327 5d3d 2863  o['Split_..']=(c
+0001f080: 6f6d 626f 5b27 4469 6164 315f 6365 6e74  ombo['Diad1_cent
+0001f090: 5f65 7272 275d 2a2a 322b 636f 6d62 6f5b  _err']**2+combo[
+0001f0a0: 2744 6961 6432 5f63 656e 745f 6572 7227  'Diad2_cent_err'
+0001f0b0: 5d2a 2a32 292a 2a30 2e35 0a20 2020 2020  ]**2)**0.5.     
+0001f0c0: 2020 2063 6f6c 735f 746f 5f6d 6f76 6520     cols_to_move 
+0001f0d0: 3d20 5b27 5370 6c69 7474 696e 6727 2c20  = ['Splitting', 
+0001f0e0: 2753 706c 6974 5fcf 8327 2c20 2027 4469  'Split_..',  'Di
+0001f0f0: 6164 315f 436f 6d62 6f66 6974 5f43 656e  ad1_Combofit_Cen
+0001f100: 7427 2c20 2744 6961 6431 5f63 656e 745f  t', 'Diad1_cent_
+0001f110: 6572 7227 2c20 2744 6961 6431 5f43 6f6d  err', 'Diad1_Com
+0001f120: 626f 6669 745f 4865 6967 6874 272c 2027  bofit_Height', '
+0001f130: 4469 6164 315f 566f 6967 745f 4365 6e74  Diad1_Voigt_Cent
+0001f140: 272c 2027 4469 6164 315f 566f 6967 745f  ', 'Diad1_Voigt_
+0001f150: 4172 6561 272c 2027 4469 6164 315f 566f  Area', 'Diad1_Vo
+0001f160: 6967 745f 5369 676d 6127 2c20 2027 4469  igt_Sigma',  'Di
+0001f170: 6164 315f 5265 7369 6475 616c 272c 2027  ad1_Residual', '
+0001f180: 4469 6164 315f 5072 6f70 5f4c 6f72 272c  Diad1_Prop_Lor',
+0001f190: 2027 4469 6164 315f 6677 686d 272c 2027   'Diad1_fwhm', '
+0001f1a0: 4469 6164 315f 7265 6669 7427 2c27 4469  Diad1_refit','Di
+0001f1b0: 6164 325f 436f 6d62 6f66 6974 5f43 656e  ad2_Combofit_Cen
+0001f1c0: 7427 2c20 2744 6961 6432 5f63 656e 745f  t', 'Diad2_cent_
+0001f1d0: 6572 7227 2c20 2027 4469 6164 325f 436f  err',  'Diad2_Co
+0001f1e0: 6d62 6f66 6974 5f48 6569 6768 7427 2c20  mbofit_Height', 
+0001f1f0: 2744 6961 6432 5f56 6f69 6774 5f43 656e  'Diad2_Voigt_Cen
+0001f200: 7427 2c20 2744 6961 6432 5f56 6f69 6774  t', 'Diad2_Voigt
+0001f210: 5f41 7265 6127 2c20 2744 6961 6432 5f56  _Area', 'Diad2_V
+0001f220: 6f69 6774 5f53 6967 6d61 272c 2027 4469  oigt_Sigma', 'Di
+0001f230: 6164 325f 566f 6967 745f 4761 6d6d 6127  ad2_Voigt_Gamma'
+0001f240: 2c20 2744 6961 6432 5f52 6573 6964 7561  , 'Diad2_Residua
+0001f250: 6c27 2c20 2744 6961 6432 5f50 726f 705f  l', 'Diad2_Prop_
+0001f260: 4c6f 7227 2c20 2744 6961 6432 5f66 7768  Lor', 'Diad2_fwh
+0001f270: 6d27 2c20 2744 6961 6432 5f72 6566 6974  m', 'Diad2_refit
+0001f280: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0001f290: 2020 2020 2020 2027 4842 315f 4365 6e74         'HB1_Cent
+0001f2a0: 272c 2027 4842 315f 4172 6561 272c 2027  ', 'HB1_Area', '
+0001f2b0: 4842 315f 5369 676d 6127 2c20 2748 4232  HB1_Sigma', 'HB2
+0001f2c0: 5f43 656e 7427 2c20 2748 4232 5f41 7265  _Cent', 'HB2_Are
+0001f2d0: 6127 2c20 2748 4232 5f53 6967 6d61 272c  a', 'HB2_Sigma',
+0001f2e0: 2027 4331 335f 4365 6e74 272c 2027 4331   'C13_Cent', 'C1
+0001f2f0: 335f 4172 6561 272c 2027 4331 335f 5369  3_Area', 'C13_Si
+0001f300: 676d 6127 2c0a 2020 2020 2020 2020 2020  gma',.          
+0001f310: 2020 2020 2020 2020 2020 2744 6961 6432            'Diad2
+0001f320: 5f47 6175 7373 5f43 656e 7427 2c20 2744  _Gauss_Cent', 'D
+0001f330: 6961 6432 5f47 6175 7373 5f41 7265 6127  iad2_Gauss_Area'
+0001f340: 2c27 4469 6164 325f 4761 7573 735f 5369  ,'Diad2_Gauss_Si
+0001f350: 676d 6127 2c20 2744 6961 6431 5f47 6175  gma', 'Diad1_Gau
+0001f360: 7373 5f43 656e 7427 2c20 2744 6961 6431  ss_Cent', 'Diad1
+0001f370: 5f47 6175 7373 5f41 7265 6127 2c27 4469  _Gauss_Area','Di
+0001f380: 6164 315f 4761 7573 735f 5369 676d 6127  ad1_Gauss_Sigma'
+0001f390: 2c20 2744 6961 6431 5f41 7379 6d35 3027  , 'Diad1_Asym50'
+0001f3a0: 2c20 2744 6961 6431 5f41 7379 6d37 3027  , 'Diad1_Asym70'
+0001f3b0: 2c20 2744 6961 6431 5f59 7561 6e32 3031  , 'Diad1_Yuan201
+0001f3c0: 375f 7379 6d5f 6661 6374 6f72 272c 0a27  7_sym_factor',.'
+0001f3d0: 4469 6164 315f 5265 6d69 6769 3230 3231  Diad1_Remigi2021
+0001f3e0: 5f42 5346 272c 2744 6961 6432 5f41 7379  _BSF','Diad2_Asy
+0001f3f0: 6d35 3027 2c20 2744 6961 6432 5f41 7379  m50', 'Diad2_Asy
+0001f400: 6d37 3027 2c20 2744 6961 6432 5f59 7561  m70', 'Diad2_Yua
+0001f410: 6e32 3031 375f 7379 6d5f 6661 6374 6f72  n2017_sym_factor
+0001f420: 272c 0a27 4469 6164 325f 5265 6d69 6769  ',.'Diad2_Remigi
+0001f430: 3230 3231 5f42 5346 272c 2027 4469 6164  2021_BSF', 'Diad
+0001f440: 315f 5044 465f 4d6f 6465 6c27 2c20 2744  1_PDF_Model', 'D
+0001f450: 6961 6432 5f50 4446 5f4d 6f64 656c 275d  iad2_PDF_Model']
+0001f460: 0a0a 0a0a 0a20 2020 2020 2020 2063 6f6d  .....        com
+0001f470: 626f 5f66 203d 2063 6f6d 626f 5b63 6f6c  bo_f = combo[col
+0001f480: 735f 746f 5f6d 6f76 6520 2b20 5b0a 2020  s_to_move + [.  
+0001f490: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001f4a0: 6c20 666f 7220 636f 6c20 696e 2063 6f6d  l for col in com
+0001f4b0: 626f 2e63 6f6c 756d 6e73 2069 6620 636f  bo.columns if co
+0001f4c0: 6c20 6e6f 7420 696e 2063 6f6c 735f 746f  l not in cols_to
+0001f4d0: 5f6d 6f76 655d 5d0a 2020 2020 2020 2020  _move]].        
+0001f4e0: 636f 6d62 6f5f 663d 636f 6d62 6f5f 662e  combo_f=combo_f.
+0001f4f0: 696c 6f63 5b3a 2c20 303a 6c65 6e28 636f  iloc[:, 0:len(co
+0001f500: 6c73 5f74 6f5f 6d6f 7665 295d 0a20 2020  ls_to_move)].   
+0001f510: 2020 2020 2066 696c 653d 6669 6c65 6e61       file=filena
+0001f520: 6d65 2e72 7370 6c69 7428 272e 7478 7427  me.rsplit('.txt'
+0001f530: 2c20 3129 5b30 5d0a 2020 2020 2020 2020  , 1)[0].        
+0001f540: 636f 6d62 6f5f 662e 696e 7365 7274 2830  combo_f.insert(0
+0001f550: 2c20 2766 696c 656e 616d 6527 2c20 6669  , 'filename', fi
+0001f560: 6c65 290a 0a20 2020 2069 6620 4469 6164  le)..    if Diad
+0001f570: 315f 6669 7420 6973 204e 6f6e 6520 616e  1_fit is None an
+0001f580: 6420 4469 6164 325f 6669 7420 6973 204e  d Diad2_fit is N
+0001f590: 6f6e 653a 0a20 2020 2020 2020 2064 663d  one:.        df=
+0001f5a0: 7064 2e44 6174 6146 7261 6d65 2864 6174  pd.DataFrame(dat
+0001f5b0: 613d 7b27 6669 6c65 6e61 6d65 273a 2066  a={'filename': f
+0001f5c0: 696c 656e 616d 652c 0a20 2020 2020 2020  ilename,.       
+0001f5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f5e0: 2020 2020 2027 5370 6c69 7474 696e 6727       'Splitting'
+0001f5f0: 3a20 6e70 2e6e 616e 2c0a 2020 2020 2020  : np.nan,.      
 0001f600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f620: 2748 4231 5f41 7265 6127 3a6e 702e 6e61  'HB1_Area':np.na
-0001f630: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+0001f610: 2020 2020 2020 2020 2020 2744 6961 6431            'Diad1
+0001f620: 5f56 6f69 6774 5f43 656e 7427 3a6e 702e  _Voigt_Cent':np.
+0001f630: 6e61 6e2c 0a20 2020 2020 2020 2020 2020  nan,.           
 0001f640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f660: 2020 2027 4842 325f 4365 6e74 273a 6e70     'HB2_Cent':np
-0001f670: 2e6e 616e 2c0a 2020 2020 2020 2020 2020  .nan,.          
+0001f650: 2020 2020 2020 2020 2027 4469 6164 315f           'Diad1_
+0001f660: 566f 6967 745f 4172 6561 273a 6e70 2e6e  Voigt_Area':np.n
+0001f670: 616e 2c0a 2020 2020 2020 2020 2020 2020  an,.            
 0001f680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f6a0: 2020 2020 2020 2020 2020 2748 4232 5f41            'HB2_A
-0001f6b0: 7265 6127 3a6e 702e 6e61 6e2c 0a20 2020  rea':np.nan,.   
+0001f690: 2020 2020 2020 2020 2752 6573 6964 7561          'Residua
+0001f6a0: 6c5f 4469 6164 3127 3a20 6e70 2e6e 616e  l_Diad1': np.nan
+0001f6b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 0001f6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f6f0: 2020 2020 2027 4331 335f 4365 6e74 273a       'C13_Cent':
-0001f700: 206e 702e 6e61 6e2c 0a20 2020 2020 2020   np.nan,.       
-0001f710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f740: 2027 4331 335f 4172 6561 273a 206e 702e   'C13_Area': np.
-0001f750: 6e61 6e2c 0a20 2020 2020 2020 2020 2020  nan,.           
-0001f760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f780: 2020 2020 2020 2020 2020 2020 207d 290a               }).
-0001f790: 2020 2020 2020 2020 636f 6d62 6f5f 663d          combo_f=
-0001f7a0: 7064 2e63 6f6e 6361 7428 5b64 662c 2043  pd.concat([df, C
-0001f7b0: 6172 625f 6669 745d 2c20 6178 6973 3d31  arb_fit], axis=1
-0001f7c0: 290a 2020 2020 2020 2020 6966 2074 6f5f  ).        if to_
-0001f7d0: 636c 6970 626f 6172 6420 6973 2054 7275  clipboard is Tru
-0001f7e0: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
-0001f7f0: 662e 746f 5f63 6c69 7062 6f61 7264 2865  f.to_clipboard(e
-0001f800: 7863 656c 3d54 7275 652c 2068 6561 6465  xcel=True, heade
-0001f810: 723d 4661 6c73 652c 2069 6e64 6578 3d46  r=False, index=F
-0001f820: 616c 7365 290a 2020 2020 2020 2020 636f  alse).        co
-0001f830: 6d62 6f5f 663d 6466 0a0a 2020 2020 6966  mbo_f=df..    if
-0001f840: 2074 6f5f 6373 7620 6973 2054 7275 653a   to_csv is True:
-0001f850: 0a20 2020 2020 2020 2069 6620 7061 7468  .        if path
-0001f860: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001f870: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-0001f880: 7074 696f 6e28 2759 6f75 206e 6565 6420  ption('You need 
-0001f890: 746f 2073 7065 6369 6679 2070 6174 683d  to specify path=
-0001f8a0: 2066 6f72 2077 6865 7265 7665 7220 796f   for wherever yo
-0001f8b0: 7520 7761 6e74 2074 6869 7320 7361 7665  u want this save
-0001f8c0: 6427 290a 2020 2020 2020 2020 7061 7468  d').        path
-0001f8d0: 5f66 6974 733d 7061 7468 2b27 2f27 2b27  _fits=path+'/'+'
-0001f8e0: 4469 6164 5f46 6974 7327 0a20 2020 2020  Diad_Fits'.     
-0001f8f0: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-0001f900: 6973 7473 2870 6174 685f 6669 7473 293a  ists(path_fits):
-0001f910: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-0001f920: 3d27 7061 7468 2065 7869 7374 7327 0a20  ='path exists'. 
-0001f930: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001f940: 2020 2020 2020 2020 2064 6972 323d 6f73           dir2=os
-0001f950: 2e6d 616b 6564 6972 7328 7061 7468 2b27  .makedirs(path+'
-0001f960: 2f27 2b20 2744 6961 645f 4669 7473 272c  /'+ 'Diad_Fits',
-0001f970: 2065 7869 7374 5f6f 6b3d 4661 6c73 6529   exist_ok=False)
-0001f980: 0a20 2020 2020 2020 2023 6669 6c65 7061  .        #filepa
-0001f990: 7468 3d50 6174 6828 7061 7468 2b27 2f27  th=Path(path+'/'
-0001f9a0: 2b20 2750 6561 6b5f 4669 7473 272b 272f  + 'Peak_Fits'+'/
-0001f9b0: 272b 6669 6c65 6e61 6d65 290a 2020 2020  '+filename).    
-0001f9c0: 2020 2020 636f 6d62 6f5f 662e 746f 5f63      combo_f.to_c
-0001f9d0: 7376 2870 6174 682b 272f 272b 2744 6961  sv(path+'/'+'Dia
-0001f9e0: 645f 4669 7473 272b 272f 272b 2766 6974  d_Fits'+'/'+'fit
-0001f9f0: 735f 272b 6669 6c65 6e61 6d65 290a 2020  s_'+filename).  
-0001fa00: 2020 7265 7475 726e 2063 6f6d 626f 5f66    return combo_f
-0001fa10: 0a0a 0a0a 0a64 6566 2063 616c 6375 6c61  .....def calcula
-0001fa20: 7465 5f48 425f 4469 6164 5f61 7265 615f  te_HB_Diad_area_
-0001fa30: 7261 7469 6f28 6466 293a 0a20 2020 2022  ratio(df):.    "
-0001fa40: 2222 2220 4361 6c63 756c 6174 6573 2074  """ Calculates t
-0001fa50: 776f 2061 7265 6120 7261 7469 6f73 206f  wo area ratios o
-0001fa60: 6620 686f 7462 616e 6473 2061 6e64 2064  f hotbands and d
-0001fa70: 6961 6473 2222 220a 2020 2020 6466 5f63  iads""".    df_c
-0001fa80: 3d64 662e 636f 7079 2829 0a20 2020 2064  =df.copy().    d
-0001fa90: 665f 635b 2748 425f 4469 6164 5f52 6174  f_c['HB_Diad_Rat
-0001faa0: 696f 275d 3d28 6466 5f63 5b27 4842 315f  io']=(df_c['HB1_
-0001fab0: 4172 6561 275d 2b64 665f 635b 2748 4232  Area']+df_c['HB2
-0001fac0: 5f41 7265 6127 5d29 2f28 6466 5f63 5b27  _Area'])/(df_c['
-0001fad0: 4469 6164 315f 566f 6967 745f 4172 6561  Diad1_Voigt_Area
-0001fae0: 275d 2b64 665f 635b 2744 6961 6432 5f56  ']+df_c['Diad2_V
-0001faf0: 6f69 6774 5f41 7265 6127 5d29 0a20 2020  oigt_Area']).   
-0001fb00: 2064 665f 635b 2748 425f 546f 7461 6c5f   df_c['HB_Total_
-0001fb10: 5261 7469 6f27 5d3d 2864 665f 635b 2748  Ratio']=(df_c['H
-0001fb20: 4231 5f41 7265 6127 5d2b 6466 5f63 5b27  B1_Area']+df_c['
-0001fb30: 4842 325f 4172 6561 275d 292f 2864 665f  HB2_Area'])/(df_
-0001fb40: 635b 2744 6961 6431 5f56 6f69 6774 5f41  c['Diad1_Voigt_A
-0001fb50: 7265 6127 5d2b 6466 5f63 5b27 4469 6164  rea']+df_c['Diad
-0001fb60: 325f 566f 6967 745f 4172 6561 275d 2b64  2_Voigt_Area']+d
-0001fb70: 665f 635b 2748 4231 5f41 7265 6127 5d2b  f_c['HB1_Area']+
-0001fb80: 6466 5f63 5b27 4842 325f 4172 6561 275d  df_c['HB2_Area']
-0001fb90: 290a 2020 2020 7265 7475 726e 2064 665f  ).    return df_
-0001fba0: 630a 0a0a 0a0a 0a0a 2323 2046 6974 2067  c.......## Fit g
-0001fbb0: 656e 6572 6963 2070 6561 6b0a 0a40 6461  eneric peak..@da
-0001fbc0: 7461 636c 6173 730a 636c 6173 7320 6765  taclass.class ge
-0001fbd0: 6e65 7269 635f 7065 616b 5f63 6f6e 6669  neric_peak_confi
-0001fbe0: 673a 0a20 2020 2022 2222 0a20 2020 2043  g:.    """.    C
-0001fbf0: 6f6e 6669 6775 7261 7469 6f6e 2063 6c61  onfiguration cla
-0001fc00: 7373 2066 6f72 2066 6974 7469 6e67 2073  ss for fitting s
-0001fc10: 6563 6f6e 6461 7279 2070 6561 6b73 2028  econdary peaks (
-0001fc20: 652e 672e 2053 4f32 2c20 4361 7262 6f6e  e.g. SO2, Carbon
-0001fc30: 6174 6529 0a0a 2020 2020 4174 7472 6962  ate)..    Attrib
-0001fc40: 7574 6573 3a0a 2020 2020 2020 2020 6e61  utes:.        na
-0001fc50: 6d65 2028 7374 7229 3a20 4465 6661 756c  me (str): Defaul
-0001fc60: 7420 2747 656e 6572 6963 270a 2020 2020  t 'Generic'.    
-0001fc70: 2020 2020 2020 2020 4e61 6d65 206f 6620          Name of 
-0001fc80: 636f 6d70 6f6e 656e 7420 796f 7520 6172  component you ar
-0001fc90: 6520 6669 7474 696e 6720 7468 6174 2067  e fitting that g
-0001fca0: 6574 7320 7374 616d 7065 6420 6f6e 746f  ets stamped onto
-0001fcb0: 2074 6865 2070 6561 6b20 7061 7261 6d65   the peak parame
-0001fcc0: 7465 7273 2c20 652e 672e 2069 6620 2753  ters, e.g. if 'S
-0001fcd0: 4f32 272c 2067 6574 2050 6561 6b5f 4172  O2', get Peak_Ar
-0001fce0: 6561 5f53 4f32 270a 0a20 2020 2020 2020  ea_SO2'..       
-0001fcf0: 206c 6f77 6572 5f62 636b 2c20 7570 7065   lower_bck, uppe
-0001fd00: 725f 6263 6b3a 2054 7570 6c65 5b66 6c6f  r_bck: Tuple[flo
-0001fd10: 6174 2c20 666c 6f61 745d 0a20 2020 2020  at, float].     
-0001fd20: 2020 2020 2020 2042 6163 6b67 726f 756e         Backgroun
-0001fd30: 6420 706f 7369 7469 6f6e 7320 696e 2077  d positions in w
-0001fd40: 6176 656e 756d 6265 7273 0a0a 2020 2020  avenumbers..    
-0001fd50: 2020 2020 6d6f 6465 6c5f 6e61 6d65 3a20      model_name: 
-0001fd60: 4465 6661 756c 7420 2750 7365 7564 6f56  Default 'PseudoV
-0001fd70: 6f69 6774 270a 2020 2020 2020 2020 2020  oigt'.          
-0001fd80: 2020 5479 7065 206f 6620 7065 616b 2066    Type of peak f
-0001fd90: 6974 2e20 4368 6f6f 7365 2066 726f 6d20  it. Choose from 
-0001fda0: 2747 6175 7373 6961 6e4d 6f64 656c 272c  'GaussianModel',
-0001fdb0: 2027 566f 6967 744d 6f64 656c 272c 2027   'VoigtModel', '
-0001fdc0: 5073 6575 646f 566f 6967 744d 6f64 656c  PseudoVoigtModel
-0001fdd0: 272c 2027 5370 6c69 6e65 272e 0a0a 2020  ', 'Spline'...  
-0001fde0: 2020 2020 2020 785f 7261 6e67 655f 6263        x_range_bc
-0001fdf0: 6b3a 2066 6c6f 6174 2028 6465 6661 756c  k: float (defaul
-0001fe00: 7420 3130 290a 2020 2020 2020 2020 2020  t 10).          
-0001fe10: 2020 5768 656e 2073 686f 7769 6e67 2062    When showing b
-0001fe20: 636b 2063 6f6c 6c65 6374 6564 2070 6c6f  ck collected plo
-0001fe30: 742c 2073 686f 7773 2070 6561 6b20 6365  t, shows peak ce
-0001fe40: 6e74 6572 202b 2d20 7468 6973 2061 6d6f  nter +- this amo
-0001fe50: 756e 740a 0a20 2020 2020 2020 204e 5f70  unt..        N_p
-0001fe60: 6f6c 795f 6361 7262 5f62 636b 3a20 666c  oly_carb_bck: fl
-0001fe70: 6f61 7420 2864 6566 6175 6c74 2031 290a  oat (default 1).
-0001fe80: 2020 2020 2020 2020 2020 2020 4465 6772              Degr
-0001fe90: 6565 206f 6620 706f 6c79 6e6f 6d69 616c  ee of polynomial
-0001fea0: 2074 6f20 6669 7420 746f 2062 6163 6b67   to fit to backg
-0001feb0: 726f 756e 642e 0a0a 2020 2020 2020 2020  round...        
-0001fec0: 616d 706c 6974 7564 653a 2066 6c6f 6174  amplitude: float
-0001fed0: 2028 6465 6661 756c 7420 3130 3029 0a20   (default 100). 
-0001fee0: 2020 2020 2020 2020 2020 2041 7070 726f             Appro
-0001fef0: 7869 6d61 7465 2061 6d70 6c69 7475 6465  ximate amplitude
-0001ff00: 206f 6620 7065 616b 2066 6974 2028 6669   of peak fit (fi
-0001ff10: 7273 7420 6775 6573 7320 666f 7220 4761  rst guess for Ga
-0001ff20: 7573 7369 616e 202c 2076 6f69 6774 2061  ussian , voigt a
-0001ff30: 6e64 2050 7375 6564 6f76 6f69 6774 206e  nd Psuedovoigt n
-0001ff40: 6565 6465 6429 0a0a 2020 2020 2020 2020  eeded)..        
-0001ff50: 6365 6e74 3a20 666c 6f61 7420 2864 6566  cent: float (def
-0001ff60: 6175 6c74 2031 3039 3029 0a20 2020 2020  ault 1090).     
-0001ff70: 2020 2020 2020 2041 7070 726f 7869 6d61         Approxima
-0001ff80: 7465 2070 6561 6b20 706f 7369 7469 6f6e  te peak position
-0001ff90: 206f 6620 7370 6563 6965 7320 796f 7520   of species you 
-0001ffa0: 6172 6520 6c6f 6f6b 696e 6720 666f 722e  are looking for.
-0001ffb0: 2045 2e67 2e20 3130 3930 2066 6f72 2043   E.g. 1090 for C
-0001ffc0: 4f32 2c20 3131 3530 2066 6f72 2053 4f32  O2, 1150 for SO2
-0001ffd0: 0a0a 2020 2020 2020 2020 6f75 746c 6965  ..        outlie
-0001ffe0: 725f 7369 676d 613a 2066 6c6f 6174 2028  r_sigma: float (
-0001fff0: 6465 6661 756c 7420 3132 290a 2020 2020  default 12).    
-00020000: 2020 2020 2020 2020 436f 6465 2063 616c          Code cal
-00020010: 6375 6c61 7465 7320 7374 616e 6461 7264  culates standard
-00020020: 2064 6576 6961 7469 6f6e 206f 6620 6261   deviation of ba
-00020030: 636b 6772 6f75 6e64 2c20 616e 6420 6578  ckground, and ex
-00020040: 636c 7564 6573 2070 6f69 6e74 7320 6d6f  cludes points mo
-00020050: 7265 2074 6861 6e20 6f75 746c 6965 725f  re than outlier_
-00020060: 7369 676d 612a 7468 6973 2073 7461 6e64  sigma*this stand
-00020070: 6172 6420 6465 7669 6174 6f69 6e20 6672  ard deviatoin fr
-00020080: 6f6d 206e 6561 7262 7920 6261 636b 6772  om nearby backgr
-00020090: 6f75 6e64 2070 6f69 6e74 730a 0a20 2020  ound points..   
-000200a0: 2020 2020 2064 6973 7461 6e63 652c 2070       distance, p
-000200b0: 726f 6d69 6e65 6e63 652c 2077 6964 7468  rominence, width
-000200c0: 2c20 7468 7265 7368 6f6c 642c 2068 6569  , threshold, hei
-000200d0: 6768 743a 2066 6c6f 6174 0a20 2020 2020  ght: float.     
-000200e0: 2020 2020 2020 2053 6369 7079 2066 696e         Scipy fin
-000200f0: 6420 7065 616b 2070 6172 616d 6574 6572  d peak parameter
-00020100: 7320 746f 2067 6574 2069 6e69 7469 616c  s to get initial
-00020110: 2066 6974 206f 6620 7065 616b 0a0a 0a0a   fit of peak....
-00020120: 0a20 2020 2020 2020 2066 6974 5f70 6561  .        fit_pea
-00020130: 6b73 2028 696e 7429 3a20 4465 6661 756c  ks (int): Defaul
-00020140: 7420 320a 2020 2020 2020 2020 2020 2020  t 2.            
-00020150: 4e75 6d62 6572 206f 6620 7065 616b 7320  Number of peaks 
-00020160: 746f 2066 6974 2e20 3220 3d20 4469 6164  to fit. 2 = Diad
-00020170: 202b 2048 422c 2031 203d 2044 6961 642e   + HB, 1 = Diad.
-00020180: 0a0a 2020 2020 2222 220a 0a20 2020 2023  ..    """..    #
-00020190: 204e 616d 6520 7468 6174 2067 6574 7320   Name that gets 
-000201a0: 7374 616d 7065 6420 6f6e 746f 2066 6974  stamped onto fit
-000201b0: 730a 2020 2020 6e61 6d65 3a20 7374 723d  s.    name: str=
-000201c0: 2027 6765 6e65 7269 6327 0a20 2020 2023   'generic'.    #
-000201d0: 2053 656c 6563 7469 6e67 2074 6865 2074   Selecting the t
-000201e0: 776f 2062 6163 6b67 726f 756e 6420 706f  wo background po
-000201f0: 7369 7469 6f6e 730a 2020 2020 6c6f 7765  sitions.    lowe
-00020200: 725f 6263 6b3a 2054 7570 6c65 5b66 6c6f  r_bck: Tuple[flo
-00020210: 6174 2c20 666c 6f61 745d 3d28 3130 3630  at, float]=(1060
-00020220: 2c20 3130 3635 290a 2020 2020 7570 7065  , 1065).    uppe
-00020230: 725f 6263 6b3a 2054 7570 6c65 5b66 6c6f  r_bck: Tuple[flo
-00020240: 6174 2c20 666c 6f61 745d 3d28 3131 3230  at, float]=(1120
-00020250: 2c20 3131 3330 290a 0a20 2020 2023 0a20  , 1130)..    #. 
-00020260: 2020 206d 6f64 656c 5f6e 616d 653a 2073     model_name: s
-00020270: 7472 3d27 5073 6575 646f 566f 6967 744d  tr='PseudoVoigtM
-00020280: 6f64 656c 270a 2020 2020 785f 7261 6e67  odel'.    x_rang
-00020290: 655f 6263 6b3a 2066 6c6f 6174 3d31 300a  e_bck: float=10.
-000202a0: 0a20 2020 2023 2042 6163 6b67 726f 756e  .    # Backgroun
-000202b0: 6420 6465 6772 6565 206f 6620 706f 6c79  d degree of poly
-000202c0: 6e6f 6d69 616c 0a20 2020 204e 5f70 6f6c  nomial.    N_pol
-000202d0: 795f 6361 7262 5f62 636b 3a20 666c 6f61  y_carb_bck: floa
-000202e0: 7420 3d31 0a20 2020 2023 2053 656c 6574  t =1.    # Selet
-000202f0: 6374 696e 6720 7468 6520 616d 706c 6974  cting the amplit
-00020300: 7564 650a 2020 2020 616d 706c 6974 7564  ude.    amplitud
-00020310: 653a 2066 6c6f 6174 203d 3130 3030 0a0a  e: float =1000..
-00020320: 2020 2020 2320 5365 6c65 6374 696e 6720      # Selecting 
-00020330: 7468 6520 7065 616b 2063 656e 7465 720a  the peak center.
-00020340: 2020 2020 6365 6e74 3a20 666c 6f61 7420      cent: float 
-00020350: 3d31 3039 300a 0a20 2020 2023 206f 7574  =1090..    # out
-00020360: 6c69 6572 2073 6967 6d61 2074 6f20 6469  lier sigma to di
-00020370: 7363 6172 6420 6261 636b 6772 6f75 6e64  scard background
-00020380: 2061 740a 2020 2020 6f75 746c 6965 725f   at.    outlier_
-00020390: 7369 676d 613a 2066 6c6f 6174 203d 3132  sigma: float =12
-000203a0: 0a0a 0a0a 2020 2020 2320 5061 7261 6d65  ....    # Parame
-000203b0: 7465 7273 2066 6f72 2053 6369 7079 2066  ters for Scipy f
-000203c0: 696e 6420 7065 616b 730a 2020 2020 6469  ind peaks.    di
-000203d0: 7374 616e 6365 3a20 666c 6f61 743d 3130  stance: float=10
-000203e0: 0a20 2020 2070 726f 6d69 6e65 6e63 653a  .    prominence:
-000203f0: 2066 6c6f 6174 3d35 0a20 2020 2077 6964   float=5.    wid
-00020400: 7468 3a20 666c 6f61 743d 360a 2020 2020  th: float=6.    
-00020410: 7468 7265 7368 6f6c 643a 2066 6c6f 6174  threshold: float
-00020420: 3d30 2e31 0a20 2020 2068 6569 6768 743a  =0.1.    height:
-00020430: 666c 6f61 7420 3d31 3030 0a0a 2020 2020  float =100..    
-00020440: 2320 4578 636c 7564 696e 6720 6120 7261  # Excluding a ra
-00020450: 6e67 6520 666f 7220 636f 736d 6963 2072  nge for cosmic r
-00020460: 6179 7320 6574 632e 0a20 2020 2065 7863  ays etc..    exc
-00020470: 6c75 6465 5f72 616e 6765 3a20 4f70 7469  lude_range: Opti
-00020480: 6f6e 616c 205b 5475 706c 655b 666c 6f61  onal [Tuple[floa
-00020490: 742c 2066 6c6f 6174 5d5d 3d4e 6f6e 650a  t, float]]=None.
-000204a0: 0a0a 2020 2020 2320 5265 7475 726e 206f  ..    # Return o
-000204b0: 7468 6572 2070 6172 616d 6574 6572 6573  ther parameteres
-000204c0: 2065 2e67 2e20 696e 7465 726d 6564 6961   e.g. intermedia
-000204d0: 7465 206f 7574 7075 7473 0a20 2020 2072  te outputs.    r
-000204e0: 6574 7572 6e5f 6f74 6865 725f 7061 7261  eturn_other_para
-000204f0: 6d73 3a20 626f 6f6c 203d 2046 616c 7365  ms: bool = False
-00020500: 0a0a 2020 2020 4e5f 7065 616b 733a 2069  ..    N_peaks: i
-00020510: 6e74 3d20 310a 0a20 2020 2069 6e74 5f63  nt= 1..    int_c
-00020520: 7574 5f6f 6666 3a20 666c 6f61 743d 302e  ut_off: float=0.
-00020530: 3035 0a0a 0a0a 0a0a 6465 6620 6669 745f  05......def fit_
-00020540: 6765 6e65 7269 635f 7065 616b 282a 2c20  generic_peak(*, 
-00020550: 636f 6e66 6967 3a20 6765 6e65 7269 635f  config: generic_
-00020560: 7065 616b 5f63 6f6e 6669 673d 6765 6e65  peak_config=gene
-00020570: 7269 635f 7065 616b 5f63 6f6e 6669 6728  ric_peak_config(
-00020580: 292c 0a70 6174 683d 4e6f 6e65 2c20 6669  ),.path=None, fi
-00020590: 6c65 6e61 6d65 3d4e 6f6e 652c 2066 696c  lename=None, fil
-000205a0: 6574 7970 653d 4e6f 6e65 2c0a 2070 6c6f  etype=None,. plo
-000205b0: 745f 6669 6775 7265 3d54 7275 652c 2064  t_figure=True, d
-000205c0: 7069 3d32 3030 293a 0a0a 2020 2020 2222  pi=200):..    ""
-000205d0: 2220 5468 6973 2066 756e 6374 696f 6e20  " This function 
-000205e0: 6669 7473 2061 2067 656e 6572 6963 2070  fits a generic p
-000205f0: 6561 6b20 7769 7468 2076 6172 696f 7573  eak with various
-00020600: 206f 7074 696f 6e73 0a0a 2020 2020 636f   options..    co
-00020610: 6e66 6967 3a20 6672 6f6d 2064 6174 6163  nfig: from datac
-00020620: 6c61 7373 2067 656e 6572 6963 5f70 6561  lass generic_pea
-00020630: 6b5f 636f 6e66 6967 0a0a 2020 2020 2020  k_config..      
-00020640: 2020 6d6f 6465 6c5f 6e61 6d65 3a20 7374    model_name: st
-00020650: 722c 2027 4761 7573 7369 616e 4d6f 6465  r, 'GaussianMode
-00020660: 6c27 2c20 2756 6f69 6774 4d6f 6465 6c27  l', 'VoigtModel'
-00020670: 2c20 2750 7365 7564 6f56 6f69 6774 4d6f  , 'PseudoVoigtMo
-00020680: 6465 6c27 2c20 2753 706c 696e 6527 2c20  del', 'Spline', 
-00020690: 2750 6f6c 7927 2c0a 2020 2020 2020 2020  'Poly',.        
-000206a0: 2020 2020 4669 7473 2047 6175 7373 6961      Fits Gaussia
-000206b0: 6e2c 2056 6f69 6774 2c20 6f72 2050 7365  n, Voigt, or Pse
-000206c0: 7564 6f56 6f69 6774 2c20 6f72 2066 6974  udoVoigt, or fit
-000206d0: 7320 6120 7370 6c69 6e65 206f 7220 706f  s a spline or po
-000206e0: 6c79 6e6f 6d61 696c 2061 6e64 2067 6574  lynomail and get
-000206f0: 7320 6172 6561 2075 6e64 6572 6e65 6174  s area underneat
-00020700: 680a 0a20 2020 2020 2020 206e 616d 653a  h..        name:
-00020710: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
-00020720: 204e 616d 6520 6f66 2066 6561 7475 7265   Name of feature
-00020730: 2079 6f75 2061 7265 2066 6974 7469 6e67   you are fitting
-00020740: 2e20 5573 6564 2074 6f20 6d61 6b65 2063  . Used to make c
-00020750: 6f6c 756d 6e20 6865 6164 696e 6773 2069  olumn headings i
-00020760: 6e20 6f75 7470 7574 2028 652e 672e 2c20  n output (e.g., 
-00020770: 6966 2053 4f32 2c20 6f75 7470 7574 7320  if SO2, outputs 
-00020780: 6172 6520 5065 616b 5f43 656e 745f 534f  are Peak_Cent_SO
-00020790: 322c 2050 6561 6b5f 4172 6561 5f53 4f32  2, Peak_Area_SO2
-000207a0: 290a 0a20 2020 2020 2020 2069 6e74 5f63  )..        int_c
-000207b0: 7574 5f6f 6666 3a20 666c 6f61 740a 2020  ut_off: float.  
-000207c0: 2020 2020 2020 2020 2020 6669 7473 2070            fits p
-000207d0: 6561 6b20 6f75 7420 746f 2069 6e74 5f63  eak out to int_c
-000207e0: 7574 5f6f 6666 2a20 7065 616b 2068 6569  ut_off* peak hei
-000207f0: 6768 742e 0a0a 2020 2020 2020 2020 6c6f  ght...        lo
-00020800: 7765 725f 626b 633a 2054 7570 6c65 5b66  wer_bkc: Tuple[f
-00020810: 6c6f 6174 2c20 666c 6f61 745d 0a20 2020  loat, float].   
-00020820: 2020 2020 2020 2020 2055 7070 6572 2061           Upper a
-00020830: 6e64 206c 6f77 6572 2078 2063 6f6f 7264  nd lower x coord
-00020840: 696e 6174 6520 666f 7220 6261 636b 6772  inate for backgr
-00020850: 6f75 6e64 2074 6f20 6c65 6674 206f 6620  ound to left of 
-00020860: 7065 616b 0a0a 2020 2020 2020 2020 7570  peak..        up
-00020870: 7065 725f 626b 633a 2054 7570 6c65 5b66  per_bkc: Tuple[f
-00020880: 6c6f 6174 2c20 666c 6f61 745d 0a20 2020  loat, float].   
-00020890: 2020 2020 2020 2020 2055 7070 6572 2061           Upper a
-000208a0: 6e64 206c 6f77 6572 2078 2063 6f6f 7264  nd lower x coord
-000208b0: 696e 6174 6520 666f 7220 6261 636b 6772  inate for backgr
-000208c0: 6f75 6e64 2074 6f20 7269 6768 7420 6f66  ound to right of
-000208d0: 2070 6561 6b0a 0a20 2020 2020 2020 2078   peak..        x
-000208e0: 5f72 616e 6765 5f62 636b 3a20 666c 6f61  _range_bck: floa
-000208f0: 740a 2020 2020 2020 2020 2020 2020 7365  t.            se
-00020900: 7473 2078 6c69 6d20 6f66 2066 6967 7572  ts xlim of figur
-00020910: 652c 2061 7320 7468 6520 7065 616b 2063  e, as the peak c
-00020920: 656e 7465 7220 2b20 785f 7261 6e67 655f  enter + x_range_
-00020930: 6263 6b2c 2061 6e64 2070 6561 6b20 6365  bck, and peak ce
-00020940: 6e74 202d 2078 5f72 616e 6765 5f62 636b  nt - x_range_bck
-00020950: 0a0a 2020 2020 2020 2020 4e5f 706f 6c79  ..        N_poly
-00020960: 5f63 6172 625f 6263 6b3a 2069 6e74 0a20  _carb_bck: int. 
-00020970: 2020 2020 2020 2020 2020 2044 6567 7265             Degre
-00020980: 6520 6f66 2070 6f6c 796e 6f6d 6961 6c20  e of polynomial 
-00020990: 746f 2066 6974 2074 6f20 7468 6520 6261  to fit to the ba
-000209a0: 636b 6772 6f75 6e64 2070 6f73 6974 696f  ckground positio
-000209b0: 6e73 0a0a 2020 2020 2020 2020 616d 706c  ns..        ampl
-000209c0: 6974 7564 653a 2066 6c6f 6174 0a20 2020  itude: float.   
-000209d0: 2020 2020 2020 2020 2041 7070 726f 7820           Approx 
-000209e0: 616d 706c 6974 7564 6520 6f66 2070 6561  amplitude of pea
-000209f0: 6b2e 0a0a 2020 2020 2020 2020 6365 6e74  k...        cent
-00020a00: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
-00020a10: 2020 2020 4170 7072 6f78 2063 656e 7420      Approx cent 
-00020a20: 6f66 2070 6561 6b0a 0a20 2020 2020 2020  of peak..       
-00020a30: 206f 7574 6c69 6572 5f73 6967 6d61 3a20   outlier_sigma: 
-00020a40: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
-00020a50: 2020 4469 7363 6172 6473 2070 6f69 6e74    Discards point
-00020a60: 7320 6f6e 2074 6865 2062 6163 6b67 726f  s on the backgro
-00020a70: 756e 6420 6f75 7473 6964 6520 6f75 746c  und outside outl
-00020a80: 6965 725f 7369 676d 6120 6f66 2074 6865  ier_sigma of the
-00020a90: 206d 6564 6961 6e20 7661 6c75 650a 0a20   median value.. 
-00020aa0: 2020 2020 2020 2064 6973 7461 6e63 652c         distance,
-00020ab0: 2070 726f 6d69 6e65 6e63 652c 2074 6872   prominence, thr
-00020ac0: 6573 686f 6c64 2c20 6865 6967 6874 3a20  eshold, height: 
-00020ad0: 666c 6f61 7473 0a20 2020 2020 2020 2020  floats.         
-00020ae0: 2020 2070 6172 616d 6574 6572 7320 666f     parameters fo
-00020af0: 7220 7363 6970 7920 6669 6e64 5f70 6561  r scipy find_pea
-00020b00: 6b73 0a0a 2020 2020 2020 2020 6578 636c  ks..        excl
-00020b10: 7564 655f 7261 6e67 653a 204f 7074 696f  ude_range: Optio
-00020b20: 6e61 6c20 5b54 7570 6c65 5b66 6c6f 6174  nal [Tuple[float
-00020b30: 2c20 666c 6f61 745d 5d0a 2020 2020 2020  , float]].      
-00020b40: 2020 2020 2020 4578 636c 7564 6573 2072        Excludes r
-00020b50: 6567 696f 6e20 6f66 2073 7065 6374 7261  egion of spectra
-00020b60: 2062 6574 7765 656e 2074 6865 7365 2076   between these v
-00020b70: 616c 7565 730a 0a20 2020 2020 2020 2064  alues..        d
-00020b80: 7069 3a20 666c 6f61 740a 2020 2020 2020  pi: float.      
-00020b90: 2020 2020 2020 6470 6920 746f 2073 6176        dpi to sav
-00020ba0: 6520 6669 6775 7265 2061 740a 0a20 2020  e figure at..   
-00020bb0: 2020 2020 2072 6574 7572 6e5f 6f74 6865       return_othe
-00020bc0: 725f 7061 7261 6d73 3a20 626f 6f6c 0a20  r_params: bool. 
-00020bd0: 2020 2020 2020 2020 2020 2069 6620 5472             if Tr
-00020be0: 7565 2c20 7265 7475 726e 7320 6f74 6865  ue, returns othe
-00020bf0: 7220 7065 616b 2066 6974 2070 6172 616d  r peak fit param
-00020c00: 6574 6572 7320 616e 6420 6669 7473 2028  eters and fits (
-00020c10: 6466 2c20 7878 5f63 6172 622c 2079 5f63  df, xx_carb, y_c
-00020c20: 6172 622c 2072 6573 756c 7430 292c 0a20  arb, result0),. 
-00020c30: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
-00020c40: 6a75 7374 2072 6574 7572 6e73 2064 6620  just returns df 
-00020c50: 6f66 2070 6561 6b20 706f 7369 7469 6f6e  of peak position
-00020c60: 732c 2068 6569 6768 7473 2065 7463 0a0a  s, heights etc..
-00020c70: 0a20 2020 2070 6174 683a 2073 7472 0a20  .    path: str. 
-00020c80: 2020 2020 2020 2050 6174 6820 746f 2066         Path to f
-00020c90: 696c 650a 0a20 2020 2066 696c 656e 616d  ile..    filenam
-00020ca0: 653a 2073 7472 0a20 2020 2020 2020 2066  e: str.        f
-00020cb0: 696c 656e 616d 6520 7769 7468 2066 696c  ilename with fil
-00020cc0: 6520 6578 7465 6e73 696f 6e0a 0a20 2020  e extension..   
-00020cd0: 2066 696c 6574 7970 653a 2073 7472 0a20   filetype: str. 
-00020ce0: 2020 2020 2020 2063 686f 6f73 6520 6672         choose fr
-00020cf0: 6f6d 2027 5769 7465 635f 4153 4349 4927  om 'Witec_ASCII'
-00020d00: 2c20 2768 6561 646c 6573 735f 7478 7427  , 'headless_txt'
-00020d10: 2c20 2768 6561 646c 6573 735f 6373 7627  , 'headless_csv'
-00020d20: 2c20 2768 6561 645f 6373 7627 2c20 2757  , 'head_csv', 'W
-00020d30: 6974 6563 5f41 5343 4949 272c 0a20 2020  itec_ASCII',.   
-00020d40: 2020 2020 2027 484f 5249 4241 5f74 7874       'HORIBA_txt
-00020d50: 272c 2027 5265 6e69 7368 6177 5f74 7874  ', 'Renishaw_txt
-00020d60: 270a 0a0a 2020 2020 706c 6f74 5f66 6967  '...    plot_fig
-00020d70: 7572 653a 2062 6f6f 6c0a 2020 2020 2020  ure: bool.      
-00020d80: 2020 4966 2074 7275 652c 2070 6c6f 7473    If true, plots
-00020d90: 2066 6967 7572 6520 616e 6420 7361 7665   figure and save
-00020da0: 7320 6974 2069 6e20 6120 7375 6266 6f6c  s it in a subfol
-00020db0: 6465 7220 696e 2074 6865 2073 616d 6520  der in the same 
-00020dc0: 6469 7265 6374 6f72 7920 6173 2074 6865  directory as the
-00020dd0: 2066 696c 6570 6174 6820 7370 6563 6966   filepath specif
-00020de0: 6965 640a 0a20 2020 2064 7069 3a20 696e  ied..    dpi: in
-00020df0: 740a 2020 2020 2020 2020 6470 6920 746f  t.        dpi to
-00020e00: 2073 6176 6520 6669 6775 7265 2061 740a   save figure at.
-00020e10: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
-00020e20: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020   -----------.   
-00020e30: 2064 6620 6f66 2070 6561 6b20 6669 7473   df of peak fits
-00020e40: 2c20 756e 6c65 7373 2072 6574 7572 6e5f  , unless return_
-00020e50: 6f74 6865 725f 7061 7261 6d73 2069 7320  other_params is 
-00020e60: 5472 7565 2c20 7468 656e 2061 6c73 6f20  True, then also 
-00020e70: 7265 7475 726e 7320 7820 616e 6420 7920  returns x and y 
-00020e80: 636f 6f72 6469 6e61 7465 206f 6620 6669  coordinate of fi
-00020e90: 742c 2061 6e64 2066 6974 2070 6172 616d  t, and fit param
-00020ea0: 730a 0a20 2020 2022 2222 0a0a 0a20 2020  s..    """...   
-00020eb0: 2053 7065 6374 7261 5f69 6e3d 6765 745f   Spectra_in=get_
-00020ec0: 6461 7461 2870 6174 683d 7061 7468 2c20  data(path=path, 
-00020ed0: 6669 6c65 6e61 6d65 3d66 696c 656e 616d  filename=filenam
-00020ee0: 652c 2066 696c 6574 7970 653d 6669 6c65  e, filetype=file
-00020ef0: 7479 7065 290a 0a20 2020 2069 6e74 5f63  type)..    int_c
-00020f00: 7574 5f6f 6666 3d63 6f6e 6669 672e 696e  ut_off=config.in
-00020f10: 745f 6375 745f 6f66 660a 2020 2020 6e61  t_cut_off.    na
-00020f20: 6d65 3d63 6f6e 6669 672e 6e61 6d65 0a0a  me=config.name..
-00020f30: 2020 2020 2320 4966 2065 7863 6c75 6465      # If exclude
-00020f40: 2072 616e 6765 2c20 7472 696d 2074 6861   range, trim tha
-00020f50: 7420 6865 7265 0a20 2020 2069 6620 636f  t here.    if co
-00020f60: 6e66 6967 2e65 7863 6c75 6465 5f72 616e  nfig.exclude_ran
-00020f70: 6765 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ge is not None:.
-00020f80: 2020 2020 2020 2020 2020 2020 5370 6563              Spec
-00020f90: 7472 613d 5370 6563 7472 615f 696e 5b20  tra=Spectra_in[ 
-00020fa0: 2853 7065 6374 7261 5f69 6e5b 3a2c 2030  (Spectra_in[:, 0
-00020fb0: 5d3c 636f 6e66 6967 2e65 7863 6c75 6465  ]<config.exclude
-00020fc0: 5f72 616e 6765 5b30 5d29 207c 2028 5370  _range[0]) | (Sp
-00020fd0: 6563 7472 615f 696e 5b3a 2c20 305d 3e63  ectra_in[:, 0]>c
-00020fe0: 6f6e 6669 672e 6578 636c 7564 655f 7261  onfig.exclude_ra
-00020ff0: 6e67 655b 315d 2920 5d0a 2020 2020 656c  nge[1]) ].    el
-00021000: 7365 3a0a 2020 2020 2020 2020 5370 6563  se:.        Spec
-00021010: 7472 613d 5370 6563 7472 615f 696e 0a0a  tra=Spectra_in..
-00021020: 0a0a 2020 2020 6c6f 7765 725f 3062 6173  ..    lower_0bas
-00021030: 656c 696e 653d 636f 6e66 6967 2e6c 6f77  eline=config.low
-00021040: 6572 5f62 636b 5b30 5d0a 2020 2020 7570  er_bck[0].    up
-00021050: 7065 725f 3062 6173 656c 696e 653d 636f  per_0baseline=co
-00021060: 6e66 6967 2e6c 6f77 6572 5f62 636b 5b31  nfig.lower_bck[1
-00021070: 5d0a 2020 2020 6c6f 7765 725f 3162 6173  ].    lower_1bas
-00021080: 656c 696e 653d 636f 6e66 6967 2e75 7070  eline=config.upp
-00021090: 6572 5f62 636b 5b30 5d0a 2020 2020 7570  er_bck[0].    up
-000210a0: 7065 725f 3162 6173 656c 696e 653d 636f  per_1baseline=co
-000210b0: 6e66 6967 2e75 7070 6572 5f62 636b 5b31  nfig.upper_bck[1
-000210c0: 5d0a 0a20 2020 2023 2046 696c 7465 7220  ]..    # Filter 
-000210d0: 6f75 7420 7370 6563 7472 6120 6f75 7473  out spectra outs
-000210e0: 6964 6520 7468 6573 6520 6261 7365 6c69  ide these baseli
-000210f0: 6e65 730a 2020 2020 5370 6563 7472 615f  nes.    Spectra_
-00021100: 7368 6f72 743d 5370 6563 7472 615b 2028  short=Spectra[ (
-00021110: 5370 6563 7472 615b 3a2c 305d 3e6c 6f77  Spectra[:,0]>low
-00021120: 6572 5f30 6261 7365 6c69 6e65 2920 2620  er_0baseline) & 
-00021130: 2853 7065 6374 7261 5b3a 2c30 5d3c 7570  (Spectra[:,0]<up
-00021140: 7065 725f 3162 6173 656c 696e 6529 205d  per_1baseline) ]
-00021150: 0a20 2020 2053 7065 6374 7261 5f66 6974  .    Spectra_fit
-00021160: 3d53 7065 6374 7261 5b20 2853 7065 6374  =Spectra[ (Spect
-00021170: 7261 5b3a 2c30 5d3e 7570 7065 725f 3062  ra[:,0]>upper_0b
-00021180: 6173 656c 696e 6529 2026 2028 5370 6563  aseline) & (Spec
-00021190: 7472 615b 3a2c 305d 3c6c 6f77 6572 5f31  tra[:,0]<lower_1
-000211a0: 6261 7365 6c69 6e65 2920 5d0a 0a20 2020  baseline) ]..   
-000211b0: 2023 2054 6f20 6d61 6b65 2061 206e 6963   # To make a nic
-000211c0: 6520 706c 6f74 2c20 6769 7665 2035 3020  e plot, give 50 
-000211d0: 7761 7665 6e75 6d62 6572 2075 6e69 7473  wavenumber units
-000211e0: 206f 6e20 6569 7468 6572 2073 6964 6520   on either side 
-000211f0: 6173 2061 2062 7566 6665 720a 2020 2020  as a buffer.    
-00021200: 5370 6563 7472 615f 706c 6f74 3d53 7065  Spectra_plot=Spe
-00021210: 6374 7261 5b20 2853 7065 6374 7261 5b3a  ctra[ (Spectra[:
-00021220: 2c30 5d3e 6c6f 7765 725f 3062 6173 656c  ,0]>lower_0basel
-00021230: 696e 652d 3530 2920 2620 2853 7065 6374  ine-50) & (Spect
-00021240: 7261 5b3a 2c30 5d3c 7570 7065 725f 3162  ra[:,0]<upper_1b
-00021250: 6173 656c 696e 652b 3530 2920 5d0a 0a20  aseline+50) ].. 
-00021260: 2020 2023 2023 2046 696e 6420 7065 616b     # # Find peak
-00021270: 7320 7573 696e 6720 5363 6970 7920 6669  s using Scipy fi
-00021280: 6e64 2070 6561 6b73 0a20 2020 2079 3d53  nd peaks.    y=S
-00021290: 7065 6374 7261 5f66 6974 5b3a 2c20 315d  pectra_fit[:, 1]
-000212a0: 0a20 2020 2078 3d53 7065 6374 7261 5f66  .    x=Spectra_f
-000212b0: 6974 5b3a 2c20 305d 0a20 2020 2073 7065  it[:, 0].    spe
-000212c0: 635f 7265 733d 6e70 2e61 6273 2878 5b30  c_res=np.abs(x[0
-000212d0: 5d2d 785b 315d 290a 2020 2020 230a 2020  ]-x[1]).    #.  
-000212e0: 2020 230a 2020 2020 2320 7065 616b 7320    #.    # peaks 
-000212f0: 3d20 6669 6e64 5f70 6561 6b73 2879 2c68  = find_peaks(y,h
-00021300: 6569 6768 7420 3d20 636f 6e66 6967 2e68  eight = config.h
-00021310: 6569 6768 742c 2074 6872 6573 686f 6c64  eight, threshold
-00021320: 203d 2063 6f6e 6669 672e 7468 7265 7368   = config.thresh
-00021330: 6f6c 642c 0a20 2020 2023 2064 6973 7461  old,.    # dista
-00021340: 6e63 6520 3d20 636f 6e66 6967 2e64 6973  nce = config.dis
-00021350: 7461 6e63 652c 2070 726f 6d69 6e65 6e63  tance, prominenc
-00021360: 653d 636f 6e66 6967 2e70 726f 6d69 6e65  e=config.promine
-00021370: 6e63 652c 2077 6964 7468 3d63 6f6e 6669  nce, width=confi
-00021380: 672e 7769 6474 6829 0a20 2020 2023 0a20  g.width).    #. 
-00021390: 2020 2023 2068 6569 6768 7420 3d20 7065     # height = pe
-000213a0: 616b 735b 315d 5b27 7065 616b 5f68 6569  aks[1]['peak_hei
-000213b0: 6768 7473 275d 2023 6c69 7374 206f 6620  ghts'] #list of 
-000213c0: 7468 6520 6865 6967 6874 7320 6f66 2074  the heights of t
-000213d0: 6865 2070 6561 6b73 0a20 2020 2023 2070  he peaks.    # p
-000213e0: 6561 6b5f 706f 7320 3d20 785b 7065 616b  eak_pos = x[peak
-000213f0: 735b 305d 5d20 236c 6973 7420 6f66 2074  s[0]] #list of t
-00021400: 6865 2070 6561 6b73 2070 6f73 6974 696f  he peaks positio
-00021410: 6e73 0a20 2020 2023 2064 665f 736f 7274  ns.    # df_sort
-00021420: 3d70 642e 4461 7461 4672 616d 6528 6461  =pd.DataFrame(da
-00021430: 7461 3d7b 2770 6f73 273a 2070 6561 6b5f  ta={'pos': peak_
-00021440: 706f 732c 0a20 2020 2023 2020 2020 2020  pos,.    #      
-00021450: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00021460: 6865 6967 6874 273a 2068 6569 6768 747d  height': height}
-00021470: 290a 2020 2020 230a 2020 2020 2320 6466  ).    #.    # df
-00021480: 5f70 6561 6b5f 736f 7274 3d64 665f 736f  _peak_sort=df_so
-00021490: 7274 2e73 6f72 745f 7661 6c75 6573 2827  rt.sort_values('
-000214a0: 6865 6967 6874 272c 2061 7869 733d 302c  height', axis=0,
-000214b0: 2061 7363 656e 6469 6e67 3d46 616c 7365   ascending=False
-000214c0: 290a 2020 2020 230a 2020 2020 2320 2320  ).    #.    # # 
-000214d0: 5472 696d 206e 756d 6265 7220 6f66 2070  Trim number of p
-000214e0: 6561 6b73 2062 6173 6564 206f 6e20 7573  eaks based on us
-000214f0: 6572 2d64 6566 696e 6564 204e 2070 6561  er-defined N pea
-00021500: 6b73 0a20 2020 2023 2064 665f 7065 616b  ks.    # df_peak
-00021510: 5f73 6f72 745f 7368 6f72 743d 6466 5f70  _sort_short=df_p
-00021520: 6561 6b5f 736f 7274 5b30 3a63 6f6e 6669  eak_sort[0:confi
-00021530: 672e 4e5f 7065 616b 735d 0a0a 0a20 2020  g.N_peaks]...   
-00021540: 2023 2047 6574 2061 6374 7561 6c20 6261   # Get actual ba
-00021550: 7365 6c69 6e65 0a20 2020 2042 6173 656c  seline.    Basel
-00021560: 696e 655f 7769 7468 5f6f 7574 6c3d 5370  ine_with_outl=Sp
-00021570: 6563 7472 615f 7368 6f72 745b 0a20 2020  ectra_short[.   
-00021580: 2028 2853 7065 6374 7261 5f73 686f 7274   ((Spectra_short
-00021590: 5b3a 2c20 305d 3c75 7070 6572 5f30 6261  [:, 0]<upper_0ba
-000215a0: 7365 6c69 6e65 2920 2628 5370 6563 7472  seline) &(Spectr
-000215b0: 615f 7368 6f72 745b 3a2c 2030 5d3e 6c6f  a_short[:, 0]>lo
-000215c0: 7765 725f 3062 6173 656c 696e 6529 290a  wer_0baseline)).
-000215d0: 2020 2020 2020 2020 7c0a 2020 2020 2828          |.    ((
-000215e0: 5370 6563 7472 615f 7368 6f72 745b 3a2c  Spectra_short[:,
-000215f0: 2030 5d3c 7570 7065 725f 3162 6173 656c   0]<upper_1basel
-00021600: 696e 6529 2026 2853 7065 6374 7261 5f73  ine) &(Spectra_s
-00021610: 686f 7274 5b3a 2c20 305d 3e6c 6f77 6572  hort[:, 0]>lower
-00021620: 5f31 6261 7365 6c69 6e65 2929 5d0a 0a20  _1baseline))].. 
-00021630: 2020 2023 2043 616c 6375 6c61 7465 7320     # Calculates 
-00021640: 7468 6520 4c48 2062 6173 656c 696e 650a  the LH baseline.
-00021650: 2020 2020 4c48 5f62 6173 656c 696e 653d      LH_baseline=
-00021660: 5370 6563 7472 615f 7368 6f72 745b 0a20  Spectra_short[. 
-00021670: 2020 2028 2853 7065 6374 7261 5f73 686f     ((Spectra_sho
-00021680: 7274 5b3a 2c20 305d 3c75 7070 6572 5f30  rt[:, 0]<upper_0
-00021690: 6261 7365 6c69 6e65 2920 2628 5370 6563  baseline) &(Spec
-000216a0: 7472 615f 7368 6f72 745b 3a2c 2030 5d3e  tra_short[:, 0]>
-000216b0: 6c6f 7765 725f 3062 6173 656c 696e 6529  lower_0baseline)
-000216c0: 295d 0a0a 2020 2020 4d65 616e 5f4c 485f  )]..    Mean_LH_
-000216d0: 6261 7365 6c69 6e65 3d6e 702e 6e61 6e6d  baseline=np.nanm
-000216e0: 6561 6e28 4c48 5f62 6173 656c 696e 655b  ean(LH_baseline[
-000216f0: 3a2c 2031 5d29 0a20 2020 2053 7464 5f4c  :, 1]).    Std_L
-00021700: 485f 6261 7365 6c69 6e65 3d6e 702e 6e61  H_baseline=np.na
-00021710: 6e73 7464 284c 485f 6261 7365 6c69 6e65  nstd(LH_baseline
-00021720: 5b3a 2c20 315d 290a 0a20 2020 2023 2043  [:, 1])..    # C
-00021730: 616c 6375 6c61 7465 7320 7468 6520 5248  alculates the RH
-00021740: 2062 6173 656c 696e 650a 2020 2020 5248   baseline.    RH
-00021750: 5f62 6173 656c 696e 653d 5370 6563 7472  _baseline=Spectr
-00021760: 615f 7368 6f72 745b 2828 5370 6563 7472  a_short[((Spectr
-00021770: 615f 7368 6f72 745b 3a2c 2030 5d3c 7570  a_short[:, 0]<up
-00021780: 7065 725f 3162 6173 656c 696e 6529 0a20  per_1baseline). 
-00021790: 2020 2026 2853 7065 6374 7261 5f73 686f     &(Spectra_sho
-000217a0: 7274 5b3a 2c20 305d 3e6c 6f77 6572 5f31  rt[:, 0]>lower_1
-000217b0: 6261 7365 6c69 6e65 2929 5d0a 2020 2020  baseline))].    
-000217c0: 4d65 616e 5f52 485f 6261 7365 6c69 6e65  Mean_RH_baseline
-000217d0: 3d6e 702e 6e61 6e6d 6561 6e28 5248 5f62  =np.nanmean(RH_b
-000217e0: 6173 656c 696e 655b 3a2c 2031 5d29 0a20  aseline[:, 1]). 
-000217f0: 2020 2053 7464 5f52 485f 6261 7365 6c69     Std_RH_baseli
-00021800: 6e65 3d6e 702e 6e61 6e73 7464 2852 485f  ne=np.nanstd(RH_
-00021810: 6261 7365 6c69 6e65 5b3a 2c20 315d 290a  baseline[:, 1]).
-00021820: 0a20 2020 2023 2052 656d 6f76 6573 2070  .    # Removes p
-00021830: 6f69 6e74 7320 6f75 7473 6964 6520 6261  oints outside ba
-00021840: 7365 6c69 6e65 0a0a 2020 2020 4c48 5f62  seline..    LH_b
-00021850: 6173 656c 696e 655f 6669 6c74 3d4c 485f  aseline_filt=LH_
-00021860: 6261 7365 6c69 6e65 5b28 4c48 5f62 6173  baseline[(LH_bas
-00021870: 656c 696e 655b 3a2c 2031 5d3c 4d65 616e  eline[:, 1]<Mean
-00021880: 5f4c 485f 6261 7365 6c69 6e65 2b63 6f6e  _LH_baseline+con
-00021890: 6669 672e 6f75 746c 6965 725f 7369 676d  fig.outlier_sigm
-000218a0: 612a 5374 645f 4c48 5f62 6173 656c 696e  a*Std_LH_baselin
-000218b0: 6529 0a20 2020 2026 284c 485f 6261 7365  e).    &(LH_base
-000218c0: 6c69 6e65 5b3a 2c20 315d 3e4d 6561 6e5f  line[:, 1]>Mean_
-000218d0: 4c48 5f62 6173 656c 696e 652d 636f 6e66  LH_baseline-conf
-000218e0: 6967 2e6f 7574 6c69 6572 5f73 6967 6d61  ig.outlier_sigma
-000218f0: 2a53 7464 5f4c 485f 6261 7365 6c69 6e65  *Std_LH_baseline
-00021900: 2920 5d0a 0a20 2020 2052 485f 6261 7365  ) ]..    RH_base
-00021910: 6c69 6e65 5f66 696c 743d 5248 5f62 6173  line_filt=RH_bas
-00021920: 656c 696e 655b 2852 485f 6261 7365 6c69  eline[(RH_baseli
-00021930: 6e65 5b3a 2c20 315d 3c4d 6561 6e5f 5248  ne[:, 1]<Mean_RH
-00021940: 5f62 6173 656c 696e 652b 636f 6e66 6967  _baseline+config
-00021950: 2e6f 7574 6c69 6572 5f73 6967 6d61 2a53  .outlier_sigma*S
-00021960: 7464 5f52 485f 6261 7365 6c69 6e65 290a  td_RH_baseline).
-00021970: 2020 2020 2628 5248 5f62 6173 656c 696e      &(RH_baselin
-00021980: 655b 3a2c 2031 5d3e 4d65 616e 5f52 485f  e[:, 1]>Mean_RH_
-00021990: 6261 7365 6c69 6e65 2d63 6f6e 6669 672e  baseline-config.
-000219a0: 6f75 746c 6965 725f 7369 676d 612a 5374  outlier_sigma*St
-000219b0: 645f 5248 5f62 6173 656c 696e 6529 205d  d_RH_baseline) ]
-000219c0: 0a0a 2020 2020 4261 7365 6c69 6e65 3d6e  ..    Baseline=n
-000219d0: 702e 636f 6e63 6174 656e 6174 6528 284c  p.concatenate((L
-000219e0: 485f 6261 7365 6c69 6e65 5f66 696c 742c  H_baseline_filt,
-000219f0: 2052 485f 6261 7365 6c69 6e65 5f66 696c   RH_baseline_fil
-00021a00: 7429 2c20 6178 6973 3d30 290a 0a0a 0a0a  t), axis=0).....
-00021a10: 0a20 2020 2023 2046 6974 7320 6120 706f  .    # Fits a po
-00021a20: 6c79 6e6f 6d69 616c 2074 6f20 7468 6520  lynomial to the 
-00021a30: 6261 7365 6c69 6e65 206f 6620 6465 6772  baseline of degr
-00021a40: 6565 0a20 2020 2050 665f 6261 7365 6c69  ee.    Pf_baseli
-00021a50: 6e65 203d 206e 702e 706f 6c79 3164 286e  ne = np.poly1d(n
-00021a60: 702e 706f 6c79 6669 7428 4261 7365 6c69  p.polyfit(Baseli
-00021a70: 6e65 5b3a 2c20 305d 2c20 4261 7365 6c69  ne[:, 0], Baseli
-00021a80: 6e65 5b3a 2c20 315d 2c20 636f 6e66 6967  ne[:, 1], config
-00021a90: 2e4e 5f70 6f6c 795f 6361 7262 5f62 636b  .N_poly_carb_bck
-00021aa0: 2929 0a20 2020 2050 795f 6261 7365 203d  )).    Py_base =
-00021ab0: 5066 5f62 6173 656c 696e 6528 5370 6563  Pf_baseline(Spec
-00021ac0: 7472 615f 7368 6f72 745b 3a2c 2030 5d29  tra_short[:, 0])
-00021ad0: 0a20 2020 2050 795f 6261 7365 5f66 6974  .    Py_base_fit
-00021ae0: 203d 5066 5f62 6173 656c 696e 6528 5370   =Pf_baseline(Sp
-00021af0: 6563 7472 615f 6669 745b 3a2c 2030 5d29  ectra_fit[:, 0])
-00021b00: 0a0a 0a0a 2020 2020 4261 7365 6c69 6e65  ....    Baseline
-00021b10: 5f79 7375 623d 5066 5f62 6173 656c 696e  _ysub=Pf_baselin
-00021b20: 6528 4261 7365 6c69 6e65 5b3a 2c20 305d  e(Baseline[:, 0]
-00021b30: 290a 2020 2020 4261 7365 6c69 6e65 5f78  ).    Baseline_x
-00021b40: 3d42 6173 656c 696e 655b 3a2c 2030 5d0a  =Baseline[:, 0].
-00021b50: 2020 2020 795f 636f 7272 3d20 5370 6563      y_corr= Spec
-00021b60: 7472 615f 7368 6f72 745b 3a2c 2031 5d2d  tra_short[:, 1]-
-00021b70: 5079 5f62 6173 650a 2020 2020 795f 636f  Py_base.    y_co
-00021b80: 7272 5f66 6974 3d53 7065 6374 7261 5f66  rr_fit=Spectra_f
-00021b90: 6974 5b3a 2c20 315d 2d50 795f 6261 7365  it[:, 1]-Py_base
-00021ba0: 5f66 6974 0a20 2020 2078 5f66 6974 3d53  _fit.    x_fit=S
-00021bb0: 7065 6374 7261 5f66 6974 5b3a 2c20 305d  pectra_fit[:, 0]
-00021bc0: 0a20 2020 2078 5f63 6f72 723d 5370 6563  .    x_corr=Spec
-00021bd0: 7472 615f 7368 6f72 745b 3a2c 2030 5d0a  tra_short[:, 0].
-00021be0: 0a0a 0a20 2020 2069 6620 636f 6e66 6967  ...    if config
-00021bf0: 2e6d 6f64 656c 5f6e 616d 6520 6e6f 7420  .model_name not 
-00021c00: 696e 205b 2747 6175 7373 6961 6e4d 6f64  in ['GaussianMod
-00021c10: 656c 272c 2027 566f 6967 744d 6f64 656c  el', 'VoigtModel
-00021c20: 272c 2027 5073 6575 646f 566f 6967 744d  ', 'PseudoVoigtM
-00021c30: 6f64 656c 272c 2027 5370 6c69 6e65 275d  odel', 'Spline']
-00021c40: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-00021c50: 5479 7065 4572 726f 7228 276d 6f64 656c  TypeError('model
-00021c60: 5f6e 616d 6520 6e6f 7420 6120 7065 726d  _name not a perm
-00021c70: 6974 7465 6420 696e 7075 742c 2050 6c65  itted input, Ple
-00021c80: 6173 6520 7365 6c65 6374 2065 6974 6865  ase select eithe
-00021c90: 7220 4761 7573 7369 616e 4d6f 6465 6c2c  r GaussianModel,
-00021ca0: 2056 6f69 6774 4d6f 6465 6c2c 2050 7365   VoigtModel, Pse
-00021cb0: 7564 6f56 6f69 6774 4d6f 6465 6c2c 206f  udoVoigtModel, o
-00021cc0: 7220 5370 6c69 6e65 2729 0a0a 0a20 2020  r Spline')...   
-00021cd0: 2069 6620 636f 6e66 6967 2e6d 6f64 656c   if config.model
-00021ce0: 5f6e 616d 6520 696e 205b 2747 6175 7373  _name in ['Gauss
-00021cf0: 6961 6e4d 6f64 656c 272c 2027 566f 6967  ianModel', 'Voig
-00021d00: 744d 6f64 656c 272c 2027 5073 6575 646f  tModel', 'Pseudo
-00021d10: 566f 6967 744d 6f64 656c 275d 3a0a 0a0a  VoigtModel']:...
-00021d20: 2020 2020 2020 2020 2320 4e4f 7720 696e          # NOw in
-00021d30: 746f 2074 6865 2076 6f69 6774 2066 6974  to the voigt fit
-00021d40: 7469 6e67 0a20 2020 2020 2020 2069 6620  ting.        if 
-00021d50: 636f 6e66 6967 2e6d 6f64 656c 5f6e 616d  config.model_nam
-00021d60: 653d 3d27 566f 6967 744d 6f64 656c 273a  e=='VoigtModel':
-00021d70: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-00021d80: 656c 3020 3d20 566f 6967 744d 6f64 656c  el0 = VoigtModel
-00021d90: 2829 232b 2043 6f6e 7374 616e 744d 6f64  ()#+ ConstantMod
-00021da0: 656c 2829 0a20 2020 2020 2020 2069 6620  el().        if 
-00021db0: 636f 6e66 6967 2e6d 6f64 656c 5f6e 616d  config.model_nam
-00021dc0: 6520 3d3d 2027 5073 6575 646f 566f 6967  e == 'PseudoVoig
-00021dd0: 744d 6f64 656c 273a 0a20 2020 2020 2020  tModel':.       
-00021de0: 2020 2020 206d 6f64 656c 3020 3d20 5073       model0 = Ps
-00021df0: 6575 646f 566f 6967 744d 6f64 656c 2829  eudoVoigtModel()
-00021e00: 0a20 2020 2020 2020 2069 6620 636f 6e66  .        if conf
-00021e10: 6967 2e6d 6f64 656c 5f6e 616d 653d 3d27  ig.model_name=='
-00021e20: 4761 7573 7369 616e 4d6f 6465 6c27 3a0a  GaussianModel':.
-00021e30: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-00021e40: 6c30 3d47 6175 7373 6961 6e4d 6f64 656c  l0=GaussianModel
-00021e50: 2829 0a0a 2020 2020 2020 2020 2320 6372  ()..        # cr
-00021e60: 6561 7465 2070 6172 616d 6574 6572 7320  eate parameters 
-00021e70: 7769 7468 2069 6e69 7469 616c 2076 616c  with initial val
-00021e80: 7565 730a 2020 2020 2020 2020 7061 7273  ues.        pars
-00021e90: 3020 3d20 6d6f 6465 6c30 2e6d 616b 655f  0 = model0.make_
-00021ea0: 7061 7261 6d73 2829 0a20 2020 2020 2020  params().       
-00021eb0: 2070 6172 7330 5b27 6365 6e74 6572 275d   pars0['center']
-00021ec0: 2e73 6574 2863 6f6e 6669 672e 6365 6e74  .set(config.cent
-00021ed0: 2c20 6d69 6e3d 636f 6e66 6967 2e63 656e  , min=config.cen
-00021ee0: 742d 3330 2c20 6d61 783d 636f 6e66 6967  t-30, max=config
-00021ef0: 2e63 656e 742b 3330 290a 2020 2020 2020  .cent+30).      
-00021f00: 2020 7061 7273 305b 2761 6d70 6c69 7475    pars0['amplitu
-00021f10: 6465 275d 2e73 6574 2863 6f6e 6669 672e  de'].set(config.
-00021f20: 616d 706c 6974 7564 652c 206d 696e 3d30  amplitude, min=0
-00021f30: 290a 0a0a 2020 2020 2020 2020 696e 6974  )...        init
-00021f40: 3020 3d20 6d6f 6465 6c30 2e65 7661 6c28  0 = model0.eval(
-00021f50: 7061 7273 302c 2078 3d78 290a 2020 2020  pars0, x=x).    
-00021f60: 2020 2020 7265 7375 6c74 3020 3d20 6d6f      result0 = mo
-00021f70: 6465 6c30 2e66 6974 2879 5f63 6f72 725f  del0.fit(y_corr_
-00021f80: 6669 742c 2070 6172 7330 2c20 783d 7829  fit, pars0, x=x)
-00021f90: 0a20 2020 2020 2020 2043 656e 7465 725f  .        Center_
-00021fa0: 7030 3d72 6573 756c 7430 2e62 6573 745f  p0=result0.best_
-00021fb0: 7661 6c75 6573 2e67 6574 2827 6365 6e74  values.get('cent
-00021fc0: 6572 2729 0a20 2020 2020 2020 2061 7265  er').        are
-00021fd0: 615f 7030 3d72 6573 756c 7430 2e62 6573  a_p0=result0.bes
-00021fe0: 745f 7661 6c75 6573 2e67 6574 2827 616d  t_values.get('am
-00021ff0: 706c 6974 7564 6527 290a 0a0a 0a20 2020  plitude')....   
-00022000: 2020 2020 2023 204d 616b 6520 6120 6e69       # Make a ni
-00022010: 6365 206c 696e 7370 6163 6520 666f 7220  ce linspace for 
-00022020: 706c 6f74 7469 6e67 2077 6974 6820 736d  plotting with sm
-00022030: 6f6f 7468 2063 7572 7665 732e 0a20 2020  ooth curves..   
-00022040: 2020 2020 2078 785f 6361 7262 3d6e 702e       xx_carb=np.
-00022050: 6c69 6e73 7061 6365 286d 696e 2878 292c  linspace(min(x),
-00022060: 206d 6178 2878 292c 2032 3030 3029 0a20   max(x), 2000). 
-00022070: 2020 2020 2020 2079 5f63 6172 623d 7265         y_carb=re
-00022080: 7375 6c74 302e 6576 616c 2878 3d78 785f  sult0.eval(x=xx_
-00022090: 6361 7262 290a 2020 2020 2020 2020 6865  carb).        he
-000220a0: 6967 6874 3d6e 702e 6d61 7828 795f 6361  ight=np.max(y_ca
-000220b0: 7262 290a 0a20 2020 2020 2020 2023 204d  rb)..        # M
-000220c0: 6f76 6564 2074 6869 7320 666f 726d 2064  oved this form d
-000220d0: 6f77 6e20 6265 6c6f 772c 2074 6869 6e6b  own below, think
-000220e0: 2069 7420 6265 6c6f 6e67 7320 6865 7265   it belongs here
-000220f0: 0a20 2020 2020 2020 2069 6620 6172 6561  .        if area
-00022100: 5f70 3020 6973 204e 6f6e 653a 0a20 2020  _p0 is None:.   
-00022110: 2020 2020 2020 2020 2061 7265 615f 7030           area_p0
-00022120: 3d6e 702e 6e61 6e0a 2020 2020 2020 2020  =np.nan.        
-00022130: 2020 2020 6966 2061 7265 615f 7030 2069      if area_p0 i
-00022140: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00022150: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00022160: 7265 615f 7030 3c30 3a0a 2020 2020 2020  rea_p0<0:.      
-00022170: 2020 2020 2020 2020 2020 2020 2020 6172                ar
-00022180: 6561 5f70 303d 6e70 2e6e 616e 0a0a 0a20  ea_p0=np.nan... 
-00022190: 2020 2020 2020 2064 663d 7064 2e44 6174         df=pd.Dat
-000221a0: 6146 7261 6d65 2864 6174 613d 7b27 6669  aFrame(data={'fi
-000221b0: 6c65 6e61 6d65 273a 2066 696c 656e 616d  lename': filenam
-000221c0: 652c 0a20 2020 2027 5065 616b 5f43 656e  e,.    'Peak_Cen
-000221d0: 745f 7b7d 272e 666f 726d 6174 286e 616d  t_{}'.format(nam
-000221e0: 6529 3a20 4365 6e74 6572 5f70 302c 0a20  e): Center_p0,. 
-000221f0: 2020 2027 5065 616b 5f41 7265 615f 7b7d     'Peak_Area_{}
-00022200: 272e 666f 726d 6174 286e 616d 6529 3a20  '.format(name): 
-00022210: 6172 6561 5f70 302c 0a20 2020 2027 5065  area_p0,.    'Pe
-00022220: 616b 5f48 6569 6768 745f 7b7d 272e 666f  ak_Height_{}'.fo
-00022230: 726d 6174 286e 616d 6529 3a20 6865 6967  rmat(name): heig
-00022240: 6874 2c0a 2020 2020 274d 6f64 656c 5f6e  ht,.    'Model_n
-00022250: 616d 6527 3a20 636f 6e66 6967 2e6d 6f64  ame': config.mod
-00022260: 656c 5f6e 616d 657d 2c20 696e 6465 783d  el_name}, index=
-00022270: 5b30 5d29 0a0a 2020 2020 656c 7365 3a0a  [0])..    else:.
-00022280: 0a20 2020 2020 2020 2069 6620 2063 6f6e  .        if  con
-00022290: 6669 672e 6d6f 6465 6c5f 6e61 6d65 203d  fig.model_name =
-000222a0: 3d20 2753 706c 696e 6527 3a0a 2020 2020  = 'Spline':.    
-000222b0: 2020 2020 2020 2020 6672 6f6d 2073 6369          from sci
-000222c0: 7079 2e69 6e74 6572 706f 6c61 7465 2069  py.interpolate i
-000222d0: 6d70 6f72 7420 4375 6269 6353 706c 696e  mport CubicSplin
-000222e0: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
-000222f0: 6669 7420 6120 7370 6c69 6e65 2066 6972  fit a spline fir
-00022300: 7374 2074 6f20 6669 6e64 2069 6e74 656e  st to find inten
-00022310: 7369 7479 2063 7574 206f 6666 0a20 2020  sity cut off.   
-00022320: 2020 2020 2020 2020 206d 6978 5f73 706c           mix_spl
-00022330: 696e 655f 7369 6c20 3d20 696e 7465 7270  ine_sil = interp
-00022340: 3164 2878 5f66 6974 2c20 795f 636f 7272  1d(x_fit, y_corr
-00022350: 5f66 6974 2c0a 2020 2020 2020 2020 2020  _fit,.          
-00022360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022370: 2020 2020 2020 2020 2020 6b69 6e64 3d27            kind='
-00022380: 6375 6269 6327 290a 0a0a 2020 2020 2020  cubic')...      
-00022390: 2020 2020 2020 785f 6e65 773d 6e70 2e6c        x_new=np.l
-000223a0: 696e 7370 6163 6528 6e70 2e6d 696e 2878  inspace(np.min(x
-000223b0: 5f66 6974 292c 206e 702e 6d61 7828 785f  _fit), np.max(x_
-000223c0: 6669 7429 2c20 3130 3030 290a 2020 2020  fit), 1000).    
-000223d0: 2020 2020 2020 2020 4261 7365 6c69 6e65          Baseline
-000223e0: 5f79 7375 625f 7369 6c3d 6d69 785f 7370  _ysub_sil=mix_sp
-000223f0: 6c69 6e65 5f73 696c 2878 5f6e 6577 290a  line_sil(x_new).
-00022400: 0a20 2020 2020 2020 2020 2020 2078 5f6d  .            x_m
-00022410: 6178 203d 2078 5f6e 6577 5b6e 702e 6172  ax = x_new[np.ar
-00022420: 676d 6178 2842 6173 656c 696e 655f 7973  gmax(Baseline_ys
-00022430: 7562 5f73 696c 295d 0a20 2020 2020 2020  ub_sil)].       
-00022440: 2020 2020 2063 656e 743d 785f 6d61 780a       cent=x_max.
-00022450: 2020 2020 2020 2020 2020 2020 5065 616b              Peak
-00022460: 5f43 656e 7465 723d 785f 6d61 780a 0a20  _Center=x_max.. 
-00022470: 2020 2020 2020 2020 2020 206d 6178 5f79             max_y
-00022480: 3d6e 702e 6d61 7828 795f 636f 7272 5f66  =np.max(y_corr_f
-00022490: 6974 290a 0a20 2020 2020 2020 2020 2020  it)..           
-000224a0: 2023 204c 6574 7320 7472 696d 2078 2061   # Lets trim x a
-000224b0: 6e64 2079 2062 6173 6564 206f 6e20 696e  nd y based on in
-000224c0: 7465 6e73 6974 7920 7661 6c75 6573 0a20  tensity values. 
-000224d0: 2020 2020 2020 2023 2046 696e 6420 696e         # Find in
-000224e0: 7465 6e73 6974 7920 6375 7420 6f66 660a  tensity cut off.
-000224f0: 0a20 2020 2020 2020 2020 2020 2079 5f69  .            y_i
-00022500: 6e74 5f63 7574 3d6d 6178 5f79 2a69 6e74  nt_cut=max_y*int
-00022510: 5f63 7574 5f6f 6666 0a0a 2020 2020 2020  _cut_off..      
-00022520: 2020 2020 2020 2320 4368 6563 6b20 7065        # Check pe
-00022530: 616b 2069 736e 7420 6174 2065 6467 6520  ak isnt at edge 
-00022540: 6f66 2077 696e 646f 772c 2065 6c73 6520  of window, else 
-00022550: 776f 6e74 2077 6f72 6b0a 0a20 2020 2020  wont work..     
-00022560: 2020 2020 2020 2069 6620 5065 616b 5f43         if Peak_C
-00022570: 656e 7465 723d 3d6e 702e 6d61 7828 785f  enter==np.max(x_
-00022580: 6669 7429 206f 7220 5065 616b 5f43 656e  fit) or Peak_Cen
-00022590: 7465 723d 3d6e 702e 6d69 6e28 785f 6669  ter==np.min(x_fi
-000225a0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-000225b0: 2020 2020 7072 696e 7428 2770 6561 6b20      print('peak 
-000225c0: 6174 2065 6467 6520 6f66 2077 696e 646f  at edge of windo
-000225d0: 772c 2073 6574 7469 6e67 2070 6172 616d  w, setting param
-000225e0: 7320 746f 206e 616e 7327 290a 0a0a 0a20  s to nans').... 
-000225f0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00022600: 663d 7064 2e44 6174 6146 7261 6d65 2864  f=pd.DataFrame(d
-00022610: 6174 613d 7b27 6669 6c65 6e61 6d65 273a  ata={'filename':
-00022620: 2066 696c 656e 616d 652c 0a20 2020 2020   filename,.     
-00022630: 2020 2020 2020 2027 5065 616b 5f43 656e         'Peak_Cen
-00022640: 745f 7b7d 272e 666f 726d 6174 286e 616d  t_{}'.format(nam
-00022650: 6529 3a20 6e70 2e6e 616e 2c0a 2020 2020  e): np.nan,.    
-00022660: 2020 2020 2020 2020 2750 6561 6b5f 4172          'Peak_Ar
-00022670: 6561 5f7b 7d27 2e66 6f72 6d61 7428 6e61  ea_{}'.format(na
-00022680: 6d65 293a 206e 702e 6e61 6e2c 0a20 2020  me): np.nan,.   
-00022690: 2020 2020 2020 2020 2027 5065 616b 5f48           'Peak_H
-000226a0: 6569 6768 745f 7b7d 272e 666f 726d 6174  eight_{}'.format
-000226b0: 286e 616d 6529 3a20 6e70 2e6e 616e 2c0a  (name): np.nan,.
-000226c0: 2020 2020 2020 2020 2020 2020 274d 6f64              'Mod
-000226d0: 656c 5f6e 616d 6527 3a20 636f 6e66 6967  el_name': config
-000226e0: 2e6d 6f64 656c 5f6e 616d 657d 2c20 696e  .model_name}, in
-000226f0: 6465 783d 5b30 5d29 0a0a 2020 2020 2020  dex=[0])..      
-00022700: 2020 2020 2020 656c 7365 3a0a 0a0a 0a20        else:.... 
-00022710: 2020 2020 2020 2020 2020 2023 2053 706c             # Spl
-00022720: 6974 2074 6865 2061 7272 6179 2069 6e74  it the array int
-00022730: 6f20 6120 4c48 5320 616e 6420 6120 5248  o a LHS and a RH
-00022740: 530a 0a20 2020 2020 2020 2020 2020 2020  S..             
-00022750: 2020 204c 4853 5f79 3d42 6173 656c 696e     LHS_y=Baselin
-00022760: 655f 7973 7562 5f73 696c 5b78 5f6e 6577  e_ysub_sil[x_new
-00022770: 3c50 6561 6b5f 4365 6e74 6572 5d20 2320  <Peak_Center] # 
-00022780: 5761 7320 6f72 6967 696e 616c 6c79 203c  Was originally <
-00022790: 3d0a 2020 2020 2020 2020 2020 2020 2020  =.              
-000227a0: 2020 5248 535f 793d 4261 7365 6c69 6e65    RHS_y=Baseline
-000227b0: 5f79 7375 625f 7369 6c5b 785f 6e65 773e  _ysub_sil[x_new>
-000227c0: 5065 616b 5f43 656e 7465 725d 0a0a 2020  Peak_Center]..  
-000227d0: 2020 2020 2020 2020 2020 2020 2020 4c48                LH
-000227e0: 535f 783d 785f 6e65 775b 785f 6e65 773c  S_x=x_new[x_new<
-000227f0: 5065 616b 5f43 656e 7465 725d 2023 2057  Peak_Center] # W
-00022800: 6173 206f 7269 6769 6e61 6c6c 7920 3c3d  as originally <=
-00022810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022820: 2052 4853 5f78 3d78 5f6e 6577 5b78 5f6e   RHS_x=x_new[x_n
-00022830: 6577 3e50 6561 6b5f 4365 6e74 6572 5d0a  ew>Peak_Center].
-00022840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022850: 2023 204e 6565 6420 746f 2066 6c69 7020   # Need to flip 
-00022860: 4c48 5320 746f 2070 7574 2069 6e74 6f20  LHS to put into 
-00022870: 7468 6520 6669 6e64 2063 6c6f 7365 7374  the find closest
-00022880: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
-00022890: 2020 2020 2020 2020 2020 4c48 535f 795f            LHS_y_
-000228a0: 666c 6970 3d6e 702e 666c 6970 284c 4853  flip=np.flip(LHS
-000228b0: 5f79 290a 2020 2020 2020 2020 2020 2020  _y).            
-000228c0: 2020 2020 4c48 535f 785f 666c 6970 3d6e      LHS_x_flip=n
-000228d0: 702e 666c 6970 284c 4853 5f78 290a 0a0a  p.flip(LHS_x)...
-000228e0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000228f0: 2020 7661 6c3d 6e70 2e61 7267 6d61 7828    val=np.argmax(
-00022900: 4c48 535f 795f 666c 6970 3c79 5f69 6e74  LHS_y_flip<y_int
-00022910: 5f63 7574 290a 2020 2020 2020 2020 2020  _cut).          
-00022920: 2020 2020 2020 6966 2076 616c 203d 3d20        if val == 
-00022930: 3020 616e 6420 6e6f 7420 284c 4853 5f79  0 and not (LHS_y
-00022940: 5f66 6c69 705b 305d 203c 2079 5f69 6e74  _flip[0] < y_int
-00022950: 5f63 7574 293a 0a20 2020 2020 2020 2020  _cut):.         
-00022960: 2020 2020 2020 2020 2020 2076 616c 203d             val =
-00022970: 206e 702e 6172 676d 696e 284c 4853 5f79   np.argmin(LHS_y
-00022980: 5f66 6c69 7029 0a0a 2020 2020 2020 2020  _flip)..        
-00022990: 2020 2020 2020 2020 7661 6c32 3d6e 702e          val2=np.
-000229a0: 6172 676d 6178 2852 4853 5f79 3c79 5f69  argmax(RHS_y<y_i
-000229b0: 6e74 5f63 7574 290a 2020 2020 2020 2020  nt_cut).        
-000229c0: 2020 2020 2020 2020 6966 2076 616c 3220          if val2 
-000229d0: 3d3d 2030 2061 6e64 206e 6f74 2028 5248  == 0 and not (RH
-000229e0: 535f 795b 305d 203c 2079 5f69 6e74 5f63  S_y[0] < y_int_c
-000229f0: 7574 293a 0a20 2020 2020 2020 2020 2020  ut):.           
-00022a00: 2020 2020 2020 2020 2076 616c 3220 3d20           val2 = 
-00022a10: 6e70 2e61 7267 6d69 6e28 5248 535f 7929  np.argmin(RHS_y)
-00022a20: 0a0a 0a0a 2020 2020 2020 2020 2020 2020  ....            
-00022a30: 2020 2020 2320 4669 6e64 206e 6561 7265      # Find neare
-00022a40: 7374 2078 2075 6e69 7420 746f 2074 6869  st x unit to thi
-00022a50: 7320 7661 6c75 650a 2020 2020 2020 2020  s value.        
-00022a60: 2020 2020 2020 2020 795f 6e65 6172 6573          y_neares
-00022a70: 745f 4c48 533d 4c48 535f 795f 666c 6970  t_LHS=LHS_y_flip
-00022a80: 5b76 616c 5d0a 2020 2020 2020 2020 2020  [val].          
-00022a90: 2020 2020 2020 785f 6e65 6172 6573 745f        x_nearest_
-00022aa0: 4c48 533d 4c48 535f 785f 666c 6970 5b76  LHS=LHS_x_flip[v
-00022ab0: 616c 5d0a 0a20 2020 2020 2020 2020 2020  al]..           
-00022ac0: 2020 2020 2079 5f6e 6561 7265 7374 5f52       y_nearest_R
-00022ad0: 4853 3d52 4853 5f79 5b76 616c 325d 0a20  HS=RHS_y[val2]. 
-00022ae0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-00022af0: 5f6e 6561 7265 7374 5f52 4853 3d52 4853  _nearest_RHS=RHS
-00022b00: 5f78 5b76 616c 325d 0a0a 0a0a 0a20 2020  _x[val2].....   
-00022b10: 2020 2020 2020 2020 2020 2020 2064 6966               dif
-00022b20: 665f 4c48 533d 5065 616b 5f43 656e 7465  f_LHS=Peak_Cente
-00022b30: 722d 785f 6e65 6172 6573 745f 4c48 530a  r-x_nearest_LHS.
-00022b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022b50: 6469 6666 5f52 4853 3d78 5f6e 6561 7265  diff_RHS=x_neare
-00022b60: 7374 5f52 4853 2d50 6561 6b5f 4365 6e74  st_RHS-Peak_Cent
-00022b70: 6572 0a0a 0a0a 2020 2020 2020 2020 2020  er....          
-00022b80: 2020 2020 2020 6e5f 7265 733d 300a 0a0a        n_res=0...
-00022b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022ba0: 785f 6e65 775f 736b 6577 6e65 7373 3d6e  x_new_skewness=n
-00022bb0: 702e 6c69 6e73 7061 6365 2878 5f6e 6561  p.linspace(x_nea
-00022bc0: 7265 7374 5f4c 4853 2d73 7065 635f 7265  rest_LHS-spec_re
-00022bd0: 732a 6e5f 7265 732c 2078 5f6e 6561 7265  s*n_res, x_neare
-00022be0: 7374 5f52 4853 2b73 7065 635f 7265 732a  st_RHS+spec_res*
-00022bf0: 6e5f 7265 7329 0a0a 0a20 2020 2020 2020  n_res)...       
-00022c00: 2020 2020 2020 2020 2078 5f6e 6577 3d78           x_new=x
-00022c10: 5f6e 6577 5f73 6b65 776e 6573 730a 0a0a  _new_skewness...
-00022c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022c30: 4261 7365 6c69 6e65 5f79 7375 625f 7369  Baseline_ysub_si
-00022c40: 6c3d 6d69 785f 7370 6c69 6e65 5f73 696c  l=mix_spline_sil
-00022c50: 2878 5f6e 6577 5f73 6b65 776e 6573 7329  (x_new_skewness)
-00022c60: 0a0a 0a0a 0a0a 0a20 2020 2020 2020 2020  .......         
-00022c70: 2020 2020 2020 204e 5f70 6f6c 795f 7369         N_poly_si
-00022c80: 6c3d 2753 706c 696e 6527 0a0a 0a20 2020  l='Spline'...   
-00022c90: 2020 2020 2020 2020 2020 2020 2078 7370               xsp
-00022ca0: 6163 655f 7369 6c3d 785f 6e65 775b 315d  ace_sil=x_new[1]
-00022cb0: 2d78 5f6e 6577 5b30 5d0a 2020 2020 2020  -x_new[0].      
-00022cc0: 2020 2020 2020 2020 2020 6172 6561 5f74            area_t
-00022cd0: 7261 7020 3d20 7472 6170 7a28 4261 7365  rap = trapz(Base
-00022ce0: 6c69 6e65 5f79 7375 625f 7369 6c2c 2064  line_ysub_sil, d
-00022cf0: 783d 7873 7061 6365 5f73 696c 290a 2020  x=xspace_sil).  
-00022d00: 2020 2020 2020 2020 2020 2020 2020 6172                ar
-00022d10: 6561 5f73 696d 7073 203d 2073 696d 7073  ea_simps = simps
-00022d20: 2842 6173 656c 696e 655f 7973 7562 5f73  (Baseline_ysub_s
-00022d30: 696c 2c20 6478 3d78 7370 6163 655f 7369  il, dx=xspace_si
-00022d40: 6c29 0a0a 0a0a 2020 2020 2020 2020 2020  l)....          
-00022d50: 2020 2020 2020 6172 6561 5f70 303d 6172        area_p0=ar
-00022d60: 6561 5f74 7261 700a 0a0a 0a0a 2020 2020  ea_trap.....    
-00022d70: 2020 2020 2020 2020 2020 2020 6466 3d70              df=p
-00022d80: 642e 4461 7461 4672 616d 6528 6461 7461  d.DataFrame(data
-00022d90: 3d7b 2766 696c 656e 616d 6527 3a20 6669  ={'filename': fi
-00022da0: 6c65 6e61 6d65 2c0a 2020 2020 2020 2020  lename,.        
-00022db0: 2020 2020 2750 6561 6b5f 4365 6e74 5f7b      'Peak_Cent_{
-00022dc0: 7d27 2e66 6f72 6d61 7428 6e61 6d65 293a  }'.format(name):
-00022dd0: 2078 5f6d 6178 2c0a 2020 2020 2020 2020   x_max,.        
-00022de0: 2020 2020 2750 6561 6b5f 4172 6561 5f7b      'Peak_Area_{
-00022df0: 7d27 2e66 6f72 6d61 7428 6e61 6d65 293a  }'.format(name):
-00022e00: 2061 7265 615f 7030 2c0a 2020 2020 2020   area_p0,.      
-00022e10: 2020 2020 2020 2750 6561 6b5f 4865 6967        'Peak_Heig
-00022e20: 6874 5f7b 7d27 2e66 6f72 6d61 7428 6e61  ht_{}'.format(na
-00022e30: 6d65 293a 206d 6178 5f79 2c0a 2020 2020  me): max_y,.    
-00022e40: 2020 2020 2020 2020 274d 6f64 656c 5f6e          'Model_n
-00022e50: 616d 6527 3a20 636f 6e66 6967 2e6d 6f64  ame': config.mod
-00022e60: 656c 5f6e 616d 657d 2c20 696e 6465 783d  el_name}, index=
-00022e70: 5b30 5d29 0a0a 0a0a 0a0a 0a20 2020 2023  [0]).......    #
-00022e80: 2050 6c6f 7474 696e 6720 7768 6174 2069   Plotting what i
-00022e90: 7473 2064 6f69 6e67 0a0a 2020 2020 6966  ts doing..    if
-00022ea0: 2070 6c6f 745f 6669 6775 7265 2069 7320   plot_figure is 
-00022eb0: 5472 7565 3a0a 2020 2020 2020 2020 6669  True:.        fi
-00022ec0: 672c 2028 6178 312c 2061 7832 2920 3d20  g, (ax1, ax2) = 
-00022ed0: 706c 742e 7375 6270 6c6f 7473 2831 2c20  plt.subplots(1, 
-00022ee0: 322c 2066 6967 7369 7a65 3d28 3130 2c35  2, figsize=(10,5
-00022ef0: 2929 0a20 2020 2020 2020 2066 6967 2e73  )).        fig.s
-00022f00: 7570 7469 746c 6528 2753 6563 6f6e 6461  uptitle('Seconda
-00022f10: 7279 2050 6861 7365 2c20 6669 6c65 3d20  ry Phase, file= 
-00022f20: 272b 2073 7472 2866 696c 656e 616d 6529  '+ str(filename)
-00022f30: 2c20 666f 6e74 7369 7a65 3d31 322c 2078  , fontsize=12, x
-00022f40: 3d30 2e35 2c20 793d 312e 3029 0a0a 2020  =0.5, y=1.0)..  
-00022f50: 2020 2020 2020 2320 506c 6f74 2074 6865        # Plot the
-00022f60: 2070 6561 6b20 706f 7369 7469 6f6e 7320   peak positions 
-00022f70: 616e 6420 6865 6967 6874 730a 0a0a 0a20  and heights.... 
-00022f80: 2020 2020 2020 2061 7831 2e73 6574 5f74         ax1.set_t
-00022f90: 6974 6c65 2827 4261 636b 6772 6f75 6e64  itle('Background
-00022fa0: 2066 6974 2729 0a0a 2020 2020 2020 2020   fit')..        
-00022fb0: 6178 312e 706c 6f74 2853 7065 6374 7261  ax1.plot(Spectra
-00022fc0: 5f70 6c6f 745b 3a2c 2030 5d2c 2053 7065  _plot[:, 0], Spe
-00022fd0: 6374 7261 5f70 6c6f 745b 3a2c 2031 5d2c  ctra_plot[:, 1],
-00022fe0: 2027 2d72 272c 206c 6162 656c 3d27 5370   '-r', label='Sp
-00022ff0: 6563 7472 6127 290a 2020 2020 2020 2020  ectra').        
-00023000: 6178 312e 706c 6f74 2852 485f 6261 7365  ax1.plot(RH_base
-00023010: 6c69 6e65 5f66 696c 745b 3a2c 2030 5d2c  line_filt[:, 0],
-00023020: 2052 485f 6261 7365 6c69 6e65 5f66 696c   RH_baseline_fil
-00023030: 745b 3a2c 2031 5d2c 2027 2e62 272c 0a20  t[:, 1], '.b',. 
-00023040: 2020 2020 2020 206c 6162 656c 3d27 6263         label='bc
-00023050: 6b20 706f 696e 7473 2729 0a20 2020 2020  k points').     
-00023060: 2020 2061 7831 2e70 6c6f 7428 4c48 5f62     ax1.plot(LH_b
-00023070: 6173 656c 696e 655f 6669 6c74 5b3a 2c20  aseline_filt[:, 
-00023080: 305d 2c20 4c48 5f62 6173 656c 696e 655f  0], LH_baseline_
-00023090: 6669 6c74 5b3a 2c20 315d 2c20 272d 6227  filt[:, 1], '-b'
-000230a0: 2c0a 2020 2020 2020 2020 6c77 3d33 2c20  ,.        lw=3, 
-000230b0: 6c61 6265 6c3d 275f 6263 6b20 706f 696e  label='_bck poin
-000230c0: 7473 2729 0a0a 2020 2020 2020 2020 2361  ts')..        #a
-000230d0: 7832 2e70 6c6f 7428 782c 2079 5f63 6f72  x2.plot(x, y_cor
-000230e0: 725f 6669 742c 2027 2d72 272c 206c 6162  r_fit, '-r', lab
-000230f0: 656c 3d27 4263 6b2d 7375 6220 6461 7461  el='Bck-sub data
-00023100: 272c 206c 773d 302e 3529 0a20 2020 2020  ', lw=0.5).     
-00023110: 2020 2061 7832 2e70 6c6f 7428 782c 2079     ax2.plot(x, y
-00023120: 5f63 6f72 725f 6669 742c 2027 2e72 272c  _corr_fit, '.r',
-00023130: 206c 6162 656c 3d27 4263 6b2d 7375 6220   label='Bck-sub 
-00023140: 6461 7461 2729 0a20 2020 2020 2020 2061  data').        a
-00023150: 7831 2e70 6c6f 7428 5370 6563 7472 615f  x1.plot(Spectra_
-00023160: 7368 6f72 745b 3a2c 2030 5d2c 2050 795f  short[:, 0], Py_
-00023170: 6261 7365 2c20 272d 6b27 2c20 6c61 6265  base, '-k', labe
-00023180: 6c3d 2742 636b 2050 6f6c 7927 290a 0a0a  l='Bck Poly')...
-00023190: 2020 2020 2020 2020 6966 2063 6f6e 6669          if confi
-000231a0: 672e 6d6f 6465 6c5f 6e61 6d65 2021 3d20  g.model_name != 
-000231b0: 2753 706c 696e 6527 2061 6e64 2063 6f6e  'Spline' and con
-000231c0: 6669 672e 6d6f 6465 6c5f 6e61 6d65 2021  fig.model_name !
-000231d0: 3d20 2750 6f6c 7927 3a0a 2020 2020 2020  = 'Poly':.      
-000231e0: 2020 2020 2020 6178 322e 706c 6f74 2878        ax2.plot(x
-000231f0: 785f 6361 7262 2c20 795f 6361 7262 2c20  x_carb, y_carb, 
-00023200: 272d 6b27 2c20 6c61 6265 6c3d 2750 6561  '-k', label='Pea
-00023210: 6b20 6669 7427 290a 0a0a 2020 2020 2020  k fit')...      
-00023220: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00023230: 2020 2020 6178 322e 706c 6f74 2878 5f6e      ax2.plot(x_n
-00023240: 6577 2c20 4261 7365 6c69 6e65 5f79 7375  ew, Baseline_ysu
-00023250: 625f 7369 6c2c 2027 2d6b 2729 0a20 2020  b_sil, '-k').   
-00023260: 2020 2020 2020 2020 2061 7832 2e66 696c           ax2.fil
-00023270: 6c5f 6265 7477 6565 6e28 785f 6e65 772c  l_between(x_new,
-00023280: 2042 6173 656c 696e 655f 7973 7562 5f73   Baseline_ysub_s
-00023290: 696c 2c20 636f 6c6f 723d 2779 656c 6c6f  il, color='yello
-000232a0: 7727 2c20 6c61 6265 6c3d 2766 6974 2061  w', label='fit a
-000232b0: 7265 6127 2c20 616c 7068 613d 302e 3529  rea', alpha=0.5)
-000232c0: 0a0a 0a20 2020 2020 2020 2063 656e 743d  ...        cent=
-000232d0: 6466 5b27 5065 616b 5f43 656e 745f 7b7d  df['Peak_Cent_{}
-000232e0: 272e 666f 726d 6174 286e 616d 6529 5d2e  '.format(name)].
-000232f0: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
-00023300: 6178 322e 7365 745f 786c 696d 285b 6365  ax2.set_xlim([ce
-00023310: 6e74 2d63 6f6e 6669 672e 785f 7261 6e67  nt-config.x_rang
-00023320: 655f 6263 6b2c 2063 656e 742b 636f 6e66  e_bck, cent+conf
-00023330: 6967 2e78 5f72 616e 6765 5f62 636b 5d29  ig.x_range_bck])
-00023340: 0a0a 2020 2020 2020 2020 6178 322e 7365  ..        ax2.se
-00023350: 745f 7469 746c 6528 2742 6b67 2d73 7562  t_title('Bkg-sub
-00023360: 7472 6163 7465 642c 2027 202b 206e 616d  tracted, ' + nam
-00023370: 6520 2b20 2720 7065 616b 2066 6974 2729  e + ' peak fit')
-00023380: 0a0a 0a20 2020 2020 2020 2061 7831 2e73  ...        ax1.s
-00023390: 6574 5f79 6c61 6265 6c28 2749 6e74 656e  et_ylabel('Inten
-000233a0: 7369 7479 2729 0a20 2020 2020 2020 2061  sity').        a
-000233b0: 7831 2e73 6574 5f78 6c61 6265 6c28 2757  x1.set_xlabel('W
-000233c0: 6176 656e 756d 6265 7220 2863 6d24 5e7b  avenumber (cm$^{
-000233d0: 2d31 7d24 2927 290a 2020 2020 2020 2020  -1}$)').        
-000233e0: 6178 322e 7365 745f 796c 6162 656c 2827  ax2.set_ylabel('
-000233f0: 4263 6b2d 636f 7272 6563 7465 6420 496e  Bck-corrected In
-00023400: 7465 6e73 6974 7927 290a 2020 2020 2020  tensity').      
-00023410: 2020 6178 322e 7365 745f 786c 6162 656c    ax2.set_xlabel
-00023420: 2827 5761 7665 6e75 6d62 6572 2028 636d  ('Wavenumber (cm
-00023430: 245e 7b2d 317d 2429 2729 0a0a 2020 2020  $^{-1}$)')..    
-00023440: 2020 2020 6178 312e 6c65 6765 6e64 2829      ax1.legend()
-00023450: 0a20 2020 2020 2020 2061 7832 2e6c 6567  .        ax2.leg
-00023460: 656e 6428 290a 0a20 2020 2020 2020 2061  end()..        a
-00023470: 7831 2e73 6574 5f79 6c69 6d28 5b0a 2020  x1.set_ylim([.  
-00023480: 2020 2020 2020 6e70 2e6d 696e 2853 7065        np.min(Spe
-00023490: 6374 7261 5f70 6c6f 745b 3a2c 2031 5d29  ctra_plot[:, 1])
-000234a0: 2d35 302c 0a20 2020 2020 2020 206e 702e  -50,.        np.
-000234b0: 6d61 7828 5370 6563 7472 615f 706c 6f74  max(Spectra_plot
-000234c0: 5b3a 2c20 315d 292b 3530 0a20 2020 2020  [:, 1])+50.     
-000234d0: 2020 205d 290a 0a0a 0a0a 0a0a 2020 2020     ]).......    
-000234e0: 2020 2020 6669 6c65 3d66 696c 656e 616d      file=filenam
-000234f0: 652e 7273 706c 6974 2827 2e74 7874 272c  e.rsplit('.txt',
-00023500: 2031 295b 305d 0a20 2020 2020 2020 2069   1)[0].        i
-00023510: 6620 706c 6f74 5f66 6967 7572 6520 6973  f plot_figure is
-00023520: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
-00023530: 2020 2070 6174 6833 3d70 6174 682b 272f     path3=path+'/
-00023540: 272b 2753 6563 6f6e 6461 7279 5f66 6974  '+'Secondary_fit
-00023550: 5f49 6d61 6765 7327 0a0a 2020 2020 2020  _Images'..      
-00023560: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-00023570: 2e65 7869 7374 7328 7061 7468 3329 3a0a  .exists(path3):.
-00023580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023590: 6f75 743d 2770 6174 6820 6578 6973 7473  out='path exists
-000235a0: 270a 2020 2020 2020 2020 2020 2020 656c  '.            el
-000235b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000235c0: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
-000235d0: 7061 7468 332c 2065 7869 7374 5f6f 6b3d  path3, exist_ok=
-000235e0: 4661 6c73 6529 0a0a 2020 2020 2020 2020  False)..        
-000235f0: 2020 2020 6669 6c65 3d66 696c 656e 616d      file=filenam
-00023600: 652e 7273 706c 6974 2827 2e74 7874 272c  e.rsplit('.txt',
-00023610: 2031 295b 305d 0a20 2020 2020 2020 2020   1)[0].         
-00023620: 2020 2066 6967 2e73 6176 6566 6967 2870     fig.savefig(p
-00023630: 6174 6833 2b27 2f27 2b20 6e61 6d65 202b  ath3+'/'+ name +
-00023640: 275f 4669 745f 7b7d 2e70 6e67 272e 666f  '_Fit_{}.png'.fo
-00023650: 726d 6174 2866 696c 6529 2c20 6470 693d  rmat(file), dpi=
-00023660: 6470 6929 0a0a 0a0a 2020 2020 6966 2063  dpi)....    if c
-00023670: 6f6e 6669 672e 7265 7475 726e 5f6f 7468  onfig.return_oth
-00023680: 6572 5f70 6172 616d 7320 6973 2054 7275  er_params is Tru
-00023690: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
-000236a0: 6e20 6466 2c20 7878 5f63 6172 622c 2079  n df, xx_carb, y
-000236b0: 5f63 6172 622c 2072 6573 756c 7430 0a20  _carb, result0. 
-000236c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000236d0: 2072 6574 7572 6e20 6466 0a0a 6465 6620   return df..def 
-000236e0: 7065 616b 5f70 726f 6d69 6e65 6e63 6528  peak_prominence(
-000236f0: 782c 2079 2c20 7065 616b 5f70 6f73 6974  x, y, peak_posit
-00023700: 696f 6e29 3a0a 2020 2020 2222 2220 5468  ion):.    """ Th
-00023710: 6973 2066 756e 6374 696f 6e20 6361 6c63  is function calc
-00023720: 756c 6174 6573 2074 6865 2061 7070 726f  ulates the appro
-00023730: 7869 6d61 7465 2070 726f 6d69 6e65 6e63  ximate prominenc
-00023740: 6520 6f66 2061 2070 6561 6b2c 0a20 2020  e of a peak,.   
-00023750: 2062 7920 6669 6e64 696e 6720 7468 6520   by finding the 
-00023760: 6c6f 6361 6c20 6d69 6e69 6d75 6d20 6569  local minimum ei
-00023770: 7468 6572 2073 6964 6520 6f66 2074 6865  ther side of the
-00023780: 2070 6561 6b0a 0a20 2020 2050 6172 616d   peak..    Param
-00023790: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-000237a0: 2d2d 2d2d 0a20 2020 2078 3a20 6e70 2e61  ----.    x: np.a
-000237b0: 7272 6179 0a20 2020 2020 2020 2078 2063  rray.        x c
-000237c0: 6f6f 7264 696e 6174 6573 2028 7761 7665  oordinates (wave
-000237d0: 6e75 6d62 6572 290a 2020 2020 793a 206e  number).    y: n
-000237e0: 702e 6172 7261 790a 2020 2020 2020 2020  p.array.        
-000237f0: 7920 636f 6f72 6469 6e61 7465 7320 2869  y coordinates (i
-00023800: 6e74 656e 7369 7479 290a 0a20 2020 2070  ntensity)..    p
-00023810: 6561 6b3a 706f 7369 7469 6f6e 3a20 696e  eak:position: in
-00023820: 742c 2066 6c6f 6174 0a20 2020 2020 2020  t, float.       
-00023830: 2050 6561 6b20 706f 7369 7469 6f6e 2074   Peak position t
-00023840: 6f20 6361 6c63 756c 6174 6520 7072 6f6d  o calculate prom
-00023850: 696e 656e 6365 2066 6f72 0a0a 2020 2020  inence for..    
-00023860: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-00023870: 2d2d 2d2d 0a20 2020 2066 6c6f 6174 3a20  ----.    float: 
-00023880: 7072 6f6d 696e 656e 6365 206f 6620 7065  prominence of pe
-00023890: 616b 2069 6e20 7920 636f 6f72 6469 6e61  ak in y coordina
-000238a0: 7465 732e 0a0a 2020 2020 2222 220a 2020  tes...    """.  
-000238b0: 2020 2320 4669 6e64 2074 6865 2069 6e64    # Find the ind
-000238c0: 6578 206f 6620 7468 6520 7065 616b 2070  ex of the peak p
-000238d0: 6f73 6974 696f 6e0a 2020 2020 7065 616b  osition.    peak
-000238e0: 5f69 6e64 6578 203d 206e 702e 7768 6572  _index = np.wher
-000238f0: 6528 7820 3d3d 2070 6561 6b5f 706f 7369  e(x == peak_posi
-00023900: 7469 6f6e 295b 305d 5b30 5d0a 0a20 2020  tion)[0][0]..   
-00023910: 2023 2046 696e 6420 7468 6520 6c6f 6361   # Find the loca
-00023920: 6c20 6d69 6e69 6d75 6d73 206f 6e20 626f  l minimums on bo
-00023930: 7468 2073 6964 6573 206f 6620 7468 6520  th sides of the 
-00023940: 7065 616b 0a20 2020 206c 6566 745f 7661  peak.    left_va
-00023950: 6c6c 6579 5f69 6e64 6578 203d 2070 6561  lley_index = pea
-00023960: 6b5f 696e 6465 780a 2020 2020 7269 6768  k_index.    righ
-00023970: 745f 7661 6c6c 6579 5f69 6e64 6578 203d  t_valley_index =
-00023980: 2070 6561 6b5f 696e 6465 780a 0a20 2020   peak_index..   
-00023990: 2023 2046 696e 6420 7468 6520 6c65 6674   # Find the left
-000239a0: 2076 616c 6c65 790a 2020 2020 7768 696c   valley.    whil
-000239b0: 6520 6c65 6674 5f76 616c 6c65 795f 696e  e left_valley_in
-000239c0: 6465 7820 3e20 3020 616e 6420 795b 6c65  dex > 0 and y[le
-000239d0: 6674 5f76 616c 6c65 795f 696e 6465 785d  ft_valley_index]
-000239e0: 203e 3d20 795b 6c65 6674 5f76 616c 6c65   >= y[left_valle
-000239f0: 795f 696e 6465 7820 2d20 315d 3a0a 2020  y_index - 1]:.  
-00023a00: 2020 2020 2020 6c65 6674 5f76 616c 6c65        left_valle
-00023a10: 795f 696e 6465 7820 2d3d 2031 0a0a 2020  y_index -= 1..  
-00023a20: 2020 2320 4669 6e64 2074 6865 2072 6967    # Find the rig
-00023a30: 6874 2076 616c 6c65 790a 2020 2020 7768  ht valley.    wh
-00023a40: 696c 6520 7269 6768 745f 7661 6c6c 6579  ile right_valley
-00023a50: 5f69 6e64 6578 203c 206c 656e 2878 2920  _index < len(x) 
-00023a60: 2d20 3120 616e 6420 795b 7269 6768 745f  - 1 and y[right_
-00023a70: 7661 6c6c 6579 5f69 6e64 6578 5d20 3e3d  valley_index] >=
-00023a80: 2079 5b72 6967 6874 5f76 616c 6c65 795f   y[right_valley_
-00023a90: 696e 6465 7820 2b20 315d 3a0a 2020 2020  index + 1]:.    
-00023aa0: 2020 2020 7269 6768 745f 7661 6c6c 6579      right_valley
-00023ab0: 5f69 6e64 6578 202b 3d20 310a 0a20 2020  _index += 1..   
-00023ac0: 2023 2043 616c 6375 6c61 7465 2070 726f   # Calculate pro
-00023ad0: 6d69 6e65 6e63 6520 6173 2074 6865 2064  minence as the d
-00023ae0: 6966 6665 7265 6e63 6520 6265 7477 6565  ifference betwee
-00023af0: 6e20 7065 616b 2068 6569 6768 7420 616e  n peak height an
-00023b00: 6420 6869 6768 6572 2076 616c 6c65 790a  d higher valley.
-00023b10: 2020 2020 7065 616b 5f68 6569 6768 7420      peak_height 
-00023b20: 3d20 795b 7065 616b 5f69 6e64 6578 5d0a  = y[peak_index].
-00023b30: 2020 2020 6c65 6674 5f76 616c 6c65 795f      left_valley_
-00023b40: 6865 6967 6874 203d 2079 5b6c 6566 745f  height = y[left_
-00023b50: 7661 6c6c 6579 5f69 6e64 6578 5d0a 2020  valley_index].  
-00023b60: 2020 7269 6768 745f 7661 6c6c 6579 5f68    right_valley_h
-00023b70: 6569 6768 7420 3d20 795b 7269 6768 745f  eight = y[right_
-00023b80: 7661 6c6c 6579 5f69 6e64 6578 5d0a 0a20  valley_index].. 
-00023b90: 2020 2070 726f 6d69 6e65 6e63 6520 3d20     prominence = 
-00023ba0: 7065 616b 5f68 6569 6768 7420 2d20 6d61  peak_height - ma
-00023bb0: 7828 6c65 6674 5f76 616c 6c65 795f 6865  x(left_valley_he
-00023bc0: 6967 6874 2c20 7269 6768 745f 7661 6c6c  ight, right_vall
-00023bd0: 6579 5f68 6569 6768 7429 0a0a 2020 2020  ey_height)..    
-00023be0: 7265 7475 726e 2070 726f 6d69 6e65 6e63  return prominenc
-00023bf0: 650a 0a0a 0a23 2050 6c6f 7474 696e 6720  e....# Plotting 
-00023c00: 7570 2073 6563 6f6e 6461 7279 2070 6561  up secondary pea
-00023c10: 6b73 0a0a 6672 6f6d 2073 6369 7079 2e73  ks..from scipy.s
-00023c20: 6967 6e61 6c20 696d 706f 7274 2066 696e  ignal import fin
-00023c30: 645f 7065 616b 730a 6465 6620 706c 6f74  d_peaks.def plot
-00023c40: 5f73 6563 6f6e 6461 7279 5f70 6561 6b73  _secondary_peaks
-00023c50: 282a 2c20 4469 6164 5f46 696c 6573 2c20  (*, Diad_Files, 
-00023c60: 7061 7468 2c20 6669 6c65 7479 7065 2c0a  path, filetype,.
-00023c70: 2020 2020 2020 2020 786c 696d 5f70 6c6f          xlim_plo
-00023c80: 743d 5b31 3034 302c 2031 3230 305d 2c20  t=[1040, 1200], 
-00023c90: 786c 696d 5f70 6561 6b73 3d5b 3130 3630  xlim_peaks=[1060
-00023ca0: 2c20 3131 3030 5d2c 0a20 2020 2020 2020  , 1100],.       
-00023cb0: 2068 6569 6768 743d 3130 302c 2074 6872   height=100, thr
-00023cc0: 6573 686f 6c64 3d30 2e31 2c20 6469 7374  eshold=0.1, dist
-00023cd0: 616e 6365 3d31 302c 2070 726f 6d69 6e65  ance=10, promine
-00023ce0: 6e63 653d 352c 2077 6964 7468 3d36 2c0a  nce=5, width=6,.
-00023cf0: 2020 2020 2020 2020 2070 726f 6d69 6e65           promine
-00023d00: 6e63 655f 6669 6c74 6572 3d46 616c 7365  nce_filter=False
-00023d10: 2c20 7369 676d 613d 332c 2073 6967 6d61  , sigma=3, sigma
-00023d20: 5f77 696e 646f 773d 3330 2c20 6669 6e64  _window=30, find
-00023d30: 5f70 6561 6b73 5f66 696c 7465 723d 4661  _peaks_filter=Fa
-00023d40: 6c73 652c 0a20 2020 2020 2020 2020 6a75  lse,.         ju
-00023d50: 7374 5f70 6c6f 743d 4661 6c73 652c 2079  st_plot=False, y
-00023d60: 7363 616c 653d 302e 322c 2067 6175 7373  scale=0.2, gauss
-00023d70: 6961 6e5f 736d 6f6f 7468 3d46 616c 7365  ian_smooth=False
-00023d80: 2c20 736d 6f6f 7468 696e 675f 7769 6e64  , smoothing_wind
-00023d90: 6f77 3d35 2c20 736d 6f6f 7468 5f73 7464  ow=5, smooth_std
-00023da0: 3d33 293a 0a0a 2020 2020 2222 2220 5468  =3):..    """ Th
-00023db0: 6973 2066 756e 6374 696f 6e20 706c 6f74  is function plot
-00023dc0: 7320 7370 6563 7472 6120 7374 6163 6b65  s spectra stacke
-00023dd0: 6420 7665 7274 6963 616c 6c79 206f 6e74  d vertically ont
-00023de0: 6f70 206f 6620 6561 6368 206f 7468 6572  op of each other
-00023df0: 2c20 696e 2061 2073 7065 6369 6669 6320  , in a specific 
-00023e00: 7265 6769 6f6e 2e0a 2020 2020 4974 2061  region..    It a
-00023e10: 6c73 6f20 6861 7320 7477 6f20 6f70 7469  lso has two opti
-00023e20: 6f6e 7320 746f 2069 6465 6e74 6966 7920  ons to identify 
-00023e30: 7065 616b 2070 6f73 6974 696f 6e73 2e0a  peak positions..
-00023e40: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-00023e50: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
-00023e60: 2d2d 2d0a 2020 2020 4469 6164 5f46 696c  ---.    Diad_Fil
-00023e70: 6573 3a20 6c69 7374 0a20 2020 2020 2020  es: list.       
-00023e80: 204c 6973 7420 6f66 2066 696c 656e 616d   List of filenam
-00023e90: 6573 2074 6f20 706c 6f74 0a0a 2020 2020  es to plot..    
-00023ea0: 7061 7468 3a20 7374 720a 2020 2020 2020  path: str.      
-00023eb0: 2020 5061 7468 2077 6865 7265 2073 7065    Path where spe
-00023ec0: 6374 7261 2061 7265 2073 746f 7265 640a  ctra are stored.
-00023ed0: 0a20 2020 2066 696c 6574 7970 653a 2073  .    filetype: s
-00023ee0: 7472 0a20 2020 2020 2020 2043 686f 6f73  tr.        Choos
-00023ef0: 6520 6672 6f6d 2027 5769 7465 635f 4153  e from 'Witec_AS
-00023f00: 4349 4927 2c20 2768 6561 646c 6573 735f  CII', 'headless_
-00023f10: 7478 7427 2c20 2768 6561 646c 6573 735f  txt', 'headless_
-00023f20: 6373 7627 2c20 2768 6561 645f 6373 7627  csv', 'head_csv'
-00023f30: 2c20 2757 6974 6563 5f41 5343 4949 272c  , 'Witec_ASCII',
-00023f40: 0a20 2020 2020 2020 2027 484f 5249 4241  .        'HORIBA
-00023f50: 5f74 7874 272c 2027 5265 6e69 7368 6177  _txt', 'Renishaw
-00023f60: 5f74 7874 270a 0a20 2020 2078 6c69 6d5f  _txt'..    xlim_
-00023f70: 706c 6f74 3a20 5475 706c 655b 666c 6f61  plot: Tuple[floa
-00023f80: 742c 2066 6c6f 6174 5d0a 2020 2020 2020  t, float].      
-00023f90: 2020 5261 6e67 6520 6f66 2078 2063 6f6f    Range of x coo
-00023fa0: 7264 696e 6174 6573 2074 6f20 6d61 6b65  rdinates to make
-00023fb0: 2070 6c6f 7420 6f76 6572 0a0a 2020 2020   plot over..    
-00023fc0: 786c 696d 5f70 6561 6b73 3a20 5475 706c  xlim_peaks: Tupl
-00023fd0: 655b 666c 6f61 742c 2066 6c6f 6174 5d0a  e[float, float].
-00023fe0: 2020 2020 2020 2020 5261 6e67 6520 6f66          Range of
-00023ff0: 2078 2063 6f6f 7264 696e 6174 6573 2074   x coordinates t
-00024000: 6f20 7365 6172 6368 2066 6f72 2070 6561  o search for pea
-00024010: 6b73 2069 6e0a 0a20 2020 204f 7074 696f  ks in..    Optio
-00024020: 6e61 6c20 7061 7261 6d65 7465 7273 2066  nal parameters f
-00024030: 6f72 2053 6d6f 6f74 6869 6e67 2073 7065  or Smoothing spe
-00024040: 6374 7261 2070 7269 6f72 2074 6f20 6669  ctra prior to fi
-00024050: 6e64 696e 6720 7065 616b 730a 0a20 2020  nding peaks..   
-00024060: 2020 2020 2067 6175 7373 6961 6e5f 736d       gaussian_sm
-00024070: 6f6f 7468 3a62 6f6f 6c20 2d20 4966 2054  ooth:bool - If T
-00024080: 7275 652c 2061 7070 6c69 6573 2061 2067  rue, applies a g
-00024090: 6175 7373 6961 6e20 736d 6f6f 7468 696e  aussian smoothin
-000240a0: 6720 6669 6c74 6572 2075 7369 6e67 206e  g filter using n
-000240b0: 702e 636f 6e76 6f6c 7665 2064 6566 696e  p.convolve defin
-000240c0: 6564 2062 7920 610a 2020 2020 2020 2020  ed by a.        
-000240d0: 2073 6d6f 6f74 6869 6e67 5f77 696e 646f   smoothing_windo
-000240e0: 7720 616e 6420 6120 736d 6f6f 7468 5f73  w and a smooth_s
-000240f0: 7464 2e0a 0a0a 2020 2020 4966 2079 6f75  td....    If you
-00024100: 2077 616e 7420 746f 2061 6374 7561 6c6c   want to actuall
-00024110: 7920 4944 2070 6561 6b73 2072 6174 6865  y ID peaks rathe
-00024120: 7220 7468 616e 206a 7573 7420 706c 6f74  r than just plot
-00024130: 2074 6865 6d2c 2063 686f 6f73 6520 6672   them, choose fr
-00024140: 6f6d 3a0a 0a20 2020 2070 726f 6d69 6e65  om:..    promine
-00024150: 6e63 655f 6669 6c74 6572 3a20 626f 6f6c  nce_filter: bool
-00024160: 0a20 2020 2020 2020 2069 6620 5472 7565  .        if True
-00024170: 2c20 6669 6e64 7320 6d61 7820 7920 636f  , finds max y co
-00024180: 6f72 6469 6e61 7465 2069 6e20 7468 6520  ordinate in the 
-00024190: 7769 6e64 6f77 2078 6c69 6d5f 7065 616b  window xlim_peak
-000241a0: 732e 2049 7420 7468 656e 2063 616c 6375  s. It then calcu
-000241b0: 6c61 7465 7320 7468 6520 7072 6f6d 696e  lates the promin
-000241c0: 656e 6365 2062 790a 2020 2020 2020 2020  ence by.        
-000241d0: 636f 6d70 6172 696e 6720 7468 6973 2070  comparing this p
-000241e0: 6561 6b20 6865 6967 6874 2074 6f20 7468  eak height to th
-000241f0: 6520 6176 6572 6167 6520 6f66 2074 6865  e average of the
-00024200: 206d 6564 6961 6e20 6f66 2074 6865 2033   median of the 3
-00024210: 2064 6174 6170 6f69 6e74 7320 6174 2074   datapoints at t
-00024220: 6865 206c 6566 7420 616e 6420 7269 6768  he left and righ
-00024230: 7420 6f66 2074 6865 2077 696e 646f 772e  t of the window.
-00024240: 0a20 2020 2020 2020 2049 6620 7468 6520  .        If the 
-00024250: 7065 616b 2069 7320 6d6f 7265 2074 6861  peak is more tha
-00024260: 6e20 2770 726f 6d69 6e65 6e63 6527 2075  n 'prominence' u
-00024270: 6e69 7473 2061 626f 7665 2074 6865 2061  nits above the a
-00024280: 7665 7261 6765 206f 6620 7468 6573 6520  verage of these 
-00024290: 7477 6f20 656e 6420 706f 696e 7420 6d65  two end point me
-000242a0: 6469 616e 732c 2069 740a 2020 2020 2020  dians, it.      
-000242b0: 2020 6973 2063 6c61 7373 6966 6965 6420    is classified 
-000242c0: 6173 2061 2070 6561 6b2e 0a20 2020 2020  as a peak..     
-000242d0: 2020 2041 6c73 6f20 6e65 6564 2074 6f20     Also need to 
-000242e0: 7370 6563 6966 7920 7072 6f6d 696e 656e  specify prominen
-000242f0: 6365 3a20 666c 6f61 740a 0a20 2020 2066  ce: float..    f
-00024300: 696e 645f 7065 616b 735f 6669 6c74 6572  ind_peaks_filter
-00024310: 3a20 626f 6f6c 0a0a 2020 2020 2020 2020  : bool..        
-00024320: 6966 2054 7275 652c 2075 7365 7320 7363  if True, uses sc
-00024330: 6970 7920 6669 6e64 2070 6561 6b73 2074  ipy find peaks t
-00024340: 6f20 6669 6e64 2070 6561 6b73 2e20 4361  o find peaks. Ca
-00024350: 6e20 7477 6561 6b20 6469 7374 616e 6365  n tweak distance
-00024360: 2c20 7072 6f6d 696e 656e 6365 2c20 7769  , prominence, wi
-00024370: 6474 682c 0a20 2020 2020 2020 2074 6872  dth,.        thr
-00024380: 6573 686f 6c64 2c20 616e 6420 6865 6967  eshold, and heig
-00024390: 6874 2e0a 0a20 2020 206a 7573 745f 706c  ht...    just_pl
-000243a0: 6f74 3a20 626f 6f6c 0a20 2020 2020 2020  ot: bool.       
-000243b0: 2069 6620 5472 7565 2c20 6a75 7374 2070   if True, just p
-000243c0: 6c6f 7473 2073 7065 6374 7261 2c20 646f  lots spectra, do
-000243d0: 6573 6e74 2074 7279 2074 6f20 6669 6e64  esnt try to find
-000243e0: 2070 6561 6b73 0a0a 2020 2020 795f 7363   peaks..    y_sc
-000243f0: 616c 653a 2066 6c6f 6174 0a20 2020 2020  ale: float.     
-00024400: 2020 2046 6967 7572 6520 7369 7a65 2069     Figure size i
-00024410: 7320 322b 795f 7363 616c 6520 2a20 6e75  s 2+y_scale * nu
-00024420: 6d62 6572 206f 6620 7370 6563 7472 610a  mber of spectra.
-00024430: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
-00024440: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20   -------------. 
-00024450: 2020 2064 665f 7065 616b 732c 2078 5f64     df_peaks, x_d
-00024460: 6174 612c 2079 5f64 6174 612c 2066 6967  ata, y_data, fig
-00024470: 0a0a 2020 2020 6466 5f70 6561 6b73 3a20  ..    df_peaks: 
-00024480: 7064 2e44 6174 6146 7261 6d65 2066 6f72  pd.DataFrame for
-00024490: 2065 6163 6820 6669 6c65 206f 6620 7065   each file of pe
-000244a0: 616b 2070 6f73 6974 696f 6e2c 2068 6569  ak position, hei
-000244b0: 6768 742c 2070 726f 6d69 6e65 6e63 6520  ght, prominence 
-000244c0: 616e 6420 6669 6c65 206e 616d 652e 2046  and file name. F
-000244d0: 696c 6c65 6420 7769 7468 204e 616e 7320  illed with Nans 
-000244e0: 6966 2064 6964 6e74 2066 696e 6420 6120  if didnt find a 
-000244f0: 7065 616b 0a20 2020 2078 5f64 6174 613a  peak.    x_data:
-00024500: 206e 702e 6172 7261 7920 6f66 2078 2063   np.array of x c
-00024510: 6f6f 7264 696e 6174 6573 2028 4173 7375  oordinates (Assu
-00024520: 6d65 7320 7468 6520 7361 6d65 2066 6f72  mes the same for
-00024530: 2061 6c6c 2066 696c 6573 290a 2020 2020   all files).    
-00024540: 795f 6461 7461 3a20 6e70 2e61 7272 6179  y_data: np.array
-00024550: 206f 6620 7920 636f 6f72 6469 6e61 7465   of y coordinate
-00024560: 7320 6f66 2065 6163 6820 7370 6563 7472  s of each spectr
-00024570: 610a 2020 2020 6669 673a 2066 6967 7572  a.    fig: figur
-00024580: 6520 6974 2068 6173 2070 6c6f 7474 6564  e it has plotted
-00024590: 0a0a 0a20 2020 2022 2222 0a20 2020 2069  ...    """.    i
-000245a0: 6620 7072 6f6d 696e 656e 6365 5f66 696c  f prominence_fil
-000245b0: 7465 7220 6973 2054 7275 6520 616e 6420  ter is True and 
-000245c0: 2866 696e 645f 7065 616b 735f 6669 6c74  (find_peaks_filt
-000245d0: 6572 2069 7320 5472 7565 206f 7220 6a75  er is True or ju
-000245e0: 7374 5f70 6c6f 7420 6973 2054 7275 6529  st_plot is True)
-000245f0: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-00024600: 5479 7065 4572 726f 7228 274f 6e6c 7920  TypeError('Only 
-00024610: 6f6e 6520 6f66 2073 6967 6d61 5f66 696c  one of sigma_fil
-00024620: 7465 722c 2069 6e64 5f70 6561 6b73 5f66  ter, ind_peaks_f
-00024630: 696c 7465 7220 616e 6420 6a75 7374 5f70  ilter and just_p
-00024640: 6c6f 7420 6361 6e20 6265 2054 7275 6527  lot can be True'
-00024650: 290a 2020 2020 6669 672c 2028 6178 3129  ).    fig, (ax1)
-00024660: 203d 2070 6c74 2e73 7562 706c 6f74 7328   = plt.subplots(
-00024670: 312c 2031 2c20 6669 6773 697a 653d 2831  1, 1, figsize=(1
-00024680: 302c 322b 7973 6361 6c65 2a6c 656e 2844  0,2+yscale*len(D
-00024690: 6961 645f 4669 6c65 7329 2929 0a0a 2020  iad_Files)))..  
-000246a0: 2020 693d 300a 2020 2020 593d 300a 2020    i=0.    Y=0.  
-000246b0: 2020 7065 616b 5f70 6f73 5f73 6176 6564    peak_pos_saved
-000246c0: 3d6e 702e 656d 7074 7928 6c65 6e28 4469  =np.empty(len(Di
-000246d0: 6164 5f46 696c 6573 292c 2064 7479 7065  ad_Files), dtype
-000246e0: 3d66 6c6f 6174 290a 2020 2020 7065 616b  =float).    peak
-000246f0: 5f70 726f 6d5f 7361 7665 643d 6e70 2e65  _prom_saved=np.e
-00024700: 6d70 7479 286c 656e 2844 6961 645f 4669  mpty(len(Diad_Fi
-00024710: 6c65 7329 2c20 6474 7970 653d 666c 6f61  les), dtype=floa
-00024720: 7429 0a20 2020 2070 6561 6b5f 6865 6967  t).    peak_heig
-00024730: 6874 5f73 6176 6564 3d6e 702e 656d 7074  ht_saved=np.empt
-00024740: 7928 6c65 6e28 4469 6164 5f46 696c 6573  y(len(Diad_Files
-00024750: 292c 2064 7479 7065 3d66 6c6f 6174 290a  ), dtype=float).
-00024760: 2020 2020 7065 616b 5f62 636b 3d6e 702e      peak_bck=np.
-00024770: 656d 7074 7928 6c65 6e28 4469 6164 5f46  empty(len(Diad_F
-00024780: 696c 6573 292c 2064 7479 7065 3d66 6c6f  iles), dtype=flo
-00024790: 6174 290a 2020 2020 795f 7374 6172 3d6e  at).    y_star=n
-000247a0: 702e 656d 7074 7928 6c65 6e28 4469 6164  p.empty(len(Diad
-000247b0: 5f46 696c 6573 292c 2064 7479 7065 3d66  _Files), dtype=f
-000247c0: 6c6f 6174 290a 2020 2020 7970 6c6f 743d  loat).    yplot=
-000247d0: 6e70 2e65 6d70 7479 286c 656e 2844 6961  np.empty(len(Dia
-000247e0: 645f 4669 6c65 7329 2c20 6474 7970 653d  d_Files), dtype=
-000247f0: 666c 6f61 7429 0a20 2020 2044 6961 645f  float).    Diad_
-00024800: 6466 3d67 6574 5f64 6174 6128 7061 7468  df=get_data(path
-00024810: 3d70 6174 682c 2066 696c 656e 616d 653d  =path, filename=
-00024820: 4469 6164 5f46 696c 6573 5b30 5d2c 2066  Diad_Files[0], f
-00024830: 696c 6574 7970 653d 6669 6c65 7479 7065  iletype=filetype
-00024840: 290a 2020 2020 785f 6461 7461 3d44 6961  ).    x_data=Dia
-00024850: 645f 6466 5b3a 2c20 305d 0a20 2020 2079  d_df[:, 0].    y
-00024860: 5f64 6174 613d 6e70 2e65 6d70 7479 285b  _data=np.empty([
-00024870: 2020 6c65 6e28 785f 6461 7461 292c 206c    len(x_data), l
-00024880: 656e 2844 6961 645f 4669 6c65 7329 5d2c  en(Diad_Files)],
-00024890: 2066 6c6f 6174 290a 0a0a 2020 2020 666f   float)...    fo
-000248a0: 7220 6669 6c65 2069 6e20 4469 6164 5f46  r file in Diad_F
-000248b0: 696c 6573 3a0a 0a0a 0a0a 2020 2020 2020  iles:.....      
-000248c0: 2020 4469 6164 5f64 663d 6765 745f 6461    Diad_df=get_da
-000248d0: 7461 2870 6174 683d 7061 7468 2c20 6669  ta(path=path, fi
-000248e0: 6c65 6e61 6d65 3d66 696c 652c 2066 696c  lename=file, fil
-000248f0: 6574 7970 653d 6669 6c65 7479 7065 290a  etype=filetype).
-00024900: 2020 2020 2020 2020 4469 6164 3d6e 702e          Diad=np.
-00024910: 6172 7261 7928 4469 6164 5f64 6629 0a0a  array(Diad_df)..
-00024920: 0a20 2020 2020 2020 2023 2046 6972 7374  .        # First
-00024930: 206c 6574 7320 7573 6520 6669 6e64 2070   lets use find p
-00024940: 6561 6b73 0a20 2020 2020 2020 2079 323d  eaks.        y2=
-00024950: 4469 6164 5b3a 2c20 315d 0a20 2020 2020  Diad[:, 1].     
-00024960: 2020 2078 3d44 6961 645b 3a2c 2030 5d0a     x=Diad[:, 0].
-00024970: 0a20 2020 2020 2020 2069 6620 6761 7573  .        if gaus
-00024980: 7369 616e 5f73 6d6f 6f74 6820 6973 2054  sian_smooth is T
-00024990: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
-000249a0: 2079 203d 206e 702e 636f 6e76 6f6c 7665   y = np.convolve
-000249b0: 2879 322c 2067 6175 7373 6961 6e28 736d  (y2, gaussian(sm
-000249c0: 6f6f 7468 696e 675f 7769 6e64 6f77 2c20  oothing_window, 
-000249d0: 7374 643d 736d 6f6f 7468 5f73 7464 292c  std=smooth_std),
-000249e0: 206d 6f64 653d 2773 616d 6527 290a 2020   mode='same').  
-000249f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00024a00: 2020 2020 2020 2020 793d 7932 0a0a 0a0a          y=y2....
-00024a10: 2020 2020 2020 2020 2320 5265 6769 6f6e          # Region
-00024a20: 206f 6620 696e 7465 7265 7374 0a20 2020   of interest.   
-00024a30: 2020 2020 2052 6567 696f 6e5f 7065 616b       Region_peak
-00024a40: 7320 3d20 2828 783e 786c 696d 5f70 6561  s = ((x>xlim_pea
-00024a50: 6b73 5b30 5d29 2620 2878 3c78 6c69 6d5f  ks[0])& (x<xlim_
-00024a60: 7065 616b 735b 315d 2929 0a20 2020 2020  peaks[1])).     
-00024a70: 2020 2052 6567 696f 6e5f 706c 6f74 3d28     Region_plot=(
-00024a80: 2878 3e78 6c69 6d5f 706c 6f74 5b30 5d29  (x>xlim_plot[0])
-00024a90: 2620 2878 3c78 6c69 6d5f 706c 6f74 5b31  & (x<xlim_plot[1
-00024aa0: 5d29 290a 2020 2020 2020 2020 785f 7472  ])).        x_tr
-00024ab0: 696d 3d78 5b52 6567 696f 6e5f 7065 616b  im=x[Region_peak
-00024ac0: 735d 0a20 2020 2020 2020 2079 5f74 7269  s].        y_tri
-00024ad0: 6d3d 795b 5265 6769 6f6e 5f70 6561 6b73  m=y[Region_peaks
-00024ae0: 5d0a 2020 2020 2020 2020 785f 706c 6f74  ].        x_plot
-00024af0: 3d78 5b52 6567 696f 6e5f 706c 6f74 5d0a  =x[Region_plot].
-00024b00: 2020 2020 2020 2020 795f 706c 6f74 3d79          y_plot=y
-00024b10: 5b52 6567 696f 6e5f 706c 6f74 5d0a 2020  [Region_plot].  
-00024b20: 2020 2020 2020 795f 6461 7461 5b3a 2c20        y_data[:, 
-00024b30: 695d 3d79 0a0a 0a0a 2020 2020 2020 2020  i]=y....        
-00024b40: 2320 4946 2075 7369 6e67 2073 6369 7079  # IF using scipy
-00024b50: 2066 696e 6420 7065 616b 730a 2020 2020   find peaks.    
-00024b60: 2020 2020 6966 2066 696e 645f 7065 616b      if find_peak
-00024b70: 735f 6669 6c74 6572 2069 7320 5472 7565  s_filter is True
-00024b80: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00024b90: 4669 6e64 2070 6561 6b73 2066 6f72 2074  Find peaks for t
-00024ba0: 7269 6d6d 6564 2073 7065 6374 7261 2028  rimmed spectra (
-00024bb0: 652e 672e 2069 6e20 7265 6769 6f6e 2070  e.g. in region p
-00024bc0: 6561 6b73 2068 6176 6520 6265 656e 2061  eaks have been a
-00024bd0: 736b 6564 2066 6f72 290a 2020 2020 2020  sked for).      
-00024be0: 2020 2020 2020 7065 616b 7320 3d20 6669        peaks = fi
-00024bf0: 6e64 5f70 6561 6b73 2879 5f74 7269 6d2c  nd_peaks(y_trim,
-00024c00: 6865 6967 6874 203d 2068 6569 6768 742c  height = height,
-00024c10: 2074 6872 6573 686f 6c64 203d 2074 6872   threshold = thr
-00024c20: 6573 686f 6c64 2c0a 2020 2020 2020 2020  eshold,.        
-00024c30: 2020 2020 6469 7374 616e 6365 203d 2064      distance = d
-00024c40: 6973 7461 6e63 652c 2070 726f 6d69 6e65  istance, promine
-00024c50: 6e63 653d 7072 6f6d 696e 656e 6365 2c20  nce=prominence, 
-00024c60: 7769 6474 683d 7769 6474 6829 0a0a 0a20  width=width)... 
-00024c70: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
-00024c80: 745f 5045 414b 203d 2070 6561 6b73 5b31  t_PEAK = peaks[1
-00024c90: 5d5b 2770 6561 6b5f 6865 6967 6874 7327  ]['peak_heights'
-00024ca0: 5d20 236c 6973 7420 6f66 2074 6865 2068  ] #list of the h
-00024cb0: 6569 6768 7473 206f 6620 7468 6520 7065  eights of the pe
-00024cc0: 616b 730a 2020 2020 2020 2020 2020 2020  aks.            
-00024cd0: 7065 616b 5f70 6f73 203d 2078 5f74 7269  peak_pos = x_tri
-00024ce0: 6d5b 7065 616b 735b 305d 5d20 236c 6973  m[peaks[0]] #lis
-00024cf0: 7420 6f66 2074 6865 2070 6561 6b73 2070  t of the peaks p
-00024d00: 6f73 6974 696f 6e73 0a0a 2020 2020 2020  ositions..      
-00024d10: 2020 2020 2020 6466 5f73 6f72 743d 7064        df_sort=pd
-00024d20: 2e44 6174 6146 7261 6d65 2864 6174 613d  .DataFrame(data=
-00024d30: 7b27 706f 7327 3a20 7065 616b 5f70 6f73  {'pos': peak_pos
-00024d40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00024d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024d60: 2020 2768 6569 6768 7427 3a20 6865 6967    'height': heig
-00024d70: 6874 5f50 4541 4b7d 290a 0a20 2020 2020  ht_PEAK})..     
-00024d80: 2020 2020 2020 2064 665f 7065 616b 5f73         df_peak_s
-00024d90: 6f72 743d 6466 5f73 6f72 742e 736f 7274  ort=df_sort.sort
-00024da0: 5f76 616c 7565 7328 2768 6569 6768 7427  _values('height'
-00024db0: 2c20 6178 6973 3d30 2c20 6173 6365 6e64  , axis=0, ascend
-00024dc0: 696e 673d 4661 6c73 6529 0a0a 2020 2020  ing=False)..    
-00024dd0: 2020 2020 2020 2020 2320 5472 696d 206e          # Trim n
-00024de0: 756d 6265 7220 6f66 2070 6561 6b73 2062  umber of peaks b
-00024df0: 6173 6564 206f 6e20 7573 6572 2d64 6566  ased on user-def
-00024e00: 696e 6564 204e 2070 6561 6b73 0a0a 0a0a  ined N peaks....
-00024e10: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
-00024e20: 6e74 2864 665f 7065 616b 5f73 6f72 745f  nt(df_peak_sort_
-00024e30: 7368 6f72 7429 0a20 2020 2020 2020 2020  short).         
-00024e40: 2020 2069 6620 6c65 6e28 6466 5f70 6561     if len(df_pea
-00024e50: 6b5f 736f 7274 3e3d 3129 3a0a 0a20 2020  k_sort>=1):..   
-00024e60: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-00024e70: 7065 616b 5f73 6f72 745f 7368 6f72 743d  peak_sort_short=
-00024e80: 6466 5f70 6561 6b5f 736f 7274 5b30 3a31  df_peak_sort[0:1
-00024e90: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00024ea0: 2020 7065 616b 5f70 6f73 5f73 6176 6564    peak_pos_saved
-00024eb0: 5b69 5d3d 6466 5f70 6561 6b5f 736f 7274  [i]=df_peak_sort
-00024ec0: 5f73 686f 7274 5b27 706f 7327 5d2e 7661  _short['pos'].va
-00024ed0: 6c75 6573 0a20 2020 2020 2020 2020 2020  lues.           
-00024ee0: 2020 2020 2070 6561 6b5f 6865 6967 6874       peak_height
-00024ef0: 5f73 6176 6564 5b69 5d3d 6466 5f70 6561  _saved[i]=df_pea
-00024f00: 6b5f 736f 7274 5f73 686f 7274 5b27 6865  k_sort_short['he
-00024f10: 6967 6874 275d 2e76 616c 7565 730a 2020  ight'].values.  
-00024f20: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00024f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024f40: 2070 6561 6b5f 706f 735f 7361 7665 645b   peak_pos_saved[
-00024f50: 695d 3d6e 702e 6e61 6e0a 2020 2020 2020  i]=np.nan.      
-00024f60: 2020 2020 2020 2020 2020 7065 616b 5f68            peak_h
-00024f70: 6569 6768 745f 7361 7665 645b 695d 3d6e  eight_saved[i]=n
-00024f80: 702e 6e61 6e0a 0a20 2020 2020 2020 2020  p.nan..         
-00024f90: 2020 2070 6561 6b5f 6263 6b5b 695d 3d6e     peak_bck[i]=n
-00024fa0: 702e 7175 616e 7469 6c65 2879 5f70 6c6f  p.quantile(y_plo
-00024fb0: 742c 2030 2e32 290a 2020 2020 2020 2020  t, 0.2).        
-00024fc0: 2020 2020 6176 5f79 3d6e 702e 7175 616e      av_y=np.quan
-00024fd0: 7469 6c65 2879 5f70 6c6f 742c 2030 2e35  tile(y_plot, 0.5
-00024fe0: 290a 2020 2020 2020 2020 2020 2020 4469  ).            Di
-00024ff0: 6666 3d6e 702e 6d61 7828 795f 706c 6f74  ff=np.max(y_plot
-00025000: 292d 6e70 2e6d 696e 2879 5f70 6c6f 7429  )-np.min(y_plot)
-00025010: 0a20 2020 2020 2020 2020 2020 2059 5f73  .            Y_s
-00025020: 756d 3d6e 702e 6d61 7828 795f 706c 6f74  um=np.max(y_plot
-00025030: 292f 4469 6666 0a0a 2020 2020 2020 2020  )/Diff..        
-00025040: 2020 2020 6178 312e 706c 6f74 2878 5f70      ax1.plot(x_p
-00025050: 6c6f 742c 2028 2879 5f70 6c6f 742d 6e70  lot, ((y_plot-np
-00025060: 2e6d 696e 2879 5f70 6c6f 7429 292f 4469  .min(y_plot))/Di
-00025070: 6666 292b 692c 2027 2d72 2729 0a20 2020  ff)+i, '-r').   
-00025080: 2020 2020 2020 2020 2061 7831 2e70 6c6f           ax1.plo
-00025090: 7428 785f 706c 6f74 2c20 2828 795f 706c  t(x_plot, ((y_pl
-000250a0: 6f74 2d6e 702e 6d69 6e28 795f 706c 6f74  ot-np.min(y_plot
-000250b0: 2929 2f44 6966 6629 2b69 2c20 272e 6b27  ))/Diff)+i, '.k'
-000250c0: 2c20 6d73 3d31 290a 2020 2020 2020 2020  , ms=1).        
-000250d0: 2020 2020 6966 206c 656e 2868 6569 6768      if len(heigh
-000250e0: 745f 5045 414b 293e 303a 0a0a 0a20 2020  t_PEAK)>0:...   
-000250f0: 2020 2020 2020 2020 2020 2020 2061 7831               ax1
-00025100: 2e70 6c6f 7428 6466 5f70 6561 6b5f 736f  .plot(df_peak_so
-00025110: 7274 5f73 686f 7274 5b27 706f 7327 5d2c  rt_short['pos'],
-00025120: 2028 6466 5f70 6561 6b5f 736f 7274 5f73   (df_peak_sort_s
-00025130: 686f 7274 5b27 6865 6967 6874 275d 2d6e  hort['height']-n
-00025140: 702e 6d69 6e28 795f 706c 6f74 2929 2f44  p.min(y_plot))/D
-00025150: 6966 662b 692c 2027 2a6b 272c 206d 6663  iff+i, '*k', mfc
-00025160: 3d27 7965 6c6c 6f77 272c 206d 733d 3130  ='yellow', ms=10
-00025170: 290a 0a20 2020 2020 2020 2020 2020 2079  )..            y
-00025180: 706c 6f74 5b69 5d3d 6e70 2e6d 696e 2828  plot[i]=np.min((
-00025190: 2879 5f70 6c6f 742d 6e70 2e6d 696e 2879  (y_plot-np.min(y
-000251a0: 5f70 6c6f 7429 292f 4469 6666 292b 6929  _plot))/Diff)+i)
-000251b0: 0a0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
-000251c0: 312e 616e 6e6f 7461 7465 2873 7472 2866  1.annotate(str(f
-000251d0: 696c 6529 2c20 7879 3d28 786c 696d 5f70  ile), xy=(xlim_p
-000251e0: 6c6f 745b 315d 2b30 2e35 2c20 7970 6c6f  lot[1]+0.5, yplo
-000251f0: 745b 695d 292c 0a20 2020 2020 2020 2020  t[i]),.         
-00025200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025210: 7879 636f 6f72 6473 3d22 6461 7461 222c  xycoords="data",
-00025220: 2066 6f6e 7473 697a 653d 3829 0a20 2020   fontsize=8).   
-00025230: 2020 2020 2020 2020 2023 6178 312e 7365           #ax1.se
-00025240: 745f 786c 696d 2878 6c69 6d29 0a20 2020  t_xlim(xlim).   
-00025250: 2020 2020 2020 2020 2059 3d59 2b59 5f73           Y=Y+Y_s
-00025260: 756d 0a0a 0a20 2020 2020 2020 2020 2020  um...           
-00025270: 2023 2063 616c 6375 6c61 7465 2070 726f   # calculate pro
-00025280: 6d69 6e65 6e63 650a 2020 2020 2020 2020  minence.        
-00025290: 2020 2020 795f 6564 6765 313d 6e70 2e6d      y_edge1=np.m
-000252a0: 6564 6961 6e28 795f 7472 696d 5b30 3a33  edian(y_trim[0:3
-000252b0: 5d29 0a20 2020 2020 2020 2020 2020 2079  ]).            y
-000252c0: 5f65 6467 6532 3d6e 702e 6d65 6469 616e  _edge2=np.median
-000252d0: 2879 5f74 7269 6d5b 2d33 3a5d 290a 2020  (y_trim[-3:]).  
-000252e0: 2020 2020 2020 2020 2020 7065 616b 5f70            peak_p
-000252f0: 726f 6d5f 7361 7665 645b 695d 3d70 6561  rom_saved[i]=pea
-00025300: 6b5f 6865 6967 6874 5f73 6176 6564 5b69  k_height_saved[i
-00025310: 5d2d 2879 5f65 6467 6531 2b79 5f65 6467  ]-(y_edge1+y_edg
-00025320: 6532 292f 320a 0a20 2020 2020 2020 2020  e2)/2..         
-00025330: 2020 2069 3d69 2b31 0a0a 0a20 2020 2020     i=i+1...     
-00025340: 2020 2065 6c69 6620 7072 6f6d 696e 656e     elif prominen
-00025350: 6365 5f66 696c 7465 7220 6973 2054 7275  ce_filter is Tru
-00025360: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00025370: 2020 2023 2046 696e 6420 6d61 7820 7661     # Find max va
-00025380: 6c75 6520 696e 2072 6567 696f 6e0a 0a20  lue in region.. 
-00025390: 2020 2020 2020 2020 2020 206d 6178 793d             maxy=
-000253a0: 6e70 2e6d 6178 2879 5f74 7269 6d29 0a20  np.max(y_trim). 
-000253b0: 2020 2020 2020 2020 2020 2078 706f 733d             xpos=
-000253c0: 785f 7472 696d 5b79 5f74 7269 6d3d 3d6d  x_trim[y_trim==m
-000253d0: 6178 795d 5b30 5d0a 2020 2020 2020 2020  axy][0].        
-000253e0: 2020 2020 2370 7269 6e74 2878 706f 7329      #print(xpos)
-000253f0: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
-00025400: 6620 2878 706f 732b 7369 676d 615f 7769  f (xpos+sigma_wi
-00025410: 6e64 6f77 293e 6e70 2e6d 6178 2878 5f74  ndow)>np.max(x_t
-00025420: 7269 6d29 3a0a 2020 2020 2020 2020 2020  rim):.          
-00025430: 2020 2320 2020 2020 5261 6973 6520 5479    #     Raise Ty
-00025440: 7065 4572 726f 7228 2759 6f75 7220 7065  peError('Your pe
-00025450: 616b 2066 696e 6469 6e67 2077 696e 646f  ak finding windo
-00025460: 7720 6973 2073 6d61 6c6c 6572 2074 6861  w is smaller tha
-00025470: 6e20 7369 676d 6120 7769 6e64 6f77 2729  n sigma window')
-00025480: 0a20 2020 2020 2020 2020 2020 2023 2079  .            # y
-00025490: 5f61 726f 756e 645f 6d61 783d 795f 7472  _around_max=y_tr
-000254a0: 696d 5b28 785f 7472 696d 3e28 7870 6f73  im[(x_trim>(xpos
-000254b0: 2b73 6967 6d61 5f77 696e 646f 7729 2926  +sigma_window))&
-000254c0: 2878 5f74 7269 6d3c 2878 706f 732d 7369  (x_trim<(xpos-si
-000254d0: 676d 615f 7769 6e64 6f77 2929 5d0a 2020  gma_window))].  
-000254e0: 2020 2020 2020 2020 2020 2320 7374 6479            # stdy
-000254f0: 3d6e 702e 6e61 6e73 7464 2879 5f61 726f  =np.nanstd(y_aro
-00025500: 756e 645f 6d61 7829 0a20 2020 2020 2020  und_max).       
-00025510: 2020 2020 2023 206d 6564 6961 6e79 3d6e       # mediany=n
-00025520: 702e 7175 616e 7469 6c65 2879 5f61 726f  p.quantile(y_aro
-00025530: 756e 645f 6d61 782c 2030 2e35 290a 2020  und_max, 0.5).  
-00025540: 2020 2020 2020 2020 2020 2320 6966 206d            # if m
-00025550: 6178 793e 6d65 6469 616e 792b 7374 6479  axy>mediany+stdy
-00025560: 2a73 6967 6d61 2b70 726f 6d69 6e65 6e63  *sigma+prominenc
-00025570: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
-00025580: 2020 2020 2070 6f73 5f78 3d78 5f74 7269       pos_x=x_tri
-00025590: 6d5b 795f 7472 696d 3d3d 6d61 7879 5d5b  m[y_trim==maxy][
-000255a0: 305d 0a20 2020 2020 2020 2020 2020 2023  0].            #
-000255b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000255c0: 2020 2023 2020 2020 2070 6f73 5f78 3d6e     #     pos_x=n
-000255d0: 702e 6e61 6e0a 0a20 2020 2020 2020 2020  p.nan..         
-000255e0: 2020 2023 7072 6f6d 696e 656e 6365 5f63     #prominence_c
-000255f0: 616c 6320 3d20 7065 616b 5f70 726f 6d69  alc = peak_promi
-00025600: 6e65 6e63 6528 785f 7472 696d 2c20 795f  nence(x_trim, y_
-00025610: 7472 696d 2c20 7870 6f73 290a 0a20 2020  trim, xpos)..   
-00025620: 2020 2020 2020 2020 2079 5f65 6467 6531           y_edge1
-00025630: 3d6e 702e 6d65 6469 616e 2879 5f74 7269  =np.median(y_tri
-00025640: 6d5b 303a 335d 290a 2020 2020 2020 2020  m[0:3]).        
-00025650: 2020 2020 795f 6564 6765 323d 6e70 2e6d      y_edge2=np.m
-00025660: 6564 6961 6e28 795f 7472 696d 5b2d 333a  edian(y_trim[-3:
-00025670: 5d29 0a20 2020 2020 2020 2020 2020 2023  ]).            #
-00025680: 7072 696e 7428 795f 6564 6765 3229 0a20  print(y_edge2). 
-00025690: 2020 2020 2020 2020 2020 2070 726f 6d69             promi
-000256a0: 6e65 6e63 655f 6361 6c63 3d6d 6178 792d  nence_calc=maxy-
-000256b0: 2879 5f65 6467 6531 2b79 5f65 6467 6532  (y_edge1+y_edge2
-000256c0: 292f 320a 2020 2020 2020 2020 2020 2020  )/2.            
-000256d0: 7065 616b 5f70 726f 6d5f 7361 7665 645b  peak_prom_saved[
-000256e0: 695d 3d70 726f 6d69 6e65 6e63 655f 6361  i]=prominence_ca
-000256f0: 6c63 0a0a 0a0a 2020 2020 2020 2020 2020  lc....          
-00025700: 2020 6966 2070 726f 6d69 6e65 6e63 655f    if prominence_
-00025710: 6361 6c63 3e70 726f 6d69 6e65 6e63 653a  calc>prominence:
-00025720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025730: 2070 6f73 5f78 3d78 5f74 7269 6d5b 795f   pos_x=x_trim[y_
-00025740: 7472 696d 3d3d 6d61 7879 5d5b 305d 0a20  trim==maxy][0]. 
-00025750: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00025760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025770: 2070 6f73 5f78 3d6e 702e 6e61 6e0a 0a0a   pos_x=np.nan...
-00025780: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00025790: 2070 6f73 5f78 3e30 3a0a 2020 2020 2020   pos_x>0:.      
-000257a0: 2020 2020 2020 2020 2020 7065 616b 5f70            peak_p
-000257b0: 6f73 5f73 6176 6564 5b69 5d3d 706f 735f  os_saved[i]=pos_
-000257c0: 780a 2020 2020 2020 2020 2020 2020 2020  x.              
-000257d0: 2020 7065 616b 5f68 6569 6768 745f 7361    peak_height_sa
-000257e0: 7665 645b 695d 3d6d 6178 790a 0a20 2020  ved[i]=maxy..   
-000257f0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00025800: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00025810: 6561 6b5f 706f 735f 7361 7665 645b 695d  eak_pos_saved[i]
-00025820: 3d6e 702e 6e61 6e0a 2020 2020 2020 2020  =np.nan.        
-00025830: 2020 2020 2020 2020 7065 616b 5f68 6569          peak_hei
-00025840: 6768 745f 7361 7665 645b 695d 3d6e 702e  ght_saved[i]=np.
-00025850: 6e61 6e0a 0a20 2020 2020 2020 2020 2020  nan..           
-00025860: 2070 6561 6b5f 6263 6b5b 695d 3d6e 702e   peak_bck[i]=np.
-00025870: 7175 616e 7469 6c65 2879 5f70 6c6f 742c  quantile(y_plot,
-00025880: 2030 2e32 290a 2020 2020 2020 2020 2020   0.2).          
-00025890: 2020 6176 5f79 3d6e 702e 7175 616e 7469    av_y=np.quanti
-000258a0: 6c65 2879 5f70 6c6f 742c 2030 2e35 290a  le(y_plot, 0.5).
-000258b0: 2020 2020 2020 2020 2020 2020 4469 6666              Diff
-000258c0: 3d6e 702e 6d61 7828 795f 706c 6f74 292d  =np.max(y_plot)-
-000258d0: 6e70 2e6d 696e 2879 5f70 6c6f 7429 0a20  np.min(y_plot). 
-000258e0: 2020 2020 2020 2020 2020 2059 5f73 756d             Y_sum
-000258f0: 3d6e 702e 6d61 7828 795f 706c 6f74 292f  =np.max(y_plot)/
-00025900: 4469 6666 0a20 2020 2020 2020 2020 2020  Diff.           
-00025910: 2023 2049 4620 7468 6572 6520 6973 2073   # IF there is s
-00025920: 6f6d 6574 6869 6e67 2074 6861 7420 7061  omething that pa
-00025930: 7373 6573 2074 6865 2066 696c 7465 720a  sses the filter.
-00025940: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00025950: 6f73 5f78 3e30 3a0a 2020 2020 2020 2020  os_x>0:.        
-00025960: 2020 2020 2020 2020 795f 7374 6172 5b69          y_star[i
-00025970: 5d3d 2870 6561 6b5f 6865 6967 6874 5f73  ]=(peak_height_s
-00025980: 6176 6564 5b69 5d2d 6e70 2e6d 696e 2879  aved[i]-np.min(y
-00025990: 5f70 6c6f 7429 292f 4469 6666 2b69 0a20  _plot))/Diff+i. 
-000259a0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000259b0: 7831 2e70 6c6f 7428 706f 735f 782c 2079  x1.plot(pos_x, y
-000259c0: 5f73 7461 725b 695d 2c20 272a 6b27 2c20  _star[i], '*k', 
-000259d0: 6d66 633d 2779 656c 6c6f 7727 2c20 6d73  mfc='yellow', ms
-000259e0: 3d31 3029 0a20 2020 2020 2020 2020 2020  =10).           
-000259f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00025a00: 2020 2020 2020 2079 5f73 7461 725b 695d         y_star[i]
-00025a10: 3d6e 702e 6e61 6e0a 0a20 2020 2020 2020  =np.nan..       
-00025a20: 2020 2020 2061 7831 2e70 6c6f 7428 785f       ax1.plot(x_
-00025a30: 706c 6f74 2c20 2828 795f 706c 6f74 2d6e  plot, ((y_plot-n
-00025a40: 702e 6d69 6e28 795f 706c 6f74 2929 2f44  p.min(y_plot))/D
-00025a50: 6966 6629 2b69 2c20 272d 7227 290a 2020  iff)+i, '-r').  
-00025a60: 2020 2020 2020 2020 2020 6178 312e 706c            ax1.pl
-00025a70: 6f74 2878 5f70 6c6f 742c 2028 2879 5f70  ot(x_plot, ((y_p
-00025a80: 6c6f 742d 6e70 2e6d 696e 2879 5f70 6c6f  lot-np.min(y_plo
-00025a90: 7429 292f 4469 6666 292b 692c 2027 2e6b  t))/Diff)+i, '.k
-00025aa0: 272c 206d 733d 3129 0a20 2020 2020 2020  ', ms=1).       
-00025ab0: 2020 2020 2079 706c 6f74 5b69 5d3d 6e70       yplot[i]=np
-00025ac0: 2e6d 696e 2828 2879 5f70 6c6f 742d 6e70  .min(((y_plot-np
-00025ad0: 2e6d 696e 2879 5f70 6c6f 7429 292f 4469  .min(y_plot))/Di
-00025ae0: 6666 292b 6929 0a20 2020 2020 2020 2020  ff)+i).         
-00025af0: 2020 2061 7831 2e61 6e6e 6f74 6174 6528     ax1.annotate(
-00025b00: 7374 7228 6669 6c65 292c 2078 793d 2878  str(file), xy=(x
-00025b10: 6c69 6d5f 706c 6f74 5b31 5d2b 302e 352c  lim_plot[1]+0.5,
-00025b20: 2079 706c 6f74 5b69 5d29 2c0a 2020 2020   yplot[i]),.    
-00025b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025b40: 2020 2020 2078 7963 6f6f 7264 733d 2264       xycoords="d
-00025b50: 6174 6122 2c20 666f 6e74 7369 7a65 3d38  ata", fontsize=8
-00025b60: 290a 2020 2020 2020 2020 2020 2020 593d  ).            Y=
-00025b70: 592b 595f 7375 6d0a 2020 2020 2020 2020  Y+Y_sum.        
-00025b80: 2020 2020 693d 692b 310a 0a20 2020 2020      i=i+1..     
-00025b90: 2020 2065 6c69 6620 6a75 7374 5f70 6c6f     elif just_plo
-00025ba0: 7420 6973 2054 7275 653a 0a20 2020 2020  t is True:.     
-00025bb0: 2020 2020 2020 2044 6966 663d 6e70 2e6d         Diff=np.m
-00025bc0: 6178 2879 5f70 6c6f 7429 2d6e 702e 6d69  ax(y_plot)-np.mi
-00025bd0: 6e28 795f 706c 6f74 290a 2020 2020 2020  n(y_plot).      
-00025be0: 2020 2020 2020 595f 7375 6d3d 6e70 2e6d        Y_sum=np.m
-00025bf0: 6178 2879 5f70 6c6f 7429 2f44 6966 660a  ax(y_plot)/Diff.
-00025c00: 2020 2020 2020 2020 2020 2020 6178 312e              ax1.
-00025c10: 706c 6f74 2878 5f70 6c6f 742c 2028 2879  plot(x_plot, ((y
-00025c20: 5f70 6c6f 742d 6e70 2e6d 696e 2879 5f70  _plot-np.min(y_p
-00025c30: 6c6f 7429 292f 4469 6666 292b 692c 2027  lot))/Diff)+i, '
-00025c40: 2d72 2729 0a20 2020 2020 2020 2020 2020  -r').           
-00025c50: 2061 7831 2e70 6c6f 7428 785f 706c 6f74   ax1.plot(x_plot
-00025c60: 2c20 2828 795f 706c 6f74 2d6e 702e 6d69  , ((y_plot-np.mi
-00025c70: 6e28 795f 706c 6f74 2929 2f44 6966 6629  n(y_plot))/Diff)
-00025c80: 2b69 2c20 272e 6b27 2c20 6d73 3d31 290a  +i, '.k', ms=1).
-00025c90: 2020 2020 2020 2020 2020 2020 7970 6c6f              yplo
-00025ca0: 745b 695d 3d6e 702e 6d69 6e28 2828 795f  t[i]=np.min(((y_
-00025cb0: 706c 6f74 2d6e 702e 6d69 6e28 795f 706c  plot-np.min(y_pl
-00025cc0: 6f74 2929 2f44 6966 6629 2b69 290a 2020  ot))/Diff)+i).  
-00025cd0: 2020 2020 2020 2020 2020 6178 312e 616e            ax1.an
-00025ce0: 6e6f 7461 7465 2873 7472 2866 696c 6529  notate(str(file)
-00025cf0: 2c20 7879 3d28 786c 696d 5f70 6c6f 745b  , xy=(xlim_plot[
-00025d00: 315d 2b30 2e35 2c20 7970 6c6f 745b 695d  1]+0.5, yplot[i]
-00025d10: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00025d20: 2020 2020 2020 2020 2020 2020 7879 636f              xyco
-00025d30: 6f72 6473 3d22 6461 7461 222c 2066 6f6e  ords="data", fon
-00025d40: 7473 697a 653d 3829 0a20 2020 2020 2020  tsize=8).       
-00025d50: 2020 2020 2059 3d59 2b59 5f73 756d 0a20       Y=Y+Y_sum. 
-00025d60: 2020 2020 2020 2020 2020 2069 3d69 2b31             i=i+1
-00025d70: 0a0a 0a0a 2020 2020 6466 5f70 6561 6b73  ....    df_peaks
-00025d80: 3d70 642e 4461 7461 4672 616d 6528 6461  =pd.DataFrame(da
-00025d90: 7461 3d7b 2770 6f73 273a 2070 6561 6b5f  ta={'pos': peak_
-00025da0: 706f 735f 7361 7665 642c 0a20 2020 2020  pos_saved,.     
-00025db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025dd0: 2020 2027 6865 6967 6874 273a 2070 6561     'height': pea
-00025de0: 6b5f 6865 6967 6874 5f73 6176 6564 2c0a  k_height_saved,.
-00025df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025e10: 2020 2020 2020 2020 2020 2020 2770 726f              'pro
-00025e20: 6d27 3a20 7065 616b 5f70 726f 6d5f 7361  m': peak_prom_sa
-00025e30: 7665 647d 290a 0a20 2020 2023 6966 2073  ved})..    #if s
-00025e40: 6967 6d61 5f66 696c 7465 7220 6973 2054  igma_filter is T
-00025e50: 7275 653a 0a20 2020 2020 2020 2023 6178  rue:.        #ax
-00025e60: 312e 706c 6f74 2864 665f 7065 616b 735b  1.plot(df_peaks[
-00025e70: 2770 6f73 275d 5b79 5f73 7461 723e 305d  'pos'][y_star>0]
-00025e80: 2c20 795f 7374 6172 5b79 5f73 7461 723e  , y_star[y_star>
-00025e90: 305d 2c20 272a 6b27 2c20 6d66 633d 2779  0], '*k', mfc='y
-00025ea0: 656c 6c6f 7727 2c20 6d73 3d31 3029 0a0a  ellow', ms=10)..
-00025eb0: 0a0a 0a0a 0a0a 0a0a 0a20 2020 2061 7831  .........    ax1
-00025ec0: 2e70 6c6f 7428 5b31 3037 382c 2031 3037  .plot([1078, 107
-00025ed0: 385d 2c20 5b30 2c20 7970 6c6f 745b 2d31  8], [0, yplot[-1
-00025ee0: 5d2b 325d 2c20 272d 6727 2c20 6c77 3d31  ]+2], '-g', lw=1
-00025ef0: 2c20 6c61 6265 6c3d 274e 6124 5f32 2443  , label='Na$_2$C
-00025f00: 4f24 5f33 2427 290a 2020 2020 6178 312e  O$_3$').    ax1.
-00025f10: 706c 6f74 285b 3130 3835 2c20 3130 3835  plot([1085, 1085
-00025f20: 5d2c 205b 302c 2079 706c 6f74 5b2d 315d  ], [0, yplot[-1]
-00025f30: 2b32 5d2c 2027 2d27 2c20 636f 6c6f 723d  +2], '-', color=
-00025f40: 2763 6f72 6e66 6c6f 7765 7262 6c75 6527  'cornflowerblue'
-00025f50: 2c20 6c77 3d31 2c20 6c61 6265 6c3d 2743  , lw=1, label='C
-00025f60: 6143 4f24 5f33 2427 290a 0a20 2020 2061  aCO$_3$')..    a
-00025f70: 7831 2e70 6c6f 7428 5b31 3039 342c 2031  x1.plot([1094, 1
-00025f80: 3039 345d 2c20 5b30 2c20 7970 6c6f 745b  094], [0, yplot[
-00025f90: 2d31 5d2b 325d 2c20 272d 6327 2c20 6c77  -1]+2], '-c', lw
-00025fa0: 3d31 2c20 6c61 6265 6c3d 274d 6743 4f24  =1, label='MgCO$
-00025fb0: 5f33 2427 290a 2020 2020 6178 312e 706c  _3$').    ax1.pl
-00025fc0: 6f74 285b 3130 3937 2c20 3130 3937 5d2c  ot([1097, 1097],
-00025fd0: 205b 302c 2079 706c 6f74 5b2d 315d 2b32   [0, yplot[-1]+2
-00025fe0: 5d2c 2027 2d62 272c 206c 773d 312c 206c  ], '-b', lw=1, l
-00025ff0: 6162 656c 3d27 446f 6c6f 6d69 7465 2729  abel='Dolomite')
-00026000: 0a20 2020 2061 7831 2e70 6c6f 7428 5b31  .    ax1.plot([1
-00026010: 3133 312c 2031 3133 315d 2c20 5b30 2c20  131, 1131], [0, 
-00026020: 7970 6c6f 745b 2d31 5d2b 325d 2c20 272d  yplot[-1]+2], '-
-00026030: 272c 2063 6f6c 6f72 3d27 6772 6579 272c  ', color='grey',
-00026040: 206c 773d 312c 206c 6162 656c 3d27 4361   lw=1, label='Ca
-00026050: 534f 245f 3424 2729 0a20 2020 2061 7831  SO$_4$').    ax1
-00026060: 2e70 6c6f 7428 5b31 3133 362c 2031 3133  .plot([1136, 113
-00026070: 365d 2c20 5b30 2c20 7970 6c6f 745b 2d31  6], [0, yplot[-1
-00026080: 5d2b 325d 2c20 272d 2d27 2c20 636f 6c6f  ]+2], '--', colo
-00026090: 723d 2772 6f73 7962 726f 776e 272c 206c  r='rosybrown', l
-000260a0: 773d 312c 206c 6162 656c 3d27 4d67 534f  w=1, label='MgSO
-000260b0: 245f 3424 2729 0a20 2020 2061 7831 2e70  $_4$').    ax1.p
-000260c0: 6c6f 7428 5b31 3135 312c 2031 3135 315d  lot([1151, 1151]
-000260d0: 2c20 5b30 2c20 7970 6c6f 745b 2d31 5d2b  , [0, yplot[-1]+
-000260e0: 325d 2c20 272d 6b27 2c20 6c77 3d31 2c20  2], '-k', lw=1, 
-000260f0: 6c61 6265 6c3d 2753 4f24 5f32 2427 290a  label='SO$_2$').
-00026100: 0a0a 2020 2020 6178 312e 6669 6c6c 5f62  ..    ax1.fill_b
-00026110: 6574 7765 656e 2878 6c69 6d5f 7065 616b  etween(xlim_peak
-00026120: 732c 202d 302e 352c 2079 706c 6f74 5b2d  s, -0.5, yplot[-
-00026130: 315d 2b33 2c20 636f 6c6f 723d 2762 6c75  1]+3, color='blu
-00026140: 6527 2c20 616c 7068 613d 302e 3129 0a0a  e', alpha=0.1)..
-00026150: 0a20 2020 2061 7831 2e6c 6567 656e 6428  .    ax1.legend(
-00026160: 6e63 6f6c 3d37 2c6c 6f63 3d27 7570 7065  ncol=7,loc='uppe
-00026170: 7220 6365 6e74 6572 272c 2066 6f6e 7473  r center', fonts
-00026180: 697a 653d 3130 2c20 2062 626f 785f 746f  ize=10,  bbox_to
-00026190: 5f61 6e63 686f 723d 5b30 2e35 2c20 312e  _anchor=[0.5, 1.
-000261a0: 3035 5d29 0a20 2020 2061 7831 2e73 6574  05]).    ax1.set
-000261b0: 5f79 6c69 6d28 5b2d 302e 352c 2079 706c  _ylim([-0.5, ypl
-000261c0: 6f74 5b2d 315d 2b33 5d29 0a20 2020 2061  ot[-1]+3]).    a
-000261d0: 7831 2e73 6574 5f78 6c69 6d28 5b78 6c69  x1.set_xlim([xli
-000261e0: 6d5f 706c 6f74 5b30 5d2c 2078 6c69 6d5f  m_plot[0], xlim_
-000261f0: 706c 6f74 5b31 5d2b 302e 355d 290a 0a20  plot[1]+0.5]).. 
-00026200: 2020 2023 2064 665f 7065 616b 733d 7064     # df_peaks=pd
-00026210: 2e44 6174 6146 7261 6d65 2864 6174 613d  .DataFrame(data=
-00026220: 7b27 6669 6c65 6e61 6d65 273a 2044 6961  {'filename': Dia
-00026230: 645f 4669 6c65 732c 0a20 2020 2023 2020  d_Files,.    #  
-00026240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026250: 2020 2020 2020 2027 706f 7327 3a20 7065         'pos': pe
-00026260: 616b 5f70 6f73 5f73 6176 6564 2c0a 2020  ak_pos_saved,.  
-00026270: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00026280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026290: 2770 726f 6d27 3a20 7065 616b 5f68 6569  'prom': peak_hei
-000262a0: 6768 745f 7361 7665 642d 7065 616b 5f62  ght_saved-peak_b
-000262b0: 636b 7d29 0a0a 0a0a 2020 2020 6178 312e  ck})....    ax1.
-000262c0: 7365 745f 786c 6162 656c 2827 5761 7665  set_xlabel('Wave
-000262d0: 6e75 6d62 6572 2028 636d 245e 7b2d 317d  number (cm$^{-1}
-000262e0: 2429 2729 0a20 2020 2061 7831 2e73 6574  $)').    ax1.set
-000262f0: 5f79 7469 636b 7328 5b5d 290a 0a20 2020  _yticks([])..   
-00026300: 2078 5f64 6174 613d 785f 7472 696d 0a0a   x_data=x_trim..
-00026310: 2020 2020 6466 5f70 6561 6b73 5b27 6669      df_peaks['fi
-00026320: 6c65 5f6e 616d 6573 275d 3d44 6961 645f  le_names']=Diad_
-00026330: 4669 6c65 730a 0a20 2020 2072 6574 7572  Files..    retur
-00026340: 6e20 6466 5f70 6561 6b73 2c20 785f 6461  n df_peaks, x_da
-00026350: 7461 2c20 795f 6461 7461 2c20 6669 670a  ta, y_data, fig.
-00026360: 0a0a 2323 2044 6961 6420 536b 6577 6e65  ..## Diad Skewne
-00026370: 7373 2066 726f 6d20 4465 5669 7472 6520  ss from DeVitre 
-00026380: 6574 2061 6c2e 0a0a 696d 706f 7274 2070  et al...import p
-00026390: 616e 6461 7320 6173 2070 640a 696d 706f  andas as pd.impo
-000263a0: 7274 206e 756d 7079 2061 7320 6e70 0a69  rt numpy as np.i
-000263b0: 6d70 6f72 7420 6d61 7470 6c6f 746c 6962  mport matplotlib
-000263c0: 2e70 7970 6c6f 7420 6173 2070 6c74 0a66  .pyplot as plt.f
-000263d0: 726f 6d20 7363 6970 792e 7369 676e 616c  rom scipy.signal
-000263e0: 2069 6d70 6f72 7420 6669 6e64 5f70 6561   import find_pea
-000263f0: 6b73 0a23 204e 6577 2074 6869 6e67 7320  ks.# New things 
-00026400: 6e65 6564 6564 2068 6572 650a 6672 6f6d  needed here.from
-00026410: 2073 6369 7079 2e69 6e74 6572 706f 6c61   scipy.interpola
-00026420: 7465 2069 6d70 6f72 7420 696e 7465 7270  te import interp
-00026430: 3164 0a66 726f 6d20 7363 6970 792e 7369  1d.from scipy.si
-00026440: 676e 616c 2069 6d70 6f72 7420 6669 6e64  gnal import find
-00026450: 5f70 6561 6b73 0a69 6d70 6f72 7420 6f73  _peaks.import os
-00026460: 0a66 726f 6d20 6f73 2069 6d70 6f72 7420  .from os import 
-00026470: 6c69 7374 6469 720a 6672 6f6d 206f 732e  listdir.from os.
-00026480: 7061 7468 2069 6d70 6f72 7420 6973 6669  path import isfi
-00026490: 6c65 2c20 6a6f 696e 0a66 726f 6d20 4469  le, join.from Di
-000264a0: 6164 4669 742e 696d 706f 7274 696e 675f  adFit.importing_
-000264b0: 6461 7461 5f66 696c 6573 2069 6d70 6f72  data_files impor
-000264c0: 7420 2a0a 6672 6f6d 2044 6961 6446 6974  t *.from DiadFit
-000264d0: 2e64 6961 6473 2069 6d70 6f72 7420 2a0a  .diads import *.
-000264e0: 0a6e 702e 7365 7465 7272 2028 696e 7661  .np.seterr (inva
-000264f0: 6c69 643d 2772 6169 7365 2729 0a0a 656e  lid='raise')..en
-00026500: 636f 6465 3d22 4953 4f2d 3838 3539 2d31  code="ISO-8859-1
-00026510: 220a 0a0a 0a0a 0a0a 6465 6620 6173 7365  ".......def asse
-00026520: 7373 5f64 6961 6431 5f73 6b65 776e 6573  ss_diad1_skewnes
-00026530: 7328 2a2c 2020 636f 6e66 6967 313a 2064  s(*,  config1: d
-00026540: 6961 6431 5f66 6974 5f63 6f6e 6669 673d  iad1_fit_config=
-00026550: 6469 6164 315f 6669 745f 636f 6e66 6967  diad1_fit_config
-00026560: 2829 2c20 696e 745f 6375 745f 6f66 663d  (), int_cut_off=
-00026570: 302e 332c 2070 6174 683d 4e6f 6e65 2c20  0.3, path=None, 
-00026580: 6669 6c65 6e61 6d65 3d4e 6f6e 652c 2066  filename=None, f
-00026590: 696c 6574 7970 653d 4e6f 6e65 2c0a 736b  iletype=None,.sk
-000265a0: 6577 6e65 7373 3d27 6162 7327 2c20 6865  ewness='abs', he
-000265b0: 6967 6874 3d31 2c20 7072 6f6d 696e 656e  ight=1, prominen
-000265c0: 6365 3d35 2c20 7769 6474 683d 302e 352c  ce=5, width=0.5,
-000265d0: 2070 6c6f 745f 6669 6775 7265 3d54 7275   plot_figure=Tru
-000265e0: 652c 2070 6561 6b5f 6669 745f 726f 7574  e, peak_fit_rout
-000265f0: 696e 653d 4661 6c73 652c 2070 6561 6b5f  ine=False, peak_
-00026600: 706f 733d 4e6f 6e65 2c20 7065 616b 5f68  pos=None, peak_h
-00026610: 6569 6768 743d 4e6f 6e65 2c20 6470 693d  eight=None, dpi=
-00026620: 3230 302c 2064 6961 645f 6172 7261 793d  200, diad_array=
-00026630: 4e6f 6e65 293a 0a20 2020 2022 2222 2041  None):.    """ A
-00026640: 7373 6573 7365 7320 536b 6577 6e65 7373  ssesses Skewness
-00026650: 206f 6620 4469 6164 2070 6561 6b73 2e20   of Diad peaks. 
-00026660: 5573 6566 756c 2066 6f72 2069 6465 6e74  Useful for ident
-00026670: 6966 7969 6e67 206d 6978 6564 204c 202b  ifying mixed L +
-00026680: 2056 2070 6861 7365 730a 2020 2020 2873   V phases.    (s
-00026690: 6565 2044 6556 6974 7265 2065 7420 616c  ee DeVitre et al
-000266a0: 2e20 696e 2072 6576 6965 7729 0a0a 0a20  . in review)... 
-000266b0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-000266c0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020    -----------.  
-000266d0: 2020 636f 6e66 6967 313a 2064 6961 6431    config1: diad1
-000266e0: 5f66 6974 5f63 6f6e 6669 6728 2920 6461  _fit_config() da
-000266f0: 7461 636c 6173 732e 2049 6d70 6f72 7420  taclass. Import 
-00026700: 7061 7261 6d65 7465 7273 2066 6f72 2074  parameters for t
-00026710: 6869 7320 6675 6e63 7469 6f6e 2061 7265  his function are
-00026720: 2e0a 0a20 2020 2020 2020 206c 6f77 6572  ...        lower
-00026730: 5f62 636b 5f64 6961 6431 2c20 7570 7065  _bck_diad1, uppe
-00026740: 725f 6263 6b5f 6469 6164 313a 205b 666c  r_bck_diad1: [fl
-00026750: 6f61 742c 2066 6c6f 6174 5d0a 2020 2020  oat, float].    
-00026760: 2020 2020 2020 2020 6261 636b 6772 6f75          backgrou
-00026770: 6e64 2070 6f73 6974 696f 6e20 746f 206c  nd position to l
-00026780: 6566 7420 616e 6420 7269 6768 7420 6f66  eft and right of
-00026790: 206f 7665 7261 6c20 6469 6164 2072 6567   overal diad reg
-000267a0: 696f 6e20 2869 6e63 2064 6961 642b 2d48  ion (inc diad+-H
-000267b0: 422b 2d43 3133 290a 0a20 2020 2020 2020  B+-C13)..       
-000267c0: 204e 5f70 6f6c 795f 6263 6b5f 6469 6164   N_poly_bck_diad
-000267d0: 313a 2069 6e74 0a20 2020 2020 2020 2020  1: int.         
-000267e0: 2020 2064 6567 7265 6520 6f66 2070 6f6c     degree of pol
-000267f0: 796e 6f6d 6961 6c20 746f 2066 6974 2074  ynomial to fit t
-00026800: 6f20 7468 6520 6261 636b 6772 6f75 6e64  o the background
-00026810: 2e0a 0a20 2020 2020 2020 2065 7863 6c75  ...        exclu
-00026820: 6465 5f72 616e 6765 312c 2065 7863 6c75  de_range1, exclu
-00026830: 6465 5f72 616e 6765 323a 2054 7570 6c65  de_range2: Tuple
-00026840: 5b66 6c6f 6174 2c20 666c 6f61 745d 0a20  [float, float]. 
-00026850: 2020 2020 2020 2020 2020 2052 616e 6765             Range
-00026860: 2074 6f20 6578 636c 7564 650a 0a20 2020   to exclude..   
-00026870: 2069 6e74 5f63 7574 5f6f 6666 3a20 666c   int_cut_off: fl
-00026880: 6f61 740a 2020 2020 2020 2020 5661 6c75  oat.        Valu
-00026890: 6520 6f66 2069 6e74 656e 7369 7479 2061  e of intensity a
-000268a0: 7420 7768 6963 6820 746f 2063 616c 6375  t which to calcu
-000268b0: 6c61 7465 2074 6865 2073 6b65 776e 6573  late the skewnes
-000268c0: 7320 2865 2e67 2e20 302e 3135 5820 7468  s (e.g. 0.15X th
-000268d0: 6520 7065 616b 2068 6569 6768 7429 2e0a  e peak height)..
-000268e0: 0a20 2020 2070 6174 683a 2073 7472 0a20  .    path: str. 
-000268f0: 2020 2020 2020 2046 6f6c 6465 7220 7573         Folder us
-00026900: 6572 2077 6973 6865 7320 746f 2072 6561  er wishes to rea
-00026910: 6420 6461 7461 2066 726f 6d0a 0a20 2020  d data from..   
-00026920: 2066 696c 656e 616d 653a 2073 7472 0a20   filename: str. 
-00026930: 2020 2020 2020 2053 7065 6369 6669 6320         Specific 
-00026940: 6669 6c65 2062 6569 6e67 2072 6561 640a  file being read.
-00026950: 0a0a 2020 2020 6669 6c65 7479 7065 3a20  ..    filetype: 
-00026960: 7374 720a 2020 2020 2020 2020 4964 656e  str.        Iden
-00026970: 7469 6669 6573 2074 7970 6520 6f66 2066  tifies type of f
-00026980: 696c 650a 2020 2020 2020 2020 6368 6f6f  ile.        choo
-00026990: 7365 2066 726f 6d20 2757 6974 6563 5f41  se from 'Witec_A
-000269a0: 5343 4949 272c 2027 6865 6164 6c65 7373  SCII', 'headless
-000269b0: 5f74 7874 272c 2027 6865 6164 6c65 7373  _txt', 'headless
-000269c0: 5f63 7376 272c 2027 6865 6164 5f63 7376  _csv', 'head_csv
-000269d0: 272c 2027 5769 7465 635f 4153 4349 4927  ', 'Witec_ASCII'
-000269e0: 2c0a 2020 2020 2020 2020 2748 4f52 4942  ,.        'HORIB
-000269f0: 415f 7478 7427 2c20 2752 656e 6973 6861  A_txt', 'Renisha
-00026a00: 775f 7478 7427 0a0a 2020 2020 736b 6577  w_txt'..    skew
-00026a10: 6e65 7373 3a20 2761 6273 2720 6f72 2027  ness: 'abs' or '
-00026a20: 6469 7227 0a20 2020 2020 2020 2049 6620  dir'.        If 
-00026a30: 2761 6273 272c 2067 6976 6573 2061 6273  'abs', gives abs
-00026a40: 6f6c 7574 6520 736b 6577 6e65 7373 2028  olute skewness (
-00026a50: 652e 672e 2c20 6c61 7267 6573 7420 706f  e.g., largest po
-00026a60: 7373 6962 6c65 206e 756d 6265 7220 7265  ssible number re
-00026a70: 6761 7264 6c65 7373 206f 6620 6469 7265  gardless of dire
-00026a80: 6374 696f 6e29 0a20 2020 2020 2020 2069  ction).        i
-00026a90: 6620 2764 6972 2720 646f 6573 2073 6b65  f 'dir' does ske
-00026aa0: 776e 6573 7320 6173 206f 6e65 2073 6964  wness as one sid
-00026ab0: 6520 6f76 6572 2074 6865 206f 7468 6572  e over the other
-00026ac0: 0a0a 0a20 2020 2068 6569 6768 742c 2070  ...    height, p
-00026ad0: 726f 6d69 6e65 6e63 652c 2077 6964 7468  rominence, width
-00026ae0: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
-00026af0: 5363 6970 7920 6669 6e64 2070 6561 6b20  Scipy find peak 
-00026b00: 7061 7261 6d65 7465 7273 0a0a 2020 2020  parameters..    
-00026b10: 706c 6f74 5f66 6967 7572 653a 2062 6f6f  plot_figure: boo
-00026b20: 6c0a 2020 2020 2020 2020 6966 2054 7275  l.        if Tru
-00026b30: 652c 2070 6c6f 7473 2061 6e64 2073 6176  e, plots and sav
-00026b40: 6573 2061 2066 6967 7572 652e 0a0a 2020  es a figure...  
-00026b50: 2020 6470 693a 2069 6e74 0a20 2020 2020    dpi: int.     
-00026b60: 2020 2064 7069 2074 6f20 7361 7665 2069     dpi to save i
-00026b70: 6d61 6765 2061 740a 0a20 2020 2070 6561  mage at..    pea
-00026b80: 6b5f 6669 745f 726f 7574 696e 653a 2062  k_fit_routine: b
-00026b90: 6f6f 6c20 2864 6566 6175 6c74 2046 616c  ool (default Fal
-00026ba0: 7365 2920 2d0a 2020 2020 2020 2020 6966  se) -.        if
-00026bb0: 2054 7275 652c 2064 6f65 736e 7420 6669   True, doesnt fi
-00026bc0: 6e64 206d 6178 206f 6620 7370 6c69 6e65  nd max of spline
-00026bd0: 2c20 6275 7420 7573 6573 2074 6865 2070  , but uses the p
-00026be0: 6561 6b20 706f 7369 7469 6f6e 2079 6f75  eak position you
-00026bf0: 2068 6176 6520 666f 756e 6420 6672 6f6d   have found from
-00026c00: 2074 6865 2064 6961 6420 6669 7474 696e   the diad fittin
-00026c10: 6720 6675 6e63 7469 6f6e 732e 0a20 2020  g functions..   
-00026c20: 2020 2020 2041 6c73 6f20 6e65 6564 7320       Also needs 
-00026c30: 7065 616b 5f70 6f73 2028 7065 616b 2063  peak_pos (peak c
-00026c40: 656e 7465 7220 696e 2063 6d2d 3129 2061  enter in cm-1) a
-00026c50: 6e64 2070 6561 6b5f 6865 6967 6874 0a0a  nd peak_height..
-00026c60: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
-00026c70: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020   -----------.   
-00026c80: 2070 642e 4461 7461 4672 616d 6520 7769   pd.DataFrame wi
-00026c90: 7468 2069 6e66 6f72 6d61 7469 6f6e 2061  th information a
-00026ca0: 626f 7574 2066 696c 6520 616e 6420 736b  bout file and sk
-00026cb0: 6577 6e65 7373 2070 6172 616d 6574 6572  ewness parameter
-00026cc0: 732e 0a0a 2020 2020 2222 220a 0a0a 0a20  s...    """.... 
-00026cd0: 2020 2079 5f63 6f72 725f 6469 6164 312c     y_corr_diad1,
-00026ce0: 2050 795f 6261 7365 5f64 6961 6431 2c20   Py_base_diad1, 
-00026cf0: 785f 6469 6164 312c 2020 4469 6164 5f73  x_diad1,  Diad_s
-00026d00: 686f 7274 2c20 5079 5f62 6173 655f 6469  hort, Py_base_di
-00026d10: 6164 312c 2050 665f 6261 7365 6c69 6e65  ad1, Pf_baseline
-00026d20: 2c20 2042 6173 656c 696e 655f 7973 7562  ,  Baseline_ysub
-00026d30: 5f64 6961 6431 2c20 4261 7365 6c69 6e65  _diad1, Baseline
-00026d40: 5f78 5f64 6961 6431 2c20 4261 7365 6c69  _x_diad1, Baseli
-00026d50: 6e65 2c20 7370 616e 3d72 656d 6f76 655f  ne, span=remove_
-00026d60: 6469 6164 5f62 6173 656c 696e 6528 0a20  diad_baseline(. 
-00026d70: 2020 2070 6174 683d 7061 7468 2c20 6669     path=path, fi
-00026d80: 6c65 6e61 6d65 3d66 696c 656e 616d 652c  lename=filename,
-00026d90: 2066 696c 6574 7970 653d 6669 6c65 7479   filetype=filety
-00026da0: 7065 2c20 4e5f 706f 6c79 3d63 6f6e 6669  pe, N_poly=confi
-00026db0: 6731 2e4e 5f70 6f6c 795f 6263 6b5f 6469  g1.N_poly_bck_di
-00026dc0: 6164 312c 0a20 2020 206c 6f77 6572 5f62  ad1,.    lower_b
-00026dd0: 636b 3d63 6f6e 6669 6731 2e6c 6f77 6572  ck=config1.lower
-00026de0: 5f62 636b 5f64 6961 6431 2c20 7570 7065  _bck_diad1, uppe
-00026df0: 725f 6263 6b3d 636f 6e66 6967 312e 7570  r_bck=config1.up
-00026e00: 7065 725f 6263 6b5f 6469 6164 312c 2070  per_bck_diad1, p
-00026e10: 6c6f 745f 6669 6775 7265 3d46 616c 7365  lot_figure=False
-00026e20: 2c20 6469 6164 5f61 7272 6179 3d64 6961  , diad_array=dia
-00026e30: 645f 6172 7261 7929 0a0a 0a0a 2020 2020  d_array)....    
-00026e40: 785f 6c69 6e5f 6261 7365 6c69 6e65 3d6e  x_lin_baseline=n
-00026e50: 702e 6c69 6e73 7061 6365 2863 6f6e 6669  p.linspace(confi
-00026e60: 6731 2e6c 6f77 6572 5f62 636b 5f64 6961  g1.lower_bck_dia
-00026e70: 6431 5b30 5d2c 2063 6f6e 6669 6731 2e75  d1[0], config1.u
-00026e80: 7070 6572 5f62 636b 5f64 6961 6431 5b31  pper_bck_diad1[1
-00026e90: 5d2c 2031 3030 3030 3029 0a20 2020 2079  ], 100000).    y
-00026ea0: 6261 7365 5f78 6c69 6e3d 5066 5f62 6173  base_xlin=Pf_bas
-00026eb0: 656c 696e 6528 785f 6c69 6e5f 6261 7365  eline(x_lin_base
-00026ec0: 6c69 6e65 290a 0a0a 0a20 2020 2023 2047  line)....    # G
-00026ed0: 6574 2078 2061 6e64 2079 2072 6561 6479  et x and y ready
-00026ee0: 2074 6f20 6d61 6b65 2061 2063 7562 6963   to make a cubic
-00026ef0: 2073 706c 696e 6520 7468 726f 7567 6820   spline through 
-00026f00: 6461 7461 0a20 2020 2078 3d78 5f64 6961  data.    x=x_dia
-00026f10: 6431 0a20 2020 2079 3d79 5f63 6f72 725f  d1.    y=y_corr_
-00026f20: 6469 6164 310a 0a20 2020 2023 2046 6974  diad1..    # Fit
-00026f30: 2061 2020 6375 6269 6320 7370 6c69 6e65   a  cubic spline
-00026f40: 0a20 2020 2066 3220 3d20 696e 7465 7270  .    f2 = interp
-00026f50: 3164 2878 2c20 792c 206b 696e 643d 2763  1d(x, y, kind='c
-00026f60: 7562 6963 2729 0a20 2020 2078 5f6e 6577  ubic').    x_new
-00026f70: 3d6e 702e 6c69 6e73 7061 6365 286e 702e  =np.linspace(np.
-00026f80: 6d69 6e28 7829 2c20 6e70 2e6d 6178 2878  min(x), np.max(x
-00026f90: 292c 2031 3030 3030 3029 0a0a 2020 2020  ), 100000)..    
-00026fa0: 795f 6375 623d 6632 2878 5f6e 6577 290a  y_cub=f2(x_new).
-00026fb0: 0a0a 0a20 2020 2023 2055 7365 2053 6369  ...    # Use Sci
-00026fc0: 7079 2066 696e 6420 7065 616b 7320 746f  py find peaks to
-00026fd0: 2067 6574 2074 6865 2062 6967 6765 7374   get the biggest
-00026fe0: 2070 6561 6b0a 2020 2020 6966 2070 6561   peak.    if pea
-00026ff0: 6b5f 6669 745f 726f 7574 696e 6520 6973  k_fit_routine is
-00027000: 2046 616c 7365 3a0a 2020 2020 2020 2020   False:.        
-00027010: 6865 6967 6874 3d68 6569 6768 740a 2020  height=height.  
-00027020: 2020 2020 2020 7065 616b 7320 3d20 6669        peaks = fi
-00027030: 6e64 5f70 6561 6b73 2879 5f63 7562 2c20  nd_peaks(y_cub, 
-00027040: 6865 6967 6874 3d68 6569 6768 742c 2070  height=height, p
-00027050: 726f 6d69 6e65 6e63 653d 7072 6f6d 696e  rominence=promin
-00027060: 656e 6365 2c20 7769 6474 683d 7769 6474  ence, width=widt
-00027070: 6829 0a20 2020 2020 2020 2070 6561 6b5f  h).        peak_
-00027080: 6865 6967 6874 3d70 6561 6b73 5b31 5d5b  height=peaks[1][
-00027090: 2770 6561 6b5f 6865 6967 6874 7327 5d0a  'peak_heights'].
-000270a0: 2020 2020 2020 2020 7065 616b 5f70 6f73          peak_pos
-000270b0: 203d 2078 5f6e 6577 5b70 6561 6b73 5b30   = x_new[peaks[0
-000270c0: 5d5d 0a0a 0a20 2020 2020 2020 2023 2066  ]]...        # f
-000270d0: 696e 6420 6d61 7820 7065 616b 2e20 2070  ind max peak.  p
-000270e0: 7574 2069 6e74 6f20 6466 2062 6563 6175  ut into df becau
-000270f0: 7365 2069 276d 206c 617a 790a 2020 2020  se i'm lazy.    
-00027100: 2020 2020 7065 616b 5f64 663d 7064 2e44      peak_df=pd.D
-00027110: 6174 6146 7261 6d65 2864 6174 613d 7b27  ataFrame(data={'
-00027120: 706f 7327 3a20 7065 616b 5f70 6f73 2c0a  pos': peak_pos,.
-00027130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027140: 2020 2020 2020 2020 2020 2020 2768 6569              'hei
-00027150: 6768 7427 3a20 7065 616b 5f68 6569 6768  ght': peak_heigh
-00027160: 747d 290a 0a20 2020 2020 2020 2023 2046  t})..        # F
-00027170: 696e 6420 6269 6765 7374 2070 6561 6b73  ind bigest peaks
-00027180: 2c0a 2020 2020 2020 2020 6466 5f70 6561  ,.        df_pea
-00027190: 6b5f 736f 7274 3d70 6561 6b5f 6466 2e73  k_sort=peak_df.s
-000271a0: 6f72 745f 7661 6c75 6573 2827 6865 6967  ort_values('heig
-000271b0: 6874 272c 2061 7869 733d 302c 2061 7363  ht', axis=0, asc
-000271c0: 656e 6469 6e67 3d46 616c 7365 290a 2020  ending=False).  
-000271d0: 2020 2020 2020 6466 5f70 6561 6b5f 736f        df_peak_so
-000271e0: 7274 5f74 7269 6d3d 6466 5f70 6561 6b5f  rt_trim=df_peak_
-000271f0: 736f 7274 5b30 3a31 5d0a 2020 2020 2020  sort[0:1].      
-00027200: 2020 5065 616b 5f43 656e 7465 723d 6466    Peak_Center=df
-00027210: 5f70 6561 6b5f 736f 7274 5f74 7269 6d5b  _peak_sort_trim[
-00027220: 2770 6f73 275d 0a20 2020 2020 2020 2050  'pos'].        P
-00027230: 6561 6b5f 4865 6967 6874 3d64 665f 7065  eak_Height=df_pe
-00027240: 616b 5f73 6f72 745f 7472 696d 5b27 6865  ak_sort_trim['he
-00027250: 6967 6874 275d 0a0a 2020 2020 2320 6e6f  ight']..    # no
-00027260: 7720 7765 2061 7265 2075 7369 6e67 2070  w we are using p
-00027270: 6561 6b20 7061 7261 6d65 7465 7273 2077  eak parameters w
-00027280: 6520 676f 7420 6672 6f6d 2056 6f69 6774  e got from Voigt
-00027290: 2f50 7365 7564 6f76 6f69 6774 2065 7463  /Pseudovoigt etc
-000272a0: 2e0a 2020 2020 6966 2070 6561 6b5f 6669  ..    if peak_fi
-000272b0: 745f 726f 7574 696e 6520 6973 2054 7275  t_routine is Tru
-000272c0: 653a 0a20 2020 2020 2020 2050 6561 6b5f  e:.        Peak_
-000272d0: 4865 6967 6874 3d70 6561 6b5f 6865 6967  Height=peak_heig
-000272e0: 6874 0a20 2020 2020 2020 2050 6561 6b5f  ht.        Peak_
-000272f0: 4365 6e74 6572 3d70 6561 6b5f 706f 730a  Center=peak_pos.
-00027300: 0a0a 0a20 2020 2023 2046 696e 6420 696e  ...    # Find in
-00027310: 7465 6e73 6974 7920 6375 7420 6f66 660a  tensity cut off.
-00027320: 2020 2020 795f 696e 745f 6375 743d 5065      y_int_cut=Pe
-00027330: 616b 5f48 6569 6768 742e 696c 6f63 5b30  ak_Height.iloc[0
-00027340: 5d2a 696e 745f 6375 745f 6f66 660a 0a20  ]*int_cut_off.. 
-00027350: 2020 2023 2053 706c 6974 2074 6865 2061     # Split the a
-00027360: 7272 6179 2069 6e74 6f20 6120 4c48 5320  rray into a LHS 
-00027370: 616e 6420 6120 5248 530a 0a20 2020 204c  and a RHS..    L
-00027380: 4853 5f79 3d79 5f63 7562 5b78 5f6e 6577  HS_y=y_cub[x_new
-00027390: 3c3d 5065 616b 5f43 656e 7465 722e 7661  <=Peak_Center.va
-000273a0: 6c75 6573 5d0a 2020 2020 5248 535f 793d  lues].    RHS_y=
-000273b0: 795f 6375 625b 785f 6e65 773e 5065 616b  y_cub[x_new>Peak
-000273c0: 5f43 656e 7465 722e 7661 6c75 6573 5d0a  _Center.values].
-000273d0: 0a20 2020 204c 4853 5f78 3d78 5f6e 6577  .    LHS_x=x_new
-000273e0: 5b78 5f6e 6577 3c3d 5065 616b 5f43 656e  [x_new<=Peak_Cen
-000273f0: 7465 722e 7661 6c75 6573 5d0a 2020 2020  ter.values].    
-00027400: 5248 535f 783d 785f 6e65 775b 785f 6e65  RHS_x=x_new[x_ne
-00027410: 773e 5065 616b 5f43 656e 7465 722e 7661  w>Peak_Center.va
-00027420: 6c75 6573 5d0a 0a20 2020 2023 204e 6565  lues]..    # Nee
-00027430: 6420 746f 2066 6c69 7020 4c48 5320 746f  d to flip LHS to
-00027440: 2070 7574 2069 6e74 6f20 7468 6520 6669   put into the fi
-00027450: 6e64 2063 6c6f 7365 7374 2066 756e 6374  nd closest funct
-00027460: 696f 6e0a 2020 2020 4c48 535f 795f 666c  ion.    LHS_y_fl
-00027470: 6970 3d6e 702e 666c 6970 284c 4853 5f79  ip=np.flip(LHS_y
-00027480: 290a 2020 2020 4c48 535f 785f 666c 6970  ).    LHS_x_flip
-00027490: 3d6e 702e 666c 6970 284c 4853 5f78 290a  =np.flip(LHS_x).
-000274a0: 0a20 2020 2076 616c 3d6e 702e 6172 676d  .    val=np.argm
-000274b0: 6178 284c 4853 5f79 5f66 6c69 703c 795f  ax(LHS_y_flip<y_
-000274c0: 696e 745f 6375 7429 0a0a 2020 2020 7661  int_cut)..    va
-000274d0: 6c32 3d6e 702e 6172 676d 6178 2852 4853  l2=np.argmax(RHS
-000274e0: 5f79 3c79 5f69 6e74 5f63 7574 290a 0a0a  _y<y_int_cut)...
-000274f0: 2020 2020 2320 4669 6e64 206e 6561 7265      # Find neare
-00027500: 7374 2078 2075 6e69 7420 746f 2074 6869  st x unit to thi
-00027510: 7320 7661 6c75 650a 2020 2020 795f 6e65  s value.    y_ne
-00027520: 6172 6573 745f 4c48 533d 4c48 535f 795f  arest_LHS=LHS_y_
-00027530: 666c 6970 5b76 616c 5d0a 2020 2020 785f  flip[val].    x_
-00027540: 6e65 6172 6573 745f 4c48 533d 4c48 535f  nearest_LHS=LHS_
-00027550: 785f 666c 6970 5b76 616c 5d0a 0a20 2020  x_flip[val]..   
-00027560: 2079 5f6e 6561 7265 7374 5f52 4853 3d52   y_nearest_RHS=R
-00027570: 4853 5f79 5b76 616c 325d 0a20 2020 2078  HS_y[val2].    x
-00027580: 5f6e 6561 7265 7374 5f52 4853 3d52 4853  _nearest_RHS=RHS
-00027590: 5f78 5b76 616c 325d 0a0a 0a20 2020 2023  _x[val2]...    #
-000275a0: 2052 6574 7572 6e20 536b 6577 6e65 7373   Return Skewness
-000275b0: 0a20 2020 204c 4853 5f43 656e 7465 723d  .    LHS_Center=
-000275c0: 6162 7328 785f 6e65 6172 6573 745f 4c48  abs(x_nearest_LH
-000275d0: 532d 5065 616b 5f43 656e 7465 7229 0a20  S-Peak_Center). 
-000275e0: 2020 2052 4853 5f43 656e 7465 723d 6162     RHS_Center=ab
-000275f0: 7328 785f 6e65 6172 6573 745f 5248 532d  s(x_nearest_RHS-
-00027600: 5065 616b 5f43 656e 7465 7229 0a0a 0a20  Peak_Center)... 
-00027610: 2020 2341 6c73 6f20 6765 7420 6f70 7469    #Also get opti
-00027620: 6f6e 2074 6f20 616c 7761 7973 2074 616b  on to always tak
-00027630: 6520 6269 6767 6573 7420 7661 6c75 6520  e biggest value 
-00027640: 6f66 2073 6b65 776e 6573 730a 2020 2020  of skewness.    
-00027650: 6966 2073 6b65 776e 6573 733d 3d27 6162  if skewness=='ab
-00027660: 7327 3a0a 2020 2020 2020 2020 6966 204c  s':.        if L
-00027670: 4853 5f43 656e 7465 722e 7661 6c75 6573  HS_Center.values
-00027680: 3e52 4853 5f43 656e 7465 722e 7661 6c75  >RHS_Center.valu
-00027690: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-000276a0: 4153 3d4c 4853 5f43 656e 7465 722e 7661  AS=LHS_Center.va
-000276b0: 6c75 6573 2f52 4853 5f43 656e 7465 722e  lues/RHS_Center.
-000276c0: 7661 6c75 6573 0a20 2020 2020 2020 2065  values.        e
-000276d0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000276e0: 2041 533d 5248 535f 4365 6e74 6572 2e76   AS=RHS_Center.v
-000276f0: 616c 7565 732f 4c48 535f 4365 6e74 6572  alues/LHS_Center
-00027700: 2e76 616c 7565 730a 2020 2020 656c 6966  .values.    elif
-00027710: 2073 6b65 776e 6573 733d 3d27 6469 7227   skewness=='dir'
-00027720: 3a0a 2020 2020 2020 2020 4153 3d52 4853  :.        AS=RHS
-00027730: 5f43 656e 7465 722e 7661 6c75 6573 2f4c  _Center.values/L
-00027740: 4853 5f43 656e 7465 722e 7661 6c75 6573  HS_Center.values
-00027750: 0a0a 0a20 2020 2069 6620 706c 6f74 5f66  ...    if plot_f
-00027760: 6967 7572 6520 6973 2054 7275 653a 0a0a  igure is True:..
-00027770: 2020 2020 2020 2020 2320 4d61 6b65 2070          # Make p
-00027780: 7265 7474 7920 6669 6775 7265 2073 686f  retty figure sho
-00027790: 7769 6e67 2062 6163 6b67 726f 756e 6420  wing background 
-000277a0: 7375 6274 7261 6374 6f69 6e20 726f 7574  subtractoin rout
-000277b0: 696e 650a 2020 2020 2020 2020 6669 672c  ine.        fig,
-000277c0: 2028 2861 7832 2c20 6178 3129 2c20 2861   ((ax2, ax1), (a
-000277d0: 7833 2c20 6178 3429 2920 3d20 706c 742e  x3, ax4)) = plt.
-000277e0: 7375 6270 6c6f 7473 2832 2c20 322c 2066  subplots(2, 2, f
-000277f0: 6967 7369 7a65 3d28 3130 2c31 3029 290a  igsize=(10,10)).
-00027800: 2020 2020 2020 2020 6669 672e 7375 7074          fig.supt
-00027810: 6974 6c65 2827 4469 6164 2031 2053 6b65  itle('Diad 1 Ske
-00027820: 776e 6573 7320 6669 6c65 3d20 272b 2073  wness file= '+ s
-00027830: 7472 2866 696c 656e 616d 6529 2c20 666f  tr(filename), fo
-00027840: 6e74 7369 7a65 3d31 362c 2078 3d30 2e35  ntsize=16, x=0.5
-00027850: 2c20 793d 312e 3029 0a0a 2020 2020 2020  , y=1.0)..      
-00027860: 2020 6178 322e 7365 745f 7469 746c 6528    ax2.set_title(
-00027870: 2761 2920 5370 6563 7472 6127 290a 2020  'a) Spectra').  
-00027880: 2020 2020 2020 6178 322e 706c 6f74 2844        ax2.plot(D
-00027890: 6961 645f 7368 6f72 745b 3a2c 2030 5d2c  iad_short[:, 0],
-000278a0: 2044 6961 645f 7368 6f72 745b 3a2c 2031   Diad_short[:, 1
-000278b0: 5d2c 2027 2d72 272c 206c 6162 656c 3d27  ], '-r', label='
-000278c0: 4461 7461 2729 0a20 2020 2020 2020 2061  Data').        a
-000278d0: 7832 2e73 6574 5f78 6c69 6d28 5b63 6f6e  x2.set_xlim([con
-000278e0: 6669 6731 2e6c 6f77 6572 5f62 636b 5f64  fig1.lower_bck_d
-000278f0: 6961 6431 5b30 5d2b 3430 2c20 636f 6e66  iad1[0]+40, conf
-00027900: 6967 312e 7570 7065 725f 6263 6b5f 6469  ig1.upper_bck_di
-00027910: 6164 315b 315d 2d34 305d 290a 2020 2020  ad1[1]-40]).    
-00027920: 2020 2020 6178 312e 7365 745f 7469 746c      ax1.set_titl
-00027930: 6528 2762 2920 4261 636b 6772 6f75 6e64  e('b) Background
-00027940: 2066 6974 2729 0a20 2020 2020 2020 2061   fit').        a
-00027950: 7831 2e70 6c6f 7428 4469 6164 5f73 686f  x1.plot(Diad_sho
-00027960: 7274 5b3a 2c20 305d 2c20 4469 6164 5f73  rt[:, 0], Diad_s
-00027970: 686f 7274 5b3a 2c20 315d 2c20 272e 2d63  hort[:, 1], '.-c
-00027980: 272c 206c 6162 656c 3d27 4461 7461 2729  ', label='Data')
-00027990: 0a0a 2020 2020 2020 2020 6178 312e 706c  ..        ax1.pl
-000279a0: 6f74 2842 6173 656c 696e 655b 3a2c 2030  ot(Baseline[:, 0
-000279b0: 5d2c 2042 6173 656c 696e 655b 3a2c 2031  ], Baseline[:, 1
-000279c0: 5d2c 2027 2e62 272c 206c 6162 656c 3d27  ], '.b', label='
-000279d0: 6263 6b27 290a 2020 2020 2020 2020 6178  bck').        ax
-000279e0: 312e 706c 6f74 2844 6961 645f 7368 6f72  1.plot(Diad_shor
-000279f0: 745b 3a2c 2030 5d2c 2050 795f 6261 7365  t[:, 0], Py_base
-00027a00: 5f64 6961 6431 2c20 272d 6b27 2c20 6c61  _diad1, '-k', la
-00027a10: 6265 6c3d 2762 636b 2066 6974 2729 0a20  bel='bck fit'). 
-00027a20: 2020 2020 2020 2061 7833 2e73 6574 5f74         ax3.set_t
-00027a30: 6974 6c65 2827 6329 2042 6163 6b67 726f  itle('c) Backgro
-00027a40: 756e 6420 7375 6274 7261 6374 6564 2729  und subtracted')
-00027a50: 0a20 2020 2020 2020 2061 7833 2e70 6c6f  .        ax3.plo
-00027a60: 7428 785f 6469 6164 312c 795f 636f 7272  t(x_diad1,y_corr
-00027a70: 5f64 6961 6431 2c20 272d 7227 2c20 6c61  _diad1, '-r', la
-00027a80: 6265 6c3d 2742 636b 2073 7562 2729 0a0a  bel='Bck sub')..
-00027a90: 2020 2020 2320 4164 6473 2063 7562 6963      # Adds cubic
-00027aa0: 2069 6e74 6572 706f 6c6f 6174 696f 6e20   interpoloation 
-00027ab0: 666f 7220 696e 7370 6563 7469 6f6e 0a0a  for inspection..
-00027ac0: 2020 2020 2020 2020 6178 342e 7365 745f          ax4.set_
-00027ad0: 7469 746c 6528 2764 2920 4375 6269 6320  title('d) Cubic 
-00027ae0: 5370 6c69 6e65 2729 0a0a 0a0a 0a20 2020  Spline').....   
-00027af0: 2020 2020 2061 7834 2e70 6c6f 7428 5b78       ax4.plot([x
-00027b00: 5f6e 6561 7265 7374 5f4c 4853 2c20 5065  _nearest_LHS, Pe
-00027b10: 616b 5f43 656e 7465 722e 696c 6f63 5b30  ak_Center.iloc[0
-00027b20: 5d5d 2c20 5b79 5f69 6e74 5f63 7574 2c20  ]], [y_int_cut, 
-00027b30: 795f 696e 745f 6375 745d 2c20 272d 6727  y_int_cut], '-g'
-00027b40: 290a 0a20 2020 2020 2020 2061 7834 2e61  )..        ax4.a
-00027b50: 6e6e 6f74 6174 6528 7374 7228 6e70 2e72  nnotate(str(np.r
-00027b60: 6f75 6e64 284c 4853 5f43 656e 7465 722e  ound(LHS_Center.
-00027b70: 7661 6c75 6573 5b30 5d2c 2032 2929 2c0a  values[0], 2)),.
-00027b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027b90: 2020 2020 2078 793d 2878 5f6e 6561 7265       xy=(x_neare
-00027ba0: 7374 5f4c 4853 2d33 2c20 795f 696e 745f  st_LHS-3, y_int_
-00027bb0: 6375 742b 2850 6561 6b5f 4865 6967 6874  cut+(Peak_Height
-00027bc0: 2d79 5f69 6e74 5f63 7574 292f 3130 292c  -y_int_cut)/10),
-00027bd0: 2078 7963 6f6f 7264 733d 2264 6174 6122   xycoords="data"
-00027be0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00027bf0: 2020 2020 2020 2066 6f6e 7473 697a 653d         fontsize=
-00027c00: 3132 2c20 636f 6c6f 723d 2767 7265 656e  12, color='green
-00027c10: 2729 0a20 2020 2020 2020 2061 7834 2e70  ').        ax4.p
-00027c20: 6c6f 7428 785f 6e65 6172 6573 745f 4c48  lot(x_nearest_LH
-00027c30: 532c 2079 5f6e 6561 7265 7374 5f4c 4853  S, y_nearest_LHS
-00027c40: 2c20 272a 6b27 2c20 6d66 633d 2767 7265  , '*k', mfc='gre
-00027c50: 656e 272c 6d73 3d31 352c 206c 6162 656c  en',ms=15, label
-00027c60: 3d27 5248 2074 6965 2729 0a0a 0a0a 2020  ='RH tie')....  
-00027c70: 2020 2020 2020 6178 342e 706c 6f74 285b        ax4.plot([
-00027c80: 5065 616b 5f43 656e 7465 722e 696c 6f63  Peak_Center.iloc
-00027c90: 5b30 5d2c 2078 5f6e 6561 7265 7374 5f52  [0], x_nearest_R
-00027ca0: 4853 5d2c 205b 795f 696e 745f 6375 742c  HS], [y_int_cut,
-00027cb0: 2079 5f69 6e74 5f63 7574 5d2c 2027 2d27   y_int_cut], '-'
-00027cc0: 2c20 636f 6c6f 723d 2767 7265 7927 290a  , color='grey').
-00027cd0: 2020 2020 2020 2020 6178 342e 616e 6e6f          ax4.anno
-00027ce0: 7461 7465 2873 7472 286e 702e 726f 756e  tate(str(np.roun
-00027cf0: 6428 5248 535f 4365 6e74 6572 2e76 616c  d(RHS_Center.val
-00027d00: 7565 735b 305d 2c20 3229 292c 0a20 2020  ues[0], 2)),.   
-00027d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d20: 2020 7879 3d28 785f 6e65 6172 6573 745f    xy=(x_nearest_
-00027d30: 5248 532b 332c 2079 5f69 6e74 5f63 7574  RHS+3, y_int_cut
-00027d40: 2b28 5065 616b 5f48 6569 6768 742e 696c  +(Peak_Height.il
-00027d50: 6f63 5b30 5d2d 795f 696e 745f 6375 7429  oc[0]-y_int_cut)
-00027d60: 2f31 3029 2c20 7879 636f 6f72 6473 3d22  /10), xycoords="
-00027d70: 6461 7461 222c 0a20 2020 2020 2020 2020  data",.         
-00027d80: 2020 2020 2020 2020 2020 2020 2066 6f6e               fon
-00027d90: 7473 697a 653d 3132 2c20 636f 6c6f 723d  tsize=12, color=
-00027da0: 2767 7265 7927 290a 2020 2020 2020 2020  'grey').        
-00027db0: 6178 342e 706c 6f74 2878 5f6e 6561 7265  ax4.plot(x_neare
-00027dc0: 7374 5f52 4853 2c20 795f 6e65 6172 6573  st_RHS, y_neares
-00027dd0: 745f 5248 532c 2027 2a6b 272c 206d 6663  t_RHS, '*k', mfc
-00027de0: 3d27 6772 6579 272c 206d 733d 3135 2c20  ='grey', ms=15, 
-00027df0: 6c61 6265 6c3d 274c 4820 7469 6527 290a  label='LH tie').
-00027e00: 0a0a 0a0a 2020 2020 2020 2020 6178 342e  ....        ax4.
-00027e10: 706c 6f74 2878 2c20 792c 2027 2e72 2729  plot(x, y, '.r')
-00027e20: 0a20 2020 2020 2020 2061 7834 2e70 6c6f  .        ax4.plo
-00027e30: 7428 785f 6e65 772c 2079 5f63 7562 2c20  t(x_new, y_cub, 
-00027e40: 272d 6b27 290a 0a20 2020 2020 2020 2061  '-k')..        a
-00027e50: 7834 2e70 6c6f 7428 5b50 6561 6b5f 4365  x4.plot([Peak_Ce
-00027e60: 6e74 6572 2e69 6c6f 635b 305d 2c20 5065  nter.iloc[0], Pe
-00027e70: 616b 5f43 656e 7465 722e 696c 6f63 5b30  ak_Center.iloc[0
-00027e80: 5d5d 2c20 5b50 6561 6b5f 4865 6967 6874  ]], [Peak_Height
-00027e90: 2e69 6c6f 635b 305d 2c20 5065 616b 5f48  .iloc[0], Peak_H
-00027ea0: 6569 6768 742e 696c 6f63 5b30 5d5d 2c0a  eight.iloc[0]],.
-00027eb0: 2020 2020 2020 2020 2020 2020 2027 2a6b               '*k
-00027ec0: 272c 206d 6663 3d27 626c 7565 272c 206d  ', mfc='blue', m
-00027ed0: 733d 3135 2c20 6c61 6265 6c3d 2753 6369  s=15, label='Sci
-00027ee0: 7079 2043 656e 7465 7227 290a 0a0a 2020  py Center')...  
-00027ef0: 2020 2020 2020 2320 4164 6420 746f 2070        # Add to p
-00027f00: 6c6f 740a 0a20 2020 2020 2020 2061 7834  lot..        ax4
-00027f10: 2e70 6c6f 7428 636f 6e66 6967 312e 6c6f  .plot(config1.lo
-00027f20: 7765 725f 6263 6b5f 6469 6164 315b 305d  wer_bck_diad1[0]
-00027f30: 2c20 636f 6e66 6967 312e 7570 7065 725f  , config1.upper_
-00027f40: 6263 6b5f 6469 6164 315b 315d 2c20 5b79  bck_diad1[1], [y
-00027f50: 5f69 6e74 5f63 7574 2c20 795f 696e 745f  _int_cut, y_int_
-00027f60: 6375 745d 2c20 273a 7227 290a 0a0a 0a0a  cut], ':r').....
-00027f70: 2020 2020 2020 2020 6178 342e 7365 745f          ax4.set_
-00027f80: 786c 696d 285b 785f 6e65 6172 6573 745f  xlim([x_nearest_
-00027f90: 4c48 532d 3130 2c20 785f 6e65 6172 6573  LHS-10, x_neares
-00027fa0: 745f 5248 532b 3130 5d29 0a20 2020 2020  t_RHS+10]).     
-00027fb0: 2020 2061 7834 2e73 6574 5f79 6c69 6d28     ax4.set_ylim(
-00027fc0: 5b30 2d31 302c 2050 6561 6b5f 4865 6967  [0-10, Peak_Heig
-00027fd0: 6874 2e69 6c6f 635b 305d 2a31 2e32 5d29  ht.iloc[0]*1.2])
-00027fe0: 0a20 2020 2020 2020 2061 7834 2e70 6c6f  .        ax4.plo
-00027ff0: 7428 5b50 6561 6b5f 4365 6e74 6572 2e69  t([Peak_Center.i
-00028000: 6c6f 635b 305d 2c20 5065 616b 5f43 656e  loc[0], Peak_Cen
-00028010: 7465 722e 696c 6f63 5b30 5d5d 2c20 5b30  ter.iloc[0]], [0
-00028020: 2c20 5065 616b 5f48 6569 6768 742e 696c  , Peak_Height.il
-00028030: 6f63 5b30 5d5d 2c20 273a 6227 290a 0a0a  oc[0]], ':b')...
-00028040: 0a20 2020 2020 2020 2061 7834 2e61 6e6e  .        ax4.ann
-00028050: 6f74 6174 6528 2753 6b65 776e 6573 733d  otate('Skewness=
-00028060: 272b 7374 7228 6e70 2e72 6f75 6e64 2841  '+str(np.round(A
-00028070: 535b 305d 2c20 3229 292c 0a20 2020 2020  S[0], 2)),.     
-00028080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028090: 7879 3d28 785f 6e65 6172 6573 745f 5248  xy=(x_nearest_RH
-000280a0: 532b 322c 2079 5f69 6e74 5f63 7574 2b79  S+2, y_int_cut+y
-000280b0: 5f69 6e74 5f63 7574 2b28 5065 616b 5f48  _int_cut+(Peak_H
-000280c0: 6569 6768 742e 696c 6f63 5b30 5d2d 795f  eight.iloc[0]-y_
-000280d0: 696e 745f 6375 7429 2f31 3029 2c20 7879  int_cut)/10), xy
-000280e0: 636f 6f72 6473 3d22 6461 7461 222c 0a20  coords="data",. 
-000280f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028100: 2020 2020 2066 6f6e 7473 697a 653d 3132       fontsize=12
-00028110: 290a 0a20 2020 2020 2020 2061 7832 2e6c  )..        ax2.l
-00028120: 6567 656e 6428 290a 2020 2020 2020 2020  egend().        
-00028130: 6178 312e 6c65 6765 6e64 2829 0a20 2020  ax1.legend().   
-00028140: 2020 2020 2061 7833 2e6c 6567 656e 6428       ax3.legend(
-00028150: 290a 2020 2020 2020 2020 6178 342e 6c65  ).        ax4.le
-00028160: 6765 6e64 2829 0a20 2020 2020 2020 2061  gend().        a
-00028170: 7831 2e73 6574 5f78 6c61 6265 6c28 2757  x1.set_xlabel('W
-00028180: 6176 656e 756d 6265 7220 2863 6d24 5e7b  avenumber (cm$^{
-00028190: 2d31 7d24 2927 290a 2020 2020 2020 2020  -1}$)').        
-000281a0: 6178 322e 7365 745f 786c 6162 656c 2827  ax2.set_xlabel('
-000281b0: 5761 7665 6e75 6d62 6572 2028 636d 245e  Wavenumber (cm$^
-000281c0: 7b2d 317d 2429 2729 0a20 2020 2020 2020  {-1}$)').       
-000281d0: 2061 7833 2e73 6574 5f78 6c61 6265 6c28   ax3.set_xlabel(
-000281e0: 2757 6176 656e 756d 6265 7220 2863 6d24  'Wavenumber (cm$
-000281f0: 5e7b 2d31 7d24 2927 290a 2020 2020 2020  ^{-1}$)').      
-00028200: 2020 6178 342e 7365 745f 786c 6162 656c    ax4.set_xlabel
-00028210: 2827 5761 7665 6e75 6d62 6572 2028 636d  ('Wavenumber (cm
-00028220: 245e 7b2d 317d 2429 2729 0a20 2020 2020  $^{-1}$)').     
-00028230: 2020 2061 7831 2e73 6574 5f79 6c61 6265     ax1.set_ylabe
-00028240: 6c28 2749 6e74 656e 7369 7479 2729 0a20  l('Intensity'). 
-00028250: 2020 2020 2020 2061 7832 2e73 6574 5f79         ax2.set_y
-00028260: 6c61 6265 6c28 2749 6e74 656e 7369 7479  label('Intensity
-00028270: 2729 0a20 2020 2020 2020 2061 7833 2e73  ').        ax3.s
-00028280: 6574 5f79 6c61 6265 6c28 2749 6e74 656e  et_ylabel('Inten
-00028290: 7369 7479 2729 0a20 2020 2020 2020 2061  sity').        a
-000282a0: 7834 2e73 6574 5f79 6c61 6265 6c28 2749  x4.set_ylabel('I
-000282b0: 6e74 656e 7369 7479 2729 0a20 2020 2020  ntensity').     
-000282c0: 2020 2066 6967 2e74 6967 6874 5f6c 6179     fig.tight_lay
-000282d0: 6f75 7428 290a 0a0a 0a20 2020 2020 2020  out()....       
-000282e0: 2070 6174 6833 3d70 6174 682b 272f 272b   path3=path+'/'+
-000282f0: 2753 6b65 776e 6573 735f 696d 6167 6573  'Skewness_images
-00028300: 270a 2020 2020 2020 2020 6966 206f 732e  '.        if os.
-00028310: 7061 7468 2e65 7869 7374 7328 7061 7468  path.exists(path
-00028320: 3329 3a0a 2020 2020 2020 2020 2020 2020  3):.            
-00028330: 6f75 743d 2770 6174 6820 6578 6973 7473  out='path exists
-00028340: 270a 2020 2020 2020 2020 656c 7365 3a0a  '.        else:.
-00028350: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
-00028360: 616b 6564 6972 7328 7061 7468 2b27 2f27  akedirs(path+'/'
-00028370: 2b20 2753 6b65 776e 6573 735f 696d 6167  + 'Skewness_imag
-00028380: 6573 272c 2065 7869 7374 5f6f 6b3d 4661  es', exist_ok=Fa
-00028390: 6c73 6529 0a0a 0a20 2020 2020 2020 2066  lse)...        f
-000283a0: 696c 653d 6669 6c65 6e61 6d65 2e72 7370  ile=filename.rsp
-000283b0: 6c69 7428 272e 7478 7427 2c20 3129 5b30  lit('.txt', 1)[0
-000283c0: 5d0a 2020 2020 2020 2020 6669 672e 7361  ].        fig.sa
-000283d0: 7665 6669 6728 7061 7468 332b 272f 272b  vefig(path3+'/'+
-000283e0: 2744 6961 6431 5f73 6b65 776e 6573 735f  'Diad1_skewness_
-000283f0: 7b7d 2e70 6e67 272e 666f 726d 6174 2866  {}.png'.format(f
-00028400: 696c 6529 2c20 6470 693d 6470 6929 0a0a  ile), dpi=dpi)..
-00028410: 2020 2020 6466 5f6f 7574 3d70 642e 4461      df_out=pd.Da
-00028420: 7461 4672 616d 6528 6461 7461 3d7b 2766  taFrame(data={'f
-00028430: 696c 656e 616d 6527 3a66 696c 656e 616d  ilename':filenam
-00028440: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00028450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028460: 2027 536b 6577 6e65 7373 5f64 6961 6431   'Skewness_diad1
-00028470: 273a 2041 532c 0a20 2020 2020 2020 2020  ': AS,.         
-00028480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028490: 2020 2020 2027 4c48 535f 7469 655f 6469       'LHS_tie_di
-000284a0: 6164 3127 3a20 785f 6e65 6172 6573 745f  ad1': x_nearest_
-000284b0: 4c48 532c 0a20 2020 2020 2020 2020 2020  LHS,.           
-000284c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000284d0: 2020 2027 5248 535f 7469 655f 6469 6164     'RHS_tie_diad
-000284e0: 3127 3a20 785f 6e65 6172 6573 745f 5248  1': x_nearest_RH
-000284f0: 537d 290a 0a20 2020 2072 6574 7572 6e20  S})..    return 
-00028500: 6466 5f6f 7574 0a0a 0a0a 6465 6620 6173  df_out....def as
-00028510: 7365 7373 5f64 6961 6432 5f73 6b65 776e  sess_diad2_skewn
-00028520: 6573 7328 2a2c 2020 636f 6e66 6967 313a  ess(*,  config1:
-00028530: 2064 6961 6432 5f66 6974 5f63 6f6e 6669   diad2_fit_confi
-00028540: 673d 6469 6164 315f 6669 745f 636f 6e66  g=diad1_fit_conf
-00028550: 6967 2829 2c20 696e 745f 6375 745f 6f66  ig(), int_cut_of
-00028560: 663d 302e 332c 2070 6174 683d 4e6f 6e65  f=0.3, path=None
-00028570: 2c20 6669 6c65 6e61 6d65 3d4e 6f6e 652c  , filename=None,
-00028580: 2066 696c 6574 7970 653d 4e6f 6e65 2c0a   filetype=None,.
-00028590: 736b 6577 6e65 7373 3d27 6162 7327 2c20  skewness='abs', 
-000285a0: 6865 6967 6874 3d31 2c20 7072 6f6d 696e  height=1, promin
-000285b0: 656e 6365 3d35 2c20 7769 6474 683d 302e  ence=5, width=0.
-000285c0: 352c 2070 6c6f 745f 6669 6775 7265 3d54  5, plot_figure=T
-000285d0: 7275 652c 2064 7069 3d32 3030 2c20 7065  rue, dpi=200, pe
-000285e0: 616b 5f66 6974 5f72 6f75 7469 6e65 3d46  ak_fit_routine=F
-000285f0: 616c 7365 2c20 7065 616b 5f70 6f73 3d4e  alse, peak_pos=N
-00028600: 6f6e 652c 2070 6561 6b5f 6865 6967 6874  one, peak_height
-00028610: 3d4e 6f6e 652c 2064 6961 645f 6172 7261  =None, diad_arra
-00028620: 793d 4e6f 6e65 293a 0a0a 2020 2020 2222  y=None):..    ""
-00028630: 2220 4173 7365 7373 6573 2053 6b65 776e  " Assesses Skewn
-00028640: 6573 7320 6f66 2044 6961 6420 7065 616b  ess of Diad peak
-00028650: 732e 2055 7365 6675 6c20 666f 7220 6964  s. Useful for id
-00028660: 656e 7469 6679 696e 6720 6d69 7865 6420  entifying mixed 
-00028670: 4c20 2b20 5620 7068 6173 6573 0a20 2020  L + V phases.   
-00028680: 2028 7365 6520 4465 5669 7472 6520 6574   (see DeVitre et
-00028690: 2061 6c2e 2069 6e20 7265 7669 6577 290a   al. in review).
-000286a0: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-000286b0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d  .    -----------
-000286c0: 0a20 2020 2063 6f6e 6669 6731 3a20 6469  .    config1: di
-000286d0: 6164 325f 6669 745f 636f 6e66 6967 2829  ad2_fit_config()
-000286e0: 2064 6174 6163 6c61 7373 2e20 496d 706f   dataclass. Impo
-000286f0: 7274 2070 6172 616d 6574 6572 7320 666f  rt parameters fo
-00028700: 7220 7468 6973 2066 756e 6374 696f 6e20  r this function 
-00028710: 6172 652e 0a0a 2020 2020 2020 2020 6c6f  are...        lo
-00028720: 7765 725f 6263 6b5f 6469 6164 322c 2075  wer_bck_diad2, u
-00028730: 7070 6572 5f62 636b 5f64 6961 6432 3a20  pper_bck_diad2: 
-00028740: 5b66 6c6f 6174 2c20 666c 6f61 745d 0a20  [float, float]. 
-00028750: 2020 2020 2020 2020 2020 2062 6163 6b67             backg
-00028760: 726f 756e 6420 706f 7369 7469 6f6e 2074  round position t
-00028770: 6f20 6c65 6674 2061 6e64 2072 6967 6874  o left and right
-00028780: 206f 6620 6f76 6572 616c 2064 6961 6420   of overal diad 
-00028790: 7265 6769 6f6e 2028 696e 6320 6469 6164  region (inc diad
-000287a0: 2b2d 4842 2b2d 4331 3329 0a0a 2020 2020  +-HB+-C13)..    
-000287b0: 2020 2020 4e5f 706f 6c79 5f62 636b 5f64      N_poly_bck_d
-000287c0: 6961 6431 3a20 696e 740a 2020 2020 2020  iad1: int.      
-000287d0: 2020 2020 2020 6465 6772 6565 206f 6620        degree of 
-000287e0: 706f 6c79 6e6f 6d69 616c 2074 6f20 6669  polynomial to fi
-000287f0: 7420 746f 2074 6865 2062 6163 6b67 726f  t to the backgro
-00028800: 756e 642e 0a0a 2020 2020 2020 2020 6578  und...        ex
-00028810: 636c 7564 655f 7261 6e67 6531 2c20 6578  clude_range1, ex
-00028820: 636c 7564 655f 7261 6e67 6532 3a20 5475  clude_range2: Tu
-00028830: 706c 655b 666c 6f61 742c 2066 6c6f 6174  ple[float, float
-00028840: 5d0a 2020 2020 2020 2020 2020 2020 5261  ].            Ra
-00028850: 6e67 6520 746f 2065 7863 6c75 6465 0a0a  nge to exclude..
-00028860: 2020 2020 696e 745f 6375 745f 6f66 663a      int_cut_off:
-00028870: 2066 6c6f 6174 0a20 2020 2020 2020 2056   float.        V
-00028880: 616c 7565 206f 6620 696e 7465 6e73 6974  alue of intensit
-00028890: 7920 6174 2077 6869 6368 2074 6f20 6361  y at which to ca
-000288a0: 6c63 756c 6174 6520 7468 6520 736b 6577  lculate the skew
-000288b0: 6e65 7373 2028 652e 672e 2030 2e31 3558  ness (e.g. 0.15X
-000288c0: 2074 6865 2070 6561 6b20 6865 6967 6874   the peak height
-000288d0: 292e 0a0a 2020 2020 7061 7468 3a20 7374  )...    path: st
-000288e0: 720a 2020 2020 2020 2020 466f 6c64 6572  r.        Folder
-000288f0: 2075 7365 7220 7769 7368 6573 2074 6f20   user wishes to 
-00028900: 7265 6164 2064 6174 6120 6672 6f6d 0a0a  read data from..
-00028910: 2020 2020 6669 6c65 6e61 6d65 3a20 7374      filename: st
-00028920: 720a 2020 2020 2020 2020 5370 6563 6966  r.        Specif
-00028930: 6963 2066 696c 6520 6265 696e 6720 7265  ic file being re
-00028940: 6164 0a0a 0a20 2020 2066 696c 6574 7970  ad...    filetyp
-00028950: 653a 2073 7472 0a20 2020 2020 2020 2049  e: str.        I
-00028960: 6465 6e74 6966 6965 7320 7479 7065 206f  dentifies type o
-00028970: 6620 6669 6c65 0a20 2020 2020 2020 2063  f file.        c
-00028980: 686f 6f73 6520 6672 6f6d 2027 5769 7465  hoose from 'Wite
-00028990: 635f 4153 4349 4927 2c20 2768 6561 646c  c_ASCII', 'headl
-000289a0: 6573 735f 7478 7427 2c20 2768 6561 646c  ess_txt', 'headl
-000289b0: 6573 735f 6373 7627 2c20 2768 6561 645f  ess_csv', 'head_
-000289c0: 6373 7627 2c20 2757 6974 6563 5f41 5343  csv', 'Witec_ASC
-000289d0: 4949 272c 0a20 2020 2020 2020 2027 484f  II',.        'HO
-000289e0: 5249 4241 5f74 7874 272c 2027 5265 6e69  RIBA_txt', 'Reni
-000289f0: 7368 6177 5f74 7874 270a 0a20 2020 2073  shaw_txt'..    s
-00028a00: 6b65 776e 6573 733a 2027 6162 7327 206f  kewness: 'abs' o
-00028a10: 7220 2764 6972 270a 2020 2020 2020 2020  r 'dir'.        
-00028a20: 4966 2027 6162 7327 2c20 6769 7665 7320  If 'abs', gives 
-00028a30: 6162 736f 6c75 7465 2073 6b65 776e 6573  absolute skewnes
-00028a40: 7320 2865 2e67 2e2c 206c 6172 6765 7374  s (e.g., largest
-00028a50: 2070 6f73 7369 626c 6520 6e75 6d62 6572   possible number
-00028a60: 2072 6567 6172 646c 6573 7320 6f66 2064   regardless of d
-00028a70: 6972 6563 7469 6f6e 290a 2020 2020 2020  irection).      
-00028a80: 2020 6966 2027 6469 7227 2064 6f65 7320    if 'dir' does 
-00028a90: 736b 6577 6e65 7373 2061 7320 6f6e 6520  skewness as one 
-00028aa0: 7369 6465 206f 7665 7220 7468 6520 6f74  side over the ot
-00028ab0: 6865 720a 0a0a 2020 2020 6865 6967 6874  her...    height
-00028ac0: 2c20 7072 6f6d 696e 656e 6365 2c20 7769  , prominence, wi
-00028ad0: 6474 683a 2066 6c6f 6174 0a20 2020 2020  dth: float.     
-00028ae0: 2020 2053 6369 7079 2066 696e 6420 7065     Scipy find pe
-00028af0: 616b 2070 6172 616d 6574 6572 730a 0a20  ak parameters.. 
-00028b00: 2020 2070 6c6f 745f 6669 6775 7265 3a20     plot_figure: 
-00028b10: 626f 6f6c 0a20 2020 2020 2020 2069 6620  bool.        if 
-00028b20: 5472 7565 2c20 706c 6f74 7320 616e 6420  True, plots and 
-00028b30: 7361 7665 7320 6120 6669 6775 7265 2e0a  saves a figure..
-00028b40: 0a20 2020 2064 7069 3a20 696e 740a 2020  .    dpi: int.  
-00028b50: 2020 2020 2020 6470 6920 746f 2073 6176        dpi to sav
-00028b60: 6520 696d 6167 6520 6174 0a0a 2020 2020  e image at..    
-00028b70: 7065 616b 5f66 6974 5f72 6f75 7469 6e65  peak_fit_routine
-00028b80: 3a20 626f 6f6c 2028 6465 6661 756c 7420  : bool (default 
-00028b90: 4661 6c73 6529 202d 0a20 2020 2020 2020  False) -.       
-00028ba0: 2069 6620 5472 7565 2c20 646f 6573 6e74   if True, doesnt
-00028bb0: 2066 696e 6420 6d61 7820 6f66 2073 706c   find max of spl
-00028bc0: 696e 652c 2062 7574 2075 7365 7320 7468  ine, but uses th
-00028bd0: 6520 7065 616b 2070 6f73 6974 696f 6e20  e peak position 
-00028be0: 796f 7520 6861 7665 2066 6f75 6e64 2066  you have found f
-00028bf0: 726f 6d20 7468 6520 6469 6164 2066 6974  rom the diad fit
-00028c00: 7469 6e67 2066 756e 6374 696f 6e73 2e0a  ting functions..
-00028c10: 2020 2020 2020 2020 416c 736f 206e 6565          Also nee
-00028c20: 6473 2070 6561 6b5f 706f 7320 2870 6561  ds peak_pos (pea
-00028c30: 6b20 6365 6e74 6572 2069 6e20 636d 2d31  k center in cm-1
-00028c40: 2920 616e 6420 7065 616b 5f68 6569 6768  ) and peak_heigh
-00028c50: 740a 0a0a 0a20 2020 2052 6574 7572 6e73  t....    Returns
-00028c60: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d  .    -----------
-00028c70: 0a20 2020 2070 642e 4461 7461 4672 616d  .    pd.DataFram
-00028c80: 6520 7769 7468 2069 6e66 6f72 6d61 7469  e with informati
-00028c90: 6f6e 2061 626f 7574 2066 696c 6520 616e  on about file an
-00028ca0: 6420 736b 6577 6e65 7373 2070 6172 616d  d skewness param
-00028cb0: 6574 6572 732e 0a0a 2020 2020 2222 220a  eters...    """.
-00028cc0: 0a0a 2320 4669 7273 742c 2064 6f20 7468  ..# First, do th
-00028cd0: 6520 6261 636b 6772 6f75 6e64 2073 7562  e background sub
-00028ce0: 7472 6163 7469 6f6e 0a20 2020 2079 5f63  traction.    y_c
-00028cf0: 6f72 725f 6469 6164 322c 2050 795f 6261  orr_diad2, Py_ba
-00028d00: 7365 5f64 6961 6432 2c20 785f 6469 6164  se_diad2, x_diad
-00028d10: 322c 2020 4469 6164 5f73 686f 7274 2c20  2,  Diad_short, 
-00028d20: 5079 5f62 6173 655f 6469 6164 322c 2050  Py_base_diad2, P
-00028d30: 665f 6261 7365 6c69 6e65 2c20 2042 6173  f_baseline,  Bas
-00028d40: 656c 696e 655f 7973 7562 5f64 6961 6432  eline_ysub_diad2
-00028d50: 2c20 4261 7365 6c69 6e65 5f78 5f64 6961  , Baseline_x_dia
-00028d60: 6432 2c20 4261 7365 6c69 6e65 2c20 7370  d2, Baseline, sp
-00028d70: 616e 3d72 656d 6f76 655f 6469 6164 5f62  an=remove_diad_b
-00028d80: 6173 656c 696e 6528 0a20 2020 2070 6174  aseline(.    pat
-00028d90: 683d 7061 7468 2c20 6669 6c65 6e61 6d65  h=path, filename
-00028da0: 3d66 696c 656e 616d 652c 2066 696c 6574  =filename, filet
-00028db0: 7970 653d 6669 6c65 7479 7065 2c20 4e5f  ype=filetype, N_
-00028dc0: 706f 6c79 3d63 6f6e 6669 6731 2e4e 5f70  poly=config1.N_p
-00028dd0: 6f6c 795f 6263 6b5f 6469 6164 322c 0a20  oly_bck_diad2,. 
-00028de0: 2020 206c 6f77 6572 5f62 636b 3d63 6f6e     lower_bck=con
-00028df0: 6669 6731 2e6c 6f77 6572 5f62 636b 5f64  fig1.lower_bck_d
-00028e00: 6961 6432 2c20 7570 7065 725f 6263 6b3d  iad2, upper_bck=
-00028e10: 636f 6e66 6967 312e 7570 7065 725f 6263  config1.upper_bc
-00028e20: 6b5f 6469 6164 322c 2070 6c6f 745f 6669  k_diad2, plot_fi
-00028e30: 6775 7265 3d46 616c 7365 2c20 6469 6164  gure=False, diad
-00028e40: 5f61 7272 6179 3d64 6961 645f 6172 7261  _array=diad_arra
-00028e50: 7929 0a0a 0a0a 2020 2020 785f 6c69 6e5f  y)....    x_lin_
-00028e60: 6261 7365 6c69 6e65 3d6e 702e 6c69 6e73  baseline=np.lins
-00028e70: 7061 6365 2863 6f6e 6669 6731 2e6c 6f77  pace(config1.low
-00028e80: 6572 5f62 636b 5f64 6961 6432 5b30 5d2c  er_bck_diad2[0],
-00028e90: 2063 6f6e 6669 6731 2e75 7070 6572 5f62   config1.upper_b
-00028ea0: 636b 5f64 6961 6432 5b31 5d2c 2031 3030  ck_diad2[1], 100
-00028eb0: 3030 3029 0a20 2020 2079 6261 7365 5f78  000).    ybase_x
-00028ec0: 6c69 6e3d 5066 5f62 6173 656c 696e 6528  lin=Pf_baseline(
-00028ed0: 785f 6c69 6e5f 6261 7365 6c69 6e65 290a  x_lin_baseline).
-00028ee0: 0a0a 0a23 2047 6574 2078 2061 6e64 2079  ...# Get x and y
-00028ef0: 2066 6f72 2063 7562 6963 2073 706c 696e   for cubic splin
-00028f00: 650a 2020 2020 783d 785f 6469 6164 320a  e.    x=x_diad2.
-00028f10: 2020 2020 793d 795f 636f 7272 5f64 6961      y=y_corr_dia
-00028f20: 6432 0a0a 2320 4669 7473 2061 2020 6375  d2..# Fits a  cu
-00028f30: 6269 6320 7370 6c69 6e65 0a20 2020 2066  bic spline.    f
-00028f40: 3220 3d20 696e 7465 7270 3164 2878 2c20  2 = interp1d(x, 
-00028f50: 792c 206b 696e 643d 2763 7562 6963 2729  y, kind='cubic')
-00028f60: 0a20 2020 2078 5f6e 6577 3d6e 702e 6c69  .    x_new=np.li
-00028f70: 6e73 7061 6365 286e 702e 6d69 6e28 7829  nspace(np.min(x)
-00028f80: 2c20 6e70 2e6d 6178 2878 292c 2031 3030  , np.max(x), 100
-00028f90: 3030 3029 0a0a 2020 2020 795f 6375 623d  000)..    y_cub=
-00028fa0: 6632 2878 5f6e 6577 290a 0a0a 2020 2020  f2(x_new)...    
-00028fb0: 6966 2070 6561 6b5f 6669 745f 726f 7574  if peak_fit_rout
-00028fc0: 696e 6520 6973 2046 616c 7365 3a0a 2320  ine is False:.# 
-00028fd0: 5573 6520 5363 6970 7920 6669 6e64 2070  Use Scipy find p
-00028fe0: 6561 6b73 2074 6f20 6765 7420 7468 6174  eaks to get that
-00028ff0: 2063 7562 6963 2070 6561 6b0a 2020 2020   cubic peak.    
-00029000: 2020 2020 7065 616b 7320 3d20 6669 6e64      peaks = find
-00029010: 5f70 6561 6b73 2879 5f63 7562 2c20 6865  _peaks(y_cub, he
-00029020: 6967 6874 3d68 6569 6768 742c 2070 726f  ight=height, pro
-00029030: 6d69 6e65 6e63 653d 7072 6f6d 696e 656e  minence=prominen
-00029040: 6365 2c20 7769 6474 683d 7769 6474 6829  ce, width=width)
-00029050: 0a20 2020 2020 2020 2070 6561 6b5f 6865  .        peak_he
-00029060: 6967 6874 3d70 6561 6b73 5b31 5d5b 2770  ight=peaks[1]['p
-00029070: 6561 6b5f 6865 6967 6874 7327 5d0a 2020  eak_heights'].  
-00029080: 2020 2020 2020 7065 616b 5f70 6f73 203d        peak_pos =
-00029090: 2078 5f6e 6577 5b70 6561 6b73 5b30 5d5d   x_new[peaks[0]]
-000290a0: 0a0a 2020 2020 2020 2020 2320 6669 6e64  ..        # find
-000290b0: 206d 6178 2070 6561 6b2e 2020 7075 7420   max peak.  put 
-000290c0: 696e 746f 2064 6620 6265 6361 7573 6520  into df because 
-000290d0: 6927 6d20 6c61 7a79 0a20 2020 2020 2020  i'm lazy.       
-000290e0: 2070 6561 6b5f 6466 3d70 642e 4461 7461   peak_df=pd.Data
-000290f0: 4672 616d 6528 6461 7461 3d7b 2770 6f73  Frame(data={'pos
-00029100: 273a 2070 6561 6b5f 706f 732c 0a20 2020  ': peak_pos,.   
-00029110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029120: 2020 2020 2020 2020 2027 6865 6967 6874           'height
-00029130: 273a 2070 6561 6b5f 6865 6967 6874 7d29  ': peak_height})
-00029140: 0a0a 2020 2020 2020 2020 6466 5f70 6561  ..        df_pea
-00029150: 6b5f 736f 7274 3d70 6561 6b5f 6466 2e73  k_sort=peak_df.s
-00029160: 6f72 745f 7661 6c75 6573 2827 6865 6967  ort_values('heig
-00029170: 6874 272c 2061 7869 733d 302c 2061 7363  ht', axis=0, asc
-00029180: 656e 6469 6e67 3d46 616c 7365 290a 2020  ending=False).  
-00029190: 2020 2020 2020 6466 5f70 6561 6b5f 736f        df_peak_so
-000291a0: 7274 5f74 7269 6d3d 6466 5f70 6561 6b5f  rt_trim=df_peak_
-000291b0: 736f 7274 5b30 3a31 5d0a 2020 2020 2020  sort[0:1].      
-000291c0: 2020 5065 616b 5f43 656e 7465 723d 6466    Peak_Center=df
-000291d0: 5f70 6561 6b5f 736f 7274 5f74 7269 6d5b  _peak_sort_trim[
-000291e0: 2770 6f73 275d 2e69 6c6f 635b 305d 0a20  'pos'].iloc[0]. 
-000291f0: 2020 2020 2020 2050 6561 6b5f 4865 6967         Peak_Heig
-00029200: 6874 3d64 665f 7065 616b 5f73 6f72 745f  ht=df_peak_sort_
-00029210: 7472 696d 5b27 6865 6967 6874 275d 2e69  trim['height'].i
-00029220: 6c6f 635b 305d 0a0a 2020 2020 6966 2070  loc[0]..    if p
-00029230: 6561 6b5f 6669 745f 726f 7574 696e 6520  eak_fit_routine 
-00029240: 6973 2054 7275 653a 0a20 2020 2020 2020  is True:.       
-00029250: 2050 6561 6b5f 4865 6967 6874 3d70 6561   Peak_Height=pea
-00029260: 6b5f 6865 6967 6874 5b30 5d0a 2020 2020  k_height[0].    
-00029270: 2020 2020 5065 616b 5f43 656e 7465 723d      Peak_Center=
-00029280: 7065 616b 5f70 6f73 5b30 5d0a 0a0a 0a0a  peak_pos[0].....
-00029290: 2320 4669 6e64 2069 6e74 656e 7369 7479  # Find intensity
-000292a0: 2063 7574 206f 6666 0a20 2020 2079 5f69   cut off.    y_i
-000292b0: 6e74 5f63 7574 3d50 6561 6b5f 4865 6967  nt_cut=Peak_Heig
-000292c0: 6874 2a69 6e74 5f63 7574 5f6f 6666 0a0a  ht*int_cut_off..
-000292d0: 2020 2020 2320 5370 6c69 7420 7468 6520      # Split the 
-000292e0: 6172 7261 7920 696e 746f 2061 204c 4853  array into a LHS
-000292f0: 2061 6e64 2061 2052 4853 0a20 2020 204c   and a RHS.    L
-00029300: 4853 5f79 3d79 5f63 7562 5b78 5f6e 6577  HS_y=y_cub[x_new
-00029310: 3c3d 5065 616b 5f43 656e 7465 725d 0a20  <=Peak_Center]. 
-00029320: 2020 2052 4853 5f79 3d79 5f63 7562 5b78     RHS_y=y_cub[x
-00029330: 5f6e 6577 3e50 6561 6b5f 4365 6e74 6572  _new>Peak_Center
-00029340: 5d0a 0a20 2020 204c 4853 5f78 3d78 5f6e  ]..    LHS_x=x_n
-00029350: 6577 5b78 5f6e 6577 3c3d 5065 616b 5f43  ew[x_new<=Peak_C
-00029360: 656e 7465 725d 0a20 2020 2052 4853 5f78  enter].    RHS_x
-00029370: 3d78 5f6e 6577 5b78 5f6e 6577 3e50 6561  =x_new[x_new>Pea
-00029380: 6b5f 4365 6e74 6572 5d0a 0a20 2020 2023  k_Center]..    #
-00029390: 204e 6565 6420 746f 2066 6c69 7020 4c48   Need to flip LH
-000293a0: 5320 746f 2070 7574 2069 6e74 6f20 7468  S to put into th
-000293b0: 6520 6669 6e64 2063 6c6f 7365 7374 2066  e find closest f
-000293c0: 756e 6374 696f 6e0a 2020 2020 4c48 535f  unction.    LHS_
-000293d0: 795f 666c 6970 3d6e 702e 666c 6970 284c  y_flip=np.flip(L
-000293e0: 4853 5f79 290a 2020 2020 4c48 535f 785f  HS_y).    LHS_x_
-000293f0: 666c 6970 3d6e 702e 666c 6970 284c 4853  flip=np.flip(LHS
-00029400: 5f78 290a 0a20 2020 2076 616c 3d6e 702e  _x)..    val=np.
-00029410: 6172 676d 6178 284c 4853 5f79 5f66 6c69  argmax(LHS_y_fli
-00029420: 703c 795f 696e 745f 6375 7429 0a0a 2020  p<y_int_cut)..  
-00029430: 2020 7661 6c32 3d6e 702e 6172 676d 6178    val2=np.argmax
-00029440: 2852 4853 5f79 3c79 5f69 6e74 5f63 7574  (RHS_y<y_int_cut
-00029450: 290a 0a0a 2020 2020 2320 4669 6e64 206e  )...    # Find n
-00029460: 6561 7265 7374 2078 2075 6e69 7420 746f  earest x unit to
-00029470: 2074 6869 7320 7661 6c75 650a 2020 2020   this value.    
-00029480: 795f 6e65 6172 6573 745f 4c48 533d 4c48  y_nearest_LHS=LH
-00029490: 535f 795f 666c 6970 5b76 616c 5d0a 2020  S_y_flip[val].  
-000294a0: 2020 785f 6e65 6172 6573 745f 4c48 533d    x_nearest_LHS=
-000294b0: 4c48 535f 785f 666c 6970 5b76 616c 5d0a  LHS_x_flip[val].
-000294c0: 0a20 2020 2079 5f6e 6561 7265 7374 5f52  .    y_nearest_R
-000294d0: 4853 3d52 4853 5f79 5b76 616c 325d 0a20  HS=RHS_y[val2]. 
-000294e0: 2020 2078 5f6e 6561 7265 7374 5f52 4853     x_nearest_RHS
-000294f0: 3d52 4853 5f78 5b76 616c 325d 0a0a 2020  =RHS_x[val2]..  
-00029500: 2020 2320 5265 7475 726e 2053 6b65 776e    # Return Skewn
-00029510: 6573 730a 2020 2020 4c48 535f 4365 6e74  ess.    LHS_Cent
-00029520: 6572 3d61 6273 2878 5f6e 6561 7265 7374  er=abs(x_nearest
-00029530: 5f4c 4853 2d50 6561 6b5f 4365 6e74 6572  _LHS-Peak_Center
-00029540: 290a 2020 2020 5248 535f 4365 6e74 6572  ).    RHS_Center
-00029550: 3d61 6273 2878 5f6e 6561 7265 7374 5f52  =abs(x_nearest_R
-00029560: 4853 2d50 6561 6b5f 4365 6e74 6572 290a  HS-Peak_Center).
-00029570: 0a20 2020 2023 4164 6465 6420 636f 6e64  .    #Added cond
-00029580: 6974 696f 6e61 6c20 746f 2061 6c77 6179  itional to alway
-00029590: 7320 6861 7665 2061 2072 6174 696f 206f  s have a ratio o
-000295a0: 6620 7468 6520 6869 6768 2f6c 6f77 0a20  f the high/low. 
-000295b0: 2020 2069 6620 736b 6577 6e65 7373 3d3d     if skewness==
-000295c0: 2761 6273 273a 0a20 2020 2020 2020 2069  'abs':.        i
-000295d0: 6620 4c48 535f 4365 6e74 6572 3e52 4853  f LHS_Center>RHS
-000295e0: 5f43 656e 7465 723a 0a20 2020 2020 2020  _Center:.       
-000295f0: 2020 2020 2041 533d 4c48 535f 4365 6e74       AS=LHS_Cent
-00029600: 6572 2f52 4853 5f43 656e 7465 720a 2020  er/RHS_Center.  
-00029610: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00029620: 2020 2020 2020 2020 4153 3d52 4853 5f43          AS=RHS_C
-00029630: 656e 7465 722f 4c48 535f 4365 6e74 6572  enter/LHS_Center
-00029640: 0a20 2020 2065 6c69 6620 736b 6577 6e65  .    elif skewne
-00029650: 7373 3d3d 2764 6972 273a 0a20 2020 2020  ss=='dir':.     
-00029660: 2020 2041 533d 5248 535f 4365 6e74 6572     AS=RHS_Center
-00029670: 2f4c 4853 5f43 656e 7465 720a 0a0a 2020  /LHS_Center...  
-00029680: 2020 6966 2070 6c6f 745f 6669 6775 7265    if plot_figure
-00029690: 2069 7320 5472 7565 3a0a 0a20 2020 2020   is True:..     
-000296a0: 2020 2023 204d 616b 6520 7072 6574 7479     # Make pretty
-000296b0: 2066 6967 7572 6520 7368 6f77 696e 6720   figure showing 
-000296c0: 6261 636b 6772 6f75 6e64 2073 7562 7472  background subtr
-000296d0: 6163 746f 696e 2072 6f75 7469 6e65 0a20  actoin routine. 
-000296e0: 2020 2020 2020 2066 6967 2c20 2828 6178         fig, ((ax
-000296f0: 322c 2061 7831 292c 2028 6178 332c 2061  2, ax1), (ax3, a
-00029700: 7834 2929 203d 2070 6c74 2e73 7562 706c  x4)) = plt.subpl
-00029710: 6f74 7328 322c 2032 2c20 6669 6773 697a  ots(2, 2, figsiz
-00029720: 653d 2831 302c 3130 2929 0a20 2020 2020  e=(10,10)).     
-00029730: 2020 2066 6967 2e73 7570 7469 746c 6528     fig.suptitle(
-00029740: 2744 6961 6420 3220 536b 6577 6e65 7373  'Diad 2 Skewness
-00029750: 2066 696c 653d 2027 2b20 7374 7228 6669   file= '+ str(fi
-00029760: 6c65 6e61 6d65 292c 2066 6f6e 7473 697a  lename), fontsiz
-00029770: 653d 3136 2c20 783d 302e 352c 2079 3d31  e=16, x=0.5, y=1
-00029780: 2e30 290a 0a20 2020 2020 2020 2061 7832  .0)..        ax2
-00029790: 2e73 6574 5f74 6974 6c65 2827 6129 2053  .set_title('a) S
-000297a0: 7065 6374 7261 2729 0a20 2020 2020 2020  pectra').       
-000297b0: 2061 7832 2e70 6c6f 7428 4469 6164 5f73   ax2.plot(Diad_s
-000297c0: 686f 7274 5b3a 2c20 305d 2c20 4469 6164  hort[:, 0], Diad
-000297d0: 5f73 686f 7274 5b3a 2c20 315d 2c20 272d  _short[:, 1], '-
-000297e0: 7227 2c20 6c61 6265 6c3d 2744 6174 6127  r', label='Data'
-000297f0: 290a 2020 2020 2020 2020 6178 322e 7365  ).        ax2.se
-00029800: 745f 786c 696d 285b 636f 6e66 6967 312e  t_xlim([config1.
-00029810: 6c6f 7765 725f 6263 6b5f 6469 6164 325b  lower_bck_diad2[
-00029820: 305d 2b34 302c 2063 6f6e 6669 6731 2e75  0]+40, config1.u
-00029830: 7070 6572 5f62 636b 5f64 6961 6432 5b31  pper_bck_diad2[1
-00029840: 5d2d 3430 5d29 0a20 2020 2020 2020 2061  ]-40]).        a
-00029850: 7831 2e73 6574 5f74 6974 6c65 2827 6229  x1.set_title('b)
-00029860: 2042 6163 6b67 726f 756e 6420 6669 7427   Background fit'
-00029870: 290a 2020 2020 2020 2020 6178 312e 706c  ).        ax1.pl
-00029880: 6f74 2844 6961 645f 7368 6f72 745b 3a2c  ot(Diad_short[:,
-00029890: 2030 5d2c 2044 6961 645f 7368 6f72 745b   0], Diad_short[
-000298a0: 3a2c 2031 5d2c 2027 2e2d 7227 2c20 6c61  :, 1], '.-r', la
-000298b0: 6265 6c3d 2744 6174 6127 290a 0a20 2020  bel='Data')..   
-000298c0: 2020 2020 2061 7831 2e70 6c6f 7428 4261       ax1.plot(Ba
-000298d0: 7365 6c69 6e65 5b3a 2c20 305d 2c20 4261  seline[:, 0], Ba
-000298e0: 7365 6c69 6e65 5b3a 2c20 315d 2c20 272e  seline[:, 1], '.
-000298f0: 6227 2c20 6c61 6265 6c3d 2762 636b 2729  b', label='bck')
-00029900: 0a20 2020 2020 2020 2061 7831 2e70 6c6f  .        ax1.plo
-00029910: 7428 4469 6164 5f73 686f 7274 5b3a 2c20  t(Diad_short[:, 
-00029920: 305d 2c20 5079 5f62 6173 655f 6469 6164  0], Py_base_diad
-00029930: 322c 2027 2d6b 272c 206c 6162 656c 3d27  2, '-k', label='
-00029940: 6263 6b20 6669 7427 290a 2020 2020 2020  bck fit').      
-00029950: 2020 6178 332e 7365 745f 7469 746c 6528    ax3.set_title(
-00029960: 2763 2920 4261 636b 6772 6f75 6e64 2073  'c) Background s
-00029970: 7562 7472 6163 7465 6427 290a 2020 2020  ubtracted').    
-00029980: 2020 2020 6178 332e 706c 6f74 2820 785f      ax3.plot( x_
-00029990: 6469 6164 322c 795f 636f 7272 5f64 6961  diad2,y_corr_dia
-000299a0: 6432 2c20 272d 7227 2c20 6c61 6265 6c3d  d2, '-r', label=
-000299b0: 2742 636b 2073 7562 2729 0a0a 2020 2020  'Bck sub')..    
-000299c0: 2320 4164 6473 2063 7562 6963 2069 6e74  # Adds cubic int
-000299d0: 6572 706f 6c6f 6174 696f 6e20 666f 7220  erpoloation for 
-000299e0: 696e 7370 6563 7469 6f6e 0a0a 2020 2020  inspection..    
-000299f0: 2020 2020 6178 342e 7365 745f 7469 746c      ax4.set_titl
-00029a00: 6528 2764 2920 4375 6269 6320 5370 6c69  e('d) Cubic Spli
-00029a10: 6e65 2729 0a20 2020 2020 2020 2061 7834  ne').        ax4
-00029a20: 2e70 6c6f 7428 5b78 5f6e 6561 7265 7374  .plot([x_nearest
-00029a30: 5f4c 4853 2c20 5065 616b 5f43 656e 7465  _LHS, Peak_Cente
-00029a40: 725d 2c20 5b79 5f69 6e74 5f63 7574 2c20  r], [y_int_cut, 
-00029a50: 795f 696e 745f 6375 745d 2c20 272d 6727  y_int_cut], '-g'
-00029a60: 290a 2020 2020 2020 2020 6178 342e 616e  ).        ax4.an
-00029a70: 6e6f 7461 7465 2873 7472 286e 702e 726f  notate(str(np.ro
-00029a80: 756e 6428 4c48 535f 4365 6e74 6572 2c20  und(LHS_Center, 
-00029a90: 3229 292c 0a20 2020 2020 2020 2020 2020  2)),.           
-00029aa0: 2020 2020 2020 2020 2020 7879 3d28 785f            xy=(x_
-00029ab0: 6e65 6172 6573 745f 4c48 532d 332c 2079  nearest_LHS-3, y
-00029ac0: 5f69 6e74 5f63 7574 2b28 5065 616b 5f48  _int_cut+(Peak_H
-00029ad0: 6569 6768 742d 795f 696e 745f 6375 7429  eight-y_int_cut)
-00029ae0: 2f31 3029 2c20 7879 636f 6f72 6473 3d22  /10), xycoords="
-00029af0: 6461 7461 222c 0a20 2020 2020 2020 2020  data",.         
-00029b00: 2020 2020 2020 2020 2020 2020 666f 6e74              font
-00029b10: 7369 7a65 3d31 322c 2063 6f6c 6f72 3d27  size=12, color='
-00029b20: 6772 6565 6e27 290a 2020 2020 2020 2020  green').        
-00029b30: 6178 342e 706c 6f74 2878 5f6e 6561 7265  ax4.plot(x_neare
-00029b40: 7374 5f4c 4853 2c20 795f 6e65 6172 6573  st_LHS, y_neares
-00029b50: 745f 4c48 532c 2027 2a6b 272c 206d 6663  t_LHS, '*k', mfc
-00029b60: 3d27 6772 6565 6e27 2c6d 733d 3135 2c20  ='green',ms=15, 
-00029b70: 6c61 6265 6c3d 2752 4820 7469 6527 290a  label='RH tie').
-00029b80: 0a0a 0a20 2020 2020 2020 2061 7834 2e70  ...        ax4.p
-00029b90: 6c6f 7428 5b50 6561 6b5f 4365 6e74 6572  lot([Peak_Center
-00029ba0: 2c20 785f 6e65 6172 6573 745f 5248 535d  , x_nearest_RHS]
-00029bb0: 2c20 5b79 5f69 6e74 5f63 7574 2c20 795f  , [y_int_cut, y_
-00029bc0: 696e 745f 6375 745d 2c20 272d 272c 2063  int_cut], '-', c
-00029bd0: 6f6c 6f72 3d27 6772 6579 2729 0a20 2020  olor='grey').   
-00029be0: 2020 2020 2061 7834 2e61 6e6e 6f74 6174       ax4.annotat
-00029bf0: 6528 7374 7228 6e70 2e72 6f75 6e64 2852  e(str(np.round(R
-00029c00: 4853 5f43 656e 7465 722c 2032 2929 2c0a  HS_Center, 2)),.
-00029c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029c20: 2020 2020 2078 793d 2878 5f6e 6561 7265       xy=(x_neare
-00029c30: 7374 5f52 4853 2b33 2c20 795f 696e 745f  st_RHS+3, y_int_
-00029c40: 6375 742b 2850 6561 6b5f 4865 6967 6874  cut+(Peak_Height
-00029c50: 2d79 5f69 6e74 5f63 7574 292f 3130 292c  -y_int_cut)/10),
-00029c60: 2078 7963 6f6f 7264 733d 2264 6174 6122   xycoords="data"
-00029c70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00029c80: 2020 2020 2020 2020 666f 6e74 7369 7a65          fontsize
-00029c90: 3d31 322c 2063 6f6c 6f72 3d27 6772 6579  =12, color='grey
-00029ca0: 2729 0a20 2020 2020 2020 2061 7834 2e70  ').        ax4.p
-00029cb0: 6c6f 7428 785f 6e65 6172 6573 745f 5248  lot(x_nearest_RH
-00029cc0: 532c 2079 5f6e 6561 7265 7374 5f52 4853  S, y_nearest_RHS
-00029cd0: 2c20 272a 6b27 2c20 6d66 633d 2767 7265  , '*k', mfc='gre
-00029ce0: 7927 2c20 6d73 3d31 352c 206c 6162 656c  y', ms=15, label
-00029cf0: 3d27 4c48 2074 6965 2729 0a0a 0a0a 0a20  ='LH tie')..... 
-00029d00: 2020 2020 2020 2061 7834 2e70 6c6f 7428         ax4.plot(
-00029d10: 782c 2079 2c20 272e 7227 290a 2020 2020  x, y, '.r').    
-00029d20: 2020 2020 6178 342e 706c 6f74 2878 5f6e      ax4.plot(x_n
-00029d30: 6577 2c20 795f 6375 622c 2027 2d6b 2729  ew, y_cub, '-k')
-00029d40: 0a0a 2020 2020 2020 2020 6178 342e 706c  ..        ax4.pl
-00029d50: 6f74 285b 5065 616b 5f43 656e 7465 722c  ot([Peak_Center,
-00029d60: 2050 6561 6b5f 4365 6e74 6572 5d2c 205b   Peak_Center], [
-00029d70: 5065 616b 5f48 6569 6768 742c 2050 6561  Peak_Height, Pea
-00029d80: 6b5f 4865 6967 6874 5d2c 0a20 2020 2020  k_Height],.     
-00029d90: 2020 2020 2020 2020 272a 6b27 2c20 6d66          '*k', mf
-00029da0: 633d 2762 6c75 6527 2c20 6d73 3d31 352c  c='blue', ms=15,
-00029db0: 206c 6162 656c 3d27 5363 6970 7920 4365   label='Scipy Ce
-00029dc0: 6e74 6572 2729 0a0a 0a20 2020 2020 2020  nter')...       
-00029dd0: 2023 2041 6464 2074 6f20 706c 6f74 0a0a   # Add to plot..
-00029de0: 2020 2020 2020 2020 6178 342e 706c 6f74          ax4.plot
-00029df0: 2863 6f6e 6669 6731 2e6c 6f77 6572 5f62  (config1.lower_b
-00029e00: 636b 5f64 6961 6432 5b30 5d2c 2063 6f6e  ck_diad2[0], con
-00029e10: 6669 6731 2e75 7070 6572 5f62 636b 5f64  fig1.upper_bck_d
-00029e20: 6961 6432 5b31 5d2c 205b 795f 696e 745f  iad2[1], [y_int_
-00029e30: 6375 742c 2079 5f69 6e74 5f63 7574 5d2c  cut, y_int_cut],
-00029e40: 2027 3a72 2729 0a0a 0a0a 0a20 2020 2020   ':r').....     
-00029e50: 2020 2061 7834 2e73 6574 5f78 6c69 6d28     ax4.set_xlim(
-00029e60: 5b78 5f6e 6561 7265 7374 5f4c 4853 2d31  [x_nearest_LHS-1
-00029e70: 302c 2078 5f6e 6561 7265 7374 5f52 4853  0, x_nearest_RHS
-00029e80: 2b31 305d 290a 2020 2020 2020 2020 6178  +10]).        ax
-00029e90: 342e 7365 745f 796c 696d 285b 302d 3130  4.set_ylim([0-10
-00029ea0: 2c20 5065 616b 5f48 6569 6768 742a 312e  , Peak_Height*1.
-00029eb0: 325d 290a 2020 2020 2020 2020 6178 342e  2]).        ax4.
-00029ec0: 706c 6f74 285b 5065 616b 5f43 656e 7465  plot([Peak_Cente
-00029ed0: 722c 2050 6561 6b5f 4365 6e74 6572 5d2c  r, Peak_Center],
-00029ee0: 205b 302c 2050 6561 6b5f 4865 6967 6874   [0, Peak_Height
-00029ef0: 5d2c 2027 3a62 2729 0a0a 0a0a 2020 2020  ], ':b')....    
-00029f00: 2020 2020 6178 342e 616e 6e6f 7461 7465      ax4.annotate
-00029f10: 2827 536b 6577 6e65 7373 3d27 2b73 7472  ('Skewness='+str
-00029f20: 286e 702e 726f 756e 6428 4153 2c20 3229  (np.round(AS, 2)
-00029f30: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00029f40: 2020 2020 2020 2020 7879 3d28 785f 6e65          xy=(x_ne
-00029f50: 6172 6573 745f 5248 532b 322c 2079 5f69  arest_RHS+2, y_i
-00029f60: 6e74 5f63 7574 2b79 5f69 6e74 5f63 7574  nt_cut+y_int_cut
-00029f70: 2b28 5065 616b 5f48 6569 6768 742d 795f  +(Peak_Height-y_
-00029f80: 696e 745f 6375 7429 2f31 3029 2c20 7879  int_cut)/10), xy
-00029f90: 636f 6f72 6473 3d22 6461 7461 222c 0a20  coords="data",. 
-00029fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029fb0: 2020 2020 2066 6f6e 7473 697a 653d 3130       fontsize=10
-00029fc0: 290a 0a20 2020 2020 2020 2061 7832 2e6c  )..        ax2.l
-00029fd0: 6567 656e 6428 290a 2020 2020 2020 2020  egend().        
-00029fe0: 6178 312e 6c65 6765 6e64 2829 0a20 2020  ax1.legend().   
-00029ff0: 2020 2020 2061 7833 2e6c 6567 656e 6428       ax3.legend(
-0002a000: 290a 2020 2020 2020 2020 6178 342e 6c65  ).        ax4.le
-0002a010: 6765 6e64 2829 0a20 2020 2020 2020 2061  gend().        a
-0002a020: 7831 2e73 6574 5f78 6c61 6265 6c28 2757  x1.set_xlabel('W
-0002a030: 6176 656e 756d 6265 7220 2863 6d24 5e7b  avenumber (cm$^{
-0002a040: 2d31 7d24 2927 290a 2020 2020 2020 2020  -1}$)').        
-0002a050: 6178 322e 7365 745f 786c 6162 656c 2827  ax2.set_xlabel('
-0002a060: 5761 7665 6e75 6d62 6572 2028 636d 245e  Wavenumber (cm$^
-0002a070: 7b2d 317d 2429 2729 0a20 2020 2020 2020  {-1}$)').       
-0002a080: 2061 7833 2e73 6574 5f78 6c61 6265 6c28   ax3.set_xlabel(
-0002a090: 2757 6176 656e 756d 6265 7220 2863 6d24  'Wavenumber (cm$
-0002a0a0: 5e7b 2d31 7d24 2927 290a 2020 2020 2020  ^{-1}$)').      
-0002a0b0: 2020 6178 342e 7365 745f 786c 6162 656c    ax4.set_xlabel
-0002a0c0: 2827 5761 7665 6e75 6d62 6572 2028 636d  ('Wavenumber (cm
-0002a0d0: 245e 7b2d 317d 2429 2729 0a20 2020 2020  $^{-1}$)').     
-0002a0e0: 2020 2061 7831 2e73 6574 5f79 6c61 6265     ax1.set_ylabe
-0002a0f0: 6c28 2749 6e74 656e 7369 7479 2729 0a20  l('Intensity'). 
-0002a100: 2020 2020 2020 2061 7832 2e73 6574 5f79         ax2.set_y
-0002a110: 6c61 6265 6c28 2749 6e74 656e 7369 7479  label('Intensity
-0002a120: 2729 0a20 2020 2020 2020 2061 7833 2e73  ').        ax3.s
-0002a130: 6574 5f79 6c61 6265 6c28 2749 6e74 656e  et_ylabel('Inten
-0002a140: 7369 7479 2729 0a20 2020 2020 2020 2061  sity').        a
-0002a150: 7834 2e73 6574 5f79 6c61 6265 6c28 2749  x4.set_ylabel('I
-0002a160: 6e74 656e 7369 7479 2729 0a20 2020 2020  ntensity').     
-0002a170: 2020 2066 6967 2e74 6967 6874 5f6c 6179     fig.tight_lay
-0002a180: 6f75 7428 290a 0a0a 2020 2020 2020 2020  out()...        
-0002a190: 7061 7468 333d 7061 7468 2b27 2f27 2b27  path3=path+'/'+'
-0002a1a0: 536b 6577 6e65 7373 5f69 6d61 6765 7327  Skewness_images'
-0002a1b0: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
-0002a1c0: 6174 682e 6578 6973 7473 2870 6174 6833  ath.exists(path3
-0002a1d0: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
-0002a1e0: 7574 3d27 7061 7468 2065 7869 7374 7327  ut='path exists'
-0002a1f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0002a200: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
-0002a210: 6b65 6469 7273 2870 6174 682b 272f 272b  kedirs(path+'/'+
-0002a220: 2027 536b 6577 6e65 7373 5f69 6d61 6765   'Skewness_image
-0002a230: 7327 2c20 6578 6973 745f 6f6b 3d46 616c  s', exist_ok=Fal
-0002a240: 7365 290a 0a0a 2020 2020 2020 2020 6669  se)...        fi
-0002a250: 6c65 3d66 696c 656e 616d 652e 7273 706c  le=filename.rspl
-0002a260: 6974 2827 2e74 7874 272c 2031 295b 305d  it('.txt', 1)[0]
-0002a270: 0a20 2020 2020 2020 2066 6967 2e73 6176  .        fig.sav
-0002a280: 6566 6967 2870 6174 6833 2b27 2f27 2b27  efig(path3+'/'+'
-0002a290: 4469 6164 325f 736b 6577 6e65 7373 5f7b  Diad2_skewness_{
-0002a2a0: 7d2e 706e 6727 2e66 6f72 6d61 7428 6669  }.png'.format(fi
-0002a2b0: 6c65 292c 2064 7069 3d64 7069 290a 0a0a  le), dpi=dpi)...
-0002a2c0: 2020 2020 6466 5f6f 7574 3d70 642e 4461      df_out=pd.Da
-0002a2d0: 7461 4672 616d 6528 6461 7461 3d7b 0a20  taFrame(data={. 
-0002a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a2f0: 2020 2020 2020 2020 2020 2020 2027 536b               'Sk
-0002a300: 6577 6e65 7373 5f64 6961 6432 273a 2041  ewness_diad2': A
-0002a310: 532c 0a20 2020 2020 2020 2020 2020 2020  S,.             
-0002a320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a330: 2027 4c48 535f 7469 655f 6469 6164 3227   'LHS_tie_diad2'
-0002a340: 3a20 785f 6e65 6172 6573 745f 4c48 532c  : x_nearest_LHS,
-0002a350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a360: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0002a370: 5248 535f 7469 655f 6469 6164 3227 3a20  RHS_tie_diad2': 
-0002a380: 785f 6e65 6172 6573 745f 5248 537d 2c20  x_nearest_RHS}, 
-0002a390: 696e 6465 783d 5b30 5d29 0a0a 2020 2020  index=[0])..    
-0002a3a0: 7265 7475 726e 2064 665f 6f75 740a 0a0a  return df_out...
-0002a3b0: 6465 6620 6c6f 6f70 5f64 6961 645f 736b  def loop_diad_sk
-0002a3c0: 6577 6e65 7373 282a 2c20 4469 6164 5f66  ewness(*, Diad_f
-0002a3d0: 696c 6573 2c20 7061 7468 3d4e 6f6e 652c  iles, path=None,
-0002a3e0: 2066 696c 6574 7970 653d 4e6f 6e65 2c20   filetype=None, 
-0002a3f0: 2073 6b65 776e 6573 733d 2761 6273 272c   skewness='abs',
-0002a400: 2073 6f72 743d 4661 6c73 652c 2069 6e74   sort=False, int
-0002a410: 5f63 7574 5f6f 6666 3d30 2e31 352c 0a63  _cut_off=0.15,.c
-0002a420: 6f6e 6669 675f 6469 6164 313a 2064 6961  onfig_diad1: dia
-0002a430: 6431 5f66 6974 5f63 6f6e 6669 673d 6469  d1_fit_config=di
-0002a440: 6164 315f 6669 745f 636f 6e66 6967 2829  ad1_fit_config()
-0002a450: 2c20 636f 6e66 6967 5f64 6961 6432 3a20  , config_diad2: 
-0002a460: 6469 6164 325f 6669 745f 636f 6e66 6967  diad2_fit_config
-0002a470: 3d64 6961 6432 5f66 6974 5f63 6f6e 6669  =diad2_fit_confi
-0002a480: 6728 292c 2070 726f 6d69 6e65 6e63 653d  g(), prominence=
-0002a490: 3130 2c20 7769 6474 683d 312c 2068 6569  10, width=1, hei
-0002a4a0: 6768 743d 3129 3a0a 2020 2020 2222 2220  ght=1):.    """ 
-0002a4b0: 4c6f 6f70 7320 6f76 6572 2061 6c6c 2073  Loops over all s
-0002a4c0: 7570 706c 6965 6420 6669 6c65 7320 746f  upplied files to
-0002a4d0: 2063 616c 6375 6c61 7465 2073 6b65 776e   calculate skewn
-0002a4e0: 6573 7320 666f 7220 6d75 6c74 6970 6c65  ess for multiple
-0002a4f0: 2073 7065 6374 7261 2075 7369 6e67 2074   spectra using t
-0002a500: 6865 2066 756e 6374 696f 6e73 0a20 2020  he functions.   
-0002a510: 2061 7373 6573 735f 6469 6164 315f 736b   assess_diad1_sk
-0002a520: 6577 6e65 7373 2829 2061 6e64 2061 7373  ewness() and ass
-0002a530: 6573 735f 6469 6164 325f 736b 6577 6e65  ess_diad2_skewne
-0002a540: 7373 2829 0a0a 0a20 2020 2050 6172 616d  ss()...    Param
-0002a550: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-0002a560: 2d2d 2d2d 2d0a 2020 2020 4469 6164 5f46  -----.    Diad_F
-0002a570: 696c 6573 3a20 6c69 7374 0a20 2020 2020  iles: list.     
-0002a580: 2020 204c 6973 7420 6f66 2066 696c 656e     List of filen
-0002a590: 616d 6573 2074 6f20 6c6f 6f70 2074 6872  ames to loop thr
-0002a5a0: 6f75 6768 0a0a 2020 2020 7061 7468 3a20  ough..    path: 
-0002a5b0: 7374 720a 2020 2020 2020 2020 466f 6c64  str.        Fold
-0002a5c0: 6572 2075 7365 7220 7769 7368 6573 2074  er user wishes t
-0002a5d0: 6f20 7265 6164 2064 6174 6120 6672 6f6d  o read data from
-0002a5e0: 0a0a 2020 2020 6669 6c65 7479 7065 3a20  ..    filetype: 
-0002a5f0: 7374 720a 2020 2020 2020 2020 4964 656e  str.        Iden
-0002a600: 7469 6669 6573 2074 7970 6520 6f66 2066  tifies type of f
-0002a610: 696c 650a 2020 2020 2020 2020 6368 6f6f  ile.        choo
-0002a620: 7365 2066 726f 6d20 2757 6974 6563 5f41  se from 'Witec_A
-0002a630: 5343 4949 272c 2027 6865 6164 6c65 7373  SCII', 'headless
-0002a640: 5f74 7874 272c 2027 6865 6164 6c65 7373  _txt', 'headless
-0002a650: 5f63 7376 272c 2027 6865 6164 5f63 7376  _csv', 'head_csv
-0002a660: 272c 2027 5769 7465 635f 4153 4349 4927  ', 'Witec_ASCII'
-0002a670: 2c0a 2020 2020 2020 2020 2748 4f52 4942  ,.        'HORIB
-0002a680: 415f 7478 7427 2c20 2752 656e 6973 6861  A_txt', 'Renisha
-0002a690: 775f 7478 7427 0a0a 2020 2020 736b 6577  w_txt'..    skew
-0002a6a0: 6e65 7373 3a20 2761 6273 2720 6f72 2027  ness: 'abs' or '
-0002a6b0: 6469 7227 0a20 2020 2020 2020 2049 6620  dir'.        If 
-0002a6c0: 2761 6273 272c 2067 6976 6573 2061 6273  'abs', gives abs
-0002a6d0: 6f6c 7574 6520 736b 6577 6e65 7373 2028  olute skewness (
-0002a6e0: 652e 672e 2c20 6c61 7267 6573 7420 706f  e.g., largest po
-0002a6f0: 7373 6962 6c65 206e 756d 6265 7220 7265  ssible number re
-0002a700: 6761 7264 6c65 7373 206f 6620 6469 7265  gardless of dire
-0002a710: 6374 696f 6e29 0a20 2020 2020 2020 2069  ction).        i
-0002a720: 6620 2764 6972 2720 646f 6573 2073 6b65  f 'dir' does ske
-0002a730: 776e 6573 7320 6173 206f 6e65 2073 6964  wness as one sid
-0002a740: 6520 6f76 6572 2074 6865 206f 7468 6572  e over the other
-0002a750: 0a0a 0a0a 2020 2020 736f 7274 3a20 626f  ....    sort: bo
-0002a760: 6f6c 0a20 2020 2020 2020 2049 6620 7472  ol.        If tr
-0002a770: 7565 2c20 736f 7274 7320 6669 6c65 7320  ue, sorts files 
-0002a780: 616c 7068 6162 6574 6963 616c 6c79 0a20  alphabetically. 
-0002a790: 2020 2066 696c 655f 6578 743a 2073 7472     file_ext: str
-0002a7a0: 0a20 2020 2020 2020 2046 696c 6520 666f  .        File fo
-0002a7b0: 726d 6174 2e20 4465 6661 756c 7420 7478  rmat. Default tx
-0002a7c0: 742c 2063 6f75 6c64 2061 6c73 6f20 656e  t, could also en
-0002a7d0: 7465 7220 6373 7620 6574 632e 0a20 2020  ter csv etc..   
-0002a7e0: 2065 7863 6c75 6465 5f73 7472 3a20 7374   exclude_str: st
-0002a7f0: 720a 2020 2020 2020 2020 4578 636c 7564  r.        Exclud
-0002a800: 6573 2066 696c 6573 2077 6974 6820 7468  es files with th
-0002a810: 6973 2073 7472 696e 6720 696e 2074 6865  is string in the
-0002a820: 6972 206e 616d 652e 2045 2e67 2e20 6966  ir name. E.g. if
-0002a830: 2065 7863 6c75 6465 5f73 7472 3d27 4e65   exclude_str='Ne
-0002a840: 2720 6974 2077 696c 6c20 6578 636c 7564  ' it will exclud
-0002a850: 6520 4e65 206c 696e 6573 0a20 2020 2065  e Ne lines.    e
-0002a860: 7863 6c75 6465 5f74 7970 653a 2073 7472  xclude_type: str
-0002a870: 0a20 2020 2020 2020 2045 7863 6c75 6465  .        Exclude
-0002a880: 7320 6669 6c65 7320 6f66 2074 6869 7320  s files of this 
-0002a890: 7479 7065 2c20 652e 672e 2065 7863 6c75  type, e.g. exclu
-0002a8a0: 6465 5f74 7970 653d 2770 6e67 2720 6765  de_type='png' ge
-0002a8b0: 7473 2072 6964 206f 6620 696d 6167 6520  ts rid of image 
-0002a8c0: 6669 6c65 732e 0a0a 0a20 2020 206c 6f77  files....    low
-0002a8d0: 6572 5f62 6173 656c 696e 655f 6469 6164  er_baseline_diad
-0002a8e0: 312c 206c 6f77 6572 5f62 6173 656c 696e  1, lower_baselin
-0002a8f0: 655f 6469 6164 323a 206c 6973 740a 2020  e_diad2: list.  
-0002a900: 2020 2020 2020 5265 6769 6f6e 206f 6620        Region of 
-0002a910: 7370 6563 7472 6120 746f 2075 7365 2061  spectra to use a
-0002a920: 2062 6173 656c 696e 6520 284c 4853 2920   baseline (LHS) 
-0002a930: 666f 7220 6469 6164 2031 2061 6e64 2064  for diad 1 and d
-0002a940: 6961 6432 0a0a 2020 2020 7570 7065 725f  iad2..    upper_
-0002a950: 6261 7365 6c69 6e65 5f64 6961 6431 2c20  baseline_diad1, 
-0002a960: 7570 7065 725f 6261 7365 6c69 6e65 5f64  upper_baseline_d
-0002a970: 6961 6432 3a20 6c69 7374 0a20 2020 2020  iad2: list.     
-0002a980: 2020 2052 6567 696f 6e20 6f66 2073 7065     Region of spe
-0002a990: 6374 7261 2074 6f20 7573 6520 6120 6261  ctra to use a ba
-0002a9a0: 7365 6c69 6e65 2028 5248 5329 2066 6f72  seline (RHS) for
-0002a9b0: 2064 6961 6420 3120 616e 6420 6469 6164   diad 1 and diad
-0002a9c0: 2032 0a0a 2020 2020 4e5f 706f 6c79 5f62   2..    N_poly_b
-0002a9d0: 636b 5f64 6961 6431 2c20 4e5f 706f 6c79  ck_diad1, N_poly
-0002a9e0: 5f62 636b 5f64 6961 6432 3a20 696e 740a  _bck_diad2: int.
-0002a9f0: 2020 2020 2020 2020 4465 6772 6565 206f          Degree o
-0002aa00: 6620 706f 6c79 6e6f 6d69 616c 2066 6f72  f polynomial for
-0002aa10: 2062 6163 6b67 726f 756e 6420 6669 7474   background fitt
-0002aa20: 696e 670a 0a20 2020 2073 6b65 776e 6573  ing..    skewnes
-0002aa30: 733a 2027 6162 7327 206f 7220 2764 6972  s: 'abs' or 'dir
-0002aa40: 270a 2020 2020 2020 2020 4966 2027 6162  '.        If 'ab
-0002aa50: 7327 2c20 6769 7665 7320 6162 736f 6c75  s', gives absolu
-0002aa60: 7465 2073 6b65 776e 6573 7320 2865 2e67  te skewness (e.g
-0002aa70: 2e2c 206c 6172 6765 7374 2070 6f73 7369  ., largest possi
-0002aa80: 626c 6520 6e75 6d62 6572 2072 6567 6172  ble number regar
-0002aa90: 646c 6573 7320 6f66 2064 6972 6563 7469  dless of directi
-0002aaa0: 6f6e 290a 2020 2020 2020 2020 6966 2027  on).        if '
-0002aab0: 6469 7227 2064 6f65 7320 736b 6577 6e65  dir' does skewne
-0002aac0: 7373 2061 7320 6f6e 6520 7369 6465 206f  ss as one side o
-0002aad0: 7665 7220 7468 6520 6f74 6865 720a 0a20  ver the other.. 
-0002aae0: 2020 2069 6e74 5f63 7574 5f6f 6666 3a20     int_cut_off: 
-0002aaf0: 666c 6f61 740a 2020 2020 2020 2020 5661  float.        Va
-0002ab00: 6c75 6520 6f66 2069 6e74 656e 7369 7479  lue of intensity
-0002ab10: 2061 7420 7768 6963 6820 746f 2063 616c   at which to cal
-0002ab20: 6375 6c61 7465 2074 6865 2073 6b65 776e  culate the skewn
-0002ab30: 6573 7320 2865 2e67 2e20 302e 3135 5820  ess (e.g. 0.15X 
-0002ab40: 7468 6520 7065 616b 2068 6569 6768 7429  the peak height)
-0002ab50: 2e0a 0a0a 2020 2020 5265 7475 726e 730a  ....    Returns.
-0002ab60: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a      -----------.
-0002ab70: 2020 2020 7064 2e44 6174 6146 7261 6d65      pd.DataFrame
-0002ab80: 2077 7469 6820 6669 6c65 6e61 6d65 2c20   wtih filename, 
-0002ab90: 736b 6577 6e65 7373 206f 6620 4469 6164  skewness of Diad
-0002aba0: 2031 2c0a 2020 2020 7468 6520 7820 706f   1,.    the x po
-0002abb0: 7369 7469 6f6e 206f 6620 7468 6520 4c48  sition of the LH
-0002abc0: 2061 6e64 2052 4820 7469 6520 706f 696e   and RH tie poin
-0002abd0: 7420 6174 2069 6e74 656e 7369 7479 3d69  t at intensity=i
-0002abe0: 6e74 5f69 6e74 5f63 7574 5f6f 6666 0a0a  nt_int_cut_off..
-0002abf0: 0a0a 2020 2020 2222 220a 0a0a 0a20 2020  ..    """....   
-0002ac00: 2064 665f 6469 6164 3120 3d20 7064 2e44   df_diad1 = pd.D
-0002ac10: 6174 6146 7261 6d65 285b 5d29 0a20 2020  ataFrame([]).   
-0002ac20: 2064 665f 6469 6164 3220 3d20 7064 2e44   df_diad2 = pd.D
-0002ac30: 6174 6146 7261 6d65 285b 5d29 0a20 2020  ataFrame([]).   
-0002ac40: 2064 665f 6d65 7267 6564 3d70 642e 4461   df_merged=pd.Da
-0002ac50: 7461 4672 616d 6528 5b5d 290a 2020 2020  taFrame([]).    
-0002ac60: 666f 7220 6920 696e 2072 616e 6765 2830  for i in range(0
-0002ac70: 2c20 6c65 6e28 4469 6164 5f66 696c 6573  , len(Diad_files
-0002ac80: 2929 3a0a 0a20 2020 2020 2020 2066 696c  )):..        fil
-0002ac90: 656e 616d 653d 4469 6164 5f66 696c 6573  ename=Diad_files
-0002aca0: 5b69 5d0a 2020 2020 2020 2020 7072 696e  [i].        prin
-0002acb0: 7428 2777 6f72 6b69 6e67 206f 6e20 6669  t('working on fi
-0002acc0: 6c65 2023 272b 7374 7228 6929 290a 0a20  le #'+str(i)).. 
-0002acd0: 2020 2020 2020 2064 6174 615f 6469 6164         data_diad
-0002ace0: 313d 6173 7365 7373 5f64 6961 6431 5f73  1=assess_diad1_s
-0002acf0: 6b65 776e 6573 7328 636f 6e66 6967 313d  kewness(config1=
-0002ad00: 636f 6e66 6967 5f64 6961 6431 2c0a 2020  config_diad1,.  
-0002ad10: 2020 2020 2020 696e 745f 6375 745f 6f66        int_cut_of
-0002ad20: 663d 696e 745f 6375 745f 6f66 662c 2070  f=int_cut_off, p
-0002ad30: 726f 6d69 6e65 6e63 653d 7072 6f6d 696e  rominence=promin
-0002ad40: 656e 6365 2c20 6865 6967 6874 3d68 6569  ence, height=hei
-0002ad50: 6768 742c 2077 6964 7468 3d77 6964 7468  ght, width=width
-0002ad60: 2c0a 2020 2020 2020 2020 736b 6577 6e65  ,.        skewne
-0002ad70: 7373 3d73 6b65 776e 6573 732c 2070 6174  ss=skewness, pat
-0002ad80: 683d 7061 7468 2c20 6669 6c65 6e61 6d65  h=path, filename
-0002ad90: 3d66 696c 656e 616d 652c 0a20 2020 2020  =filename,.     
-0002ada0: 2020 2066 696c 6574 7970 653d 6669 6c65     filetype=file
-0002adb0: 7479 7065 290a 0a20 2020 2020 2020 2064  type)..        d
-0002adc0: 6174 615f 6469 6164 323d 6173 7365 7373  ata_diad2=assess
-0002add0: 5f64 6961 6432 5f73 6b65 776e 6573 7328  _diad2_skewness(
-0002ade0: 636f 6e66 6967 313d 636f 6e66 6967 5f64  config1=config_d
-0002adf0: 6961 6432 2c0a 2020 2020 2020 2020 696e  iad2,.        in
-0002ae00: 745f 6375 745f 6f66 663d 696e 745f 6375  t_cut_off=int_cu
-0002ae10: 745f 6f66 662c 2070 726f 6d69 6e65 6e63  t_off, prominenc
-0002ae20: 653d 7072 6f6d 696e 656e 6365 2c20 6865  e=prominence, he
-0002ae30: 6967 6874 3d68 6569 6768 742c 2077 6964  ight=height, wid
-0002ae40: 7468 3d77 6964 7468 2c0a 2020 2020 2020  th=width,.      
-0002ae50: 2020 736b 6577 6e65 7373 3d73 6b65 776e    skewness=skewn
-0002ae60: 6573 732c 2070 6174 683d 7061 7468 2c20  ess, path=path, 
-0002ae70: 6669 6c65 6e61 6d65 3d66 696c 656e 616d  filename=filenam
-0002ae80: 652c 0a20 2020 2020 2020 2066 696c 6574  e,.        filet
-0002ae90: 7970 653d 6669 6c65 7479 7065 290a 0a0a  ype=filetype)...
-0002aea0: 2020 2020 2020 2020 6466 5f64 6961 6431          df_diad1
-0002aeb0: 203d 2070 642e 636f 6e63 6174 285b 6466   = pd.concat([df
-0002aec0: 5f64 6961 6431 2c20 6461 7461 5f64 6961  _diad1, data_dia
-0002aed0: 6431 5d2c 2061 7869 733d 3029 0a20 2020  d1], axis=0).   
-0002aee0: 2020 2020 2064 665f 6469 6164 3220 3d20       df_diad2 = 
-0002aef0: 2070 642e 636f 6e63 6174 285b 6466 5f64   pd.concat([df_d
-0002af00: 6961 6432 2c20 6461 7461 5f64 6961 6432  iad2, data_diad2
-0002af10: 5d2c 2061 7869 733d 3029 0a0a 0a0a 2020  ], axis=0)....  
-0002af20: 2020 6466 5f63 6f6d 626f 3d70 642e 636f    df_combo=pd.co
-0002af30: 6e63 6174 285b 6466 5f64 6961 6431 2c20  ncat([df_diad1, 
-0002af40: 6466 5f64 6961 6432 5d2c 2061 7869 733d  df_diad2], axis=
-0002af50: 3129 0a0a 2020 2020 636f 6c73 5f74 6f5f  1)..    cols_to_
-0002af60: 6d6f 7665 3d5b 2766 696c 656e 616d 6527  move=['filename'
-0002af70: 2c20 2753 6b65 776e 6573 735f 6469 6164  , 'Skewness_diad
-0002af80: 3127 2c20 2753 6b65 776e 6573 735f 6469  1', 'Skewness_di
-0002af90: 6164 3227 5d0a 0a20 2020 2064 665f 636f  ad2']..    df_co
-0002afa0: 6d62 6f20 3d20 6466 5f63 6f6d 626f 5b63  mbo = df_combo[c
-0002afb0: 6f6c 735f 746f 5f6d 6f76 6520 2b20 5b0a  ols_to_move + [.
-0002afc0: 2020 2020 2020 2020 636f 6c20 666f 7220          col for 
-0002afd0: 636f 6c20 696e 2064 665f 636f 6d62 6f2e  col in df_combo.
-0002afe0: 636f 6c75 6d6e 7320 6966 2063 6f6c 206e  columns if col n
-0002aff0: 6f74 2069 6e20 636f 6c73 5f74 6f5f 6d6f  ot in cols_to_mo
-0002b000: 7665 5d5d 0a0a 0a0a 0a20 2020 2072 6574  ve]].....    ret
-0002b010: 7572 6e20 6466 5f63 6f6d 626f 0a0a 0a0a  urn df_combo....
-0002b020: 0a0a 0a                                  ...
+0001f6d0: 2020 2020 2020 2020 2020 2744 6961 6432            'Diad2
+0001f6e0: 5f56 6f69 6774 5f43 656e 7427 3a6e 702e  _Voigt_Cent':np.
+0001f6f0: 6e61 6e2c 0a20 2020 2020 2020 2020 2020  nan,.           
+0001f700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f710: 2020 2020 2020 2020 2020 2020 2027 4469               'Di
+0001f720: 6164 325f 566f 6967 745f 4172 6561 273a  ad2_Voigt_Area':
+0001f730: 6e70 2e6e 616e 2c0a 2020 2020 2020 2020  np.nan,.        
+0001f740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f760: 2752 6573 6964 7561 6c5f 4469 6164 3227  'Residual_Diad2'
+0001f770: 3a20 6e70 2e6e 616e 2c0a 2020 2020 2020  : np.nan,.      
+0001f780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f7a0: 2020 2020 2020 2748 4231 5f43 656e 7427        'HB1_Cent'
+0001f7b0: 3a6e 702e 6e61 6e2c 0a20 2020 2020 2020  :np.nan,.       
+0001f7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f7e0: 2020 2020 2020 2020 2027 4842 315f 4172           'HB1_Ar
+0001f7f0: 6561 273a 6e70 2e6e 616e 2c0a 2020 2020  ea':np.nan,.    
+0001f800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f820: 2020 2020 2020 2020 2020 2020 2748 4232              'HB2
+0001f830: 5f43 656e 7427 3a6e 702e 6e61 6e2c 0a20  _Cent':np.nan,. 
+0001f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f870: 2020 2027 4842 325f 4172 6561 273a 6e70     'HB2_Area':np
+0001f880: 2e6e 616e 2c0a 2020 2020 2020 2020 2020  .nan,.          
+0001f890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8b0: 2020 2020 2020 2020 2020 2020 2020 2743                'C
+0001f8c0: 3133 5f43 656e 7427 3a20 6e70 2e6e 616e  13_Cent': np.nan
+0001f8d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f900: 2020 2020 2020 2020 2020 2743 3133 5f41            'C13_A
+0001f910: 7265 6127 3a20 6e70 2e6e 616e 2c0a 2020  rea': np.nan,.  
+0001f920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f950: 2020 2020 2020 7d29 0a20 2020 2020 2020        }).       
+0001f960: 2063 6f6d 626f 5f66 3d70 642e 636f 6e63   combo_f=pd.conc
+0001f970: 6174 285b 6466 2c20 4361 7262 5f66 6974  at([df, Carb_fit
+0001f980: 5d2c 2061 7869 733d 3129 0a20 2020 2020  ], axis=1).     
+0001f990: 2020 2069 6620 746f 5f63 6c69 7062 6f61     if to_clipboa
+0001f9a0: 7264 2069 7320 5472 7565 3a0a 2020 2020  rd is True:.    
+0001f9b0: 2020 2020 2020 2020 6466 2e74 6f5f 636c          df.to_cl
+0001f9c0: 6970 626f 6172 6428 6578 6365 6c3d 5472  ipboard(excel=Tr
+0001f9d0: 7565 2c20 6865 6164 6572 3d46 616c 7365  ue, header=False
+0001f9e0: 2c20 696e 6465 783d 4661 6c73 6529 0a20  , index=False). 
+0001f9f0: 2020 2020 2020 2063 6f6d 626f 5f66 3d64         combo_f=d
+0001fa00: 660a 0a20 2020 2069 6620 746f 5f63 7376  f..    if to_csv
+0001fa10: 2069 7320 5472 7565 3a0a 2020 2020 2020   is True:.      
+0001fa20: 2020 6966 2070 6174 6820 6973 204e 6f6e    if path is Non
+0001fa30: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0001fa40: 6169 7365 2045 7863 6570 7469 6f6e 2827  aise Exception('
+0001fa50: 596f 7520 6e65 6564 2074 6f20 7370 6563  You need to spec
+0001fa60: 6966 7920 7061 7468 3d20 666f 7220 7768  ify path= for wh
+0001fa70: 6572 6576 6572 2079 6f75 2077 616e 7420  erever you want 
+0001fa80: 7468 6973 2073 6176 6564 2729 0a20 2020  this saved').   
+0001fa90: 2020 2020 2070 6174 685f 6669 7473 3d70       path_fits=p
+0001faa0: 6174 682b 272f 272b 2744 6961 645f 4669  ath+'/'+'Diad_Fi
+0001fab0: 7473 270a 2020 2020 2020 2020 6966 206f  ts'.        if o
+0001fac0: 732e 7061 7468 2e65 7869 7374 7328 7061  s.path.exists(pa
+0001fad0: 7468 5f66 6974 7329 3a0a 2020 2020 2020  th_fits):.      
+0001fae0: 2020 2020 2020 6f75 743d 2770 6174 6820        out='path 
+0001faf0: 6578 6973 7473 270a 2020 2020 2020 2020  exists'.        
+0001fb00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001fb10: 2020 6469 7232 3d6f 732e 6d61 6b65 6469    dir2=os.makedi
+0001fb20: 7273 2870 6174 682b 272f 272b 2027 4469  rs(path+'/'+ 'Di
+0001fb30: 6164 5f46 6974 7327 2c20 6578 6973 745f  ad_Fits', exist_
+0001fb40: 6f6b 3d46 616c 7365 290a 2020 2020 2020  ok=False).      
+0001fb50: 2020 2366 696c 6570 6174 683d 5061 7468    #filepath=Path
+0001fb60: 2870 6174 682b 272f 272b 2027 5065 616b  (path+'/'+ 'Peak
+0001fb70: 5f46 6974 7327 2b27 2f27 2b66 696c 656e  _Fits'+'/'+filen
+0001fb80: 616d 6529 0a20 2020 2020 2020 2063 6f6d  ame).        com
+0001fb90: 626f 5f66 2e74 6f5f 6373 7628 7061 7468  bo_f.to_csv(path
+0001fba0: 2b27 2f27 2b27 4469 6164 5f46 6974 7327  +'/'+'Diad_Fits'
+0001fbb0: 2b27 2f27 2b27 6669 7473 5f27 2b66 696c  +'/'+'fits_'+fil
+0001fbc0: 656e 616d 6529 0a20 2020 2072 6574 7572  ename).    retur
+0001fbd0: 6e20 636f 6d62 6f5f 660a 0a0a 0a0a 6465  n combo_f.....de
+0001fbe0: 6620 6361 6c63 756c 6174 655f 4842 5f44  f calculate_HB_D
+0001fbf0: 6961 645f 6172 6561 5f72 6174 696f 2864  iad_area_ratio(d
+0001fc00: 6629 3a0a 2020 2020 2222 2222 2043 616c  f):.    """" Cal
+0001fc10: 6375 6c61 7465 7320 7477 6f20 6172 6561  culates two area
+0001fc20: 2072 6174 696f 7320 6f66 2068 6f74 6261   ratios of hotba
+0001fc30: 6e64 7320 616e 6420 6469 6164 7322 2222  nds and diads"""
+0001fc40: 0a20 2020 2064 665f 633d 6466 2e63 6f70  .    df_c=df.cop
+0001fc50: 7928 290a 2020 2020 6466 5f63 5b27 4842  y().    df_c['HB
+0001fc60: 5f44 6961 645f 5261 7469 6f27 5d3d 2864  _Diad_Ratio']=(d
+0001fc70: 665f 635b 2748 4231 5f41 7265 6127 5d2b  f_c['HB1_Area']+
+0001fc80: 6466 5f63 5b27 4842 325f 4172 6561 275d  df_c['HB2_Area']
+0001fc90: 292f 2864 665f 635b 2744 6961 6431 5f56  )/(df_c['Diad1_V
+0001fca0: 6f69 6774 5f41 7265 6127 5d2b 6466 5f63  oigt_Area']+df_c
+0001fcb0: 5b27 4469 6164 325f 566f 6967 745f 4172  ['Diad2_Voigt_Ar
+0001fcc0: 6561 275d 290a 2020 2020 6466 5f63 5b27  ea']).    df_c['
+0001fcd0: 4842 5f54 6f74 616c 5f52 6174 696f 275d  HB_Total_Ratio']
+0001fce0: 3d28 6466 5f63 5b27 4842 315f 4172 6561  =(df_c['HB1_Area
+0001fcf0: 275d 2b64 665f 635b 2748 4232 5f41 7265  ']+df_c['HB2_Are
+0001fd00: 6127 5d29 2f28 6466 5f63 5b27 4469 6164  a'])/(df_c['Diad
+0001fd10: 315f 566f 6967 745f 4172 6561 275d 2b64  1_Voigt_Area']+d
+0001fd20: 665f 635b 2744 6961 6432 5f56 6f69 6774  f_c['Diad2_Voigt
+0001fd30: 5f41 7265 6127 5d2b 6466 5f63 5b27 4842  _Area']+df_c['HB
+0001fd40: 315f 4172 6561 275d 2b64 665f 635b 2748  1_Area']+df_c['H
+0001fd50: 4232 5f41 7265 6127 5d29 0a20 2020 2072  B2_Area']).    r
+0001fd60: 6574 7572 6e20 6466 5f63 0a0a 0a0a 0a0a  eturn df_c......
+0001fd70: 0a23 2320 4669 7420 6765 6e65 7269 6320  .## Fit generic 
+0001fd80: 7065 616b 0a0a 4064 6174 6163 6c61 7373  peak..@dataclass
+0001fd90: 0a63 6c61 7373 2067 656e 6572 6963 5f70  .class generic_p
+0001fda0: 6561 6b5f 636f 6e66 6967 3a0a 2020 2020  eak_config:.    
+0001fdb0: 2222 220a 2020 2020 436f 6e66 6967 7572  """.    Configur
+0001fdc0: 6174 696f 6e20 636c 6173 7320 666f 7220  ation class for 
+0001fdd0: 6669 7474 696e 6720 7365 636f 6e64 6172  fitting secondar
+0001fde0: 7920 7065 616b 7320 2865 2e67 2e20 534f  y peaks (e.g. SO
+0001fdf0: 322c 2043 6172 626f 6e61 7465 290a 0a20  2, Carbonate).. 
+0001fe00: 2020 2041 7474 7269 6275 7465 733a 0a20     Attributes:. 
+0001fe10: 2020 2020 2020 206e 616d 6520 2873 7472         name (str
+0001fe20: 293a 2044 6566 6175 6c74 2027 4765 6e65  ): Default 'Gene
+0001fe30: 7269 6327 0a20 2020 2020 2020 2020 2020  ric'.           
+0001fe40: 204e 616d 6520 6f66 2063 6f6d 706f 6e65   Name of compone
+0001fe50: 6e74 2079 6f75 2061 7265 2066 6974 7469  nt you are fitti
+0001fe60: 6e67 2074 6861 7420 6765 7473 2073 7461  ng that gets sta
+0001fe70: 6d70 6564 206f 6e74 6f20 7468 6520 7065  mped onto the pe
+0001fe80: 616b 2070 6172 616d 6574 6572 732c 2065  ak parameters, e
+0001fe90: 2e67 2e20 6966 2027 534f 3227 2c20 6765  .g. if 'SO2', ge
+0001fea0: 7420 5065 616b 5f41 7265 615f 534f 3227  t Peak_Area_SO2'
+0001feb0: 0a0a 2020 2020 2020 2020 6c6f 7765 725f  ..        lower_
+0001fec0: 6263 6b2c 2075 7070 6572 5f62 636b 3a20  bck, upper_bck: 
+0001fed0: 5475 706c 655b 666c 6f61 742c 2066 6c6f  Tuple[float, flo
+0001fee0: 6174 5d0a 2020 2020 2020 2020 2020 2020  at].            
+0001fef0: 4261 636b 6772 6f75 6e64 2070 6f73 6974  Background posit
+0001ff00: 696f 6e73 2069 6e20 7761 7665 6e75 6d62  ions in wavenumb
+0001ff10: 6572 730a 0a20 2020 2020 2020 206d 6f64  ers..        mod
+0001ff20: 656c 5f6e 616d 653a 2044 6566 6175 6c74  el_name: Default
+0001ff30: 2027 5073 6575 646f 566f 6967 7427 0a20   'PseudoVoigt'. 
+0001ff40: 2020 2020 2020 2020 2020 2054 7970 6520             Type 
+0001ff50: 6f66 2070 6561 6b20 6669 742e 2043 686f  of peak fit. Cho
+0001ff60: 6f73 6520 6672 6f6d 2027 4761 7573 7369  ose from 'Gaussi
+0001ff70: 616e 4d6f 6465 6c27 2c20 2756 6f69 6774  anModel', 'Voigt
+0001ff80: 4d6f 6465 6c27 2c20 2750 7365 7564 6f56  Model', 'PseudoV
+0001ff90: 6f69 6774 4d6f 6465 6c27 2c20 2753 706c  oigtModel', 'Spl
+0001ffa0: 696e 6527 2e0a 0a20 2020 2020 2020 2078  ine'...        x
+0001ffb0: 5f72 616e 6765 5f62 636b 3a20 666c 6f61  _range_bck: floa
+0001ffc0: 7420 2864 6566 6175 6c74 2031 3029 0a20  t (default 10). 
+0001ffd0: 2020 2020 2020 2020 2020 2057 6865 6e20             When 
+0001ffe0: 7368 6f77 696e 6720 6263 6b20 636f 6c6c  showing bck coll
+0001fff0: 6563 7465 6420 706c 6f74 2c20 7368 6f77  ected plot, show
+00020000: 7320 7065 616b 2063 656e 7465 7220 2b2d  s peak center +-
+00020010: 2074 6869 7320 616d 6f75 6e74 0a0a 2020   this amount..  
+00020020: 2020 2020 2020 4e5f 706f 6c79 5f63 6172        N_poly_car
+00020030: 625f 6263 6b3a 2066 6c6f 6174 2028 6465  b_bck: float (de
+00020040: 6661 756c 7420 3129 0a20 2020 2020 2020  fault 1).       
+00020050: 2020 2020 2044 6567 7265 6520 6f66 2070       Degree of p
+00020060: 6f6c 796e 6f6d 6961 6c20 746f 2066 6974  olynomial to fit
+00020070: 2074 6f20 6261 636b 6772 6f75 6e64 2e0a   to background..
+00020080: 0a20 2020 2020 2020 2061 6d70 6c69 7475  .        amplitu
+00020090: 6465 3a20 666c 6f61 7420 2864 6566 6175  de: float (defau
+000200a0: 6c74 2031 3030 290a 2020 2020 2020 2020  lt 100).        
+000200b0: 2020 2020 4170 7072 6f78 696d 6174 6520      Approximate 
+000200c0: 616d 706c 6974 7564 6520 6f66 2070 6561  amplitude of pea
+000200d0: 6b20 6669 7420 2866 6972 7374 2067 7565  k fit (first gue
+000200e0: 7373 2066 6f72 2047 6175 7373 6961 6e20  ss for Gaussian 
+000200f0: 2c20 766f 6967 7420 616e 6420 5073 7565  , voigt and Psue
+00020100: 646f 766f 6967 7420 6e65 6564 6564 290a  dovoigt needed).
+00020110: 0a20 2020 2020 2020 2063 656e 743a 2066  .        cent: f
+00020120: 6c6f 6174 2028 6465 6661 756c 7420 3130  loat (default 10
+00020130: 3930 290a 2020 2020 2020 2020 2020 2020  90).            
+00020140: 4170 7072 6f78 696d 6174 6520 7065 616b  Approximate peak
+00020150: 2070 6f73 6974 696f 6e20 6f66 2073 7065   position of spe
+00020160: 6369 6573 2079 6f75 2061 7265 206c 6f6f  cies you are loo
+00020170: 6b69 6e67 2066 6f72 2e20 452e 672e 2031  king for. E.g. 1
+00020180: 3039 3020 666f 7220 434f 322c 2031 3135  090 for CO2, 115
+00020190: 3020 666f 7220 534f 320a 0a20 2020 2020  0 for SO2..     
+000201a0: 2020 206f 7574 6c69 6572 5f73 6967 6d61     outlier_sigma
+000201b0: 3a20 666c 6f61 7420 2864 6566 6175 6c74  : float (default
+000201c0: 2031 3229 0a20 2020 2020 2020 2020 2020   12).           
+000201d0: 2043 6f64 6520 6361 6c63 756c 6174 6573   Code calculates
+000201e0: 2073 7461 6e64 6172 6420 6465 7669 6174   standard deviat
+000201f0: 696f 6e20 6f66 2062 6163 6b67 726f 756e  ion of backgroun
+00020200: 642c 2061 6e64 2065 7863 6c75 6465 7320  d, and excludes 
+00020210: 706f 696e 7473 206d 6f72 6520 7468 616e  points more than
+00020220: 206f 7574 6c69 6572 5f73 6967 6d61 2a74   outlier_sigma*t
+00020230: 6869 7320 7374 616e 6461 7264 2064 6576  his standard dev
+00020240: 6961 746f 696e 2066 726f 6d20 6e65 6172  iatoin from near
+00020250: 6279 2062 6163 6b67 726f 756e 6420 706f  by background po
+00020260: 696e 7473 0a0a 2020 2020 2020 2020 6469  ints..        di
+00020270: 7374 616e 6365 2c20 7072 6f6d 696e 656e  stance, prominen
+00020280: 6365 2c20 7769 6474 682c 2074 6872 6573  ce, width, thres
+00020290: 686f 6c64 2c20 6865 6967 6874 3a20 666c  hold, height: fl
+000202a0: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+000202b0: 5363 6970 7920 6669 6e64 2070 6561 6b20  Scipy find peak 
+000202c0: 7061 7261 6d65 7465 7273 2074 6f20 6765  parameters to ge
+000202d0: 7420 696e 6974 6961 6c20 6669 7420 6f66  t initial fit of
+000202e0: 2070 6561 6b0a 0a0a 0a0a 2020 2020 2020   peak.....      
+000202f0: 2020 6669 745f 7065 616b 7320 2869 6e74    fit_peaks (int
+00020300: 293a 2044 6566 6175 6c74 2032 0a20 2020  ): Default 2.   
+00020310: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
+00020320: 6f66 2070 6561 6b73 2074 6f20 6669 742e  of peaks to fit.
+00020330: 2032 203d 2044 6961 6420 2b20 4842 2c20   2 = Diad + HB, 
+00020340: 3120 3d20 4469 6164 2e0a 0a20 2020 2022  1 = Diad...    "
+00020350: 2222 0a0a 2020 2020 2320 4e61 6d65 2074  ""..    # Name t
+00020360: 6861 7420 6765 7473 2073 7461 6d70 6564  hat gets stamped
+00020370: 206f 6e74 6f20 6669 7473 0a20 2020 206e   onto fits.    n
+00020380: 616d 653a 2073 7472 3d20 2767 656e 6572  ame: str= 'gener
+00020390: 6963 270a 2020 2020 2320 5365 6c65 6374  ic'.    # Select
+000203a0: 696e 6720 7468 6520 7477 6f20 6261 636b  ing the two back
+000203b0: 6772 6f75 6e64 2070 6f73 6974 696f 6e73  ground positions
+000203c0: 0a20 2020 206c 6f77 6572 5f62 636b 3a20  .    lower_bck: 
+000203d0: 5475 706c 655b 666c 6f61 742c 2066 6c6f  Tuple[float, flo
+000203e0: 6174 5d3d 2831 3036 302c 2031 3036 3529  at]=(1060, 1065)
+000203f0: 0a20 2020 2075 7070 6572 5f62 636b 3a20  .    upper_bck: 
+00020400: 5475 706c 655b 666c 6f61 742c 2066 6c6f  Tuple[float, flo
+00020410: 6174 5d3d 2831 3132 302c 2031 3133 3029  at]=(1120, 1130)
+00020420: 0a0a 2020 2020 230a 2020 2020 6d6f 6465  ..    #.    mode
+00020430: 6c5f 6e61 6d65 3a20 7374 723d 2750 7365  l_name: str='Pse
+00020440: 7564 6f56 6f69 6774 4d6f 6465 6c27 0a20  udoVoigtModel'. 
+00020450: 2020 2078 5f72 616e 6765 5f62 636b 3a20     x_range_bck: 
+00020460: 666c 6f61 743d 3130 0a0a 2020 2020 2320  float=10..    # 
+00020470: 4261 636b 6772 6f75 6e64 2064 6567 7265  Background degre
+00020480: 6520 6f66 2070 6f6c 796e 6f6d 6961 6c0a  e of polynomial.
+00020490: 2020 2020 4e5f 706f 6c79 5f63 6172 625f      N_poly_carb_
+000204a0: 6263 6b3a 2066 6c6f 6174 203d 310a 2020  bck: float =1.  
+000204b0: 2020 2320 5365 6c65 7463 7469 6e67 2074    # Seletcting t
+000204c0: 6865 2061 6d70 6c69 7475 6465 0a20 2020  he amplitude.   
+000204d0: 2061 6d70 6c69 7475 6465 3a20 666c 6f61   amplitude: floa
+000204e0: 7420 3d31 3030 300a 0a20 2020 2023 2053  t =1000..    # S
+000204f0: 656c 6563 7469 6e67 2074 6865 2070 6561  electing the pea
+00020500: 6b20 6365 6e74 6572 0a20 2020 2063 656e  k center.    cen
+00020510: 743a 2066 6c6f 6174 203d 3130 3930 0a0a  t: float =1090..
+00020520: 2020 2020 2320 6f75 746c 6965 7220 7369      # outlier si
+00020530: 676d 6120 746f 2064 6973 6361 7264 2062  gma to discard b
+00020540: 6163 6b67 726f 756e 6420 6174 0a20 2020  ackground at.   
+00020550: 206f 7574 6c69 6572 5f73 6967 6d61 3a20   outlier_sigma: 
+00020560: 666c 6f61 7420 3d31 320a 0a0a 0a20 2020  float =12....   
+00020570: 2023 2050 6172 616d 6574 6572 7320 666f   # Parameters fo
+00020580: 7220 5363 6970 7920 6669 6e64 2070 6561  r Scipy find pea
+00020590: 6b73 0a20 2020 2064 6973 7461 6e63 653a  ks.    distance:
+000205a0: 2066 6c6f 6174 3d31 300a 2020 2020 7072   float=10.    pr
+000205b0: 6f6d 696e 656e 6365 3a20 666c 6f61 743d  ominence: float=
+000205c0: 350a 2020 2020 7769 6474 683a 2066 6c6f  5.    width: flo
+000205d0: 6174 3d36 0a20 2020 2074 6872 6573 686f  at=6.    thresho
+000205e0: 6c64 3a20 666c 6f61 743d 302e 310a 2020  ld: float=0.1.  
+000205f0: 2020 6865 6967 6874 3a66 6c6f 6174 203d    height:float =
+00020600: 3130 300a 0a20 2020 2023 2045 7863 6c75  100..    # Exclu
+00020610: 6469 6e67 2061 2072 616e 6765 2066 6f72  ding a range for
+00020620: 2063 6f73 6d69 6320 7261 7973 2065 7463   cosmic rays etc
+00020630: 2e0a 2020 2020 6578 636c 7564 655f 7261  ..    exclude_ra
+00020640: 6e67 653a 204f 7074 696f 6e61 6c20 5b54  nge: Optional [T
+00020650: 7570 6c65 5b66 6c6f 6174 2c20 666c 6f61  uple[float, floa
+00020660: 745d 5d3d 4e6f 6e65 0a0a 0a20 2020 2023  t]]=None...    #
+00020670: 2052 6574 7572 6e20 6f74 6865 7220 7061   Return other pa
+00020680: 7261 6d65 7465 7265 7320 652e 672e 2069  rameteres e.g. i
+00020690: 6e74 6572 6d65 6469 6174 6520 6f75 7470  ntermediate outp
+000206a0: 7574 730a 2020 2020 7265 7475 726e 5f6f  uts.    return_o
+000206b0: 7468 6572 5f70 6172 616d 733a 2062 6f6f  ther_params: boo
+000206c0: 6c20 3d20 4661 6c73 650a 0a20 2020 204e  l = False..    N
+000206d0: 5f70 6561 6b73 3a20 696e 743d 2031 0a0a  _peaks: int= 1..
+000206e0: 2020 2020 696e 745f 6375 745f 6f66 663a      int_cut_off:
+000206f0: 2066 6c6f 6174 3d30 2e30 350a 0a0a 0a0a   float=0.05.....
+00020700: 0a64 6566 2066 6974 5f67 656e 6572 6963  .def fit_generic
+00020710: 5f70 6561 6b28 2a2c 2063 6f6e 6669 673a  _peak(*, config:
+00020720: 2067 656e 6572 6963 5f70 6561 6b5f 636f   generic_peak_co
+00020730: 6e66 6967 3d67 656e 6572 6963 5f70 6561  nfig=generic_pea
+00020740: 6b5f 636f 6e66 6967 2829 2c0a 7061 7468  k_config(),.path
+00020750: 3d4e 6f6e 652c 2066 696c 656e 616d 653d  =None, filename=
+00020760: 4e6f 6e65 2c20 6669 6c65 7479 7065 3d4e  None, filetype=N
+00020770: 6f6e 652c 0a20 706c 6f74 5f66 6967 7572  one,. plot_figur
+00020780: 653d 5472 7565 2c20 6470 693d 3230 3029  e=True, dpi=200)
+00020790: 3a0a 0a20 2020 2022 2222 2054 6869 7320  :..    """ This 
+000207a0: 6675 6e63 7469 6f6e 2066 6974 7320 6120  function fits a 
+000207b0: 6765 6e65 7269 6320 7065 616b 2077 6974  generic peak wit
+000207c0: 6820 7661 7269 6f75 7320 6f70 7469 6f6e  h various option
+000207d0: 730a 0a20 2020 2063 6f6e 6669 673a 2066  s..    config: f
+000207e0: 726f 6d20 6461 7461 636c 6173 7320 6765  rom dataclass ge
+000207f0: 6e65 7269 635f 7065 616b 5f63 6f6e 6669  neric_peak_confi
+00020800: 670a 0a20 2020 2020 2020 206d 6f64 656c  g..        model
+00020810: 5f6e 616d 653a 2073 7472 2c20 2747 6175  _name: str, 'Gau
+00020820: 7373 6961 6e4d 6f64 656c 272c 2027 566f  ssianModel', 'Vo
+00020830: 6967 744d 6f64 656c 272c 2027 5073 6575  igtModel', 'Pseu
+00020840: 646f 566f 6967 744d 6f64 656c 272c 2027  doVoigtModel', '
+00020850: 5370 6c69 6e65 272c 2027 506f 6c79 272c  Spline', 'Poly',
+00020860: 0a20 2020 2020 2020 2020 2020 2046 6974  .            Fit
+00020870: 7320 4761 7573 7369 616e 2c20 566f 6967  s Gaussian, Voig
+00020880: 742c 206f 7220 5073 6575 646f 566f 6967  t, or PseudoVoig
+00020890: 742c 206f 7220 6669 7473 2061 2073 706c  t, or fits a spl
+000208a0: 696e 6520 6f72 2070 6f6c 796e 6f6d 6169  ine or polynomai
+000208b0: 6c20 616e 6420 6765 7473 2061 7265 6120  l and gets area 
+000208c0: 756e 6465 726e 6561 7468 0a0a 2020 2020  underneath..    
+000208d0: 2020 2020 6e61 6d65 3a20 7374 720a 2020      name: str.  
+000208e0: 2020 2020 2020 2020 2020 4e61 6d65 206f            Name o
+000208f0: 6620 6665 6174 7572 6520 796f 7520 6172  f feature you ar
+00020900: 6520 6669 7474 696e 672e 2055 7365 6420  e fitting. Used 
+00020910: 746f 206d 616b 6520 636f 6c75 6d6e 2068  to make column h
+00020920: 6561 6469 6e67 7320 696e 206f 7574 7075  eadings in outpu
+00020930: 7420 2865 2e67 2e2c 2069 6620 534f 322c  t (e.g., if SO2,
+00020940: 206f 7574 7075 7473 2061 7265 2050 6561   outputs are Pea
+00020950: 6b5f 4365 6e74 5f53 4f32 2c20 5065 616b  k_Cent_SO2, Peak
+00020960: 5f41 7265 615f 534f 3229 0a0a 2020 2020  _Area_SO2)..    
+00020970: 2020 2020 696e 745f 6375 745f 6f66 663a      int_cut_off:
+00020980: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
+00020990: 2020 2066 6974 7320 7065 616b 206f 7574     fits peak out
+000209a0: 2074 6f20 696e 745f 6375 745f 6f66 662a   to int_cut_off*
+000209b0: 2070 6561 6b20 6865 6967 6874 2e0a 0a20   peak height... 
+000209c0: 2020 2020 2020 206c 6f77 6572 5f62 6b63         lower_bkc
+000209d0: 3a20 5475 706c 655b 666c 6f61 742c 2066  : Tuple[float, f
+000209e0: 6c6f 6174 5d0a 2020 2020 2020 2020 2020  loat].          
+000209f0: 2020 5570 7065 7220 616e 6420 6c6f 7765    Upper and lowe
+00020a00: 7220 7820 636f 6f72 6469 6e61 7465 2066  r x coordinate f
+00020a10: 6f72 2062 6163 6b67 726f 756e 6420 746f  or background to
+00020a20: 206c 6566 7420 6f66 2070 6561 6b0a 0a20   left of peak.. 
+00020a30: 2020 2020 2020 2075 7070 6572 5f62 6b63         upper_bkc
+00020a40: 3a20 5475 706c 655b 666c 6f61 742c 2066  : Tuple[float, f
+00020a50: 6c6f 6174 5d0a 2020 2020 2020 2020 2020  loat].          
+00020a60: 2020 5570 7065 7220 616e 6420 6c6f 7765    Upper and lowe
+00020a70: 7220 7820 636f 6f72 6469 6e61 7465 2066  r x coordinate f
+00020a80: 6f72 2062 6163 6b67 726f 756e 6420 746f  or background to
+00020a90: 2072 6967 6874 206f 6620 7065 616b 0a0a   right of peak..
+00020aa0: 2020 2020 2020 2020 785f 7261 6e67 655f          x_range_
+00020ab0: 6263 6b3a 2066 6c6f 6174 0a20 2020 2020  bck: float.     
+00020ac0: 2020 2020 2020 2073 6574 7320 786c 696d         sets xlim
+00020ad0: 206f 6620 6669 6775 7265 2c20 6173 2074   of figure, as t
+00020ae0: 6865 2070 6561 6b20 6365 6e74 6572 202b  he peak center +
+00020af0: 2078 5f72 616e 6765 5f62 636b 2c20 616e   x_range_bck, an
+00020b00: 6420 7065 616b 2063 656e 7420 2d20 785f  d peak cent - x_
+00020b10: 7261 6e67 655f 6263 6b0a 0a20 2020 2020  range_bck..     
+00020b20: 2020 204e 5f70 6f6c 795f 6361 7262 5f62     N_poly_carb_b
+00020b30: 636b 3a20 696e 740a 2020 2020 2020 2020  ck: int.        
+00020b40: 2020 2020 4465 6772 6565 206f 6620 706f      Degree of po
+00020b50: 6c79 6e6f 6d69 616c 2074 6f20 6669 7420  lynomial to fit 
+00020b60: 746f 2074 6865 2062 6163 6b67 726f 756e  to the backgroun
+00020b70: 6420 706f 7369 7469 6f6e 730a 0a20 2020  d positions..   
+00020b80: 2020 2020 2061 6d70 6c69 7475 6465 3a20       amplitude: 
+00020b90: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
+00020ba0: 2020 4170 7072 6f78 2061 6d70 6c69 7475    Approx amplitu
+00020bb0: 6465 206f 6620 7065 616b 2e0a 0a20 2020  de of peak...   
+00020bc0: 2020 2020 2063 656e 743a 2066 6c6f 6174       cent: float
+00020bd0: 0a20 2020 2020 2020 2020 2020 2041 7070  .            App
+00020be0: 726f 7820 6365 6e74 206f 6620 7065 616b  rox cent of peak
+00020bf0: 0a0a 2020 2020 2020 2020 6f75 746c 6965  ..        outlie
+00020c00: 725f 7369 676d 613a 2066 6c6f 6174 0a20  r_sigma: float. 
+00020c10: 2020 2020 2020 2020 2020 2044 6973 6361             Disca
+00020c20: 7264 7320 706f 696e 7473 206f 6e20 7468  rds points on th
+00020c30: 6520 6261 636b 6772 6f75 6e64 206f 7574  e background out
+00020c40: 7369 6465 206f 7574 6c69 6572 5f73 6967  side outlier_sig
+00020c50: 6d61 206f 6620 7468 6520 6d65 6469 616e  ma of the median
+00020c60: 2076 616c 7565 0a0a 2020 2020 2020 2020   value..        
+00020c70: 6469 7374 616e 6365 2c20 7072 6f6d 696e  distance, promin
+00020c80: 656e 6365 2c20 7468 7265 7368 6f6c 642c  ence, threshold,
+00020c90: 2068 6569 6768 743a 2066 6c6f 6174 730a   height: floats.
+00020ca0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00020cb0: 6d65 7465 7273 2066 6f72 2073 6369 7079  meters for scipy
+00020cc0: 2066 696e 645f 7065 616b 730a 0a20 2020   find_peaks..   
+00020cd0: 2020 2020 2065 7863 6c75 6465 5f72 616e       exclude_ran
+00020ce0: 6765 3a20 4f70 7469 6f6e 616c 205b 5475  ge: Optional [Tu
+00020cf0: 706c 655b 666c 6f61 742c 2066 6c6f 6174  ple[float, float
+00020d00: 5d5d 0a20 2020 2020 2020 2020 2020 2045  ]].            E
+00020d10: 7863 6c75 6465 7320 7265 6769 6f6e 206f  xcludes region o
+00020d20: 6620 7370 6563 7472 6120 6265 7477 6565  f spectra betwee
+00020d30: 6e20 7468 6573 6520 7661 6c75 6573 0a0a  n these values..
+00020d40: 2020 2020 2020 2020 6470 693a 2066 6c6f          dpi: flo
+00020d50: 6174 0a20 2020 2020 2020 2020 2020 2064  at.            d
+00020d60: 7069 2074 6f20 7361 7665 2066 6967 7572  pi to save figur
+00020d70: 6520 6174 0a0a 2020 2020 2020 2020 7265  e at..        re
+00020d80: 7475 726e 5f6f 7468 6572 5f70 6172 616d  turn_other_param
+00020d90: 733a 2062 6f6f 6c0a 2020 2020 2020 2020  s: bool.        
+00020da0: 2020 2020 6966 2054 7275 652c 2072 6574      if True, ret
+00020db0: 7572 6e73 206f 7468 6572 2070 6561 6b20  urns other peak 
+00020dc0: 6669 7420 7061 7261 6d65 7465 7273 2061  fit parameters a
+00020dd0: 6e64 2066 6974 7320 2864 662c 2078 785f  nd fits (df, xx_
+00020de0: 6361 7262 2c20 795f 6361 7262 2c20 7265  carb, y_carb, re
+00020df0: 7375 6c74 3029 2c0a 2020 2020 2020 2020  sult0),.        
+00020e00: 2020 2020 656c 7365 206a 7573 7420 7265      else just re
+00020e10: 7475 726e 7320 6466 206f 6620 7065 616b  turns df of peak
+00020e20: 2070 6f73 6974 696f 6e73 2c20 6865 6967   positions, heig
+00020e30: 6874 7320 6574 630a 0a0a 2020 2020 7061  hts etc...    pa
+00020e40: 7468 3a20 7374 720a 2020 2020 2020 2020  th: str.        
+00020e50: 5061 7468 2074 6f20 6669 6c65 0a0a 2020  Path to file..  
+00020e60: 2020 6669 6c65 6e61 6d65 3a20 7374 720a    filename: str.
+00020e70: 2020 2020 2020 2020 6669 6c65 6e61 6d65          filename
+00020e80: 2077 6974 6820 6669 6c65 2065 7874 656e   with file exten
+00020e90: 7369 6f6e 0a0a 2020 2020 6669 6c65 7479  sion..    filety
+00020ea0: 7065 3a20 7374 720a 2020 2020 2020 2020  pe: str.        
+00020eb0: 6368 6f6f 7365 2066 726f 6d20 2757 6974  choose from 'Wit
+00020ec0: 6563 5f41 5343 4949 272c 2027 6865 6164  ec_ASCII', 'head
+00020ed0: 6c65 7373 5f74 7874 272c 2027 6865 6164  less_txt', 'head
+00020ee0: 6c65 7373 5f63 7376 272c 2027 6865 6164  less_csv', 'head
+00020ef0: 5f63 7376 272c 2027 5769 7465 635f 4153  _csv', 'Witec_AS
+00020f00: 4349 4927 2c0a 2020 2020 2020 2020 2748  CII',.        'H
+00020f10: 4f52 4942 415f 7478 7427 2c20 2752 656e  ORIBA_txt', 'Ren
+00020f20: 6973 6861 775f 7478 7427 0a0a 0a20 2020  ishaw_txt'...   
+00020f30: 2070 6c6f 745f 6669 6775 7265 3a20 626f   plot_figure: bo
+00020f40: 6f6c 0a20 2020 2020 2020 2049 6620 7472  ol.        If tr
+00020f50: 7565 2c20 706c 6f74 7320 6669 6775 7265  ue, plots figure
+00020f60: 2061 6e64 2073 6176 6573 2069 7420 696e   and saves it in
+00020f70: 2061 2073 7562 666f 6c64 6572 2069 6e20   a subfolder in 
+00020f80: 7468 6520 7361 6d65 2064 6972 6563 746f  the same directo
+00020f90: 7279 2061 7320 7468 6520 6669 6c65 7061  ry as the filepa
+00020fa0: 7468 2073 7065 6369 6669 6564 0a0a 2020  th specified..  
+00020fb0: 2020 6470 693a 2069 6e74 0a20 2020 2020    dpi: int.     
+00020fc0: 2020 2064 7069 2074 6f20 7361 7665 2066     dpi to save f
+00020fd0: 6967 7572 6520 6174 0a0a 2020 2020 5265  igure at..    Re
+00020fe0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00020ff0: 2d2d 2d2d 2d0a 2020 2020 6466 206f 6620  -----.    df of 
+00021000: 7065 616b 2066 6974 732c 2075 6e6c 6573  peak fits, unles
+00021010: 7320 7265 7475 726e 5f6f 7468 6572 5f70  s return_other_p
+00021020: 6172 616d 7320 6973 2054 7275 652c 2074  arams is True, t
+00021030: 6865 6e20 616c 736f 2072 6574 7572 6e73  hen also returns
+00021040: 2078 2061 6e64 2079 2063 6f6f 7264 696e   x and y coordin
+00021050: 6174 6520 6f66 2066 6974 2c20 616e 6420  ate of fit, and 
+00021060: 6669 7420 7061 7261 6d73 0a0a 2020 2020  fit params..    
+00021070: 2222 220a 0a0a 2020 2020 5370 6563 7472  """...    Spectr
+00021080: 615f 696e 3d67 6574 5f64 6174 6128 7061  a_in=get_data(pa
+00021090: 7468 3d70 6174 682c 2066 696c 656e 616d  th=path, filenam
+000210a0: 653d 6669 6c65 6e61 6d65 2c20 6669 6c65  e=filename, file
+000210b0: 7479 7065 3d66 696c 6574 7970 6529 0a0a  type=filetype)..
+000210c0: 2020 2020 696e 745f 6375 745f 6f66 663d      int_cut_off=
+000210d0: 636f 6e66 6967 2e69 6e74 5f63 7574 5f6f  config.int_cut_o
+000210e0: 6666 0a20 2020 206e 616d 653d 636f 6e66  ff.    name=conf
+000210f0: 6967 2e6e 616d 650a 0a20 2020 2023 2049  ig.name..    # I
+00021100: 6620 6578 636c 7564 6520 7261 6e67 652c  f exclude range,
+00021110: 2074 7269 6d20 7468 6174 2068 6572 650a   trim that here.
+00021120: 2020 2020 6966 2063 6f6e 6669 672e 6578      if config.ex
+00021130: 636c 7564 655f 7261 6e67 6520 6973 206e  clude_range is n
+00021140: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00021150: 2020 2020 2053 7065 6374 7261 3d53 7065       Spectra=Spe
+00021160: 6374 7261 5f69 6e5b 2028 5370 6563 7472  ctra_in[ (Spectr
+00021170: 615f 696e 5b3a 2c20 305d 3c63 6f6e 6669  a_in[:, 0]<confi
+00021180: 672e 6578 636c 7564 655f 7261 6e67 655b  g.exclude_range[
+00021190: 305d 2920 7c20 2853 7065 6374 7261 5f69  0]) | (Spectra_i
+000211a0: 6e5b 3a2c 2030 5d3e 636f 6e66 6967 2e65  n[:, 0]>config.e
+000211b0: 7863 6c75 6465 5f72 616e 6765 5b31 5d29  xclude_range[1])
+000211c0: 205d 0a20 2020 2065 6c73 653a 0a20 2020   ].    else:.   
+000211d0: 2020 2020 2053 7065 6374 7261 3d53 7065       Spectra=Spe
+000211e0: 6374 7261 5f69 6e0a 0a0a 0a20 2020 206c  ctra_in....    l
+000211f0: 6f77 6572 5f30 6261 7365 6c69 6e65 3d63  ower_0baseline=c
+00021200: 6f6e 6669 672e 6c6f 7765 725f 6263 6b5b  onfig.lower_bck[
+00021210: 305d 0a20 2020 2075 7070 6572 5f30 6261  0].    upper_0ba
+00021220: 7365 6c69 6e65 3d63 6f6e 6669 672e 6c6f  seline=config.lo
+00021230: 7765 725f 6263 6b5b 315d 0a20 2020 206c  wer_bck[1].    l
+00021240: 6f77 6572 5f31 6261 7365 6c69 6e65 3d63  ower_1baseline=c
+00021250: 6f6e 6669 672e 7570 7065 725f 6263 6b5b  onfig.upper_bck[
+00021260: 305d 0a20 2020 2075 7070 6572 5f31 6261  0].    upper_1ba
+00021270: 7365 6c69 6e65 3d63 6f6e 6669 672e 7570  seline=config.up
+00021280: 7065 725f 6263 6b5b 315d 0a0a 2020 2020  per_bck[1]..    
+00021290: 2320 4669 6c74 6572 206f 7574 2073 7065  # Filter out spe
+000212a0: 6374 7261 206f 7574 7369 6465 2074 6865  ctra outside the
+000212b0: 7365 2062 6173 656c 696e 6573 0a20 2020  se baselines.   
+000212c0: 2053 7065 6374 7261 5f73 686f 7274 3d53   Spectra_short=S
+000212d0: 7065 6374 7261 5b20 2853 7065 6374 7261  pectra[ (Spectra
+000212e0: 5b3a 2c30 5d3e 6c6f 7765 725f 3062 6173  [:,0]>lower_0bas
+000212f0: 656c 696e 6529 2026 2028 5370 6563 7472  eline) & (Spectr
+00021300: 615b 3a2c 305d 3c75 7070 6572 5f31 6261  a[:,0]<upper_1ba
+00021310: 7365 6c69 6e65 2920 5d0a 2020 2020 5370  seline) ].    Sp
+00021320: 6563 7472 615f 6669 743d 5370 6563 7472  ectra_fit=Spectr
+00021330: 615b 2028 5370 6563 7472 615b 3a2c 305d  a[ (Spectra[:,0]
+00021340: 3e75 7070 6572 5f30 6261 7365 6c69 6e65  >upper_0baseline
+00021350: 2920 2620 2853 7065 6374 7261 5b3a 2c30  ) & (Spectra[:,0
+00021360: 5d3c 6c6f 7765 725f 3162 6173 656c 696e  ]<lower_1baselin
+00021370: 6529 205d 0a0a 2020 2020 2320 546f 206d  e) ]..    # To m
+00021380: 616b 6520 6120 6e69 6365 2070 6c6f 742c  ake a nice plot,
+00021390: 2067 6976 6520 3530 2077 6176 656e 756d   give 50 wavenum
+000213a0: 6265 7220 756e 6974 7320 6f6e 2065 6974  ber units on eit
+000213b0: 6865 7220 7369 6465 2061 7320 6120 6275  her side as a bu
+000213c0: 6666 6572 0a20 2020 2053 7065 6374 7261  ffer.    Spectra
+000213d0: 5f70 6c6f 743d 5370 6563 7472 615b 2028  _plot=Spectra[ (
+000213e0: 5370 6563 7472 615b 3a2c 305d 3e6c 6f77  Spectra[:,0]>low
+000213f0: 6572 5f30 6261 7365 6c69 6e65 2d35 3029  er_0baseline-50)
+00021400: 2026 2028 5370 6563 7472 615b 3a2c 305d   & (Spectra[:,0]
+00021410: 3c75 7070 6572 5f31 6261 7365 6c69 6e65  <upper_1baseline
+00021420: 2b35 3029 205d 0a0a 2020 2020 2320 2320  +50) ]..    # # 
+00021430: 4669 6e64 2070 6561 6b73 2075 7369 6e67  Find peaks using
+00021440: 2053 6369 7079 2066 696e 6420 7065 616b   Scipy find peak
+00021450: 730a 2020 2020 793d 5370 6563 7472 615f  s.    y=Spectra_
+00021460: 6669 745b 3a2c 2031 5d0a 2020 2020 783d  fit[:, 1].    x=
+00021470: 5370 6563 7472 615f 6669 745b 3a2c 2030  Spectra_fit[:, 0
+00021480: 5d0a 2020 2020 7370 6563 5f72 6573 3d6e  ].    spec_res=n
+00021490: 702e 6162 7328 785b 305d 2d78 5b31 5d29  p.abs(x[0]-x[1])
+000214a0: 0a20 2020 2023 0a20 2020 2023 0a20 2020  .    #.    #.   
+000214b0: 2023 2070 6561 6b73 203d 2066 696e 645f   # peaks = find_
+000214c0: 7065 616b 7328 792c 6865 6967 6874 203d  peaks(y,height =
+000214d0: 2063 6f6e 6669 672e 6865 6967 6874 2c20   config.height, 
+000214e0: 7468 7265 7368 6f6c 6420 3d20 636f 6e66  threshold = conf
+000214f0: 6967 2e74 6872 6573 686f 6c64 2c0a 2020  ig.threshold,.  
+00021500: 2020 2320 6469 7374 616e 6365 203d 2063    # distance = c
+00021510: 6f6e 6669 672e 6469 7374 616e 6365 2c20  onfig.distance, 
+00021520: 7072 6f6d 696e 656e 6365 3d63 6f6e 6669  prominence=confi
+00021530: 672e 7072 6f6d 696e 656e 6365 2c20 7769  g.prominence, wi
+00021540: 6474 683d 636f 6e66 6967 2e77 6964 7468  dth=config.width
+00021550: 290a 2020 2020 230a 2020 2020 2320 6865  ).    #.    # he
+00021560: 6967 6874 203d 2070 6561 6b73 5b31 5d5b  ight = peaks[1][
+00021570: 2770 6561 6b5f 6865 6967 6874 7327 5d20  'peak_heights'] 
+00021580: 236c 6973 7420 6f66 2074 6865 2068 6569  #list of the hei
+00021590: 6768 7473 206f 6620 7468 6520 7065 616b  ghts of the peak
+000215a0: 730a 2020 2020 2320 7065 616b 5f70 6f73  s.    # peak_pos
+000215b0: 203d 2078 5b70 6561 6b73 5b30 5d5d 2023   = x[peaks[0]] #
+000215c0: 6c69 7374 206f 6620 7468 6520 7065 616b  list of the peak
+000215d0: 7320 706f 7369 7469 6f6e 730a 2020 2020  s positions.    
+000215e0: 2320 6466 5f73 6f72 743d 7064 2e44 6174  # df_sort=pd.Dat
+000215f0: 6146 7261 6d65 2864 6174 613d 7b27 706f  aFrame(data={'po
+00021600: 7327 3a20 7065 616b 5f70 6f73 2c0a 2020  s': peak_pos,.  
+00021610: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00021620: 2020 2020 2020 2020 2768 6569 6768 7427          'height'
+00021630: 3a20 6865 6967 6874 7d29 0a20 2020 2023  : height}).    #
+00021640: 0a20 2020 2023 2064 665f 7065 616b 5f73  .    # df_peak_s
+00021650: 6f72 743d 6466 5f73 6f72 742e 736f 7274  ort=df_sort.sort
+00021660: 5f76 616c 7565 7328 2768 6569 6768 7427  _values('height'
+00021670: 2c20 6178 6973 3d30 2c20 6173 6365 6e64  , axis=0, ascend
+00021680: 696e 673d 4661 6c73 6529 0a20 2020 2023  ing=False).    #
+00021690: 0a20 2020 2023 2023 2054 7269 6d20 6e75  .    # # Trim nu
+000216a0: 6d62 6572 206f 6620 7065 616b 7320 6261  mber of peaks ba
+000216b0: 7365 6420 6f6e 2075 7365 722d 6465 6669  sed on user-defi
+000216c0: 6e65 6420 4e20 7065 616b 730a 2020 2020  ned N peaks.    
+000216d0: 2320 6466 5f70 6561 6b5f 736f 7274 5f73  # df_peak_sort_s
+000216e0: 686f 7274 3d64 665f 7065 616b 5f73 6f72  hort=df_peak_sor
+000216f0: 745b 303a 636f 6e66 6967 2e4e 5f70 6561  t[0:config.N_pea
+00021700: 6b73 5d0a 0a0a 2020 2020 2320 4765 7420  ks]...    # Get 
+00021710: 6163 7475 616c 2062 6173 656c 696e 650a  actual baseline.
+00021720: 2020 2020 4261 7365 6c69 6e65 5f77 6974      Baseline_wit
+00021730: 685f 6f75 746c 3d53 7065 6374 7261 5f73  h_outl=Spectra_s
+00021740: 686f 7274 5b0a 2020 2020 2828 5370 6563  hort[.    ((Spec
+00021750: 7472 615f 7368 6f72 745b 3a2c 2030 5d3c  tra_short[:, 0]<
+00021760: 7570 7065 725f 3062 6173 656c 696e 6529  upper_0baseline)
+00021770: 2026 2853 7065 6374 7261 5f73 686f 7274   &(Spectra_short
+00021780: 5b3a 2c20 305d 3e6c 6f77 6572 5f30 6261  [:, 0]>lower_0ba
+00021790: 7365 6c69 6e65 2929 0a20 2020 2020 2020  seline)).       
+000217a0: 207c 0a20 2020 2028 2853 7065 6374 7261   |.    ((Spectra
+000217b0: 5f73 686f 7274 5b3a 2c20 305d 3c75 7070  _short[:, 0]<upp
+000217c0: 6572 5f31 6261 7365 6c69 6e65 2920 2628  er_1baseline) &(
+000217d0: 5370 6563 7472 615f 7368 6f72 745b 3a2c  Spectra_short[:,
+000217e0: 2030 5d3e 6c6f 7765 725f 3162 6173 656c   0]>lower_1basel
+000217f0: 696e 6529 295d 0a0a 2020 2020 2320 4361  ine))]..    # Ca
+00021800: 6c63 756c 6174 6573 2074 6865 204c 4820  lculates the LH 
+00021810: 6261 7365 6c69 6e65 0a20 2020 204c 485f  baseline.    LH_
+00021820: 6261 7365 6c69 6e65 3d53 7065 6374 7261  baseline=Spectra
+00021830: 5f73 686f 7274 5b0a 2020 2020 2828 5370  _short[.    ((Sp
+00021840: 6563 7472 615f 7368 6f72 745b 3a2c 2030  ectra_short[:, 0
+00021850: 5d3c 7570 7065 725f 3062 6173 656c 696e  ]<upper_0baselin
+00021860: 6529 2026 2853 7065 6374 7261 5f73 686f  e) &(Spectra_sho
+00021870: 7274 5b3a 2c20 305d 3e6c 6f77 6572 5f30  rt[:, 0]>lower_0
+00021880: 6261 7365 6c69 6e65 2929 5d0a 0a20 2020  baseline))]..   
+00021890: 204d 6561 6e5f 4c48 5f62 6173 656c 696e   Mean_LH_baselin
+000218a0: 653d 6e70 2e6e 616e 6d65 616e 284c 485f  e=np.nanmean(LH_
+000218b0: 6261 7365 6c69 6e65 5b3a 2c20 315d 290a  baseline[:, 1]).
+000218c0: 2020 2020 5374 645f 4c48 5f62 6173 656c      Std_LH_basel
+000218d0: 696e 653d 6e70 2e6e 616e 7374 6428 4c48  ine=np.nanstd(LH
+000218e0: 5f62 6173 656c 696e 655b 3a2c 2031 5d29  _baseline[:, 1])
+000218f0: 0a0a 2020 2020 2320 4361 6c63 756c 6174  ..    # Calculat
+00021900: 6573 2074 6865 2052 4820 6261 7365 6c69  es the RH baseli
+00021910: 6e65 0a20 2020 2052 485f 6261 7365 6c69  ne.    RH_baseli
+00021920: 6e65 3d53 7065 6374 7261 5f73 686f 7274  ne=Spectra_short
+00021930: 5b28 2853 7065 6374 7261 5f73 686f 7274  [((Spectra_short
+00021940: 5b3a 2c20 305d 3c75 7070 6572 5f31 6261  [:, 0]<upper_1ba
+00021950: 7365 6c69 6e65 290a 2020 2020 2628 5370  seline).    &(Sp
+00021960: 6563 7472 615f 7368 6f72 745b 3a2c 2030  ectra_short[:, 0
+00021970: 5d3e 6c6f 7765 725f 3162 6173 656c 696e  ]>lower_1baselin
+00021980: 6529 295d 0a20 2020 204d 6561 6e5f 5248  e))].    Mean_RH
+00021990: 5f62 6173 656c 696e 653d 6e70 2e6e 616e  _baseline=np.nan
+000219a0: 6d65 616e 2852 485f 6261 7365 6c69 6e65  mean(RH_baseline
+000219b0: 5b3a 2c20 315d 290a 2020 2020 5374 645f  [:, 1]).    Std_
+000219c0: 5248 5f62 6173 656c 696e 653d 6e70 2e6e  RH_baseline=np.n
+000219d0: 616e 7374 6428 5248 5f62 6173 656c 696e  anstd(RH_baselin
+000219e0: 655b 3a2c 2031 5d29 0a0a 2020 2020 2320  e[:, 1])..    # 
+000219f0: 5265 6d6f 7665 7320 706f 696e 7473 206f  Removes points o
+00021a00: 7574 7369 6465 2062 6173 656c 696e 650a  utside baseline.
+00021a10: 0a20 2020 204c 485f 6261 7365 6c69 6e65  .    LH_baseline
+00021a20: 5f66 696c 743d 4c48 5f62 6173 656c 696e  _filt=LH_baselin
+00021a30: 655b 284c 485f 6261 7365 6c69 6e65 5b3a  e[(LH_baseline[:
+00021a40: 2c20 315d 3c4d 6561 6e5f 4c48 5f62 6173  , 1]<Mean_LH_bas
+00021a50: 656c 696e 652b 636f 6e66 6967 2e6f 7574  eline+config.out
+00021a60: 6c69 6572 5f73 6967 6d61 2a53 7464 5f4c  lier_sigma*Std_L
+00021a70: 485f 6261 7365 6c69 6e65 290a 2020 2020  H_baseline).    
+00021a80: 2628 4c48 5f62 6173 656c 696e 655b 3a2c  &(LH_baseline[:,
+00021a90: 2031 5d3e 4d65 616e 5f4c 485f 6261 7365   1]>Mean_LH_base
+00021aa0: 6c69 6e65 2d63 6f6e 6669 672e 6f75 746c  line-config.outl
+00021ab0: 6965 725f 7369 676d 612a 5374 645f 4c48  ier_sigma*Std_LH
+00021ac0: 5f62 6173 656c 696e 6529 205d 0a0a 2020  _baseline) ]..  
+00021ad0: 2020 5248 5f62 6173 656c 696e 655f 6669    RH_baseline_fi
+00021ae0: 6c74 3d52 485f 6261 7365 6c69 6e65 5b28  lt=RH_baseline[(
+00021af0: 5248 5f62 6173 656c 696e 655b 3a2c 2031  RH_baseline[:, 1
+00021b00: 5d3c 4d65 616e 5f52 485f 6261 7365 6c69  ]<Mean_RH_baseli
+00021b10: 6e65 2b63 6f6e 6669 672e 6f75 746c 6965  ne+config.outlie
+00021b20: 725f 7369 676d 612a 5374 645f 5248 5f62  r_sigma*Std_RH_b
+00021b30: 6173 656c 696e 6529 0a20 2020 2026 2852  aseline).    &(R
+00021b40: 485f 6261 7365 6c69 6e65 5b3a 2c20 315d  H_baseline[:, 1]
+00021b50: 3e4d 6561 6e5f 5248 5f62 6173 656c 696e  >Mean_RH_baselin
+00021b60: 652d 636f 6e66 6967 2e6f 7574 6c69 6572  e-config.outlier
+00021b70: 5f73 6967 6d61 2a53 7464 5f52 485f 6261  _sigma*Std_RH_ba
+00021b80: 7365 6c69 6e65 2920 5d0a 0a20 2020 2042  seline) ]..    B
+00021b90: 6173 656c 696e 653d 6e70 2e63 6f6e 6361  aseline=np.conca
+00021ba0: 7465 6e61 7465 2828 4c48 5f62 6173 656c  tenate((LH_basel
+00021bb0: 696e 655f 6669 6c74 2c20 5248 5f62 6173  ine_filt, RH_bas
+00021bc0: 656c 696e 655f 6669 6c74 292c 2061 7869  eline_filt), axi
+00021bd0: 733d 3029 0a0a 0a0a 0a0a 2020 2020 2320  s=0)......    # 
+00021be0: 4669 7473 2061 2070 6f6c 796e 6f6d 6961  Fits a polynomia
+00021bf0: 6c20 746f 2074 6865 2062 6173 656c 696e  l to the baselin
+00021c00: 6520 6f66 2064 6567 7265 650a 2020 2020  e of degree.    
+00021c10: 5066 5f62 6173 656c 696e 6520 3d20 6e70  Pf_baseline = np
+00021c20: 2e70 6f6c 7931 6428 6e70 2e70 6f6c 7966  .poly1d(np.polyf
+00021c30: 6974 2842 6173 656c 696e 655b 3a2c 2030  it(Baseline[:, 0
+00021c40: 5d2c 2042 6173 656c 696e 655b 3a2c 2031  ], Baseline[:, 1
+00021c50: 5d2c 2063 6f6e 6669 672e 4e5f 706f 6c79  ], config.N_poly
+00021c60: 5f63 6172 625f 6263 6b29 290a 2020 2020  _carb_bck)).    
+00021c70: 5079 5f62 6173 6520 3d50 665f 6261 7365  Py_base =Pf_base
+00021c80: 6c69 6e65 2853 7065 6374 7261 5f73 686f  line(Spectra_sho
+00021c90: 7274 5b3a 2c20 305d 290a 2020 2020 5079  rt[:, 0]).    Py
+00021ca0: 5f62 6173 655f 6669 7420 3d50 665f 6261  _base_fit =Pf_ba
+00021cb0: 7365 6c69 6e65 2853 7065 6374 7261 5f66  seline(Spectra_f
+00021cc0: 6974 5b3a 2c20 305d 290a 0a0a 0a20 2020  it[:, 0])....   
+00021cd0: 2042 6173 656c 696e 655f 7973 7562 3d50   Baseline_ysub=P
+00021ce0: 665f 6261 7365 6c69 6e65 2842 6173 656c  f_baseline(Basel
+00021cf0: 696e 655b 3a2c 2030 5d29 0a20 2020 2042  ine[:, 0]).    B
+00021d00: 6173 656c 696e 655f 783d 4261 7365 6c69  aseline_x=Baseli
+00021d10: 6e65 5b3a 2c20 305d 0a20 2020 2079 5f63  ne[:, 0].    y_c
+00021d20: 6f72 723d 2053 7065 6374 7261 5f73 686f  orr= Spectra_sho
+00021d30: 7274 5b3a 2c20 315d 2d50 795f 6261 7365  rt[:, 1]-Py_base
+00021d40: 0a20 2020 2079 5f63 6f72 725f 6669 743d  .    y_corr_fit=
+00021d50: 5370 6563 7472 615f 6669 745b 3a2c 2031  Spectra_fit[:, 1
+00021d60: 5d2d 5079 5f62 6173 655f 6669 740a 2020  ]-Py_base_fit.  
+00021d70: 2020 785f 6669 743d 5370 6563 7472 615f    x_fit=Spectra_
+00021d80: 6669 745b 3a2c 2030 5d0a 2020 2020 785f  fit[:, 0].    x_
+00021d90: 636f 7272 3d53 7065 6374 7261 5f73 686f  corr=Spectra_sho
+00021da0: 7274 5b3a 2c20 305d 0a0a 0a0a 2020 2020  rt[:, 0]....    
+00021db0: 6966 2063 6f6e 6669 672e 6d6f 6465 6c5f  if config.model_
+00021dc0: 6e61 6d65 206e 6f74 2069 6e20 5b27 4761  name not in ['Ga
+00021dd0: 7573 7369 616e 4d6f 6465 6c27 2c20 2756  ussianModel', 'V
+00021de0: 6f69 6774 4d6f 6465 6c27 2c20 2750 7365  oigtModel', 'Pse
+00021df0: 7564 6f56 6f69 6774 4d6f 6465 6c27 2c20  udoVoigtModel', 
+00021e00: 2753 706c 696e 6527 5d3a 0a20 2020 2020  'Spline']:.     
+00021e10: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+00021e20: 6f72 2827 6d6f 6465 6c5f 6e61 6d65 206e  or('model_name n
+00021e30: 6f74 2061 2070 6572 6d69 7474 6564 2069  ot a permitted i
+00021e40: 6e70 7574 2c20 506c 6561 7365 2073 656c  nput, Please sel
+00021e50: 6563 7420 6569 7468 6572 2047 6175 7373  ect either Gauss
+00021e60: 6961 6e4d 6f64 656c 2c20 566f 6967 744d  ianModel, VoigtM
+00021e70: 6f64 656c 2c20 5073 6575 646f 566f 6967  odel, PseudoVoig
+00021e80: 744d 6f64 656c 2c20 6f72 2053 706c 696e  tModel, or Splin
+00021e90: 6527 290a 0a0a 2020 2020 6966 2063 6f6e  e')...    if con
+00021ea0: 6669 672e 6d6f 6465 6c5f 6e61 6d65 2069  fig.model_name i
+00021eb0: 6e20 5b27 4761 7573 7369 616e 4d6f 6465  n ['GaussianMode
+00021ec0: 6c27 2c20 2756 6f69 6774 4d6f 6465 6c27  l', 'VoigtModel'
+00021ed0: 2c20 2750 7365 7564 6f56 6f69 6774 4d6f  , 'PseudoVoigtMo
+00021ee0: 6465 6c27 5d3a 0a0a 0a20 2020 2020 2020  del']:...       
+00021ef0: 2023 204e 4f77 2069 6e74 6f20 7468 6520   # NOw into the 
+00021f00: 766f 6967 7420 6669 7474 696e 670a 2020  voigt fitting.  
+00021f10: 2020 2020 2020 6966 2063 6f6e 6669 672e        if config.
+00021f20: 6d6f 6465 6c5f 6e61 6d65 3d3d 2756 6f69  model_name=='Voi
+00021f30: 6774 4d6f 6465 6c27 3a0a 2020 2020 2020  gtModel':.      
+00021f40: 2020 2020 2020 6d6f 6465 6c30 203d 2056        model0 = V
+00021f50: 6f69 6774 4d6f 6465 6c28 2923 2b20 436f  oigtModel()#+ Co
+00021f60: 6e73 7461 6e74 4d6f 6465 6c28 290a 2020  nstantModel().  
+00021f70: 2020 2020 2020 6966 2063 6f6e 6669 672e        if config.
+00021f80: 6d6f 6465 6c5f 6e61 6d65 203d 3d20 2750  model_name == 'P
+00021f90: 7365 7564 6f56 6f69 6774 4d6f 6465 6c27  seudoVoigtModel'
+00021fa0: 3a0a 2020 2020 2020 2020 2020 2020 6d6f  :.            mo
+00021fb0: 6465 6c30 203d 2050 7365 7564 6f56 6f69  del0 = PseudoVoi
+00021fc0: 6774 4d6f 6465 6c28 290a 2020 2020 2020  gtModel().      
+00021fd0: 2020 6966 2063 6f6e 6669 672e 6d6f 6465    if config.mode
+00021fe0: 6c5f 6e61 6d65 3d3d 2747 6175 7373 6961  l_name=='Gaussia
+00021ff0: 6e4d 6f64 656c 273a 0a20 2020 2020 2020  nModel':.       
+00022000: 2020 2020 206d 6f64 656c 303d 4761 7573       model0=Gaus
+00022010: 7369 616e 4d6f 6465 6c28 290a 0a20 2020  sianModel()..   
+00022020: 2020 2020 2023 2063 7265 6174 6520 7061       # create pa
+00022030: 7261 6d65 7465 7273 2077 6974 6820 696e  rameters with in
+00022040: 6974 6961 6c20 7661 6c75 6573 0a20 2020  itial values.   
+00022050: 2020 2020 2070 6172 7330 203d 206d 6f64       pars0 = mod
+00022060: 656c 302e 6d61 6b65 5f70 6172 616d 7328  el0.make_params(
+00022070: 290a 2020 2020 2020 2020 7061 7273 305b  ).        pars0[
+00022080: 2763 656e 7465 7227 5d2e 7365 7428 636f  'center'].set(co
+00022090: 6e66 6967 2e63 656e 742c 206d 696e 3d63  nfig.cent, min=c
+000220a0: 6f6e 6669 672e 6365 6e74 2d33 302c 206d  onfig.cent-30, m
+000220b0: 6178 3d63 6f6e 6669 672e 6365 6e74 2b33  ax=config.cent+3
+000220c0: 3029 0a20 2020 2020 2020 2070 6172 7330  0).        pars0
+000220d0: 5b27 616d 706c 6974 7564 6527 5d2e 7365  ['amplitude'].se
+000220e0: 7428 636f 6e66 6967 2e61 6d70 6c69 7475  t(config.amplitu
+000220f0: 6465 2c20 6d69 6e3d 3029 0a0a 0a20 2020  de, min=0)...   
+00022100: 2020 2020 2069 6e69 7430 203d 206d 6f64       init0 = mod
+00022110: 656c 302e 6576 616c 2870 6172 7330 2c20  el0.eval(pars0, 
+00022120: 783d 7829 0a20 2020 2020 2020 2072 6573  x=x).        res
+00022130: 756c 7430 203d 206d 6f64 656c 302e 6669  ult0 = model0.fi
+00022140: 7428 795f 636f 7272 5f66 6974 2c20 7061  t(y_corr_fit, pa
+00022150: 7273 302c 2078 3d78 290a 2020 2020 2020  rs0, x=x).      
+00022160: 2020 4365 6e74 6572 5f70 303d 7265 7375    Center_p0=resu
+00022170: 6c74 302e 6265 7374 5f76 616c 7565 732e  lt0.best_values.
+00022180: 6765 7428 2763 656e 7465 7227 290a 2020  get('center').  
+00022190: 2020 2020 2020 6172 6561 5f70 303d 7265        area_p0=re
+000221a0: 7375 6c74 302e 6265 7374 5f76 616c 7565  sult0.best_value
+000221b0: 732e 6765 7428 2761 6d70 6c69 7475 6465  s.get('amplitude
+000221c0: 2729 0a0a 0a0a 2020 2020 2020 2020 2320  ')....        # 
+000221d0: 4d61 6b65 2061 206e 6963 6520 6c69 6e73  Make a nice lins
+000221e0: 7061 6365 2066 6f72 2070 6c6f 7474 696e  pace for plottin
+000221f0: 6720 7769 7468 2073 6d6f 6f74 6820 6375  g with smooth cu
+00022200: 7276 6573 2e0a 2020 2020 2020 2020 7878  rves..        xx
+00022210: 5f63 6172 623d 6e70 2e6c 696e 7370 6163  _carb=np.linspac
+00022220: 6528 6d69 6e28 7829 2c20 6d61 7828 7829  e(min(x), max(x)
+00022230: 2c20 3230 3030 290a 2020 2020 2020 2020  , 2000).        
+00022240: 795f 6361 7262 3d72 6573 756c 7430 2e65  y_carb=result0.e
+00022250: 7661 6c28 783d 7878 5f63 6172 6229 0a20  val(x=xx_carb). 
+00022260: 2020 2020 2020 2068 6569 6768 743d 6e70         height=np
+00022270: 2e6d 6178 2879 5f63 6172 6229 0a0a 2020  .max(y_carb)..  
+00022280: 2020 2020 2020 2320 4d6f 7665 6420 7468        # Moved th
+00022290: 6973 2066 6f72 6d20 646f 776e 2062 656c  is form down bel
+000222a0: 6f77 2c20 7468 696e 6b20 6974 2062 656c  ow, think it bel
+000222b0: 6f6e 6773 2068 6572 650a 2020 2020 2020  ongs here.      
+000222c0: 2020 6966 2061 7265 615f 7030 2069 7320    if area_p0 is 
+000222d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000222e0: 2020 6172 6561 5f70 303d 6e70 2e6e 616e    area_p0=np.nan
+000222f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00022300: 6172 6561 5f70 3020 6973 206e 6f74 204e  area_p0 is not N
+00022310: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00022320: 2020 2020 2069 6620 6172 6561 5f70 303c       if area_p0<
+00022330: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00022340: 2020 2020 2020 2061 7265 615f 7030 3d6e         area_p0=n
+00022350: 702e 6e61 6e0a 0a0a 2020 2020 2020 2020  p.nan...        
+00022360: 6466 3d70 642e 4461 7461 4672 616d 6528  df=pd.DataFrame(
+00022370: 6461 7461 3d7b 2766 696c 656e 616d 6527  data={'filename'
+00022380: 3a20 6669 6c65 6e61 6d65 2c0a 2020 2020  : filename,.    
+00022390: 2750 6561 6b5f 4365 6e74 5f7b 7d27 2e66  'Peak_Cent_{}'.f
+000223a0: 6f72 6d61 7428 6e61 6d65 293a 2043 656e  ormat(name): Cen
+000223b0: 7465 725f 7030 2c0a 2020 2020 2750 6561  ter_p0,.    'Pea
+000223c0: 6b5f 4172 6561 5f7b 7d27 2e66 6f72 6d61  k_Area_{}'.forma
+000223d0: 7428 6e61 6d65 293a 2061 7265 615f 7030  t(name): area_p0
+000223e0: 2c0a 2020 2020 2750 6561 6b5f 4865 6967  ,.    'Peak_Heig
+000223f0: 6874 5f7b 7d27 2e66 6f72 6d61 7428 6e61  ht_{}'.format(na
+00022400: 6d65 293a 2068 6569 6768 742c 0a20 2020  me): height,.   
+00022410: 2027 4d6f 6465 6c5f 6e61 6d65 273a 2063   'Model_name': c
+00022420: 6f6e 6669 672e 6d6f 6465 6c5f 6e61 6d65  onfig.model_name
+00022430: 7d2c 2069 6e64 6578 3d5b 305d 290a 0a20  }, index=[0]).. 
+00022440: 2020 2065 6c73 653a 0a0a 2020 2020 2020     else:..      
+00022450: 2020 6966 2020 636f 6e66 6967 2e6d 6f64    if  config.mod
+00022460: 656c 5f6e 616d 6520 3d3d 2027 5370 6c69  el_name == 'Spli
+00022470: 6e65 273a 0a20 2020 2020 2020 2020 2020  ne':.           
+00022480: 2066 726f 6d20 7363 6970 792e 696e 7465   from scipy.inte
+00022490: 7270 6f6c 6174 6520 696d 706f 7274 2043  rpolate import C
+000224a0: 7562 6963 5370 6c69 6e65 0a20 2020 2020  ubicSpline.     
+000224b0: 2020 2020 2020 2023 2066 6974 2061 2073         # fit a s
+000224c0: 706c 696e 6520 6669 7273 7420 746f 2066  pline first to f
+000224d0: 696e 6420 696e 7465 6e73 6974 7920 6375  ind intensity cu
+000224e0: 7420 6f66 660a 2020 2020 2020 2020 2020  t off.          
+000224f0: 2020 6d69 785f 7370 6c69 6e65 5f73 696c    mix_spline_sil
+00022500: 203d 2069 6e74 6572 7031 6428 785f 6669   = interp1d(x_fi
+00022510: 742c 2079 5f63 6f72 725f 6669 742c 0a20  t, y_corr_fit,. 
+00022520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022540: 2020 206b 696e 643d 2763 7562 6963 2729     kind='cubic')
+00022550: 0a0a 0a20 2020 2020 2020 2020 2020 2078  ...            x
+00022560: 5f6e 6577 3d6e 702e 6c69 6e73 7061 6365  _new=np.linspace
+00022570: 286e 702e 6d69 6e28 785f 6669 7429 2c20  (np.min(x_fit), 
+00022580: 6e70 2e6d 6178 2878 5f66 6974 292c 2031  np.max(x_fit), 1
+00022590: 3030 3029 0a20 2020 2020 2020 2020 2020  000).           
+000225a0: 2042 6173 656c 696e 655f 7973 7562 5f73   Baseline_ysub_s
+000225b0: 696c 3d6d 6978 5f73 706c 696e 655f 7369  il=mix_spline_si
+000225c0: 6c28 785f 6e65 7729 0a0a 2020 2020 2020  l(x_new)..      
+000225d0: 2020 2020 2020 785f 6d61 7820 3d20 785f        x_max = x_
+000225e0: 6e65 775b 6e70 2e61 7267 6d61 7828 4261  new[np.argmax(Ba
+000225f0: 7365 6c69 6e65 5f79 7375 625f 7369 6c29  seline_ysub_sil)
+00022600: 5d0a 2020 2020 2020 2020 2020 2020 6365  ].            ce
+00022610: 6e74 3d78 5f6d 6178 0a20 2020 2020 2020  nt=x_max.       
+00022620: 2020 2020 2050 6561 6b5f 4365 6e74 6572       Peak_Center
+00022630: 3d78 5f6d 6178 0a0a 2020 2020 2020 2020  =x_max..        
+00022640: 2020 2020 6d61 785f 793d 6e70 2e6d 6178      max_y=np.max
+00022650: 2879 5f63 6f72 725f 6669 7429 0a0a 2020  (y_corr_fit)..  
+00022660: 2020 2020 2020 2020 2020 2320 4c65 7473            # Lets
+00022670: 2074 7269 6d20 7820 616e 6420 7920 6261   trim x and y ba
+00022680: 7365 6420 6f6e 2069 6e74 656e 7369 7479  sed on intensity
+00022690: 2076 616c 7565 730a 2020 2020 2020 2020   values.        
+000226a0: 2320 4669 6e64 2069 6e74 656e 7369 7479  # Find intensity
+000226b0: 2063 7574 206f 6666 0a0a 2020 2020 2020   cut off..      
+000226c0: 2020 2020 2020 795f 696e 745f 6375 743d        y_int_cut=
+000226d0: 6d61 785f 792a 696e 745f 6375 745f 6f66  max_y*int_cut_of
+000226e0: 660a 0a20 2020 2020 2020 2020 2020 2023  f..            #
+000226f0: 2043 6865 636b 2070 6561 6b20 6973 6e74   Check peak isnt
+00022700: 2061 7420 6564 6765 206f 6620 7769 6e64   at edge of wind
+00022710: 6f77 2c20 656c 7365 2077 6f6e 7420 776f  ow, else wont wo
+00022720: 726b 0a0a 2020 2020 2020 2020 2020 2020  rk..            
+00022730: 6966 2050 6561 6b5f 4365 6e74 6572 3d3d  if Peak_Center==
+00022740: 6e70 2e6d 6178 2878 5f66 6974 2920 6f72  np.max(x_fit) or
+00022750: 2050 6561 6b5f 4365 6e74 6572 3d3d 6e70   Peak_Center==np
+00022760: 2e6d 696e 2878 5f66 6974 293a 0a20 2020  .min(x_fit):.   
+00022770: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00022780: 6e74 2827 7065 616b 2061 7420 6564 6765  nt('peak at edge
+00022790: 206f 6620 7769 6e64 6f77 2c20 7365 7474   of window, sett
+000227a0: 696e 6720 7061 7261 6d73 2074 6f20 6e61  ing params to na
+000227b0: 6e73 2729 0a0a 0a0a 2020 2020 2020 2020  ns')....        
+000227c0: 2020 2020 2020 2020 6466 3d70 642e 4461          df=pd.Da
+000227d0: 7461 4672 616d 6528 6461 7461 3d7b 2766  taFrame(data={'f
+000227e0: 696c 656e 616d 6527 3a20 6669 6c65 6e61  ilename': filena
+000227f0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00022800: 2750 6561 6b5f 4365 6e74 5f7b 7d27 2e66  'Peak_Cent_{}'.f
+00022810: 6f72 6d61 7428 6e61 6d65 293a 206e 702e  ormat(name): np.
+00022820: 6e61 6e2c 0a20 2020 2020 2020 2020 2020  nan,.           
+00022830: 2027 5065 616b 5f41 7265 615f 7b7d 272e   'Peak_Area_{}'.
+00022840: 666f 726d 6174 286e 616d 6529 3a20 6e70  format(name): np
+00022850: 2e6e 616e 2c0a 2020 2020 2020 2020 2020  .nan,.          
+00022860: 2020 2750 6561 6b5f 4865 6967 6874 5f7b    'Peak_Height_{
+00022870: 7d27 2e66 6f72 6d61 7428 6e61 6d65 293a  }'.format(name):
+00022880: 206e 702e 6e61 6e2c 0a20 2020 2020 2020   np.nan,.       
+00022890: 2020 2020 2027 4d6f 6465 6c5f 6e61 6d65       'Model_name
+000228a0: 273a 2063 6f6e 6669 672e 6d6f 6465 6c5f  ': config.model_
+000228b0: 6e61 6d65 7d2c 2069 6e64 6578 3d5b 305d  name}, index=[0]
+000228c0: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
+000228d0: 6c73 653a 0a0a 0a0a 2020 2020 2020 2020  lse:....        
+000228e0: 2020 2020 2320 5370 6c69 7420 7468 6520      # Split the 
+000228f0: 6172 7261 7920 696e 746f 2061 204c 4853  array into a LHS
+00022900: 2061 6e64 2061 2052 4853 0a0a 2020 2020   and a RHS..    
+00022910: 2020 2020 2020 2020 2020 2020 4c48 535f              LHS_
+00022920: 793d 4261 7365 6c69 6e65 5f79 7375 625f  y=Baseline_ysub_
+00022930: 7369 6c5b 785f 6e65 773c 5065 616b 5f43  sil[x_new<Peak_C
+00022940: 656e 7465 725d 2023 2057 6173 206f 7269  enter] # Was ori
+00022950: 6769 6e61 6c6c 7920 3c3d 0a20 2020 2020  ginally <=.     
+00022960: 2020 2020 2020 2020 2020 2052 4853 5f79             RHS_y
+00022970: 3d42 6173 656c 696e 655f 7973 7562 5f73  =Baseline_ysub_s
+00022980: 696c 5b78 5f6e 6577 3e50 6561 6b5f 4365  il[x_new>Peak_Ce
+00022990: 6e74 6572 5d0a 0a20 2020 2020 2020 2020  nter]..         
+000229a0: 2020 2020 2020 204c 4853 5f78 3d78 5f6e         LHS_x=x_n
+000229b0: 6577 5b78 5f6e 6577 3c50 6561 6b5f 4365  ew[x_new<Peak_Ce
+000229c0: 6e74 6572 5d20 2320 5761 7320 6f72 6967  nter] # Was orig
+000229d0: 696e 616c 6c79 203c 3d0a 2020 2020 2020  inally <=.      
+000229e0: 2020 2020 2020 2020 2020 5248 535f 783d            RHS_x=
+000229f0: 785f 6e65 775b 785f 6e65 773e 5065 616b  x_new[x_new>Peak
+00022a00: 5f43 656e 7465 725d 0a0a 2020 2020 2020  _Center]..      
+00022a10: 2020 2020 2020 2020 2020 2320 4e65 6564            # Need
+00022a20: 2074 6f20 666c 6970 204c 4853 2074 6f20   to flip LHS to 
+00022a30: 7075 7420 696e 746f 2074 6865 2066 696e  put into the fin
+00022a40: 6420 636c 6f73 6573 7420 6675 6e63 7469  d closest functi
+00022a50: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+00022a60: 2020 204c 4853 5f79 5f66 6c69 703d 6e70     LHS_y_flip=np
+00022a70: 2e66 6c69 7028 4c48 535f 7929 0a20 2020  .flip(LHS_y).   
+00022a80: 2020 2020 2020 2020 2020 2020 204c 4853               LHS
+00022a90: 5f78 5f66 6c69 703d 6e70 2e66 6c69 7028  _x_flip=np.flip(
+00022aa0: 4c48 535f 7829 0a0a 0a0a 0a20 2020 2020  LHS_x).....     
+00022ab0: 2020 2020 2020 2020 2020 2076 616c 3d6e             val=n
+00022ac0: 702e 6172 676d 6178 284c 4853 5f79 5f66  p.argmax(LHS_y_f
+00022ad0: 6c69 703c 795f 696e 745f 6375 7429 0a20  lip<y_int_cut). 
+00022ae0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00022af0: 6620 7661 6c20 3d3d 2030 2061 6e64 206e  f val == 0 and n
+00022b00: 6f74 2028 4c48 535f 795f 666c 6970 5b30  ot (LHS_y_flip[0
+00022b10: 5d20 3c20 795f 696e 745f 6375 7429 3a0a  ] < y_int_cut):.
+00022b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b30: 2020 2020 7661 6c20 3d20 6e70 2e61 7267      val = np.arg
+00022b40: 6d69 6e28 4c48 535f 795f 666c 6970 290a  min(LHS_y_flip).
+00022b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022b60: 2076 616c 323d 6e70 2e61 7267 6d61 7828   val2=np.argmax(
+00022b70: 5248 535f 793c 795f 696e 745f 6375 7429  RHS_y<y_int_cut)
+00022b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022b90: 2069 6620 7661 6c32 203d 3d20 3020 616e   if val2 == 0 an
+00022ba0: 6420 6e6f 7420 2852 4853 5f79 5b30 5d20  d not (RHS_y[0] 
+00022bb0: 3c20 795f 696e 745f 6375 7429 3a0a 2020  < y_int_cut):.  
+00022bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022bd0: 2020 7661 6c32 203d 206e 702e 6172 676d    val2 = np.argm
+00022be0: 696e 2852 4853 5f79 290a 0a0a 0a20 2020  in(RHS_y)....   
+00022bf0: 2020 2020 2020 2020 2020 2020 2023 2046               # F
+00022c00: 696e 6420 6e65 6172 6573 7420 7820 756e  ind nearest x un
+00022c10: 6974 2074 6f20 7468 6973 2076 616c 7565  it to this value
+00022c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022c30: 2079 5f6e 6561 7265 7374 5f4c 4853 3d4c   y_nearest_LHS=L
+00022c40: 4853 5f79 5f66 6c69 705b 7661 6c5d 0a20  HS_y_flip[val]. 
+00022c50: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+00022c60: 5f6e 6561 7265 7374 5f4c 4853 3d4c 4853  _nearest_LHS=LHS
+00022c70: 5f78 5f66 6c69 705b 7661 6c5d 0a0a 2020  _x_flip[val]..  
+00022c80: 2020 2020 2020 2020 2020 2020 2020 795f                y_
+00022c90: 6e65 6172 6573 745f 5248 533d 5248 535f  nearest_RHS=RHS_
+00022ca0: 795b 7661 6c32 5d0a 2020 2020 2020 2020  y[val2].        
+00022cb0: 2020 2020 2020 2020 785f 6e65 6172 6573          x_neares
+00022cc0: 745f 5248 533d 5248 535f 785b 7661 6c32  t_RHS=RHS_x[val2
+00022cd0: 5d0a 0a0a 0a0a 2020 2020 2020 2020 2020  ].....          
+00022ce0: 2020 2020 2020 6469 6666 5f4c 4853 3d50        diff_LHS=P
+00022cf0: 6561 6b5f 4365 6e74 6572 2d78 5f6e 6561  eak_Center-x_nea
+00022d00: 7265 7374 5f4c 4853 0a20 2020 2020 2020  rest_LHS.       
+00022d10: 2020 2020 2020 2020 2064 6966 665f 5248           diff_RH
+00022d20: 533d 785f 6e65 6172 6573 745f 5248 532d  S=x_nearest_RHS-
+00022d30: 5065 616b 5f43 656e 7465 720a 0a0a 0a20  Peak_Center.... 
+00022d40: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00022d50: 5f72 6573 3d30 0a0a 0a20 2020 2020 2020  _res=0...       
+00022d60: 2020 2020 2020 2020 2078 5f6e 6577 5f73           x_new_s
+00022d70: 6b65 776e 6573 733d 6e70 2e6c 696e 7370  kewness=np.linsp
+00022d80: 6163 6528 785f 6e65 6172 6573 745f 4c48  ace(x_nearest_LH
+00022d90: 532d 7370 6563 5f72 6573 2a6e 5f72 6573  S-spec_res*n_res
+00022da0: 2c20 785f 6e65 6172 6573 745f 5248 532b  , x_nearest_RHS+
+00022db0: 7370 6563 5f72 6573 2a6e 5f72 6573 290a  spec_res*n_res).
+00022dc0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00022dd0: 2020 785f 6e65 773d 785f 6e65 775f 736b    x_new=x_new_sk
+00022de0: 6577 6e65 7373 0a0a 0a20 2020 2020 2020  ewness...       
+00022df0: 2020 2020 2020 2020 2042 6173 656c 696e           Baselin
+00022e00: 655f 7973 7562 5f73 696c 3d6d 6978 5f73  e_ysub_sil=mix_s
+00022e10: 706c 696e 655f 7369 6c28 785f 6e65 775f  pline_sil(x_new_
+00022e20: 736b 6577 6e65 7373 290a 0a0a 0a0a 0a0a  skewness).......
+00022e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022e40: 4e5f 706f 6c79 5f73 696c 3d27 5370 6c69  N_poly_sil='Spli
+00022e50: 6e65 270a 0a0a 2020 2020 2020 2020 2020  ne'...          
+00022e60: 2020 2020 2020 7873 7061 6365 5f73 696c        xspace_sil
+00022e70: 3d78 5f6e 6577 5b31 5d2d 785f 6e65 775b  =x_new[1]-x_new[
+00022e80: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+00022e90: 2020 2061 7265 615f 7472 6170 203d 2074     area_trap = t
+00022ea0: 7261 707a 2842 6173 656c 696e 655f 7973  rapz(Baseline_ys
+00022eb0: 7562 5f73 696c 2c20 6478 3d78 7370 6163  ub_sil, dx=xspac
+00022ec0: 655f 7369 6c29 0a20 2020 2020 2020 2020  e_sil).         
+00022ed0: 2020 2020 2020 2061 7265 615f 7369 6d70         area_simp
+00022ee0: 7320 3d20 7369 6d70 7328 4261 7365 6c69  s = simps(Baseli
+00022ef0: 6e65 5f79 7375 625f 7369 6c2c 2064 783d  ne_ysub_sil, dx=
+00022f00: 7873 7061 6365 5f73 696c 290a 0a0a 0a20  xspace_sil).... 
+00022f10: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00022f20: 7265 615f 7030 3d61 7265 615f 7472 6170  rea_p0=area_trap
+00022f30: 0a0a 0a0a 0a20 2020 2020 2020 2020 2020  .....           
+00022f40: 2020 2020 2064 663d 7064 2e44 6174 6146       df=pd.DataF
+00022f50: 7261 6d65 2864 6174 613d 7b27 6669 6c65  rame(data={'file
+00022f60: 6e61 6d65 273a 2066 696c 656e 616d 652c  name': filename,
+00022f70: 0a20 2020 2020 2020 2020 2020 2027 5065  .            'Pe
+00022f80: 616b 5f43 656e 745f 7b7d 272e 666f 726d  ak_Cent_{}'.form
+00022f90: 6174 286e 616d 6529 3a20 785f 6d61 782c  at(name): x_max,
+00022fa0: 0a20 2020 2020 2020 2020 2020 2027 5065  .            'Pe
+00022fb0: 616b 5f41 7265 615f 7b7d 272e 666f 726d  ak_Area_{}'.form
+00022fc0: 6174 286e 616d 6529 3a20 6172 6561 5f70  at(name): area_p
+00022fd0: 302c 0a20 2020 2020 2020 2020 2020 2027  0,.            '
+00022fe0: 5065 616b 5f48 6569 6768 745f 7b7d 272e  Peak_Height_{}'.
+00022ff0: 666f 726d 6174 286e 616d 6529 3a20 6d61  format(name): ma
+00023000: 785f 792c 0a20 2020 2020 2020 2020 2020  x_y,.           
+00023010: 2027 4d6f 6465 6c5f 6e61 6d65 273a 2063   'Model_name': c
+00023020: 6f6e 6669 672e 6d6f 6465 6c5f 6e61 6d65  onfig.model_name
+00023030: 7d2c 2069 6e64 6578 3d5b 305d 290a 0a0a  }, index=[0])...
+00023040: 0a0a 0a0a 2020 2020 2320 506c 6f74 7469  ....    # Plotti
+00023050: 6e67 2077 6861 7420 6974 7320 646f 696e  ng what its doin
+00023060: 670a 0a20 2020 2069 6620 706c 6f74 5f66  g..    if plot_f
+00023070: 6967 7572 6520 6973 2054 7275 653a 0a20  igure is True:. 
+00023080: 2020 2020 2020 2066 6967 2c20 2861 7831         fig, (ax1
+00023090: 2c20 6178 3229 203d 2070 6c74 2e73 7562  , ax2) = plt.sub
+000230a0: 706c 6f74 7328 312c 2032 2c20 6669 6773  plots(1, 2, figs
+000230b0: 697a 653d 2831 302c 3529 290a 2020 2020  ize=(10,5)).    
+000230c0: 2020 2020 6669 672e 7375 7074 6974 6c65      fig.suptitle
+000230d0: 2827 5365 636f 6e64 6172 7920 5068 6173  ('Secondary Phas
+000230e0: 652c 2066 696c 653d 2027 2b20 7374 7228  e, file= '+ str(
+000230f0: 6669 6c65 6e61 6d65 292c 2066 6f6e 7473  filename), fonts
+00023100: 697a 653d 3132 2c20 783d 302e 352c 2079  ize=12, x=0.5, y
+00023110: 3d31 2e30 290a 0a20 2020 2020 2020 2023  =1.0)..        #
+00023120: 2050 6c6f 7420 7468 6520 7065 616b 2070   Plot the peak p
+00023130: 6f73 6974 696f 6e73 2061 6e64 2068 6569  ositions and hei
+00023140: 6768 7473 0a0a 0a0a 2020 2020 2020 2020  ghts....        
+00023150: 6178 312e 7365 745f 7469 746c 6528 2742  ax1.set_title('B
+00023160: 6163 6b67 726f 756e 6420 6669 7427 290a  ackground fit').
+00023170: 0a20 2020 2020 2020 2061 7831 2e70 6c6f  .        ax1.plo
+00023180: 7428 5370 6563 7472 615f 706c 6f74 5b3a  t(Spectra_plot[:
+00023190: 2c20 305d 2c20 5370 6563 7472 615f 706c  , 0], Spectra_pl
+000231a0: 6f74 5b3a 2c20 315d 2c20 272d 7227 2c20  ot[:, 1], '-r', 
+000231b0: 6c61 6265 6c3d 2753 7065 6374 7261 2729  label='Spectra')
+000231c0: 0a20 2020 2020 2020 2061 7831 2e70 6c6f  .        ax1.plo
+000231d0: 7428 5248 5f62 6173 656c 696e 655f 6669  t(RH_baseline_fi
+000231e0: 6c74 5b3a 2c20 305d 2c20 5248 5f62 6173  lt[:, 0], RH_bas
+000231f0: 656c 696e 655f 6669 6c74 5b3a 2c20 315d  eline_filt[:, 1]
+00023200: 2c20 272e 6227 2c0a 2020 2020 2020 2020  , '.b',.        
+00023210: 6c61 6265 6c3d 2762 636b 2070 6f69 6e74  label='bck point
+00023220: 7327 290a 2020 2020 2020 2020 6178 312e  s').        ax1.
+00023230: 706c 6f74 284c 485f 6261 7365 6c69 6e65  plot(LH_baseline
+00023240: 5f66 696c 745b 3a2c 2030 5d2c 204c 485f  _filt[:, 0], LH_
+00023250: 6261 7365 6c69 6e65 5f66 696c 745b 3a2c  baseline_filt[:,
+00023260: 2031 5d2c 2027 2d62 272c 0a20 2020 2020   1], '-b',.     
+00023270: 2020 206c 773d 332c 206c 6162 656c 3d27     lw=3, label='
+00023280: 5f62 636b 2070 6f69 6e74 7327 290a 0a20  _bck points').. 
+00023290: 2020 2020 2020 2023 6178 322e 706c 6f74         #ax2.plot
+000232a0: 2878 2c20 795f 636f 7272 5f66 6974 2c20  (x, y_corr_fit, 
+000232b0: 272d 7227 2c20 6c61 6265 6c3d 2742 636b  '-r', label='Bck
+000232c0: 2d73 7562 2064 6174 6127 2c20 6c77 3d30  -sub data', lw=0
+000232d0: 2e35 290a 2020 2020 2020 2020 6178 322e  .5).        ax2.
+000232e0: 706c 6f74 2878 2c20 795f 636f 7272 5f66  plot(x, y_corr_f
+000232f0: 6974 2c20 272e 7227 2c20 6c61 6265 6c3d  it, '.r', label=
+00023300: 2742 636b 2d73 7562 2064 6174 6127 290a  'Bck-sub data').
+00023310: 2020 2020 2020 2020 6178 312e 706c 6f74          ax1.plot
+00023320: 2853 7065 6374 7261 5f73 686f 7274 5b3a  (Spectra_short[:
+00023330: 2c20 305d 2c20 5079 5f62 6173 652c 2027  , 0], Py_base, '
+00023340: 2d6b 272c 206c 6162 656c 3d27 4263 6b20  -k', label='Bck 
+00023350: 506f 6c79 2729 0a0a 0a20 2020 2020 2020  Poly')...       
+00023360: 2069 6620 636f 6e66 6967 2e6d 6f64 656c   if config.model
+00023370: 5f6e 616d 6520 213d 2027 5370 6c69 6e65  _name != 'Spline
+00023380: 2720 616e 6420 636f 6e66 6967 2e6d 6f64  ' and config.mod
+00023390: 656c 5f6e 616d 6520 213d 2027 506f 6c79  el_name != 'Poly
+000233a0: 273a 0a20 2020 2020 2020 2020 2020 2061  ':.            a
+000233b0: 7832 2e70 6c6f 7428 7878 5f63 6172 622c  x2.plot(xx_carb,
+000233c0: 2079 5f63 6172 622c 2027 2d6b 272c 206c   y_carb, '-k', l
+000233d0: 6162 656c 3d27 5065 616b 2066 6974 2729  abel='Peak fit')
+000233e0: 0a0a 0a20 2020 2020 2020 2065 6c73 653a  ...        else:
+000233f0: 0a20 2020 2020 2020 2020 2020 2061 7832  .            ax2
+00023400: 2e70 6c6f 7428 785f 6e65 772c 2042 6173  .plot(x_new, Bas
+00023410: 656c 696e 655f 7973 7562 5f73 696c 2c20  eline_ysub_sil, 
+00023420: 272d 6b27 290a 2020 2020 2020 2020 2020  '-k').          
+00023430: 2020 6178 322e 6669 6c6c 5f62 6574 7765    ax2.fill_betwe
+00023440: 656e 2878 5f6e 6577 2c20 4261 7365 6c69  en(x_new, Baseli
+00023450: 6e65 5f79 7375 625f 7369 6c2c 2063 6f6c  ne_ysub_sil, col
+00023460: 6f72 3d27 7965 6c6c 6f77 272c 206c 6162  or='yellow', lab
+00023470: 656c 3d27 6669 7420 6172 6561 272c 2061  el='fit area', a
+00023480: 6c70 6861 3d30 2e35 290a 0a0a 2020 2020  lpha=0.5)...    
+00023490: 2020 2020 6365 6e74 3d64 665b 2750 6561      cent=df['Pea
+000234a0: 6b5f 4365 6e74 5f7b 7d27 2e66 6f72 6d61  k_Cent_{}'.forma
+000234b0: 7428 6e61 6d65 295d 2e69 6c6f 635b 305d  t(name)].iloc[0]
+000234c0: 0a20 2020 2020 2020 2061 7832 2e73 6574  .        ax2.set
+000234d0: 5f78 6c69 6d28 5b63 656e 742d 636f 6e66  _xlim([cent-conf
+000234e0: 6967 2e78 5f72 616e 6765 5f62 636b 2c20  ig.x_range_bck, 
+000234f0: 6365 6e74 2b63 6f6e 6669 672e 785f 7261  cent+config.x_ra
+00023500: 6e67 655f 6263 6b5d 290a 0a20 2020 2020  nge_bck])..     
+00023510: 2020 2061 7832 2e73 6574 5f74 6974 6c65     ax2.set_title
+00023520: 2827 426b 672d 7375 6274 7261 6374 6564  ('Bkg-subtracted
+00023530: 2c20 2720 2b20 6e61 6d65 202b 2027 2070  , ' + name + ' p
+00023540: 6561 6b20 6669 7427 290a 0a0a 2020 2020  eak fit')...    
+00023550: 2020 2020 6178 312e 7365 745f 796c 6162      ax1.set_ylab
+00023560: 656c 2827 496e 7465 6e73 6974 7927 290a  el('Intensity').
+00023570: 2020 2020 2020 2020 6178 312e 7365 745f          ax1.set_
+00023580: 786c 6162 656c 2827 5761 7665 6e75 6d62  xlabel('Wavenumb
+00023590: 6572 2028 636d 245e 7b2d 317d 2429 2729  er (cm$^{-1}$)')
+000235a0: 0a20 2020 2020 2020 2061 7832 2e73 6574  .        ax2.set
+000235b0: 5f79 6c61 6265 6c28 2742 636b 2d63 6f72  _ylabel('Bck-cor
+000235c0: 7265 6374 6564 2049 6e74 656e 7369 7479  rected Intensity
+000235d0: 2729 0a20 2020 2020 2020 2061 7832 2e73  ').        ax2.s
+000235e0: 6574 5f78 6c61 6265 6c28 2757 6176 656e  et_xlabel('Waven
+000235f0: 756d 6265 7220 2863 6d24 5e7b 2d31 7d24  umber (cm$^{-1}$
+00023600: 2927 290a 0a20 2020 2020 2020 2061 7831  )')..        ax1
+00023610: 2e6c 6567 656e 6428 290a 2020 2020 2020  .legend().      
+00023620: 2020 6178 322e 6c65 6765 6e64 2829 0a0a    ax2.legend()..
+00023630: 2020 2020 2020 2020 6178 312e 7365 745f          ax1.set_
+00023640: 796c 696d 285b 0a20 2020 2020 2020 206e  ylim([.        n
+00023650: 702e 6d69 6e28 5370 6563 7472 615f 706c  p.min(Spectra_pl
+00023660: 6f74 5b3a 2c20 315d 292d 3530 2c0a 2020  ot[:, 1])-50,.  
+00023670: 2020 2020 2020 6e70 2e6d 6178 2853 7065        np.max(Spe
+00023680: 6374 7261 5f70 6c6f 745b 3a2c 2031 5d29  ctra_plot[:, 1])
+00023690: 2b35 300a 2020 2020 2020 2020 5d29 0a0a  +50.        ])..
+000236a0: 0a0a 0a0a 0a20 2020 2020 2020 2066 696c  .....        fil
+000236b0: 653d 6669 6c65 6e61 6d65 2e72 7370 6c69  e=filename.rspli
+000236c0: 7428 272e 7478 7427 2c20 3129 5b30 5d0a  t('.txt', 1)[0].
+000236d0: 2020 2020 2020 2020 6966 2070 6c6f 745f          if plot_
+000236e0: 6669 6775 7265 2069 7320 5472 7565 3a0a  figure is True:.
+000236f0: 2020 2020 2020 2020 2020 2020 7061 7468              path
+00023700: 333d 7061 7468 2b27 2f27 2b27 5365 636f  3=path+'/'+'Seco
+00023710: 6e64 6172 795f 6669 745f 496d 6167 6573  ndary_fit_Images
+00023720: 270a 0a20 2020 2020 2020 2020 2020 2069  '..            i
+00023730: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+00023740: 2870 6174 6833 293a 0a20 2020 2020 2020  (path3):.       
+00023750: 2020 2020 2020 2020 206f 7574 3d27 7061           out='pa
+00023760: 7468 2065 7869 7374 7327 0a20 2020 2020  th exists'.     
+00023770: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00023780: 2020 2020 2020 2020 2020 2020 206f 732e               os.
+00023790: 6d61 6b65 6469 7273 2870 6174 6833 2c20  makedirs(path3, 
+000237a0: 6578 6973 745f 6f6b 3d46 616c 7365 290a  exist_ok=False).
+000237b0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+000237c0: 653d 6669 6c65 6e61 6d65 2e72 7370 6c69  e=filename.rspli
+000237d0: 7428 272e 7478 7427 2c20 3129 5b30 5d0a  t('.txt', 1)[0].
+000237e0: 2020 2020 2020 2020 2020 2020 6669 672e              fig.
+000237f0: 7361 7665 6669 6728 7061 7468 332b 272f  savefig(path3+'/
+00023800: 272b 206e 616d 6520 2b27 5f46 6974 5f7b  '+ name +'_Fit_{
+00023810: 7d2e 706e 6727 2e66 6f72 6d61 7428 6669  }.png'.format(fi
+00023820: 6c65 292c 2064 7069 3d64 7069 290a 0a0a  le), dpi=dpi)...
+00023830: 0a20 2020 2069 6620 636f 6e66 6967 2e72  .    if config.r
+00023840: 6574 7572 6e5f 6f74 6865 725f 7061 7261  eturn_other_para
+00023850: 6d73 2069 7320 5472 7565 3a0a 2020 2020  ms is True:.    
+00023860: 2020 2020 7265 7475 726e 2064 662c 2078      return df, x
+00023870: 785f 6361 7262 2c20 795f 6361 7262 2c20  x_carb, y_carb, 
+00023880: 7265 7375 6c74 300a 2020 2020 656c 7365  result0.    else
+00023890: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+000238a0: 2064 660a 0a64 6566 2070 6561 6b5f 7072   df..def peak_pr
+000238b0: 6f6d 696e 656e 6365 2878 2c20 792c 2070  ominence(x, y, p
+000238c0: 6561 6b5f 706f 7369 7469 6f6e 293a 0a20  eak_position):. 
+000238d0: 2020 2022 2222 2054 6869 7320 6675 6e63     """ This func
+000238e0: 7469 6f6e 2063 616c 6375 6c61 7465 7320  tion calculates 
+000238f0: 7468 6520 6170 7072 6f78 696d 6174 6520  the approximate 
+00023900: 7072 6f6d 696e 656e 6365 206f 6620 6120  prominence of a 
+00023910: 7065 616b 2c0a 2020 2020 6279 2066 696e  peak,.    by fin
+00023920: 6469 6e67 2074 6865 206c 6f63 616c 206d  ding the local m
+00023930: 696e 696d 756d 2065 6974 6865 7220 7369  inimum either si
+00023940: 6465 206f 6620 7468 6520 7065 616b 0a0a  de of the peak..
+00023950: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00023960: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00023970: 2020 783a 206e 702e 6172 7261 790a 2020    x: np.array.  
+00023980: 2020 2020 2020 7820 636f 6f72 6469 6e61        x coordina
+00023990: 7465 7320 2877 6176 656e 756d 6265 7229  tes (wavenumber)
+000239a0: 0a20 2020 2079 3a20 6e70 2e61 7272 6179  .    y: np.array
+000239b0: 0a20 2020 2020 2020 2079 2063 6f6f 7264  .        y coord
+000239c0: 696e 6174 6573 2028 696e 7465 6e73 6974  inates (intensit
+000239d0: 7929 0a0a 2020 2020 7065 616b 3a70 6f73  y)..    peak:pos
+000239e0: 6974 696f 6e3a 2069 6e74 2c20 666c 6f61  ition: int, floa
+000239f0: 740a 2020 2020 2020 2020 5065 616b 2070  t.        Peak p
+00023a00: 6f73 6974 696f 6e20 746f 2063 616c 6375  osition to calcu
+00023a10: 6c61 7465 2070 726f 6d69 6e65 6e63 6520  late prominence 
+00023a20: 666f 720a 0a20 2020 2052 6574 7572 6e73  for..    Returns
+00023a30: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
+00023a40: 2020 666c 6f61 743a 2070 726f 6d69 6e65    float: promine
+00023a50: 6e63 6520 6f66 2070 6561 6b20 696e 2079  nce of peak in y
+00023a60: 2063 6f6f 7264 696e 6174 6573 2e0a 0a20   coordinates... 
+00023a70: 2020 2022 2222 0a20 2020 2023 2046 696e     """.    # Fin
+00023a80: 6420 7468 6520 696e 6465 7820 6f66 2074  d the index of t
+00023a90: 6865 2070 6561 6b20 706f 7369 7469 6f6e  he peak position
+00023aa0: 0a20 2020 2070 6561 6b5f 696e 6465 7820  .    peak_index 
+00023ab0: 3d20 6e70 2e77 6865 7265 2878 203d 3d20  = np.where(x == 
+00023ac0: 7065 616b 5f70 6f73 6974 696f 6e29 5b30  peak_position)[0
+00023ad0: 5d5b 305d 0a0a 2020 2020 2320 4669 6e64  ][0]..    # Find
+00023ae0: 2074 6865 206c 6f63 616c 206d 696e 696d   the local minim
+00023af0: 756d 7320 6f6e 2062 6f74 6820 7369 6465  ums on both side
+00023b00: 7320 6f66 2074 6865 2070 6561 6b0a 2020  s of the peak.  
+00023b10: 2020 6c65 6674 5f76 616c 6c65 795f 696e    left_valley_in
+00023b20: 6465 7820 3d20 7065 616b 5f69 6e64 6578  dex = peak_index
+00023b30: 0a20 2020 2072 6967 6874 5f76 616c 6c65  .    right_valle
+00023b40: 795f 696e 6465 7820 3d20 7065 616b 5f69  y_index = peak_i
+00023b50: 6e64 6578 0a0a 2020 2020 2320 4669 6e64  ndex..    # Find
+00023b60: 2074 6865 206c 6566 7420 7661 6c6c 6579   the left valley
+00023b70: 0a20 2020 2077 6869 6c65 206c 6566 745f  .    while left_
+00023b80: 7661 6c6c 6579 5f69 6e64 6578 203e 2030  valley_index > 0
+00023b90: 2061 6e64 2079 5b6c 6566 745f 7661 6c6c   and y[left_vall
+00023ba0: 6579 5f69 6e64 6578 5d20 3e3d 2079 5b6c  ey_index] >= y[l
+00023bb0: 6566 745f 7661 6c6c 6579 5f69 6e64 6578  eft_valley_index
+00023bc0: 202d 2031 5d3a 0a20 2020 2020 2020 206c   - 1]:.        l
+00023bd0: 6566 745f 7661 6c6c 6579 5f69 6e64 6578  eft_valley_index
+00023be0: 202d 3d20 310a 0a20 2020 2023 2046 696e   -= 1..    # Fin
+00023bf0: 6420 7468 6520 7269 6768 7420 7661 6c6c  d the right vall
+00023c00: 6579 0a20 2020 2077 6869 6c65 2072 6967  ey.    while rig
+00023c10: 6874 5f76 616c 6c65 795f 696e 6465 7820  ht_valley_index 
+00023c20: 3c20 6c65 6e28 7829 202d 2031 2061 6e64  < len(x) - 1 and
+00023c30: 2079 5b72 6967 6874 5f76 616c 6c65 795f   y[right_valley_
+00023c40: 696e 6465 785d 203e 3d20 795b 7269 6768  index] >= y[righ
+00023c50: 745f 7661 6c6c 6579 5f69 6e64 6578 202b  t_valley_index +
+00023c60: 2031 5d3a 0a20 2020 2020 2020 2072 6967   1]:.        rig
+00023c70: 6874 5f76 616c 6c65 795f 696e 6465 7820  ht_valley_index 
+00023c80: 2b3d 2031 0a0a 2020 2020 2320 4361 6c63  += 1..    # Calc
+00023c90: 756c 6174 6520 7072 6f6d 696e 656e 6365  ulate prominence
+00023ca0: 2061 7320 7468 6520 6469 6666 6572 656e   as the differen
+00023cb0: 6365 2062 6574 7765 656e 2070 6561 6b20  ce between peak 
+00023cc0: 6865 6967 6874 2061 6e64 2068 6967 6865  height and highe
+00023cd0: 7220 7661 6c6c 6579 0a20 2020 2070 6561  r valley.    pea
+00023ce0: 6b5f 6865 6967 6874 203d 2079 5b70 6561  k_height = y[pea
+00023cf0: 6b5f 696e 6465 785d 0a20 2020 206c 6566  k_index].    lef
+00023d00: 745f 7661 6c6c 6579 5f68 6569 6768 7420  t_valley_height 
+00023d10: 3d20 795b 6c65 6674 5f76 616c 6c65 795f  = y[left_valley_
+00023d20: 696e 6465 785d 0a20 2020 2072 6967 6874  index].    right
+00023d30: 5f76 616c 6c65 795f 6865 6967 6874 203d  _valley_height =
+00023d40: 2079 5b72 6967 6874 5f76 616c 6c65 795f   y[right_valley_
+00023d50: 696e 6465 785d 0a0a 2020 2020 7072 6f6d  index]..    prom
+00023d60: 696e 656e 6365 203d 2070 6561 6b5f 6865  inence = peak_he
+00023d70: 6967 6874 202d 206d 6178 286c 6566 745f  ight - max(left_
+00023d80: 7661 6c6c 6579 5f68 6569 6768 742c 2072  valley_height, r
+00023d90: 6967 6874 5f76 616c 6c65 795f 6865 6967  ight_valley_heig
+00023da0: 6874 290a 0a20 2020 2072 6574 7572 6e20  ht)..    return 
+00023db0: 7072 6f6d 696e 656e 6365 0a0a 0a0a 2320  prominence....# 
+00023dc0: 506c 6f74 7469 6e67 2075 7020 7365 636f  Plotting up seco
+00023dd0: 6e64 6172 7920 7065 616b 730a 0a66 726f  ndary peaks..fro
+00023de0: 6d20 7363 6970 792e 7369 676e 616c 2069  m scipy.signal i
+00023df0: 6d70 6f72 7420 6669 6e64 5f70 6561 6b73  mport find_peaks
+00023e00: 0a64 6566 2070 6c6f 745f 7365 636f 6e64  .def plot_second
+00023e10: 6172 795f 7065 616b 7328 2a2c 2044 6961  ary_peaks(*, Dia
+00023e20: 645f 4669 6c65 732c 2070 6174 682c 2066  d_Files, path, f
+00023e30: 696c 6574 7970 652c 0a20 2020 2020 2020  iletype,.       
+00023e40: 2078 6c69 6d5f 706c 6f74 3d5b 3130 3430   xlim_plot=[1040
+00023e50: 2c20 3132 3030 5d2c 2078 6c69 6d5f 7065  , 1200], xlim_pe
+00023e60: 616b 733d 5b31 3036 302c 2031 3130 305d  aks=[1060, 1100]
+00023e70: 2c0a 2020 2020 2020 2020 6865 6967 6874  ,.        height
+00023e80: 3d31 3030 2c20 7468 7265 7368 6f6c 643d  =100, threshold=
+00023e90: 302e 312c 2064 6973 7461 6e63 653d 3130  0.1, distance=10
+00023ea0: 2c20 7072 6f6d 696e 656e 6365 3d35 2c20  , prominence=5, 
+00023eb0: 7769 6474 683d 362c 0a20 2020 2020 2020  width=6,.       
+00023ec0: 2020 7072 6f6d 696e 656e 6365 5f66 696c    prominence_fil
+00023ed0: 7465 723d 4661 6c73 652c 2073 6967 6d61  ter=False, sigma
+00023ee0: 3d33 2c20 7369 676d 615f 7769 6e64 6f77  =3, sigma_window
+00023ef0: 3d33 302c 2066 696e 645f 7065 616b 735f  =30, find_peaks_
+00023f00: 6669 6c74 6572 3d46 616c 7365 2c0a 2020  filter=False,.  
+00023f10: 2020 2020 2020 206a 7573 745f 706c 6f74         just_plot
+00023f20: 3d46 616c 7365 2c20 7973 6361 6c65 3d30  =False, yscale=0
+00023f30: 2e32 2c20 6761 7573 7369 616e 5f73 6d6f  .2, gaussian_smo
+00023f40: 6f74 683d 4661 6c73 652c 2073 6d6f 6f74  oth=False, smoot
+00023f50: 6869 6e67 5f77 696e 646f 773d 352c 2073  hing_window=5, s
+00023f60: 6d6f 6f74 685f 7374 643d 3329 3a0a 0a20  mooth_std=3):.. 
+00023f70: 2020 2022 2222 2054 6869 7320 6675 6e63     """ This func
+00023f80: 7469 6f6e 2070 6c6f 7473 2073 7065 6374  tion plots spect
+00023f90: 7261 2073 7461 636b 6564 2076 6572 7469  ra stacked verti
+00023fa0: 6361 6c6c 7920 6f6e 746f 7020 6f66 2065  cally ontop of e
+00023fb0: 6163 6820 6f74 6865 722c 2069 6e20 6120  ach other, in a 
+00023fc0: 7370 6563 6966 6963 2072 6567 696f 6e2e  specific region.
+00023fd0: 0a20 2020 2049 7420 616c 736f 2068 6173  .    It also has
+00023fe0: 2074 776f 206f 7074 696f 6e73 2074 6f20   two options to 
+00023ff0: 6964 656e 7469 6679 2070 6561 6b20 706f  identify peak po
+00024000: 7369 7469 6f6e 732e 0a0a 2020 2020 5061  sitions...    Pa
+00024010: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
+00024020: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
+00024030: 2044 6961 645f 4669 6c65 733a 206c 6973   Diad_Files: lis
+00024040: 740a 2020 2020 2020 2020 4c69 7374 206f  t.        List o
+00024050: 6620 6669 6c65 6e61 6d65 7320 746f 2070  f filenames to p
+00024060: 6c6f 740a 0a20 2020 2070 6174 683a 2073  lot..    path: s
+00024070: 7472 0a20 2020 2020 2020 2050 6174 6820  tr.        Path 
+00024080: 7768 6572 6520 7370 6563 7472 6120 6172  where spectra ar
+00024090: 6520 7374 6f72 6564 0a0a 2020 2020 6669  e stored..    fi
+000240a0: 6c65 7479 7065 3a20 7374 720a 2020 2020  letype: str.    
+000240b0: 2020 2020 4368 6f6f 7365 2066 726f 6d20      Choose from 
+000240c0: 2757 6974 6563 5f41 5343 4949 272c 2027  'Witec_ASCII', '
+000240d0: 6865 6164 6c65 7373 5f74 7874 272c 2027  headless_txt', '
+000240e0: 6865 6164 6c65 7373 5f63 7376 272c 2027  headless_csv', '
+000240f0: 6865 6164 5f63 7376 272c 2027 5769 7465  head_csv', 'Wite
+00024100: 635f 4153 4349 4927 2c0a 2020 2020 2020  c_ASCII',.      
+00024110: 2020 2748 4f52 4942 415f 7478 7427 2c20    'HORIBA_txt', 
+00024120: 2752 656e 6973 6861 775f 7478 7427 0a0a  'Renishaw_txt'..
+00024130: 2020 2020 786c 696d 5f70 6c6f 743a 2054      xlim_plot: T
+00024140: 7570 6c65 5b66 6c6f 6174 2c20 666c 6f61  uple[float, floa
+00024150: 745d 0a20 2020 2020 2020 2052 616e 6765  t].        Range
+00024160: 206f 6620 7820 636f 6f72 6469 6e61 7465   of x coordinate
+00024170: 7320 746f 206d 616b 6520 706c 6f74 206f  s to make plot o
+00024180: 7665 720a 0a20 2020 2078 6c69 6d5f 7065  ver..    xlim_pe
+00024190: 616b 733a 2054 7570 6c65 5b66 6c6f 6174  aks: Tuple[float
+000241a0: 2c20 666c 6f61 745d 0a20 2020 2020 2020  , float].       
+000241b0: 2052 616e 6765 206f 6620 7820 636f 6f72   Range of x coor
+000241c0: 6469 6e61 7465 7320 746f 2073 6561 7263  dinates to searc
+000241d0: 6820 666f 7220 7065 616b 7320 696e 0a0a  h for peaks in..
+000241e0: 2020 2020 4f70 7469 6f6e 616c 2070 6172      Optional par
+000241f0: 616d 6574 6572 7320 666f 7220 536d 6f6f  ameters for Smoo
+00024200: 7468 696e 6720 7370 6563 7472 6120 7072  thing spectra pr
+00024210: 696f 7220 746f 2066 696e 6469 6e67 2070  ior to finding p
+00024220: 6561 6b73 0a0a 2020 2020 2020 2020 6761  eaks..        ga
+00024230: 7573 7369 616e 5f73 6d6f 6f74 683a 626f  ussian_smooth:bo
+00024240: 6f6c 202d 2049 6620 5472 7565 2c20 6170  ol - If True, ap
+00024250: 706c 6965 7320 6120 6761 7573 7369 616e  plies a gaussian
+00024260: 2073 6d6f 6f74 6869 6e67 2066 696c 7465   smoothing filte
+00024270: 7220 7573 696e 6720 6e70 2e63 6f6e 766f  r using np.convo
+00024280: 6c76 6520 6465 6669 6e65 6420 6279 2061  lve defined by a
+00024290: 0a20 2020 2020 2020 2020 736d 6f6f 7468  .         smooth
+000242a0: 696e 675f 7769 6e64 6f77 2061 6e64 2061  ing_window and a
+000242b0: 2073 6d6f 6f74 685f 7374 642e 0a0a 0a20   smooth_std.... 
+000242c0: 2020 2049 6620 796f 7520 7761 6e74 2074     If you want t
+000242d0: 6f20 6163 7475 616c 6c79 2049 4420 7065  o actually ID pe
+000242e0: 616b 7320 7261 7468 6572 2074 6861 6e20  aks rather than 
+000242f0: 6a75 7374 2070 6c6f 7420 7468 656d 2c20  just plot them, 
+00024300: 6368 6f6f 7365 2066 726f 6d3a 0a0a 2020  choose from:..  
+00024310: 2020 7072 6f6d 696e 656e 6365 5f66 696c    prominence_fil
+00024320: 7465 723a 2062 6f6f 6c0a 2020 2020 2020  ter: bool.      
+00024330: 2020 6966 2054 7275 652c 2066 696e 6473    if True, finds
+00024340: 206d 6178 2079 2063 6f6f 7264 696e 6174   max y coordinat
+00024350: 6520 696e 2074 6865 2077 696e 646f 7720  e in the window 
+00024360: 786c 696d 5f70 6561 6b73 2e20 4974 2074  xlim_peaks. It t
+00024370: 6865 6e20 6361 6c63 756c 6174 6573 2074  hen calculates t
+00024380: 6865 2070 726f 6d69 6e65 6e63 6520 6279  he prominence by
+00024390: 0a20 2020 2020 2020 2063 6f6d 7061 7269  .        compari
+000243a0: 6e67 2074 6869 7320 7065 616b 2068 6569  ng this peak hei
+000243b0: 6768 7420 746f 2074 6865 2061 7665 7261  ght to the avera
+000243c0: 6765 206f 6620 7468 6520 6d65 6469 616e  ge of the median
+000243d0: 206f 6620 7468 6520 3320 6461 7461 706f   of the 3 datapo
+000243e0: 696e 7473 2061 7420 7468 6520 6c65 6674  ints at the left
+000243f0: 2061 6e64 2072 6967 6874 206f 6620 7468   and right of th
+00024400: 6520 7769 6e64 6f77 2e0a 2020 2020 2020  e window..      
+00024410: 2020 4966 2074 6865 2070 6561 6b20 6973    If the peak is
+00024420: 206d 6f72 6520 7468 616e 2027 7072 6f6d   more than 'prom
+00024430: 696e 656e 6365 2720 756e 6974 7320 6162  inence' units ab
+00024440: 6f76 6520 7468 6520 6176 6572 6167 6520  ove the average 
+00024450: 6f66 2074 6865 7365 2074 776f 2065 6e64  of these two end
+00024460: 2070 6f69 6e74 206d 6564 6961 6e73 2c20   point medians, 
+00024470: 6974 0a20 2020 2020 2020 2069 7320 636c  it.        is cl
+00024480: 6173 7369 6669 6564 2061 7320 6120 7065  assified as a pe
+00024490: 616b 2e0a 2020 2020 2020 2020 416c 736f  ak..        Also
+000244a0: 206e 6565 6420 746f 2073 7065 6369 6679   need to specify
+000244b0: 2070 726f 6d69 6e65 6e63 653a 2066 6c6f   prominence: flo
+000244c0: 6174 0a0a 2020 2020 6669 6e64 5f70 6561  at..    find_pea
+000244d0: 6b73 5f66 696c 7465 723a 2062 6f6f 6c0a  ks_filter: bool.
+000244e0: 0a20 2020 2020 2020 2069 6620 5472 7565  .        if True
+000244f0: 2c20 7573 6573 2073 6369 7079 2066 696e  , uses scipy fin
+00024500: 6420 7065 616b 7320 746f 2066 696e 6420  d peaks to find 
+00024510: 7065 616b 732e 2043 616e 2074 7765 616b  peaks. Can tweak
+00024520: 2064 6973 7461 6e63 652c 2070 726f 6d69   distance, promi
+00024530: 6e65 6e63 652c 2077 6964 7468 2c0a 2020  nence, width,.  
+00024540: 2020 2020 2020 7468 7265 7368 6f6c 642c        threshold,
+00024550: 2061 6e64 2068 6569 6768 742e 0a0a 2020   and height...  
+00024560: 2020 6a75 7374 5f70 6c6f 743a 2062 6f6f    just_plot: boo
+00024570: 6c0a 2020 2020 2020 2020 6966 2054 7275  l.        if Tru
+00024580: 652c 206a 7573 7420 706c 6f74 7320 7370  e, just plots sp
+00024590: 6563 7472 612c 2064 6f65 736e 7420 7472  ectra, doesnt tr
+000245a0: 7920 746f 2066 696e 6420 7065 616b 730a  y to find peaks.
+000245b0: 0a20 2020 2079 5f73 6361 6c65 3a20 666c  .    y_scale: fl
+000245c0: 6f61 740a 2020 2020 2020 2020 4669 6775  oat.        Figu
+000245d0: 7265 2073 697a 6520 6973 2032 2b79 5f73  re size is 2+y_s
+000245e0: 6361 6c65 202a 206e 756d 6265 7220 6f66  cale * number of
+000245f0: 2073 7065 6374 7261 0a0a 2020 2020 5265   spectra..    Re
+00024600: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00024610: 2d2d 2d2d 2d2d 2d0a 2020 2020 6466 5f70  -------.    df_p
+00024620: 6561 6b73 2c20 785f 6461 7461 2c20 795f  eaks, x_data, y_
+00024630: 6461 7461 2c20 6669 670a 0a20 2020 2064  data, fig..    d
+00024640: 665f 7065 616b 733a 2070 642e 4461 7461  f_peaks: pd.Data
+00024650: 4672 616d 6520 666f 7220 6561 6368 2066  Frame for each f
+00024660: 696c 6520 6f66 2070 6561 6b20 706f 7369  ile of peak posi
+00024670: 7469 6f6e 2c20 6865 6967 6874 2c20 7072  tion, height, pr
+00024680: 6f6d 696e 656e 6365 2061 6e64 2066 696c  ominence and fil
+00024690: 6520 6e61 6d65 2e20 4669 6c6c 6564 2077  e name. Filled w
+000246a0: 6974 6820 4e61 6e73 2069 6620 6469 646e  ith Nans if didn
+000246b0: 7420 6669 6e64 2061 2070 6561 6b0a 2020  t find a peak.  
+000246c0: 2020 785f 6461 7461 3a20 6e70 2e61 7272    x_data: np.arr
+000246d0: 6179 206f 6620 7820 636f 6f72 6469 6e61  ay of x coordina
+000246e0: 7465 7320 2841 7373 756d 6573 2074 6865  tes (Assumes the
+000246f0: 2073 616d 6520 666f 7220 616c 6c20 6669   same for all fi
+00024700: 6c65 7329 0a20 2020 2079 5f64 6174 613a  les).    y_data:
+00024710: 206e 702e 6172 7261 7920 6f66 2079 2063   np.array of y c
+00024720: 6f6f 7264 696e 6174 6573 206f 6620 6561  oordinates of ea
+00024730: 6368 2073 7065 6374 7261 0a20 2020 2066  ch spectra.    f
+00024740: 6967 3a20 6669 6775 7265 2069 7420 6861  ig: figure it ha
+00024750: 7320 706c 6f74 7465 640a 0a0a 2020 2020  s plotted...    
+00024760: 2222 220a 2020 2020 6966 2070 726f 6d69  """.    if promi
+00024770: 6e65 6e63 655f 6669 6c74 6572 2069 7320  nence_filter is 
+00024780: 5472 7565 2061 6e64 2028 6669 6e64 5f70  True and (find_p
+00024790: 6561 6b73 5f66 696c 7465 7220 6973 2054  eaks_filter is T
+000247a0: 7275 6520 6f72 206a 7573 745f 706c 6f74  rue or just_plot
+000247b0: 2069 7320 5472 7565 293a 0a20 2020 2020   is True):.     
+000247c0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+000247d0: 6f72 2827 4f6e 6c79 206f 6e65 206f 6620  or('Only one of 
+000247e0: 7369 676d 615f 6669 6c74 6572 2c20 696e  sigma_filter, in
+000247f0: 645f 7065 616b 735f 6669 6c74 6572 2061  d_peaks_filter a
+00024800: 6e64 206a 7573 745f 706c 6f74 2063 616e  nd just_plot can
+00024810: 2062 6520 5472 7565 2729 0a20 2020 2066   be True').    f
+00024820: 6967 2c20 2861 7831 2920 3d20 706c 742e  ig, (ax1) = plt.
+00024830: 7375 6270 6c6f 7473 2831 2c20 312c 2066  subplots(1, 1, f
+00024840: 6967 7369 7a65 3d28 3130 2c32 2b79 7363  igsize=(10,2+ysc
+00024850: 616c 652a 6c65 6e28 4469 6164 5f46 696c  ale*len(Diad_Fil
+00024860: 6573 2929 290a 0a20 2020 2069 3d30 0a20  es)))..    i=0. 
+00024870: 2020 2059 3d30 0a20 2020 2070 6561 6b5f     Y=0.    peak_
+00024880: 706f 735f 7361 7665 643d 6e70 2e7a 6572  pos_saved=np.zer
+00024890: 6f73 286c 656e 2844 6961 645f 4669 6c65  os(len(Diad_File
+000248a0: 7329 2c20 6474 7970 653d 666c 6f61 7429  s), dtype=float)
+000248b0: 0a20 2020 2070 6561 6b5f 7072 6f6d 5f73  .    peak_prom_s
+000248c0: 6176 6564 3d6e 702e 7a65 726f 7328 6c65  aved=np.zeros(le
+000248d0: 6e28 4469 6164 5f46 696c 6573 292c 2064  n(Diad_Files), d
+000248e0: 7479 7065 3d66 6c6f 6174 290a 2020 2020  type=float).    
+000248f0: 7065 616b 5f68 6569 6768 745f 7361 7665  peak_height_save
+00024900: 643d 6e70 2e7a 6572 6f73 286c 656e 2844  d=np.zeros(len(D
+00024910: 6961 645f 4669 6c65 7329 2c20 6474 7970  iad_Files), dtyp
+00024920: 653d 666c 6f61 7429 0a20 2020 2070 6561  e=float).    pea
+00024930: 6b5f 6263 6b3d 6e70 2e7a 6572 6f73 286c  k_bck=np.zeros(l
+00024940: 656e 2844 6961 645f 4669 6c65 7329 2c20  en(Diad_Files), 
+00024950: 6474 7970 653d 666c 6f61 7429 0a20 2020  dtype=float).   
+00024960: 2079 5f73 7461 723d 6e70 2e7a 6572 6f73   y_star=np.zeros
+00024970: 286c 656e 2844 6961 645f 4669 6c65 7329  (len(Diad_Files)
+00024980: 2c20 6474 7970 653d 666c 6f61 7429 0a20  , dtype=float). 
+00024990: 2020 2079 706c 6f74 3d6e 702e 7a65 726f     yplot=np.zero
+000249a0: 7328 6c65 6e28 4469 6164 5f46 696c 6573  s(len(Diad_Files
+000249b0: 292c 2064 7479 7065 3d66 6c6f 6174 290a  ), dtype=float).
+000249c0: 2020 2020 4469 6164 5f64 663d 6765 745f      Diad_df=get_
+000249d0: 6461 7461 2870 6174 683d 7061 7468 2c20  data(path=path, 
+000249e0: 6669 6c65 6e61 6d65 3d44 6961 645f 4669  filename=Diad_Fi
+000249f0: 6c65 735b 305d 2c20 6669 6c65 7479 7065  les[0], filetype
+00024a00: 3d66 696c 6574 7970 6529 0a20 2020 2078  =filetype).    x
+00024a10: 5f64 6174 613d 4469 6164 5f64 665b 3a2c  _data=Diad_df[:,
+00024a20: 2030 5d0a 2020 2020 795f 6461 7461 3d6e   0].    y_data=n
+00024a30: 702e 7a65 726f 7328 5b20 206c 656e 2878  p.zeros([  len(x
+00024a40: 5f64 6174 6129 2c20 6c65 6e28 4469 6164  _data), len(Diad
+00024a50: 5f46 696c 6573 295d 2c20 666c 6f61 7429  _Files)], float)
+00024a60: 0a0a 0a20 2020 2066 6f72 2066 696c 6520  ...    for file 
+00024a70: 696e 2044 6961 645f 4669 6c65 733a 0a0a  in Diad_Files:..
+00024a80: 0a0a 0a20 2020 2020 2020 2044 6961 645f  ...        Diad_
+00024a90: 6466 3d67 6574 5f64 6174 6128 7061 7468  df=get_data(path
+00024aa0: 3d70 6174 682c 2066 696c 656e 616d 653d  =path, filename=
+00024ab0: 6669 6c65 2c20 6669 6c65 7479 7065 3d66  file, filetype=f
+00024ac0: 696c 6574 7970 6529 0a20 2020 2020 2020  iletype).       
+00024ad0: 2044 6961 643d 6e70 2e61 7272 6179 2844   Diad=np.array(D
+00024ae0: 6961 645f 6466 290a 0a0a 2020 2020 2020  iad_df)...      
+00024af0: 2020 2320 4669 7273 7420 6c65 7473 2075    # First lets u
+00024b00: 7365 2066 696e 6420 7065 616b 730a 2020  se find peaks.  
+00024b10: 2020 2020 2020 7932 3d44 6961 645b 3a2c        y2=Diad[:,
+00024b20: 2031 5d0a 2020 2020 2020 2020 783d 4469   1].        x=Di
+00024b30: 6164 5b3a 2c20 305d 0a0a 2020 2020 2020  ad[:, 0]..      
+00024b40: 2020 6966 2067 6175 7373 6961 6e5f 736d    if gaussian_sm
+00024b50: 6f6f 7468 2069 7320 5472 7565 3a0a 2020  ooth is True:.  
+00024b60: 2020 2020 2020 2020 2020 7920 3d20 6e70            y = np
+00024b70: 2e63 6f6e 766f 6c76 6528 7932 2c20 6761  .convolve(y2, ga
+00024b80: 7573 7369 616e 2873 6d6f 6f74 6869 6e67  ussian(smoothing
+00024b90: 5f77 696e 646f 772c 2073 7464 3d73 6d6f  _window, std=smo
+00024ba0: 6f74 685f 7374 6429 2c20 6d6f 6465 3d27  oth_std), mode='
+00024bb0: 7361 6d65 2729 0a20 2020 2020 2020 2065  same').        e
+00024bc0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00024bd0: 2079 3d79 320a 0a0a 0a20 2020 2020 2020   y=y2....       
+00024be0: 2023 2052 6567 696f 6e20 6f66 2069 6e74   # Region of int
+00024bf0: 6572 6573 740a 2020 2020 2020 2020 5265  erest.        Re
+00024c00: 6769 6f6e 5f70 6561 6b73 203d 2028 2878  gion_peaks = ((x
+00024c10: 3e78 6c69 6d5f 7065 616b 735b 305d 2926  >xlim_peaks[0])&
+00024c20: 2028 783c 786c 696d 5f70 6561 6b73 5b31   (x<xlim_peaks[1
+00024c30: 5d29 290a 2020 2020 2020 2020 5265 6769  ])).        Regi
+00024c40: 6f6e 5f70 6c6f 743d 2828 783e 786c 696d  on_plot=((x>xlim
+00024c50: 5f70 6c6f 745b 305d 2926 2028 783c 786c  _plot[0])& (x<xl
+00024c60: 696d 5f70 6c6f 745b 315d 2929 0a20 2020  im_plot[1])).   
+00024c70: 2020 2020 2078 5f74 7269 6d3d 785b 5265       x_trim=x[Re
+00024c80: 6769 6f6e 5f70 6561 6b73 5d0a 2020 2020  gion_peaks].    
+00024c90: 2020 2020 795f 7472 696d 3d79 5b52 6567      y_trim=y[Reg
+00024ca0: 696f 6e5f 7065 616b 735d 0a20 2020 2020  ion_peaks].     
+00024cb0: 2020 2078 5f70 6c6f 743d 785b 5265 6769     x_plot=x[Regi
+00024cc0: 6f6e 5f70 6c6f 745d 0a20 2020 2020 2020  on_plot].       
+00024cd0: 2079 5f70 6c6f 743d 795b 5265 6769 6f6e   y_plot=y[Region
+00024ce0: 5f70 6c6f 745d 0a20 2020 2020 2020 2079  _plot].        y
+00024cf0: 5f64 6174 615b 3a2c 2069 5d3d 790a 0a0a  _data[:, i]=y...
+00024d00: 0a20 2020 2020 2020 2023 2049 4620 7573  .        # IF us
+00024d10: 696e 6720 7363 6970 7920 6669 6e64 2070  ing scipy find p
+00024d20: 6561 6b73 0a20 2020 2020 2020 2069 6620  eaks.        if 
+00024d30: 6669 6e64 5f70 6561 6b73 5f66 696c 7465  find_peaks_filte
+00024d40: 7220 6973 2054 7275 653a 0a20 2020 2020  r is True:.     
+00024d50: 2020 2020 2020 2023 2046 696e 6420 7065         # Find pe
+00024d60: 616b 7320 666f 7220 7472 696d 6d65 6420  aks for trimmed 
+00024d70: 7370 6563 7472 6120 2865 2e67 2e20 696e  spectra (e.g. in
+00024d80: 2072 6567 696f 6e20 7065 616b 7320 6861   region peaks ha
+00024d90: 7665 2062 6565 6e20 6173 6b65 6420 666f  ve been asked fo
+00024da0: 7229 0a20 2020 2020 2020 2020 2020 2070  r).            p
+00024db0: 6561 6b73 203d 2066 696e 645f 7065 616b  eaks = find_peak
+00024dc0: 7328 795f 7472 696d 2c68 6569 6768 7420  s(y_trim,height 
+00024dd0: 3d20 6865 6967 6874 2c20 7468 7265 7368  = height, thresh
+00024de0: 6f6c 6420 3d20 7468 7265 7368 6f6c 642c  old = threshold,
+00024df0: 0a20 2020 2020 2020 2020 2020 2064 6973  .            dis
+00024e00: 7461 6e63 6520 3d20 6469 7374 616e 6365  tance = distance
+00024e10: 2c20 7072 6f6d 696e 656e 6365 3d70 726f  , prominence=pro
+00024e20: 6d69 6e65 6e63 652c 2077 6964 7468 3d77  minence, width=w
+00024e30: 6964 7468 290a 0a0a 2020 2020 2020 2020  idth)...        
+00024e40: 2020 2020 6865 6967 6874 5f50 4541 4b20      height_PEAK 
+00024e50: 3d20 7065 616b 735b 315d 5b27 7065 616b  = peaks[1]['peak
+00024e60: 5f68 6569 6768 7473 275d 2023 6c69 7374  _heights'] #list
+00024e70: 206f 6620 7468 6520 6865 6967 6874 7320   of the heights 
+00024e80: 6f66 2074 6865 2070 6561 6b73 0a20 2020  of the peaks.   
+00024e90: 2020 2020 2020 2020 2070 6561 6b5f 706f           peak_po
+00024ea0: 7320 3d20 785f 7472 696d 5b70 6561 6b73  s = x_trim[peaks
+00024eb0: 5b30 5d5d 2023 6c69 7374 206f 6620 7468  [0]] #list of th
+00024ec0: 6520 7065 616b 7320 706f 7369 7469 6f6e  e peaks position
+00024ed0: 730a 0a20 2020 2020 2020 2020 2020 2064  s..            d
+00024ee0: 665f 736f 7274 3d70 642e 4461 7461 4672  f_sort=pd.DataFr
+00024ef0: 616d 6528 6461 7461 3d7b 2770 6f73 273a  ame(data={'pos':
+00024f00: 2070 6561 6b5f 706f 732c 0a20 2020 2020   peak_pos,.     
+00024f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024f20: 2020 2020 2020 2020 2020 2027 6865 6967             'heig
+00024f30: 6874 273a 2068 6569 6768 745f 5045 414b  ht': height_PEAK
+00024f40: 7d29 0a0a 2020 2020 2020 2020 2020 2020  })..            
+00024f50: 6466 5f70 6561 6b5f 736f 7274 3d64 665f  df_peak_sort=df_
+00024f60: 736f 7274 2e73 6f72 745f 7661 6c75 6573  sort.sort_values
+00024f70: 2827 6865 6967 6874 272c 2061 7869 733d  ('height', axis=
+00024f80: 302c 2061 7363 656e 6469 6e67 3d46 616c  0, ascending=Fal
+00024f90: 7365 290a 0a20 2020 2020 2020 2020 2020  se)..           
+00024fa0: 2023 2054 7269 6d20 6e75 6d62 6572 206f   # Trim number o
+00024fb0: 6620 7065 616b 7320 6261 7365 6420 6f6e  f peaks based on
+00024fc0: 2075 7365 722d 6465 6669 6e65 6420 4e20   user-defined N 
+00024fd0: 7065 616b 730a 0a0a 0a20 2020 2020 2020  peaks....       
+00024fe0: 2020 2020 2023 7072 696e 7428 6466 5f70       #print(df_p
+00024ff0: 6561 6b5f 736f 7274 5f73 686f 7274 290a  eak_sort_short).
+00025000: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00025010: 656e 2864 665f 7065 616b 5f73 6f72 743e  en(df_peak_sort>
+00025020: 3d31 293a 0a0a 2020 2020 2020 2020 2020  =1):..          
+00025030: 2020 2020 2020 6466 5f70 6561 6b5f 736f        df_peak_so
+00025040: 7274 5f73 686f 7274 3d64 665f 7065 616b  rt_short=df_peak
+00025050: 5f73 6f72 745b 303a 315d 0a20 2020 2020  _sort[0:1].     
+00025060: 2020 2020 2020 2020 2020 2070 6561 6b5f             peak_
+00025070: 706f 735f 7361 7665 645b 695d 3d64 665f  pos_saved[i]=df_
+00025080: 7065 616b 5f73 6f72 745f 7368 6f72 745b  peak_sort_short[
+00025090: 2770 6f73 275d 2e76 616c 7565 730a 2020  'pos'].values.  
+000250a0: 2020 2020 2020 2020 2020 2020 2020 7065                pe
+000250b0: 616b 5f68 6569 6768 745f 7361 7665 645b  ak_height_saved[
+000250c0: 695d 3d64 665f 7065 616b 5f73 6f72 745f  i]=df_peak_sort_
+000250d0: 7368 6f72 745b 2768 6569 6768 7427 5d2e  short['height'].
+000250e0: 7661 6c75 6573 0a20 2020 2020 2020 2020  values.         
+000250f0: 2020 2065 6c73 653a 0a0a 2020 2020 2020     else:..      
+00025100: 2020 2020 2020 2020 2020 7065 616b 5f70            peak_p
+00025110: 6f73 5f73 6176 6564 5b69 5d3d 6e70 2e6e  os_saved[i]=np.n
+00025120: 616e 0a20 2020 2020 2020 2020 2020 2020  an.             
+00025130: 2020 2070 6561 6b5f 6865 6967 6874 5f73     peak_height_s
+00025140: 6176 6564 5b69 5d3d 6e70 2e6e 616e 0a0a  aved[i]=np.nan..
+00025150: 2020 2020 2020 2020 2020 2020 7065 616b              peak
+00025160: 5f62 636b 5b69 5d3d 6e70 2e71 7561 6e74  _bck[i]=np.quant
+00025170: 696c 6528 795f 706c 6f74 2c20 302e 3229  ile(y_plot, 0.2)
+00025180: 0a20 2020 2020 2020 2020 2020 2061 765f  .            av_
+00025190: 793d 6e70 2e71 7561 6e74 696c 6528 795f  y=np.quantile(y_
+000251a0: 706c 6f74 2c20 302e 3529 0a20 2020 2020  plot, 0.5).     
+000251b0: 2020 2020 2020 2044 6966 663d 6e70 2e6d         Diff=np.m
+000251c0: 6178 2879 5f70 6c6f 7429 2d6e 702e 6d69  ax(y_plot)-np.mi
+000251d0: 6e28 795f 706c 6f74 290a 2020 2020 2020  n(y_plot).      
+000251e0: 2020 2020 2020 595f 7375 6d3d 6e70 2e6d        Y_sum=np.m
+000251f0: 6178 2879 5f70 6c6f 7429 2f44 6966 660a  ax(y_plot)/Diff.
+00025200: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
+00025210: 2e70 6c6f 7428 785f 706c 6f74 2c20 2828  .plot(x_plot, ((
+00025220: 795f 706c 6f74 2d6e 702e 6d69 6e28 795f  y_plot-np.min(y_
+00025230: 706c 6f74 2929 2f44 6966 6629 2b69 2c20  plot))/Diff)+i, 
+00025240: 272d 7227 290a 2020 2020 2020 2020 2020  '-r').          
+00025250: 2020 6178 312e 706c 6f74 2878 5f70 6c6f    ax1.plot(x_plo
+00025260: 742c 2028 2879 5f70 6c6f 742d 6e70 2e6d  t, ((y_plot-np.m
+00025270: 696e 2879 5f70 6c6f 7429 292f 4469 6666  in(y_plot))/Diff
+00025280: 292b 692c 2027 2e6b 272c 206d 733d 3129  )+i, '.k', ms=1)
+00025290: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000252a0: 6c65 6e28 6865 6967 6874 5f50 4541 4b29  len(height_PEAK)
+000252b0: 3e30 3a0a 0a0a 2020 2020 2020 2020 2020  >0:...          
+000252c0: 2020 2020 2020 6178 312e 706c 6f74 2864        ax1.plot(d
+000252d0: 665f 7065 616b 5f73 6f72 745f 7368 6f72  f_peak_sort_shor
+000252e0: 745b 2770 6f73 275d 2c20 2864 665f 7065  t['pos'], (df_pe
+000252f0: 616b 5f73 6f72 745f 7368 6f72 745b 2768  ak_sort_short['h
+00025300: 6569 6768 7427 5d2d 6e70 2e6d 696e 2879  eight']-np.min(y
+00025310: 5f70 6c6f 7429 292f 4469 6666 2b69 2c20  _plot))/Diff+i, 
+00025320: 272a 6b27 2c20 6d66 633d 2779 656c 6c6f  '*k', mfc='yello
+00025330: 7727 2c20 6d73 3d31 3029 0a0a 2020 2020  w', ms=10)..    
+00025340: 2020 2020 2020 2020 7970 6c6f 745b 695d          yplot[i]
+00025350: 3d6e 702e 6d69 6e28 2828 795f 706c 6f74  =np.min(((y_plot
+00025360: 2d6e 702e 6d69 6e28 795f 706c 6f74 2929  -np.min(y_plot))
+00025370: 2f44 6966 6629 2b69 290a 0a20 2020 2020  /Diff)+i)..     
+00025380: 2020 2020 2020 2061 7831 2e61 6e6e 6f74         ax1.annot
+00025390: 6174 6528 7374 7228 6669 6c65 292c 2078  ate(str(file), x
+000253a0: 793d 2878 6c69 6d5f 706c 6f74 5b31 5d2b  y=(xlim_plot[1]+
+000253b0: 302e 352c 2079 706c 6f74 5b69 5d29 2c0a  0.5, yplot[i]),.
+000253c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000253d0: 2020 2020 2020 2020 2078 7963 6f6f 7264           xycoord
+000253e0: 733d 2264 6174 6122 2c20 666f 6e74 7369  s="data", fontsi
+000253f0: 7a65 3d38 290a 2020 2020 2020 2020 2020  ze=8).          
+00025400: 2020 2361 7831 2e73 6574 5f78 6c69 6d28    #ax1.set_xlim(
+00025410: 786c 696d 290a 2020 2020 2020 2020 2020  xlim).          
+00025420: 2020 593d 592b 595f 7375 6d0a 0a0a 2020    Y=Y+Y_sum...  
+00025430: 2020 2020 2020 2020 2020 2320 6361 6c63            # calc
+00025440: 756c 6174 6520 7072 6f6d 696e 656e 6365  ulate prominence
+00025450: 0a20 2020 2020 2020 2020 2020 2079 5f65  .            y_e
+00025460: 6467 6531 3d6e 702e 6d65 6469 616e 2879  dge1=np.median(y
+00025470: 5f74 7269 6d5b 303a 335d 290a 2020 2020  _trim[0:3]).    
+00025480: 2020 2020 2020 2020 795f 6564 6765 323d          y_edge2=
+00025490: 6e70 2e6d 6564 6961 6e28 795f 7472 696d  np.median(y_trim
+000254a0: 5b2d 333a 5d29 0a20 2020 2020 2020 2020  [-3:]).         
+000254b0: 2020 2070 6561 6b5f 7072 6f6d 5f73 6176     peak_prom_sav
+000254c0: 6564 5b69 5d3d 7065 616b 5f68 6569 6768  ed[i]=peak_heigh
+000254d0: 745f 7361 7665 645b 695d 2d28 795f 6564  t_saved[i]-(y_ed
+000254e0: 6765 312b 795f 6564 6765 3229 2f32 0a0a  ge1+y_edge2)/2..
+000254f0: 2020 2020 2020 2020 2020 2020 693d 692b              i=i+
+00025500: 310a 0a0a 2020 2020 2020 2020 656c 6966  1...        elif
+00025510: 2070 726f 6d69 6e65 6e63 655f 6669 6c74   prominence_filt
+00025520: 6572 2069 7320 5472 7565 3a0a 2020 2020  er is True:.    
+00025530: 2020 2020 2020 2020 2020 2020 2320 4669              # Fi
+00025540: 6e64 206d 6178 2076 616c 7565 2069 6e20  nd max value in 
+00025550: 7265 6769 6f6e 0a0a 2020 2020 2020 2020  region..        
+00025560: 2020 2020 6d61 7879 3d6e 702e 6d61 7828      maxy=np.max(
+00025570: 795f 7472 696d 290a 2020 2020 2020 2020  y_trim).        
+00025580: 2020 2020 7870 6f73 3d78 5f74 7269 6d5b      xpos=x_trim[
+00025590: 795f 7472 696d 3d3d 6d61 7879 5d5b 305d  y_trim==maxy][0]
+000255a0: 0a20 2020 2020 2020 2020 2020 2023 7072  .            #pr
+000255b0: 696e 7428 7870 6f73 290a 2020 2020 2020  int(xpos).      
+000255c0: 2020 2020 2020 2320 6966 2028 7870 6f73        # if (xpos
+000255d0: 2b73 6967 6d61 5f77 696e 646f 7729 3e6e  +sigma_window)>n
+000255e0: 702e 6d61 7828 785f 7472 696d 293a 0a20  p.max(x_trim):. 
+000255f0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00025600: 2052 6169 7365 2054 7970 6545 7272 6f72   Raise TypeError
+00025610: 2827 596f 7572 2070 6561 6b20 6669 6e64  ('Your peak find
+00025620: 696e 6720 7769 6e64 6f77 2069 7320 736d  ing window is sm
+00025630: 616c 6c65 7220 7468 616e 2073 6967 6d61  aller than sigma
+00025640: 2077 696e 646f 7727 290a 2020 2020 2020   window').      
+00025650: 2020 2020 2020 2320 795f 6172 6f75 6e64        # y_around
+00025660: 5f6d 6178 3d79 5f74 7269 6d5b 2878 5f74  _max=y_trim[(x_t
+00025670: 7269 6d3e 2878 706f 732b 7369 676d 615f  rim>(xpos+sigma_
+00025680: 7769 6e64 6f77 2929 2628 785f 7472 696d  window))&(x_trim
+00025690: 3c28 7870 6f73 2d73 6967 6d61 5f77 696e  <(xpos-sigma_win
+000256a0: 646f 7729 295d 0a20 2020 2020 2020 2020  dow))].         
+000256b0: 2020 2023 2073 7464 793d 6e70 2e6e 616e     # stdy=np.nan
+000256c0: 7374 6428 795f 6172 6f75 6e64 5f6d 6178  std(y_around_max
+000256d0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+000256e0: 6d65 6469 616e 793d 6e70 2e71 7561 6e74  mediany=np.quant
+000256f0: 696c 6528 795f 6172 6f75 6e64 5f6d 6178  ile(y_around_max
+00025700: 2c20 302e 3529 0a20 2020 2020 2020 2020  , 0.5).         
+00025710: 2020 2023 2069 6620 6d61 7879 3e6d 6564     # if maxy>med
+00025720: 6961 6e79 2b73 7464 792a 7369 676d 612b  iany+stdy*sigma+
+00025730: 7072 6f6d 696e 656e 6365 3a0a 2020 2020  prominence:.    
+00025740: 2020 2020 2020 2020 2320 2020 2020 706f          #     po
+00025750: 735f 783d 785f 7472 696d 5b79 5f74 7269  s_x=x_trim[y_tri
+00025760: 6d3d 3d6d 6178 795d 5b30 5d0a 2020 2020  m==maxy][0].    
+00025770: 2020 2020 2020 2020 2320 656c 7365 3a0a          # else:.
+00025780: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00025790: 2020 706f 735f 783d 6e70 2e6e 616e 0a0a    pos_x=np.nan..
+000257a0: 2020 2020 2020 2020 2020 2020 2370 726f              #pro
+000257b0: 6d69 6e65 6e63 655f 6361 6c63 203d 2070  minence_calc = p
+000257c0: 6561 6b5f 7072 6f6d 696e 656e 6365 2878  eak_prominence(x
+000257d0: 5f74 7269 6d2c 2079 5f74 7269 6d2c 2078  _trim, y_trim, x
+000257e0: 706f 7329 0a0a 2020 2020 2020 2020 2020  pos)..          
+000257f0: 2020 795f 6564 6765 313d 6e70 2e6d 6564    y_edge1=np.med
+00025800: 6961 6e28 795f 7472 696d 5b30 3a33 5d29  ian(y_trim[0:3])
+00025810: 0a20 2020 2020 2020 2020 2020 2079 5f65  .            y_e
+00025820: 6467 6532 3d6e 702e 6d65 6469 616e 2879  dge2=np.median(y
+00025830: 5f74 7269 6d5b 2d33 3a5d 290a 2020 2020  _trim[-3:]).    
+00025840: 2020 2020 2020 2020 2370 7269 6e74 2879          #print(y
+00025850: 5f65 6467 6532 290a 2020 2020 2020 2020  _edge2).        
+00025860: 2020 2020 7072 6f6d 696e 656e 6365 5f63      prominence_c
+00025870: 616c 633d 6d61 7879 2d28 795f 6564 6765  alc=maxy-(y_edge
+00025880: 312b 795f 6564 6765 3229 2f32 0a20 2020  1+y_edge2)/2.   
+00025890: 2020 2020 2020 2020 2070 6561 6b5f 7072           peak_pr
+000258a0: 6f6d 5f73 6176 6564 5b69 5d3d 7072 6f6d  om_saved[i]=prom
+000258b0: 696e 656e 6365 5f63 616c 630a 0a0a 0a20  inence_calc.... 
+000258c0: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
+000258d0: 6f6d 696e 656e 6365 5f63 616c 633e 7072  ominence_calc>pr
+000258e0: 6f6d 696e 656e 6365 3a0a 2020 2020 2020  ominence:.      
+000258f0: 2020 2020 2020 2020 2020 706f 735f 783d            pos_x=
+00025900: 785f 7472 696d 5b79 5f74 7269 6d3d 3d6d  x_trim[y_trim==m
+00025910: 6178 795d 5b30 5d0a 2020 2020 2020 2020  axy][0].        
+00025920: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00025930: 2020 2020 2020 2020 2020 706f 735f 783d            pos_x=
+00025940: 6e70 2e6e 616e 0a0a 0a0a 0a20 2020 2020  np.nan.....     
+00025950: 2020 2020 2020 2069 6620 706f 735f 783e         if pos_x>
+00025960: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00025970: 2020 2070 6561 6b5f 706f 735f 7361 7665     peak_pos_save
+00025980: 645b 695d 3d70 6f73 5f78 0a20 2020 2020  d[i]=pos_x.     
+00025990: 2020 2020 2020 2020 2020 2070 6561 6b5f             peak_
+000259a0: 6865 6967 6874 5f73 6176 6564 5b69 5d3d  height_saved[i]=
+000259b0: 6d61 7879 0a0a 2020 2020 2020 2020 2020  maxy..          
+000259c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000259d0: 2020 2020 2020 2020 7065 616b 5f70 6f73          peak_pos
+000259e0: 5f73 6176 6564 5b69 5d3d 6e70 2e6e 616e  _saved[i]=np.nan
+000259f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025a00: 2070 6561 6b5f 6865 6967 6874 5f73 6176   peak_height_sav
+00025a10: 6564 5b69 5d3d 6e70 2e6e 616e 0a0a 2020  ed[i]=np.nan..  
+00025a20: 2020 2020 2020 2020 2020 7065 616b 5f62            peak_b
+00025a30: 636b 5b69 5d3d 6e70 2e71 7561 6e74 696c  ck[i]=np.quantil
+00025a40: 6528 795f 706c 6f74 2c20 302e 3229 0a20  e(y_plot, 0.2). 
+00025a50: 2020 2020 2020 2020 2020 2061 765f 793d             av_y=
+00025a60: 6e70 2e71 7561 6e74 696c 6528 795f 706c  np.quantile(y_pl
+00025a70: 6f74 2c20 302e 3529 0a20 2020 2020 2020  ot, 0.5).       
+00025a80: 2020 2020 2044 6966 663d 6e70 2e6d 6178       Diff=np.max
+00025a90: 2879 5f70 6c6f 7429 2d6e 702e 6d69 6e28  (y_plot)-np.min(
+00025aa0: 795f 706c 6f74 290a 2020 2020 2020 2020  y_plot).        
+00025ab0: 2020 2020 595f 7375 6d3d 6e70 2e6d 6178      Y_sum=np.max
+00025ac0: 2879 5f70 6c6f 7429 2f44 6966 660a 2020  (y_plot)/Diff.  
+00025ad0: 2020 2020 2020 2020 2020 2320 4946 2074            # IF t
+00025ae0: 6865 7265 2069 7320 736f 6d65 7468 696e  here is somethin
+00025af0: 6720 7468 6174 2070 6173 7365 7320 7468  g that passes th
+00025b00: 6520 6669 6c74 6572 0a20 2020 2020 2020  e filter.       
+00025b10: 2020 2020 2069 6620 706f 735f 783e 303a       if pos_x>0:
+00025b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025b30: 2079 5f73 7461 725b 695d 3d28 7065 616b   y_star[i]=(peak
+00025b40: 5f68 6569 6768 745f 7361 7665 645b 695d  _height_saved[i]
+00025b50: 2d6e 702e 6d69 6e28 795f 706c 6f74 2929  -np.min(y_plot))
+00025b60: 2f44 6966 662b 690a 2020 2020 2020 2020  /Diff+i.        
+00025b70: 2020 2020 2020 2020 6178 312e 706c 6f74          ax1.plot
+00025b80: 2870 6f73 5f78 2c20 795f 7374 6172 5b69  (pos_x, y_star[i
+00025b90: 5d2c 2027 2a6b 272c 206d 6663 3d27 7965  ], '*k', mfc='ye
+00025ba0: 6c6c 6f77 272c 206d 733d 3130 290a 2020  llow', ms=10).  
+00025bb0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00025bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025bd0: 795f 7374 6172 5b69 5d3d 6e70 2e6e 616e  y_star[i]=np.nan
+00025be0: 0a0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
+00025bf0: 312e 706c 6f74 2878 5f70 6c6f 742c 2028  1.plot(x_plot, (
+00025c00: 2879 5f70 6c6f 742d 6e70 2e6d 696e 2879  (y_plot-np.min(y
+00025c10: 5f70 6c6f 7429 292f 4469 6666 292b 692c  _plot))/Diff)+i,
+00025c20: 2027 2d72 2729 0a20 2020 2020 2020 2020   '-r').         
+00025c30: 2020 2061 7831 2e70 6c6f 7428 785f 706c     ax1.plot(x_pl
+00025c40: 6f74 2c20 2828 795f 706c 6f74 2d6e 702e  ot, ((y_plot-np.
+00025c50: 6d69 6e28 795f 706c 6f74 2929 2f44 6966  min(y_plot))/Dif
+00025c60: 6629 2b69 2c20 272e 6b27 2c20 6d73 3d31  f)+i, '.k', ms=1
+00025c70: 290a 2020 2020 2020 2020 2020 2020 7970  ).            yp
+00025c80: 6c6f 745b 695d 3d6e 702e 6d69 6e28 2828  lot[i]=np.min(((
+00025c90: 795f 706c 6f74 2d6e 702e 6d69 6e28 795f  y_plot-np.min(y_
+00025ca0: 706c 6f74 2929 2f44 6966 6629 2b69 290a  plot))/Diff)+i).
+00025cb0: 2020 2020 2020 2020 2020 2020 6178 312e              ax1.
+00025cc0: 616e 6e6f 7461 7465 2873 7472 2866 696c  annotate(str(fil
+00025cd0: 6529 2c20 7879 3d28 786c 696d 5f70 6c6f  e), xy=(xlim_plo
+00025ce0: 745b 315d 2b30 2e35 2c20 7970 6c6f 745b  t[1]+0.5, yplot[
+00025cf0: 695d 292c 0a20 2020 2020 2020 2020 2020  i]),.           
+00025d00: 2020 2020 2020 2020 2020 2020 2020 7879                xy
+00025d10: 636f 6f72 6473 3d22 6461 7461 222c 2066  coords="data", f
+00025d20: 6f6e 7473 697a 653d 3829 0a20 2020 2020  ontsize=8).     
+00025d30: 2020 2020 2020 2059 3d59 2b59 5f73 756d         Y=Y+Y_sum
+00025d40: 0a20 2020 2020 2020 2020 2020 2069 3d69  .            i=i
+00025d50: 2b31 0a0a 2020 2020 2020 2020 656c 6966  +1..        elif
+00025d60: 206a 7573 745f 706c 6f74 2069 7320 5472   just_plot is Tr
+00025d70: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+00025d80: 4469 6666 3d6e 702e 6d61 7828 795f 706c  Diff=np.max(y_pl
+00025d90: 6f74 292d 6e70 2e6d 696e 2879 5f70 6c6f  ot)-np.min(y_plo
+00025da0: 7429 0a20 2020 2020 2020 2020 2020 2059  t).            Y
+00025db0: 5f73 756d 3d6e 702e 6d61 7828 795f 706c  _sum=np.max(y_pl
+00025dc0: 6f74 292f 4469 6666 0a20 2020 2020 2020  ot)/Diff.       
+00025dd0: 2020 2020 2061 7831 2e70 6c6f 7428 785f       ax1.plot(x_
+00025de0: 706c 6f74 2c20 2828 795f 706c 6f74 2d6e  plot, ((y_plot-n
+00025df0: 702e 6d69 6e28 795f 706c 6f74 2929 2f44  p.min(y_plot))/D
+00025e00: 6966 6629 2b69 2c20 272d 7227 290a 2020  iff)+i, '-r').  
+00025e10: 2020 2020 2020 2020 2020 6178 312e 706c            ax1.pl
+00025e20: 6f74 2878 5f70 6c6f 742c 2028 2879 5f70  ot(x_plot, ((y_p
+00025e30: 6c6f 742d 6e70 2e6d 696e 2879 5f70 6c6f  lot-np.min(y_plo
+00025e40: 7429 292f 4469 6666 292b 692c 2027 2e6b  t))/Diff)+i, '.k
+00025e50: 272c 206d 733d 3129 0a20 2020 2020 2020  ', ms=1).       
+00025e60: 2020 2020 2079 706c 6f74 5b69 5d3d 6e70       yplot[i]=np
+00025e70: 2e6d 696e 2828 2879 5f70 6c6f 742d 6e70  .min(((y_plot-np
+00025e80: 2e6d 696e 2879 5f70 6c6f 7429 292f 4469  .min(y_plot))/Di
+00025e90: 6666 292b 6929 0a20 2020 2020 2020 2020  ff)+i).         
+00025ea0: 2020 2061 7831 2e61 6e6e 6f74 6174 6528     ax1.annotate(
+00025eb0: 7374 7228 6669 6c65 292c 2078 793d 2878  str(file), xy=(x
+00025ec0: 6c69 6d5f 706c 6f74 5b31 5d2b 302e 352c  lim_plot[1]+0.5,
+00025ed0: 2079 706c 6f74 5b69 5d29 2c0a 2020 2020   yplot[i]),.    
+00025ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ef0: 2020 2020 2078 7963 6f6f 7264 733d 2264       xycoords="d
+00025f00: 6174 6122 2c20 666f 6e74 7369 7a65 3d38  ata", fontsize=8
+00025f10: 290a 2020 2020 2020 2020 2020 2020 593d  ).            Y=
+00025f20: 592b 595f 7375 6d0a 2020 2020 2020 2020  Y+Y_sum.        
+00025f30: 2020 2020 693d 692b 310a 0a0a 0a20 2020      i=i+1....   
+00025f40: 2064 665f 7065 616b 733d 7064 2e44 6174   df_peaks=pd.Dat
+00025f50: 6146 7261 6d65 2864 6174 613d 7b27 706f  aFrame(data={'po
+00025f60: 7327 3a20 7065 616b 5f70 6f73 5f73 6176  s': peak_pos_sav
+00025f70: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+00025f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025f90: 2020 2020 2020 2020 2020 2020 2768 6569              'hei
+00025fa0: 6768 7427 3a20 7065 616b 5f68 6569 6768  ght': peak_heigh
+00025fb0: 745f 7361 7665 642c 0a20 2020 2020 2020  t_saved,.       
+00025fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025fe0: 2020 2020 2027 7072 6f6d 273a 2070 6561       'prom': pea
+00025ff0: 6b5f 7072 6f6d 5f73 6176 6564 7d29 0a0a  k_prom_saved})..
+00026000: 2020 2020 2369 6620 7369 676d 615f 6669      #if sigma_fi
+00026010: 6c74 6572 2069 7320 5472 7565 3a0a 2020  lter is True:.  
+00026020: 2020 2020 2020 2361 7831 2e70 6c6f 7428        #ax1.plot(
+00026030: 6466 5f70 6561 6b73 5b27 706f 7327 5d5b  df_peaks['pos'][
+00026040: 795f 7374 6172 3e30 5d2c 2079 5f73 7461  y_star>0], y_sta
+00026050: 725b 795f 7374 6172 3e30 5d2c 2027 2a6b  r[y_star>0], '*k
+00026060: 272c 206d 6663 3d27 7965 6c6c 6f77 272c  ', mfc='yellow',
+00026070: 206d 733d 3130 290a 0a0a 0a0a 0a0a 0a0a   ms=10).........
+00026080: 0a0a 2020 2020 6178 312e 706c 6f74 285b  ..    ax1.plot([
+00026090: 3130 3738 2c20 3130 3738 5d2c 205b 302c  1078, 1078], [0,
+000260a0: 2079 706c 6f74 5b2d 315d 2b32 5d2c 2027   yplot[-1]+2], '
+000260b0: 2d67 272c 206c 773d 312c 206c 6162 656c  -g', lw=1, label
+000260c0: 3d27 4e61 245f 3224 434f 245f 3324 2729  ='Na$_2$CO$_3$')
+000260d0: 0a20 2020 2061 7831 2e70 6c6f 7428 5b31  .    ax1.plot([1
+000260e0: 3038 352c 2031 3038 355d 2c20 5b30 2c20  085, 1085], [0, 
+000260f0: 7970 6c6f 745b 2d31 5d2b 325d 2c20 272d  yplot[-1]+2], '-
+00026100: 272c 2063 6f6c 6f72 3d27 636f 726e 666c  ', color='cornfl
+00026110: 6f77 6572 626c 7565 272c 206c 773d 312c  owerblue', lw=1,
+00026120: 206c 6162 656c 3d27 4361 434f 245f 3324   label='CaCO$_3$
+00026130: 2729 0a0a 2020 2020 6178 312e 706c 6f74  ')..    ax1.plot
+00026140: 285b 3130 3934 2c20 3130 3934 5d2c 205b  ([1094, 1094], [
+00026150: 302c 2079 706c 6f74 5b2d 315d 2b32 5d2c  0, yplot[-1]+2],
+00026160: 2027 2d63 272c 206c 773d 312c 206c 6162   '-c', lw=1, lab
+00026170: 656c 3d27 4d67 434f 245f 3324 2729 0a20  el='MgCO$_3$'). 
+00026180: 2020 2061 7831 2e70 6c6f 7428 5b31 3039     ax1.plot([109
+00026190: 372c 2031 3039 375d 2c20 5b30 2c20 7970  7, 1097], [0, yp
+000261a0: 6c6f 745b 2d31 5d2b 325d 2c20 272d 6227  lot[-1]+2], '-b'
+000261b0: 2c20 6c77 3d31 2c20 6c61 6265 6c3d 2744  , lw=1, label='D
+000261c0: 6f6c 6f6d 6974 6527 290a 2020 2020 6178  olomite').    ax
+000261d0: 312e 706c 6f74 285b 3131 3331 2c20 3131  1.plot([1131, 11
+000261e0: 3331 5d2c 205b 302c 2079 706c 6f74 5b2d  31], [0, yplot[-
+000261f0: 315d 2b32 5d2c 2027 2d27 2c20 636f 6c6f  1]+2], '-', colo
+00026200: 723d 2767 7265 7927 2c20 6c77 3d31 2c20  r='grey', lw=1, 
+00026210: 6c61 6265 6c3d 2743 6153 4f24 5f34 2427  label='CaSO$_4$'
+00026220: 290a 2020 2020 6178 312e 706c 6f74 285b  ).    ax1.plot([
+00026230: 3131 3336 2c20 3131 3336 5d2c 205b 302c  1136, 1136], [0,
+00026240: 2079 706c 6f74 5b2d 315d 2b32 5d2c 2027   yplot[-1]+2], '
+00026250: 2d2d 272c 2063 6f6c 6f72 3d27 726f 7379  --', color='rosy
+00026260: 6272 6f77 6e27 2c20 6c77 3d31 2c20 6c61  brown', lw=1, la
+00026270: 6265 6c3d 274d 6753 4f24 5f34 2427 290a  bel='MgSO$_4$').
+00026280: 2020 2020 6178 312e 706c 6f74 285b 3131      ax1.plot([11
+00026290: 3531 2c20 3131 3531 5d2c 205b 302c 2079  51, 1151], [0, y
+000262a0: 706c 6f74 5b2d 315d 2b32 5d2c 2027 2d6b  plot[-1]+2], '-k
+000262b0: 272c 206c 773d 312c 206c 6162 656c 3d27  ', lw=1, label='
+000262c0: 534f 245f 3224 2729 0a0a 0a20 2020 2061  SO$_2$')...    a
+000262d0: 7831 2e66 696c 6c5f 6265 7477 6565 6e28  x1.fill_between(
+000262e0: 786c 696d 5f70 6561 6b73 2c20 2d30 2e35  xlim_peaks, -0.5
+000262f0: 2c20 7970 6c6f 745b 2d31 5d2b 332c 2063  , yplot[-1]+3, c
+00026300: 6f6c 6f72 3d27 626c 7565 272c 2061 6c70  olor='blue', alp
+00026310: 6861 3d30 2e31 290a 0a0a 2020 2020 6178  ha=0.1)...    ax
+00026320: 312e 6c65 6765 6e64 286e 636f 6c3d 372c  1.legend(ncol=7,
+00026330: 6c6f 633d 2775 7070 6572 2063 656e 7465  loc='upper cente
+00026340: 7227 2c20 666f 6e74 7369 7a65 3d31 302c  r', fontsize=10,
+00026350: 2020 6262 6f78 5f74 6f5f 616e 6368 6f72    bbox_to_anchor
+00026360: 3d5b 302e 352c 2031 2e30 355d 290a 2020  =[0.5, 1.05]).  
+00026370: 2020 6178 312e 7365 745f 796c 696d 285b    ax1.set_ylim([
+00026380: 2d30 2e35 2c20 7970 6c6f 745b 2d31 5d2b  -0.5, yplot[-1]+
+00026390: 335d 290a 2020 2020 6178 312e 7365 745f  3]).    ax1.set_
+000263a0: 786c 696d 285b 786c 696d 5f70 6c6f 745b  xlim([xlim_plot[
+000263b0: 305d 2c20 786c 696d 5f70 6c6f 745b 315d  0], xlim_plot[1]
+000263c0: 2b30 2e35 5d29 0a0a 2020 2020 2320 6466  +0.5])..    # df
+000263d0: 5f70 6561 6b73 3d70 642e 4461 7461 4672  _peaks=pd.DataFr
+000263e0: 616d 6528 6461 7461 3d7b 2766 696c 656e  ame(data={'filen
+000263f0: 616d 6527 3a20 4469 6164 5f46 696c 6573  ame': Diad_Files
+00026400: 2c0a 2020 2020 2320 2020 2020 2020 2020  ,.    #         
+00026410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026420: 2770 6f73 273a 2070 6561 6b5f 706f 735f  'pos': peak_pos_
+00026430: 7361 7665 642c 0a20 2020 2023 2020 2020  saved,.    #    
+00026440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026450: 2020 2020 2020 2020 2027 7072 6f6d 273a           'prom':
+00026460: 2070 6561 6b5f 6865 6967 6874 5f73 6176   peak_height_sav
+00026470: 6564 2d70 6561 6b5f 6263 6b7d 290a 0a0a  ed-peak_bck})...
+00026480: 0a20 2020 2061 7831 2e73 6574 5f78 6c61  .    ax1.set_xla
+00026490: 6265 6c28 2757 6176 656e 756d 6265 7220  bel('Wavenumber 
+000264a0: 2863 6d24 5e7b 2d31 7d24 2927 290a 2020  (cm$^{-1}$)').  
+000264b0: 2020 6178 312e 7365 745f 7974 6963 6b73    ax1.set_yticks
+000264c0: 285b 5d29 0a0a 2020 2020 785f 6461 7461  ([])..    x_data
+000264d0: 3d78 5f74 7269 6d0a 0a20 2020 2064 665f  =x_trim..    df_
+000264e0: 7065 616b 735b 2766 696c 655f 6e61 6d65  peaks['file_name
+000264f0: 7327 5d3d 4469 6164 5f46 696c 6573 0a0a  s']=Diad_Files..
+00026500: 2020 2020 7265 7475 726e 2064 665f 7065      return df_pe
+00026510: 616b 732c 2078 5f64 6174 612c 2079 5f64  aks, x_data, y_d
+00026520: 6174 612c 2066 6967 0a0a 0a23 2320 4469  ata, fig...## Di
+00026530: 6164 2053 6b65 776e 6573 7320 6672 6f6d  ad Skewness from
+00026540: 2044 6556 6974 7265 2065 7420 616c 2e0a   DeVitre et al..
+00026550: 0a69 6d70 6f72 7420 7061 6e64 6173 2061  .import pandas a
+00026560: 7320 7064 0a69 6d70 6f72 7420 6e75 6d70  s pd.import nump
+00026570: 7920 6173 206e 700a 696d 706f 7274 206d  y as np.import m
+00026580: 6174 706c 6f74 6c69 622e 7079 706c 6f74  atplotlib.pyplot
+00026590: 2061 7320 706c 740a 6672 6f6d 2073 6369   as plt.from sci
+000265a0: 7079 2e73 6967 6e61 6c20 696d 706f 7274  py.signal import
+000265b0: 2066 696e 645f 7065 616b 730a 2320 4e65   find_peaks.# Ne
+000265c0: 7720 7468 696e 6773 206e 6565 6465 6420  w things needed 
+000265d0: 6865 7265 0a66 726f 6d20 7363 6970 792e  here.from scipy.
+000265e0: 696e 7465 7270 6f6c 6174 6520 696d 706f  interpolate impo
+000265f0: 7274 2069 6e74 6572 7031 640a 6672 6f6d  rt interp1d.from
+00026600: 2073 6369 7079 2e73 6967 6e61 6c20 696d   scipy.signal im
+00026610: 706f 7274 2066 696e 645f 7065 616b 730a  port find_peaks.
+00026620: 696d 706f 7274 206f 730a 6672 6f6d 206f  import os.from o
+00026630: 7320 696d 706f 7274 206c 6973 7464 6972  s import listdir
+00026640: 0a66 726f 6d20 6f73 2e70 6174 6820 696d  .from os.path im
+00026650: 706f 7274 2069 7366 696c 652c 206a 6f69  port isfile, joi
+00026660: 6e0a 6672 6f6d 2044 6961 6446 6974 2e69  n.from DiadFit.i
+00026670: 6d70 6f72 7469 6e67 5f64 6174 615f 6669  mporting_data_fi
+00026680: 6c65 7320 696d 706f 7274 202a 0a66 726f  les import *.fro
+00026690: 6d20 4469 6164 4669 742e 6469 6164 7320  m DiadFit.diads 
+000266a0: 696d 706f 7274 202a 0a0a 6e70 2e73 6574  import *..np.set
+000266b0: 6572 7220 2869 6e76 616c 6964 3d27 7261  err (invalid='ra
+000266c0: 6973 6527 290a 0a65 6e63 6f64 653d 2249  ise')..encode="I
+000266d0: 534f 2d38 3835 392d 3122 0a0a 0a0a 0a0a  SO-8859-1"......
+000266e0: 0a64 6566 2061 7373 6573 735f 6469 6164  .def assess_diad
+000266f0: 315f 736b 6577 6e65 7373 282a 2c20 2063  1_skewness(*,  c
+00026700: 6f6e 6669 6731 3a20 6469 6164 315f 6669  onfig1: diad1_fi
+00026710: 745f 636f 6e66 6967 3d64 6961 6431 5f66  t_config=diad1_f
+00026720: 6974 5f63 6f6e 6669 6728 292c 2069 6e74  it_config(), int
+00026730: 5f63 7574 5f6f 6666 3d30 2e33 2c20 7061  _cut_off=0.3, pa
+00026740: 7468 3d4e 6f6e 652c 2066 696c 656e 616d  th=None, filenam
+00026750: 653d 4e6f 6e65 2c20 6669 6c65 7479 7065  e=None, filetype
+00026760: 3d4e 6f6e 652c 0a73 6b65 776e 6573 733d  =None,.skewness=
+00026770: 2761 6273 272c 2068 6569 6768 743d 312c  'abs', height=1,
+00026780: 2070 726f 6d69 6e65 6e63 653d 352c 2077   prominence=5, w
+00026790: 6964 7468 3d30 2e35 2c20 706c 6f74 5f66  idth=0.5, plot_f
+000267a0: 6967 7572 653d 5472 7565 2c20 7065 616b  igure=True, peak
+000267b0: 5f66 6974 5f72 6f75 7469 6e65 3d46 616c  _fit_routine=Fal
+000267c0: 7365 2c20 7065 616b 5f70 6f73 3d4e 6f6e  se, peak_pos=Non
+000267d0: 652c 2070 6561 6b5f 6865 6967 6874 3d4e  e, peak_height=N
+000267e0: 6f6e 652c 2064 7069 3d32 3030 2c20 6469  one, dpi=200, di
+000267f0: 6164 5f61 7272 6179 3d4e 6f6e 6529 3a0a  ad_array=None):.
+00026800: 2020 2020 2222 2220 4173 7365 7373 6573      """ Assesses
+00026810: 2053 6b65 776e 6573 7320 6f66 2044 6961   Skewness of Dia
+00026820: 6420 7065 616b 732e 2055 7365 6675 6c20  d peaks. Useful 
+00026830: 666f 7220 6964 656e 7469 6679 696e 6720  for identifying 
+00026840: 6d69 7865 6420 4c20 2b20 5620 7068 6173  mixed L + V phas
+00026850: 6573 0a20 2020 2028 7365 6520 4465 5669  es.    (see DeVi
+00026860: 7472 6520 6574 2061 6c2e 2069 6e20 7265  tre et al. in re
+00026870: 7669 6577 290a 0a0a 2020 2020 5061 7261  view)...    Para
+00026880: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+00026890: 2d2d 2d2d 2d2d 0a20 2020 2063 6f6e 6669  ------.    confi
+000268a0: 6731 3a20 6469 6164 315f 6669 745f 636f  g1: diad1_fit_co
+000268b0: 6e66 6967 2829 2064 6174 6163 6c61 7373  nfig() dataclass
+000268c0: 2e20 496d 706f 7274 2070 6172 616d 6574  . Import paramet
+000268d0: 6572 7320 666f 7220 7468 6973 2066 756e  ers for this fun
+000268e0: 6374 696f 6e20 6172 652e 0a0a 2020 2020  ction are...    
+000268f0: 2020 2020 6c6f 7765 725f 6263 6b5f 6469      lower_bck_di
+00026900: 6164 312c 2075 7070 6572 5f62 636b 5f64  ad1, upper_bck_d
+00026910: 6961 6431 3a20 5b66 6c6f 6174 2c20 666c  iad1: [float, fl
+00026920: 6f61 745d 0a20 2020 2020 2020 2020 2020  oat].           
+00026930: 2062 6163 6b67 726f 756e 6420 706f 7369   background posi
+00026940: 7469 6f6e 2074 6f20 6c65 6674 2061 6e64  tion to left and
+00026950: 2072 6967 6874 206f 6620 6f76 6572 616c   right of overal
+00026960: 2064 6961 6420 7265 6769 6f6e 2028 696e   diad region (in
+00026970: 6320 6469 6164 2b2d 4842 2b2d 4331 3329  c diad+-HB+-C13)
+00026980: 0a0a 2020 2020 2020 2020 4e5f 706f 6c79  ..        N_poly
+00026990: 5f62 636b 5f64 6961 6431 3a20 696e 740a  _bck_diad1: int.
+000269a0: 2020 2020 2020 2020 2020 2020 6465 6772              degr
+000269b0: 6565 206f 6620 706f 6c79 6e6f 6d69 616c  ee of polynomial
+000269c0: 2074 6f20 6669 7420 746f 2074 6865 2062   to fit to the b
+000269d0: 6163 6b67 726f 756e 642e 0a0a 2020 2020  ackground...    
+000269e0: 2020 2020 6578 636c 7564 655f 7261 6e67      exclude_rang
+000269f0: 6531 2c20 6578 636c 7564 655f 7261 6e67  e1, exclude_rang
+00026a00: 6532 3a20 5475 706c 655b 666c 6f61 742c  e2: Tuple[float,
+00026a10: 2066 6c6f 6174 5d0a 2020 2020 2020 2020   float].        
+00026a20: 2020 2020 5261 6e67 6520 746f 2065 7863      Range to exc
+00026a30: 6c75 6465 0a0a 2020 2020 696e 745f 6375  lude..    int_cu
+00026a40: 745f 6f66 663a 2066 6c6f 6174 0a20 2020  t_off: float.   
+00026a50: 2020 2020 2056 616c 7565 206f 6620 696e       Value of in
+00026a60: 7465 6e73 6974 7920 6174 2077 6869 6368  tensity at which
+00026a70: 2074 6f20 6361 6c63 756c 6174 6520 7468   to calculate th
+00026a80: 6520 736b 6577 6e65 7373 2028 652e 672e  e skewness (e.g.
+00026a90: 2030 2e31 3558 2074 6865 2070 6561 6b20   0.15X the peak 
+00026aa0: 6865 6967 6874 292e 0a0a 2020 2020 7061  height)...    pa
+00026ab0: 7468 3a20 7374 720a 2020 2020 2020 2020  th: str.        
+00026ac0: 466f 6c64 6572 2075 7365 7220 7769 7368  Folder user wish
+00026ad0: 6573 2074 6f20 7265 6164 2064 6174 6120  es to read data 
+00026ae0: 6672 6f6d 0a0a 2020 2020 6669 6c65 6e61  from..    filena
+00026af0: 6d65 3a20 7374 720a 2020 2020 2020 2020  me: str.        
+00026b00: 5370 6563 6966 6963 2066 696c 6520 6265  Specific file be
+00026b10: 696e 6720 7265 6164 0a0a 0a20 2020 2066  ing read...    f
+00026b20: 696c 6574 7970 653a 2073 7472 0a20 2020  iletype: str.   
+00026b30: 2020 2020 2049 6465 6e74 6966 6965 7320       Identifies 
+00026b40: 7479 7065 206f 6620 6669 6c65 0a20 2020  type of file.   
+00026b50: 2020 2020 2063 686f 6f73 6520 6672 6f6d       choose from
+00026b60: 2027 5769 7465 635f 4153 4349 4927 2c20   'Witec_ASCII', 
+00026b70: 2768 6561 646c 6573 735f 7478 7427 2c20  'headless_txt', 
+00026b80: 2768 6561 646c 6573 735f 6373 7627 2c20  'headless_csv', 
+00026b90: 2768 6561 645f 6373 7627 2c20 2757 6974  'head_csv', 'Wit
+00026ba0: 6563 5f41 5343 4949 272c 0a20 2020 2020  ec_ASCII',.     
+00026bb0: 2020 2027 484f 5249 4241 5f74 7874 272c     'HORIBA_txt',
+00026bc0: 2027 5265 6e69 7368 6177 5f74 7874 270a   'Renishaw_txt'.
+00026bd0: 0a20 2020 2073 6b65 776e 6573 733a 2027  .    skewness: '
+00026be0: 6162 7327 206f 7220 2764 6972 270a 2020  abs' or 'dir'.  
+00026bf0: 2020 2020 2020 4966 2027 6162 7327 2c20        If 'abs', 
+00026c00: 6769 7665 7320 6162 736f 6c75 7465 2073  gives absolute s
+00026c10: 6b65 776e 6573 7320 2865 2e67 2e2c 206c  kewness (e.g., l
+00026c20: 6172 6765 7374 2070 6f73 7369 626c 6520  argest possible 
+00026c30: 6e75 6d62 6572 2072 6567 6172 646c 6573  number regardles
+00026c40: 7320 6f66 2064 6972 6563 7469 6f6e 290a  s of direction).
+00026c50: 2020 2020 2020 2020 6966 2027 6469 7227          if 'dir'
+00026c60: 2064 6f65 7320 736b 6577 6e65 7373 2061   does skewness a
+00026c70: 7320 6f6e 6520 7369 6465 206f 7665 7220  s one side over 
+00026c80: 7468 6520 6f74 6865 720a 0a0a 2020 2020  the other...    
+00026c90: 6865 6967 6874 2c20 7072 6f6d 696e 656e  height, prominen
+00026ca0: 6365 2c20 7769 6474 683a 2066 6c6f 6174  ce, width: float
+00026cb0: 0a20 2020 2020 2020 2053 6369 7079 2066  .        Scipy f
+00026cc0: 696e 6420 7065 616b 2070 6172 616d 6574  ind peak paramet
+00026cd0: 6572 730a 0a20 2020 2070 6c6f 745f 6669  ers..    plot_fi
+00026ce0: 6775 7265 3a20 626f 6f6c 0a20 2020 2020  gure: bool.     
+00026cf0: 2020 2069 6620 5472 7565 2c20 706c 6f74     if True, plot
+00026d00: 7320 616e 6420 7361 7665 7320 6120 6669  s and saves a fi
+00026d10: 6775 7265 2e0a 0a20 2020 2064 7069 3a20  gure...    dpi: 
+00026d20: 696e 740a 2020 2020 2020 2020 6470 6920  int.        dpi 
+00026d30: 746f 2073 6176 6520 696d 6167 6520 6174  to save image at
+00026d40: 0a0a 2020 2020 7065 616b 5f66 6974 5f72  ..    peak_fit_r
+00026d50: 6f75 7469 6e65 3a20 626f 6f6c 2028 6465  outine: bool (de
+00026d60: 6661 756c 7420 4661 6c73 6529 202d 0a20  fault False) -. 
+00026d70: 2020 2020 2020 2069 6620 5472 7565 2c20         if True, 
+00026d80: 646f 6573 6e74 2066 696e 6420 6d61 7820  doesnt find max 
+00026d90: 6f66 2073 706c 696e 652c 2062 7574 2075  of spline, but u
+00026da0: 7365 7320 7468 6520 7065 616b 2070 6f73  ses the peak pos
+00026db0: 6974 696f 6e20 796f 7520 6861 7665 2066  ition you have f
+00026dc0: 6f75 6e64 2066 726f 6d20 7468 6520 6469  ound from the di
+00026dd0: 6164 2066 6974 7469 6e67 2066 756e 6374  ad fitting funct
+00026de0: 696f 6e73 2e0a 2020 2020 2020 2020 416c  ions..        Al
+00026df0: 736f 206e 6565 6473 2070 6561 6b5f 706f  so needs peak_po
+00026e00: 7320 2870 6561 6b20 6365 6e74 6572 2069  s (peak center i
+00026e10: 6e20 636d 2d31 2920 616e 6420 7065 616b  n cm-1) and peak
+00026e20: 5f68 6569 6768 740a 0a0a 2020 2020 5265  _height...    Re
+00026e30: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00026e40: 2d2d 2d2d 2d0a 2020 2020 7064 2e44 6174  -----.    pd.Dat
+00026e50: 6146 7261 6d65 2077 6974 6820 696e 666f  aFrame with info
+00026e60: 726d 6174 696f 6e20 6162 6f75 7420 6669  rmation about fi
+00026e70: 6c65 2061 6e64 2073 6b65 776e 6573 7320  le and skewness 
+00026e80: 7061 7261 6d65 7465 7273 2e0a 0a20 2020  parameters...   
+00026e90: 2022 2222 0a0a 0a0a 2020 2020 795f 636f   """....    y_co
+00026ea0: 7272 5f64 6961 6431 2c20 5079 5f62 6173  rr_diad1, Py_bas
+00026eb0: 655f 6469 6164 312c 2078 5f64 6961 6431  e_diad1, x_diad1
+00026ec0: 2c20 2044 6961 645f 7368 6f72 742c 2050  ,  Diad_short, P
+00026ed0: 795f 6261 7365 5f64 6961 6431 2c20 5066  y_base_diad1, Pf
+00026ee0: 5f62 6173 656c 696e 652c 2020 4261 7365  _baseline,  Base
+00026ef0: 6c69 6e65 5f79 7375 625f 6469 6164 312c  line_ysub_diad1,
+00026f00: 2042 6173 656c 696e 655f 785f 6469 6164   Baseline_x_diad
+00026f10: 312c 2042 6173 656c 696e 652c 2073 7061  1, Baseline, spa
+00026f20: 6e3d 7265 6d6f 7665 5f64 6961 645f 6261  n=remove_diad_ba
+00026f30: 7365 6c69 6e65 280a 2020 2020 7061 7468  seline(.    path
+00026f40: 3d70 6174 682c 2066 696c 656e 616d 653d  =path, filename=
+00026f50: 6669 6c65 6e61 6d65 2c20 6669 6c65 7479  filename, filety
+00026f60: 7065 3d66 696c 6574 7970 652c 204e 5f70  pe=filetype, N_p
+00026f70: 6f6c 793d 636f 6e66 6967 312e 4e5f 706f  oly=config1.N_po
+00026f80: 6c79 5f62 636b 5f64 6961 6431 2c0a 2020  ly_bck_diad1,.  
+00026f90: 2020 6c6f 7765 725f 6263 6b3d 636f 6e66    lower_bck=conf
+00026fa0: 6967 312e 6c6f 7765 725f 6263 6b5f 6469  ig1.lower_bck_di
+00026fb0: 6164 312c 2075 7070 6572 5f62 636b 3d63  ad1, upper_bck=c
+00026fc0: 6f6e 6669 6731 2e75 7070 6572 5f62 636b  onfig1.upper_bck
+00026fd0: 5f64 6961 6431 2c20 706c 6f74 5f66 6967  _diad1, plot_fig
+00026fe0: 7572 653d 4661 6c73 652c 2064 6961 645f  ure=False, diad_
+00026ff0: 6172 7261 793d 6469 6164 5f61 7272 6179  array=diad_array
+00027000: 290a 0a0a 0a20 2020 2078 5f6c 696e 5f62  )....    x_lin_b
+00027010: 6173 656c 696e 653d 6e70 2e6c 696e 7370  aseline=np.linsp
+00027020: 6163 6528 636f 6e66 6967 312e 6c6f 7765  ace(config1.lowe
+00027030: 725f 6263 6b5f 6469 6164 315b 305d 2c20  r_bck_diad1[0], 
+00027040: 636f 6e66 6967 312e 7570 7065 725f 6263  config1.upper_bc
+00027050: 6b5f 6469 6164 315b 315d 2c20 3130 3030  k_diad1[1], 1000
+00027060: 3030 290a 2020 2020 7962 6173 655f 786c  00).    ybase_xl
+00027070: 696e 3d50 665f 6261 7365 6c69 6e65 2878  in=Pf_baseline(x
+00027080: 5f6c 696e 5f62 6173 656c 696e 6529 0a0a  _lin_baseline)..
+00027090: 0a0a 2020 2020 2320 4765 7420 7820 616e  ..    # Get x an
+000270a0: 6420 7920 7265 6164 7920 746f 206d 616b  d y ready to mak
+000270b0: 6520 6120 6375 6269 6320 7370 6c69 6e65  e a cubic spline
+000270c0: 2074 6872 6f75 6768 2064 6174 610a 2020   through data.  
+000270d0: 2020 783d 785f 6469 6164 310a 2020 2020    x=x_diad1.    
+000270e0: 793d 795f 636f 7272 5f64 6961 6431 0a0a  y=y_corr_diad1..
+000270f0: 2020 2020 2320 4669 7420 6120 2063 7562      # Fit a  cub
+00027100: 6963 2073 706c 696e 650a 2020 2020 6632  ic spline.    f2
+00027110: 203d 2069 6e74 6572 7031 6428 782c 2079   = interp1d(x, y
+00027120: 2c20 6b69 6e64 3d27 6375 6269 6327 290a  , kind='cubic').
+00027130: 2020 2020 785f 6e65 773d 6e70 2e6c 696e      x_new=np.lin
+00027140: 7370 6163 6528 6e70 2e6d 696e 2878 292c  space(np.min(x),
+00027150: 206e 702e 6d61 7828 7829 2c20 3130 3030   np.max(x), 1000
+00027160: 3030 290a 0a20 2020 2079 5f63 7562 3d66  00)..    y_cub=f
+00027170: 3228 785f 6e65 7729 0a0a 0a0a 2020 2020  2(x_new)....    
+00027180: 2320 5573 6520 5363 6970 7920 6669 6e64  # Use Scipy find
+00027190: 2070 6561 6b73 2074 6f20 6765 7420 7468   peaks to get th
+000271a0: 6520 6269 6767 6573 7420 7065 616b 0a20  e biggest peak. 
+000271b0: 2020 2069 6620 7065 616b 5f66 6974 5f72     if peak_fit_r
+000271c0: 6f75 7469 6e65 2069 7320 4661 6c73 653a  outine is False:
+000271d0: 0a20 2020 2020 2020 2068 6569 6768 743d  .        height=
+000271e0: 6865 6967 6874 0a20 2020 2020 2020 2070  height.        p
+000271f0: 6561 6b73 203d 2066 696e 645f 7065 616b  eaks = find_peak
+00027200: 7328 795f 6375 622c 2068 6569 6768 743d  s(y_cub, height=
+00027210: 6865 6967 6874 2c20 7072 6f6d 696e 656e  height, prominen
+00027220: 6365 3d70 726f 6d69 6e65 6e63 652c 2077  ce=prominence, w
+00027230: 6964 7468 3d77 6964 7468 290a 2020 2020  idth=width).    
+00027240: 2020 2020 7065 616b 5f68 6569 6768 743d      peak_height=
+00027250: 7065 616b 735b 315d 5b27 7065 616b 5f68  peaks[1]['peak_h
+00027260: 6569 6768 7473 275d 0a20 2020 2020 2020  eights'].       
+00027270: 2070 6561 6b5f 706f 7320 3d20 785f 6e65   peak_pos = x_ne
+00027280: 775b 7065 616b 735b 305d 5d0a 0a0a 2020  w[peaks[0]]...  
+00027290: 2020 2020 2020 2320 6669 6e64 206d 6178        # find max
+000272a0: 2070 6561 6b2e 2020 7075 7420 696e 746f   peak.  put into
+000272b0: 2064 6620 6265 6361 7573 6520 6927 6d20   df because i'm 
+000272c0: 6c61 7a79 0a20 2020 2020 2020 2070 6561  lazy.        pea
+000272d0: 6b5f 6466 3d70 642e 4461 7461 4672 616d  k_df=pd.DataFram
+000272e0: 6528 6461 7461 3d7b 2770 6f73 273a 2070  e(data={'pos': p
+000272f0: 6561 6b5f 706f 732c 0a20 2020 2020 2020  eak_pos,.       
+00027300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027310: 2020 2020 2027 6865 6967 6874 273a 2070       'height': p
+00027320: 6561 6b5f 6865 6967 6874 7d29 0a0a 2020  eak_height})..  
+00027330: 2020 2020 2020 2320 4669 6e64 2062 6967        # Find big
+00027340: 6573 7420 7065 616b 732c 0a20 2020 2020  est peaks,.     
+00027350: 2020 2064 665f 7065 616b 5f73 6f72 743d     df_peak_sort=
+00027360: 7065 616b 5f64 662e 736f 7274 5f76 616c  peak_df.sort_val
+00027370: 7565 7328 2768 6569 6768 7427 2c20 6178  ues('height', ax
+00027380: 6973 3d30 2c20 6173 6365 6e64 696e 673d  is=0, ascending=
+00027390: 4661 6c73 6529 0a20 2020 2020 2020 2064  False).        d
+000273a0: 665f 7065 616b 5f73 6f72 745f 7472 696d  f_peak_sort_trim
+000273b0: 3d64 665f 7065 616b 5f73 6f72 745b 303a  =df_peak_sort[0:
+000273c0: 315d 0a20 2020 2020 2020 2050 6561 6b5f  1].        Peak_
+000273d0: 4365 6e74 6572 3d64 665f 7065 616b 5f73  Center=df_peak_s
+000273e0: 6f72 745f 7472 696d 5b27 706f 7327 5d0a  ort_trim['pos'].
+000273f0: 2020 2020 2020 2020 5065 616b 5f48 6569          Peak_Hei
+00027400: 6768 743d 6466 5f70 6561 6b5f 736f 7274  ght=df_peak_sort
+00027410: 5f74 7269 6d5b 2768 6569 6768 7427 5d0a  _trim['height'].
+00027420: 0a20 2020 2023 206e 6f77 2077 6520 6172  .    # now we ar
+00027430: 6520 7573 696e 6720 7065 616b 2070 6172  e using peak par
+00027440: 616d 6574 6572 7320 7765 2067 6f74 2066  ameters we got f
+00027450: 726f 6d20 566f 6967 742f 5073 6575 646f  rom Voigt/Pseudo
+00027460: 766f 6967 7420 6574 632e 0a20 2020 2069  voigt etc..    i
+00027470: 6620 7065 616b 5f66 6974 5f72 6f75 7469  f peak_fit_routi
+00027480: 6e65 2069 7320 5472 7565 3a0a 2020 2020  ne is True:.    
+00027490: 2020 2020 5065 616b 5f48 6569 6768 743d      Peak_Height=
+000274a0: 7065 616b 5f68 6569 6768 740a 2020 2020  peak_height.    
+000274b0: 2020 2020 5065 616b 5f43 656e 7465 723d      Peak_Center=
+000274c0: 7065 616b 5f70 6f73 0a0a 0a0a 2020 2020  peak_pos....    
+000274d0: 2320 4669 6e64 2069 6e74 656e 7369 7479  # Find intensity
+000274e0: 2063 7574 206f 6666 0a20 2020 2079 5f69   cut off.    y_i
+000274f0: 6e74 5f63 7574 3d50 6561 6b5f 4865 6967  nt_cut=Peak_Heig
+00027500: 6874 2e69 6c6f 635b 305d 2a69 6e74 5f63  ht.iloc[0]*int_c
+00027510: 7574 5f6f 6666 0a0a 2020 2020 2320 5370  ut_off..    # Sp
+00027520: 6c69 7420 7468 6520 6172 7261 7920 696e  lit the array in
+00027530: 746f 2061 204c 4853 2061 6e64 2061 2052  to a LHS and a R
+00027540: 4853 0a0a 2020 2020 4c48 535f 793d 795f  HS..    LHS_y=y_
+00027550: 6375 625b 785f 6e65 773c 3d50 6561 6b5f  cub[x_new<=Peak_
+00027560: 4365 6e74 6572 2e76 616c 7565 735d 0a20  Center.values]. 
+00027570: 2020 2052 4853 5f79 3d79 5f63 7562 5b78     RHS_y=y_cub[x
+00027580: 5f6e 6577 3e50 6561 6b5f 4365 6e74 6572  _new>Peak_Center
+00027590: 2e76 616c 7565 735d 0a0a 2020 2020 4c48  .values]..    LH
+000275a0: 535f 783d 785f 6e65 775b 785f 6e65 773c  S_x=x_new[x_new<
+000275b0: 3d50 6561 6b5f 4365 6e74 6572 2e76 616c  =Peak_Center.val
+000275c0: 7565 735d 0a20 2020 2052 4853 5f78 3d78  ues].    RHS_x=x
+000275d0: 5f6e 6577 5b78 5f6e 6577 3e50 6561 6b5f  _new[x_new>Peak_
+000275e0: 4365 6e74 6572 2e76 616c 7565 735d 0a0a  Center.values]..
+000275f0: 2020 2020 2320 4e65 6564 2074 6f20 666c      # Need to fl
+00027600: 6970 204c 4853 2074 6f20 7075 7420 696e  ip LHS to put in
+00027610: 746f 2074 6865 2066 696e 6420 636c 6f73  to the find clos
+00027620: 6573 7420 6675 6e63 7469 6f6e 0a20 2020  est function.   
+00027630: 204c 4853 5f79 5f66 6c69 703d 6e70 2e66   LHS_y_flip=np.f
+00027640: 6c69 7028 4c48 535f 7929 0a20 2020 204c  lip(LHS_y).    L
+00027650: 4853 5f78 5f66 6c69 703d 6e70 2e66 6c69  HS_x_flip=np.fli
+00027660: 7028 4c48 535f 7829 0a0a 2020 2020 7661  p(LHS_x)..    va
+00027670: 6c3d 6e70 2e61 7267 6d61 7828 4c48 535f  l=np.argmax(LHS_
+00027680: 795f 666c 6970 3c79 5f69 6e74 5f63 7574  y_flip<y_int_cut
+00027690: 290a 0a20 2020 2076 616c 323d 6e70 2e61  )..    val2=np.a
+000276a0: 7267 6d61 7828 5248 535f 793c 795f 696e  rgmax(RHS_y<y_in
+000276b0: 745f 6375 7429 0a0a 0a20 2020 2023 2046  t_cut)...    # F
+000276c0: 696e 6420 6e65 6172 6573 7420 7820 756e  ind nearest x un
+000276d0: 6974 2074 6f20 7468 6973 2076 616c 7565  it to this value
+000276e0: 0a20 2020 2079 5f6e 6561 7265 7374 5f4c  .    y_nearest_L
+000276f0: 4853 3d4c 4853 5f79 5f66 6c69 705b 7661  HS=LHS_y_flip[va
+00027700: 6c5d 0a20 2020 2078 5f6e 6561 7265 7374  l].    x_nearest
+00027710: 5f4c 4853 3d4c 4853 5f78 5f66 6c69 705b  _LHS=LHS_x_flip[
+00027720: 7661 6c5d 0a0a 2020 2020 795f 6e65 6172  val]..    y_near
+00027730: 6573 745f 5248 533d 5248 535f 795b 7661  est_RHS=RHS_y[va
+00027740: 6c32 5d0a 2020 2020 785f 6e65 6172 6573  l2].    x_neares
+00027750: 745f 5248 533d 5248 535f 785b 7661 6c32  t_RHS=RHS_x[val2
+00027760: 5d0a 0a0a 2020 2020 2320 5265 7475 726e  ]...    # Return
+00027770: 2053 6b65 776e 6573 730a 2020 2020 4c48   Skewness.    LH
+00027780: 535f 4365 6e74 6572 3d61 6273 2878 5f6e  S_Center=abs(x_n
+00027790: 6561 7265 7374 5f4c 4853 2d50 6561 6b5f  earest_LHS-Peak_
+000277a0: 4365 6e74 6572 290a 2020 2020 5248 535f  Center).    RHS_
+000277b0: 4365 6e74 6572 3d61 6273 2878 5f6e 6561  Center=abs(x_nea
+000277c0: 7265 7374 5f52 4853 2d50 6561 6b5f 4365  rest_RHS-Peak_Ce
+000277d0: 6e74 6572 290a 0a0a 2020 2023 416c 736f  nter)...   #Also
+000277e0: 2067 6574 206f 7074 696f 6e20 746f 2061   get option to a
+000277f0: 6c77 6179 7320 7461 6b65 2062 6967 6765  lways take bigge
+00027800: 7374 2076 616c 7565 206f 6620 736b 6577  st value of skew
+00027810: 6e65 7373 0a20 2020 2069 6620 736b 6577  ness.    if skew
+00027820: 6e65 7373 3d3d 2761 6273 273a 0a20 2020  ness=='abs':.   
+00027830: 2020 2020 2069 6620 4c48 535f 4365 6e74       if LHS_Cent
+00027840: 6572 2e76 616c 7565 733e 5248 535f 4365  er.values>RHS_Ce
+00027850: 6e74 6572 2e76 616c 7565 733a 0a20 2020  nter.values:.   
+00027860: 2020 2020 2020 2020 2041 533d 4c48 535f           AS=LHS_
+00027870: 4365 6e74 6572 2e76 616c 7565 732f 5248  Center.values/RH
+00027880: 535f 4365 6e74 6572 2e76 616c 7565 730a  S_Center.values.
+00027890: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000278a0: 2020 2020 2020 2020 2020 4153 3d52 4853            AS=RHS
+000278b0: 5f43 656e 7465 722e 7661 6c75 6573 2f4c  _Center.values/L
+000278c0: 4853 5f43 656e 7465 722e 7661 6c75 6573  HS_Center.values
+000278d0: 0a20 2020 2065 6c69 6620 736b 6577 6e65  .    elif skewne
+000278e0: 7373 3d3d 2764 6972 273a 0a20 2020 2020  ss=='dir':.     
+000278f0: 2020 2041 533d 5248 535f 4365 6e74 6572     AS=RHS_Center
+00027900: 2e76 616c 7565 732f 4c48 535f 4365 6e74  .values/LHS_Cent
+00027910: 6572 2e76 616c 7565 730a 0a0a 2020 2020  er.values...    
+00027920: 6966 2070 6c6f 745f 6669 6775 7265 2069  if plot_figure i
+00027930: 7320 5472 7565 3a0a 0a20 2020 2020 2020  s True:..       
+00027940: 2023 204d 616b 6520 7072 6574 7479 2066   # Make pretty f
+00027950: 6967 7572 6520 7368 6f77 696e 6720 6261  igure showing ba
+00027960: 636b 6772 6f75 6e64 2073 7562 7472 6163  ckground subtrac
+00027970: 746f 696e 2072 6f75 7469 6e65 0a20 2020  toin routine.   
+00027980: 2020 2020 2066 6967 2c20 2828 6178 322c       fig, ((ax2,
+00027990: 2061 7831 292c 2028 6178 332c 2061 7834   ax1), (ax3, ax4
+000279a0: 2929 203d 2070 6c74 2e73 7562 706c 6f74  )) = plt.subplot
+000279b0: 7328 322c 2032 2c20 6669 6773 697a 653d  s(2, 2, figsize=
+000279c0: 2831 302c 3130 2929 0a20 2020 2020 2020  (10,10)).       
+000279d0: 2066 6967 2e73 7570 7469 746c 6528 2744   fig.suptitle('D
+000279e0: 6961 6420 3120 536b 6577 6e65 7373 2066  iad 1 Skewness f
+000279f0: 696c 653d 2027 2b20 7374 7228 6669 6c65  ile= '+ str(file
+00027a00: 6e61 6d65 292c 2066 6f6e 7473 697a 653d  name), fontsize=
+00027a10: 3136 2c20 783d 302e 352c 2079 3d31 2e30  16, x=0.5, y=1.0
+00027a20: 290a 0a20 2020 2020 2020 2061 7832 2e73  )..        ax2.s
+00027a30: 6574 5f74 6974 6c65 2827 6129 2053 7065  et_title('a) Spe
+00027a40: 6374 7261 2729 0a20 2020 2020 2020 2061  ctra').        a
+00027a50: 7832 2e70 6c6f 7428 4469 6164 5f73 686f  x2.plot(Diad_sho
+00027a60: 7274 5b3a 2c20 305d 2c20 4469 6164 5f73  rt[:, 0], Diad_s
+00027a70: 686f 7274 5b3a 2c20 315d 2c20 272d 7227  hort[:, 1], '-r'
+00027a80: 2c20 6c61 6265 6c3d 2744 6174 6127 290a  , label='Data').
+00027a90: 2020 2020 2020 2020 6178 322e 7365 745f          ax2.set_
+00027aa0: 786c 696d 285b 636f 6e66 6967 312e 6c6f  xlim([config1.lo
+00027ab0: 7765 725f 6263 6b5f 6469 6164 315b 305d  wer_bck_diad1[0]
+00027ac0: 2b34 302c 2063 6f6e 6669 6731 2e75 7070  +40, config1.upp
+00027ad0: 6572 5f62 636b 5f64 6961 6431 5b31 5d2d  er_bck_diad1[1]-
+00027ae0: 3430 5d29 0a20 2020 2020 2020 2061 7831  40]).        ax1
+00027af0: 2e73 6574 5f74 6974 6c65 2827 6229 2042  .set_title('b) B
+00027b00: 6163 6b67 726f 756e 6420 6669 7427 290a  ackground fit').
+00027b10: 2020 2020 2020 2020 6178 312e 706c 6f74          ax1.plot
+00027b20: 2844 6961 645f 7368 6f72 745b 3a2c 2030  (Diad_short[:, 0
+00027b30: 5d2c 2044 6961 645f 7368 6f72 745b 3a2c  ], Diad_short[:,
+00027b40: 2031 5d2c 2027 2e2d 6327 2c20 6c61 6265   1], '.-c', labe
+00027b50: 6c3d 2744 6174 6127 290a 0a20 2020 2020  l='Data')..     
+00027b60: 2020 2061 7831 2e70 6c6f 7428 4261 7365     ax1.plot(Base
+00027b70: 6c69 6e65 5b3a 2c20 305d 2c20 4261 7365  line[:, 0], Base
+00027b80: 6c69 6e65 5b3a 2c20 315d 2c20 272e 6227  line[:, 1], '.b'
+00027b90: 2c20 6c61 6265 6c3d 2762 636b 2729 0a20  , label='bck'). 
+00027ba0: 2020 2020 2020 2061 7831 2e70 6c6f 7428         ax1.plot(
+00027bb0: 4469 6164 5f73 686f 7274 5b3a 2c20 305d  Diad_short[:, 0]
+00027bc0: 2c20 5079 5f62 6173 655f 6469 6164 312c  , Py_base_diad1,
+00027bd0: 2027 2d6b 272c 206c 6162 656c 3d27 6263   '-k', label='bc
+00027be0: 6b20 6669 7427 290a 2020 2020 2020 2020  k fit').        
+00027bf0: 6178 332e 7365 745f 7469 746c 6528 2763  ax3.set_title('c
+00027c00: 2920 4261 636b 6772 6f75 6e64 2073 7562  ) Background sub
+00027c10: 7472 6163 7465 6427 290a 2020 2020 2020  tracted').      
+00027c20: 2020 6178 332e 706c 6f74 2878 5f64 6961    ax3.plot(x_dia
+00027c30: 6431 2c79 5f63 6f72 725f 6469 6164 312c  d1,y_corr_diad1,
+00027c40: 2027 2d72 272c 206c 6162 656c 3d27 4263   '-r', label='Bc
+00027c50: 6b20 7375 6227 290a 0a20 2020 2023 2041  k sub')..    # A
+00027c60: 6464 7320 6375 6269 6320 696e 7465 7270  dds cubic interp
+00027c70: 6f6c 6f61 7469 6f6e 2066 6f72 2069 6e73  oloation for ins
+00027c80: 7065 6374 696f 6e0a 0a20 2020 2020 2020  pection..       
+00027c90: 2061 7834 2e73 6574 5f74 6974 6c65 2827   ax4.set_title('
+00027ca0: 6429 2043 7562 6963 2053 706c 696e 6527  d) Cubic Spline'
+00027cb0: 290a 0a0a 0a0a 2020 2020 2020 2020 6178  ).....        ax
+00027cc0: 342e 706c 6f74 285b 785f 6e65 6172 6573  4.plot([x_neares
+00027cd0: 745f 4c48 532c 2050 6561 6b5f 4365 6e74  t_LHS, Peak_Cent
+00027ce0: 6572 2e69 6c6f 635b 305d 5d2c 205b 795f  er.iloc[0]], [y_
+00027cf0: 696e 745f 6375 742c 2079 5f69 6e74 5f63  int_cut, y_int_c
+00027d00: 7574 5d2c 2027 2d67 2729 0a0a 2020 2020  ut], '-g')..    
+00027d10: 2020 2020 6178 342e 616e 6e6f 7461 7465      ax4.annotate
+00027d20: 2873 7472 286e 702e 726f 756e 6428 4c48  (str(np.round(LH
+00027d30: 535f 4365 6e74 6572 2e76 616c 7565 735b  S_Center.values[
+00027d40: 305d 2c20 3229 292c 0a20 2020 2020 2020  0], 2)),.       
+00027d50: 2020 2020 2020 2020 2020 2020 2020 7879                xy
+00027d60: 3d28 785f 6e65 6172 6573 745f 4c48 532d  =(x_nearest_LHS-
+00027d70: 332c 2079 5f69 6e74 5f63 7574 2b28 5065  3, y_int_cut+(Pe
+00027d80: 616b 5f48 6569 6768 742d 795f 696e 745f  ak_Height-y_int_
+00027d90: 6375 7429 2f31 3029 2c20 7879 636f 6f72  cut)/10), xycoor
+00027da0: 6473 3d22 6461 7461 222c 0a20 2020 2020  ds="data",.     
+00027db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027dc0: 666f 6e74 7369 7a65 3d31 322c 2063 6f6c  fontsize=12, col
+00027dd0: 6f72 3d27 6772 6565 6e27 290a 2020 2020  or='green').    
+00027de0: 2020 2020 6178 342e 706c 6f74 2878 5f6e      ax4.plot(x_n
+00027df0: 6561 7265 7374 5f4c 4853 2c20 795f 6e65  earest_LHS, y_ne
+00027e00: 6172 6573 745f 4c48 532c 2027 2a6b 272c  arest_LHS, '*k',
+00027e10: 206d 6663 3d27 6772 6565 6e27 2c6d 733d   mfc='green',ms=
+00027e20: 3135 2c20 6c61 6265 6c3d 2752 4820 7469  15, label='RH ti
+00027e30: 6527 290a 0a0a 0a20 2020 2020 2020 2061  e')....        a
+00027e40: 7834 2e70 6c6f 7428 5b50 6561 6b5f 4365  x4.plot([Peak_Ce
+00027e50: 6e74 6572 2e69 6c6f 635b 305d 2c20 785f  nter.iloc[0], x_
+00027e60: 6e65 6172 6573 745f 5248 535d 2c20 5b79  nearest_RHS], [y
+00027e70: 5f69 6e74 5f63 7574 2c20 795f 696e 745f  _int_cut, y_int_
+00027e80: 6375 745d 2c20 272d 272c 2063 6f6c 6f72  cut], '-', color
+00027e90: 3d27 6772 6579 2729 0a20 2020 2020 2020  ='grey').       
+00027ea0: 2061 7834 2e61 6e6e 6f74 6174 6528 7374   ax4.annotate(st
+00027eb0: 7228 6e70 2e72 6f75 6e64 2852 4853 5f43  r(np.round(RHS_C
+00027ec0: 656e 7465 722e 7661 6c75 6573 5b30 5d2c  enter.values[0],
+00027ed0: 2032 2929 2c0a 2020 2020 2020 2020 2020   2)),.          
+00027ee0: 2020 2020 2020 2020 2020 2078 793d 2878             xy=(x
+00027ef0: 5f6e 6561 7265 7374 5f52 4853 2b33 2c20  _nearest_RHS+3, 
+00027f00: 795f 696e 745f 6375 742b 2850 6561 6b5f  y_int_cut+(Peak_
+00027f10: 4865 6967 6874 2e69 6c6f 635b 305d 2d79  Height.iloc[0]-y
+00027f20: 5f69 6e74 5f63 7574 292f 3130 292c 2078  _int_cut)/10), x
+00027f30: 7963 6f6f 7264 733d 2264 6174 6122 2c0a  ycoords="data",.
+00027f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f50: 2020 2020 2020 666f 6e74 7369 7a65 3d31        fontsize=1
+00027f60: 322c 2063 6f6c 6f72 3d27 6772 6579 2729  2, color='grey')
+00027f70: 0a20 2020 2020 2020 2061 7834 2e70 6c6f  .        ax4.plo
+00027f80: 7428 785f 6e65 6172 6573 745f 5248 532c  t(x_nearest_RHS,
+00027f90: 2079 5f6e 6561 7265 7374 5f52 4853 2c20   y_nearest_RHS, 
+00027fa0: 272a 6b27 2c20 6d66 633d 2767 7265 7927  '*k', mfc='grey'
+00027fb0: 2c20 6d73 3d31 352c 206c 6162 656c 3d27  , ms=15, label='
+00027fc0: 4c48 2074 6965 2729 0a0a 0a0a 0a20 2020  LH tie').....   
+00027fd0: 2020 2020 2061 7834 2e70 6c6f 7428 782c       ax4.plot(x,
+00027fe0: 2079 2c20 272e 7227 290a 2020 2020 2020   y, '.r').      
+00027ff0: 2020 6178 342e 706c 6f74 2878 5f6e 6577    ax4.plot(x_new
+00028000: 2c20 795f 6375 622c 2027 2d6b 2729 0a0a  , y_cub, '-k')..
+00028010: 2020 2020 2020 2020 6178 342e 706c 6f74          ax4.plot
+00028020: 285b 5065 616b 5f43 656e 7465 722e 696c  ([Peak_Center.il
+00028030: 6f63 5b30 5d2c 2050 6561 6b5f 4365 6e74  oc[0], Peak_Cent
+00028040: 6572 2e69 6c6f 635b 305d 5d2c 205b 5065  er.iloc[0]], [Pe
+00028050: 616b 5f48 6569 6768 742e 696c 6f63 5b30  ak_Height.iloc[0
+00028060: 5d2c 2050 6561 6b5f 4865 6967 6874 2e69  ], Peak_Height.i
+00028070: 6c6f 635b 305d 5d2c 0a20 2020 2020 2020  loc[0]],.       
+00028080: 2020 2020 2020 272a 6b27 2c20 6d66 633d        '*k', mfc=
+00028090: 2762 6c75 6527 2c20 6d73 3d31 352c 206c  'blue', ms=15, l
+000280a0: 6162 656c 3d27 5363 6970 7920 4365 6e74  abel='Scipy Cent
+000280b0: 6572 2729 0a0a 0a20 2020 2020 2020 2023  er')...        #
+000280c0: 2041 6464 2074 6f20 706c 6f74 0a0a 2020   Add to plot..  
+000280d0: 2020 2020 2020 6178 342e 706c 6f74 2863        ax4.plot(c
+000280e0: 6f6e 6669 6731 2e6c 6f77 6572 5f62 636b  onfig1.lower_bck
+000280f0: 5f64 6961 6431 5b30 5d2c 2063 6f6e 6669  _diad1[0], confi
+00028100: 6731 2e75 7070 6572 5f62 636b 5f64 6961  g1.upper_bck_dia
+00028110: 6431 5b31 5d2c 205b 795f 696e 745f 6375  d1[1], [y_int_cu
+00028120: 742c 2079 5f69 6e74 5f63 7574 5d2c 2027  t, y_int_cut], '
+00028130: 3a72 2729 0a0a 0a0a 0a20 2020 2020 2020  :r').....       
+00028140: 2061 7834 2e73 6574 5f78 6c69 6d28 5b78   ax4.set_xlim([x
+00028150: 5f6e 6561 7265 7374 5f4c 4853 2d31 302c  _nearest_LHS-10,
+00028160: 2078 5f6e 6561 7265 7374 5f52 4853 2b31   x_nearest_RHS+1
+00028170: 305d 290a 2020 2020 2020 2020 6178 342e  0]).        ax4.
+00028180: 7365 745f 796c 696d 285b 302d 3130 2c20  set_ylim([0-10, 
+00028190: 5065 616b 5f48 6569 6768 742e 696c 6f63  Peak_Height.iloc
+000281a0: 5b30 5d2a 312e 325d 290a 2020 2020 2020  [0]*1.2]).      
+000281b0: 2020 6178 342e 706c 6f74 285b 5065 616b    ax4.plot([Peak
+000281c0: 5f43 656e 7465 722e 696c 6f63 5b30 5d2c  _Center.iloc[0],
+000281d0: 2050 6561 6b5f 4365 6e74 6572 2e69 6c6f   Peak_Center.ilo
+000281e0: 635b 305d 5d2c 205b 302c 2050 6561 6b5f  c[0]], [0, Peak_
+000281f0: 4865 6967 6874 2e69 6c6f 635b 305d 5d2c  Height.iloc[0]],
+00028200: 2027 3a62 2729 0a0a 0a0a 2020 2020 2020   ':b')....      
+00028210: 2020 6178 342e 616e 6e6f 7461 7465 2827    ax4.annotate('
+00028220: 536b 6577 6e65 7373 3d27 2b73 7472 286e  Skewness='+str(n
+00028230: 702e 726f 756e 6428 4153 5b30 5d2c 2032  p.round(AS[0], 2
+00028240: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+00028250: 2020 2020 2020 2020 2078 793d 2878 5f6e           xy=(x_n
+00028260: 6561 7265 7374 5f52 4853 2b32 2c20 795f  earest_RHS+2, y_
+00028270: 696e 745f 6375 742b 795f 696e 745f 6375  int_cut+y_int_cu
+00028280: 742b 2850 6561 6b5f 4865 6967 6874 2e69  t+(Peak_Height.i
+00028290: 6c6f 635b 305d 2d79 5f69 6e74 5f63 7574  loc[0]-y_int_cut
+000282a0: 292f 3130 292c 2078 7963 6f6f 7264 733d  )/10), xycoords=
+000282b0: 2264 6174 6122 2c0a 2020 2020 2020 2020  "data",.        
+000282c0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000282d0: 6e74 7369 7a65 3d31 3229 0a0a 2020 2020  ntsize=12)..    
+000282e0: 2020 2020 6178 322e 6c65 6765 6e64 2829      ax2.legend()
+000282f0: 0a20 2020 2020 2020 2061 7831 2e6c 6567  .        ax1.leg
+00028300: 656e 6428 290a 2020 2020 2020 2020 6178  end().        ax
+00028310: 332e 6c65 6765 6e64 2829 0a20 2020 2020  3.legend().     
+00028320: 2020 2061 7834 2e6c 6567 656e 6428 290a     ax4.legend().
+00028330: 2020 2020 2020 2020 6178 312e 7365 745f          ax1.set_
+00028340: 786c 6162 656c 2827 5761 7665 6e75 6d62  xlabel('Wavenumb
+00028350: 6572 2028 636d 245e 7b2d 317d 2429 2729  er (cm$^{-1}$)')
+00028360: 0a20 2020 2020 2020 2061 7832 2e73 6574  .        ax2.set
+00028370: 5f78 6c61 6265 6c28 2757 6176 656e 756d  _xlabel('Wavenum
+00028380: 6265 7220 2863 6d24 5e7b 2d31 7d24 2927  ber (cm$^{-1}$)'
+00028390: 290a 2020 2020 2020 2020 6178 332e 7365  ).        ax3.se
+000283a0: 745f 786c 6162 656c 2827 5761 7665 6e75  t_xlabel('Wavenu
+000283b0: 6d62 6572 2028 636d 245e 7b2d 317d 2429  mber (cm$^{-1}$)
+000283c0: 2729 0a20 2020 2020 2020 2061 7834 2e73  ').        ax4.s
+000283d0: 6574 5f78 6c61 6265 6c28 2757 6176 656e  et_xlabel('Waven
+000283e0: 756d 6265 7220 2863 6d24 5e7b 2d31 7d24  umber (cm$^{-1}$
+000283f0: 2927 290a 2020 2020 2020 2020 6178 312e  )').        ax1.
+00028400: 7365 745f 796c 6162 656c 2827 496e 7465  set_ylabel('Inte
+00028410: 6e73 6974 7927 290a 2020 2020 2020 2020  nsity').        
+00028420: 6178 322e 7365 745f 796c 6162 656c 2827  ax2.set_ylabel('
+00028430: 496e 7465 6e73 6974 7927 290a 2020 2020  Intensity').    
+00028440: 2020 2020 6178 332e 7365 745f 796c 6162      ax3.set_ylab
+00028450: 656c 2827 496e 7465 6e73 6974 7927 290a  el('Intensity').
+00028460: 2020 2020 2020 2020 6178 342e 7365 745f          ax4.set_
+00028470: 796c 6162 656c 2827 496e 7465 6e73 6974  ylabel('Intensit
+00028480: 7927 290a 2020 2020 2020 2020 6669 672e  y').        fig.
+00028490: 7469 6768 745f 6c61 796f 7574 2829 0a0a  tight_layout()..
+000284a0: 0a0a 2020 2020 2020 2020 7061 7468 333d  ..        path3=
+000284b0: 7061 7468 2b27 2f27 2b27 536b 6577 6e65  path+'/'+'Skewne
+000284c0: 7373 5f69 6d61 6765 7327 0a20 2020 2020  ss_images'.     
+000284d0: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
+000284e0: 6973 7473 2870 6174 6833 293a 0a20 2020  ists(path3):.   
+000284f0: 2020 2020 2020 2020 206f 7574 3d27 7061           out='pa
+00028500: 7468 2065 7869 7374 7327 0a20 2020 2020  th exists'.     
+00028510: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00028520: 2020 2020 206f 732e 6d61 6b65 6469 7273       os.makedirs
+00028530: 2870 6174 682b 272f 272b 2027 536b 6577  (path+'/'+ 'Skew
+00028540: 6e65 7373 5f69 6d61 6765 7327 2c20 6578  ness_images', ex
+00028550: 6973 745f 6f6b 3d46 616c 7365 290a 0a0a  ist_ok=False)...
+00028560: 2020 2020 2020 2020 6669 6c65 3d66 696c          file=fil
+00028570: 656e 616d 652e 7273 706c 6974 2827 2e74  ename.rsplit('.t
+00028580: 7874 272c 2031 295b 305d 0a20 2020 2020  xt', 1)[0].     
+00028590: 2020 2066 6967 2e73 6176 6566 6967 2870     fig.savefig(p
+000285a0: 6174 6833 2b27 2f27 2b27 4469 6164 315f  ath3+'/'+'Diad1_
+000285b0: 736b 6577 6e65 7373 5f7b 7d2e 706e 6727  skewness_{}.png'
+000285c0: 2e66 6f72 6d61 7428 6669 6c65 292c 2064  .format(file), d
+000285d0: 7069 3d64 7069 290a 0a20 2020 2064 665f  pi=dpi)..    df_
+000285e0: 6f75 743d 7064 2e44 6174 6146 7261 6d65  out=pd.DataFrame
+000285f0: 2864 6174 613d 7b27 6669 6c65 6e61 6d65  (data={'filename
+00028600: 273a 6669 6c65 6e61 6d65 2c0a 2020 2020  ':filename,.    
+00028610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028620: 2020 2020 2020 2020 2020 2753 6b65 776e            'Skewn
+00028630: 6573 735f 6469 6164 3127 3a20 4153 2c0a  ess_diad1': AS,.
+00028640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028650: 2020 2020 2020 2020 2020 2020 2020 274c                'L
+00028660: 4853 5f74 6965 5f64 6961 6431 273a 2078  HS_tie_diad1': x
+00028670: 5f6e 6561 7265 7374 5f4c 4853 2c0a 2020  _nearest_LHS,.  
+00028680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028690: 2020 2020 2020 2020 2020 2020 2752 4853              'RHS
+000286a0: 5f74 6965 5f64 6961 6431 273a 2078 5f6e  _tie_diad1': x_n
+000286b0: 6561 7265 7374 5f52 4853 7d29 0a0a 2020  earest_RHS})..  
+000286c0: 2020 7265 7475 726e 2064 665f 6f75 740a    return df_out.
+000286d0: 0a0a 0a64 6566 2061 7373 6573 735f 6469  ...def assess_di
+000286e0: 6164 325f 736b 6577 6e65 7373 282a 2c20  ad2_skewness(*, 
+000286f0: 2063 6f6e 6669 6731 3a20 6469 6164 325f   config1: diad2_
+00028700: 6669 745f 636f 6e66 6967 3d64 6961 6431  fit_config=diad1
+00028710: 5f66 6974 5f63 6f6e 6669 6728 292c 2069  _fit_config(), i
+00028720: 6e74 5f63 7574 5f6f 6666 3d30 2e33 2c20  nt_cut_off=0.3, 
+00028730: 7061 7468 3d4e 6f6e 652c 2066 696c 656e  path=None, filen
+00028740: 616d 653d 4e6f 6e65 2c20 6669 6c65 7479  ame=None, filety
+00028750: 7065 3d4e 6f6e 652c 0a73 6b65 776e 6573  pe=None,.skewnes
+00028760: 733d 2761 6273 272c 2068 6569 6768 743d  s='abs', height=
+00028770: 312c 2070 726f 6d69 6e65 6e63 653d 352c  1, prominence=5,
+00028780: 2077 6964 7468 3d30 2e35 2c20 706c 6f74   width=0.5, plot
+00028790: 5f66 6967 7572 653d 5472 7565 2c20 6470  _figure=True, dp
+000287a0: 693d 3230 302c 2070 6561 6b5f 6669 745f  i=200, peak_fit_
+000287b0: 726f 7574 696e 653d 4661 6c73 652c 2070  routine=False, p
+000287c0: 6561 6b5f 706f 733d 4e6f 6e65 2c20 7065  eak_pos=None, pe
+000287d0: 616b 5f68 6569 6768 743d 4e6f 6e65 2c20  ak_height=None, 
+000287e0: 6469 6164 5f61 7272 6179 3d4e 6f6e 6529  diad_array=None)
+000287f0: 3a0a 0a20 2020 2022 2222 2041 7373 6573  :..    """ Asses
+00028800: 7365 7320 536b 6577 6e65 7373 206f 6620  ses Skewness of 
+00028810: 4469 6164 2070 6561 6b73 2e20 5573 6566  Diad peaks. Usef
+00028820: 756c 2066 6f72 2069 6465 6e74 6966 7969  ul for identifyi
+00028830: 6e67 206d 6978 6564 204c 202b 2056 2070  ng mixed L + V p
+00028840: 6861 7365 730a 2020 2020 2873 6565 2044  hases.    (see D
+00028850: 6556 6974 7265 2065 7420 616c 2e20 696e  eVitre et al. in
+00028860: 2072 6576 6965 7729 0a0a 0a20 2020 2050   review)...    P
+00028870: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00028880: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 636f  ---------.    co
+00028890: 6e66 6967 313a 2064 6961 6432 5f66 6974  nfig1: diad2_fit
+000288a0: 5f63 6f6e 6669 6728 2920 6461 7461 636c  _config() datacl
+000288b0: 6173 732e 2049 6d70 6f72 7420 7061 7261  ass. Import para
+000288c0: 6d65 7465 7273 2066 6f72 2074 6869 7320  meters for this 
+000288d0: 6675 6e63 7469 6f6e 2061 7265 2e0a 0a20  function are... 
+000288e0: 2020 2020 2020 206c 6f77 6572 5f62 636b         lower_bck
+000288f0: 5f64 6961 6432 2c20 7570 7065 725f 6263  _diad2, upper_bc
+00028900: 6b5f 6469 6164 323a 205b 666c 6f61 742c  k_diad2: [float,
+00028910: 2066 6c6f 6174 5d0a 2020 2020 2020 2020   float].        
+00028920: 2020 2020 6261 636b 6772 6f75 6e64 2070      background p
+00028930: 6f73 6974 696f 6e20 746f 206c 6566 7420  osition to left 
+00028940: 616e 6420 7269 6768 7420 6f66 206f 7665  and right of ove
+00028950: 7261 6c20 6469 6164 2072 6567 696f 6e20  ral diad region 
+00028960: 2869 6e63 2064 6961 642b 2d48 422b 2d43  (inc diad+-HB+-C
+00028970: 3133 290a 0a20 2020 2020 2020 204e 5f70  13)..        N_p
+00028980: 6f6c 795f 6263 6b5f 6469 6164 313a 2069  oly_bck_diad1: i
+00028990: 6e74 0a20 2020 2020 2020 2020 2020 2064  nt.            d
+000289a0: 6567 7265 6520 6f66 2070 6f6c 796e 6f6d  egree of polynom
+000289b0: 6961 6c20 746f 2066 6974 2074 6f20 7468  ial to fit to th
+000289c0: 6520 6261 636b 6772 6f75 6e64 2e0a 0a20  e background... 
+000289d0: 2020 2020 2020 2065 7863 6c75 6465 5f72         exclude_r
+000289e0: 616e 6765 312c 2065 7863 6c75 6465 5f72  ange1, exclude_r
+000289f0: 616e 6765 323a 2054 7570 6c65 5b66 6c6f  ange2: Tuple[flo
+00028a00: 6174 2c20 666c 6f61 745d 0a20 2020 2020  at, float].     
+00028a10: 2020 2020 2020 2052 616e 6765 2074 6f20         Range to 
+00028a20: 6578 636c 7564 650a 0a20 2020 2069 6e74  exclude..    int
+00028a30: 5f63 7574 5f6f 6666 3a20 666c 6f61 740a  _cut_off: float.
+00028a40: 2020 2020 2020 2020 5661 6c75 6520 6f66          Value of
+00028a50: 2069 6e74 656e 7369 7479 2061 7420 7768   intensity at wh
+00028a60: 6963 6820 746f 2063 616c 6375 6c61 7465  ich to calculate
+00028a70: 2074 6865 2073 6b65 776e 6573 7320 2865   the skewness (e
+00028a80: 2e67 2e20 302e 3135 5820 7468 6520 7065  .g. 0.15X the pe
+00028a90: 616b 2068 6569 6768 7429 2e0a 0a20 2020  ak height)...   
+00028aa0: 2070 6174 683a 2073 7472 0a20 2020 2020   path: str.     
+00028ab0: 2020 2046 6f6c 6465 7220 7573 6572 2077     Folder user w
+00028ac0: 6973 6865 7320 746f 2072 6561 6420 6461  ishes to read da
+00028ad0: 7461 2066 726f 6d0a 0a20 2020 2066 696c  ta from..    fil
+00028ae0: 656e 616d 653a 2073 7472 0a20 2020 2020  ename: str.     
+00028af0: 2020 2053 7065 6369 6669 6320 6669 6c65     Specific file
+00028b00: 2062 6569 6e67 2072 6561 640a 0a0a 2020   being read...  
+00028b10: 2020 6669 6c65 7479 7065 3a20 7374 720a    filetype: str.
+00028b20: 2020 2020 2020 2020 4964 656e 7469 6669          Identifi
+00028b30: 6573 2074 7970 6520 6f66 2066 696c 650a  es type of file.
+00028b40: 2020 2020 2020 2020 6368 6f6f 7365 2066          choose f
+00028b50: 726f 6d20 2757 6974 6563 5f41 5343 4949  rom 'Witec_ASCII
+00028b60: 272c 2027 6865 6164 6c65 7373 5f74 7874  ', 'headless_txt
+00028b70: 272c 2027 6865 6164 6c65 7373 5f63 7376  ', 'headless_csv
+00028b80: 272c 2027 6865 6164 5f63 7376 272c 2027  ', 'head_csv', '
+00028b90: 5769 7465 635f 4153 4349 4927 2c0a 2020  Witec_ASCII',.  
+00028ba0: 2020 2020 2020 2748 4f52 4942 415f 7478        'HORIBA_tx
+00028bb0: 7427 2c20 2752 656e 6973 6861 775f 7478  t', 'Renishaw_tx
+00028bc0: 7427 0a0a 2020 2020 736b 6577 6e65 7373  t'..    skewness
+00028bd0: 3a20 2761 6273 2720 6f72 2027 6469 7227  : 'abs' or 'dir'
+00028be0: 0a20 2020 2020 2020 2049 6620 2761 6273  .        If 'abs
+00028bf0: 272c 2067 6976 6573 2061 6273 6f6c 7574  ', gives absolut
+00028c00: 6520 736b 6577 6e65 7373 2028 652e 672e  e skewness (e.g.
+00028c10: 2c20 6c61 7267 6573 7420 706f 7373 6962  , largest possib
+00028c20: 6c65 206e 756d 6265 7220 7265 6761 7264  le number regard
+00028c30: 6c65 7373 206f 6620 6469 7265 6374 696f  less of directio
+00028c40: 6e29 0a20 2020 2020 2020 2069 6620 2764  n).        if 'd
+00028c50: 6972 2720 646f 6573 2073 6b65 776e 6573  ir' does skewnes
+00028c60: 7320 6173 206f 6e65 2073 6964 6520 6f76  s as one side ov
+00028c70: 6572 2074 6865 206f 7468 6572 0a0a 0a20  er the other... 
+00028c80: 2020 2068 6569 6768 742c 2070 726f 6d69     height, promi
+00028c90: 6e65 6e63 652c 2077 6964 7468 3a20 666c  nence, width: fl
+00028ca0: 6f61 740a 2020 2020 2020 2020 5363 6970  oat.        Scip
+00028cb0: 7920 6669 6e64 2070 6561 6b20 7061 7261  y find peak para
+00028cc0: 6d65 7465 7273 0a0a 2020 2020 706c 6f74  meters..    plot
+00028cd0: 5f66 6967 7572 653a 2062 6f6f 6c0a 2020  _figure: bool.  
+00028ce0: 2020 2020 2020 6966 2054 7275 652c 2070        if True, p
+00028cf0: 6c6f 7473 2061 6e64 2073 6176 6573 2061  lots and saves a
+00028d00: 2066 6967 7572 652e 0a0a 2020 2020 6470   figure...    dp
+00028d10: 693a 2069 6e74 0a20 2020 2020 2020 2064  i: int.        d
+00028d20: 7069 2074 6f20 7361 7665 2069 6d61 6765  pi to save image
+00028d30: 2061 740a 0a20 2020 2070 6561 6b5f 6669   at..    peak_fi
+00028d40: 745f 726f 7574 696e 653a 2062 6f6f 6c20  t_routine: bool 
+00028d50: 2864 6566 6175 6c74 2046 616c 7365 2920  (default False) 
+00028d60: 2d0a 2020 2020 2020 2020 6966 2054 7275  -.        if Tru
+00028d70: 652c 2064 6f65 736e 7420 6669 6e64 206d  e, doesnt find m
+00028d80: 6178 206f 6620 7370 6c69 6e65 2c20 6275  ax of spline, bu
+00028d90: 7420 7573 6573 2074 6865 2070 6561 6b20  t uses the peak 
+00028da0: 706f 7369 7469 6f6e 2079 6f75 2068 6176  position you hav
+00028db0: 6520 666f 756e 6420 6672 6f6d 2074 6865  e found from the
+00028dc0: 2064 6961 6420 6669 7474 696e 6720 6675   diad fitting fu
+00028dd0: 6e63 7469 6f6e 732e 0a20 2020 2020 2020  nctions..       
+00028de0: 2041 6c73 6f20 6e65 6564 7320 7065 616b   Also needs peak
+00028df0: 5f70 6f73 2028 7065 616b 2063 656e 7465  _pos (peak cente
+00028e00: 7220 696e 2063 6d2d 3129 2061 6e64 2070  r in cm-1) and p
+00028e10: 6561 6b5f 6865 6967 6874 0a0a 0a0a 2020  eak_height....  
+00028e20: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+00028e30: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 7064  ---------.    pd
+00028e40: 2e44 6174 6146 7261 6d65 2077 6974 6820  .DataFrame with 
+00028e50: 696e 666f 726d 6174 696f 6e20 6162 6f75  information abou
+00028e60: 7420 6669 6c65 2061 6e64 2073 6b65 776e  t file and skewn
+00028e70: 6573 7320 7061 7261 6d65 7465 7273 2e0a  ess parameters..
+00028e80: 0a20 2020 2022 2222 0a0a 0a23 2046 6972  .    """...# Fir
+00028e90: 7374 2c20 646f 2074 6865 2062 6163 6b67  st, do the backg
+00028ea0: 726f 756e 6420 7375 6274 7261 6374 696f  round subtractio
+00028eb0: 6e0a 2020 2020 795f 636f 7272 5f64 6961  n.    y_corr_dia
+00028ec0: 6432 2c20 5079 5f62 6173 655f 6469 6164  d2, Py_base_diad
+00028ed0: 322c 2078 5f64 6961 6432 2c20 2044 6961  2, x_diad2,  Dia
+00028ee0: 645f 7368 6f72 742c 2050 795f 6261 7365  d_short, Py_base
+00028ef0: 5f64 6961 6432 2c20 5066 5f62 6173 656c  _diad2, Pf_basel
+00028f00: 696e 652c 2020 4261 7365 6c69 6e65 5f79  ine,  Baseline_y
+00028f10: 7375 625f 6469 6164 322c 2042 6173 656c  sub_diad2, Basel
+00028f20: 696e 655f 785f 6469 6164 322c 2042 6173  ine_x_diad2, Bas
+00028f30: 656c 696e 652c 2073 7061 6e3d 7265 6d6f  eline, span=remo
+00028f40: 7665 5f64 6961 645f 6261 7365 6c69 6e65  ve_diad_baseline
+00028f50: 280a 2020 2020 7061 7468 3d70 6174 682c  (.    path=path,
+00028f60: 2066 696c 656e 616d 653d 6669 6c65 6e61   filename=filena
+00028f70: 6d65 2c20 6669 6c65 7479 7065 3d66 696c  me, filetype=fil
+00028f80: 6574 7970 652c 204e 5f70 6f6c 793d 636f  etype, N_poly=co
+00028f90: 6e66 6967 312e 4e5f 706f 6c79 5f62 636b  nfig1.N_poly_bck
+00028fa0: 5f64 6961 6432 2c0a 2020 2020 6c6f 7765  _diad2,.    lowe
+00028fb0: 725f 6263 6b3d 636f 6e66 6967 312e 6c6f  r_bck=config1.lo
+00028fc0: 7765 725f 6263 6b5f 6469 6164 322c 2075  wer_bck_diad2, u
+00028fd0: 7070 6572 5f62 636b 3d63 6f6e 6669 6731  pper_bck=config1
+00028fe0: 2e75 7070 6572 5f62 636b 5f64 6961 6432  .upper_bck_diad2
+00028ff0: 2c20 706c 6f74 5f66 6967 7572 653d 4661  , plot_figure=Fa
+00029000: 6c73 652c 2064 6961 645f 6172 7261 793d  lse, diad_array=
+00029010: 6469 6164 5f61 7272 6179 290a 0a0a 0a20  diad_array).... 
+00029020: 2020 2078 5f6c 696e 5f62 6173 656c 696e     x_lin_baselin
+00029030: 653d 6e70 2e6c 696e 7370 6163 6528 636f  e=np.linspace(co
+00029040: 6e66 6967 312e 6c6f 7765 725f 6263 6b5f  nfig1.lower_bck_
+00029050: 6469 6164 325b 305d 2c20 636f 6e66 6967  diad2[0], config
+00029060: 312e 7570 7065 725f 6263 6b5f 6469 6164  1.upper_bck_diad
+00029070: 325b 315d 2c20 3130 3030 3030 290a 2020  2[1], 100000).  
+00029080: 2020 7962 6173 655f 786c 696e 3d50 665f    ybase_xlin=Pf_
+00029090: 6261 7365 6c69 6e65 2878 5f6c 696e 5f62  baseline(x_lin_b
+000290a0: 6173 656c 696e 6529 0a0a 0a0a 2320 4765  aseline)....# Ge
+000290b0: 7420 7820 616e 6420 7920 666f 7220 6375  t x and y for cu
+000290c0: 6269 6320 7370 6c69 6e65 0a20 2020 2078  bic spline.    x
+000290d0: 3d78 5f64 6961 6432 0a20 2020 2079 3d79  =x_diad2.    y=y
+000290e0: 5f63 6f72 725f 6469 6164 320a 0a23 2046  _corr_diad2..# F
+000290f0: 6974 7320 6120 2063 7562 6963 2073 706c  its a  cubic spl
+00029100: 696e 650a 2020 2020 6632 203d 2069 6e74  ine.    f2 = int
+00029110: 6572 7031 6428 782c 2079 2c20 6b69 6e64  erp1d(x, y, kind
+00029120: 3d27 6375 6269 6327 290a 2020 2020 785f  ='cubic').    x_
+00029130: 6e65 773d 6e70 2e6c 696e 7370 6163 6528  new=np.linspace(
+00029140: 6e70 2e6d 696e 2878 292c 206e 702e 6d61  np.min(x), np.ma
+00029150: 7828 7829 2c20 3130 3030 3030 290a 0a20  x(x), 100000).. 
+00029160: 2020 2079 5f63 7562 3d66 3228 785f 6e65     y_cub=f2(x_ne
+00029170: 7729 0a0a 0a20 2020 2069 6620 7065 616b  w)...    if peak
+00029180: 5f66 6974 5f72 6f75 7469 6e65 2069 7320  _fit_routine is 
+00029190: 4661 6c73 653a 0a23 2055 7365 2053 6369  False:.# Use Sci
+000291a0: 7079 2066 696e 6420 7065 616b 7320 746f  py find peaks to
+000291b0: 2067 6574 2074 6861 7420 6375 6269 6320   get that cubic 
+000291c0: 7065 616b 0a20 2020 2020 2020 2070 6561  peak.        pea
+000291d0: 6b73 203d 2066 696e 645f 7065 616b 7328  ks = find_peaks(
+000291e0: 795f 6375 622c 2068 6569 6768 743d 6865  y_cub, height=he
+000291f0: 6967 6874 2c20 7072 6f6d 696e 656e 6365  ight, prominence
+00029200: 3d70 726f 6d69 6e65 6e63 652c 2077 6964  =prominence, wid
+00029210: 7468 3d77 6964 7468 290a 2020 2020 2020  th=width).      
+00029220: 2020 7065 616b 5f68 6569 6768 743d 7065    peak_height=pe
+00029230: 616b 735b 315d 5b27 7065 616b 5f68 6569  aks[1]['peak_hei
+00029240: 6768 7473 275d 0a20 2020 2020 2020 2070  ghts'].        p
+00029250: 6561 6b5f 706f 7320 3d20 785f 6e65 775b  eak_pos = x_new[
+00029260: 7065 616b 735b 305d 5d0a 0a20 2020 2020  peaks[0]]..     
+00029270: 2020 2023 2066 696e 6420 6d61 7820 7065     # find max pe
+00029280: 616b 2e20 2070 7574 2069 6e74 6f20 6466  ak.  put into df
+00029290: 2062 6563 6175 7365 2069 276d 206c 617a   because i'm laz
+000292a0: 790a 2020 2020 2020 2020 7065 616b 5f64  y.        peak_d
+000292b0: 663d 7064 2e44 6174 6146 7261 6d65 2864  f=pd.DataFrame(d
+000292c0: 6174 613d 7b27 706f 7327 3a20 7065 616b  ata={'pos': peak
+000292d0: 5f70 6f73 2c0a 2020 2020 2020 2020 2020  _pos,.          
+000292e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000292f0: 2020 2768 6569 6768 7427 3a20 7065 616b    'height': peak
+00029300: 5f68 6569 6768 747d 290a 0a20 2020 2020  _height})..     
+00029310: 2020 2064 665f 7065 616b 5f73 6f72 743d     df_peak_sort=
+00029320: 7065 616b 5f64 662e 736f 7274 5f76 616c  peak_df.sort_val
+00029330: 7565 7328 2768 6569 6768 7427 2c20 6178  ues('height', ax
+00029340: 6973 3d30 2c20 6173 6365 6e64 696e 673d  is=0, ascending=
+00029350: 4661 6c73 6529 0a20 2020 2020 2020 2064  False).        d
+00029360: 665f 7065 616b 5f73 6f72 745f 7472 696d  f_peak_sort_trim
+00029370: 3d64 665f 7065 616b 5f73 6f72 745b 303a  =df_peak_sort[0:
+00029380: 315d 0a20 2020 2020 2020 2050 6561 6b5f  1].        Peak_
+00029390: 4365 6e74 6572 3d64 665f 7065 616b 5f73  Center=df_peak_s
+000293a0: 6f72 745f 7472 696d 5b27 706f 7327 5d2e  ort_trim['pos'].
+000293b0: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
+000293c0: 5065 616b 5f48 6569 6768 743d 6466 5f70  Peak_Height=df_p
+000293d0: 6561 6b5f 736f 7274 5f74 7269 6d5b 2768  eak_sort_trim['h
+000293e0: 6569 6768 7427 5d2e 696c 6f63 5b30 5d0a  eight'].iloc[0].
+000293f0: 0a20 2020 2069 6620 7065 616b 5f66 6974  .    if peak_fit
+00029400: 5f72 6f75 7469 6e65 2069 7320 5472 7565  _routine is True
+00029410: 3a0a 2020 2020 2020 2020 5065 616b 5f48  :.        Peak_H
+00029420: 6569 6768 743d 7065 616b 5f68 6569 6768  eight=peak_heigh
+00029430: 745b 305d 0a20 2020 2020 2020 2050 6561  t[0].        Pea
+00029440: 6b5f 4365 6e74 6572 3d70 6561 6b5f 706f  k_Center=peak_po
+00029450: 735b 305d 0a0a 0a0a 0a23 2046 696e 6420  s[0].....# Find 
+00029460: 696e 7465 6e73 6974 7920 6375 7420 6f66  intensity cut of
+00029470: 660a 2020 2020 795f 696e 745f 6375 743d  f.    y_int_cut=
+00029480: 5065 616b 5f48 6569 6768 742a 696e 745f  Peak_Height*int_
+00029490: 6375 745f 6f66 660a 0a20 2020 2023 2053  cut_off..    # S
+000294a0: 706c 6974 2074 6865 2061 7272 6179 2069  plit the array i
+000294b0: 6e74 6f20 6120 4c48 5320 616e 6420 6120  nto a LHS and a 
+000294c0: 5248 530a 2020 2020 4c48 535f 793d 795f  RHS.    LHS_y=y_
+000294d0: 6375 625b 785f 6e65 773c 3d50 6561 6b5f  cub[x_new<=Peak_
+000294e0: 4365 6e74 6572 5d0a 2020 2020 5248 535f  Center].    RHS_
+000294f0: 793d 795f 6375 625b 785f 6e65 773e 5065  y=y_cub[x_new>Pe
+00029500: 616b 5f43 656e 7465 725d 0a0a 2020 2020  ak_Center]..    
+00029510: 4c48 535f 783d 785f 6e65 775b 785f 6e65  LHS_x=x_new[x_ne
+00029520: 773c 3d50 6561 6b5f 4365 6e74 6572 5d0a  w<=Peak_Center].
+00029530: 2020 2020 5248 535f 783d 785f 6e65 775b      RHS_x=x_new[
+00029540: 785f 6e65 773e 5065 616b 5f43 656e 7465  x_new>Peak_Cente
+00029550: 725d 0a0a 2020 2020 2320 4e65 6564 2074  r]..    # Need t
+00029560: 6f20 666c 6970 204c 4853 2074 6f20 7075  o flip LHS to pu
+00029570: 7420 696e 746f 2074 6865 2066 696e 6420  t into the find 
+00029580: 636c 6f73 6573 7420 6675 6e63 7469 6f6e  closest function
+00029590: 0a20 2020 204c 4853 5f79 5f66 6c69 703d  .    LHS_y_flip=
+000295a0: 6e70 2e66 6c69 7028 4c48 535f 7929 0a20  np.flip(LHS_y). 
+000295b0: 2020 204c 4853 5f78 5f66 6c69 703d 6e70     LHS_x_flip=np
+000295c0: 2e66 6c69 7028 4c48 535f 7829 0a0a 2020  .flip(LHS_x)..  
+000295d0: 2020 7661 6c3d 6e70 2e61 7267 6d61 7828    val=np.argmax(
+000295e0: 4c48 535f 795f 666c 6970 3c79 5f69 6e74  LHS_y_flip<y_int
+000295f0: 5f63 7574 290a 0a20 2020 2076 616c 323d  _cut)..    val2=
+00029600: 6e70 2e61 7267 6d61 7828 5248 535f 793c  np.argmax(RHS_y<
+00029610: 795f 696e 745f 6375 7429 0a0a 0a20 2020  y_int_cut)...   
+00029620: 2023 2046 696e 6420 6e65 6172 6573 7420   # Find nearest 
+00029630: 7820 756e 6974 2074 6f20 7468 6973 2076  x unit to this v
+00029640: 616c 7565 0a20 2020 2079 5f6e 6561 7265  alue.    y_neare
+00029650: 7374 5f4c 4853 3d4c 4853 5f79 5f66 6c69  st_LHS=LHS_y_fli
+00029660: 705b 7661 6c5d 0a20 2020 2078 5f6e 6561  p[val].    x_nea
+00029670: 7265 7374 5f4c 4853 3d4c 4853 5f78 5f66  rest_LHS=LHS_x_f
+00029680: 6c69 705b 7661 6c5d 0a0a 2020 2020 795f  lip[val]..    y_
+00029690: 6e65 6172 6573 745f 5248 533d 5248 535f  nearest_RHS=RHS_
+000296a0: 795b 7661 6c32 5d0a 2020 2020 785f 6e65  y[val2].    x_ne
+000296b0: 6172 6573 745f 5248 533d 5248 535f 785b  arest_RHS=RHS_x[
+000296c0: 7661 6c32 5d0a 0a20 2020 2023 2052 6574  val2]..    # Ret
+000296d0: 7572 6e20 536b 6577 6e65 7373 0a20 2020  urn Skewness.   
+000296e0: 204c 4853 5f43 656e 7465 723d 6162 7328   LHS_Center=abs(
+000296f0: 785f 6e65 6172 6573 745f 4c48 532d 5065  x_nearest_LHS-Pe
+00029700: 616b 5f43 656e 7465 7229 0a20 2020 2052  ak_Center).    R
+00029710: 4853 5f43 656e 7465 723d 6162 7328 785f  HS_Center=abs(x_
+00029720: 6e65 6172 6573 745f 5248 532d 5065 616b  nearest_RHS-Peak
+00029730: 5f43 656e 7465 7229 0a0a 2020 2020 2341  _Center)..    #A
+00029740: 6464 6564 2063 6f6e 6469 7469 6f6e 616c  dded conditional
+00029750: 2074 6f20 616c 7761 7973 2068 6176 6520   to always have 
+00029760: 6120 7261 7469 6f20 6f66 2074 6865 2068  a ratio of the h
+00029770: 6967 682f 6c6f 770a 2020 2020 6966 2073  igh/low.    if s
+00029780: 6b65 776e 6573 733d 3d27 6162 7327 3a0a  kewness=='abs':.
+00029790: 2020 2020 2020 2020 6966 204c 4853 5f43          if LHS_C
+000297a0: 656e 7465 723e 5248 535f 4365 6e74 6572  enter>RHS_Center
+000297b0: 3a0a 2020 2020 2020 2020 2020 2020 4153  :.            AS
+000297c0: 3d4c 4853 5f43 656e 7465 722f 5248 535f  =LHS_Center/RHS_
+000297d0: 4365 6e74 6572 0a20 2020 2020 2020 2065  Center.        e
+000297e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000297f0: 2041 533d 5248 535f 4365 6e74 6572 2f4c   AS=RHS_Center/L
+00029800: 4853 5f43 656e 7465 720a 2020 2020 656c  HS_Center.    el
+00029810: 6966 2073 6b65 776e 6573 733d 3d27 6469  if skewness=='di
+00029820: 7227 3a0a 2020 2020 2020 2020 4153 3d52  r':.        AS=R
+00029830: 4853 5f43 656e 7465 722f 4c48 535f 4365  HS_Center/LHS_Ce
+00029840: 6e74 6572 0a0a 0a20 2020 2069 6620 706c  nter...    if pl
+00029850: 6f74 5f66 6967 7572 6520 6973 2054 7275  ot_figure is Tru
+00029860: 653a 0a0a 2020 2020 2020 2020 2320 4d61  e:..        # Ma
+00029870: 6b65 2070 7265 7474 7920 6669 6775 7265  ke pretty figure
+00029880: 2073 686f 7769 6e67 2062 6163 6b67 726f   showing backgro
+00029890: 756e 6420 7375 6274 7261 6374 6f69 6e20  und subtractoin 
+000298a0: 726f 7574 696e 650a 2020 2020 2020 2020  routine.        
+000298b0: 6669 672c 2028 2861 7832 2c20 6178 3129  fig, ((ax2, ax1)
+000298c0: 2c20 2861 7833 2c20 6178 3429 2920 3d20  , (ax3, ax4)) = 
+000298d0: 706c 742e 7375 6270 6c6f 7473 2832 2c20  plt.subplots(2, 
+000298e0: 322c 2066 6967 7369 7a65 3d28 3130 2c31  2, figsize=(10,1
+000298f0: 3029 290a 2020 2020 2020 2020 6669 672e  0)).        fig.
+00029900: 7375 7074 6974 6c65 2827 4469 6164 2032  suptitle('Diad 2
+00029910: 2053 6b65 776e 6573 7320 6669 6c65 3d20   Skewness file= 
+00029920: 272b 2073 7472 2866 696c 656e 616d 6529  '+ str(filename)
+00029930: 2c20 666f 6e74 7369 7a65 3d31 362c 2078  , fontsize=16, x
+00029940: 3d30 2e35 2c20 793d 312e 3029 0a0a 2020  =0.5, y=1.0)..  
+00029950: 2020 2020 2020 6178 322e 7365 745f 7469        ax2.set_ti
+00029960: 746c 6528 2761 2920 5370 6563 7472 6127  tle('a) Spectra'
+00029970: 290a 2020 2020 2020 2020 6178 322e 706c  ).        ax2.pl
+00029980: 6f74 2844 6961 645f 7368 6f72 745b 3a2c  ot(Diad_short[:,
+00029990: 2030 5d2c 2044 6961 645f 7368 6f72 745b   0], Diad_short[
+000299a0: 3a2c 2031 5d2c 2027 2d72 272c 206c 6162  :, 1], '-r', lab
+000299b0: 656c 3d27 4461 7461 2729 0a20 2020 2020  el='Data').     
+000299c0: 2020 2061 7832 2e73 6574 5f78 6c69 6d28     ax2.set_xlim(
+000299d0: 5b63 6f6e 6669 6731 2e6c 6f77 6572 5f62  [config1.lower_b
+000299e0: 636b 5f64 6961 6432 5b30 5d2b 3430 2c20  ck_diad2[0]+40, 
+000299f0: 636f 6e66 6967 312e 7570 7065 725f 6263  config1.upper_bc
+00029a00: 6b5f 6469 6164 325b 315d 2d34 305d 290a  k_diad2[1]-40]).
+00029a10: 2020 2020 2020 2020 6178 312e 7365 745f          ax1.set_
+00029a20: 7469 746c 6528 2762 2920 4261 636b 6772  title('b) Backgr
+00029a30: 6f75 6e64 2066 6974 2729 0a20 2020 2020  ound fit').     
+00029a40: 2020 2061 7831 2e70 6c6f 7428 4469 6164     ax1.plot(Diad
+00029a50: 5f73 686f 7274 5b3a 2c20 305d 2c20 4469  _short[:, 0], Di
+00029a60: 6164 5f73 686f 7274 5b3a 2c20 315d 2c20  ad_short[:, 1], 
+00029a70: 272e 2d72 272c 206c 6162 656c 3d27 4461  '.-r', label='Da
+00029a80: 7461 2729 0a0a 2020 2020 2020 2020 6178  ta')..        ax
+00029a90: 312e 706c 6f74 2842 6173 656c 696e 655b  1.plot(Baseline[
+00029aa0: 3a2c 2030 5d2c 2042 6173 656c 696e 655b  :, 0], Baseline[
+00029ab0: 3a2c 2031 5d2c 2027 2e62 272c 206c 6162  :, 1], '.b', lab
+00029ac0: 656c 3d27 6263 6b27 290a 2020 2020 2020  el='bck').      
+00029ad0: 2020 6178 312e 706c 6f74 2844 6961 645f    ax1.plot(Diad_
+00029ae0: 7368 6f72 745b 3a2c 2030 5d2c 2050 795f  short[:, 0], Py_
+00029af0: 6261 7365 5f64 6961 6432 2c20 272d 6b27  base_diad2, '-k'
+00029b00: 2c20 6c61 6265 6c3d 2762 636b 2066 6974  , label='bck fit
+00029b10: 2729 0a20 2020 2020 2020 2061 7833 2e73  ').        ax3.s
+00029b20: 6574 5f74 6974 6c65 2827 6329 2042 6163  et_title('c) Bac
+00029b30: 6b67 726f 756e 6420 7375 6274 7261 6374  kground subtract
+00029b40: 6564 2729 0a20 2020 2020 2020 2061 7833  ed').        ax3
+00029b50: 2e70 6c6f 7428 2078 5f64 6961 6432 2c79  .plot( x_diad2,y
+00029b60: 5f63 6f72 725f 6469 6164 322c 2027 2d72  _corr_diad2, '-r
+00029b70: 272c 206c 6162 656c 3d27 4263 6b20 7375  ', label='Bck su
+00029b80: 6227 290a 0a20 2020 2023 2041 6464 7320  b')..    # Adds 
+00029b90: 6375 6269 6320 696e 7465 7270 6f6c 6f61  cubic interpoloa
+00029ba0: 7469 6f6e 2066 6f72 2069 6e73 7065 6374  tion for inspect
+00029bb0: 696f 6e0a 0a20 2020 2020 2020 2061 7834  ion..        ax4
+00029bc0: 2e73 6574 5f74 6974 6c65 2827 6429 2043  .set_title('d) C
+00029bd0: 7562 6963 2053 706c 696e 6527 290a 2020  ubic Spline').  
+00029be0: 2020 2020 2020 6178 342e 706c 6f74 285b        ax4.plot([
+00029bf0: 785f 6e65 6172 6573 745f 4c48 532c 2050  x_nearest_LHS, P
+00029c00: 6561 6b5f 4365 6e74 6572 5d2c 205b 795f  eak_Center], [y_
+00029c10: 696e 745f 6375 742c 2079 5f69 6e74 5f63  int_cut, y_int_c
+00029c20: 7574 5d2c 2027 2d67 2729 0a20 2020 2020  ut], '-g').     
+00029c30: 2020 2061 7834 2e61 6e6e 6f74 6174 6528     ax4.annotate(
+00029c40: 7374 7228 6e70 2e72 6f75 6e64 284c 4853  str(np.round(LHS
+00029c50: 5f43 656e 7465 722c 2032 2929 2c0a 2020  _Center, 2)),.  
+00029c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029c70: 2020 2078 793d 2878 5f6e 6561 7265 7374     xy=(x_nearest
+00029c80: 5f4c 4853 2d33 2c20 795f 696e 745f 6375  _LHS-3, y_int_cu
+00029c90: 742b 2850 6561 6b5f 4865 6967 6874 2d79  t+(Peak_Height-y
+00029ca0: 5f69 6e74 5f63 7574 292f 3130 292c 2078  _int_cut)/10), x
+00029cb0: 7963 6f6f 7264 733d 2264 6174 6122 2c0a  ycoords="data",.
+00029cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029cd0: 2020 2020 2066 6f6e 7473 697a 653d 3132       fontsize=12
+00029ce0: 2c20 636f 6c6f 723d 2767 7265 656e 2729  , color='green')
+00029cf0: 0a20 2020 2020 2020 2061 7834 2e70 6c6f  .        ax4.plo
+00029d00: 7428 785f 6e65 6172 6573 745f 4c48 532c  t(x_nearest_LHS,
+00029d10: 2079 5f6e 6561 7265 7374 5f4c 4853 2c20   y_nearest_LHS, 
+00029d20: 272a 6b27 2c20 6d66 633d 2767 7265 656e  '*k', mfc='green
+00029d30: 272c 6d73 3d31 352c 206c 6162 656c 3d27  ',ms=15, label='
+00029d40: 5248 2074 6965 2729 0a0a 0a0a 2020 2020  RH tie')....    
+00029d50: 2020 2020 6178 342e 706c 6f74 285b 5065      ax4.plot([Pe
+00029d60: 616b 5f43 656e 7465 722c 2078 5f6e 6561  ak_Center, x_nea
+00029d70: 7265 7374 5f52 4853 5d2c 205b 795f 696e  rest_RHS], [y_in
+00029d80: 745f 6375 742c 2079 5f69 6e74 5f63 7574  t_cut, y_int_cut
+00029d90: 5d2c 2027 2d27 2c20 636f 6c6f 723d 2767  ], '-', color='g
+00029da0: 7265 7927 290a 2020 2020 2020 2020 6178  rey').        ax
+00029db0: 342e 616e 6e6f 7461 7465 2873 7472 286e  4.annotate(str(n
+00029dc0: 702e 726f 756e 6428 5248 535f 4365 6e74  p.round(RHS_Cent
+00029dd0: 6572 2c20 3229 292c 0a20 2020 2020 2020  er, 2)),.       
+00029de0: 2020 2020 2020 2020 2020 2020 2020 7879                xy
+00029df0: 3d28 785f 6e65 6172 6573 745f 5248 532b  =(x_nearest_RHS+
+00029e00: 332c 2079 5f69 6e74 5f63 7574 2b28 5065  3, y_int_cut+(Pe
+00029e10: 616b 5f48 6569 6768 742d 795f 696e 745f  ak_Height-y_int_
+00029e20: 6375 7429 2f31 3029 2c20 7879 636f 6f72  cut)/10), xycoor
+00029e30: 6473 3d22 6461 7461 222c 0a20 2020 2020  ds="data",.     
+00029e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029e50: 2066 6f6e 7473 697a 653d 3132 2c20 636f   fontsize=12, co
+00029e60: 6c6f 723d 2767 7265 7927 290a 2020 2020  lor='grey').    
+00029e70: 2020 2020 6178 342e 706c 6f74 2878 5f6e      ax4.plot(x_n
+00029e80: 6561 7265 7374 5f52 4853 2c20 795f 6e65  earest_RHS, y_ne
+00029e90: 6172 6573 745f 5248 532c 2027 2a6b 272c  arest_RHS, '*k',
+00029ea0: 206d 6663 3d27 6772 6579 272c 206d 733d   mfc='grey', ms=
+00029eb0: 3135 2c20 6c61 6265 6c3d 274c 4820 7469  15, label='LH ti
+00029ec0: 6527 290a 0a0a 0a0a 2020 2020 2020 2020  e').....        
+00029ed0: 6178 342e 706c 6f74 2878 2c20 792c 2027  ax4.plot(x, y, '
+00029ee0: 2e72 2729 0a20 2020 2020 2020 2061 7834  .r').        ax4
+00029ef0: 2e70 6c6f 7428 785f 6e65 772c 2079 5f63  .plot(x_new, y_c
+00029f00: 7562 2c20 272d 6b27 290a 0a20 2020 2020  ub, '-k')..     
+00029f10: 2020 2061 7834 2e70 6c6f 7428 5b50 6561     ax4.plot([Pea
+00029f20: 6b5f 4365 6e74 6572 2c20 5065 616b 5f43  k_Center, Peak_C
+00029f30: 656e 7465 725d 2c20 5b50 6561 6b5f 4865  enter], [Peak_He
+00029f40: 6967 6874 2c20 5065 616b 5f48 6569 6768  ight, Peak_Heigh
+00029f50: 745d 2c0a 2020 2020 2020 2020 2020 2020  t],.            
+00029f60: 2027 2a6b 272c 206d 6663 3d27 626c 7565   '*k', mfc='blue
+00029f70: 272c 206d 733d 3135 2c20 6c61 6265 6c3d  ', ms=15, label=
+00029f80: 2753 6369 7079 2043 656e 7465 7227 290a  'Scipy Center').
+00029f90: 0a0a 2020 2020 2020 2020 2320 4164 6420  ..        # Add 
+00029fa0: 746f 2070 6c6f 740a 0a20 2020 2020 2020  to plot..       
+00029fb0: 2061 7834 2e70 6c6f 7428 636f 6e66 6967   ax4.plot(config
+00029fc0: 312e 6c6f 7765 725f 6263 6b5f 6469 6164  1.lower_bck_diad
+00029fd0: 325b 305d 2c20 636f 6e66 6967 312e 7570  2[0], config1.up
+00029fe0: 7065 725f 6263 6b5f 6469 6164 325b 315d  per_bck_diad2[1]
+00029ff0: 2c20 5b79 5f69 6e74 5f63 7574 2c20 795f  , [y_int_cut, y_
+0002a000: 696e 745f 6375 745d 2c20 273a 7227 290a  int_cut], ':r').
+0002a010: 0a0a 0a0a 2020 2020 2020 2020 6178 342e  ....        ax4.
+0002a020: 7365 745f 786c 696d 285b 785f 6e65 6172  set_xlim([x_near
+0002a030: 6573 745f 4c48 532d 3130 2c20 785f 6e65  est_LHS-10, x_ne
+0002a040: 6172 6573 745f 5248 532b 3130 5d29 0a20  arest_RHS+10]). 
+0002a050: 2020 2020 2020 2061 7834 2e73 6574 5f79         ax4.set_y
+0002a060: 6c69 6d28 5b30 2d31 302c 2050 6561 6b5f  lim([0-10, Peak_
+0002a070: 4865 6967 6874 2a31 2e32 5d29 0a20 2020  Height*1.2]).   
+0002a080: 2020 2020 2061 7834 2e70 6c6f 7428 5b50       ax4.plot([P
+0002a090: 6561 6b5f 4365 6e74 6572 2c20 5065 616b  eak_Center, Peak
+0002a0a0: 5f43 656e 7465 725d 2c20 5b30 2c20 5065  _Center], [0, Pe
+0002a0b0: 616b 5f48 6569 6768 745d 2c20 273a 6227  ak_Height], ':b'
+0002a0c0: 290a 0a0a 0a20 2020 2020 2020 2061 7834  )....        ax4
+0002a0d0: 2e61 6e6e 6f74 6174 6528 2753 6b65 776e  .annotate('Skewn
+0002a0e0: 6573 733d 272b 7374 7228 6e70 2e72 6f75  ess='+str(np.rou
+0002a0f0: 6e64 2841 532c 2032 2929 2c0a 2020 2020  nd(AS, 2)),.    
+0002a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a110: 2078 793d 2878 5f6e 6561 7265 7374 5f52   xy=(x_nearest_R
+0002a120: 4853 2b32 2c20 795f 696e 745f 6375 742b  HS+2, y_int_cut+
+0002a130: 795f 696e 745f 6375 742b 2850 6561 6b5f  y_int_cut+(Peak_
+0002a140: 4865 6967 6874 2d79 5f69 6e74 5f63 7574  Height-y_int_cut
+0002a150: 292f 3130 292c 2078 7963 6f6f 7264 733d  )/10), xycoords=
+0002a160: 2264 6174 6122 2c0a 2020 2020 2020 2020  "data",.        
+0002a170: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0002a180: 6e74 7369 7a65 3d31 3029 0a0a 2020 2020  ntsize=10)..    
+0002a190: 2020 2020 6178 322e 6c65 6765 6e64 2829      ax2.legend()
+0002a1a0: 0a20 2020 2020 2020 2061 7831 2e6c 6567  .        ax1.leg
+0002a1b0: 656e 6428 290a 2020 2020 2020 2020 6178  end().        ax
+0002a1c0: 332e 6c65 6765 6e64 2829 0a20 2020 2020  3.legend().     
+0002a1d0: 2020 2061 7834 2e6c 6567 656e 6428 290a     ax4.legend().
+0002a1e0: 2020 2020 2020 2020 6178 312e 7365 745f          ax1.set_
+0002a1f0: 786c 6162 656c 2827 5761 7665 6e75 6d62  xlabel('Wavenumb
+0002a200: 6572 2028 636d 245e 7b2d 317d 2429 2729  er (cm$^{-1}$)')
+0002a210: 0a20 2020 2020 2020 2061 7832 2e73 6574  .        ax2.set
+0002a220: 5f78 6c61 6265 6c28 2757 6176 656e 756d  _xlabel('Wavenum
+0002a230: 6265 7220 2863 6d24 5e7b 2d31 7d24 2927  ber (cm$^{-1}$)'
+0002a240: 290a 2020 2020 2020 2020 6178 332e 7365  ).        ax3.se
+0002a250: 745f 786c 6162 656c 2827 5761 7665 6e75  t_xlabel('Wavenu
+0002a260: 6d62 6572 2028 636d 245e 7b2d 317d 2429  mber (cm$^{-1}$)
+0002a270: 2729 0a20 2020 2020 2020 2061 7834 2e73  ').        ax4.s
+0002a280: 6574 5f78 6c61 6265 6c28 2757 6176 656e  et_xlabel('Waven
+0002a290: 756d 6265 7220 2863 6d24 5e7b 2d31 7d24  umber (cm$^{-1}$
+0002a2a0: 2927 290a 2020 2020 2020 2020 6178 312e  )').        ax1.
+0002a2b0: 7365 745f 796c 6162 656c 2827 496e 7465  set_ylabel('Inte
+0002a2c0: 6e73 6974 7927 290a 2020 2020 2020 2020  nsity').        
+0002a2d0: 6178 322e 7365 745f 796c 6162 656c 2827  ax2.set_ylabel('
+0002a2e0: 496e 7465 6e73 6974 7927 290a 2020 2020  Intensity').    
+0002a2f0: 2020 2020 6178 332e 7365 745f 796c 6162      ax3.set_ylab
+0002a300: 656c 2827 496e 7465 6e73 6974 7927 290a  el('Intensity').
+0002a310: 2020 2020 2020 2020 6178 342e 7365 745f          ax4.set_
+0002a320: 796c 6162 656c 2827 496e 7465 6e73 6974  ylabel('Intensit
+0002a330: 7927 290a 2020 2020 2020 2020 6669 672e  y').        fig.
+0002a340: 7469 6768 745f 6c61 796f 7574 2829 0a0a  tight_layout()..
+0002a350: 0a20 2020 2020 2020 2070 6174 6833 3d70  .        path3=p
+0002a360: 6174 682b 272f 272b 2753 6b65 776e 6573  ath+'/'+'Skewnes
+0002a370: 735f 696d 6167 6573 270a 2020 2020 2020  s_images'.      
+0002a380: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+0002a390: 7374 7328 7061 7468 3329 3a0a 2020 2020  sts(path3):.    
+0002a3a0: 2020 2020 2020 2020 6f75 743d 2770 6174          out='pat
+0002a3b0: 6820 6578 6973 7473 270a 2020 2020 2020  h exists'.      
+0002a3c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002a3d0: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
+0002a3e0: 7061 7468 2b27 2f27 2b20 2753 6b65 776e  path+'/'+ 'Skewn
+0002a3f0: 6573 735f 696d 6167 6573 272c 2065 7869  ess_images', exi
+0002a400: 7374 5f6f 6b3d 4661 6c73 6529 0a0a 0a20  st_ok=False)... 
+0002a410: 2020 2020 2020 2066 696c 653d 6669 6c65         file=file
+0002a420: 6e61 6d65 2e72 7370 6c69 7428 272e 7478  name.rsplit('.tx
+0002a430: 7427 2c20 3129 5b30 5d0a 2020 2020 2020  t', 1)[0].      
+0002a440: 2020 6669 672e 7361 7665 6669 6728 7061    fig.savefig(pa
+0002a450: 7468 332b 272f 272b 2744 6961 6432 5f73  th3+'/'+'Diad2_s
+0002a460: 6b65 776e 6573 735f 7b7d 2e70 6e67 272e  kewness_{}.png'.
+0002a470: 666f 726d 6174 2866 696c 6529 2c20 6470  format(file), dp
+0002a480: 693d 6470 6929 0a0a 0a20 2020 2064 665f  i=dpi)...    df_
+0002a490: 6f75 743d 7064 2e44 6174 6146 7261 6d65  out=pd.DataFrame
+0002a4a0: 2864 6174 613d 7b0a 2020 2020 2020 2020  (data={.        
+0002a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a4c0: 2020 2020 2020 2753 6b65 776e 6573 735f        'Skewness_
+0002a4d0: 6469 6164 3227 3a20 4153 2c0a 2020 2020  diad2': AS,.    
+0002a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a4f0: 2020 2020 2020 2020 2020 274c 4853 5f74            'LHS_t
+0002a500: 6965 5f64 6961 6432 273a 2078 5f6e 6561  ie_diad2': x_nea
+0002a510: 7265 7374 5f4c 4853 2c0a 2020 2020 2020  rest_LHS,.      
+0002a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a530: 2020 2020 2020 2020 2752 4853 5f74 6965          'RHS_tie
+0002a540: 5f64 6961 6432 273a 2078 5f6e 6561 7265  _diad2': x_neare
+0002a550: 7374 5f52 4853 7d2c 2069 6e64 6578 3d5b  st_RHS}, index=[
+0002a560: 305d 290a 0a20 2020 2072 6574 7572 6e20  0])..    return 
+0002a570: 6466 5f6f 7574 0a0a 0a64 6566 206c 6f6f  df_out...def loo
+0002a580: 705f 6469 6164 5f73 6b65 776e 6573 7328  p_diad_skewness(
+0002a590: 2a2c 2044 6961 645f 6669 6c65 732c 2070  *, Diad_files, p
+0002a5a0: 6174 683d 4e6f 6e65 2c20 6669 6c65 7479  ath=None, filety
+0002a5b0: 7065 3d4e 6f6e 652c 2020 736b 6577 6e65  pe=None,  skewne
+0002a5c0: 7373 3d27 6162 7327 2c20 736f 7274 3d46  ss='abs', sort=F
+0002a5d0: 616c 7365 2c20 696e 745f 6375 745f 6f66  alse, int_cut_of
+0002a5e0: 663d 302e 3135 2c0a 636f 6e66 6967 5f64  f=0.15,.config_d
+0002a5f0: 6961 6431 3a20 6469 6164 315f 6669 745f  iad1: diad1_fit_
+0002a600: 636f 6e66 6967 3d64 6961 6431 5f66 6974  config=diad1_fit
+0002a610: 5f63 6f6e 6669 6728 292c 2063 6f6e 6669  _config(), confi
+0002a620: 675f 6469 6164 323a 2064 6961 6432 5f66  g_diad2: diad2_f
+0002a630: 6974 5f63 6f6e 6669 673d 6469 6164 325f  it_config=diad2_
+0002a640: 6669 745f 636f 6e66 6967 2829 2c20 7072  fit_config(), pr
+0002a650: 6f6d 696e 656e 6365 3d31 302c 2077 6964  ominence=10, wid
+0002a660: 7468 3d31 2c20 6865 6967 6874 3d31 293a  th=1, height=1):
+0002a670: 0a20 2020 2022 2222 204c 6f6f 7073 206f  .    """ Loops o
+0002a680: 7665 7220 616c 6c20 7375 7070 6c69 6564  ver all supplied
+0002a690: 2066 696c 6573 2074 6f20 6361 6c63 756c   files to calcul
+0002a6a0: 6174 6520 736b 6577 6e65 7373 2066 6f72  ate skewness for
+0002a6b0: 206d 756c 7469 706c 6520 7370 6563 7472   multiple spectr
+0002a6c0: 6120 7573 696e 6720 7468 6520 6675 6e63  a using the func
+0002a6d0: 7469 6f6e 730a 2020 2020 6173 7365 7373  tions.    assess
+0002a6e0: 5f64 6961 6431 5f73 6b65 776e 6573 7328  _diad1_skewness(
+0002a6f0: 2920 616e 6420 6173 7365 7373 5f64 6961  ) and assess_dia
+0002a700: 6432 5f73 6b65 776e 6573 7328 290a 0a0a  d2_skewness()...
+0002a710: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0002a720: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20     -----------. 
+0002a730: 2020 2044 6961 645f 4669 6c65 733a 206c     Diad_Files: l
+0002a740: 6973 740a 2020 2020 2020 2020 4c69 7374  ist.        List
+0002a750: 206f 6620 6669 6c65 6e61 6d65 7320 746f   of filenames to
+0002a760: 206c 6f6f 7020 7468 726f 7567 680a 0a20   loop through.. 
+0002a770: 2020 2070 6174 683a 2073 7472 0a20 2020     path: str.   
+0002a780: 2020 2020 2046 6f6c 6465 7220 7573 6572       Folder user
+0002a790: 2077 6973 6865 7320 746f 2072 6561 6420   wishes to read 
+0002a7a0: 6461 7461 2066 726f 6d0a 0a20 2020 2066  data from..    f
+0002a7b0: 696c 6574 7970 653a 2073 7472 0a20 2020  iletype: str.   
+0002a7c0: 2020 2020 2049 6465 6e74 6966 6965 7320       Identifies 
+0002a7d0: 7479 7065 206f 6620 6669 6c65 0a20 2020  type of file.   
+0002a7e0: 2020 2020 2063 686f 6f73 6520 6672 6f6d       choose from
+0002a7f0: 2027 5769 7465 635f 4153 4349 4927 2c20   'Witec_ASCII', 
+0002a800: 2768 6561 646c 6573 735f 7478 7427 2c20  'headless_txt', 
+0002a810: 2768 6561 646c 6573 735f 6373 7627 2c20  'headless_csv', 
+0002a820: 2768 6561 645f 6373 7627 2c20 2757 6974  'head_csv', 'Wit
+0002a830: 6563 5f41 5343 4949 272c 0a20 2020 2020  ec_ASCII',.     
+0002a840: 2020 2027 484f 5249 4241 5f74 7874 272c     'HORIBA_txt',
+0002a850: 2027 5265 6e69 7368 6177 5f74 7874 270a   'Renishaw_txt'.
+0002a860: 0a20 2020 2073 6b65 776e 6573 733a 2027  .    skewness: '
+0002a870: 6162 7327 206f 7220 2764 6972 270a 2020  abs' or 'dir'.  
+0002a880: 2020 2020 2020 4966 2027 6162 7327 2c20        If 'abs', 
+0002a890: 6769 7665 7320 6162 736f 6c75 7465 2073  gives absolute s
+0002a8a0: 6b65 776e 6573 7320 2865 2e67 2e2c 206c  kewness (e.g., l
+0002a8b0: 6172 6765 7374 2070 6f73 7369 626c 6520  argest possible 
+0002a8c0: 6e75 6d62 6572 2072 6567 6172 646c 6573  number regardles
+0002a8d0: 7320 6f66 2064 6972 6563 7469 6f6e 290a  s of direction).
+0002a8e0: 2020 2020 2020 2020 6966 2027 6469 7227          if 'dir'
+0002a8f0: 2064 6f65 7320 736b 6577 6e65 7373 2061   does skewness a
+0002a900: 7320 6f6e 6520 7369 6465 206f 7665 7220  s one side over 
+0002a910: 7468 6520 6f74 6865 720a 0a0a 0a20 2020  the other....   
+0002a920: 2073 6f72 743a 2062 6f6f 6c0a 2020 2020   sort: bool.    
+0002a930: 2020 2020 4966 2074 7275 652c 2073 6f72      If true, sor
+0002a940: 7473 2066 696c 6573 2061 6c70 6861 6265  ts files alphabe
+0002a950: 7469 6361 6c6c 790a 2020 2020 6669 6c65  tically.    file
+0002a960: 5f65 7874 3a20 7374 720a 2020 2020 2020  _ext: str.      
+0002a970: 2020 4669 6c65 2066 6f72 6d61 742e 2044    File format. D
+0002a980: 6566 6175 6c74 2074 7874 2c20 636f 756c  efault txt, coul
+0002a990: 6420 616c 736f 2065 6e74 6572 2063 7376  d also enter csv
+0002a9a0: 2065 7463 2e0a 2020 2020 6578 636c 7564   etc..    exclud
+0002a9b0: 655f 7374 723a 2073 7472 0a20 2020 2020  e_str: str.     
+0002a9c0: 2020 2045 7863 6c75 6465 7320 6669 6c65     Excludes file
+0002a9d0: 7320 7769 7468 2074 6869 7320 7374 7269  s with this stri
+0002a9e0: 6e67 2069 6e20 7468 6569 7220 6e61 6d65  ng in their name
+0002a9f0: 2e20 452e 672e 2069 6620 6578 636c 7564  . E.g. if exclud
+0002aa00: 655f 7374 723d 274e 6527 2069 7420 7769  e_str='Ne' it wi
+0002aa10: 6c6c 2065 7863 6c75 6465 204e 6520 6c69  ll exclude Ne li
+0002aa20: 6e65 730a 2020 2020 6578 636c 7564 655f  nes.    exclude_
+0002aa30: 7479 7065 3a20 7374 720a 2020 2020 2020  type: str.      
+0002aa40: 2020 4578 636c 7564 6573 2066 696c 6573    Excludes files
+0002aa50: 206f 6620 7468 6973 2074 7970 652c 2065   of this type, e
+0002aa60: 2e67 2e20 6578 636c 7564 655f 7479 7065  .g. exclude_type
+0002aa70: 3d27 706e 6727 2067 6574 7320 7269 6420  ='png' gets rid 
+0002aa80: 6f66 2069 6d61 6765 2066 696c 6573 2e0a  of image files..
+0002aa90: 0a0a 2020 2020 6c6f 7765 725f 6261 7365  ..    lower_base
+0002aaa0: 6c69 6e65 5f64 6961 6431 2c20 6c6f 7765  line_diad1, lowe
+0002aab0: 725f 6261 7365 6c69 6e65 5f64 6961 6432  r_baseline_diad2
+0002aac0: 3a20 6c69 7374 0a20 2020 2020 2020 2052  : list.        R
+0002aad0: 6567 696f 6e20 6f66 2073 7065 6374 7261  egion of spectra
+0002aae0: 2074 6f20 7573 6520 6120 6261 7365 6c69   to use a baseli
+0002aaf0: 6e65 2028 4c48 5329 2066 6f72 2064 6961  ne (LHS) for dia
+0002ab00: 6420 3120 616e 6420 6469 6164 320a 0a20  d 1 and diad2.. 
+0002ab10: 2020 2075 7070 6572 5f62 6173 656c 696e     upper_baselin
+0002ab20: 655f 6469 6164 312c 2075 7070 6572 5f62  e_diad1, upper_b
+0002ab30: 6173 656c 696e 655f 6469 6164 323a 206c  aseline_diad2: l
+0002ab40: 6973 740a 2020 2020 2020 2020 5265 6769  ist.        Regi
+0002ab50: 6f6e 206f 6620 7370 6563 7472 6120 746f  on of spectra to
+0002ab60: 2075 7365 2061 2062 6173 656c 696e 6520   use a baseline 
+0002ab70: 2852 4853 2920 666f 7220 6469 6164 2031  (RHS) for diad 1
+0002ab80: 2061 6e64 2064 6961 6420 320a 0a20 2020   and diad 2..   
+0002ab90: 204e 5f70 6f6c 795f 6263 6b5f 6469 6164   N_poly_bck_diad
+0002aba0: 312c 204e 5f70 6f6c 795f 6263 6b5f 6469  1, N_poly_bck_di
+0002abb0: 6164 323a 2069 6e74 0a20 2020 2020 2020  ad2: int.       
+0002abc0: 2044 6567 7265 6520 6f66 2070 6f6c 796e   Degree of polyn
+0002abd0: 6f6d 6961 6c20 666f 7220 6261 636b 6772  omial for backgr
+0002abe0: 6f75 6e64 2066 6974 7469 6e67 0a0a 2020  ound fitting..  
+0002abf0: 2020 736b 6577 6e65 7373 3a20 2761 6273    skewness: 'abs
+0002ac00: 2720 6f72 2027 6469 7227 0a20 2020 2020  ' or 'dir'.     
+0002ac10: 2020 2049 6620 2761 6273 272c 2067 6976     If 'abs', giv
+0002ac20: 6573 2061 6273 6f6c 7574 6520 736b 6577  es absolute skew
+0002ac30: 6e65 7373 2028 652e 672e 2c20 6c61 7267  ness (e.g., larg
+0002ac40: 6573 7420 706f 7373 6962 6c65 206e 756d  est possible num
+0002ac50: 6265 7220 7265 6761 7264 6c65 7373 206f  ber regardless o
+0002ac60: 6620 6469 7265 6374 696f 6e29 0a20 2020  f direction).   
+0002ac70: 2020 2020 2069 6620 2764 6972 2720 646f       if 'dir' do
+0002ac80: 6573 2073 6b65 776e 6573 7320 6173 206f  es skewness as o
+0002ac90: 6e65 2073 6964 6520 6f76 6572 2074 6865  ne side over the
+0002aca0: 206f 7468 6572 0a0a 2020 2020 696e 745f   other..    int_
+0002acb0: 6375 745f 6f66 663a 2066 6c6f 6174 0a20  cut_off: float. 
+0002acc0: 2020 2020 2020 2056 616c 7565 206f 6620         Value of 
+0002acd0: 696e 7465 6e73 6974 7920 6174 2077 6869  intensity at whi
+0002ace0: 6368 2074 6f20 6361 6c63 756c 6174 6520  ch to calculate 
+0002acf0: 7468 6520 736b 6577 6e65 7373 2028 652e  the skewness (e.
+0002ad00: 672e 2030 2e31 3558 2074 6865 2070 6561  g. 0.15X the pea
+0002ad10: 6b20 6865 6967 6874 292e 0a0a 0a20 2020  k height)....   
+0002ad20: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
+0002ad30: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2070 642e  --------.    pd.
+0002ad40: 4461 7461 4672 616d 6520 7774 6968 2066  DataFrame wtih f
+0002ad50: 696c 656e 616d 652c 2073 6b65 776e 6573  ilename, skewnes
+0002ad60: 7320 6f66 2044 6961 6420 312c 0a20 2020  s of Diad 1,.   
+0002ad70: 2074 6865 2078 2070 6f73 6974 696f 6e20   the x position 
+0002ad80: 6f66 2074 6865 204c 4820 616e 6420 5248  of the LH and RH
+0002ad90: 2074 6965 2070 6f69 6e74 2061 7420 696e   tie point at in
+0002ada0: 7465 6e73 6974 793d 696e 745f 696e 745f  tensity=int_int_
+0002adb0: 6375 745f 6f66 660a 0a0a 0a20 2020 2022  cut_off....    "
+0002adc0: 2222 0a0a 0a0a 2020 2020 6466 5f64 6961  ""....    df_dia
+0002add0: 6431 203d 2070 642e 4461 7461 4672 616d  d1 = pd.DataFram
+0002ade0: 6528 5b5d 290a 2020 2020 6466 5f64 6961  e([]).    df_dia
+0002adf0: 6432 203d 2070 642e 4461 7461 4672 616d  d2 = pd.DataFram
+0002ae00: 6528 5b5d 290a 2020 2020 6466 5f6d 6572  e([]).    df_mer
+0002ae10: 6765 643d 7064 2e44 6174 6146 7261 6d65  ged=pd.DataFrame
+0002ae20: 285b 5d29 0a20 2020 2066 6f72 2069 2069  ([]).    for i i
+0002ae30: 6e20 7261 6e67 6528 302c 206c 656e 2844  n range(0, len(D
+0002ae40: 6961 645f 6669 6c65 7329 293a 0a0a 2020  iad_files)):..  
+0002ae50: 2020 2020 2020 6669 6c65 6e61 6d65 3d44        filename=D
+0002ae60: 6961 645f 6669 6c65 735b 695d 0a20 2020  iad_files[i].   
+0002ae70: 2020 2020 2070 7269 6e74 2827 776f 726b       print('work
+0002ae80: 696e 6720 6f6e 2066 696c 6520 2327 2b73  ing on file #'+s
+0002ae90: 7472 2869 2929 0a0a 2020 2020 2020 2020  tr(i))..        
+0002aea0: 6461 7461 5f64 6961 6431 3d61 7373 6573  data_diad1=asses
+0002aeb0: 735f 6469 6164 315f 736b 6577 6e65 7373  s_diad1_skewness
+0002aec0: 2863 6f6e 6669 6731 3d63 6f6e 6669 675f  (config1=config_
+0002aed0: 6469 6164 312c 0a20 2020 2020 2020 2069  diad1,.        i
+0002aee0: 6e74 5f63 7574 5f6f 6666 3d69 6e74 5f63  nt_cut_off=int_c
+0002aef0: 7574 5f6f 6666 2c20 7072 6f6d 696e 656e  ut_off, prominen
+0002af00: 6365 3d70 726f 6d69 6e65 6e63 652c 2068  ce=prominence, h
+0002af10: 6569 6768 743d 6865 6967 6874 2c20 7769  eight=height, wi
+0002af20: 6474 683d 7769 6474 682c 0a20 2020 2020  dth=width,.     
+0002af30: 2020 2073 6b65 776e 6573 733d 736b 6577     skewness=skew
+0002af40: 6e65 7373 2c20 7061 7468 3d70 6174 682c  ness, path=path,
+0002af50: 2066 696c 656e 616d 653d 6669 6c65 6e61   filename=filena
+0002af60: 6d65 2c0a 2020 2020 2020 2020 6669 6c65  me,.        file
+0002af70: 7479 7065 3d66 696c 6574 7970 6529 0a0a  type=filetype)..
+0002af80: 2020 2020 2020 2020 6461 7461 5f64 6961          data_dia
+0002af90: 6432 3d61 7373 6573 735f 6469 6164 325f  d2=assess_diad2_
+0002afa0: 736b 6577 6e65 7373 2863 6f6e 6669 6731  skewness(config1
+0002afb0: 3d63 6f6e 6669 675f 6469 6164 322c 0a20  =config_diad2,. 
+0002afc0: 2020 2020 2020 2069 6e74 5f63 7574 5f6f         int_cut_o
+0002afd0: 6666 3d69 6e74 5f63 7574 5f6f 6666 2c20  ff=int_cut_off, 
+0002afe0: 7072 6f6d 696e 656e 6365 3d70 726f 6d69  prominence=promi
+0002aff0: 6e65 6e63 652c 2068 6569 6768 743d 6865  nence, height=he
+0002b000: 6967 6874 2c20 7769 6474 683d 7769 6474  ight, width=widt
+0002b010: 682c 0a20 2020 2020 2020 2073 6b65 776e  h,.        skewn
+0002b020: 6573 733d 736b 6577 6e65 7373 2c20 7061  ess=skewness, pa
+0002b030: 7468 3d70 6174 682c 2066 696c 656e 616d  th=path, filenam
+0002b040: 653d 6669 6c65 6e61 6d65 2c0a 2020 2020  e=filename,.    
+0002b050: 2020 2020 6669 6c65 7479 7065 3d66 696c      filetype=fil
+0002b060: 6574 7970 6529 0a0a 0a20 2020 2020 2020  etype)...       
+0002b070: 2064 665f 6469 6164 3120 3d20 7064 2e63   df_diad1 = pd.c
+0002b080: 6f6e 6361 7428 5b64 665f 6469 6164 312c  oncat([df_diad1,
+0002b090: 2064 6174 615f 6469 6164 315d 2c20 6178   data_diad1], ax
+0002b0a0: 6973 3d30 290a 2020 2020 2020 2020 6466  is=0).        df
+0002b0b0: 5f64 6961 6432 203d 2020 7064 2e63 6f6e  _diad2 =  pd.con
+0002b0c0: 6361 7428 5b64 665f 6469 6164 322c 2064  cat([df_diad2, d
+0002b0d0: 6174 615f 6469 6164 325d 2c20 6178 6973  ata_diad2], axis
+0002b0e0: 3d30 290a 0a0a 0a20 2020 2064 665f 636f  =0)....    df_co
+0002b0f0: 6d62 6f3d 7064 2e63 6f6e 6361 7428 5b64  mbo=pd.concat([d
+0002b100: 665f 6469 6164 312c 2064 665f 6469 6164  f_diad1, df_diad
+0002b110: 325d 2c20 6178 6973 3d31 290a 0a20 2020  2], axis=1)..   
+0002b120: 2063 6f6c 735f 746f 5f6d 6f76 653d 5b27   cols_to_move=['
+0002b130: 6669 6c65 6e61 6d65 272c 2027 536b 6577  filename', 'Skew
+0002b140: 6e65 7373 5f64 6961 6431 272c 2027 536b  ness_diad1', 'Sk
+0002b150: 6577 6e65 7373 5f64 6961 6432 275d 0a0a  ewness_diad2']..
+0002b160: 2020 2020 6466 5f63 6f6d 626f 203d 2064      df_combo = d
+0002b170: 665f 636f 6d62 6f5b 636f 6c73 5f74 6f5f  f_combo[cols_to_
+0002b180: 6d6f 7665 202b 205b 0a20 2020 2020 2020  move + [.       
+0002b190: 2063 6f6c 2066 6f72 2063 6f6c 2069 6e20   col for col in 
+0002b1a0: 6466 5f63 6f6d 626f 2e63 6f6c 756d 6e73  df_combo.columns
+0002b1b0: 2069 6620 636f 6c20 6e6f 7420 696e 2063   if col not in c
+0002b1c0: 6f6c 735f 746f 5f6d 6f76 655d 5d0a 0a0a  ols_to_move]]...
+0002b1d0: 0a0a 2020 2020 7265 7475 726e 2064 665f  ..    return df_
+0002b1e0: 636f 6d62 6f0a 0a0a 0a0a 0a0a            combo.......
```

### Comparing `DiadFit-0.0.85/src/DiadFit/error_propagation.py` & `DiadFit-0.0.88/src/DiadFit/error_propagation.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,74 +1,21 @@
 
 import numpy as np
 import pandas as pd
 import matplotlib.pyplot as plt
 import DiadFit as pf
-
+from tqdm import tqdm
 from DiadFit.density_depth_crustal_profiles import *
 from DiadFit.CO2_EOS import *
+# This gets us the functions for Monte Carloing
+from DiadFit.CO2_in_bubble_error import *
 
 ## Microthermometry error propagation
-# propagate_microthermometry_uncertainty_1sam goes to 'make_error_dist_microthermometry_1sam'
-
-def make_error_dist_microthermometry_1sam(*, T_h_C, sample_i=0, error_T_h_C=0.3, N_dup=1000,
-        error_dist_T_h_C='uniform', error_type_T_h_C='Abs', len_loop=1):
-    
-    """ 
-
-    This function generates a dataset of temperature measurements for a given sample. 
-    It adds random noise to the temperature measurement based on the specified distribution and error type.
-
-    Parameters
-    ----------
-    T_h_C : numeric or list of numeric values
-        The measured temperature(s) of the sample(s) in degrees Celsius.
-    sample_i : int, optional
-        The index of the sample for which the error distribution will be generated. Default value is 0.
-    error_T_h_C : numeric, optional
-        The amount of error to add to the temperature measurement. Default value is 0.3.
-    N_dup : int, optional
-        The number of duplicated samples to generate with random noise. Default value is 1000.
-    error_dist_T_h_C : str, optional
-        The distribution of the random noise to be added to the temperature measurement. Can be either 'normal' or 'uniform'. Default value is 'uniform'.
-    error_type_T_h_C : str, optional
-        The type of error to add to the temperature measurement. Can be either 'Abs' or 'Perc'. Default value is 'Abs'.
-    len_loop : int, optional
-        The number of samples for which the error distribution will be generated. Default value is 1.
 
-    Returns
-    -------
-    numpy.ndarray
-        An array of temperature measurements with random noise added to them based on the specified error 
-        distribution and error type. The size of the array is (N_dup, len(T_h_C)).
-
-    """
-
-    if len_loop==1:
-        df_c=pd.DataFrame(data={'T_h_C': T_h_C}, index=[0])
-    else:
-        df_c=pd.DataFrame(data={'T_h_C': T_h_C})
-
-
-    # Temperature error distribution
-    if error_type_T_h_C=='Abs':
-        error_T_h_C=error_T_h_C
-    if error_type_T_h_C =='Perc':
-        error_T_h_C=df_c['T_h_C'].iloc[sample_i]*error_T_h_C/100
-    if error_dist_T_h_C=='normal':
-        Noise_to_add_T_h_C = np.random.normal(0, error_T_h_C, N_dup)
-    if error_dist_T_h_C=='uniform':
-        Noise_to_add_T_h_C = np.random.uniform(- error_T_h_C, +
-                                                      error_T_h_C, N_dup)
-    
-    T_h_C_with_noise=Noise_to_add_T_h_C+df_c['T_h_C'].iloc[0]
-    
-    
 
-    return T_h_C_with_noise
 
 
 def propagate_microthermometry_uncertainty(T_h_C, Sample_ID=None,  error_T_h_C=0.3, N_dup=1000,
         error_dist_T_h_C='uniform', error_type_T_h_C='Abs', EOS='SW96',  homog_to=None, set_to_critical=False):
 
     """
     This function propagates the uncertainty in measured temperature values to calculate the density of gas and
@@ -132,47 +79,40 @@
     else:
         len_loop=1
 
     
 
 
     All_outputs=pd.DataFrame([])
-    Std_density_gas=np.empty(len_loop)
-    Std_density_liq=np.empty(len_loop)
-    Mean_density_gas=np.empty(len_loop)
-    Mean_density_liq=np.empty(len_loop)
-    Std_density_gas_IQR=np.empty(len_loop)
-    Std_density_Liq_IQR=np.empty(len_loop)
-    Sample=np.empty(len_loop,  dtype=np.dtype('U100') )
+    Std_density_gas=np.zeros(len_loop)
+    Std_density_liq=np.zeros(len_loop)
+    Mean_density_gas=np.zeros(len_loop)
+    Mean_density_liq=np.zeros(len_loop)
+    Std_density_gas_IQR=np.zeros(len_loop)
+    Std_density_Liq_IQR=np.zeros(len_loop)
+    Sample=np.zeros(len_loop,  dtype=np.dtype('U100') )
 
     for i in range(0, len_loop):
 
         # If user has entered a pandas series for error, takes right one for each loop
-        if type(error_T_h_C) is pd.Series:
-            error_T_h_C=error_T_h_C.iloc[i]
-        else:
-            error_T_h_C=error_T_h_C
+        error_T_h_C_i=get_value(error_T_h_C, i)
+        T_h_C_i=get_value(T_h_C, i)
 
-        if type(T_h_C) is pd.Series:
-            T_h_C_i=T_h_C.iloc[i]
-        else:
-            T_h_C_i=T_h_C
 
         # Check of
         if Sample_ID is None:
             Sample[i]=i
 
         elif isinstance(Sample_ID, str):
             Sample[i]=Sample_ID
         else:
             Sample[i]=Sample_ID.iloc[i]
 
-        Temp_MC=make_error_dist_microthermometry_1sam(T_h_C=T_h_C_i,
-        sample_i=i, error_T_h_C=error_T_h_C, N_dup=N_dup,
-        error_dist_T_h_C=error_dist_T_h_C, error_type_T_h_C=error_type_T_h_C, len_loop=1)
+        Temp_MC= add_noise_to_variable(T_h_C, error_T_h_C,
+        error_type_T_h_C, error_dist_T_h_C, N_dup, True, neg_threshold=0.0000000001)
 
         Sample2=Sample[i]
         MC_T=calculate_CO2_density_homog_T(T_h_C=Temp_MC, Sample_ID=Sample2, EOS=EOS, homog_to=homog_to, set_to_critical=set_to_critical)
 
         # Replace critical with NaN
 
 
@@ -213,15 +153,15 @@
 
 
 def calculate_temperature_density_MC(sample_i=0,  N_dup=1000, 
 CO2_dens_gcm3=None, error_CO2_dens=0, error_type_CO2_dens='Abs', error_dist_CO2_dens='normal',
  T_K=None, error_T_K=0, error_type_T_K='Abs', error_dist_T_K='normal',
 crust_dens_kgm3=None, error_crust_dens=0, error_type_crust_dens='Abs', error_dist_crust_dens='normal', XH2O=None,
 error_XH2O=None, error_type_XH2O='Abs', error_dist_XH2O='normal',
- model=None):
+ model=None, neg_values=True):
 
     """
     This function generates the range of T_K, CO2 densities, XH2O and crustal densities for 1 sample 
     for performing Monte Carlo simulations
     using the function propagate_FI_uncertainty (e.g. this function makes the range of 
     input parameters for each sample, but doesnt do the EOS calculations). 
 
@@ -286,20 +226,20 @@
     """
 
     # If any of them are panda series or numpy nd array, you dont need an index
     if XH2O is None:
         if isinstance(T_K, pd.Series) or isinstance(CO2_dens_gcm3, pd.Series) or isinstance(T_K, np.ndarray) or isinstance(CO2_dens_gcm3, np.ndarray):
             df_c=pd.DataFrame(data={'T_K': T_K,
                                 'CO2_dens_gcm3': CO2_dens_gcm3,
-                                'XH2O': 0})
+                                'XH2O': None})
         else:
             #print('here')
             df_c=pd.DataFrame(data={'T_K': T_K,
                                 'CO2_dens_gcm3': CO2_dens_gcm3,
-                                'XH2O': 0}, index=[0])
+                                'XH2O': None}, index=[0])
     # IF have XH2O add here
     else:
         if isinstance(T_K, pd.Series) or isinstance(CO2_dens_gcm3, pd.Series) or isinstance(T_K, np.ndarray) or isinstance(CO2_dens_gcm3, np.ndarray) or isinstance(XH2O, np.ndarray):
             df_c=pd.DataFrame(data={'T_K': T_K,
                                 'CO2_dens_gcm3': CO2_dens_gcm3,
                                 'XH2O': XH2O})
         else:
@@ -308,85 +248,40 @@
                                 'XH2O': XH2O}, index=[0])
         
         
     # you do need an index here
 
         
     # Temperature error distribution
-    if error_type_T_K=='Abs':
-        error_T_K=error_T_K
-    if error_type_T_K =='Perc':
-        error_T_K=df_c['T_K'].iloc[sample_i]*error_T_K/100
-    if error_dist_T_K=='normal':
-        Noise_to_add_T_K = np.random.normal(0, error_T_K, N_dup)
-    if error_dist_T_K=='uniform':
-        Noise_to_add_T_K = np.random.uniform(- error_T_K, +
-                                                      error_T_K, N_dup)
-
-    
-    T_K_with_noise=Noise_to_add_T_K+df_c['T_K'].iloc[sample_i]
-    T_K_with_noise[T_K_with_noise < 0.0001] = 0.0001
-
-
+    T_K_with_noise=add_noise_to_variable(T_K, error_T_K,
+        error_type_T_K, error_dist_T_K,  N_dup, neg_values, neg_threshold=0.0000000001)
+        
     # CO2 error distribution
+    CO2_dens_with_noise=add_noise_to_variable(CO2_dens_gcm3, error_CO2_dens,
+        error_type_CO2_dens, error_dist_CO2_dens,  N_dup, neg_values, neg_threshold=0.0000000001)
 
-    if error_type_CO2_dens=='Abs':
-        error_CO2_dens=error_CO2_dens
-    if error_type_CO2_dens =='Perc':
-        error_CO2_dens=df_c['CO2_dens_gcm3'].iloc[sample_i]*error_CO2_dens/100
-    if error_dist_CO2_dens=='normal':
-        Noise_to_add_CO2_dens = np.random.normal(0, error_CO2_dens, N_dup)
-    if error_dist_CO2_dens=='uniform':
-        Noise_to_add_CO2_dens = np.random.uniform(- error_CO2_dens, +
-                                                      error_CO2_dens, N_dup)
 
-    CO2_dens_with_noise=Noise_to_add_CO2_dens+df_c['CO2_dens_gcm3'].iloc[sample_i]
-    CO2_dens_with_noise[CO2_dens_with_noise < 0.0001] = 0.0001
     
     # XH2O error distribution (if relevant)
     if XH2O is not None:
-        if error_type_XH2O=='Abs':
-            error_XH2O=error_XH2O
-        if error_type_XH2O =='Perc':
-            error_XH2O=df_c['XH2O'].iloc[sample_i]*error_XH2O/100
-        if error_dist_XH2O=='normal':
-            Noise_to_add_XH2O = np.random.normal(0, error_XH2O, N_dup)
-        if error_dist_XH2O=='uniform':
-            Noise_to_add_XH2O = np.random.uniform(- error_XH2O, +
-                                                        error_XH2O, N_dup)
-    
-        XH2O_with_noise=Noise_to_add_XH2O+df_c['XH2O'].iloc[sample_i]
+        XH2O_with_noise=add_noise_to_variable(XH2O, error_XH2O,
+        error_type_XH2O, error_dist_XH2O,  N_dup, True, neg_threshold=0.0000000000)
         XH2O_with_noise[XH2O_with_noise < 0.000000] = 0.00000
         XH2O_with_noise[XH2O_with_noise > 1] = 1
-
         
-            
-    
+        
+        
     
-
     # Crustal density noise
     # First need to work out what crustal density is
 
     if type(crust_dens_kgm3) is float or type(crust_dens_kgm3) is int:
-        # This is the simplicest scenario, just makes a distribution of pressures
-
-        if error_type_crust_dens=='Abs':
-            error_crust_dens=error_crust_dens
-        if error_type_crust_dens =='Perc':
-            error_crust_dens=crust_dens_kgm3*error_crust_dens/100
-        if error_dist_crust_dens=='normal':
-            Noise_to_add_crust_dens = np.random.normal(0, error_crust_dens, N_dup)
-        if error_dist_crust_dens=='uniform':
-            Noise_to_add_crust_dens = np.random.uniform(- error_crust_dens, +
-                                                        error_crust_dens, N_dup)
-
-
-
-        crust_dens_with_noise=Noise_to_add_crust_dens+crust_dens_kgm3
-        crust_dens_with_noise[crust_dens_with_noise < 0.0001] = 0.0001
+        crust_dens_with_noise=add_noise_to_variable(crust_dens_kgm3, error_crust_dens_kgm3,
+        error_type_crust_dens, error_dist_crust_dens,  N_dup, neg_values, neg_threshold=0.0000000001)
+        
 
     elif model is not None:
         crust_dens_with_noise=None
 
     else:
         if error_crust_dens>0:
             raise Exception('You cannot use a crustal density model with an error in density due to ambiguity about how to apply this (and because errors will be systematic not random). This variable only works for a constant crustal density. Set error_crust_dens=0')
@@ -412,20 +307,14 @@
                                 'error_dist_crust_dens': error_dist_crust_dens,
                                 })
     if XH2O is not None:
         df_out['error_XH2O']=error_XH2O
         df_out['XH2O_with_noise']=XH2O_with_noise
         df_out['error_type_XH2O']=error_type_XH2O
         df_out['error_dist_XH2O']=error_dist_XH2O
-    else:
-        df_out['error_XH2O']=0
-        df_out['XH2O_with_noise']=0
-
-        
-
 
 
 
     return df_out
 
 
 def loop_all_FI_MC(sample_ID, CO2_dens_gcm3, T_K, N_dup=1000,
@@ -434,25 +323,42 @@
 error_T_K=0, error_type_T_K='Abs', error_dist_T_K='normal',
 error_CO2_dens=0, error_type_CO2_dens='Abs', error_dist_CO2_dens='normal',
                 plot_figure=False, fig_i=0):
     """ This is a redundant function, kept around for a while for backwards compatability"""
 
     print('Please use the new function propagate_FI_uncertainty instead as this allows you use different EOS')
 
+# Check for panda Series
+
+def convert_inputs_to_series(T_K, error_T_K, CO2_dens_gcm3, error_CO2_dens_gcm3, XH2O, error_XH2O):
+    # Create a list of all inputs
+    inputs = [T_K, error_T_K, CO2_dens_gcm3, error_CO2_dens_gcm3, XH2O, error_XH2O]
+    
+    # Convert any numpy arrays in the inputs to pandas Series
+    converted_inputs = [pd.Series(item) if isinstance(item, np.ndarray) else item for item in inputs]
+    
+    # Unpack the converted inputs back to their respective variables
+    T_K, error_T_K, CO2_dens_gcm3, error_CO2_dens_gcm3, XH2O, error_XH2O = converted_inputs
+    
+    # Continue with the function using the possibly converted inputs...
+    # For demonstration, just return the converted inputs
+    return T_K, error_T_K, CO2_dens_gcm3, error_CO2_dens_gcm3, XH2O, error_XH2O
+    
+    
 
 
 def propagate_FI_uncertainty(sample_ID, CO2_dens_gcm3, T_K,  N_dup=1000, EOS='SW96', 
 plot_figure=False, fig_i=0, 
 error_CO2_dens=0, error_type_CO2_dens='Abs', error_dist_CO2_dens='normal',
  crust_dens_kgm3=None, 
  error_crust_dens=0, error_type_crust_dens='Abs', error_dist_crust_dens='uniform',
  model=None, d1=None, d2=None, rho1=None, rho2=None, rho3=None,
 error_T_K=0, error_type_T_K='Abs', error_dist_T_K='normal',
 XH2O=None, error_XH2O=0, error_type_XH2O='Abs', error_dist_XH2O='normal', Hloss=True,
-
+neg_values=True
 ):
 
     """
     This function performs Monte Carlo simulations of uncertainty in CO2 density, input temperature, 
    crustal density and XH2O. If XH2O is specified as not None, it will use Duan and Zhang 2006 EOS
    
     It uses the function 'calculate_temperature_density_MC' to make the simulated variables, 
@@ -495,15 +401,15 @@
         Type of temperature error. Can be 'Abs' or 'Perc'.
     error_dist_T_K: str
         Distribution of temperature error. Can be 'normal' or 'uniform'.
 
 
 
 
-    X_H2O: pd.Series, integer, float
+    XH2O: Default Nan, else pd.Series, integer, float
         mol proportion of H2O in the fluid phase
     error_XH2O: float
         Error in XH2O
     error_type_XH2O: str
         Type of XH2O error. Can be 'Abs' or 'Perc'.
     error_dist_XH2O: str
         Distribution of XH2O error. Can be 'normal' or 'uniform'.
@@ -544,15 +450,17 @@
                     d2: Depth to second transition in km (from surface)
                     rho2: Density between 1st and 2nd transition
                     d3: Depth to third transition in km (from surface)
                     rho3: Density between 2nd and 3rd transition depth.
 
     
 
-
+    neg_values: bool (default True)
+        if True, negative values of input parameters  allowed, if False, makes neg values zero. 
+        
     Returns
     ----------------
 
     df_step, All_outputs,fig if plot_figure is true
 
     df_step: pd.DataFrame
         has 1 row for each entered sample, with mean, median, and standard deviation for each parameter
@@ -561,144 +469,145 @@
         has N_dup rows for each input, e.g. full simulation data for each sample. What is being shown in the figure
     
     fig: figure
         Figure of simulated input and output parameters for 1 sample selected by the user. 
 
 
     """
+    # Check for non pandas series as inputs 
+    T_K, error_T_K, CO2_dens_gcm3, error_CO2_dens, XH2O, error_XH2O = convert_inputs_to_series(
+        T_K, error_T_K, CO2_dens_gcm3, error_CO2_dens, XH2O, error_XH2O)
+    
+    
     if XH2O is not None:
         print('You have entered a value for XH2O, so we are now using the EOS of Duan and Zhang 2006. If you dont want this, specify XH2O=None')
         print('Please note, the DZ2006 EOS is about 5-40X slower to run than the SP94 and SW94 EOS')
+        
     if isinstance(T_K, float) or isinstance(T_K, int) :
         if pd.isna(T_K):
             raise TypeError("Your Input Temperature is NaN - We cant do EOS calculatoins")
+            
     elif isinstance(T_K, pd.Series):
             if T_K.isna().any():
                 raise TypeError("At least one of your Input Temperature is NaN - We cant do EOS calculatoins")
     
     if isinstance(crust_dens_kgm3, str):
         raise TypeError('Do not enter a string for crustal density, put it as a model instead')
 
-    # Set up empty things to fill up.
 
     if type(CO2_dens_gcm3) is pd.Series:
         len_loop=len(CO2_dens_gcm3)
     else:
         len_loop=1
         
-    
-
+    # Setting up empty arrays filled with zeros 
 
+    SingleCalc_D_km = np.zeros(len_loop, dtype=float)
+    SingleCalc_Press_kbar = np.zeros(len_loop, dtype=float)
 
-    SingleCalc_D_km = np.empty(len_loop, dtype=float)
-    SingleCalc_Press_kbar = np.empty(len_loop, dtype=float)
-
-    mean_Press_kbar = np.empty(len_loop, dtype=float)
-    med_Press_kbar = np.empty(len_loop, dtype=float)
-    std_Press_kbar = np.empty(len_loop, dtype=float)
-    std_Press_kbar_IQR=np.empty(len_loop, dtype=float)
-
-    mean_D_km = np.empty(len_loop, dtype=float)
-    med_D_km = np.empty(len_loop, dtype=float)
-    std_D_km = np.empty(len_loop, dtype=float)
-    std_D_km_IQR=np.empty(len_loop, dtype=float)
-    CO2_density_input=np.empty(len_loop, dtype=float)
-    error_crust_dens_loop=np.empty(len_loop, dtype=float)
-    error_crust_dens2_loop=np.empty(len_loop, dtype=float)
-    Sample=np.empty(len_loop,  dtype=np.dtype('U100') )
+    mean_Press_kbar = np.zeros(len_loop, dtype=float)
+    med_Press_kbar = np.zeros(len_loop, dtype=float)
+    std_Press_kbar = np.zeros(len_loop, dtype=float)
+    std_Press_kbar_IQR=np.zeros(len_loop, dtype=float)
+
+    mean_D_km = np.zeros(len_loop, dtype=float)
+    med_D_km = np.zeros(len_loop, dtype=float)
+    std_D_km = np.zeros(len_loop, dtype=float)
+    std_D_km_IQR=np.zeros(len_loop, dtype=float)
+    CO2_density_input=np.zeros(len_loop, dtype=float)
+    error_crust_dens_loop=np.zeros(len_loop, dtype=float)
+    error_crust_dens2_loop=np.zeros(len_loop, dtype=float)
+    Sample=np.zeros(len_loop,  dtype=np.dtype('U100') )
 
     All_outputs=pd.DataFrame([])
 
     # Lets calculate the parameters not using any errors, to be able to plot an error bar around each point
 
     df_ind=convert_co2_dens_press_depth(T_K=T_K,
     CO2_dens_gcm3=CO2_dens_gcm3,
     crust_dens_kgm3=crust_dens_kgm3, output='kbar',
     g=9.81, model=model,
     d1=d1, d2=d2, rho1=rho1, rho2=rho2, rho3=rho3, EOS=EOS, XH2O=XH2O, Hloss=Hloss)
 
 
 
     #This loops through each fluid inclusion entered density
-    for i in range(0, len_loop):
-        if i % 20 == 0:
-            print('working on sample number '+str(i))
+    
 
+    for i in tqdm(range(0, len_loop), desc="Processing"):
+
+        
+        # This fills in the columns for the single calculation, e.g. no Monte-Carloing from above. 
         SingleCalc_D_km[i]=df_ind['Depth (km)'].iloc[i]
         SingleCalc_Press_kbar[i]=df_ind['Pressure (kbar)'].iloc[i]
-
-
-        # If user has entered a pandas series for error, takes right one for each loop
-        if type(error_T_K) is pd.Series:
-            error_T_K=error_T_K.iloc[i]
-        else:
-            error_T_K=error_T_K
-
-        if type(T_K) is pd.Series:
-            T_K_i=T_K.iloc[i]
-        else:
-            T_K_i=T_K
-
-
-        if type(CO2_dens_gcm3) is pd.Series:
-            CO2_dens_gcm3_i=CO2_dens_gcm3.iloc[i]
-        else:
-            CO2_dens_gcm3_i=CO2_dens_gcm3
-
-
-        if type(error_CO2_dens) is pd.Series:
-            error_CO2_dens=error_CO2_dens.iloc[i]
-        else:
-            error_CO2_dens=error_CO2_dens
-            
+        
+        # Now lets get the value, using the function in the CO2_in_bubble_error.py file
+        error_T_K_i=get_value(error_T_K, i)
+        T_K_i=get_value(T_K, i)
+        
+        CO2_dens_gcm3_i=get_value(CO2_dens_gcm3, i)
+        error_CO2_dens_i=get_value(error_CO2_dens, i)
+        
+        crust_dens_kgm3_i=get_value(crust_dens_kgm3, i)
+        error_crust_dens_i=get_value(error_crust_dens, i)
+        # Now, if XH2O was entered, and isnt None, do the same. Else keeps as None. 
         if XH2O is not None:
-            if type(error_XH2O) is pd.Series:
-                error_XH2O=error_XH2O.iloc[i]
-            else:
-                error_XH2O=error_XH2O
-
-        if type(error_crust_dens) is pd.Series:
-            error_crust_dens=error_crust_dens.iloc[i]
-        else:
-            error_crust_dens=error_crust_dens
-            
+            error_XH2O_i=get_value(error_XH2O, i)
+            XH2O_i=get_value(XH2O, i)
         
 
 
         # This is the function doing the work to actually make the simulations for each variable.
+        # For each input variable, it makes a distribution. 
+        
+        # If XH2O is None, it doesnt return the column XH2O_with_noise, which helps ID this later. 
         if XH2O is None:
-            df_synthetic=calculate_temperature_density_MC(sample_i=i, N_dup=N_dup, CO2_dens_gcm3=CO2_dens_gcm3,
-        T_K=T_K, error_T_K=error_T_K, error_type_T_K=error_type_T_K, error_dist_T_K=error_dist_T_K,
-        error_CO2_dens=error_CO2_dens, error_type_CO2_dens=error_type_CO2_dens, error_dist_CO2_dens=error_dist_CO2_dens,
-        crust_dens_kgm3=crust_dens_kgm3,  error_crust_dens=error_crust_dens, error_type_crust_dens= error_type_crust_dens, error_dist_crust_dens=error_dist_crust_dens,
-    model=model)
+            
+            df_synthetic=calculate_temperature_density_MC(N_dup=N_dup, CO2_dens_gcm3=CO2_dens_gcm3_i,
+        T_K=T_K_i, error_T_K=error_T_K_i, error_type_T_K=error_type_T_K, error_dist_T_K=error_dist_T_K,
+        error_CO2_dens=error_CO2_dens_i, error_type_CO2_dens=error_type_CO2_dens, error_dist_CO2_dens=error_dist_CO2_dens,
+        crust_dens_kgm3=crust_dens_kgm3_i,  error_crust_dens=error_crust_dens_i, error_type_crust_dens= error_type_crust_dens, error_dist_crust_dens=error_dist_crust_dens,
+    model=model, neg_values=neg_values)
+    
+            if model is None:
+                MC_T=convert_co2_dens_press_depth(T_K=df_synthetic['T_K_with_noise'],
+                                                CO2_dens_gcm3=df_synthetic['CO2_dens_with_noise'],
+                                            crust_dens_kgm3=df_synthetic['crust_dens_with_noise'],
+                                            d1=d1, d2=d2, rho1=rho1, rho2=rho2, rho3=rho3,model=model,
+                                                EOS=EOS )
+            else:
+                MC_T=convert_co2_dens_press_depth(T_K=df_synthetic['T_K_with_noise'],
+                                                CO2_dens_gcm3=df_synthetic['CO2_dens_with_noise'],
+                                                d1=d1, d2=d2, rho1=rho1, rho2=rho2, rho3=rho3,
+                                            model=model, EOS=EOS)
     
         if XH2O is not None:
-            df_synthetic=calculate_temperature_density_MC(sample_i=i, N_dup=N_dup, CO2_dens_gcm3=CO2_dens_gcm3,
-        T_K=T_K, error_T_K=error_T_K, error_type_T_K=error_type_T_K, error_dist_T_K=error_dist_T_K,
-        error_CO2_dens=error_CO2_dens, error_type_CO2_dens=error_type_CO2_dens, error_dist_CO2_dens=error_dist_CO2_dens,
-        crust_dens_kgm3=crust_dens_kgm3,  error_crust_dens=error_crust_dens, error_type_crust_dens= error_type_crust_dens, error_dist_crust_dens=error_dist_crust_dens,
-    model=model, XH2O=XH2O, error_XH2O=error_XH2O, error_type_XH2O=error_type_XH2O, error_dist_XH2O=error_dist_XH2O)
+            
+            df_synthetic=calculate_temperature_density_MC(N_dup=N_dup, CO2_dens_gcm3=CO2_dens_gcm3_i,
+        T_K=T_K_i, error_T_K=error_T_K_i, error_type_T_K=error_type_T_K, error_dist_T_K=error_dist_T_K,
+        error_CO2_dens=error_CO2_dens_i, error_type_CO2_dens=error_type_CO2_dens, error_dist_CO2_dens=error_dist_CO2_dens,
+        crust_dens_kgm3=crust_dens_kgm3_i,  error_crust_dens=error_crust_dens_i, error_type_crust_dens= error_type_crust_dens, error_dist_crust_dens=error_dist_crust_dens,
+    model=model, XH2O=XH2O_i, error_XH2O=error_XH2O_i, error_type_XH2O=error_type_XH2O, error_dist_XH2O=error_dist_XH2O,  neg_values=neg_values)
             
 
         # Convert to densities for MC
 
-        if model is None:
-            MC_T=convert_co2_dens_press_depth(T_K=df_synthetic['T_K_with_noise'],
-                                            CO2_dens_gcm3=df_synthetic['CO2_dens_with_noise'],
-                                        crust_dens_kgm3=df_synthetic['crust_dens_with_noise'],
-                                        XH2O=df_synthetic['XH2O_with_noise'], Hloss=Hloss,
-                                        d1=d1, d2=d2, rho1=rho1, rho2=rho2, rho3=rho3,model=model,
-                                            EOS=EOS,  )
-        else:
-            MC_T=convert_co2_dens_press_depth(T_K=df_synthetic['T_K_with_noise'],
-                                            CO2_dens_gcm3=df_synthetic['CO2_dens_with_noise'],
-                                           XH2O=df_synthetic['XH2O_with_noise'], Hloss=Hloss,
-                                            d1=d1, d2=d2, rho1=rho1, rho2=rho2, rho3=rho3,
-                                        model=model, EOS=EOS)
+            if model is None:
+                MC_T=convert_co2_dens_press_depth(T_K=df_synthetic['T_K_with_noise'],
+                                                CO2_dens_gcm3=df_synthetic['CO2_dens_with_noise'],
+                                            crust_dens_kgm3=df_synthetic['crust_dens_with_noise'],
+                                            XH2O=df_synthetic['XH2O_with_noise'], Hloss=Hloss,
+                                            d1=d1, d2=d2, rho1=rho1, rho2=rho2, rho3=rho3,model=model,
+                                                EOS=EOS )
+            else:
+                MC_T=convert_co2_dens_press_depth(T_K=df_synthetic['T_K_with_noise'],
+                                                CO2_dens_gcm3=df_synthetic['CO2_dens_with_noise'],
+                                            XH2O=df_synthetic['XH2O_with_noise'], Hloss=Hloss,
+                                                d1=d1, d2=d2, rho1=rho1, rho2=rho2, rho3=rho3,
+                                            model=model, EOS=EOS)
 
 
 
 
 
         # Check of
         if sample_ID is None:
@@ -746,15 +655,14 @@
 
 
     
     df_step=pd.DataFrame(data={'Filename': Sample,
                         'CO2_dens_gcm3': CO2_density_input,
                          'SingleFI_D_km': SingleCalc_D_km,
                          'SingleFI_P_kbar': SingleCalc_Press_kbar,
-
                              'Mean_MC_P_kbar': mean_Press_kbar,
                          'Med_MC_P_kbar': med_Press_kbar,
                             'std_dev_MC_P_kbar': std_Press_kbar,
 'std_dev_MC_P_kbar_from_percentile': std_Press_kbar_IQR,
                           'Mean_MC_D_km': mean_D_km,
                          'Med_MC_D_km': med_D_km,
                         'std_dev_MC_D_km': std_D_km,
@@ -912,14 +820,16 @@
         dataframe of pressure, depth, and input parameterss
     
     """
 
 
 
     # First step is to get pressure
+    
+    
     if XH2O is None:
         Pressure=calculate_P_for_rho_T(T_K=T_K,
                     CO2_dens_gcm3=CO2_dens_gcm3,
                     EOS=EOS)
                     
         # Second step is to get crustal depths
 
@@ -945,16 +855,15 @@
                                         'Pressure (MPa)': Pressure['P_MPa'],
                                         'Depth (km)': Depth_km,
                                         'input_crust_dens_kgm3': crust_dens_kgm3,
                                         'model': model,
                                         'MC_T_K': T_K,
                                         'MC_CO2_dens_gcm3': CO2_dens_gcm3})
     
-        #df.replace([np.inf, -np.inf], np.nan, inplace=True)
-    
+        
                     
         # Make as a dict to allow index=0 if depth is float, else not. 
         data_dict = {
             'Pressure (kbar)': [Pressure['P_kbar']],
             'Pressure (MPa)': [Pressure['P_MPa']],
             'Depth (km)': [Depth_km] if isinstance(Depth_km, float) else Depth_km,
             'input_crust_dens_kgm3': [crust_dens_kgm3],
@@ -963,16 +872,18 @@
             'MC_CO2_dens_gcm3': [CO2_dens_gcm3]
         }
         
 
     
         
     # If XH2O, need different outputs. 
+    
     else:
         
+        
         P_kbar_calc=pf.calculate_entrapment_P_XH2O(XH2O=XH2O, CO2_dens_gcm3=CO2_dens_gcm3, T_K=T_K, T_K_ambient=T_K_ambient, fast_calcs=True, Hloss=Hloss )
         
         
         Depth_km=convert_pressure_to_depth(P_kbar_calc,
                         crust_dens_kgm3=crust_dens_kgm3,     g=9.81, model=model,
             d1=d1, d2=d2, rho1=rho1, rho2=rho2, rho3=rho3)
```

### Comparing `DiadFit-0.0.85/src/DiadFit/importing_data_files.py` & `DiadFit-0.0.88/src/DiadFit/importing_data_files.py`

 * *Files 2% similar despite different names*

```diff
@@ -10,14 +10,78 @@
 from os import listdir
 from os.path import isfile, join
 from tqdm import tqdm
 import datetime
 import calendar
 
 encode="ISO-8859-1"
+## GEt video mag
+
+# Function to check if "Video Image" is in the first line, considering variations
+def line_contains_video_image(line):
+    """ This function returns video image information """
+    return "video image" in line.lower()
+    
+
+def get_video_mag(metadata_path):
+    """ This function finds all the video files in a single folder, and returns a dataframe of the filename and the magnification used. 
+    """
+    folder_path=metadata_path
+    data=[]
+    
+    
+    # Code below this
+    
+    
+    
+    # Ensure the directory exists and contains files
+    if os.path.exists(folder_path) and os.path.isdir(folder_path):
+        # Go through each file in the folder
+        for filename in os.listdir(folder_path):
+            if filename.endswith('.txt'):  # Confirming it's a text file
+                file_path = os.path.join(folder_path, filename)
+                with open(file_path, 'r', encoding="ISO-8859-1") as file:
+                    first_line = file.readline()
+                    # Initialize placeholders for magnification, width, and height
+                    magnification = None
+                    image_width = None
+                    image_height = None
+                    
+                    if "video image" in first_line.lower():  # Checks if "Video Image" is in the line
+                        for line in file:
+                            if "Objective Magnification:" in line:
+                                magnification = line.split(":")[-1].strip()
+                            elif "Image Width [m]:" in line:
+                                image_width = line.split(":")[-1].strip()
+                            elif "Image Height [m]:" in line:
+                                image_height = line.split(":")[-1].strip()
+                                
+                        # Add to data if magnification is found (assuming it's mandatory)
+                        if magnification:
+                            data.append({
+                                "Filename": filename,
+                                "Mag": magnification,
+                                "Width (m)": image_width,
+                                "Height (m)": image_height
+                            })
+    else:
+        print(f"The specified path {folder_path} does not exist or is not a directory.")
+    
+    # Create a DataFrame from the data
+    df = pd.DataFrame(data)
+    
+    # Display the DataFrame or a message if empty
+    if not df.empty:
+        return df
+    else:
+        print("No data found. Please check the folder path and the content of the files.")
+
+
+
+
 
 ## Functions for getting file names
 
 
 def check_for_duplicates(spectra_path, prefix=True, prefix_str=' ', exception=True):
     """    This function checks for duplicate filenames in a specified directory and prints the duplicates if found.
     
@@ -33,15 +97,15 @@
     file_m (numpy.ndarray): A numpy array containing the modified filenames after removing the prefix (if specified).
     
     
     """
 
     All_files_spectra= [f for f in listdir(spectra_path) if isfile(join(spectra_path, f))]
 
-    file_m=np.empty(len(All_files_spectra), dtype=object)
+    file_m=np.zeros(len(All_files_spectra), dtype=object)
     for i in range(0, len(All_files_spectra)):
         name=All_files_spectra[i]
         # If no prefix or suffix to remove, simple
         if prefix is False:
             name2=name
         else:
             name2=name.split(prefix_str, maxsplit=1)[1:]
@@ -125,14 +189,16 @@
     # Use only txt files
     type(Allfiles_all)
     All_files=[]
     for file in Allfiles_all:
         if '.txt' in file and 'pandas' not in file:
             All_files.append(format(file))
     return All_files
+    
+# Function to get magnification of 
 
 
 ## Functions to just simply get data to plot up
 def get_data(*, path=None, filename=None, Diad_files=None, filetype='Witec_ASCII'):
     """
     Extracts data as a np.array from user file of differen types
 
@@ -921,22 +987,22 @@
     time_str=[]
     hour_str=[]
     filename_str=[]
     duration_str=[]
     date_str=[]
     month_str=[]
     # Numerical values
-    Int_time=np.empty(len(Allfiles), dtype=float)
-    objec=np.empty(len(Allfiles), dtype=float)
-    time=np.empty(len(Allfiles), dtype=float)
-
-    Day=np.empty(len(Allfiles), dtype=float)
-    power=np.empty(len(Allfiles), dtype=float)
-    accumulations=np.empty(len(Allfiles), dtype=float)
-    spectral_cent=np.empty(len(Allfiles), dtype=float)
+    Int_time=np.zeros(len(Allfiles), dtype=float)
+    objec=np.zeros(len(Allfiles), dtype=float)
+    time=np.zeros(len(Allfiles), dtype=float)
+
+    Day=np.zeros(len(Allfiles), dtype=float)
+    power=np.zeros(len(Allfiles), dtype=float)
+    accumulations=np.zeros(len(Allfiles), dtype=float)
+    spectral_cent=np.zeros(len(Allfiles), dtype=float)
 
     for i in tqdm(range(0, len(Allfiles))):
         filename1=Allfiles[i] #.rsplit('.',1)[0]
         if prefix is True:
             filename=filename1.split(str_prefix)[1:][0]
 
         else:
@@ -1077,15 +1143,15 @@
     #     names=names.str.split(str_suffix).str[1]
 
     # if file_type is not None:
     #     names=names.str.replace(file_type, '')
 
     file_m=list(names)
 
-    file_m=np.empty(len(names), dtype=object)
+    file_m=np.zeros(len(names), dtype=object)
     for i in range(0, len(names)):
         name=names.iloc[i]
         # If no prefix or suffix to remove, simple
         if prefix is False and suffix is False:
             file_m[i]=name
             #print(file_m)
 
@@ -1122,20 +1188,20 @@
     return file_m
 
 # These are largely redundant.  
 def extract_temp_Aranet(df):
     """ Extracts temperature data from the aranet
     """
     TD=str(Temp['Time(dd/mm/yyyy)'])
-    hour=np.empty(len(Temp), dtype=object)
-    date=np.empty(len(Temp), dtype=object)
-    time=np.empty(len(Temp), dtype=object)
-    minutes=np.empty(len(Temp), dtype=object)
-    seconds=np.empty(len(Temp), dtype=object)
-    secs_sm=np.empty(len(Temp), dtype=object)
+    hour=np.zeros(len(Temp), dtype=object)
+    date=np.zeros(len(Temp), dtype=object)
+    time=np.zeros(len(Temp), dtype=object)
+    minutes=np.zeros(len(Temp), dtype=object)
+    seconds=np.zeros(len(Temp), dtype=object)
+    secs_sm=np.zeros(len(Temp), dtype=object)
     for i in range(0, len(Temp)):
         TD=str(Temp['Time(dd/mm/yyyy)'].iloc[i])
         date[i]=TD.split(' ')[0]
         time[i]=TD.split(' ')[1]
         hour[i]=time[i].split(':')[0]
         minutes[i]=time[i].split(':')[1]
         seconds[i]=time[i].split(':')[2]
```

### Comparing `DiadFit-0.0.85/src/DiadFit/lookup_table.csv` & `DiadFit-0.0.88/src/DiadFit/lookup_table.csv`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/lookup_table_noneg.csv` & `DiadFit-0.0.88/src/DiadFit/lookup_table_noneg.csv`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/molar_gas_proportions.py` & `DiadFit-0.0.88/src/DiadFit/molar_gas_proportions.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit/ne_lines.py` & `DiadFit-0.0.88/src/DiadFit/ne_lines.py`

 * *Files 2% similar despite different names*

```diff
@@ -42,15 +42,24 @@
    -------------
    Closest theoretical line position
 
     """
     dist = (df['Raman_shift (cm-1)'] - line1_shift).abs()
     return df.loc[dist.idxmin()]
 
-
+def find_max_row(df, target_shift, tol=2):
+    """ This function is used to find the highest amplitude within a predefined ampl range for finding the right Ne line
+    """
+    
+    df_filtered = df[(df['Raman_shift (cm-1)'] >= target_shift - tol) & (df['Raman_shift (cm-1)'] <= target_shift + tol)]
+    
+    # Find the row with the maximum intensity within this filtered DataFrame
+    max_intensity_row = df_filtered.loc[df_filtered['Intensity'].idxmax()]
+    
+    return max_intensity_row
 
 def calculate_Ne_splitting(wavelength=532.05, line1_shift=1117, line2_shift=1447, cut_off_intensity=2000):
     """
     Calculates ideal splitting in air between lines closest to user-specified line shift. E.g. if user enters
     1117 and 1447 line, it looks for the nearest theoretical Ne line position based on your wavelength, 
     and calculates the ideal splitting between these theoretical line positions. This is used to calculate the 
     ideal Ne line splitting for doing the Ne correction routine of Lamadrid et al. (2017)
@@ -68,31 +77,56 @@
 
     Returns
     ----------
     df of theoretical splitting, line positions used for this, and entered Ne line positions
     """
 
     df_Ne=calculate_Ne_line_positions(wavelength=wavelength, cut_off_intensity=cut_off_intensity)
-
-    closest1=find_closest(df_Ne, line1_shift).loc['Raman_shift (cm-1)']
-    closest2=find_closest(df_Ne, line2_shift).loc['Raman_shift (cm-1)']
-    closest_1_int=find_closest(df_Ne, line1_shift).loc['Intensity']
-    closest_2_int=find_closest(df_Ne, line2_shift).loc['Intensity']
-
-    diff=abs(closest1-closest2)
-
-    df=pd.DataFrame(data={'Ne_Split': diff,
+    # 
+    # closest1=find_closest(df_Ne, line1_shift).loc['Raman_shift (cm-1)']
+    # closest2=find_closest(df_Ne, line2_shift).loc['Raman_shift (cm-1)']
+    # closest_1_int=find_closest(df_Ne, line1_shift).loc['Intensity']
+    # closest_2_int=find_closest(df_Ne, line2_shift).loc['Intensity']
+    # 
+    # diff=abs(closest1-closest2)
+    # 
+    # df=pd.DataFrame(data={'Ne_Split': diff,
+    # 'Line_1': closest1,
+    # 'Line_2': closest2,
+    # 'Line_1_int': closest_1_int,
+    # 'Line_2_int': closest_2_int,
+    # 'Entered Pos Line 1': line1_shift,
+    # 'Entered Pos Line 2': line2_shift}, index=[0])
+    # 
+    # 
+    # return df
+# Use the new function to find the lines of interest
+    closest1_row = find_max_row(df_Ne, line1_shift)
+    closest2_row = find_max_row(df_Ne, line2_shift)
+    
+    # Extract the required values from the rows
+    closest1 = closest1_row['Raman_shift (cm-1)']
+    closest2 = closest2_row['Raman_shift (cm-1)']
+    closest_1_int = closest1_row['Intensity']
+    closest_2_int = closest2_row['Intensity']
+    
+    # Calculate the difference
+    diff = abs(closest1 - closest2)
+    
+    # Create the DataFrame
+    df = pd.DataFrame(data={
+    'Ne_Split': diff,
     'Line_1': closest1,
     'Line_2': closest2,
     'Line_1_int': closest_1_int,
     'Line_2_int': closest_2_int,
     'Entered Pos Line 1': line1_shift,
-    'Entered Pos Line 2': line2_shift}, index=[0])
-
-
+    'Entered Pos Line 2': line2_shift
+    }, index=[0])
+    
     return df
 
 def calculate_Ne_line_positions(wavelength=532.05, cut_off_intensity=2000):
     """
     Calculates Raman shift for a given laser wavelength of Ne lines, using the datatable from NIST of Ne line
     emissoin in air and the intensity of each line. 
     Data from https://physics.nist.gov/PhysRefData/ASD/lines_form.html
@@ -127,18 +161,15 @@
     551.1176,
     551.1485,
     
     552.063,
     553.36788,
     553.86510,
     555.90978,
-    556.24416,
-    
-    556.27662,
-    556.30531,
+
     
     
     
     556.244160,
     556.276620,
     556.305310,
     557.603940,
@@ -329,18 +360,15 @@
     30,
     150,
     
     30,
     750,
     500,
     350,
-    1500,
-    
-    5000,
-    750,
+
     
     
     
     
     
     1500.00,
     5000.00,
@@ -1724,16 +1752,16 @@
     """ This function discards Ne lines with a correction factor more than 
     offset away from the median value of the N points (number_av) either side of it.
     
 
     """
     if df_combo is not None:
         Corr_factor=df_combo['Ne_Corr']
-    Corr_factor_Filt=np.empty(len(Corr_factor), dtype=float)
-    median_loop=np.empty(len(Corr_factor), dtype=float)
+    Corr_factor_Filt=np.zeros(len(Corr_factor), dtype=float)
+    median_loop=np.zeros(len(Corr_factor), dtype=float)
 
     for i in range(0, len(Corr_factor)):
         if i<len(Corr_factor)/2: # For first half, do 5 after
             median_loop[i]=np.nanmedian(Corr_factor[i:i+number_av])
         if i>=len(Corr_factor)/2: # For first half, do 5 after
             median_loop[i]=np.nanmedian(Corr_factor[i-number_av:i])
         if Corr_factor[i]>(median_loop[i]+offset) or Corr_factor[i]<(median_loop[i]-offset) :
```

### Comparing `DiadFit-0.0.85/src/DiadFit/relaxifi.py` & `DiadFit-0.0.88/src/DiadFit/relaxifi.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.85/src/DiadFit.egg-info/PKG-INFO` & `DiadFit-0.0.88/src/DiadFit.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: DiadFit
-Version: 0.0.85
+Version: 0.0.88
 Summary: DiadFit
 Home-page: https://github.com/PennyWieser/DiadFit
 Author: Penny Wieser
 Author-email: penny.wieser@gmail.com
 License: UNKNOWN
 Description: [![PyPI](https://badgen.net/pypi/v/DiadFit)](https://pypi.org/project/DiadFit/)
         [![Build Status](https://github.com/PennyWieser/DiadFit/actions/workflows/main.yml/badge.svg?branch=main)](https://github.com/PennyWieser/DiadFit/actions/workflows/main.yml)
```

### Comparing `DiadFit-0.0.85/src/DiadFit.egg-info/SOURCES.txt` & `DiadFit-0.0.88/src/DiadFit.egg-info/SOURCES.txt`

 * *Files 10% similar despite different names*

```diff
@@ -2,28 +2,36 @@
 setup.py
 src/DiadFit/CO2_EOS.py
 src/DiadFit/CO2_H2O_EOS.py
 src/DiadFit/CO2_in_bubble_error.py
 src/DiadFit/H2O_fitting.py
 src/DiadFit/Highrho_polyfit_data.pkl
 src/DiadFit/Highrho_polyfit_dataUCB_1117_1400.pkl
+src/DiadFit/Highrho_polyfit_dataUCB_1117_1447.pkl
 src/DiadFit/Highrho_polyfit_dataUCB_1220_1400.pkl
 src/DiadFit/Highrho_polyfit_dataUCB_1220_1447.pkl
+src/DiadFit/Highrho_polyfit_dataUCB_1220_1567.pkl
 src/DiadFit/Highrho_polyfit_data_CCMR.pkl
 src/DiadFit/Highrho_polyfit_data_CMASS.pkl
+src/DiadFit/Highrho_polyfit_data_CMASS_24C.pkl
 src/DiadFit/Lowrho_polyfit_data.pkl
 src/DiadFit/Lowrho_polyfit_dataUCB_1117_1400.pkl
+src/DiadFit/Lowrho_polyfit_dataUCB_1117_1447.pkl
 src/DiadFit/Lowrho_polyfit_dataUCB_1220_1400.pkl
 src/DiadFit/Lowrho_polyfit_dataUCB_1220_1447.pkl
+src/DiadFit/Lowrho_polyfit_dataUCB_1220_1567.pkl
 src/DiadFit/Lowrho_polyfit_data_CCMR.pkl
 src/DiadFit/Lowrho_polyfit_data_CMASS.pkl
+src/DiadFit/Lowrho_polyfit_data_CMASS_24C.pkl
 src/DiadFit/Mediumrho_polyfit_data.pkl
 src/DiadFit/Mediumrho_polyfit_dataUCB_1117_1400.pkl
+src/DiadFit/Mediumrho_polyfit_dataUCB_1117_1447.pkl
 src/DiadFit/Mediumrho_polyfit_dataUCB_1220_1400.pkl
 src/DiadFit/Mediumrho_polyfit_dataUCB_1220_1447.pkl
+src/DiadFit/Mediumrho_polyfit_dataUCB_1220_1567.pkl
 src/DiadFit/Mediumrho_polyfit_data_CCMR.pkl
 src/DiadFit/Mediumrho_polyfit_data_CMASS.pkl
 src/DiadFit/Psensor.py
 src/DiadFit/__init__.py
 src/DiadFit/_version.py
 src/DiadFit/argon_lines.py
 src/DiadFit/cosmicray_filter.py
```

