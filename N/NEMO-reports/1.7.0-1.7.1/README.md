# Comparing `tmp/NEMO_reports-1.7.0-py3-none-any.whl.zip` & `tmp/NEMO_reports-1.7.1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,31 +1,31 @@
-Zip file size: 46950 bytes, number of entries: 29
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-12 19:58 NEMO_reports/__init__.py
--rw-r--r--  2.0 unx       41 b- defN 24-Apr-12 19:58 NEMO_reports/app_settings.py
--rw-r--r--  2.0 unx      486 b- defN 24-Apr-12 19:58 NEMO_reports/apps.py
--rw-r--r--  2.0 unx     1682 b- defN 24-Apr-12 19:58 NEMO_reports/customizations.py
--rw-r--r--  2.0 unx     1620 b- defN 24-Apr-12 19:58 NEMO_reports/urls.py
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-12 19:58 NEMO_reports/migrations/__init__.py
--rw-rw-rw-  2.0 unx      243 b- defN 24-Apr-12 19:58 NEMO_reports/static/NEMO_reports/NEMO_reports.css
--rw-rw-rw-  2.0 unx     7659 b- defN 24-Apr-12 19:58 NEMO_reports/static/NEMO_reports/daterangepicker.css
--rw-rw-rw-  2.0 unx    66305 b- defN 24-Apr-12 19:58 NEMO_reports/static/NEMO_reports/daterangepicker.js
--rw-rw-rw-  2.0 unx     2346 b- defN 24-Apr-12 19:58 NEMO_reports/templates/NEMO_reports/report_active_users.html
--rw-rw-rw-  2.0 unx     7103 b- defN 24-Apr-12 19:58 NEMO_reports/templates/NEMO_reports/report_base.html
--rw-rw-rw-  2.0 unx     1703 b- defN 24-Apr-12 19:58 NEMO_reports/templates/NEMO_reports/report_facility_usage.html
--rw-rw-rw-  2.0 unx     2782 b- defN 24-Apr-12 19:58 NEMO_reports/templates/NEMO_reports/report_new_users.html
--rw-rw-rw-  2.0 unx      908 b- defN 24-Apr-12 19:58 NEMO_reports/templates/NEMO_reports/reports.html
--rw-rw-rw-  2.0 unx      269 b- defN 24-Apr-12 19:58 NEMO_reports/templates/base/navbar.html
--rw-rw-rw-  2.0 unx      138 b- defN 24-Apr-12 19:58 NEMO_reports/templates/base/navbar_reports.html
--rw-rw-rw-  2.0 unx     4688 b- defN 24-Apr-12 19:58 NEMO_reports/templates/customizations/customizations_reports.html
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-12 19:58 NEMO_reports/views/__init__.py
--rw-r--r--  2.0 unx    18987 b- defN 24-Apr-12 19:58 NEMO_reports/views/reporting.py
--rw-r--r--  2.0 unx    15017 b- defN 24-Apr-12 19:58 NEMO_reports/views/reporting_facilily_usage.py
--rw-r--r--  2.0 unx    12381 b- defN 24-Apr-12 19:58 NEMO_reports/views/reporting_invoice_charges.py
--rw-r--r--  2.0 unx    16324 b- defN 24-Apr-12 19:58 NEMO_reports/views/reporting_invoice_item_charges.py
--rw-r--r--  2.0 unx    28491 b- defN 24-Apr-12 19:58 NEMO_reports/views/reporting_new_user_activities.py
--rw-r--r--  2.0 unx    15375 b- defN 24-Apr-12 19:58 NEMO_reports/views/reporting_unique_user_prj_acc.py
--rw-rw-rw-  2.0 unx     1074 b- defN 24-Apr-12 19:58 NEMO_reports-1.7.0.dist-info/LICENSE
--rw-r--r--  2.0 unx     2116 b- defN 24-Apr-12 19:58 NEMO_reports-1.7.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-Apr-12 19:58 NEMO_reports-1.7.0.dist-info/WHEEL
--rw-r--r--  2.0 unx       13 b- defN 24-Apr-12 19:58 NEMO_reports-1.7.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2817 b- defN 24-Apr-12 19:58 NEMO_reports-1.7.0.dist-info/RECORD
-29 files, 210660 bytes uncompressed, 42262 bytes compressed:  79.9%
+Zip file size: 46705 bytes, number of entries: 29
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-16 00:06 NEMO_reports/__init__.py
+-rw-r--r--  2.0 unx       41 b- defN 24-Apr-16 00:06 NEMO_reports/app_settings.py
+-rw-r--r--  2.0 unx      486 b- defN 24-Apr-16 00:06 NEMO_reports/apps.py
+-rw-r--r--  2.0 unx     1682 b- defN 24-Apr-16 00:06 NEMO_reports/customizations.py
+-rw-r--r--  2.0 unx     1620 b- defN 24-Apr-16 00:06 NEMO_reports/urls.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-16 00:06 NEMO_reports/migrations/__init__.py
+-rw-rw-rw-  2.0 unx      243 b- defN 24-Apr-16 00:06 NEMO_reports/static/NEMO_reports/NEMO_reports.css
+-rw-rw-rw-  2.0 unx     7659 b- defN 24-Apr-16 00:06 NEMO_reports/static/NEMO_reports/daterangepicker.css
+-rw-rw-rw-  2.0 unx    66305 b- defN 24-Apr-16 00:06 NEMO_reports/static/NEMO_reports/daterangepicker.js
+-rw-rw-rw-  2.0 unx     2346 b- defN 24-Apr-16 00:06 NEMO_reports/templates/NEMO_reports/report_active_users.html
+-rw-rw-rw-  2.0 unx     7103 b- defN 24-Apr-16 00:06 NEMO_reports/templates/NEMO_reports/report_base.html
+-rw-rw-rw-  2.0 unx     1703 b- defN 24-Apr-16 00:06 NEMO_reports/templates/NEMO_reports/report_facility_usage.html
+-rw-rw-rw-  2.0 unx     2782 b- defN 24-Apr-16 00:06 NEMO_reports/templates/NEMO_reports/report_new_users.html
+-rw-rw-rw-  2.0 unx      908 b- defN 24-Apr-16 00:06 NEMO_reports/templates/NEMO_reports/reports.html
+-rw-rw-rw-  2.0 unx      269 b- defN 24-Apr-16 00:06 NEMO_reports/templates/base/navbar.html
+-rw-rw-rw-  2.0 unx      138 b- defN 24-Apr-16 00:06 NEMO_reports/templates/base/navbar_reports.html
+-rw-rw-rw-  2.0 unx     4688 b- defN 24-Apr-16 00:06 NEMO_reports/templates/customizations/customizations_reports.html
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-16 00:06 NEMO_reports/views/__init__.py
+-rw-r--r--  2.0 unx    18987 b- defN 24-Apr-16 00:06 NEMO_reports/views/reporting.py
+-rw-r--r--  2.0 unx    15017 b- defN 24-Apr-16 00:06 NEMO_reports/views/reporting_facilily_usage.py
+-rw-r--r--  2.0 unx    12381 b- defN 24-Apr-16 00:06 NEMO_reports/views/reporting_invoice_charges.py
+-rw-r--r--  2.0 unx    16324 b- defN 24-Apr-16 00:06 NEMO_reports/views/reporting_invoice_item_charges.py
+-rw-r--r--  2.0 unx    24248 b- defN 24-Apr-16 00:06 NEMO_reports/views/reporting_new_user_activities.py
+-rw-r--r--  2.0 unx    15375 b- defN 24-Apr-16 00:06 NEMO_reports/views/reporting_unique_user_prj_acc.py
+-rw-rw-rw-  2.0 unx     1074 b- defN 24-Apr-16 00:06 NEMO_reports-1.7.1.dist-info/LICENSE
+-rw-r--r--  2.0 unx     2116 b- defN 24-Apr-16 00:06 NEMO_reports-1.7.1.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-Apr-16 00:06 NEMO_reports-1.7.1.dist-info/WHEEL
+-rw-r--r--  2.0 unx       13 b- defN 24-Apr-16 00:06 NEMO_reports-1.7.1.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2817 b- defN 24-Apr-16 00:06 NEMO_reports-1.7.1.dist-info/RECORD
+29 files, 206417 bytes uncompressed, 42017 bytes compressed:  79.6%
```

## zipnote {}

```diff
@@ -66,23 +66,23 @@
 
 Filename: NEMO_reports/views/reporting_new_user_activities.py
 Comment: 
 
 Filename: NEMO_reports/views/reporting_unique_user_prj_acc.py
 Comment: 
 
-Filename: NEMO_reports-1.7.0.dist-info/LICENSE
+Filename: NEMO_reports-1.7.1.dist-info/LICENSE
 Comment: 
 
-Filename: NEMO_reports-1.7.0.dist-info/METADATA
+Filename: NEMO_reports-1.7.1.dist-info/METADATA
 Comment: 
 
-Filename: NEMO_reports-1.7.0.dist-info/WHEEL
+Filename: NEMO_reports-1.7.1.dist-info/WHEEL
 Comment: 
 
-Filename: NEMO_reports-1.7.0.dist-info/top_level.txt
+Filename: NEMO_reports-1.7.1.dist-info/top_level.txt
 Comment: 
 
-Filename: NEMO_reports-1.7.0.dist-info/RECORD
+Filename: NEMO_reports-1.7.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## NEMO_reports/views/reporting_new_user_activities.py

```diff
@@ -1,27 +1,26 @@
 import datetime
+from typing import List
 
 from NEMO.models import AccountType, ConsumableWithdraw, User
-from NEMO.typing import QuerySetType
 from NEMO.utilities import beginning_of_the_day, end_of_the_day
-from django.db.models.functions import Coalesce, Least
 
 try:
     from NEMO.models import Discipline as ProjectDiscipline
 except:
     from NEMO.models import ProjectDiscipline
 
 from NEMO.models import (
     AreaAccessRecord,
     Reservation,
     StaffCharge,
     TrainingSession,
     UsageEvent,
 )
-from django.db.models import Case, CharField, DateTimeField, F, OuterRef, Subquery, Value, When
+from django.db.models import CharField, OuterRef, Subquery, Value
 from django.shortcuts import render
 from django.views.decorators.http import require_GET
 
 from NEMO.decorators import accounting_or_manager_required
 from NEMO_reports.views.reporting import (
     ACTIVITIES_PARAMETER_LIST,
     DEFAULT_PARAMETER_LIST,
@@ -169,88 +168,105 @@
     RateCategory = get_rate_category()
     CoreFacility = get_core_facility()
     InstitutionType = get_institution_type()
     Institution = get_institution()
 
     summary_key = summary_key or "value"
     users = get_first_activities_and_data(parameters, start, end)
-    summary.rows[0][summary_key] = users.count()
+    summary.rows[0][summary_key] = len(users)
     current_row = 1
 
     if CoreFacility and CoreFacility.objects.exists():
         for facility in CoreFacility.objects.all():
             current_row += 1
-            summary.rows[current_row][summary_key] = len(users.filter(first_activity_core_facility=facility.name))
+            summary.rows[current_row][summary_key] = len(
+                list(filter(lambda x: x.first_activity_core_facility == facility.name, users))
+            )
         current_row += 1
-        summary.rows[current_row][summary_key] = len(users.filter(first_activity_core_facility__isnull=True))
+        summary.rows[current_row][summary_key] = len(
+            list(filter(lambda x: x.first_activity_core_facility is None, users))
+        )
         current_row += 1  # For mid table header
     if ProjectDiscipline.objects.exists():
         for discipline in ProjectDiscipline.objects.all():
             current_row += 1
-            summary.rows[current_row][summary_key] = len(users.filter(first_activity_discipline=discipline.name))
+            summary.rows[current_row][summary_key] = len(
+                list(filter(lambda x: x.first_activity_discipline == discipline.name, users))
+            )
         current_row += 1
-        summary.rows[current_row][summary_key] = len(users.filter(first_activity_discipline__isnull=True))
+        summary.rows[current_row][summary_key] = len(list(filter(lambda x: x.first_activity_discipline is None, users)))
         current_row += 1  # For mid table header
     if AccountType.objects.exists():
         for account_type in AccountType.objects.all():
             current_row += 1
-            summary.rows[current_row][summary_key] = len(users.filter(first_activity_account_type=account_type.name))
+            summary.rows[current_row][summary_key] = len(
+                list(filter(lambda x: x.first_activity_account_type == account_type.name, users))
+            )
         current_row += 1
-        summary.rows[current_row][summary_key] = len(users.filter(first_activity_account_type__isnull=True))
+        summary.rows[current_row][summary_key] = len(
+            list(filter(lambda x: x.first_activity_account_type is None, users))
+        )
         current_row += 1  # For mid table header
     if RateCategory and RateCategory.objects.exists():
         for category in RateCategory.objects.all():
             current_row += 1
-            summary.rows[current_row][summary_key] = len(users.filter(first_activity_rate_category=category.name))
+            summary.rows[current_row][summary_key] = len(
+                list(filter(lambda x: x.first_activity_rate_category == category.name, users))
+            )
         current_row += 1
-        summary.rows[current_row][summary_key] = len(users.filter(first_activity_rate_category__isnull=True))
+        summary.rows[current_row][summary_key] = len(
+            list(filter(lambda x: x.first_activity_rate_category is None, users))
+        )
         current_row += 1  # For mid table header
     if Institution and Institution.objects.exists():
         for institution in Institution.objects.all():
             current_row += 1
-            summary.rows[current_row][summary_key] = len(users.filter(first_activity_institution_name=institution.name))
+            summary.rows[current_row][summary_key] = len(
+                list(filter(lambda x: x.first_activity_institution_name == institution.name, users))
+            )
         current_row += 1
-        summary.rows[current_row][summary_key] = len(users.filter(first_activity_institution_name__isnull=True))
+        summary.rows[current_row][summary_key] = len(
+            list(filter(lambda x: x.first_activity_institution_name is None, users))
+        )
         current_row += 1  # For mid table header
     if InstitutionType and InstitutionType.objects.exists():
         for institution_type in InstitutionType.objects.all():
             current_row += 1
             summary.rows[current_row][summary_key] = len(
-                users.filter(first_activity_institution_type=institution_type.name)
+                list(filter(lambda x: x.first_activity_institution_type == institution_type.name, users))
             )
         current_row += 1
-        summary.rows[current_row][summary_key] = len(users.filter(first_activity_institution_type__isnull=True))
+        summary.rows[current_row][summary_key] = len(
+            list(filter(lambda x: x.first_activity_institution_type is None, users))
+        )
         current_row += 1  # For mid table header
     current_row += 1
 
 
 def get_first_activities_and_data(
     params: ReportingParameters,
     start: datetime.datetime,
     end: datetime.datetime,
-) -> QuerySetType[User]:
+) -> List[User]:
     origin_start = params.start
     users = User.objects.all()
     during_date_range = params.get_bool("during_date_range")
     origin_start_datetime = beginning_of_the_day(datetime.datetime.combine(origin_start, datetime.time()))
     start_datetime = beginning_of_the_day(datetime.datetime.combine(start, datetime.time()))
     end_datetime = end_of_the_day(datetime.datetime.combine(end, datetime.time()))
-    max_date = datetime.datetime.max - datetime.timedelta(days=1)
-    max_date = max_date.astimezone()
     base_empty_annotations = {}
     for first_type in [
         "first_tool_usage",
         "first_area_access",
         "first_staff_charge",
         "first_training",
         "first_missed_reservation",
         "first_consumable_withdrawal",
         "first_custom_charge",
     ]:
-        base_empty_annotations[first_type] = Value(max_date, output_field=DateTimeField())
         for first_type_property in [
             "_project",
             "_discipline",
             "_account_type",
             "_core_facility",
             "_rate_category",
             "_institution_name",
@@ -260,15 +276,15 @@
     users = users.annotate(**base_empty_annotations)
     if params.get_bool("tool_usage", "on"):
         first_usage_sub = UsageEvent.objects.filter(user=OuterRef("pk"))
         if during_date_range:
             first_usage_sub = first_usage_sub.filter(start__gte=origin_start_datetime)
         first_usage_sub = first_usage_sub.order_by("start")
         users = users.annotate(
-            first_tool_usage=Coalesce(Subquery(first_usage_sub.values("start")[:1]), Value(max_date)),
+            first_tool_usage=Subquery(first_usage_sub.values("start")[:1]),
             first_tool_usage_project=Subquery(first_usage_sub.values("project__name")[:1]),
             first_tool_usage_discipline=Subquery(first_usage_sub.values("project__discipline__name")[:1]),
             first_tool_usage_account_type=Subquery(first_usage_sub.values("project__account__type__name")[:1]),
         )
         if billing_installed():
             users = users.annotate(
                 first_tool_usage_core_facility=Subquery(
@@ -286,15 +302,15 @@
             )
     if params.get_bool("area_access", "on"):
         first_access_sub = AreaAccessRecord.objects.filter(customer=OuterRef("pk"))
         if during_date_range:
             first_access_sub = first_access_sub.filter(start__gte=origin_start_datetime)
         first_access_sub = first_access_sub.order_by("start")
         users = users.annotate(
-            first_area_access=Coalesce(Subquery(first_access_sub.values("start")[:1]), Value(max_date)),
+            first_area_access=Subquery(first_access_sub.values("start")[:1]),
             first_area_access_project=Subquery(first_access_sub.values("project__name")[:1]),
             first_area_access_discipline=Subquery(first_access_sub.values("project__discipline__name")[:1]),
             first_area_access_account_type=Subquery(first_access_sub.values("project__account__type__name")[:1]),
         )
         if billing_installed():
             users = users.annotate(
                 first_area_access_core_facility=Subquery(
@@ -312,15 +328,15 @@
             )
     if params.get_bool("staff_charges", "on"):
         first_staff_charge_sub = StaffCharge.objects.filter(customer=OuterRef("pk"))
         if during_date_range:
             first_staff_charge_sub = first_staff_charge_sub.filter(start__gte=origin_start_datetime)
         first_staff_charge_sub = first_staff_charge_sub.order_by("start")
         users = users.annotate(
-            first_staff_charge=Coalesce(Subquery(first_staff_charge_sub.values("start")[:1]), Value(max_date)),
+            first_staff_charge=Subquery(first_staff_charge_sub.values("start")[:1]),
             first_staff_charge_project=Subquery(first_staff_charge_sub.values("project__name")[:1]),
             first_staff_charge_discipline=Subquery(first_staff_charge_sub.values("project__discipline__name")[:1]),
             first_staff_charge_account_type=Subquery(first_staff_charge_sub.values("project__account__type__name")[:1]),
         )
         if billing_installed():
             users = users.annotate(
                 first_staff_charge_core_facility=Subquery(
@@ -340,15 +356,15 @@
             )
     if params.get_bool("training", "on"):
         first_training_sub = TrainingSession.objects.filter(trainee=OuterRef("pk"))
         if during_date_range:
             first_training_sub = first_training_sub.filter(date__gte=origin_start_datetime)
         first_training_sub = first_training_sub.order_by("date")
         users = users.annotate(
-            first_training=Coalesce(Subquery(first_training_sub.values("date")[:1]), Value(max_date)),
+            first_training=Subquery(first_training_sub.values("date")[:1]),
             first_training_project=Subquery(first_training_sub.values("project__name")[:1]),
             first_training_discipline=Subquery(first_training_sub.values("project__discipline__name")[:1]),
             first_training_account_type=Subquery(first_training_sub.values("project__account__type__name")[:1]),
         )
         if billing_installed():
             users = users.annotate(
                 first_training_core_facility=Subquery(
@@ -366,17 +382,15 @@
             )
     if params.get_bool("missed_reservations", "on"):
         first_missed_sub = Reservation.objects.filter(missed=True, user=OuterRef("pk"))
         if during_date_range:
             first_missed_sub = first_missed_sub.filter(start__gte=origin_start_datetime)
         first_missed_sub = first_missed_sub.order_by("start")
         users = users.annotate(
-            first_missed_reservation=Coalesce(
-                Subquery(first_missed_sub.order_by("start").values("start")[:1]), Value(max_date)
-            ),
+            first_missed_reservation=Subquery(first_missed_sub.order_by("start").values("start")[:1]),
             first_missed_reservation_project=Subquery(first_missed_sub.values("project__name")[:1]),
             first_missed_reservation_discipline=Subquery(first_missed_sub.values("project__discipline__name")[:1]),
             first_missed_reservation_account_type=Subquery(first_missed_sub.values("project__account__type__name")[:1]),
         )
         if billing_installed():
             users = users.annotate(
                 first_missed_reservation_rate_category=Subquery(
@@ -391,15 +405,15 @@
             )
     if params.get_bool("consumables", "on"):
         first_consumable_sub = ConsumableWithdraw.objects.filter(customer=OuterRef("pk"))
         if during_date_range:
             first_consumable_sub = first_consumable_sub.filter(date__gte=origin_start_datetime)
         first_consumable_sub = first_consumable_sub.order_by("date")
         users = users.annotate(
-            first_consumable_withdrawal=Coalesce(Subquery(first_consumable_sub.values("date")[:1]), Value(max_date)),
+            first_consumable_withdrawal=Subquery(first_consumable_sub.values("date")[:1]),
             first_consumable_withdrawal_project=Subquery(first_consumable_sub.values("project__name")[:1]),
             first_consumable_withdrawal_discipline=Subquery(
                 first_consumable_sub.values("project__discipline__name")[:1]
             ),
             first_consumable_withdrawal_account_type=Subquery(
                 first_consumable_sub.values("project__account__type__name")[:1]
             ),
@@ -426,15 +440,15 @@
 
         if params.get_bool("custom_charges", "on"):
             first_custom_sub = CustomCharge.objects.filter(customer=OuterRef("pk"))
             if during_date_range:
                 first_custom_sub = first_custom_sub.filter(date__gte=origin_start_datetime)
             first_custom_sub = first_custom_sub.order_by("date")
             users = users.annotate(
-                first_custom_charge=Coalesce(Subquery(first_custom_sub.values("date")[:1]), Value(max_date)),
+                first_custom_charge=Subquery(first_custom_sub.values("date")[:1]),
                 first_custom_charge_project=Subquery(first_custom_sub.values("project__name")[:1]),
                 first_custom_charge_discipline=Subquery(first_custom_sub.values("project__discipline__name")[:1]),
                 first_custom_charge_account_type=Subquery(first_custom_sub.values("project__account__type__name")[:1]),
             )
             if billing_installed():
                 users = users.annotate(
                     first_custom_charge_core_facility=Subquery(first_custom_sub.values("core_facility__name")[:1]),
@@ -446,87 +460,52 @@
                     ),
                     first_custom_charge_institution_type=Subquery(
                         first_custom_sub.values("project__projectbillingdetails__institution__institution_type__name")[
                             :1
                         ]
                     ),
                 )
-    users = users.annotate(
-        first_activity=Least(
-            "first_tool_usage",
-            "first_area_access",
-            "first_staff_charge",
-            "first_training",
-            "first_missed_reservation",
-            "first_consumable_withdrawal",
-            "first_custom_charge",
-        ),
-        first_activity_project=Case(
-            When(first_activity=F("first_tool_usage"), then=F("first_tool_usage_project")),
-            When(first_activity=F("first_area_access"), then=F("first_area_access_project")),
-            When(first_activity=F("first_staff_charge"), then=F("first_staff_charge_project")),
-            When(first_activity=F("first_training"), then=F("first_training_project")),
-            When(first_activity=F("first_missed_reservation"), then=F("first_missed_reservation_project")),
-            When(first_activity=F("first_consumable_withdrawal"), then=F("first_consumable_withdrawal_project")),
-            When(first_activity=F("first_custom_charge"), then=F("first_custom_charge_project")),
-        ),
-        first_activity_discipline=Case(
-            When(first_activity=F("first_tool_usage"), then=F("first_tool_usage_discipline")),
-            When(first_activity=F("first_area_access"), then=F("first_area_access_discipline")),
-            When(first_activity=F("first_staff_charge"), then=F("first_staff_charge_discipline")),
-            When(first_activity=F("first_training"), then=F("first_training_discipline")),
-            When(first_activity=F("first_missed_reservation"), then=F("first_missed_reservation_discipline")),
-            When(first_activity=F("first_consumable_withdrawal"), then=F("first_consumable_withdrawal_discipline")),
-            When(first_activity=F("first_custom_charge"), then=F("first_custom_charge_discipline")),
-        ),
-        first_activity_account_type=Case(
-            When(first_activity=F("first_tool_usage"), then=F("first_tool_usage_account_type")),
-            When(first_activity=F("first_area_access"), then=F("first_area_access_account_type")),
-            When(first_activity=F("first_staff_charge"), then=F("first_staff_charge_account_type")),
-            When(first_activity=F("first_training"), then=F("first_training_account_type")),
-            When(first_activity=F("first_missed_reservation"), then=F("first_missed_reservation_account_type")),
-            When(first_activity=F("first_consumable_withdrawal"), then=F("first_consumable_withdrawal_account_type")),
-            When(first_activity=F("first_custom_charge"), then=F("first_custom_charge_account_type")),
-        ),
-        first_activity_core_facility=Case(
-            When(first_activity=F("first_tool_usage"), then=F("first_tool_usage_core_facility")),
-            When(first_activity=F("first_area_access"), then=F("first_area_access_core_facility")),
-            When(first_activity=F("first_staff_charge"), then=F("first_staff_charge_core_facility")),
-            When(first_activity=F("first_training"), then=F("first_training_core_facility")),
-            When(first_activity=F("first_missed_reservation"), then=F("first_missed_reservation_core_facility")),
-            When(first_activity=F("first_consumable_withdrawal"), then=F("first_consumable_withdrawal_core_facility")),
-            When(first_activity=F("first_custom_charge"), then=F("first_custom_charge_core_facility")),
-        ),
-        first_activity_rate_category=Case(
-            When(first_activity=F("first_tool_usage"), then=F("first_tool_usage_rate_category")),
-            When(first_activity=F("first_area_access"), then=F("first_area_access_rate_category")),
-            When(first_activity=F("first_staff_charge"), then=F("first_staff_charge_rate_category")),
-            When(first_activity=F("first_training"), then=F("first_training_rate_category")),
-            When(first_activity=F("first_missed_reservation"), then=F("first_missed_reservation_rate_category")),
-            When(first_activity=F("first_consumable_withdrawal"), then=F("first_consumable_withdrawal_rate_category")),
-            When(first_activity=F("first_custom_charge"), then=F("first_custom_charge_rate_category")),
-        ),
-        first_activity_institution_name=Case(
-            When(first_activity=F("first_tool_usage"), then=F("first_tool_usage_institution_name")),
-            When(first_activity=F("first_area_access"), then=F("first_area_access_institution_name")),
-            When(first_activity=F("first_staff_charge"), then=F("first_staff_charge_institution_name")),
-            When(first_activity=F("first_training"), then=F("first_training_institution_name")),
-            When(first_activity=F("first_missed_reservation"), then=F("first_missed_reservation_institution_name")),
-            When(
-                first_activity=F("first_consumable_withdrawal"), then=F("first_consumable_withdrawal_institution_name")
-            ),
-            When(first_activity=F("first_custom_charge"), then=F("first_custom_charge_institution_name")),
-        ),
-        first_activity_institution_type=Case(
-            When(first_activity=F("first_tool_usage"), then=F("first_tool_usage_institution_type")),
-            When(first_activity=F("first_area_access"), then=F("first_area_access_institution_type")),
-            When(first_activity=F("first_staff_charge"), then=F("first_staff_charge_institution_type")),
-            When(first_activity=F("first_training"), then=F("first_training_institution_type")),
-            When(first_activity=F("first_missed_reservation"), then=F("first_missed_reservation_institution_type")),
-            When(
-                first_activity=F("first_consumable_withdrawal"), then=F("first_consumable_withdrawal_institution_type")
-            ),
-            When(first_activity=F("first_custom_charge"), then=F("first_custom_charge_institution_type")),
-        ),
-    )
-    users = users.filter(first_activity__gte=start_datetime, first_activity__lte=end_datetime)
-    return users
+    for user in users:
+        user.first_activity = min(
+            [
+                act
+                for act in [
+                    user.first_tool_usage,
+                    user.first_area_access,
+                    user.first_staff_charge,
+                    user.first_training,
+                    user.first_missed_reservation,
+                    user.first_consumable_withdrawal,
+                    user.first_custom_charge,
+                ]
+                if act
+            ],
+            default=None,
+        )
+        if user.first_activity:
+            for activity_type in reversed(
+                [
+                    "first_tool_usage",
+                    "first_area_access",
+                    "first_staff_charge",
+                    "first_training",
+                    "first_missed_reservation",
+                    "first_consumable_withdrawal",
+                    "first_custom_charge",
+                ]
+            ):
+                if user.first_activity == getattr(user, activity_type, None):
+                    for activity_type_type in [
+                        "_project",
+                        "_discipline",
+                        "_account_type",
+                        "_core_facility",
+                        "_rate_category",
+                        "_institution_name",
+                        "_institution_type",
+                    ]:
+                        setattr(
+                            user,
+                            "first_activity" + activity_type_type,
+                            getattr(user, activity_type + activity_type_type, None),
+                        )
+    return [user for user in users if user.first_activity and start_datetime <= user.first_activity <= end_datetime]
```

## Comparing `NEMO_reports-1.7.0.dist-info/LICENSE` & `NEMO_reports-1.7.1.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `NEMO_reports-1.7.0.dist-info/METADATA` & `NEMO_reports-1.7.1.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: NEMO-reports
-Version: 1.7.0
+Version: 1.7.1
 Summary: Reports plugin for NEMO
 Home-page: https://gitlab.com/nemo-community/atlantis-labs/nemo-reports
 Author: Atlantis Labs LLC
 Author-email: atlantis@atlantislabs.io
 License: MIT
 Keywords: NEMO
 Classifier: Development Status :: 5 - Production/Stable
```

## Comparing `NEMO_reports-1.7.0.dist-info/RECORD` & `NEMO_reports-1.7.1.dist-info/RECORD`

 * *Files 4% similar despite different names*

```diff
@@ -16,14 +16,14 @@
 NEMO_reports/templates/base/navbar_reports.html,sha256=KyMt2s8m9qg2GrRAjWuiFYvKTaTqiieBTUie-4eNDc4,138
 NEMO_reports/templates/customizations/customizations_reports.html,sha256=HGSiexm3hFQ6Xz1a8rYLTchKskDXc8RQj8OBb0mqG74,4688
 NEMO_reports/views/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_reports/views/reporting.py,sha256=WyXROJblxIWKT24q6UxreEhYUgmAOAmKkmLoVHyKnZI,18987
 NEMO_reports/views/reporting_facilily_usage.py,sha256=4MvHTjN33N3UBnotB3aVL4eNVsBRF1dVG992jJi0jf4,15017
 NEMO_reports/views/reporting_invoice_charges.py,sha256=SZxcs1pI7LN3rncgoo7wWCC6HEj4PHz-6BXhsfG6m64,12381
 NEMO_reports/views/reporting_invoice_item_charges.py,sha256=W7XHWIAgCEXnETgizj272VJgISNNKzqWRC9RtNiz4Rg,16324
-NEMO_reports/views/reporting_new_user_activities.py,sha256=PLLZ3JYgSMcE3dLXQMjej2D-A09_CYoLWp7vLOG23r8,28491
+NEMO_reports/views/reporting_new_user_activities.py,sha256=75wA9c_LABxN8u7BE_2jgKeWznUDRf2WL8xB3uA0Row,24248
 NEMO_reports/views/reporting_unique_user_prj_acc.py,sha256=fJUCt2L18IEAg1jA9I7LBifkMj59pF8qzUTbmzsrxpc,15375
-NEMO_reports-1.7.0.dist-info/LICENSE,sha256=wFCCmLGvBMU6-W_0h08WYEs3cFtVstutDmY5AzKppQc,1074
-NEMO_reports-1.7.0.dist-info/METADATA,sha256=92A9k44c5P5EIHEvYSosNYTw0blrtUGCJla3KiHuxq8,2116
-NEMO_reports-1.7.0.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
-NEMO_reports-1.7.0.dist-info/top_level.txt,sha256=6Sq8v68WbH9DkCJMuHLlx3cf2SXldad5VA_yGcd1Xl4,13
-NEMO_reports-1.7.0.dist-info/RECORD,,
+NEMO_reports-1.7.1.dist-info/LICENSE,sha256=wFCCmLGvBMU6-W_0h08WYEs3cFtVstutDmY5AzKppQc,1074
+NEMO_reports-1.7.1.dist-info/METADATA,sha256=3x5efryKKIDJMj2uLxWHEngDEo7ePCuSmEWzowP6WhE,2116
+NEMO_reports-1.7.1.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+NEMO_reports-1.7.1.dist-info/top_level.txt,sha256=6Sq8v68WbH9DkCJMuHLlx3cf2SXldad5VA_yGcd1Xl4,13
+NEMO_reports-1.7.1.dist-info/RECORD,,
```

