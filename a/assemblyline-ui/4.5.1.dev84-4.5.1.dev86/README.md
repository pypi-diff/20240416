# Comparing `tmp/assemblyline_ui-4.5.1.dev84-py3-none-any.whl.zip` & `tmp/assemblyline_ui-4.5.1.dev86-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,79 +1,79 @@
-Zip file size: 176850 bytes, number of entries: 77
--rw-r--r--  2.0 unx       12 b- defN 24-Apr-15 13:57 assemblyline_ui/VERSION
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-15 13:57 assemblyline_ui/__init__.py
--rw-r--r--  2.0 unx     6736 b- defN 24-Apr-15 13:57 assemblyline_ui/app.py
--rw-r--r--  2.0 unx     5951 b- defN 24-Apr-15 13:57 assemblyline_ui/config.py
--rw-r--r--  2.0 unx     3690 b- defN 24-Apr-15 13:57 assemblyline_ui/error.py
--rw-r--r--  2.0 unx      740 b- defN 24-Apr-15 13:57 assemblyline_ui/gunicorn_config.py
--rw-r--r--  2.0 unx      115 b- defN 24-Apr-15 13:57 assemblyline_ui/gunicorn_config_socketio.py
--rw-r--r--  2.0 unx      777 b- defN 24-Apr-15 13:57 assemblyline_ui/healthz.py
--rw-r--r--  2.0 unx      199 b- defN 24-Apr-15 13:57 assemblyline_ui/http_exceptions.py
--rw-r--r--  2.0 unx     2322 b- defN 24-Apr-15 13:57 assemblyline_ui/logger.py
--rw-r--r--  2.0 unx       85 b- defN 24-Apr-15 13:57 assemblyline_ui/patched.py
--rw-r--r--  2.0 unx     2596 b- defN 24-Apr-15 13:57 assemblyline_ui/socketsrv.py
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-15 13:57 assemblyline_ui/api/__init__.py
--rw-r--r--  2.0 unx    14502 b- defN 24-Apr-15 13:57 assemblyline_ui/api/base.py
--rw-r--r--  2.0 unx     3915 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/__init__.py
--rw-r--r--  2.0 unx    37510 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/alert.py
--rw-r--r--  2.0 unx    24904 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/archive.py
--rw-r--r--  2.0 unx     1866 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/assistant.py
--rw-r--r--  2.0 unx    33569 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/authentication.py
--rw-r--r--  2.0 unx    32455 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/badlist.py
--rw-r--r--  2.0 unx     5141 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/bundle.py
--rw-r--r--  2.0 unx     2560 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/error.py
--rw-r--r--  2.0 unx    12508 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/federated_lookup.py
--rw-r--r--  2.0 unx    55854 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/file.py
--rw-r--r--  2.0 unx    11900 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/hash_search.py
--rw-r--r--  2.0 unx     6367 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/help.py
--rw-r--r--  2.0 unx     2910 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/heuristics.py
--rw-r--r--  2.0 unx    20441 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/ingest.py
--rw-r--r--  2.0 unx     5477 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/live.py
--rw-r--r--  2.0 unx    13223 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/ontology.py
--rw-r--r--  2.0 unx     7985 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/replay.py
--rw-r--r--  2.0 unx     6203 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/result.py
--rw-r--r--  2.0 unx    23121 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/retrohunt.py
--rw-r--r--  2.0 unx    23196 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/safelist.py
--rw-r--r--  2.0 unx    20528 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/search.py
--rw-r--r--  2.0 unx    39389 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/service.py
--rw-r--r--  2.0 unx    26966 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/signature.py
--rw-r--r--  2.0 unx    46126 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/submission.py
--rw-r--r--  2.0 unx    20443 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/submit.py
--rw-r--r--  2.0 unx    20730 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/system.py
--rw-r--r--  2.0 unx    11728 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/ui.py
--rw-r--r--  2.0 unx    40316 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/user.py
--rw-r--r--  2.0 unx     4734 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/webauthn.py
--rw-r--r--  2.0 unx    10308 b- defN 24-Apr-15 13:57 assemblyline_ui/api/v4/workflow.py
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-15 13:57 assemblyline_ui/helper/__init__.py
--rw-r--r--  2.0 unx     1686 b- defN 24-Apr-15 13:57 assemblyline_ui/helper/discover.py
--rw-r--r--  2.0 unx     8154 b- defN 24-Apr-15 13:57 assemblyline_ui/helper/oauth.py
--rw-r--r--  2.0 unx     4926 b- defN 24-Apr-15 13:57 assemblyline_ui/helper/result.py
--rw-r--r--  2.0 unx     1686 b- defN 24-Apr-15 13:57 assemblyline_ui/helper/search.py
--rw-r--r--  2.0 unx     3260 b- defN 24-Apr-15 13:57 assemblyline_ui/helper/service.py
--rw-r--r--  2.0 unx      899 b- defN 24-Apr-15 13:57 assemblyline_ui/helper/signature.py
--rw-r--r--  2.0 unx     6835 b- defN 24-Apr-15 13:57 assemblyline_ui/helper/submission.py
--rw-r--r--  2.0 unx     7628 b- defN 24-Apr-15 13:57 assemblyline_ui/helper/user.py
--rw-r--r--  2.0 unx      445 b- defN 24-Apr-15 13:57 assemblyline_ui/helper/ai/__init__.py
--rw-r--r--  2.0 unx     4895 b- defN 24-Apr-15 13:57 assemblyline_ui/helper/ai/base.py
--rw-r--r--  2.0 unx     5692 b- defN 24-Apr-15 13:57 assemblyline_ui/helper/ai/cohere.py
--rw-r--r--  2.0 unx     5446 b- defN 24-Apr-15 13:57 assemblyline_ui/helper/ai/openai.py
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-15 13:57 assemblyline_ui/security/__init__.py
--rw-r--r--  2.0 unx     1410 b- defN 24-Apr-15 13:57 assemblyline_ui/security/apikey_auth.py
--rw-r--r--  2.0 unx    10116 b- defN 24-Apr-15 13:57 assemblyline_ui/security/authenticator.py
--rw-r--r--  2.0 unx    13749 b- defN 24-Apr-15 13:57 assemblyline_ui/security/ldap_auth.py
--rw-r--r--  2.0 unx     3074 b- defN 24-Apr-15 13:57 assemblyline_ui/security/oauth_auth.py
--rw-r--r--  2.0 unx     2951 b- defN 24-Apr-15 13:57 assemblyline_ui/security/second_factor_auth.py
--rw-r--r--  2.0 unx      750 b- defN 24-Apr-15 13:57 assemblyline_ui/security/userpass_auth.py
--rw-r--r--  2.0 unx        0 b- defN 24-Apr-15 13:57 assemblyline_ui/sio/__init__.py
--rw-r--r--  2.0 unx     2170 b- defN 24-Apr-15 13:57 assemblyline_ui/sio/alert.py
--rw-r--r--  2.0 unx     3529 b- defN 24-Apr-15 13:57 assemblyline_ui/sio/base.py
--rw-r--r--  2.0 unx     2041 b- defN 24-Apr-15 13:57 assemblyline_ui/sio/file.py
--rw-r--r--  2.0 unx     4158 b- defN 24-Apr-15 13:57 assemblyline_ui/sio/live_submission.py
--rw-r--r--  2.0 unx     2146 b- defN 24-Apr-15 13:57 assemblyline_ui/sio/retrohunt.py
--rw-r--r--  2.0 unx     1980 b- defN 24-Apr-15 13:57 assemblyline_ui/sio/status.py
--rw-r--r--  2.0 unx     2222 b- defN 24-Apr-15 13:57 assemblyline_ui/sio/submission.py
--rw-r--r--  2.0 unx     1396 b- defN 24-Apr-15 13:57 assemblyline_ui-4.5.1.dev84.dist-info/LICENCE.md
--rw-r--r--  2.0 unx     2898 b- defN 24-Apr-15 13:57 assemblyline_ui-4.5.1.dev84.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-Apr-15 13:57 assemblyline_ui-4.5.1.dev84.dist-info/WHEEL
--rw-r--r--  2.0 unx       16 b- defN 24-Apr-15 13:57 assemblyline_ui-4.5.1.dev84.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     6914 b- defN 24-Apr-15 13:57 assemblyline_ui-4.5.1.dev84.dist-info/RECORD
-77 files, 723262 bytes uncompressed, 165804 bytes compressed:  77.1%
+Zip file size: 177272 bytes, number of entries: 77
+-rw-r--r--  2.0 unx       12 b- defN 24-Apr-16 15:52 assemblyline_ui/VERSION
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-16 15:51 assemblyline_ui/__init__.py
+-rw-r--r--  2.0 unx     6736 b- defN 24-Apr-16 15:52 assemblyline_ui/app.py
+-rw-r--r--  2.0 unx     5951 b- defN 24-Apr-16 15:52 assemblyline_ui/config.py
+-rw-r--r--  2.0 unx     4064 b- defN 24-Apr-16 15:52 assemblyline_ui/error.py
+-rw-r--r--  2.0 unx      740 b- defN 24-Apr-16 15:52 assemblyline_ui/gunicorn_config.py
+-rw-r--r--  2.0 unx      115 b- defN 24-Apr-16 15:52 assemblyline_ui/gunicorn_config_socketio.py
+-rw-r--r--  2.0 unx      777 b- defN 24-Apr-16 15:51 assemblyline_ui/healthz.py
+-rw-r--r--  2.0 unx      199 b- defN 24-Apr-16 15:51 assemblyline_ui/http_exceptions.py
+-rw-r--r--  2.0 unx     2322 b- defN 24-Apr-16 15:52 assemblyline_ui/logger.py
+-rw-r--r--  2.0 unx       85 b- defN 24-Apr-16 15:51 assemblyline_ui/patched.py
+-rw-r--r--  2.0 unx     2596 b- defN 24-Apr-16 15:52 assemblyline_ui/socketsrv.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-16 15:51 assemblyline_ui/api/__init__.py
+-rw-r--r--  2.0 unx    16195 b- defN 24-Apr-16 15:52 assemblyline_ui/api/base.py
+-rw-r--r--  2.0 unx     3915 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/__init__.py
+-rw-r--r--  2.0 unx    37510 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/alert.py
+-rw-r--r--  2.0 unx    24904 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/archive.py
+-rw-r--r--  2.0 unx     1866 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/assistant.py
+-rw-r--r--  2.0 unx    33569 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/authentication.py
+-rw-r--r--  2.0 unx    32455 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/badlist.py
+-rw-r--r--  2.0 unx     5141 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/bundle.py
+-rw-r--r--  2.0 unx     2560 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/error.py
+-rw-r--r--  2.0 unx    12508 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/federated_lookup.py
+-rw-r--r--  2.0 unx    55854 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/file.py
+-rw-r--r--  2.0 unx    11900 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/hash_search.py
+-rw-r--r--  2.0 unx     6367 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/help.py
+-rw-r--r--  2.0 unx     2910 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/heuristics.py
+-rw-r--r--  2.0 unx    20441 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/ingest.py
+-rw-r--r--  2.0 unx     5477 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/live.py
+-rw-r--r--  2.0 unx    13223 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/ontology.py
+-rw-r--r--  2.0 unx     7985 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/replay.py
+-rw-r--r--  2.0 unx     6203 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/result.py
+-rw-r--r--  2.0 unx    23121 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/retrohunt.py
+-rw-r--r--  2.0 unx    23196 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/safelist.py
+-rw-r--r--  2.0 unx    20528 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/search.py
+-rw-r--r--  2.0 unx    39389 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/service.py
+-rw-r--r--  2.0 unx    26966 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/signature.py
+-rw-r--r--  2.0 unx    46126 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/submission.py
+-rw-r--r--  2.0 unx    20443 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/submit.py
+-rw-r--r--  2.0 unx    20730 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/system.py
+-rw-r--r--  2.0 unx    11728 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/ui.py
+-rw-r--r--  2.0 unx    40316 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/user.py
+-rw-r--r--  2.0 unx     4734 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/webauthn.py
+-rw-r--r--  2.0 unx    10308 b- defN 24-Apr-16 15:52 assemblyline_ui/api/v4/workflow.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-16 15:52 assemblyline_ui/helper/__init__.py
+-rw-r--r--  2.0 unx     1686 b- defN 24-Apr-16 15:51 assemblyline_ui/helper/discover.py
+-rw-r--r--  2.0 unx     8154 b- defN 24-Apr-16 15:52 assemblyline_ui/helper/oauth.py
+-rw-r--r--  2.0 unx     4926 b- defN 24-Apr-16 15:52 assemblyline_ui/helper/result.py
+-rw-r--r--  2.0 unx     1686 b- defN 24-Apr-16 15:52 assemblyline_ui/helper/search.py
+-rw-r--r--  2.0 unx     3260 b- defN 24-Apr-16 15:52 assemblyline_ui/helper/service.py
+-rw-r--r--  2.0 unx      899 b- defN 24-Apr-16 15:52 assemblyline_ui/helper/signature.py
+-rw-r--r--  2.0 unx     6835 b- defN 24-Apr-16 15:52 assemblyline_ui/helper/submission.py
+-rw-r--r--  2.0 unx     7628 b- defN 24-Apr-16 15:52 assemblyline_ui/helper/user.py
+-rw-r--r--  2.0 unx      445 b- defN 24-Apr-16 15:52 assemblyline_ui/helper/ai/__init__.py
+-rw-r--r--  2.0 unx     4895 b- defN 24-Apr-16 15:52 assemblyline_ui/helper/ai/base.py
+-rw-r--r--  2.0 unx     5692 b- defN 24-Apr-16 15:52 assemblyline_ui/helper/ai/cohere.py
+-rw-r--r--  2.0 unx     5446 b- defN 24-Apr-16 15:52 assemblyline_ui/helper/ai/openai.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-16 15:51 assemblyline_ui/security/__init__.py
+-rw-r--r--  2.0 unx     1410 b- defN 24-Apr-16 15:52 assemblyline_ui/security/apikey_auth.py
+-rw-r--r--  2.0 unx    10116 b- defN 24-Apr-16 15:52 assemblyline_ui/security/authenticator.py
+-rw-r--r--  2.0 unx    13749 b- defN 24-Apr-16 15:52 assemblyline_ui/security/ldap_auth.py
+-rw-r--r--  2.0 unx     3074 b- defN 24-Apr-16 15:52 assemblyline_ui/security/oauth_auth.py
+-rw-r--r--  2.0 unx     2951 b- defN 24-Apr-16 15:52 assemblyline_ui/security/second_factor_auth.py
+-rw-r--r--  2.0 unx      750 b- defN 24-Apr-16 15:52 assemblyline_ui/security/userpass_auth.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-16 15:51 assemblyline_ui/sio/__init__.py
+-rw-r--r--  2.0 unx     2170 b- defN 24-Apr-16 15:51 assemblyline_ui/sio/alert.py
+-rw-r--r--  2.0 unx     3529 b- defN 24-Apr-16 15:51 assemblyline_ui/sio/base.py
+-rw-r--r--  2.0 unx     2041 b- defN 24-Apr-16 15:52 assemblyline_ui/sio/file.py
+-rw-r--r--  2.0 unx     4158 b- defN 24-Apr-16 15:51 assemblyline_ui/sio/live_submission.py
+-rw-r--r--  2.0 unx     2146 b- defN 24-Apr-16 15:52 assemblyline_ui/sio/retrohunt.py
+-rw-r--r--  2.0 unx     1980 b- defN 24-Apr-16 15:51 assemblyline_ui/sio/status.py
+-rw-r--r--  2.0 unx     2222 b- defN 24-Apr-16 15:51 assemblyline_ui/sio/submission.py
+-rw-r--r--  2.0 unx     1396 b- defN 24-Apr-16 15:52 assemblyline_ui-4.5.1.dev86.dist-info/LICENCE.md
+-rw-r--r--  2.0 unx     2898 b- defN 24-Apr-16 15:52 assemblyline_ui-4.5.1.dev86.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-Apr-16 15:52 assemblyline_ui-4.5.1.dev86.dist-info/WHEEL
+-rw-r--r--  2.0 unx       16 b- defN 24-Apr-16 15:52 assemblyline_ui-4.5.1.dev86.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     6914 b- defN 24-Apr-16 15:52 assemblyline_ui-4.5.1.dev86.dist-info/RECORD
+77 files, 725329 bytes uncompressed, 166226 bytes compressed:  77.1%
```

## zipnote {}

```diff
@@ -210,23 +210,23 @@
 
 Filename: assemblyline_ui/sio/status.py
 Comment: 
 
 Filename: assemblyline_ui/sio/submission.py
 Comment: 
 
-Filename: assemblyline_ui-4.5.1.dev84.dist-info/LICENCE.md
+Filename: assemblyline_ui-4.5.1.dev86.dist-info/LICENCE.md
 Comment: 
 
-Filename: assemblyline_ui-4.5.1.dev84.dist-info/METADATA
+Filename: assemblyline_ui-4.5.1.dev86.dist-info/METADATA
 Comment: 
 
-Filename: assemblyline_ui-4.5.1.dev84.dist-info/WHEEL
+Filename: assemblyline_ui-4.5.1.dev86.dist-info/WHEEL
 Comment: 
 
-Filename: assemblyline_ui-4.5.1.dev84.dist-info/top_level.txt
+Filename: assemblyline_ui-4.5.1.dev86.dist-info/top_level.txt
 Comment: 
 
-Filename: assemblyline_ui-4.5.1.dev84.dist-info/RECORD
+Filename: assemblyline_ui-4.5.1.dev86.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## assemblyline_ui/VERSION

```diff
@@ -1 +1 @@
-4.5.1.dev84
+4.5.1.dev86
```

## assemblyline_ui/error.py

```diff
@@ -1,16 +1,17 @@
 
 from flask import Blueprint, request, session as flsk_session
 from sys import exc_info
 from traceback import format_tb
-from werkzeug.exceptions import Forbidden, Unauthorized, BadRequest
+from werkzeug.exceptions import Forbidden, Unauthorized, BadRequest, NotFound
 
 from assemblyline_ui.api.base import make_api_response
 from assemblyline_ui.config import AUDIT, AUDIT_LOG, LOGGER, config, KV_SESSION
-from assemblyline_ui.http_exceptions import AccessDeniedException, AuthenticationException
+from assemblyline_ui.http_exceptions import AccessDeniedException, AuthenticationException, \
+    InvalidDataException, NotFoundException
 from assemblyline_ui.logger import log_with_traceback
 
 errors = Blueprint("errors", __name__)
 
 
 ######################################
 # Custom Error page
@@ -80,16 +81,19 @@
             "tos_lockout_notify": config.ui.tos_lockout_notify not in [None, []]
         }
     }
     return make_api_response(config_block, "Access Denied (%s) [%s]" % (request.path, error_message), 403)
 
 
 @errors.app_errorhandler(404)
-def handle_404(_):
-    return make_api_response("", "Api does not exist (%s)" % request.path, 404)
+def handle_404(e):
+    if isinstance(e, NotFound):
+        return make_api_response("", "Api does not exist (%s)" % request.path, 404)
+    else:
+        return make_api_response("", str(e), 400)
 
 
 @errors.app_errorhandler(415)
 def handle_415(e):
     return make_api_response("", str(e))
 
 
@@ -97,14 +101,20 @@
 def handle_500(e):
     if isinstance(e.original_exception, AccessDeniedException):
         return handle_403(e.original_exception)
 
     if isinstance(e.original_exception, AuthenticationException):
         return handle_401(e.original_exception)
 
+    if isinstance(e.original_exception, InvalidDataException):
+        return handle_400(e.original_exception)
+
+    if isinstance(e.original_exception, NotFoundException):
+        return handle_404(e.original_exception)
+
     oe = e.original_exception or e
 
     trace = exc_info()[2]
     log_with_traceback(LOGGER, trace, "Exception", is_exception=True)
 
     message = ''.join(['\n'] + format_tb(exc_info()[2]) + ['%s: %s\n' % (oe.__class__.__name__, str(oe))]).rstrip('\n')
     return make_api_response("", message, 500)
```

## assemblyline_ui/api/base.py

```diff
@@ -7,14 +7,15 @@
 
 from flask import current_app, Blueprint, jsonify, make_response, request, session as flsk_session, Response, abort
 from sys import exc_info
 from traceback import format_tb
 
 from assemblyline_ui.security.apikey_auth import validate_apikey
 from assemblyline_ui.security.authenticator import BaseSecurityRenderer
+from assemblyline_ui.security.oauth_auth import validate_oauth_token
 from assemblyline_ui.config import LOGGER, QUOTA_TRACKER, STORAGE, SECRET_KEY, VERSION
 from assemblyline_ui.helper.user import login
 from assemblyline_ui.http_exceptions import AuthenticationException
 from assemblyline_ui.config import config
 from assemblyline_ui.logger import log_with_traceback
 from assemblyline.common.str_utils import safe_str
 from assemblyline.odm.models.user import ROLES
@@ -71,71 +72,102 @@
             abort(401, "Invalid session")
 
         if session.get("roles_limit", []) is None and self.check_xsrf_token and \
                 session.get('xsrf_token', "") != request.environ.get('HTTP_X_XSRF_TOKEN',
                                                                      request.args.get("XSRF_TOKEN", "")):
             abort(403, "Invalid XSRF token")
 
+    def parse_al_obo_token(self, bearer_token, roles_limit, impersonator):
+        # noinspection PyBroadException
+        try:
+            headers = jwt.get_unverified_header(bearer_token)
+
+            # Test token validity
+            if 'token_id' not in headers or 'user' not in headers:
+                raise AuthenticationException("This is not a valid AL OBO token - Missing data from the headers")
+
+            # Try to decode token
+            decoded = jwt.decode(bearer_token,
+                                 hashlib.sha256(f"{SECRET_KEY}_{headers['token_id']}".encode()).hexdigest(),
+                                 algorithms=[headers.get('alg', "HS256")])
+        except jwt.PyJWTError as e:
+            raise AuthenticationException(f"Invalid OBO token - {str(e)}")
+
+        target_user = STORAGE.user.get(headers['user'], as_obj=False)
+        if target_user:
+            target_token = target_user.get('apps', {}).get(headers['token_id'], {})
+            if target_token != decoded:
+                raise AuthenticationException("Invalid OBO token - Token ID does not match the token")
+
+            if target_token['client_id'] != impersonator:
+                raise AuthenticationException(f"Invalid OBO token - {impersonator} is not allowed to use this token")
+
+            logged_in_uname = headers['user']
+
+            if roles_limit:
+                roles_limit = [r for r in decoded['roles'] if r in roles_limit]
+            else:
+                roles_limit = decoded["roles"]
+
+            return logged_in_uname, roles_limit
+        else:
+            raise AuthenticationException("User of the OBO token is not found")
+
     def __call__(self, func):
         @functools.wraps(func)
         def base(*args, **kwargs):
             if 'user' in kwargs:
                 if kwargs['user'].get('authenticated', False):
                     return func(*args, **kwargs)
                 else:
                     abort(403, "Invalid pre-authenticated user")
-                    return
 
             self.test_readonly("API")
             logged_in_uname, roles_limit = self.get_logged_in_user()
             impersonator = None
 
             # Impersonate
             authorization = request.environ.get("HTTP_AUTHORIZATION", None)
             if authorization:
-                # noinspection PyBroadException
-                try:
-                    bearer_token = authorization.split(" ")[-1]
-                    headers = jwt.get_unverified_header(bearer_token)
-                    decoded = jwt.decode(bearer_token,
-                                         hashlib.sha256(f"{SECRET_KEY}_{headers['token_id']}".encode()).hexdigest(),
-                                         algorithms=[headers.get('alg', "HS256")])
-                except Exception:
-                    abort(400, "Malformed bearer token")
-                    return
-
-                target_user = STORAGE.user.get(headers['user'], as_obj=False)
-                if target_user:
-                    target_token = target_user.get('apps', {}).get(headers['token_id'], {})
-                    if target_token == decoded and target_token['client_id'] == logged_in_uname:
-                        impersonator = logged_in_uname
-                        logged_in_uname = headers['user']
-                        LOGGER.info(f"{impersonator} is impersonating {logged_in_uname} for query: {request.path}")
-
-                        if roles_limit:
-                            roles_limit = [r for r in decoded['roles'] if r in roles_limit]
-                        else:
-                            roles_limit = decoded["roles"]
-
+                ip = request.headers.get("X-Forwarded-For", request.remote_addr)
+                impersonator = logged_in_uname
+                bearer_token = authorization.split(" ")[-1]
+                token_provider = request.environ.get("HTTP_X_TOKEN_PROVIDER", None)
+                if token_provider:
+                    # Token has an associated provider, use it to validate the token
+                    try:
+                        logged_in_uname, token_roles_limit = validate_oauth_token(bearer_token, token_provider)
+                    except AuthenticationException as e:
+                        LOGGER.warning(f"Authentication failure. (U:{logged_in_uname} - IP:{ip}) [{str(e)}]")
+                        abort(403, str(e))
+
+                    # Combine role limits
+                    if roles_limit:
+                        roles_limit = [r for r in token_roles_limit if r in roles_limit]
                     else:
-                        abort(403, "Invalid bearer token")
-                        return
+                        roles_limit = token_roles_limit
                 else:
-                    abort(404, "User not found")
-                    return
+                    # Use the internal AL token validator
+                    try:
+                        logged_in_uname, roles_limit = self.parse_al_obo_token(
+                            bearer_token, roles_limit, impersonator)
+                    except AuthenticationException as e:
+                        LOGGER.warning(f"Authentication failure. (U:{logged_in_uname} - IP:{ip}) [{str(e)}]")
+                        abort(403, str(e))
+
+                LOGGER.info(f"{impersonator} [{ip}] is impersonating {logged_in_uname} for query: {request.path}")
 
             user = login(logged_in_uname, roles_limit)
 
             # Terms of Service
             if request.path not in ["/api/v4/help/tos/", "/api/v4/user/whoami/",
                                     f"/api/v4/user/tos/{logged_in_uname}/",
                                     "/api/v4/auth/logout/"] \
                     and not user.get('agrees_with_tos', False) and config.ui.tos is not None:
                 abort(403, "Agree to Terms of Service before you can make any API calls")
-                return
 
             self.test_require_role(user, "API")
 
             #############################################
             # Special username api query validation
             #
             #    If an API call requests a username, the username as to match
```

## Comparing `assemblyline_ui-4.5.1.dev84.dist-info/LICENCE.md` & `assemblyline_ui-4.5.1.dev86.dist-info/LICENCE.md`

 * *Files identical despite different names*

## Comparing `assemblyline_ui-4.5.1.dev84.dist-info/METADATA` & `assemblyline_ui-4.5.1.dev86.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: assemblyline-ui
-Version: 4.5.1.dev84
+Version: 4.5.1.dev86
 Summary: Assemblyline 4 - API and Socket IO server
 Home-page: https://github.com/CybercentreCanada/assemblyline-ui/
 Author: CCCS Assemblyline development team
 Author-email: assemblyline@cyber.gc.ca
 License: MIT
 Keywords: assemblyline automated malware analysis gc canada cse-cst cse cst cyber cccs
 Classifier: Development Status :: 5 - Production/Stable
```

## Comparing `assemblyline_ui-4.5.1.dev84.dist-info/RECORD` & `assemblyline_ui-4.5.1.dev86.dist-info/RECORD`

 * *Files 3% similar despite different names*

```diff
@@ -1,21 +1,21 @@
-assemblyline_ui/VERSION,sha256=Bg1nmPaLKpe4IKZ9s5oiHXzkKLLsu5XVtYVWL7FndoE,12
+assemblyline_ui/VERSION,sha256=7jjug9w718yHBS1PT1FsrlJCgcEPnrB7kZNSn0cxLHs,12
 assemblyline_ui/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 assemblyline_ui/app.py,sha256=9JB-hkhReF2jLUUMe3F01dvN9i2HnRFGydvQCXBkE1U,6736
 assemblyline_ui/config.py,sha256=-b1Qv3SQ5tzuquULldJo5BEFKrF44zVbqFgawB66D3Y,5951
-assemblyline_ui/error.py,sha256=vqP9pT375oQSoWy2mMR2pNxz2YzBthpO0icxW2oO_YU,3690
+assemblyline_ui/error.py,sha256=8c-wumsGPaKsDJAp8N5AIFjoFF4K-7bNnmxZ3RZoiAo,4064
 assemblyline_ui/gunicorn_config.py,sha256=qm2Ehn9nY_yH6Klp2acYFZ9jC7St9hSmXIW42WRXbc4,740
 assemblyline_ui/gunicorn_config_socketio.py,sha256=WWAWzrZOw1OXEiV_nNMKf-wH6A0Ckio2juCYWu-QfAE,115
 assemblyline_ui/healthz.py,sha256=IFr2ofSddFX8pvoixMmZHSlk364oKD_vURl_GRT6J2s,777
 assemblyline_ui/http_exceptions.py,sha256=5DvpspLyuE6fQfR6mpPmQiFDXahr2vr3uuTp7S9Guy8,199
 assemblyline_ui/logger.py,sha256=dgaAzJc39ajD1e3hipc291zqcHyCXMgdDSLzz6V-Jus,2322
 assemblyline_ui/patched.py,sha256=EkYqCoW64CuZvrZjE7xNwZ9bTaiVfwuYBbVUR64g42A,85
 assemblyline_ui/socketsrv.py,sha256=4u8oVCt9iONC15wy1jlf6VJ6LR0zoPstcLHl9g_YaQA,2596
 assemblyline_ui/api/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-assemblyline_ui/api/base.py,sha256=tDEgJ61_CzCdY8P7CWqN2aK-qqEuoHNktFHmhY_Bopg,14502
+assemblyline_ui/api/base.py,sha256=91i4pHTtd6H0Zo01jFm1vwjHq4bZ66pE41pohj_GGyk,16195
 assemblyline_ui/api/v4/__init__.py,sha256=5sJInJQ7GM-6LTIOvTPFBHE1u-kf562MjjbzX0ZBuDg,3915
 assemblyline_ui/api/v4/alert.py,sha256=XsOATBo5TZb5lhS1h34Pna-RLAZIUpk2WK_0sJ-wesI,37510
 assemblyline_ui/api/v4/archive.py,sha256=mQn0tLEAXUt9SaWN5W9QyWjm8BCln9dPozDQf7tr-Yk,24904
 assemblyline_ui/api/v4/assistant.py,sha256=2GjmY09JRbAZ-ISF73Y2XyEFwKt5a1N3GeFWDFw8oEE,1866
 assemblyline_ui/api/v4/authentication.py,sha256=bcTZOCC2LdJcoA9pOgT9YNWaHhSxZzBVO_IZNVUEvSw,33569
 assemblyline_ui/api/v4/badlist.py,sha256=VTo9r7yVQDb52I9l4-iukP47sRB0ac9P38NAtkAGnXs,32455
 assemblyline_ui/api/v4/bundle.py,sha256=XCxILxICh8eZfkbOC0fYW_v2pdl7n-US24qYEW5_RrA,5141
@@ -66,12 +66,12 @@
 assemblyline_ui/sio/alert.py,sha256=aTtrkZW21igbP6UcFgo1_fXdF8RpCBlMiKsNdpwItZw,2170
 assemblyline_ui/sio/base.py,sha256=TLSoCLqxvSEFuggmCscnzAY1E60rweIIZLr0ai8jm5M,3529
 assemblyline_ui/sio/file.py,sha256=UMtE7mE7EcbG6KN8HBMQSvv5N7PILCq8nVnrngOnBso,2041
 assemblyline_ui/sio/live_submission.py,sha256=mS0oGO5rEA8PLa8kjBcodOG-Q0CG4SpYAoi8bz9_PCw,4158
 assemblyline_ui/sio/retrohunt.py,sha256=vlH_x6Rb4pm3GM1sNLH1C42-NVR3VoAsEfkAu3L30fY,2146
 assemblyline_ui/sio/status.py,sha256=_Bxf1KLPOJEUIk4J9_j9fzvQWUXqSIT9xnJKhT1hhuc,1980
 assemblyline_ui/sio/submission.py,sha256=IYJuGz73HK9HtYfqc-gWW8tc1lt5VZ62Qn64AaGGtm8,2222
-assemblyline_ui-4.5.1.dev84.dist-info/LICENCE.md,sha256=NSkYo9EH8h5oOkzg4VhjAHF4339MqPP2cQ8msTPgl-c,1396
-assemblyline_ui-4.5.1.dev84.dist-info/METADATA,sha256=duraNvAIiqxe8a_fI36RtMS6r9b8jc09j-pPDFOoCqg,2898
-assemblyline_ui-4.5.1.dev84.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
-assemblyline_ui-4.5.1.dev84.dist-info/top_level.txt,sha256=WLa7-PKLJTbMUbKKU3q3kg5_uAV67hss5kC71PAbIeg,16
-assemblyline_ui-4.5.1.dev84.dist-info/RECORD,,
+assemblyline_ui-4.5.1.dev86.dist-info/LICENCE.md,sha256=NSkYo9EH8h5oOkzg4VhjAHF4339MqPP2cQ8msTPgl-c,1396
+assemblyline_ui-4.5.1.dev86.dist-info/METADATA,sha256=vEz_MttMLwGCLEJq8ByVn80vwi7IrbSsvBBTd23SF0I,2898
+assemblyline_ui-4.5.1.dev86.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+assemblyline_ui-4.5.1.dev86.dist-info/top_level.txt,sha256=WLa7-PKLJTbMUbKKU3q3kg5_uAV67hss5kC71PAbIeg,16
+assemblyline_ui-4.5.1.dev86.dist-info/RECORD,,
```

