# Comparing `tmp/odoo_addon_stock_location_orderpoint-16.0.1.1.2-py3-none-any.whl.zip` & `tmp/odoo_addon_stock_location_orderpoint-16.0.2.0.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,38 +1,39 @@
-Zip file size: 51626 bytes, number of entries: 36
--rw-r--r--  2.0 unx     5837 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/README.rst
--rw-r--r--  2.0 unx       21 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/__init__.py
--rw-r--r--  2.0 unx     1081 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/__manifest__.py
--rw-r--r--  2.0 unx      730 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/data/ir_cron.xml
--rw-r--r--  2.0 unx      434 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/data/ir_sequence.xml
--rw-r--r--  2.0 unx      344 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/data/queue_job_channel.xml
--rw-r--r--  2.0 unx      542 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/data/queue_job_function.xml
--rw-r--r--  2.0 unx      687 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/demo/stock_location.xml
--rw-r--r--  2.0 unx      497 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/demo/stock_location_orderpoint.xml
--rw-r--r--  2.0 unx      685 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/demo/stock_picking_type.xml
--rw-r--r--  2.0 unx      955 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/demo/stock_route.xml
--rw-r--r--  2.0 unx    12584 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/i18n/es.po
--rw-r--r--  2.0 unx    12556 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/i18n/it.po
--rw-r--r--  2.0 unx    10250 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/i18n/stock_location_orderpoint.pot
--rw-r--r--  2.0 unx      307 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/migrations/16.0.1.1.1/post-migrate.py
--rw-r--r--  2.0 unx      119 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/models/__init__.py
--rw-r--r--  2.0 unx     1648 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/models/stock_location.py
--rw-r--r--  2.0 unx    22123 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/models/stock_location_orderpoint.py
--rw-r--r--  2.0 unx     4642 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/models/stock_move.py
--rw-r--r--  2.0 unx      355 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/models/stock_rule.py
--rw-r--r--  2.0 unx     2275 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/readme/CONFIGURE.rst
--rw-r--r--  2.0 unx      142 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx      193 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx      354 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/security/ir.model.access.csv
--rw-r--r--  2.0 unx     9455 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/static/description/icon.png
--rw-r--r--  2.0 unx    16882 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/static/description/index.html
--rw-r--r--  2.0 unx       39 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/tests/__init__.py
--rw-r--r--  2.0 unx     7668 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/tests/common.py
--rw-r--r--  2.0 unx    10652 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/tests/test_location_orderpoint.py
--rw-r--r--  2.0 unx      567 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/views/menu.xml
--rw-r--r--  2.0 unx     1093 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/views/stock_location.xml
--rw-r--r--  2.0 unx     3452 b- defN 24-Mar-20 06:26 odoo/addons/stock_location_orderpoint/views/stock_location_orderpoint_views.xml
--rw-r--r--  2.0 unx     6582 b- defN 24-Mar-20 06:26 odoo_addon_stock_location_orderpoint-16.0.1.1.2.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-Mar-20 06:26 odoo_addon_stock_location_orderpoint-16.0.1.1.2.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 24-Mar-20 06:26 odoo_addon_stock_location_orderpoint-16.0.1.1.2.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     4190 b- defN 24-Mar-20 06:26 odoo_addon_stock_location_orderpoint-16.0.1.1.2.dist-info/RECORD
-36 files, 140038 bytes uncompressed, 44448 bytes compressed:  68.3%
+Zip file size: 53640 bytes, number of entries: 37
+-rw-r--r--  2.0 unx     6123 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/README.rst
+-rw-r--r--  2.0 unx       21 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/__init__.py
+-rw-r--r--  2.0 unx     1130 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/__manifest__.py
+-rw-r--r--  2.0 unx      730 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/data/ir_cron.xml
+-rw-r--r--  2.0 unx      434 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/data/ir_sequence.xml
+-rw-r--r--  2.0 unx      344 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/data/queue_job_channel.xml
+-rw-r--r--  2.0 unx      542 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/data/queue_job_function.xml
+-rw-r--r--  2.0 unx      687 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/demo/stock_location.xml
+-rw-r--r--  2.0 unx      497 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/demo/stock_location_orderpoint.xml
+-rw-r--r--  2.0 unx      685 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/demo/stock_picking_type.xml
+-rw-r--r--  2.0 unx      955 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/demo/stock_route.xml
+-rw-r--r--  2.0 unx    12584 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/i18n/es.po
+-rw-r--r--  2.0 unx    12556 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/i18n/it.po
+-rw-r--r--  2.0 unx    11715 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/i18n/stock_location_orderpoint.pot
+-rw-r--r--  2.0 unx      307 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/migrations/16.0.1.1.1/post-migrate.py
+-rw-r--r--  2.0 unx      119 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/models/__init__.py
+-rw-r--r--  2.0 unx     1648 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/models/stock_location.py
+-rw-r--r--  2.0 unx    24391 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/models/stock_location_orderpoint.py
+-rw-r--r--  2.0 unx     4642 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/models/stock_move.py
+-rw-r--r--  2.0 unx      355 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/models/stock_rule.py
+-rw-r--r--  2.0 unx     2561 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/readme/CONFIGURE.rst
+-rw-r--r--  2.0 unx      142 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx      193 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx      354 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/security/ir.model.access.csv
+-rw-r--r--  2.0 unx     9455 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/static/description/icon.png
+-rw-r--r--  2.0 unx    17189 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/static/description/index.html
+-rw-r--r--  2.0 unx       74 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/tests/__init__.py
+-rw-r--r--  2.0 unx     7668 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/tests/common.py
+-rw-r--r--  2.0 unx     1927 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/tests/test_location_domain.py
+-rw-r--r--  2.0 unx    10652 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/tests/test_location_orderpoint.py
+-rw-r--r--  2.0 unx      567 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/views/menu.xml
+-rw-r--r--  2.0 unx     1093 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/views/stock_location.xml
+-rw-r--r--  2.0 unx     3874 b- defN 24-Apr-15 14:26 odoo/addons/stock_location_orderpoint/views/stock_location_orderpoint_views.xml
+-rw-r--r--  2.0 unx     6951 b- defN 24-Apr-15 14:26 odoo_addon_stock_location_orderpoint-16.0.2.0.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-Apr-15 14:26 odoo_addon_stock_location_orderpoint-16.0.2.0.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 24-Apr-15 14:26 odoo_addon_stock_location_orderpoint-16.0.2.0.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     4314 b- defN 24-Apr-15 14:26 odoo_addon_stock_location_orderpoint-16.0.2.0.0.dist-info/RECORD
+37 files, 147576 bytes uncompressed, 46252 bytes compressed:  68.7%
```

## zipnote {}

```diff
@@ -78,32 +78,35 @@
 
 Filename: odoo/addons/stock_location_orderpoint/tests/__init__.py
 Comment: 
 
 Filename: odoo/addons/stock_location_orderpoint/tests/common.py
 Comment: 
 
+Filename: odoo/addons/stock_location_orderpoint/tests/test_location_domain.py
+Comment: 
+
 Filename: odoo/addons/stock_location_orderpoint/tests/test_location_orderpoint.py
 Comment: 
 
 Filename: odoo/addons/stock_location_orderpoint/views/menu.xml
 Comment: 
 
 Filename: odoo/addons/stock_location_orderpoint/views/stock_location.xml
 Comment: 
 
 Filename: odoo/addons/stock_location_orderpoint/views/stock_location_orderpoint_views.xml
 Comment: 
 
-Filename: odoo_addon_stock_location_orderpoint-16.0.1.1.2.dist-info/METADATA
+Filename: odoo_addon_stock_location_orderpoint-16.0.2.0.0.dist-info/METADATA
 Comment: 
 
-Filename: odoo_addon_stock_location_orderpoint-16.0.1.1.2.dist-info/WHEEL
+Filename: odoo_addon_stock_location_orderpoint-16.0.2.0.0.dist-info/WHEEL
 Comment: 
 
-Filename: odoo_addon_stock_location_orderpoint-16.0.1.1.2.dist-info/top_level.txt
+Filename: odoo_addon_stock_location_orderpoint-16.0.2.0.0.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo_addon_stock_location_orderpoint-16.0.1.1.2.dist-info/RECORD
+Filename: odoo_addon_stock_location_orderpoint-16.0.2.0.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/stock_location_orderpoint/README.rst

```diff
@@ -3,15 +3,15 @@
 =========================
 
 .. 
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !! This file is generated by oca-gen-addon-readme !!
    !! changes will be overwritten.                   !!
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-   !! source digest: sha256:afec5a6ddad770ba6dc1a96cf0ddd7c90e1a1ac777d36524849db14bd45b827d
+   !! source digest: sha256:81ef0ccff7368de6a1cc344470b60a7a9dfbacc8f077d2999fa0690bb20e2dd6
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 
 .. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
     :target: https://odoo-community.org/page/development-status
     :alt: Beta
 .. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
     :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
@@ -86,14 +86,18 @@
       bring back the forecast quantity to 0 (i.e. max=0) but will be limited to what is available at
       the source location to plan only reservable replenishment moves.
 #. Choose the location to replenish
 #. Choose the route to use to replenish. The source location will be computed automatically based on
    the route value.
 #. Define a procurement group if you want to group some movements together.
 #. Define a priority for the created moves.
+#. If you want to filter the stock locations that should be taken in consideration
+   for product available quantities when triggering a replenishment (e.g.: Supplier locations - 
+   to avoid confirmed receptions taken into account), fill in the 
+   'Domain to filter locations' field.
 
 Bug Tracker
 ===========
 
 Bugs are tracked on `GitHub Issues <https://github.com/OCA/stock-logistics-orderpoint/issues>`_.
 In case of trouble, please check there if your issue has already been reported.
 If you spotted it first, help us to smash it by providing a detailed and welcomed
```

## odoo/addons/stock_location_orderpoint/__manifest__.py

```diff
@@ -2,15 +2,15 @@
 # License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl).
 
 {
     "name": "stock_location_orderpoint",
     "author": "MT Software, BCIM, Odoo Community Association (OCA)",
     "summary": "Declare orderpoint on a location "
     "allowing to replenish any product with the same criteria.",
-    "version": "16.0.1.1.2",
+    "version": "16.0.2.0.0",
     "data": [
         "security/ir.model.access.csv",
         "data/ir_cron.xml",
         "data/ir_sequence.xml",
         "data/queue_job_channel.xml",
         "data/queue_job_function.xml",
         "views/stock_location_orderpoint_views.xml",
@@ -20,14 +20,15 @@
     "demo": [
         "demo/stock_location.xml",
         "demo/stock_picking_type.xml",
         "demo/stock_route.xml",
         "demo/stock_location_orderpoint.xml",
     ],
     "depends": [
+        "stock_available_base_exclude_location",
         "stock_helper",
         "queue_job",
     ],
     "license": "AGPL-3",
     "maintainers": ["mt-software-de"],
     "website": "https://github.com/OCA/stock-logistics-orderpoint",
 }
```

## odoo/addons/stock_location_orderpoint/i18n/stock_location_orderpoint.pot

```diff
@@ -60,14 +60,38 @@
 
 #. module: stock_location_orderpoint
 #: model:ir.model.fields,field_description:stock_location_orderpoint.field_stock_location_orderpoint__display_name
 msgid "Display Name"
 msgstr ""
 
 #. module: stock_location_orderpoint
+#: model:ir.model.fields,field_description:stock_location_orderpoint.field_stock_location_orderpoint__stock_excluded_location_domain_char
+msgid "Domain to filter locations"
+msgstr ""
+
+#. module: stock_location_orderpoint
+#: model_terms:ir.ui.view,arch_db:stock_location_orderpoint.stock_location_orderpoint_form
+msgid "Exclude Locations"
+msgstr ""
+
+#. module: stock_location_orderpoint
+#: model:ir.model.fields,help:stock_location_orderpoint.field_stock_location_orderpoint__stock_excluded_location_ids
+msgid ""
+"Fill in this field to exclude locations for product availablequantities."
+msgstr ""
+
+#. module: stock_location_orderpoint
+#: model:ir.model.fields,help:stock_location_orderpoint.field_stock_location_orderpoint__stock_excluded_location_domain
+#: model:ir.model.fields,help:stock_location_orderpoint.field_stock_location_orderpoint__stock_excluded_location_domain_char
+msgid ""
+"Fill in this with the domain you want to exclude locations for product "
+"available quantities"
+msgstr ""
+
+#. module: stock_location_orderpoint
 #: model:ir.model.fields.selection,name:stock_location_orderpoint.selection__stock_location_orderpoint__replenish_method__fill_up
 msgid "Fill up"
 msgstr ""
 
 #. module: stock_location_orderpoint
 #: model:ir.model.fields,field_description:stock_location_orderpoint.field_stock_location_orderpoint__id
 msgid "ID"
@@ -210,14 +234,24 @@
 
 #. module: stock_location_orderpoint
 #: model:ir.model.fields,field_description:stock_location_orderpoint.field_stock_location_orderpoint__sequence
 msgid "Sequence"
 msgstr ""
 
 #. module: stock_location_orderpoint
+#: model:ir.model.fields,field_description:stock_location_orderpoint.field_stock_location_orderpoint__stock_excluded_location_domain
+msgid "Stock Excluded Location Domain"
+msgstr ""
+
+#. module: stock_location_orderpoint
+#: model:ir.model.fields,field_description:stock_location_orderpoint.field_stock_location_orderpoint__stock_excluded_location_ids
+msgid "Stock Excluded Locations"
+msgstr ""
+
+#. module: stock_location_orderpoint
 #: model:ir.actions.act_window,name:stock_location_orderpoint.action_stock_location_orderpoint
 #: model:ir.ui.menu,name:stock_location_orderpoint.menu_stock_location_orderpoint
 msgid "Stock Location Orderpoint"
 msgstr ""
 
 #. module: stock_location_orderpoint
 #: model:ir.model,name:stock_location_orderpoint.model_stock_move
```

## odoo/addons/stock_location_orderpoint/models/stock_location_orderpoint.py

```diff
@@ -10,14 +10,15 @@
 from odoo.tools import float_compare, split_every
 
 from odoo.addons.stock.models.stock_move import PROCUREMENT_PRIORITIES
 
 
 class StockLocationOrderpoint(models.Model):
     _name = "stock.location.orderpoint"
+    _inherit = ["stock.exclude.location.mixin"]
     _description = "Stock location orderpoint"
     _order = "priority desc, sequence"
     _check_company_auto = True
 
     name = fields.Char(
         copy=False,
         required=True,
@@ -184,102 +185,153 @@
 
     def _get_consuming_moves_domain_for_group(self):
         """Returns a domain which selects moves the outgoings that could
         introduce a shortage at the location for a list of orderpoints
         with the same characteristics except the location_id
         """
         first = self[0]
-        domain = [
-            ("location_id", "child_of", self.location_id.ids),
-        ]
+        domain = []
         if first.trigger == "cron":
             if not first.last_cron_execution:
                 # initialize a date 1 week ago to avoid selecting all moves
                 # when the cron is executed for the first time
                 first.last_cron_execution = self.env.cr.now() - timedelta(days=7)
-            domain.append(("write_date", ">=", first.last_cron_execution))
+            domain.append(("date", ">=", first.last_cron_execution))
         if first.replenish_method == "fill_up":
             # with fillup, we know that a replenishment is required when
             # move are waiting availability
             domain.append(("state", "in", ["confirmed", "partially_available"]))
         return domain
 
     def _get_consuming_moves_domain(self):
         """Returns a domain which selects moves the outgoings that could
         introduce a shortage at the location"""
         domain = [
             ("move_orig_ids", "=", False),
             ("procure_method", "=", "make_to_stock"),
         ]
+        if self:
+            domain.append(("location_id", "child_of", self.location_id.ids))
         groups = []
         for orderpoints in self._group_by_domain_config():
-            groups.append(orderpoints._get_consuming_moves_domain_for_group())
+            group_domain = orderpoints._get_consuming_moves_domain_for_group()
+            if group_domain:
+                groups.append(group_domain)
         if not groups:
             return domain
         return expression.AND([domain, expression.OR(groups)])
 
+    def _get_replenishment_moves_domain_for_group(self):
+        """Returns a domain which selects the incomig moves that could
+        allow a replenishment at the location for a list of orderpoints
+        with the same characteristics except the location_id
+        """
+        first = self[0]
+        domain = []
+        if first.trigger == "cron":
+            if not first.last_cron_execution:
+                # initialize a date 1 week ago to avoid selecting all moves
+                # when the cron is executed for the first time
+                first.last_cron_execution = self.env.cr.now() - timedelta(days=7)
+            domain.append(("date", ">=", first.last_cron_execution))
+        return domain
+
     def _get_replenishment_moves_domain(self):
         """Returns a domain which selects moves that could replenish
         the location"""
         domain = [
             ("move_dest_ids", "=", False),
             ("procure_method", "=", "make_to_stock"),
             ("state", "=", "done"),
         ]
         if self:
             domain.append(("location_dest_id", "child_of", self.location_src_id.ids))
-        return domain
+        groups = []
+        for orderpoints in self._group_by_domain_config():
+            group_domain = orderpoints._get_replenishment_moves_domain_for_group()
+            if group_domain:
+                groups.append(group_domain)
+        if not groups:
+            return domain
+        return expression.AND([domain, expression.OR(groups)])
 
     @api.model
     @tools.ormcache("ids")
     def _get_consuming_moves_domain_for_ids(self, ids=None):
-        """Returns a domain which selects moves the outgoings that could
-        introduce a shortage at the location for a list of orderpoints"""
+        """
+
+        Returns a domain which selects moves the outgoings that could
+        introduce a shortage at the location for a list of orderpoints
+
+        :param frozenset() ids: The orderpoint ids
+        """
+        if ids is not None:
+            ids = list(ids)
         orderpoints = self.browse(ids) if ids else self.search([])
         return orderpoints._get_consuming_moves_domain()
 
     @api.model
     @tools.ormcache("ids")
     def _get_replenishment_moves_domain_for_ids(self, ids=None):
-        """Returns a domain which selects moves that could replenish
-        the location for a list of orderpoints"""
+        """
+
+        Returns a domain which selects moves that could replenish
+        the location for a list of orderpoints
+
+        :param frozenset() ids: The orderpoint ids
+        """
+        if ids is not None:
+            ids = list(ids)
         orderpoints = self.browse(ids) if ids else self.search([])
         return orderpoints._get_replenishment_moves_domain()
 
     @api.model
     def _get_moves_domain(self, ids):
         """
         Returns a domain which selects moves replenishing or consuming
         the locations of orderpoints with given ids
         """
-        ids = tuple(ids)
+        ids = frozenset(ids)
         return expression.OR(
             [
                 self._get_replenishment_moves_domain_for_ids(ids),
                 self._get_consuming_moves_domain_for_ids(ids),
             ]
         )
 
     def _find_potential_moves_to_replenish_by_location(self, products=False):
         """Return a dictionary of products per location that potentially require a replenishment
         based on the fact there are moves not reserved for those products.
         This reduces the list of products for which the quantity will be computed"""
-        domain = self._get_moves_domain(self.ids)
-        if products:
-            domain = expression.AND([domain, [("product_id", "in", products.ids)]])
-        moves_grouped = self.env["stock.move"].read_group(
-            domain,
-            ["ids:array_agg(id)", "location_id"],
-            "location_id",
-        )
+        # We don't use the _get_moves_domain method because. We prefer to make
+        # 2 queries instead of 1 with a big OR statement because the query
+        # planner is not able to use the indexes properly
+        location_ids = []
+        domains = [
+            self._get_replenishment_moves_domain_for_ids(frozenset(self.ids)),
+            self._get_consuming_moves_domain_for_ids(frozenset(self.ids)),
+        ]
+        result = {}
+        for domain in domains:
+            if products:
+                domain = expression.AND([domain, [("product_id", "in", products.ids)]])
+            moves_grouped = self.env["stock.move"].read_group(
+                domain,
+                ["ids:array_agg(id)", "location_id"],
+                "location_id",
+                orderby="id",
+            )
+            for res in moves_grouped:
+                location_ids.append(res["location_id"][0])
+                result.setdefault(res["location_id"][0], []).extend(res["ids"])
         return {
             self.env["stock.location"]
-            .browse(res["location_id"][0]): self.env["stock.move"]
-            .browse(res["ids"])
-            for res in moves_grouped
+            .browse(location_ids): self.env["stock.move"]
+            .browse(mode_ids)
+            for location_ids, mode_ids in result.items()
         }
 
     def _sort_orderpoints(self):
         return self.sorted()
 
     @api.model
     def _compute_quantities_dict(self, locations, products):
@@ -345,21 +397,25 @@
         qty_to_replenish = virtual_available_on_dest - qty_already_replenished
         return min(qty_to_replenish, virtual_available_on_src)
 
     def _get_qties_to_replenish(self, moves_by_location):
         products = set()
         for moves in moves_by_location.values():
             products.update(moves.product_id.ids)
-        qties_on_locations = self._compute_quantities_dict(
-            (self.location_id | self.location_src_id),
-            self.env["product.product"].browse(products),
-        )
         qties_replenished = defaultdict(lambda: defaultdict(lambda: 0))
         qties_to_replenish = defaultdict(list)
         for orderpoint in self:
+            qties_on_locations = self._compute_quantities_dict(
+                (self.location_id | self.location_src_id),
+                self.env["product.product"]
+                .browse(products)
+                .with_context(
+                    excluded_location_domain=orderpoint.stock_excluded_location_domain
+                ),
+            )
             if orderpoint.location_id not in moves_by_location:
                 continue
 
             for product in moves_by_location[orderpoint.location_id].product_id:
                 qties_replenished_for_location = qties_replenished[
                     orderpoint.location_id
                 ]
```

## odoo/addons/stock_location_orderpoint/readme/CONFIGURE.rst

```diff
@@ -45,7 +45,11 @@
       bring back the forecast quantity to 0 (i.e. max=0) but will be limited to what is available at
       the source location to plan only reservable replenishment moves.
 #. Choose the location to replenish
 #. Choose the route to use to replenish. The source location will be computed automatically based on
    the route value.
 #. Define a procurement group if you want to group some movements together.
 #. Define a priority for the created moves.
+#. If you want to filter the stock locations that should be taken in consideration
+   for product available quantities when triggering a replenishment (e.g.: Supplier locations - 
+   to avoid confirmed receptions taken into account), fill in the 
+   'Domain to filter locations' field.
```

## odoo/addons/stock_location_orderpoint/static/description/index.html

```diff
@@ -362,15 +362,15 @@
 <div class="document" id="stock-location-orderpoint">
 <h1 class="title">stock_location_orderpoint</h1>
 
 <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 !! This file is generated by oca-gen-addon-readme !!
 !! changes will be overwritten.                   !!
 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-!! source digest: sha256:afec5a6ddad770ba6dc1a96cf0ddd7c90e1a1ac777d36524849db14bd45b827d
+!! source digest: sha256:81ef0ccff7368de6a1cc344470b60a7a9dfbacc8f077d2999fa0690bb20e2dd6
 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
 <p><a class="reference external image-reference" href="https://odoo-community.org/page/development-status"><img alt="Beta" src="https://img.shields.io/badge/maturity-Beta-yellow.png" /></a> <a class="reference external image-reference" href="http://www.gnu.org/licenses/agpl-3.0-standalone.html"><img alt="License: AGPL-3" src="https://img.shields.io/badge/licence-AGPL--3-blue.png" /></a> <a class="reference external image-reference" href="https://github.com/OCA/stock-logistics-orderpoint/tree/16.0/stock_location_orderpoint"><img alt="OCA/stock-logistics-orderpoint" src="https://img.shields.io/badge/github-OCA%2Fstock--logistics--orderpoint-lightgray.png?logo=github" /></a> <a class="reference external image-reference" href="https://translation.odoo-community.org/projects/stock-logistics-orderpoint-16-0/stock-logistics-orderpoint-16-0-stock_location_orderpoint"><img alt="Translate me on Weblate" src="https://img.shields.io/badge/weblate-Translate%20me-F47D42.png" /></a> <a class="reference external image-reference" href="https://runboat.odoo-community.org/builds?repo=OCA/stock-logistics-orderpoint&amp;target_branch=16.0"><img alt="Try me on Runboat" src="https://img.shields.io/badge/runboat-Try%20me-875A7B.png" /></a></p>
 <p>Declare orderpoint on a location allowing to replenish any product with the same criteria.
 This is for an internal warehouse replenishment currently not compatible with the purchase buy route.</p>
 <p><strong>Table of contents</strong></p>
 <div class="contents local topic" id="contents">
 <ul class="simple">
@@ -460,14 +460,19 @@
 <li><p class="first">Choose the route to use to replenish. The source location will be computed automatically based on
 the route value.</p>
 </li>
 <li><p class="first">Define a procurement group if you want to group some movements together.</p>
 </li>
 <li><p class="first">Define a priority for the created moves.</p>
 </li>
+<li><p class="first">If you want to filter the stock locations that should be taken in consideration
+for product available quantities when triggering a replenishment (e.g.: Supplier locations -
+to avoid confirmed receptions taken into account), fill in the
+‘Domain to filter locations’ field.</p>
+</li>
 </ol>
 </div>
 <div class="section" id="bug-tracker">
 <h1><a class="toc-backref" href="#toc-entry-6">Bug Tracker</a></h1>
 <p>Bugs are tracked on <a class="reference external" href="https://github.com/OCA/stock-logistics-orderpoint/issues">GitHub Issues</a>.
 In case of trouble, please check there if your issue has already been reported.
 If you spotted it first, help us to smash it by providing a detailed and welcomed
```

### html2text {}

```diff
@@ -55,14 +55,18 @@
                  but will be limited to what is available at the source
                  location to plan only reservable replenishment moves.
    6. Choose the location to replenish
    7. Choose the route to use to replenish. The source location will be
       computed automatically based on the route value.
    8. Define a procurement group if you want to group some movements together.
    9. Define a priority for the created moves.
+  10. If you want to filter the stock locations that should be taken in
+      consideration for product available quantities when triggering a
+      replenishment (e.g.: Supplier locations - to avoid confirmed receptions
+      taken into account), fill in the ‘Domain to filter locations’ field.
 ************ _BB_uu_gg_ _TT_rr_aa_cc_kk_ee_rr ************
 Bugs are tracked on _G_i_t_H_u_b_ _I_s_s_u_e_s. In case of trouble, please check there if
 your issue has already been reported. If you spotted it first, help us to smash
 it by providing a detailed and welcomed _f_e_e_d_b_a_c_k.
 Do not contact contributors directly about support or help with technical
 issues.
 ************ _CC_rr_ee_dd_ii_tt_ss ************
```

## odoo/addons/stock_location_orderpoint/tests/__init__.py

```diff
@@ -1 +1,2 @@
 from . import test_location_orderpoint
+from . import test_location_domain
```

## odoo/addons/stock_location_orderpoint/views/stock_location_orderpoint_views.xml

### odoo/addons/stock_location_orderpoint/views/stock_location_orderpoint_views.xml

```diff
@@ -40,14 +40,18 @@
           <group>
             <field name="location_id"/>
             <field name="location_src_id"/>
             <field name="route_id"/>
             <field name="group_id"/>
             <field name="priority"/>
           </group>
+          <group name="exclude_locations" string="Exclude Locations">
+            <field name="stock_excluded_location_ids" widget="many2many_tags"/>
+            <field name="stock_excluded_location_domain_char" widget="domain" options="{'model': 'stock.quant'}"/>
+          </group>
         </sheet>
       </form>
     </field>
   </record>
   <record model="ir.ui.view" id="stock_location_orderpoint_search">
     <field name="name">stock.location.orderpoint.search</field>
     <field name="model">stock.location.orderpoint</field>
```

## Comparing `odoo_addon_stock_location_orderpoint-16.0.1.1.2.dist-info/METADATA` & `odoo_addon_stock_location_orderpoint-16.0.2.0.0.dist-info/METADATA`

 * *Files 7% similar despite different names*

```diff
@@ -1,35 +1,36 @@
 Metadata-Version: 2.1
 Name: odoo-addon-stock-location-orderpoint
-Version: 16.0.1.1.2
+Version: 16.0.2.0.0
 Summary: Declare orderpoint on a location allowing to replenish any product with the same criteria.
 Home-page: https://github.com/OCA/stock-logistics-orderpoint
 Author: MT Software, BCIM, Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: AGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
 Classifier: Framework :: Odoo
 Classifier: Framework :: Odoo :: 16.0
 Classifier: License :: OSI Approved :: GNU Affero General Public License v3
 Requires-Python: >=3.10
 Requires-Dist: odoo-addon-queue-job <16.1dev,>=16.0dev
+Requires-Dist: odoo-addon-stock-available-base-exclude-location <16.1dev,>=16.0dev
 Requires-Dist: odoo-addon-stock-helper <16.1dev,>=16.0dev
 Requires-Dist: odoo <16.1dev,>=16.0a
 
 =========================
 stock_location_orderpoint
 =========================
 
 .. 
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !! This file is generated by oca-gen-addon-readme !!
    !! changes will be overwritten.                   !!
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-   !! source digest: sha256:afec5a6ddad770ba6dc1a96cf0ddd7c90e1a1ac777d36524849db14bd45b827d
+   !! source digest: sha256:81ef0ccff7368de6a1cc344470b60a7a9dfbacc8f077d2999fa0690bb20e2dd6
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 
 .. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
     :target: https://odoo-community.org/page/development-status
     :alt: Beta
 .. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
     :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
@@ -104,14 +105,18 @@
       bring back the forecast quantity to 0 (i.e. max=0) but will be limited to what is available at
       the source location to plan only reservable replenishment moves.
 #. Choose the location to replenish
 #. Choose the route to use to replenish. The source location will be computed automatically based on
    the route value.
 #. Define a procurement group if you want to group some movements together.
 #. Define a priority for the created moves.
+#. If you want to filter the stock locations that should be taken in consideration
+   for product available quantities when triggering a replenishment (e.g.: Supplier locations - 
+   to avoid confirmed receptions taken into account), fill in the 
+   'Domain to filter locations' field.
 
 Bug Tracker
 ===========
 
 Bugs are tracked on `GitHub Issues <https://github.com/OCA/stock-logistics-orderpoint/issues>`_.
 In case of trouble, please check there if your issue has already been reported.
 If you spotted it first, help us to smash it by providing a detailed and welcomed
```

## Comparing `odoo_addon_stock_location_orderpoint-16.0.1.1.2.dist-info/RECORD` & `odoo_addon_stock_location_orderpoint-16.0.2.0.0.dist-info/RECORD`

 * *Files 8% similar despite different names*

```diff
@@ -1,36 +1,37 @@
-odoo/addons/stock_location_orderpoint/README.rst,sha256=lA0_QQMfR2GdGHkacHqwHIDV6UmNp4dKMBIihDZhBsA,5837
+odoo/addons/stock_location_orderpoint/README.rst,sha256=PEofp4krl_pZwQUwWToW4xSjUpRax1GQCnmb-E8FTzU,6123
 odoo/addons/stock_location_orderpoint/__init__.py,sha256=X9EJGOE2GtZbS0G82PtSXmWSZ_R8jEM0rlJTDliQjp4,21
-odoo/addons/stock_location_orderpoint/__manifest__.py,sha256=VcWBsUGndy9C8JYv1chEemuS65r9oVFW21i_TOg3tBA,1081
+odoo/addons/stock_location_orderpoint/__manifest__.py,sha256=l8YzJer7FRvpGSgM_5qNvCf7dwTsDuU_ywrkxBF_teM,1130
 odoo/addons/stock_location_orderpoint/data/ir_cron.xml,sha256=rvKAyaqLAJt9-54LIyaccVCMbzVMXa04cuKrN1o2U5M,730
 odoo/addons/stock_location_orderpoint/data/ir_sequence.xml,sha256=hQr9xBYRKnyJsB4thFdBcFLFZYNdu2ThOf2aNQTYLzw,434
 odoo/addons/stock_location_orderpoint/data/queue_job_channel.xml,sha256=3JD4hTCwpns_tQ0q-TIas6JqZXsZN7HNGv2NpLpy24c,344
 odoo/addons/stock_location_orderpoint/data/queue_job_function.xml,sha256=ITQ8WEyHn7kfNTYLQceAvPbjbNqMtGsL7yeqjJT5MUk,542
 odoo/addons/stock_location_orderpoint/demo/stock_location.xml,sha256=OFgcBPjHIuHLD4N5l4JOIDfuP_5gzRHWWHSipGh_Ui4,687
 odoo/addons/stock_location_orderpoint/demo/stock_location_orderpoint.xml,sha256=pHjRnYEkj1kL2FbLG5DjEW_HYXS-UWXcRablWNaEaAs,497
 odoo/addons/stock_location_orderpoint/demo/stock_picking_type.xml,sha256=89BUcNm3HeH4JY4B1Kz79samj-MfjBm2nY0RgWh4LJg,685
 odoo/addons/stock_location_orderpoint/demo/stock_route.xml,sha256=nZB0lZ7YqFDB3t33BMtq_3EteORKsuVEQ73kOlisRnY,955
 odoo/addons/stock_location_orderpoint/i18n/es.po,sha256=p_Mf_CqYNtLKSYe3VuOksRAvDMrBJZnpuxYzEn-GxZk,12584
 odoo/addons/stock_location_orderpoint/i18n/it.po,sha256=j9h7-k2quhSmhFRorfUQZGeK04ILGJKdyc132UzPTN0,12556
-odoo/addons/stock_location_orderpoint/i18n/stock_location_orderpoint.pot,sha256=QPk1ObG0UVWZurfQ1S8QNfR3eepZ8GNWsL1ogpPdSe0,10250
+odoo/addons/stock_location_orderpoint/i18n/stock_location_orderpoint.pot,sha256=l_pVkTAWZyqQkH96bMfIq8kV5FB_ax9n7Li0wEyqGtc,11715
 odoo/addons/stock_location_orderpoint/migrations/16.0.1.1.1/post-migrate.py,sha256=UR5f50mlKl8-ylAJ3qMk4ZMq9APezi8QqocnXnPHMbc,307
 odoo/addons/stock_location_orderpoint/models/__init__.py,sha256=MZtta5cMyptrl-rW6hAb13L3Y1FmylPBV7pSBJXuxZ4,119
 odoo/addons/stock_location_orderpoint/models/stock_location.py,sha256=X9hEkfHyWEzn2ln8G0PAcf7TE4AtsLsB4PQqgvE5j-g,1648
-odoo/addons/stock_location_orderpoint/models/stock_location_orderpoint.py,sha256=1NeTneH8xypWGw3t4SM0FfTcBnzDFszPfNOm0Ky0rh4,22123
+odoo/addons/stock_location_orderpoint/models/stock_location_orderpoint.py,sha256=2DhH_kZzivFsHm3ufhSFs_3W4q2_iEypGbyiA-xSVGM,24391
 odoo/addons/stock_location_orderpoint/models/stock_move.py,sha256=e1JxgdyT5gE8_r1y89Novctjw1yL_GLZkecPu7qZJU4,4642
 odoo/addons/stock_location_orderpoint/models/stock_rule.py,sha256=1xGzhYROf5wg7khA26RiRlxD2x3l8uk0BpCxm8s9KWw,355
-odoo/addons/stock_location_orderpoint/readme/CONFIGURE.rst,sha256=NYLAxaMNMEeceqLnF6-yC-GyN0p2m65jHv2akmFQLaI,2275
+odoo/addons/stock_location_orderpoint/readme/CONFIGURE.rst,sha256=FFaTG3Cj4ueNHkh5igeQw5vu1sEt9nzjPErDSF2rMmo,2561
 odoo/addons/stock_location_orderpoint/readme/CONTRIBUTORS.rst,sha256=bkE6gqBNT-dGDyE9CRppVC-CflPwDuWMk0WquW0H0Fw,142
 odoo/addons/stock_location_orderpoint/readme/DESCRIPTION.rst,sha256=sjaDjXvDNUUmJzcyCHjLBZsMtBJfY5cIjCuYh7SB_sw,193
 odoo/addons/stock_location_orderpoint/security/ir.model.access.csv,sha256=J7FwKahm6_SXiKRh3-ZLoVSTHpP5L-ktYRZzpIrWKKI,354
 odoo/addons/stock_location_orderpoint/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
-odoo/addons/stock_location_orderpoint/static/description/index.html,sha256=oiPZv1dPQwVyylScsJof9KVXoZlFGbjkDTTikiDVRHo,16882
-odoo/addons/stock_location_orderpoint/tests/__init__.py,sha256=p_soeGCG07FYRiGF-5VqMKSX8uywrfh_u4YtyG-VbGo,39
+odoo/addons/stock_location_orderpoint/static/description/index.html,sha256=hGbbbdiw4jqbMJJazMjs_vABbiRz0QrDD6b3bKchYR8,17189
+odoo/addons/stock_location_orderpoint/tests/__init__.py,sha256=u4DBgFjTbUlfPikmBVlRaVBAGDs8YfR4qfXJFioYkXo,74
 odoo/addons/stock_location_orderpoint/tests/common.py,sha256=9o-RtFB5n7Nxr_JZHtG2g3vlhnxQdwIxSES8IIpT3Yg,7668
+odoo/addons/stock_location_orderpoint/tests/test_location_domain.py,sha256=Q5DB1SmMYgL84tpcDmiZEZtBeOLIl60bW_PR1kd9_nY,1927
 odoo/addons/stock_location_orderpoint/tests/test_location_orderpoint.py,sha256=Ht4xNVyqyjfFdB7S0klobO9Hl_NkAYCQHS78IRJ-3c8,10652
 odoo/addons/stock_location_orderpoint/views/menu.xml,sha256=8pRYr_iey1QOAwTHpUDD1X6ysjXMVOjMKR5MYM2z2Zc,567
 odoo/addons/stock_location_orderpoint/views/stock_location.xml,sha256=9CX_3N6fUZFgK81e6W7gLGKBMLtac0Wh9jp0GfE5zDo,1093
-odoo/addons/stock_location_orderpoint/views/stock_location_orderpoint_views.xml,sha256=4zIGbMkBSRizGs67KB6tkuWuPI2ZZV0U8eTmecg4WAs,3452
-odoo_addon_stock_location_orderpoint-16.0.1.1.2.dist-info/METADATA,sha256=-2wGwq4s11MW5xC3F4jj5iByXF-Vznj8h9EHK3vZOLw,6582
-odoo_addon_stock_location_orderpoint-16.0.1.1.2.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
-odoo_addon_stock_location_orderpoint-16.0.1.1.2.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo_addon_stock_location_orderpoint-16.0.1.1.2.dist-info/RECORD,,
+odoo/addons/stock_location_orderpoint/views/stock_location_orderpoint_views.xml,sha256=ecJRjLAksKV-MdPUHA9m6bNVyGgkXv49E4hT1LnhFvA,3874
+odoo_addon_stock_location_orderpoint-16.0.2.0.0.dist-info/METADATA,sha256=I2YUBQTg1LuqljBvXPPCTQ6ZDko-NkSU-4cFgGHLDlY,6951
+odoo_addon_stock_location_orderpoint-16.0.2.0.0.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+odoo_addon_stock_location_orderpoint-16.0.2.0.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo_addon_stock_location_orderpoint-16.0.2.0.0.dist-info/RECORD,,
```

